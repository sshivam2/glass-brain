<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>065 Ischemic Heart Disease - Complications And Management - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 38-year-old woman presented with chest pain that was unrelated to physical exertion. ECG showed ST-segment elevation. Intracoronary acetylcholine provocation testing revealed a transient spasm of the right coronary artery. What is the drug of choice in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dopamine"
      },
      {
        "id": 2,
        "text": "Diltiazem"
      },
      {
        "id": 3,
        "text": "Propranolol"
      },
      {
        "id": 4,
        "text": "Digoxin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above scenario in which rest pain is associated with ST-segment elevation and transient coronary vasospasm is suggestive of&nbsp;<strong>Prinzmetal's angina.</strong> The drug of choice&nbsp;is a <strong>calcium channel blocker</strong>.</p>\n<p>Prinzmetal variant angina<strong>&nbsp;</strong>(PVA) is a clinical syndrome in which chest pain occurs <strong>without</strong> the usual <strong>precipitating</strong> factors. It usually results from coronary vasoconstriction (<strong>vasospasm</strong>) and tends to involve the right coronary artery.</p>\n<p>It is a <strong>supply</strong> <strong>ischemia</strong> and usually causes transmural ischemia (subendocardial in classic angina pectoris).</p>\n<p>It often affects women under 50 years of age. It characteristically occurs in the early morning, awakening patients from sleep, and may be associated with arrhythmias or conduction defects.</p>\n<p>The clinical diagnosis of PVA is made by the detection of transient <strong>ST-segment elevation</strong> with rest pain. Coronary angiography demonstrates transient <strong>coronary spasm</strong> which is the diagnostic hallmark of PVA.</p>\n<p>Nitrates and calcium channel blockers both can be used in alleviating symptoms in Prinzmetal's angina. However due to the development of nitrate tolerance in some individuals, they are less preferred and calcium channel blockers such as verapamil, diltiazem are used as first-line agents.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who presents to the ER with chest pain and dyspnea is diagnosed with STEMI. Swift revascularization by thrombolysis is planned for her.  What is the dose of streptokinase to be used?",
    "choices": [
      {
        "id": 1,
        "text": "0.5 million units IV over 1 hour"
      },
      {
        "id": 2,
        "text": "1.5 million units IV over 1 hour"
      },
      {
        "id": 3,
        "text": "2 million units IV over 1 hour"
      },
      {
        "id": 4,
        "text": "2.5 million units IV over 1 hour"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Streptokinase</strong> is given in a dose of <strong>1.5 million units IV </strong>given over<strong> 1 hour&nbsp;</strong>for treatment of MI.</p>\n<p>Fibrinolytic therapy should ideally be initiated <strong>within 30 min</strong> of presentation.&nbsp;The <strong>fibrinolytic</strong> <strong>agents</strong> that have been approved for IV use in patients with <strong>STEMI</strong> are:</p>\n<ul>\n<li>Tissue plasminogen activator (tPA)</li>\n<li><strong>Streptokinase</strong></li>\n<li>Tenecteplase (TNK)</li>\n<li>Reteplase (rPA)&nbsp;</li>\n</ul>\n<p>Adverse effects of streptokinase:</p>\n<ul>\n<li>Transient hypotension</li>\n<li>Allergic reactions</li>\n<li>Hemorrhage</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the given fibrinolytic agents is least preferred for thrombolysis in a patient with MI?",
    "choices": [
      {
        "id": 1,
        "text": "Streptokinase"
      },
      {
        "id": 2,
        "text": "Alteplase"
      },
      {
        "id": 3,
        "text": "Tenecteplase"
      },
      {
        "id": 4,
        "text": "Reteplase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Streptokinase</strong> has the <strong>lowest</strong> clot <strong>selectivity</strong> among the fibrinolytic agents.</p>\n<p>Fibrinolytic agent with:</p>\n<ul>\n<li>Least fibrin specificity\u2013 streptokinase</li>\n<li>Most fibrin specificity \u2013 tenecteplase</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While planning thrombolysis for a patient with MI, use of which of the following agents will reduce the chances of a dosing error?",
    "choices": [
      {
        "id": 1,
        "text": "Streptokinase"
      },
      {
        "id": 2,
        "text": "Tissue plasminogen activator"
      },
      {
        "id": 3,
        "text": "Alteplase"
      },
      {
        "id": 4,
        "text": "Tenecteplase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Tenecteplase </strong>is given as a <strong>single bolus</strong> dose (based on body weight) which&nbsp;<strong>reduces</strong> the rate of <strong>medication</strong> <strong>errors&nbsp;</strong>(common with IV infusions).</p>\n<p>Tenecteplase and reteplase are referred to as bolus fibrinolytics as their administration does not require prolonged intravenous infusion.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an absolute contraindication for the use of a fibrinolytic agent in patients with an acute MI?",
    "choices": [
      {
        "id": 1,
        "text": "Non-haemorrhagic stroke within 1 year"
      },
      {
        "id": 2,
        "text": "Marked hypertension"
      },
      {
        "id": 3,
        "text": "Prolonged cardiopulmonary resuscitation"
      },
      {
        "id": 4,
        "text": "Suspicion of aortic dissection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Prolonged cardiopulmonary resuscitation</strong> is a <strong>relative contraindication</strong> for fibrinolytic therapy.</p>\n<table width=\"486\">\n<tbody>\n<tr>\n<td colspan=\"2\" width=\"486\">\n<p>Contraindications for the use of fibrinolytic agents</p>\n</td>\n</tr>\n<tr>\n<td width=\"248\">\n<p><strong>Absolute contraindications</strong></p>\n</td>\n<td width=\"239\">\n<p><strong>Relative contraindications</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"248\">\n<p>History of hemorrhagic stroke at any time&nbsp;</p>\n</td>\n<td width=\"239\">\n<p>Current use of anticoagulants (INR &ge;2)</p>\n</td>\n</tr>\n<tr>\n<td width=\"248\">\n<p>Non-hemorrhagic stroke or other cerebrovascular events within the past year</p>\n</td>\n<td width=\"239\">\n<p>Recent (&lt;2 weeks) invasive or surgical procedure</p>\n</td>\n</tr>\n<tr>\n<td width=\"248\">\n<p>Marked hypertension (SBP&gt;180mmHg and/or a DBP&gt;110 mmHg) at any time during the acute presentation</p>\n</td>\n<td width=\"239\">\n<p>Prolonged (&gt;10 min) cardiopulmonary resuscitation</p>\n</td>\n</tr>\n<tr>\n<td width=\"248\">\n<p>Suspicion of aortic dissection</p>\n</td>\n<td width=\"239\">\n<p>Known bleeding diathesis</p>\n</td>\n</tr>\n<tr>\n<td width=\"248\">\n<p>Active internal bleeding (excluding menses)</p>\n</td>\n<td width=\"239\">\n<p>Pregnancy</p>\n</td>\n</tr>\n<tr>\n<td rowspan=\"3\" width=\"248\">\n<p>&nbsp;</p>\n</td>\n<td width=\"239\">\n<p>Hemorrhagic ophthalmic condition (e.g., hemorrhagic diabetic retinopathy)</p>\n</td>\n</tr>\n<tr>\n<td width=\"239\">\n<p>Active peptic ulcer disease</p>\n</td>\n</tr>\n<tr>\n<td width=\"239\">\n<p>History of severe hypertension that is currently adequately controlled</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following drugs should be avoided in a patient with angina except:",
    "choices": [
      {
        "id": 1,
        "text": "Thyroxine"
      },
      {
        "id": 2,
        "text": "Sumatriptan"
      },
      {
        "id": 3,
        "text": "Dipyridamole"
      },
      {
        "id": 4,
        "text": "Trimetazidine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Trimetazidine</strong> is an <strong>antianginal</strong> drug.</p>\n<p>It is a PFox (partial fatty acid oxidation) inhibitor. It <strong>inhibits</strong> the <strong>beta-oxidation</strong> of fatty acids and thus enhances glucose oxidation. This results in decreased oxygen consumption in ATP synthesis as beta-oxidation consumes more oxygen.</p>\n<p>Option A: Thyroxine increases the heart rate, which can increase the myocardial oxygen demand and can precipitate angina.</p>\n<p>Option B: Sumatriptan and other triptans cause coronary vasospasm. They are therefore contraindicated in patients with CAD.</p>\n<p>Option C: Dipyridamole can produce coronary steal phenomenon and can worsen angina.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following combinations should be avoided while treating a patient with angina?",
    "choices": [
      {
        "id": 1,
        "text": "Nitrates and \u03b2-blocker"
      },
      {
        "id": 2,
        "text": "Nitrates and Verapamil"
      },
      {
        "id": 3,
        "text": "Verapamil and \u03b2-blocker"
      },
      {
        "id": 4,
        "text": "Amlodipine and \u03b2-blocker"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Verapamil</strong> and <strong>&beta;-blockers</strong> have <strong>additive effects</strong> on <strong>inhibiting</strong> SA node and AV <strong>conduction</strong>, the combination should be avoided to prevent severe <strong>bradycardia</strong> and <strong>conduction</strong> <strong>block</strong>. These agents can also have additive effects on decreasing left ventricular function which could seriously impair cardiac output in a patient with heart failure.</p>\n<p><strong>Diltiazem</strong> can be combined with beta-blockers in patients with normal ventricular function and no conduction disturbances.</p>\n<p><strong>Amlodipine</strong> and <strong>&beta;-blockers</strong> have complementary actions on coronary blood supply and myocardial oxygen demands.&nbsp;Whereas the former decreases blood pressure and dilates coronary arteries, the latter slows the heart rate and decreases contractility.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the mechanism of action of ranolazine?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibits adenosine reuptake"
      },
      {
        "id": 2,
        "text": "Inhibits late inward Na current"
      },
      {
        "id": 3,
        "text": "Potassium channel opener"
      },
      {
        "id": 4,
        "text": "Rho-kinase inhibitor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The predominant mechanism of action of <strong>ranolazine</strong> is <strong>inhibition </strong>of the<strong> late sodium current </strong>in myocardial cells.</p>\n<p>Ranolazine is useful for patients with <strong>chronic angina</strong> despite standard medical therapy. It is administered at a dose of 500-1000 mg twice daily.</p>\n<p>Contraindications:</p>\n<ul>\n<li>Hepatic impairment</li>\n<li>QT prolongation</li>\n<li>Drugs inhibiting CYP3A metabolic system- ketoconazole, diltiazem, verapamil, macrolide antibiotics, HIV protease inhibitors, and large quantities of grapefruit juice</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient on clopidogrel is scheduled to undergo an elective operation. What is your advice regarding the drug?",
    "choices": [
      {
        "id": 1,
        "text": "Stop clopidogrel 12-24 hours before operation"
      },
      {
        "id": 2,
        "text": "Continue clopidogrel"
      },
      {
        "id": 3,
        "text": "Stop clopidogrel 7-10 days before operation"
      },
      {
        "id": 4,
        "text": "Stop clopidogrel 5-7 days before operation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Clopidogrel</strong> should be stopped <strong>5-7 days prior to surgery</strong> to avoid the risk of increased surgical bleeding.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs would you prescribe to prolong life in a post-MI patient?",
    "choices": [
      {
        "id": 1,
        "text": "Beta blockers"
      },
      {
        "id": 2,
        "text": "Calcium channel blockers"
      },
      {
        "id": 3,
        "text": "Nitrates"
      },
      {
        "id": 4,
        "text": "Aspirin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Beta-blockers</strong> are the only antianginal agents that have been demonstrated to <strong>prolong life</strong> in patients with coronary disease (<strong>post-myocardial infarction</strong>).</p>\n<p>Note: B-blockers and spironolactone have been demonstrated to improve survival in individuals with heart failure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man post-MI had the following lab values. Which of the following must be his treatment plan?",
    "choices": [
      {
        "id": 1,
        "text": "Rosuvastatin + fenofibrate"
      },
      {
        "id": 2,
        "text": "Atorvastatin 80 mg"
      },
      {
        "id": 3,
        "text": "Fenofibrate"
      },
      {
        "id": 4,
        "text": "Rosuvastatin 10 mg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In this <strong>60 yr </strong>old patient with <strong>post-myocardial infarction</strong> (Atherosclerotic cardiovascular disease patient), <strong>high-intensity</strong> <strong>statins</strong> should be given <strong>irrespective of cholesterol levels</strong>. So <strong>atorvastatin 80mg</strong> is the treatment plan in the given case scenario.</p>\n<p>Examples of high-intensity statins include high-dose <strong>atorvastatin 40\u201380 mg/day</strong> and <strong>rosuvastatin 20\u201340 mg/day.</strong></p>\n<p>Note: Fenofibrate is not advocated unless TG is more than 500 mg/dl. It can be administered along with a moderate-intensity statin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a664fd309c9e44d8bec9a2eaae5a64a5x1280x1803.JPEG"
    ]
  },
  {
    "text": "A patient presents with an intense exertional chest pain radiating to the neck along with shortness of breath for 30mins. ECG reveals ST-segment depression. Cardiac troponins are elevated. Which of the following is incorrect regarding the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Aspirin loading dose should be commenced immediately"
      },
      {
        "id": 2,
        "text": "ACC/ AHA guidelines call a P2Y12 inhibitors as a class I recommendation"
      },
      {
        "id": 3,
        "text": "Glycoprotein IIB/IIIA inhibitors are useful adjuncts"
      },
      {
        "id": 4,
        "text": "Fibrinolytic therapy is useful in this condition"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above scenario is suggestive of <strong>NSTEMI</strong>. <strong>Antiplatelet</strong> and <strong>anticoagulation</strong> therapies and coronary intervention are <strong>mainstays</strong> of treatment.</p>\n<p>A distinction in acute coronary syndrome between patients with and without ST-segment elevation at presentation is essential to determine the need for reperfusion therapy. <strong>Fibrinolytic</strong> therapy is <strong>harmful</strong> in acute coronary syndrome without ST-segment elevation, unlike with ST-segment elevation, where acute reperfusion saves lives.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is diagnosed with STEMI on presentation. Coronary angiography showed complete occlusion of the infarct-related artery. Immediate primary PCI with a drug-eluting stent is planned. Which of the following drug-eluting stents will have a relatively higher risk of restenosis and late stent thrombosis?",
    "choices": [
      {
        "id": 1,
        "text": "Zotarolimus"
      },
      {
        "id": 2,
        "text": "Biolimus"
      },
      {
        "id": 3,
        "text": "Everolimus"
      },
      {
        "id": 4,
        "text": "Sirolimus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sirolimus&nbsp;</strong>and paclitaxel are&nbsp;a part of&nbsp;<strong>first-generation</strong> drug-eluting stents that carry a relatively <strong>higher risk</strong> of <strong>restenosis</strong> and late stent thrombosis than second-generation drug-eluting stents.&nbsp;</p>\n<p><strong>Second-generation</strong> drug-eluting stents use newer agents such as <strong>everolimus, biolimus,</strong> and<strong> zotarolimus</strong>. These second-generation drug-eluting stents are more effective with fewer complications like stent thrombosis than first-generation stents.</p>\n<p>An antiproliferative agent is attached to the stent by the use of a thin polymer coating. This antiproliferative drug elutes from the stent over a 1 to 3 month period after implantation<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male patient presents to the emergency department with chest pain for 2 hours. The ECG shows ST-segment depression and cardiac troponins are elevated. The patient has a history of PCI 3 months back. He is given aspirin, clopidogrel, nitrates, and unfractionated heparin and shifted to the coronary care unit. What is the next best course of action?",
    "choices": [
      {
        "id": 1,
        "text": "Continue conservative management and monitoring of cardiac enzymes and ECG"
      },
      {
        "id": 2,
        "text": "Continue conservative management and  plan for delayed revascularization procedure after the patient is discharged"
      },
      {
        "id": 3,
        "text": "Immediate revascularization with thrombolytics"
      },
      {
        "id": 4,
        "text": "Revascularization with PCI"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient described above is categorized as a <strong>high-risk</strong> patient due to his history of PCI 3 months ago. The next best course of action for this patient is immediate&nbsp;<strong>revascularization with PCI</strong>.</p>\n<p>Revascularization with PCI (percutaneous coronary intervention) is <strong>indicated</strong> in high-risk patients who have one or more of the following:</p>\n<ul>\n<li>New ST-segment depression</li>\n<li>Diabetes mellitus</li>\n<li>Renal dysfunction - eGFR &lt;60mL/min per 1.73m<sup>2</sup></li>\n<li>Ejection fraction &lt;40%</li>\n<li>Early postinfarction angina</li>\n<li>PCI within the past 6 months</li>\n<li>Prior CABG</li>\n<li>Refractory angina</li>\n<li>Symptoms of congestive heart failure</li>\n<li>Hemodynamic instability</li>\n<li>Recurrent angina at rest/low-level activity despite treatment</li>\n<li>Elevated troponin T or troponin I</li>\n<li>Sustained VT or VF</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For an acute STEMI patient with cardiogenic shock, what would be the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Intra-aortic balloon pump with PCI"
      },
      {
        "id": 2,
        "text": "Revascularization with PCI"
      },
      {
        "id": 3,
        "text": "Thrombolysis"
      },
      {
        "id": 4,
        "text": "Intra-aortic balloon pump"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The treatment of choice in patients with <strong>acute STEMI with cardiogenic shock</strong> is <strong>revascularization with PCI.</strong></p>\n<p>The 2013 ACCF/AHA guidelines for the treatment of cardiogenic shock in patients with acute MI are:</p>\n<ul>\n<li>Emergency revascularization with PCI or CABG is recommended in suitable patients irrespective of the time delay from MI onset.</li>\n<li>In the absence of contraindications, fibrinolytic therapy should be administered to patients with STEMI and cardiogenic shock who are unsuitable candidates for either PCI or CABG.</li>\n</ul>\n<p>Routine use of Intra-Aortic Balloon Pump counterpulsation (IABP) is not recommended for cardiogenic shock (based on&nbsp;IABP-SHOCK II trial). IABP can be useful for those patients with cardiogenic shock after STEMI who do not quickly stabilize with pharmacological therapy or have mechanical complications (eg, acute mitral regurgitation or rupture of the ventricular septum).</p>\n<p>Alternative left ventricular assist devices for circulatory support may be considered in patients with refractory cardiogenic shock.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old chronic smoker comes with acute epigastric discomfort for the past one hour. ECG shows ST-segment depression. What is the immediate intervention?",
    "choices": [
      {
        "id": 1,
        "text": "Aspirin"
      },
      {
        "id": 2,
        "text": "Thrombolytic therapy"
      },
      {
        "id": 3,
        "text": "IV pantoprazole"
      },
      {
        "id": 4,
        "text": "PCI"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above scenario is suggestive of a non-ST-elevation&nbsp;<strong>acute coronary syndrome&nbsp;</strong>(NSTE-ACS). <strong>Immediate intervention</strong> is the administration of <strong>aspirin</strong>.</p>\n<p><strong>Aspirin</strong> is the first drug given in acute coronary syndromes. An <strong>initial dose of 325 mg</strong> to be chewed and swallowed is given. If oral administration is not feasible, it should be given as a rectal suppository.</p>\n<p>The following protocol must be followed in the management of patients with acute coronary syndrome:</p>\n<ol>\n<li>Stabilization of airway, breathing, and circulation</li>\n<li>Administration of O<sub>2</sub></li>\n<li>Treatment of sustained ventricular arrhythmia rapidly according to ACLS protocols</li>\n<li>Give <strong>aspirin 325 mg</strong></li>\n<li>History and examination, assess cardiac biomarkers</li>\n<li>Give three sublingual nitroglycerin tablets each 5 min apart. Add IV nitroglycerin for the persistence of symptoms.</li>\n<li>Treat left heart failure if present with an after-load reducing agent or loop diuretic</li>\n<li>Give beta-blockers</li>\n<li>Give morphine for the persistence of anxiety and discomfort related to MI</li>\n<li>In patients with STEMI - Reperfusion with PCI or fibrinolysis (if PCI is unavailable within 120 min) followed by antiplatelet and anticoagulant therapy. In patients with NSTEMI - antiplatelet and anticoagulant therapy are indicated.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A previously healthy 58-year-old man is admitted to the hospital because of an acute MI. ECG is shown below. Within several hours, he becomes oliguric and hypotensive. On auscultation, no added sounds were present. What is the most likely reason for this patient being in shock?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral regurgitation"
      },
      {
        "id": 2,
        "text": "Infarction causing septal defect"
      },
      {
        "id": 3,
        "text": "Right ventricular infarction"
      },
      {
        "id": 4,
        "text": "Decreased ejection fraction from the left ventricle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above ECG shows ST-segment elevation in leads II, III, and aVF suggestive of an <strong>inferior-wall MI</strong>. In the given scenario, the most likely reason for the patient to have shock is <strong>right ventricular infarction.</strong></p>\n<p>The diagnosis of right ventricular MI is suspected in patients with inferior-wall MI, <strong>clear lung fields&nbsp;</strong>(no added sounds on auscultation), and <strong>shock</strong>. It can also be confirmed by the use of right-sided electrocardiogram (ECG) leads.</p>\n<p>In patients with presumed right ventricular shock, intravenous (IV) fluid replacement is indicated if jugular (central) venous pressure is not elevated.</p>\n<p>Options A, B, and D: No added sounds on auscultation clearly rule out mitral regurgitation, septal defect (pansystolic murmur is heard), and decreased ejection fraction from the left ventricle (leads to pulmonary congestion and added sounds), as the cause of shock in this patient.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0f48e03fa1a844e4bac85051716441a2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented with sudden circulatory collapse and engorged neck veins 3 days post-MI. A bedside transthoracic echocardiogram revealed the following. Which of the following is false regarding the cause of this patient's findings?",
    "choices": [
      {
        "id": 1,
        "text": "It usually results in immediate death"
      },
      {
        "id": 2,
        "text": "Immediate pericardiocentesis should be done"
      },
      {
        "id": 3,
        "text": "It usually involves inferior wall"
      },
      {
        "id": 4,
        "text": "Definitive management is surgical repair"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The echocardiogram shows pericardial effusion with cardiac tamponade (<strong>swinging</strong> <strong>heart sign).</strong> The likely diagnosis in the above scenario is&nbsp;<strong>myocardial rupture</strong> post-MI.&nbsp;It usually occurs 3-5 days postinfarction and commonly involves the <strong>anterior</strong> <strong>wall</strong>.</p>\n<p>This condition usually results in immediate death. It is common in <strong>older women.&nbsp;</strong></p>\n<p>Incomplete or gradual rupture may be sealed off by the pericardium creating a pseudoaneurysm.</p>\n<p>Immediate <strong>pericardiocentesis</strong> should be done to relieve the symptoms of shock due to tamponade. Early <strong>surgical</strong> <strong>repair</strong> is the definitive treatment.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/76f89c9e83e44831b877fd857bc82bb2.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about Dressler syndrome is false?",
    "choices": [
      {
        "id": 1,
        "text": "It presents as pericarditis"
      },
      {
        "id": 2,
        "text": "It is an autoimmune phenomenon"
      },
      {
        "id": 3,
        "text": "First line therapy consists of aspirin"
      },
      {
        "id": 4,
        "text": "It occurs 2-7 days after MI"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Dressler syndrome commonly occurs<strong> 1-12 weeks</strong> after MI, not 2-7 days.&nbsp;However, it can recur over months.</p>\n<p>Dressler syndrome is a post-myocardial infarction syndrome that presents as <strong>pleuritic chest pain</strong>, fever, and sometimes a pleuritic rub and effusion. The ECG findings include <strong>PR segment depression</strong> or <strong>ST-segment elevation</strong>. It is an <strong>autoimmune</strong> phenomenon occurring due to immune-complex deposition in the pericardium and lung pleura.&nbsp;</p>\n<p>The first-line therapy consists of<strong>&nbsp;aspirin.</strong></p>\n<p>Note: NSAIDs and corticosteroids impair the infarct healing and predispose the patients to myocardial rupture. Therefore these drugs must be avoided in the early postinfarction period.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Left ventriculography with contrast was performed in a post-MI patient and is shown below. Infarct involving which portion of the myocardium is most likely to cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Subendocardial"
      },
      {
        "id": 2,
        "text": "Anterior transmural"
      },
      {
        "id": 3,
        "text": "Posterior transmural"
      },
      {
        "id": 4,
        "text": "Inferior wall"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image showing left ventriculography with contrast is suggestive of<strong>&nbsp;</strong>a<strong> left ventricular aneurysm. Anterior transmural infarcts</strong> are involved in causing aneurysms as a post-MI complication.</p>\n<p>Patients with anterior transmural infarcts are at the greatest risk for:</p>\n<ul>\n<li>Free-wall rupture</li>\n<li>Expansion</li>\n<li>Mural thrombi</li>\n<li>Aneurysm</li>\n</ul>\n<p>Posterior transmural infarcts are more likely to be complicated by:</p>\n<ul>\n<li>Conduction blocks</li>\n<li>Right ventricular involvement, or both</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43d06faf636741cc99245724bfdf2c06.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man started experiencing chest pain and was rushed to a primary care facility at 10 AM. A diagnosis of acute severe MI was made. Due to the unavailability of PCI, he was taken to a tertiary center by 10:30 AM. By what time should PCI be performed in this patient at the latest?",
    "choices": [
      {
        "id": 1,
        "text": "11 AM"
      },
      {
        "id": 2,
        "text": "12 PM"
      },
      {
        "id": 3,
        "text": "11:30 AM"
      },
      {
        "id": 4,
        "text": "12:30 PM"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>door-to-balloon time</strong> for a patient arriving in a hospital that is <strong>not equipped </strong>to perform a PCI and is then transported to a hospital where PCI can be performed is&nbsp;<strong>120 min.</strong></p>\n<p>The door-to-balloon time is the time <strong>interval</strong> between the <strong>first medical contact</strong> and <strong>PCI</strong>.</p>\n<p>It is <strong>90 min or less</strong> for a patient arriving in a hospital<strong> equipped </strong>with PCI&nbsp;(ACC/AHA guidelines and MoHFW, India guidelines).<strong>&nbsp;</strong></p>\n<p>In patients who cannot receive PCI within 120 min of first medical contact, fibrinolysis is given. Fibrinolysis is only considered if the patient presents within 12 hours of symptom onset.</p>\n<p>Note: The European society of cardiology (ESC) recommends 60 min target time for&nbsp;patients presenting in a PCI-centre and 90 min maximum&nbsp;target time for PCI-mediated reperfusion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following defines PCI related MI ?",
    "choices": [
      {
        "id": 1,
        "text": "Elevation of cTn > 5 times normal in the absence of any other features"
      },
      {
        "id": 2,
        "text": "Elevation of cTn > 5 times normal in the presence of symptoms of MI, ECG changes, angiographic findings or imaging abnormality"
      },
      {
        "id": 3,
        "text": "Elevation of cTn > 3 times normal in the absence of any other features"
      },
      {
        "id": 4,
        "text": "Elevation of cTn > 3 times normal in the presence of symptoms of MI, ECG changes, angiographic findings or imaging abnormality"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>PCI related MI</strong> is defined as elevation of <strong>cTn &gt; 5 times </strong>normal in the presence of symptoms of MI, ECG changes, angiographic findings or imaging abnormality.</p>\n<p>The imaging abnormality could be a new loss of viable myocardium or new regional wall motion abnormality. If the baseline cTn values are elevated but stable or falling, a rise in cTn &gt;20 % defined PCI related MI.</p>\n<p><strong>CABG related MI</strong> is defined as elevation of <strong>cTn &gt; 10 times</strong> the normal baseline values in the presence of new pathologic Q waves, angiographic findings or imaging abnormality.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes to the hospital with chest pain for the last 3 hours. Vitals are stable. ECG revealed ST depression and T wave inversion in anterior chest leads. Which of the following would be the most appropriate line of management in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "PCI"
      },
      {
        "id": 2,
        "text": "Thrombolysis with alteplase"
      },
      {
        "id": 3,
        "text": "Prophylaxis for arrhythmia"
      },
      {
        "id": 4,
        "text": "Aspirin with heparin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Based on the given clinical scenario of a patient presenting with<strong> sudden onset of chest pain,</strong> with ECG findings of<strong> ST depression</strong> in the anterior chest leads and<strong> T wave inversion,</strong> the most likely diagnosis is a <strong>non-ST-segment elevation-acute coronary syndrome (NSTE-ACS).</strong>\u00a0 The most appropriate line of management in this patient would be to administer<strong> aspirin with heparin.</strong></p>\n<p>Percutaneous coronary intervention is indicated after coronary angiography in high-risk patients.</p>\n<p>Fibrinolytic therapy is not indicated in patients with NSTE-ACS.</p>\n<p>Arrhythmia prophylaxis is generally not routinely recommended in all patients with NSTE-ACS.</p>\n<p><strong>Acute coronary syndrome</strong> is classified into 2 groups:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">ST-segment Elevation Myocardial Infarction <strong>(STEMI)</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>NSTE-ACS</strong></li>\n</ul>\n<p>NSTE-ACS further includes:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>NSTEMI</strong> (myocyte necrosis present and cardiac troponins elevated)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Unstable Angina</strong> (myocyte necrosis absent and cardiac troponins not elevated)</li>\n</ul>\n<p>The diagnosis of NSTE-ACS is based on the following:</p>\n<p><strong>Severe chest discomfort</strong> with at least <strong>one of 3</strong> features:</p>\n<ul>\n<li>Occurring at rest or minimal exertion and lasting for more than 10 minutes</li>\n<li>Recent onset</li>\n<li>Crescendo pattern</li>\n</ul>\n<p><strong>ECG</strong> showing:</p>\n<ul>\n<li aria-level=\"1\"><strong>ST segment depression</strong></li>\n<li aria-level=\"1\"><strong>T wave inversion</strong></li>\n</ul>\n<p>\u00a0</p>\n<p><strong>Elevated cardiac troponins</strong> in case of NSTEMI.</p>\n<p>Management of NSTE-ACS:</p>\n<p>To provide relief of pain and discomfort, initial treatment includes bed rest, <strong>nitrates</strong>, <strong>beta blockers,</strong> and inhaled <strong>oxygen</strong> (only if arterial O2 saturation &lt;90%).</p>\n<p><strong>Antithrombotic therapy</strong> consisting of antiplatelet and anticoagulant drugs:</p>\n<ul>\n<li><strong>Dual antiplatelet therapy</strong> (DAPT): Aspirin (162-325 mg) AND one ADP receptor inhibitor (Ticagrelor, clopidogrel or prasugrel)</li>\n<li><strong>Anticoagulation:</strong> Enoxaparin, unfractionated heparin, fondaparinux or bivalirudin</li>\n<li>An early invasive strategy including <strong>diagnostic coronary angiography</strong> (within 2\u201372 hours of presentation) followed by <strong>revascularization (</strong>percutaneous coronary intervention/ coronary artery bypass grafting) is indicated for stabilized patients who are at high risk of coronary events (Based on TIMI, GRACE or HEART score).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '065 Ischemic Heart Disease - Complications And Management';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>