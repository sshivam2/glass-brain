<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03 Instruments & Sutures - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">36</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Identify the instrument:",
    "choices": [
      {
        "id": 1,
        "text": "Allis tissue forceps"
      },
      {
        "id": 2,
        "text": "Babcock\u2019s forceps"
      },
      {
        "id": 3,
        "text": "Lane\u2019s tissue holding forceps"
      },
      {
        "id": 4,
        "text": "Kocher\u2019s hemostatic forceps"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D:<strong> Kocher&rsquo;s hemostatic forceps </strong>- It is identified by the opposing tooth on the tip and serrations in the distal blades.</p>\n<p>It is used to&nbsp;hold pedicles, tough structures, and cut ends of muscles.&nbsp;It is also used to hold ribs during rib dissection, gauze for blunt dissection, and resected bowel.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0f2fff8c048f46fa94fee746db61a3e7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71deb6f615ed4d479708ea63da8f806dx1280x916.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08d025764d3b4b6bac14ccb9cfacf690x1280x1133.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8cac60590eb432580a6f103b9cfe5bbx1280x1431.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea1901d9fb3f4463859b483a274b3b03x1280x1074.JPEG"
    ]
  },
  {
    "text": "For which of the following would you use the instrument shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "1,2 and 4"
      },
      {
        "id": 2,
        "text": "1 and 3"
      },
      {
        "id": 3,
        "text": "3,4 and 5"
      },
      {
        "id": 4,
        "text": "1,2 and 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cord holding forceps\u00a0</strong>are typically used to hold spermatic cords.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/64625e67f909490381bf61bc53cbe76c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20d134ff4a37440e9d8a0eb2d18a8c0cx1280x1028.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8485b38d33644f2ba10d73c9c7129b83x1279x1233.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f65315b73bb947a9a8ce9fb83fd8d90dx1200x964.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ffe2efe15dbf4151abeaa344c5e44df2x1279x843.JPEG"
    ]
  },
  {
    "text": "You notice your surgery resident use the given instrument to remove gall stones. Identify the instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Sponge holding forceps"
      },
      {
        "id": 2,
        "text": "Desjardin\u2019s choledocholithotomy forceps"
      },
      {
        "id": 3,
        "text": "Blake's gall stone forceps"
      },
      {
        "id": 4,
        "text": "Tischler forceps"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above instrument is&nbsp;<strong>Desjardin&rsquo;s choledocholithotomy forceps </strong>and is used for <strong>bile duct stone removal.&nbsp;</strong>It may also be used during the removal of <strong>kidney, ureteric, or bladder stones.</strong></p>\n<p>This is a long and slender instrument. There are finger bows but no catch. The shaft is curved. The blades are small, without serrations, and fenestrated centrally.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d2e43ba701a34b42a439bee060599ab0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "For what purpose would you use the instrument shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "To carry out blunt dissection"
      },
      {
        "id": 2,
        "text": "To clamp bleeding vessels"
      },
      {
        "id": 3,
        "text": "To hold structures like bowel"
      },
      {
        "id": 4,
        "text": "To hold tough tissue like skin and fascia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image is of&nbsp;<strong>Lister&rsquo;s sinus forceps</strong> which are used for <strong>blunt dissection.</strong></p>\n<p>It is used during <strong>Hilton's method</strong> of <strong>abscess drainage</strong> to break the bacterial loculi.</p>\n<p>It is also used for inserting or removing <strong>packing</strong> in the sinus cavity.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3499cc82823a459ca12279d446635be7.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0fb84b302bc4fff8b6b16a6df12a3d2x1280x948.JPEG"
    ]
  },
  {
    "text": "Identify the instrument:",
    "choices": [
      {
        "id": 1,
        "text": "Doyen\u2019s retractor"
      },
      {
        "id": 2,
        "text": "Doyen\u2019s mouth gag"
      },
      {
        "id": 3,
        "text": "Doyen\u2019s intestinal occlusion clamp"
      },
      {
        "id": 4,
        "text": "Joll\u2019s thyroid retractor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: <strong>Joll&rsquo;s thyroid retractor</strong> is a self-retaining retractor used in thyroid surgeries to <strong>retract skin</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e8ef45067ae148b8b9862b945075958c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9bd7d76b4d384257ac05e32e13395f2ex1280x970.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c144c2500ebc4493b6c3b53218b4047cx1280x1116.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/88b11d14187a4b3e88bcbd54359d0044x1280x1089.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e7458059056e4497b62139c0f44e64d2x1280x1116.JPEG"
    ]
  },
  {
    "text": "Identify the instrument given in the image below:",
    "choices": [
      {
        "id": 1,
        "text": "Deaver's retractor"
      },
      {
        "id": 2,
        "text": "Morris retractor"
      },
      {
        "id": 3,
        "text": "Czerney's retractor"
      },
      {
        "id": 4,
        "text": "Double hook retractor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: <strong>Double-hook retractor</strong> consists of two hooks with a handle. It is used in excision of swellings like lipoma, neurofibroma and cyst. It is also used to hold the skin flaps when raising them.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37a891ac9a3c4bc8899c0d5e1d81d8f4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2720c4ab8ed5488fb6d7ba2c4802bb79x1279x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/964a218af3e34d0596e6ecee4817eea9x1279x1022.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3357503798604ab7befeaef118b05759x1279x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62b901e6491242d9a0d47d41df2f688dx1279x859.JPEG"
    ]
  },
  {
    "text": "Which of the following instruments would be best suited to retract the liver out of the field of operation while performing an open cholecystectomy?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Czerny's retractor</strong> -&nbsp;This is a double-ended retractor used to <strong>retract wound edges</strong> for intermediate-type procedures. One end has a blade with a lip which helps to retract without the edge slipping. The other end has two prongs and helps to retract the ends of an incision.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6ce0c678d34f462698fb9c6a25799011.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17c166338071480b822403726b8774adx1279x1022.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c63273e151a2491d9eb81fb25fd02c71x1279x1116.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/14edbbd2fd764e13a28f2a6f1472a6ffx1279x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/03ea82932e434fbb9dda901ea7c24258x1280x1065.JPEG"
    ]
  },
  {
    "text": "During thyroidectomy, the given instrument was used to retract the strap muscles. Identify the instrument:",
    "choices": [
      {
        "id": 1,
        "text": "Langenbeck retractor"
      },
      {
        "id": 2,
        "text": "Dyball retractor"
      },
      {
        "id": 3,
        "text": "Travers retractor"
      },
      {
        "id": 4,
        "text": "Goligher retractor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D<strong>: Travers retractor </strong>is a&nbsp;<strong>self-retaining</strong> retractor used for intermediate-type operations, such as:</p>\n<ul>\n<li>Herniorrhaphy</li>\n<li>Groin dissection for varicose veins</li>\n<li>Femoral embolectomy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eb4b7251177e41dc8c544adb100b2c98.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b1915d486b404f3caceae3736c5b193ex1280x1285.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/332f038f7ea543acbf98542e384fbdb9x1280x1536.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/16e75cd13bc14796a13d9a35a1ee362fx1280x859.JPEG"
    ]
  },
  {
    "text": "Identify the given instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Wedge osteotome"
      },
      {
        "id": 2,
        "text": "Kocher\u2019s thyroid dissector"
      },
      {
        "id": 3,
        "text": "Periosteal elevator"
      },
      {
        "id": 4,
        "text": "Uterine curette"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>Kocher&rsquo;s thyroid dissector</strong> which is used during a thyroidectomy to<strong> dissect </strong>the<strong> upper pole </strong>of the thyroid.</p>\n<p>The instrument is blunt and therefore damage to the superior thyroid artery or external laryngeal nerve is unlikely.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/967f9ef2df634de68b00c378a8d0b1d1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the size of the given blade used for incision and drainage of a superficial abscess?",
    "choices": [
      {
        "id": 1,
        "text": "10"
      },
      {
        "id": 2,
        "text": "11"
      },
      {
        "id": 3,
        "text": "22"
      },
      {
        "id": 4,
        "text": "15"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The size of the surgical blade shown is the <strong>11-size blade</strong> (stab knife) that has a <strong>triangular shape</strong> with an <strong>oblique edge</strong> and a<strong> sharp-pointed tip</strong>.</p>\n<p>Uses:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Incision and drainage <strong>(I &amp; D)</strong> of an abscess</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Insertion</strong> of<strong> drains</strong> and arteriotomy.</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: The <strong>10-size blade</strong> is used for <strong>skin incisions</strong>. It has a <strong>curved cutting edge</strong> that <strong>tapers</strong> to a pointed <strong>tip</strong>.</p>\n<p>Option C: The <strong>22-size blade</strong> is often used for <strong>abdominal incisions</strong>. It has a <strong>flat</strong>, <strong>unsharpened</strong> back edge and a <strong>curved front cutting edge</strong>.</p>\n<p>Option D: The <strong>15-size blade</strong>&nbsp;is used for<strong> minor surgical procedures</strong> (lipoma excision) and<strong> precise skin incisions</strong>. It is a <strong>smaller</strong> <strong>blade</strong> with a small cutting edge.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9442fe6b90114f7ea5a67999c7d8af49.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c73199ec3b44fe9aa18a905f79a1b53x1280x1666.JPEG"
    ]
  },
  {
    "text": "The type of knot seen in the image is:",
    "choices": [
      {
        "id": 1,
        "text": "Half hitch knot"
      },
      {
        "id": 2,
        "text": "Reef knot"
      },
      {
        "id": 3,
        "text": "Surgeon\u2019s knot"
      },
      {
        "id": 4,
        "text": "Crossed half hitch knot"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the suture material <strong>exiting</strong> the <strong>knot</strong> is on the <strong>same side</strong> as the <strong>entry</strong> i.e no cross-over is seen. This is seen in a <strong>reef knot</strong>.</p>\n<p>A <strong>knot</strong> is a fastening made of threads intertwined together or on themselves. Each knot consists of- 2 half-hitches placed in sequential throws. <strong>Squaring</strong> refers to tightening the knot/half-hitch in a manner that the <strong>threads</strong> lay flat due to the <strong>alternating direction </strong>of <strong>half-hitches</strong> in adjacent layers.</p>\n<p>Types of knots:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Granny</strong> knot: <strong>half-hitch</strong> over a <strong>half-hitch</strong> in the <strong>same direction</strong>. It has better-holding power than half-hitch</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Reef</strong> knot: <strong>half-hitch</strong> followed by a <strong>second half-hitch</strong> after <strong>squaring</strong>.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Triple throw</strong> knot: <strong>Reef</strong> knot with <strong>another</strong> <strong>half-hitch knot</strong> for added security. Knots made with prolene sutures require 6-8 throws to <strong>prevent</strong> <strong>slippage</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Surgeon&rsquo;s </strong>knot: Modification of the reef knot with <strong>two half-hitches</strong> in the<strong> first layer</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Slip</strong> knot: Modification of either <strong>granny/reef knot</strong> formed when <strong>one end</strong> of the thread is <strong>kept taut </strong>while tightening the knot.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c763aa5d8441400098df58ae1ceea481.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f55ea6d1829494eace586d4ed0f7d07x1280x1883.JPEG"
    ]
  },
  {
    "text": "A man presents to the emergency with a clean lacerated wound on his forearm. You use the given suturing technique to close his wound. Which of the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "This technique has the least cut through rate"
      },
      {
        "id": 2,
        "text": "The wound edges should be everted"
      },
      {
        "id": 3,
        "text": "Interrupted sutures are used to approximate the wound"
      },
      {
        "id": 4,
        "text": "After the first bite, the needle should emerge at the of center the wound"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Subcuticular sutures:</strong> Small bites of the subcuticular tissues are taken on alternate sites of the wound and then gently pulled together thus approximating the wound edges without the risk of the cross-hatched markings of interrupted sutures.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c2f40398b32e48c2b29a91b2813f3c96.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1354c5738ae54d7b805dad046f5d18fcx1280x1238.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04b54f8e9bbb4e528cc4e5f1dfe2cefex1280x1143.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb548a84dabb498499d899bf9a92acedx1200x1196.JPEG"
    ]
  },
  {
    "text": "During an intra-oral procedure, the resident uses the given suture material to place sutures on the soft palate. What is this suture material called?",
    "choices": [
      {
        "id": 1,
        "text": "Vicryl"
      },
      {
        "id": 2,
        "text": "Silk"
      },
      {
        "id": 3,
        "text": "Plain catgut"
      },
      {
        "id": 4,
        "text": "Prolene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Prolene</strong> is a <strong>blue</strong> coloured, monofilament, <strong>non-absorbable</strong> suture.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eb944a891845478f855eb13e5d120baa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d33be97449342c5a89692d99693fd84x508x705.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cc517a4a90ed425e93d5cb5ed3baf87ex800x556.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7eae3ce79c1246208e2e2af77f1c530ex1208x1042.PNG"
    ]
  },
  {
    "text": "Which of the following is true about chromic catgut?",
    "choices": [
      {
        "id": 1,
        "text": "It is made from cat gut"
      },
      {
        "id": 2,
        "text": "It is made from rabbit gut"
      },
      {
        "id": 3,
        "text": "It is absorbed by enzymatic degradation and macrophage phagocytosis"
      },
      {
        "id": 4,
        "text": "It is tanned with nickel salts to improve handling and to resist degradation in tissue"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Chromic catgut</strong> is absorbed through <strong>macrophage </strong><strong>phagocytosis</strong> and <strong>enzymatic</strong> <strong>degradation</strong> within <strong>90 days.</strong></p>\n<p>It is made from<strong> collagen</strong> derived from healthy sheep or cattle. It is then tanned with <strong>chromium salts</strong> to improve handling and resist degradation in tissue.</p>\n<p>The <strong>tensile strength</strong> lasts for<strong> 21-28 days</strong>. It has a moderate tissue reaction as compared to plain catgut, which has a high tissue reactivity.</p>\n<p>It is used to <strong>ligate superficial vessels,</strong> <strong>suture subcutaneous tissues</strong>, and is used for <strong>stomas</strong> and other tissues that heal rapidly. It is not used in tissues that heal slowly and require prolonged support.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man presented to the ER with a facial injury following a fight with his brother. On examination, there is a 2 cm linear lacerated wound over his right cheek. The best method of management would be:",
    "choices": [
      {
        "id": 1,
        "text": "Simple suture with poliglecaprone"
      },
      {
        "id": 2,
        "text": "Subcuticular suture with poliglecaprone"
      },
      {
        "id": 3,
        "text": "Simple suture with polypropylene"
      },
      {
        "id": 4,
        "text": "Subcuticular suture with polypropylene"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The best method for the management of <strong>face laceration</strong> is a <strong>subcuticular suture </strong>with<strong> poliglecaprone (monocryl).</strong></p>\n<p>Subcuticular sutures are used in the areas of the skin where the cosmetic appearance is important. The suture material is taken from the subcuticular layer and the edges are gently pulled together. The wound heals with <strong>minimal scarring</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old male patient presented to the emergency department with an injured femoral artery following a stab injury to the right thigh. Which of the following suture materials would be ideal for the repair of the artery?",
    "choices": [
      {
        "id": 1,
        "text": "Poliglecaprone"
      },
      {
        "id": 2,
        "text": "Polypropylene"
      },
      {
        "id": 3,
        "text": "Polyglactin"
      },
      {
        "id": 4,
        "text": "Nylon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Polypropylene</strong> (prolene), a <strong>non-absorbable monofilament</strong>, is the ideal suture material&nbsp;used for <strong>vascular anastomoses.</strong></p>\n<p>Vascular anastomosis requires an accurate and watertight closure. A non-absorbable material that provides <strong>tensile strength</strong> for a longer period is best suited.&nbsp;The material should also be <strong>non-braided</strong> to<strong> avoid platelet adherence</strong> to the suture material.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The surgeon requests the given suture material while performing a bladder repair. Which of the following statements is true regarding it?",
    "choices": [
      {
        "id": 1,
        "text": "It is made of polyglycolic acid"
      },
      {
        "id": 2,
        "text": "It is a dyed monofilament"
      },
      {
        "id": 3,
        "text": "Absorption by hydrolysis"
      },
      {
        "id": 4,
        "text": "Complete absorption by 30 days"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image given is of<strong>&nbsp;polyglactin (vicryl). </strong>It is <strong>absorbed</strong> by<strong> hydrolysis.&nbsp;</strong>Complete absorption<strong>&nbsp;</strong>occurs by<strong> 60&ndash;90 days.</strong></p>\n<p>It is a violet,<strong>&nbsp;braided multifilament absorbable</strong> suture.&nbsp;It is a copolymer of lactide and glycolide in a ratio of 90:10, coated with polyglactin and calcium stearate.</p>\n<p class=\"p1\">It is used mostly for gut anastomoses, vascular ligatures, subcuticular wound closures, and ophthalmic surgeries.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/50987e3f8d4e45f09f1d59817f14df0b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "After which procedure will you use the tube shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Choledochotomy"
      },
      {
        "id": 2,
        "text": "Ureterosigmoidostomy"
      },
      {
        "id": 3,
        "text": "Mastectomy"
      },
      {
        "id": 4,
        "text": "Thyroidectomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>It <strong>allows bile to drain</strong> while the sphincter of Oddi is in spasm postoperatively. Once the sphincter relaxes, bile drains normally down the bile duct and into the duodenum.</p>\n<p>Common bile duct T-tubes should<strong> remain in for 10 days</strong>. The 10-day period is required to <strong>minimize</strong> the <strong>risk </strong>of <strong>biliary peritonitis.</strong></p>\n<p>Once the <strong>T-tube cholangiogram</strong> has shown that there is a&nbsp;<strong>free flow of bile</strong> into the duodenum and that there are no retained stones, it is removed. Some surgeons like to <strong>clamp the T-tube prior to removal</strong>. Residual obstruction may be amenable to stone extraction via the T-tube.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9bce32e40c14416494d222cb51697b38.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4bbf7e8614834b76bbbc78dd3ee46612x1280x1604.JPEG"
    ]
  },
  {
    "text": "Which of the following are used to stop esophageal variceal bleed?",
    "choices": [
      {
        "id": 1,
        "text": "A, B, C and D"
      },
      {
        "id": 2,
        "text": "A and B only"
      },
      {
        "id": 3,
        "text": "A, B and C"
      },
      {
        "id": 4,
        "text": "A, B and D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Image B shows the&nbsp;<strong>Minnesota tube.</strong> It has 4 openings - 2 inflation tubes and 2 suction tubes i.e. both gastric and oesophageal aspiration ports are present, which allows the aspiration of both gastric and esophageal contents.</p>\n<p>Images C and D both show an <strong>upper GI endoscope</strong>. They are used to identify the source of bleeding and once identified, <strong>sclerotherapy</strong> and endoscopic variceal <strong>banding</strong> are performed, which have been shown to control hemorrhage effectively.</p>\n<p>Banding has a lower rate of complications. If bleeding does not stop by banding/sclerotherapy, balloon tamponade should be tried.</p>\n<p>The protocol for the management of esophageal varices is given below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/340e054cb5574183a29c0784007b6521.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c4bf5121419410a93c9ec3ab563077ex1280x1881.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/805261f0a8f540949625da8652214b72x1200x1551.JPEG"
    ]
  },
  {
    "text": "A patient has the catheter shown below inserted for draining a large liver abscess. All of the following statements are true except:",
    "choices": [
      {
        "id": 1,
        "text": "It is a self retaining catheter"
      },
      {
        "id": 2,
        "text": "It may be introduced into the urethra to relieve bladder retention"
      },
      {
        "id": 3,
        "text": "It can be placed percutaneously through an existing nephrostomy"
      },
      {
        "id": 4,
        "text": "It is radio-opaque"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A<strong> Malecot catheter </strong>is never introduced per-urethrally.</p>\n<p>It is a&nbsp;<strong>self-retaining catheter</strong> with an&nbsp;<strong>umbrella or flower tip</strong>. It contains <strong>sulfur, </strong>hence is <strong>radio-opaque</strong>. It can be sterilized by boiling.</p>\n<p>Uses:</p>\n<ul>\n<li>Suprapubic cystostomy</li>\n<li>Perinephric abscess</li>\n<li>Pyonephrosis</li>\n<li>Cabot&rsquo;s nephrostomy</li>\n<li>Subphrenic abscess</li>\n<li>Cholecystotomy</li>\n<li>Infected pseudocyst of pancreas</li>\n<li>Amoebic liver abscess</li>\n<li>Gastrostomy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37c291fb66c24d21b7317620ca6b1022.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5bfa2e4e5f4b4feea2b0db9c1844ebb0x1280x1337.JPEG"
    ]
  },
  {
    "text": "You are an intern asked to catheterize a patient using a 16F Foley's catheter. You are unable to catheterize the patient and decide to use a slightly smaller catheter. The ward sister gives you the following four fresh catheters. Which one would you choose instead?",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The&nbsp;<strong>Foley's catheter</strong>&nbsp;having a <strong>green </strong>coloured ring in the ballon port is of size&nbsp;<strong>14 F.&nbsp;</strong>If there is difficulty in catheterization, then a <strong>lower</strong> French number should be preferred.</p>\n<p>The French scale refers to the <strong>external diameter</strong> of the catheter, and <strong>1Fr</strong> is <strong>0.3&nbsp;mm</strong> in diameter.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/04c48242bbf14ac8a4945599cb5cd3ff.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding Foley catheter?",
    "choices": [
      {
        "id": 1,
        "text": "French in foleys catheter refers to external diameter"
      },
      {
        "id": 2,
        "text": "Silicone foleys can be kept for maximum of 2 weeks"
      },
      {
        "id": 3,
        "text": "Three way foleys is used for instrumentation"
      },
      {
        "id": 4,
        "text": "If there is peri-urethral leakage of urine after inserting a foleys, first deflating the balloon is tried"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: If there is peri-urethral leakage of urine after inserting a Foley, <strong>inflating</strong> <strong>the balloon</strong> slightly more or using<strong>&nbsp;</strong>a <strong>larger-sized Foley</strong> are the corrective measures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad0a0be14e414258b749fdf06b7419ebx1280x1080.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/48686adb7ad84b30b82d17fa55cdfa3ex578x496.PNG"
    ]
  },
  {
    "text": "Identify the instrument:",
    "choices": [
      {
        "id": 1,
        "text": "Aneurysm needle"
      },
      {
        "id": 2,
        "text": "Veress needle"
      },
      {
        "id": 3,
        "text": "Tracheal dilator"
      },
      {
        "id": 4,
        "text": "Urethral dilator"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: <strong>Urethral dilator</strong> is used to dilate urethra.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5b24230b6f5b4d23b6306275f5265e43.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2171e8a02a3844cab40738b812a15479x1280x1239.JPEG",
      "https://cdn1.dailyrounds.org/uploads/a54f9e34786f4ceba97b793959d1d564x572x362.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/886a9b42ab154fe7914505e82d707712x1280x797.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/93fed953740e458b8f870a147514c34cx1280x1077.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ff9560b2d94d478ab75a9bebcca6819ex1280x1116.JPEG"
    ]
  },
  {
    "text": "Which of the following is false regarding laparoscopic surgery?",
    "choices": [
      {
        "id": 1,
        "text": "Hasson approach preferred in patients with prior abdominal surgery"
      },
      {
        "id": 2,
        "text": "Monopolar diathermy is more effective in preventing electrosurgical injury"
      },
      {
        "id": 3,
        "text": "Heparin can be used routinely in irrigation fluid during laparoscopic surgery"
      },
      {
        "id": 4,
        "text": "Oral feeding can be initiated after 4-6 hours following an uneventful recovery period"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bipolar diathermy</strong> is more effective than monopolar diathermy in <strong>preventing electrosurgical injury</strong> during laparoscopic surgery.</p>\n<p>Option A: During laparoscopic surgery, an <strong>artificial pneumoperitoneum</strong> is produced by insufflation of the abdominal cavity with <strong>CO2</strong> through a temporary port created by carefully perforating the abdominal wall and peritoneum. As a common practice, <strong>blind insertion</strong> of a <strong>Veress needle</strong> is performed to enter the peritoneal cavity.</p>\n<p>However, in patients with <strong>prior abdominal surgeries</strong>, there is a higher chance of <strong>bowel adhesions</strong> and bowel wall injury during blind insertion of veress needle. Therefore the <strong>Hasson approach</strong> is used for <strong>direct visualization</strong> while establishing the intraperitoneal access.</p>\n<p>Option C: Clot formation may take place during laparoscopic surgery as a result of intraoperative bleeding. The routine use of <strong>5000&ndash;7000 units of heparin</strong> per liter of irrigation fluid helps to <strong>avoid</strong> the formation of <strong>clots</strong>.</p>\n<p>Option D: If there is no contraindication for enteral feeding (e.g bowel resection) and <strong>no sign of ileus</strong> postoperatively, <strong>oral feeding</strong> can be initiated <strong>4-6 hours</strong> after surgery. Initially, a liquid diet is initiated, and if well-tolerated light meals can be initiated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While assisting on laparoscopic cholecystectomy, you notice the given instruments are used to create a pneumoperitoneum. Select the true statement:",
    "choices": [
      {
        "id": 1,
        "text": "Proper placement of the needle can be seen by reaspirating injected saline"
      },
      {
        "id": 2,
        "text": "The insufflation rate is 8-10 liters/min"
      },
      {
        "id": 3,
        "text": "It is the most widely used open technique for creating pneumoperitoneum"
      },
      {
        "id": 4,
        "text": "It involves blind puncture of the peritoneum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The use of the <strong>open technique</strong> for creating a pneumoperitoneum <strong>avoids </strong>the<strong> morbidity</strong> related to a blind puncture.</p>\n<p>To achieve this, a 1 cm vertical or transverse <strong>incision</strong> is made at the level of the umbilicus, <strong>stay sutures</strong> are applied, and the fascia is dissected.\u00a0Free penetration into the abdominal cavity is confirmed by the gentle introduction of a finger.\u00a0A\u00a0<strong>Hasson trocar</strong>, shown below, is inserted and anchored, and pneumoperitoneum is created. This is the Hasson or modified Hasson approach.\u00a0</p>\n<p>This method is <strong>preferred</strong> for patients who have undergone<strong> previous abdominal surgeries</strong> as the small bowel may be adherent to the undersurface of the abdominal wound.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90731b946b434ad28a0bc4eb8ee8ddaf.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59156aeb2a574571bd5bbfec6cb7f19fx1280x964.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/09608edd39bb46d2b5c5409e42818bb0x500x500.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a126c2bae7643e787e5e8609396d4efx1012x834.PNG"
    ]
  },
  {
    "text": "Identify the following instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Rectal temperature probe"
      },
      {
        "id": 2,
        "text": "NAVA catheter"
      },
      {
        "id": 3,
        "text": "Swan-ganz catheter"
      },
      {
        "id": 4,
        "text": "CVP transducer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: A <strong>CVP transducer</strong> is used in critical care settings to monitor the <strong>central venous pressure</strong>. It is connected to a central venous line and a monitor.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b0120f7d770243d2b8fab78420d84c03.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6e3922957540411c9b7e00671a96abeax820x644.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2fa1d31394b84a5b92a10f91929750d8x295x219.PNG"
    ]
  },
  {
    "text": "Identify the instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Ziegler knife"
      },
      {
        "id": 2,
        "text": "McMillan scalpel"
      },
      {
        "id": 3,
        "text": "Ballenger swivel knife"
      },
      {
        "id": 4,
        "text": "Humby's knife"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows<strong>&nbsp;</strong>a <strong>Humby's knife.</strong></p>\n<p>This instrument is used to harvest a <strong>split skin graft</strong>. The average thickness of the graft obtained from a Humby's knife is <strong>0.3 mm.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/377a941bd9d94cbf9e5dc56f1532078b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b0e0d53c8f44fb0ac8d2b63655a407fx720x668.GIF"
    ]
  },
  {
    "text": "Which mode does the following waveform of cautery represent?",
    "choices": [
      {
        "id": 1,
        "text": "Fulguration"
      },
      {
        "id": 2,
        "text": "Cutting"
      },
      {
        "id": 3,
        "text": "Coagulation"
      },
      {
        "id": 4,
        "text": "Blend"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cutting</strong> is a mode of diathermy/electrosurgery.&nbsp;The cut current is a <strong>low voltage</strong>,&nbsp;<strong>continuous waveform</strong>.&nbsp;Cutting occurs when sufficient heat is applied to the tissue to cause cell water to explode into steam.</p>\n<p><strong>Coagulation </strong>is<strong>&nbsp;</strong>the <strong>sealing</strong> of blood vessels. In coagulation, a heating effect leads to cell death by<strong> dehydration </strong>and<strong> protein denaturation</strong>.</p>\n<p><strong>Blend</strong> is the combination of <strong>cutting and coagulation.</strong></p>\n<p><strong>Fulguration</strong> refers to <strong>destructive coagulation </strong>of tissues with <strong>charring.&nbsp;</strong>The diathermy matching is set to coagulation and a higher effective voltage is used to make larger sparks jump an air gap thus fulgurating the tissues.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a936a5f9ea1e4e4f9faaad85558b46db.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cb1acae0aaa4ea5b17fc2d53fdaff74x1280x1559.JPEG"
    ]
  },
  {
    "text": "Identify the following instrument?",
    "choices": [
      {
        "id": 1,
        "text": "Unipolar cautery"
      },
      {
        "id": 2,
        "text": "Bipolar cautery"
      },
      {
        "id": 3,
        "text": "Harmonic scalpel"
      },
      {
        "id": 4,
        "text": "Ligasure"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: LigaSure vessel sealing system (shown below) is a <strong>bipolar apparatus</strong> for sealing vascular tissue. It applies a <strong>high coaptive pressure</strong> during the generation of tissue temperature under 1000&deg;C, <strong>hydrogen cross-links</strong> are first ruptured and then renatured, resulting in a vascular seal that has <strong>high tensile strength</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/60fc29a16f1d4dfdb504b26ed5a03526.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/654a4e1b00464eec885a99eaf02876acx720x827.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/90d35681b8114a99b2a5a0ede9a998f9x512x200.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/74ed992a61ef498a8309022346b666e6x210x151.PNG"
    ]
  },
  {
    "text": "Which of the following is the principle behind the wound-healing procedure shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Negative pressure wound therapy"
      },
      {
        "id": 2,
        "text": "Positive pressure wound therapy"
      },
      {
        "id": 3,
        "text": "Foam therapy"
      },
      {
        "id": 4,
        "text": "Sponge therapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>negative pressure wound therapy</strong> using a vacuum-assisted closure <strong>(VAC)</strong> device to promote healing in <strong>chronic</strong> wounds.</p>\n<p>Principle: An <strong>intermittent</strong> negative pressure of <strong>-125 mmHg</strong> hastens debridement and formation of granulation tissue in chronic wounds.</p>\n<p>Indications: <strong>Chronic wounds</strong> (such as diabetic foot ulcers, <strong>stage III and IV pressure ulcers</strong>),&nbsp;traumatic wounds, flaps and grafts, and dehisced incisions.</p>\n<p>Contraindications:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Exposed vital structures</strong> (organs, blood vessels, or vascular grafts)&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Preexisting infection&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Inadequate</strong> debridement of <strong>devitalized</strong> soft tissue or bone increases the risk of infection.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The presence of malignancy<strong> (Marjolin&rsquo;s ulcer)</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">An allergic reaction towards the adhesive used to maintain the vacuum seal.</li>\n</ol>\n<p>Though not an absolute contraindication, there is <strong>no appreciable benefit</strong> for ischemic wounds.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/343819643f414ecdb0ef4a522676ff6d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following drain is placed after mastectomy. Identify the type of drain.",
    "choices": [
      {
        "id": 1,
        "text": "Open"
      },
      {
        "id": 2,
        "text": "Closed"
      },
      {
        "id": 3,
        "text": "Semi open"
      },
      {
        "id": 4,
        "text": "Semi closed"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>Romo Vac drain</strong>, depicted in the image, is a <strong>closed type</strong> of drain commonly used after <strong>mastectomy</strong>.</p>\n<p><strong>Drains</strong> are placed at surgical sites to freely collect the air or fluids that may accumulate. This <strong>enhances wound healing</strong> by preventing the formation of unnecessary cavities. Drains are prophylactic in elective surgeries and therapeutic in emergency surgeries. Drains can be -</p>\n<ul>\n<li><strong>Open</strong> - They are based on the principle of <strong>gravity&nbsp;</strong></li>\n<li><strong>Semi-open</strong> - Their action is based on <strong>capillary effect</strong></li>\n<li><strong>Closed</strong> - They carry out their actions through <strong>suction</strong></li>\n</ul>\n<p>Suction drains are commonly used in chest, <strong>breast</strong>, abdominal, thyroid, and plastic surgeries. They remove intraperitoneal secretions, anastomotic leaks, and blood from hemorrhage at the surgical site.&nbsp;<strong>Romo Vac drain&nbsp;</strong>is a <strong>negative suction drain closed</strong> drain kept in the subcutaneous tissue. Romo Vac drain is indicated in modified radical mastectomy, subcutaneous swelling excision, and amputations.&nbsp;</p>\n<p>Special types of drains:</p>\n<ul>\n<li><strong>Chest drains</strong> are connected to an underwater seal to aid the exit of air from the pleural cavity. They are used in pneumothorax, pleural effusion, and hemothorax.&nbsp;</li>\n<li>After surgical exploration of the bile duct, the sphincter of Oddi goes into spasm. To facilitate drainage of bile, a <strong>T tube</strong> may be used.&nbsp;</li>\n</ul>\n<p>Drain insertion site care:&nbsp;The site of insertion of the drain is kept clean by drying and patting the drain insertion site with a clean towel after bath. The dressing is changed daily with folded gauze pieces placed below and above the drain site.&nbsp;</p>\n<p>Removal of drains: The catheter at the site is milked for residual collections. It is then clamped and the suture holding the catheter is cut. The tube is then gently pulled out and any clots at the perforation end are removed. The time of removal of drains for various conditions is as given below.&nbsp;</p>\n<ul>\n<li>Drains used in surgeries like <strong>thyroidectomy</strong> are usually removed within <strong>24 hours</strong>. Their main purpose is to cover postoperative bleeding.&nbsp;</li>\n<li>In a <strong>mastectomy</strong>, a drain is placed for <strong>5 days</strong> to collect serous collections.</li>\n<li>Drains used to cover the <strong>colorectal anastomoses</strong> are placed for <strong>5-7 days.</strong></li>\n<li>Common bile duct<strong> T-tube drains</strong> are usually placed for<strong> 10 days.</strong></li>\n<li>Drains for infections are removed when the infection subsides or when the content of the drain is minimal.</li>\n</ul>\n<p>After the drain is removed, a folded gauze is placed over the drain insertion area.&nbsp;The dressing can be removed after 24 hours. The patient may be given an antibiotic ointment to apply over the area for a week.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5f28c703283a4495bf02b228d4e68164.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The instrument given in the image is:",
    "choices": [
      {
        "id": 1,
        "text": "Hemovac"
      },
      {
        "id": 2,
        "text": "Jackson-Pratt drain"
      },
      {
        "id": 3,
        "text": "Minivac"
      },
      {
        "id": 4,
        "text": "Corrugated drain"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A: <strong>Hemovac</strong> is also a <strong>closed</strong> <strong>type</strong> of suction drain which can typically handle <strong>larger amounts</strong> of fluid than the JP drain.</p>\n<p>Option C: <strong>Minivac</strong> is a <strong>closed wound drainage</strong> system under <strong>negative pressure</strong> used in<strong> minor surgeries.</strong></p>\n<p>Option D: <strong>Corrugated drain</strong> is an <strong>open</strong> <strong>drainage</strong> system to <strong>remove</strong> excess <strong>fluid</strong> from the <strong>operated</strong> <strong>site</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/210266563a904215911189525e7a5788.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6178bee5c9a44efc86e4b6f359c6c1fdx1280x1565.JPEG"
    ]
  },
  {
    "text": "Match the following:",
    "choices": [
      {
        "id": 1,
        "text": "1-D, 2-C, 3-A, 4-B"
      },
      {
        "id": 2,
        "text": "1-B, 2-C, 3-A, 4-D"
      },
      {
        "id": 3,
        "text": "1-D, 2-A, 3-C, 4-B"
      },
      {
        "id": 4,
        "text": "1-B, 2-A, 3-C, 4-D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>1-B, 2-C, 3-A, 4-D is the correct option.</p>\n<p><strong>Urine bags</strong> are used for the <strong>collection of urine</strong>. They are usually attached to a <strong>Foley catheter</strong> placed to drain the bladder.</p>\n<p>An <strong>underwater seal bag </strong>is used for the <strong>collection of</strong> <strong>fluid</strong> from the <strong>thoracic cavity</strong>. It acts as a <strong>one-way valve</strong>. This system allows air to leave the pleural cavity, but it cannot be drawn back in by the negative pressure that is created in the intrathoracic cavity.</p>\n<p><strong>Nasogastric tube</strong>/Ryle&rsquo;s tube is used for nasogastric feeding/stomach wash/aspiration.</p>\n<p>A<strong> metallic suction cannula</strong> is used&nbsp;to clear the operative field by <strong>suctioning</strong> secretions, blood, and fluid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/71e7be6b8b70405b9d9d7dedb6a2bda7.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The instrument shown in the image is used for screening a 50-year-old patient with a family history of rectal cancer. Till which structure can this instrument visualize?",
    "choices": [
      {
        "id": 1,
        "text": "Anal canal"
      },
      {
        "id": 2,
        "text": "Sigmoid colon"
      },
      {
        "id": 3,
        "text": "Splenic flexure"
      },
      {
        "id": 4,
        "text": "Teminal ileum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option D<strong>: Colonoscopes</strong> measure <strong>100 to 160 cm </strong>in length and are capable of examining the <strong>entire colon and terminal ileum</strong>. Complete oral bowel preparation is necessary for colonoscopy. Sedation is required due to the duration and discomfort of the procedure.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a6a12582fe55455ebdf4509b7ecf5f86.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/2592b9601a514bda999fa5256d71d0e9x861x327.PNG",
      "https://cdn1.dailyrounds.org/uploads/c36b315fcfdb4b1b95478c469c30743cx730x419.PNG"
    ]
  },
  {
    "text": "The position of the patient in the image shown below is known as:",
    "choices": [
      {
        "id": 1,
        "text": "Lloyd Davis position"
      },
      {
        "id": 2,
        "text": "Jack knife position"
      },
      {
        "id": 3,
        "text": "Trendelenberg position"
      },
      {
        "id": 4,
        "text": "Reverse trendelenberg position"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image below shows commonly used patient positions in the operating room:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/360bc736fc954c54975c4f0b95ebb5ef.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/534040c71e6149e89168726ef2c0363fx1280x850.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87192a5de4fb43c89779eae9dd32c477x1000x1000.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae35a7a682934e168688cd379c31608cx600x2287.JPEG"
    ]
  },
  {
    "text": "Which of the following is a false statement regarding robotic surgery?",
    "choices": [
      {
        "id": 1,
        "text": "It is associated with less blood loss compared to laparoscopic surgery"
      },
      {
        "id": 2,
        "text": "Robotic surgery cuts down the operating time significantly"
      },
      {
        "id": 3,
        "text": "The learning curve is longer with robotic surgery"
      },
      {
        "id": 4,
        "text": "It is associated with a shorter length of hospital stay"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Da Vinci system for robotic surgery</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/750bc47c95c845f8b863136084f678fcx800x517.JPEG"
    ]
  }
];
        let quizName = '03 Instruments & Sutures';
        const quizFilename = '03-instruments-sutures-fd45d7cc.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>