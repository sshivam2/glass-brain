<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>026 Peptic Ulcer Disease And Related Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is an epithelial mucosal defense mechanism of the gastric mucosa?",
    "choices": [
      {
        "id": 1,
        "text": "Layer of mucous"
      },
      {
        "id": 2,
        "text": "Alkaline tide"
      },
      {
        "id": 3,
        "text": "Microvascular bed"
      },
      {
        "id": 4,
        "text": "Restitution"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Restitution</strong> is an <strong>epithelial </strong>mucosal defense mechanism. It is the process by which healthy surface epithelial cells from the adjoining areas migrate to restore a damaged region of the gastric mucosa.&nbsp;</p>\n<p>The <strong>gastric mucosa</strong> has well-established <strong>mucosal defense mechanisms</strong> against various assaults like HCl, pepsin, alcohol, etc. These include:</p>\n<ul>\n<li><strong>Pre-epithelial</strong> defense: A<strong> layer of mucous</strong>&nbsp;over the surface epithelium. This is secreted by the surface epithelium and contains HCO<sub>3</sub><sup>- </sup>which&nbsp;maintains neutral pH at the cell surface</li>\n<li><strong>Epithelial defense</strong>: It is constituted by the <strong>surface epithelial cells</strong> and their intercellular tight junctions that perform the following functions\n<ul>\n<li>Act as a physical barrier</li>\n<li><strong>Restitution</strong> is the migration of healthy cells to damaged areas</li>\n<li>Rapid renewal of surface epithelial layer</li>\n<li>Generating factors that prevent cellular damage such as&nbsp;heat shock proteins</li>\n</ul>\n</li>\n<li><strong>Sub-epithelial defense</strong>:&nbsp;\n<ul>\n<li><strong>Rich microvascular bed</strong> of the gastric submucosa that provides&nbsp;HCO<sub>3</sub><sup>-&nbsp;</sup>and washes away the toxic metabolites.</li>\n<li><strong>Alkaline tide-</strong>&nbsp;It is caused by the release of HCO<sub>3</sub><sup>-</sup>&nbsp;into the gastric capillaries by the parietal cells. This&nbsp;HCO<sub>3</sub><sup>-</sup> helps in the quick neutralization of HCl.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old woman complains about a burning pain in her chest. She reports using NSAIDs for her constant knee pain. This drug impairs her gastric mucosal defense mechanism primarily by:",
    "choices": [
      {
        "id": 1,
        "text": "Irritant effect on gastric mucosa"
      },
      {
        "id": 2,
        "text": "Stimulating acid production"
      },
      {
        "id": 3,
        "text": "Inhibiting prostaglandin synthesis"
      },
      {
        "id": 4,
        "text": "Inhibiting nitric oxide synthesis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>NSAIDs</strong> impair the mucosal defense mechanism primarily by <strong>inhibiting prostaglandin synthesis</strong>.</p>\n<p>NSAIDs also&nbsp;<strong>decrease nitric oxide</strong>&nbsp;synthesis and have an&nbsp;<strong>irritant effect</strong>&nbsp;on the gastric mucosa but inhibition of COX enzymes/ prostaglandin synthesis is the most prominent factor.</p>\n<p>Almost all the <strong>mucosal defense mechanisms</strong>&nbsp;are primarily <strong>mediated by prostaglandins</strong> synthesized by the gastric mucosal cells.&nbsp;Apart from the prostaglandins, the other factors that play a role in mucosal defense include:</p>\n<ul>\n<li>Nitric oxide (NO)- Causes vasodilation thereby increasing the mucosal blood flow.</li>\n<li>Several growth factors like EGF, TGF, FGF- Play a role in epithelial regeneration and restitution.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are true about the risk factors of NSAIDs associated peptic ulcer disease except:",
    "choices": [
      {
        "id": 1,
        "text": "Smoking increases the risk"
      },
      {
        "id": 2,
        "text": "H pylori infection increases the risk"
      },
      {
        "id": 3,
        "text": "Even low dose of a NSAID can cause ulcers"
      },
      {
        "id": 4,
        "text": "Concomitant use of glucocorticoids decreases the risk"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Concomitant use of glucocorticoids&nbsp;</strong>with NSAIDs <strong>increases the risk</strong> of peptic ulcer disease.</p>\n<p>Other risks factors for NSAID-induced PUD include:&nbsp; &nbsp;</p>\n<ul>\n<li><strong>H pylori infection</strong></li>\n<li>Serious or multisystem disease</li>\n<li>Alcohol and <strong>smoking</strong></li>\n<li>Concomitant use of the following drugs with NSAIDs increases the risk of PUD and its complications:\n<ul>\n<li>Glucocorticoids</li>\n<li>Anticoagulants</li>\n<li>Clopidogrel</li>\n<li>Multiple NSAIDs</li>\n</ul>\n</li>\n</ul>\n<p>PUD may occur even with low doses of NSAIDs. No dose of NSAIDs is considered completely safe.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What pattern of gastritis is most common in patients with H.pylori-related duodenal ulcers?",
    "choices": [
      {
        "id": 1,
        "text": "Autoimmune gastritis"
      },
      {
        "id": 2,
        "text": "Non-atrophic pangastritis"
      },
      {
        "id": 3,
        "text": "Granulomatous  gastritis"
      },
      {
        "id": 4,
        "text": "Antral predominant gastritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Antral predominant gastritis</strong> is associated with <strong>duodenal ulcers</strong>.&nbsp;Antral predominant gastritis is associated with <strong>increased acid production</strong> by the parietal cells. This subjects the duodenum to increased acid exposure, leading to the formation of duodenal ulcers.</p>\n<p><strong>H. pylori infection</strong> may result in the following patterns of gastritis:</p>\n<ul>\n<li style=\"font-weight: 400;\"><strong>Non-atrophic pangastritis</strong>- mostly asymptomatic and sometimes associated with MALToma.</li>\n<li style=\"font-weight: 400;\"><strong>Corpus predominant gastritis</strong>- affects the corpus and causes atrophy. This leads to the loss of acid-producing parietal cells&nbsp;that are primarily found in the corpus. Hence, it is associated with decreased acid production. This is also a predisposing factor for the development of gastric cancer.</li>\n<li><strong>Antral predominant gastritis</strong>- spares the parietal cells. Hence, it is associated with increased acid production.</li>\n</ul>\n<p>Option A: Autoimmune gastritis is caused due to autoantibodies against the parietal cells. It is not associated with H. pylori.</p>\n<p>Option C: Granulomatous gastritis is characterized by the presence of granulomas It is associated with Crohn's disease and sarcoidosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with frequent epigastric pain with burning sensation for the past 2 years. The pain usually occurs 2-3 hours after a meal and is relieved by taking food. He also says that he sometimes wakes up at night because of severe pain. The most probable cause for his symptoms is:",
    "choices": [
      {
        "id": 1,
        "text": "Gastric ulcer"
      },
      {
        "id": 2,
        "text": "Duodenal ulcer"
      },
      {
        "id": 3,
        "text": "Esophagitis"
      },
      {
        "id": 4,
        "text": "GERD"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Epigastric pain with a burning sensation that usually occurs<strong> 2-3 hours after a meal</strong> and is <strong>relieved</strong> by <strong>taking food</strong> suggestive of <strong>duodenal ulcer</strong>.</p>\n<p>The following patterns of pain are usually seen in peptic ulcer disease:</p>\n<ul>\n<li><strong>Duodenal Ulcer-</strong> Pain occurs <strong>1.5 to 3 hours after a meal</strong> and is frequently relieved by antacids or food. Pain may awaken the patient from sleep.</li>\n<li><strong>Gastric Ulcer- </strong>Pain/discomfort may be <strong>precipitated by food</strong>.&nbsp;Nausea and weight loss are common.</li>\n<li><strong>Perforated ulcer</strong>- The bed of the ulcer tunnels through the entire thickness of the gastric wall and opens into the peritoneum. This presents with <strong>sudden onset severe abdominal pain</strong> and leads to <strong>peritonitis</strong>. Radiography shows gas under the diaphragm.</li>\n<li><strong>Penetrating ulcer</strong>- It is a type of perforation where the ulcer tunnels into an adjacent organ like the pancreas/liver. In this case, the <strong>pain is no longer relieved by food or antacids</strong> and might <strong>radiate to the back</strong>.</li>\n</ul>\n<p>Many patients with peptic ulcers, especially elderly patients, may not have these symptoms and may directly present with a complication like bleeding or perforation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about gastric ulcers?",
    "choices": [
      {
        "id": 1,
        "text": "Usually occur in 4th decade"
      },
      {
        "id": 2,
        "text": "Rarely malignant"
      },
      {
        "id": 3,
        "text": "Low basal acid production"
      },
      {
        "id": 4,
        "text": "High stimulated acid production"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Gastric ulcers</strong> are associated with<strong> low basal acid production</strong> and low stimulated acid production.</p>\n<p>Gastric acid secretion occurs in two patterns:</p>\n<ul>\n<li style=\"font-weight: 400;\">Basal acid output- Occurs in a circadian pattern. It is mediated by ACh from the vagus and histamine.</li>\n<li style=\"font-weight: 400;\">Stimulated acid production- Occurs in response to food. It is mediated by gastrin in addition to other factors.&nbsp;</li>\n</ul>\n<table style=\"height: 292px;\" width=\"548\">\n<tbody>\n<tr>\n<td style=\"width: 266px;\">&nbsp; &nbsp; &nbsp; &nbsp;<strong>Gastric Ulcer</strong></td>\n<td style=\"width: 266px;\">&nbsp; &nbsp; &nbsp; &nbsp;<strong>Duodenal Ulcer</strong></td>\n</tr>\n<tr>\n<td style=\"width: 266px;\">Less common</td>\n<td style=\"width: 266px;\">More common</td>\n</tr>\n<tr>\n<td style=\"width: 266px;\">Occurs later in life, with a peak incidence in the 6th decade</td>\n<td style=\"width: 266px;\">Occurs earlier in life</td>\n</tr>\n<tr>\n<td style=\"width: 266px;\">Basal and stimulated acid production is low/normal, except in type 3 gastric ulcers</td>\n<td style=\"width: 266px;\">Basal and nocturnal acid production is increased</td>\n</tr>\n<tr>\n<td style=\"width: 266px;\">Can represent <strong>malignancy</strong> and should be biopsied</td>\n<td style=\"width: 266px;\">Rarely malignant</td>\n</tr>\n<tr>\n<td style=\"width: 266px;\">Most common site: <strong>Antrum</strong> (distal to acid-secreting mucosa) on the lesser curvature</td>\n<td style=\"width: 266px;\">Most common site: 1st part of the duodenum ( within 3cms from the pylorus)</td>\n</tr>\n<tr>\n<td style=\"width: 266px;\"><strong>Pain</strong> after <strong>food intake</strong></td>\n<td style=\"width: 266px;\"><strong>Pain</strong> before food intake, and <strong>relief</strong> on <strong>taking food</strong></td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "H pylori causes gastric mucosal injury due to the presence of:",
    "choices": [
      {
        "id": 1,
        "text": "Cag A"
      },
      {
        "id": 2,
        "text": "VacA"
      },
      {
        "id": 3,
        "text": "LPS"
      },
      {
        "id": 4,
        "text": "Hop proteins"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>H.pylori</strong> produces <strong>vacuolating exotoxin</strong> (Vac A) which causes gastric <strong>mucosal injury</strong>. Vac A inhibits CD4+ T-cells and disrupts the function of B cells, macrophages &amp; mast cells.</p>\n<p><strong>Cag A positive</strong>\u00a0strains of H pylori cause an increased risk of gastric cancer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a first-year resident. You are asked to prescribe an H.pylori eradication regimen to a patient with peptic ulcer disease. Which of the following drugs will you not include in it?",
    "choices": [
      {
        "id": 1,
        "text": "Bismuth subsalicylate"
      },
      {
        "id": 2,
        "text": "Erythromycin"
      },
      {
        "id": 3,
        "text": "Amoxicillin"
      },
      {
        "id": 4,
        "text": "Metronidazole"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Note:</p>\n<p>Vonoprazan, a potassium-competitive acid blocker, has been recently approved by the FDA for the treatment of peptic acid-related disorders.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following patients presenting with epigastric pain and discomfort is H.pylori eradication therapy not indicated:",
    "choices": [
      {
        "id": 1,
        "text": "46-year-old man with a family history of gastric cancer in the father"
      },
      {
        "id": 2,
        "text": "40-year-old woman with rheumatoid arthritis on NSAIDs for 5 years"
      },
      {
        "id": 3,
        "text": "58-year-old man with 35-pack years history of smoking"
      },
      {
        "id": 4,
        "text": "36-year-old man with GERD on PPI's for 3 months"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The need for <strong>H pylori eradication therapy</strong> in patients with GERD on long-term PPIs is not well established and is controversial.</p>\n<p><strong>H&nbsp;pylori eradication therapy</strong> is offered to <strong>patients diagnosed with peptic ulcer disease</strong> (PUD) as it greatly decreases the recurrence of ulcers. In addition to this, it should also be offered to patients at increased risk of PUD and gastric cancer such as:</p>\n<ul>\n<li>Patients with long-term NSAIDs usage. Eg. Rheumatoid arthritis</li>\n<li>Patients taking gastric acid inhibitors for &gt;1 year</li>\n<li>Patients with increased exposure to risk factors of gastric cancers. Eg. heavy smokers, exposure to dust, coal</li>\n<li>Patients with previous history/family history of gastric neoplasm</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Eradication of H.pylori infection in patients with peptic ulcer disease is determined by?",
    "choices": [
      {
        "id": 1,
        "text": "Serology"
      },
      {
        "id": 2,
        "text": "Urea breath test"
      },
      {
        "id": 3,
        "text": "Biopsy urease test"
      },
      {
        "id": 4,
        "text": "Culture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Eradication</strong> of <strong>H. pylori</strong> infection can be determined by a&nbsp;<strong>urea breath test</strong><strong>.</strong></p>\n<p>A stool&nbsp;antigen test can also be employed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "H.pylori increases the risk of:",
    "choices": [
      {
        "id": 1,
        "text": "GERD"
      },
      {
        "id": 2,
        "text": "Barrett's esophagus"
      },
      {
        "id": 3,
        "text": "Adenocarcinoma of cardia of stomach"
      },
      {
        "id": 4,
        "text": "Gastric MALT lymphoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>H.pylori</strong> increases the risk of <strong>gastric MALT lymphoma</strong>.</p>\n<p>H.pylori is <strong>protective</strong> against the following:</p>\n<ul>\n<li>GERD</li>\n<li>Barrett's esophagus</li>\n<li>Adenocarcinoma of esophagus</li>\n<li>Adenocarcinoma of the cardia of the stomach</li>\n</ul>\n<p>H. pylori are <strong>inversely</strong> related to gastroesophageal reflux disease (<strong>GERD</strong>) and its sequelae, which include Barrett's esophagus and esophageal adenocarcinoma.</p>\n<p>H.pylori&nbsp;strains <strong>positive</strong> for <strong>Cag A </strong>may be particularly protective against the development of esophageal adenocarcinoma.&nbsp;Thus, colonization with H. pylori, particularly Cag A strains, may be protective against the more severe forms of GERD.</p>\n<p><strong>Eradication</strong> of H. pylori is associated with <strong>mild worsening</strong> of gastroesophageal reflux disease (GERD) in patients with corpus-dominant or pangastritis. It improves symptoms in those with antral-dominant gastritis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common complication in patients with peptic ulcer disease is:",
    "choices": [
      {
        "id": 1,
        "text": "Perforation"
      },
      {
        "id": 2,
        "text": "GI bleeding"
      },
      {
        "id": 3,
        "text": "Gastric outlet obstruction"
      },
      {
        "id": 4,
        "text": "Gastrocolic fistula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>GI bleeding</strong> is the most common complication of<strong>&nbsp;peptic ulcer disease</strong><strong>.</strong></p>\n<p>Other complications:&nbsp;</p>\n<ul>\n<li>Perforation- second most common</li>\n<li>Gastrocolic fistulas</li>\n<li>Gastric outlet obstruction</li>\n<li>Rarely malignancy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 47-year-old woman presented to the ER with an altered sensorium. Her husband reported that she has had abdominal pain, vomiting, and constipation for the past 4 days. She has been self-medicating for gastritis. Her lab investigations are as shown. Which of the following drugs is she most likely on that could have caused her symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Aluminium hydroxide"
      },
      {
        "id": 2,
        "text": "Magnesium hydroxide"
      },
      {
        "id": 3,
        "text": "Calcium carbonate"
      },
      {
        "id": 4,
        "text": "Proton pump inhibitors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical features indicating hypercalcemia and investigations showing renal insufficiency, metabolic alkalosis are suggestive of <strong>milk-alkali syndrome</strong>. Long-term use of <strong>calcium carbonate</strong> can lead to this condition.</p>\n<div class=\"p-rich_text_section\">In susceptible individuals, there is a loss of negative feedback, leading to&nbsp;<strong data-stringify-type=\"bold\">excess calcium absorption</strong>&nbsp;when there is excess intake. It results in the following triad of clinical features:</div>\n<ul class=\"p-rich_text_list p-rich_text_list__bullet\" data-stringify-type=\"unordered-list\" data-indent=\"0\" data-border=\"false\" data-border-radius-top-cap=\"false\" data-border-radius-bottom-cap=\"false\">\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Hypercalcemia&nbsp;</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Alkalosis- due to HCO3 reabsorption caused by PTH suppression, natriuresis, and water depletion</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Renal failure- due to damage to renal tubules</li>\n</ul>\n<div class=\"p-rich_text_section\">It is reversible once ingestion of antacid is stopped. However, in severe cases, a chronic form called&nbsp;<strong data-stringify-type=\"bold\">Burnett&rsquo;s syndrome&nbsp;</strong>can develop. It is associated with&nbsp;<strong data-stringify-type=\"bold\">irreversible renal damage.</strong></div>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is admitted to the ICU after he suffered trauma to his head. This patient is prone to develop what type of gastric ulcers?",
    "choices": [
      {
        "id": 1,
        "text": "Curling ulcers"
      },
      {
        "id": 2,
        "text": "Cushing ulcers"
      },
      {
        "id": 3,
        "text": "Stress ulcers"
      },
      {
        "id": 4,
        "text": "Refractory ulcers"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The gastric ulcers associated with <strong>head trauma</strong>&nbsp;are<strong>&nbsp;Cushing ulcers.&nbsp;</strong>Head trauma leads to vagal stimulation which in turn leads to increased gastric acid production.&nbsp;</p>\n<p>Option A:<strong> Curling ulcers&nbsp;</strong>are seen in <strong>severe burns.</strong></p>\n<p>Option C:<strong> Stress ulcers </strong>are seen in conditions like <strong>shock, sepsis,</strong> etc. They are thought to be caused by local ischemia and splanchnic vasoconstriction.</p>\n<p>Option D: <strong>Refractory ulcers</strong> are those that do not heal even after adequate medical therapy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You would diagnose a patient to have a refractory gastric ulcer if the ulcer fails to heal after:",
    "choices": [
      {
        "id": 1,
        "text": "12 weeks"
      },
      {
        "id": 2,
        "text": "8 weeks"
      },
      {
        "id": 3,
        "text": "10 weeks"
      },
      {
        "id": 4,
        "text": "14 weeks"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>gastric</strong> <strong>ulcer</strong> is said to be <strong>refractory</strong> if it fails to heal after<strong> 12 weeks</strong>.</p>\n<p>A refractory duodenal ulcer is that which fails to heal after 8 weeks.</p>\n<p>Management of refractory PUD:</p>\n<ul>\n<li>Rule out other diseases or causes&nbsp;</li>\n<li>High dose PPI</li>\n<li>Surgery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presents with acidity, abdominal pain, diarrhea, and weight loss for the past few months. Her symptoms are not relieved by taking antacids. An endoscopic evaluation shows ulcers on the second part of the duodenum. Which of the following conditions should be suspected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Stress ulcer"
      },
      {
        "id": 2,
        "text": "H. pylori infection"
      },
      {
        "id": 3,
        "text": "Malignant duodenal ulcer"
      },
      {
        "id": 4,
        "text": "Zollinger Ellison syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario of symptoms not improving with antacids, associated diarrhea, and the unusual location of ulcers are highly suggestive of <strong>Zollinger Ellison syndrome.</strong></p>\n<p>Zollinger Ellison syndrome (ZES) is a peptic ulcer disease caused by <strong>unregulated gastrin release</strong> from a <strong>neuroendocrine tumor/gastrinoma</strong>. About 60% of the tumors are malignant, hence, it is important to identify ZES.</p>\n<p>The clinical presentation of ZES is very similar to that of peptic ulcer disease. The features which help in suspecting ZES include:</p>\n<ul>\n<li style=\"font-weight: 400;\">Unusual locations- the second part of the duodenum and beyond</li>\n<li style=\"font-weight: 400;\">Refractory to medical therapy</li>\n<li style=\"font-weight: 400;\">Recurrence after acid-reducing surgery</li>\n<li style=\"font-weight: 400;\">Presenting with complications like bleeding and perforation</li>\n<li style=\"font-weight: 400;\">Not associated with H. pylori or NSAID ingestion</li>\n</ul>\n<p>Patients of ZES often have associated diarrhea and involvement of the esophagus (esophagitis, ulceration, or stricture).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old man presented with recurrent duodenal ulcers with poor response to medical therapy. He had a history of hyperparathyroidism and transsphenoidal prolactinoma resection. Which among the following is the next appropriate step?",
    "choices": [
      {
        "id": 1,
        "text": "Urea breath test"
      },
      {
        "id": 2,
        "text": "Secretin test"
      },
      {
        "id": 3,
        "text": "Serum gastrin levels"
      },
      {
        "id": 4,
        "text": "Endoscopic ultrasound"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Zollinger Ellison syndrome</strong> (ZES). The next appropriate step to evaluate the patients for ZES is by measuring the <strong>serum gastrin levels</strong>. History of hyperparathyroidism and transsphenoidal prolactinoma resection indicates&nbsp;<strong>MEN1 syndrome</strong>. ZES is commonly associated with MEN1.</p>\n<p>The normal gastrin levels are &lt;150 pg/mL. An <strong>increase of &gt;10 times the normal</strong> levels is highly suggestive of ZES.</p>\n<p>Secretin test is a gastrin provocative test. It is done when the gastrin levels and the acid secretory studies are inconclusive for ZES. It is the&nbsp;<strong>most sensitive&nbsp;</strong>and&nbsp;<strong>specific</strong> gastrin provocative test&nbsp;for the diagnosis of gastrinoma.</p>\n<p>Endoscopic ultrasound is done to localize the tumor. It is done after the diagnosis of ZES has been established.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following investigations employs somatostatin analogues to detect gastrinomas?",
    "choices": [
      {
        "id": 1,
        "text": "CECT"
      },
      {
        "id": 2,
        "text": "PET/CT with Ga-DOTATATE"
      },
      {
        "id": 3,
        "text": "OctreoScan"
      },
      {
        "id": 4,
        "text": "Endoscopy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>OctreoScan</strong> detects gastrinomas using their property of <strong>uptake of somatostatin analogues</strong>.&nbsp;</p>\n<p>OctreoScan detects endocrine tumors that express receptors for somatostatin in conditions such as Zollinger-Ellison syndrome (ZES) and multiple endocrine neoplasia (MEN) syndromes.</p>\n<p>Other modalities used for localizing the tumor in ZES include:</p>\n<ul>\n<li>Endoscopic ultrasound (EUS)</li>\n<li>PET/CT with Ga-DOTATATE is the investigation of choice when available.</li>\n</ul>\n<p>Note: <strong>PET/CT</strong> with Ga-DOTATATE is the <strong>gold-standard</strong> test for localizing tumors in pheochromocytoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following viruses cause infectious gastritis in immunocompromised patients?",
    "choices": [
      {
        "id": 1,
        "text": "Cytomegalovirus"
      },
      {
        "id": 2,
        "text": "Norovirus"
      },
      {
        "id": 3,
        "text": "Enterovirus"
      },
      {
        "id": 4,
        "text": "Coxsackie virus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Viruses that cause infectious <strong>gastritis </strong>in<strong> immunocompromised</strong> individuals include <strong>cytomegalovirus&nbsp;</strong>and Herpes simplex virus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An anemic patient on evaluation showed macrocytes with hypersegmented neutrophils on peripheral smear. Serology revealed anti-parietal cell antibodies. Which of the following is most likely to be associated with her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Zollinger Ellison syndrome"
      },
      {
        "id": 2,
        "text": "VIPoma"
      },
      {
        "id": 3,
        "text": "Type A gastritis"
      },
      {
        "id": 4,
        "text": "Type B gastritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given peripheral smear findings and serology are suggestive of <strong>pernicious anemia</strong>. It is usually seen in type<strong> A gastritis</strong>.</p>\n<p>Type A autoimmune gastritis is caused by circulating antibodies against the <strong>parietal cells. </strong>The destruction of parietal cells leads to&nbsp;the <strong>deficiency of intrinsic factor </strong>that is necessary for the<strong> absorption of vitamin B12.</strong> The resulting B12 deficiency causes<strong> pernicious anemia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 84-year-old woman living in an assisted care facility is rushed to the hospital with an upper GI bleed. On arrival, she is febrile and the nurse notes a sudden spurt of blood from her nasogastric tube. The following investigations are done. Which of the following is responsible for this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "H.pylori"
      },
      {
        "id": 2,
        "text": "E.coli"
      },
      {
        "id": 3,
        "text": "Cytomegalovirus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario along with her endoscopy findings are suggestive of<strong> phlegmonous gastritis</strong>. It is caused due to<strong><em> E</em>.<em>coli</em></strong><em>.</em></p>\n<p>Phlegmonous gastritis is a potentially <strong>life-threatening</strong> disorder characterized by marked and diffuse acute inflammatory infiltrates of the <strong>entire gastric wall </strong>accompanied by <strong>necrosis.&nbsp;</strong>It usually affects the immunocompromised and <strong>elderly</strong> individuals.</p>\n<p>Organisms associated with phlegmonous gastritis are:&nbsp;</p>\n<ul>\n<li><em>E.coli</em><strong><br /></strong></li>\n<li><em>Streptococci</em></li>\n<li><em>Staphylococci</em></li>\n<li><em>Proteus&nbsp;</em></li>\n<li><em>Haemophilus</em> species</li>\n</ul>\n<p>Other uncommon forms of gastritis are:</p>\n<ul>\n<li>Eosinophilic gastritis:&nbsp;Presents as intestinal obstruction&nbsp;</li>\n<li>Russel&rsquo;s body gastritis:&nbsp;Pseudotumor on endoscopy&nbsp;</li>\n<li>Granulomatous gastritis is&nbsp;seen in Crohn&rsquo;s disease&nbsp;</li>\n<li>Lymphocytic gastritis is&nbsp;seen in celiac disease</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '026 Peptic Ulcer Disease And Related Disorders';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>