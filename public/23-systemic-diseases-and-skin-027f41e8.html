<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Systemic Diseases And Skin - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 74-year-old lady presented with a 6-month history of easy bruising. Her physical examination revealed only pinch purpura as shown below. This finding is characteristically seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Primary systemic amyloidosis"
      },
      {
        "id": 2,
        "text": "Secondary systemic amyloidosis"
      },
      {
        "id": 3,
        "text": "Idiopathic thrombocytopenic purpura"
      },
      {
        "id": 4,
        "text": "Drug induced purpura"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Pinch purpura</strong> is diagnostic of <strong>primary systemic amyloidosis</strong>.</p>\n<p><strong>Purpuric</strong> macules and <strong>ecchymoses,</strong> especially in the <strong>periorbital</strong> area, develop with minor trauma&nbsp;due to&nbsp;<strong>fragility</strong> from <strong>amyloid deposition</strong> around cutaneous vessels.</p>\n<p>The common feature of these diseases is the production of monoclonal immunoglobulins of mostly&nbsp;<strong>light chains</strong> (isotypes &kappa; and &lambda;) serving as amyloid precursors (AL = light chain type/Bence Jones amyloid).</p>\n<p>Amyloid precipitation within the oral cavity mucosa may present as&nbsp;<strong>macroglossia.</strong></p>\n<p>The given image below shows macroglossia associated with amyloidosis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da8f7018ef8042b08014bbc8ebc311b3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b71c02843349469488a4f4af5d602ae2x401x601.JPEG"
    ]
  },
  {
    "text": "A woman presented with generalized swelling of the upper body. On examination, her skin was extremely taut with marked, non-pitting, symmetric induration. The following finding was also noted. A diagnosis of scleredema was made. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "The dermis is 3\u20134 times thicker than normal"
      },
      {
        "id": 2,
        "text": "Erythema and peau d\u2019orange appearance of the skin can be seen"
      },
      {
        "id": 3,
        "text": "Can occur in association with diabetes"
      },
      {
        "id": 4,
        "text": "Associated with sclerodactyly or Raynauds phenomenon"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sclerodactyly </strong>and&nbsp;<strong>Raynauds phenomenon </strong>are seen in<strong> scleroderma</strong> (not scleredema).</p>\n<p>The symptoms of scleredema are due to a <strong>thickened dermis,</strong> deposition of <strong>mucin,</strong> and replacement of subcutaneous fat with coarse <strong>collagen fibers.</strong>&nbsp;</p>\n<p>The dermis<strong>&nbsp;</strong>is 3&ndash;4 times thicker than normal due to an increase of type 1 collagen synthesis by dysfunctional fibroblast. However, fibroblast proliferation is not seen.&nbsp;<strong>Erythema</strong> and a <strong>peau d&rsquo;orange</strong> appearance of the skin are commonly observed. The <strong>hands</strong> and<strong> feet</strong> are characteristically <strong>spared</strong>.</p>\n<p><strong>Diabetic</strong>&nbsp;scleredema is the most common type. Here, the accumulation of collagen may be due to irreversible non\u2010enzymatic glycosylation of collagen and resistance to degradation by collagenase. It can also occur post-streptococcal infections.</p>\n<p>The image shows scleredema in a diabetic patient with firm non\u2010pitting edema and induration on the upper back, neck, and shoulders on an erythematous background.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/edb26b97d3d544c9a2c948eed97d0218.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1bf68836cdba4c74bc965da76418f9f4x576x547.PNG"
    ]
  },
  {
    "text": "A first-year dermatology resident is called to see a child admitted with the following findings. The parents inform that the child prefers to stay indoors during the day. On investigation, urine porphyrin levels were elevated. Which of the following types is unlikely here?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital erythropoietic porphyria"
      },
      {
        "id": 2,
        "text": "Acute intermittent porphyria"
      },
      {
        "id": 3,
        "text": "Erythropoietic protoporphyria"
      },
      {
        "id": 4,
        "text": "Porphyria cutanea tarda"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the findings shown-&nbsp;<strong>blistering, hypo,</strong> and<strong> hyperpigmented lesions</strong> over the&nbsp;<strong>sun-exposed areas</strong> (seen in panels A-C), and the absence of similar lesions on non-sun exposed areas (back) are suggestive of porphyria which presents with cutaneous features. <strong>Acute intermittent porphyria</strong> presents with acute abdominal pain, psychosis with <strong>no cutaneous features.</strong></p>\n<p>The common porphyrias are:&nbsp;</p>\n<ol>\n<li><strong>Cutaneous disease</strong>&nbsp;<strong>only:</strong>\n<ul>\n<li>Porphyria cutanea tarda (PCT)</li>\n<li>Congenital erythropoietic porphyria (CEP)</li>\n<li>Erythropoietic protoporphyria (EPP)</li>\n</ul>\n</li>\n<li><strong>Cutaneous disease</strong> and <strong>acute attacks:&nbsp;</strong>&nbsp;\n<ul>\n<li>Hereditary coproporphyria (HC)</li>\n<li>Variegate porphyria (VP)</li>\n</ul>\n</li>\n<li><strong>Acute attacks</strong> <strong>only</strong> - Acute intermittent porphyria.&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9b6976de29ff4dcb9e2f283b1317b52e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common type of porphyria?",
    "choices": [
      {
        "id": 1,
        "text": "Porphyria cutanea tarda"
      },
      {
        "id": 2,
        "text": "Congenital erythropoietic porphyria"
      },
      {
        "id": 3,
        "text": "Erythropoietic protoporphyria"
      },
      {
        "id": 4,
        "text": "Variegate porphyria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Porphyria cutanea tarda </strong>(PCT) is the <strong>commonest</strong>&nbsp;porphyria.&nbsp;</p>\n<p>It results from the deficiency&nbsp;of<strong>&nbsp;uroporphyrinogen decarboxylase&nbsp;</strong>(UROD). This causes an accumulation of uroporphyrin and other highly carboxylated porphyrins</p>\n<p>It is usually<strong> acquired&nbsp;</strong>(75%, sporadic) and is often associated with <strong>liver disease</strong>. It does not cause acute attacks.&nbsp;</p>\n<p>Patients notice <strong>increased fragility</strong> on <strong>light\u2010exposed skin</strong>, particularly the backs of the hands and forearms, with minor trauma shearing the skin away to leave <strong>sharply marginated erosions</strong> that crust and resolve over few weeks&nbsp;leaving atrophic scars, milia, and often mottled hyper\u2010 or hypopigmentation. <strong>Hypertrichosis&nbsp;</strong>on the upper face and forehead is common</p>\n<p><strong>Pink or coral-red fluorescence</strong> of urine is seen under Wood's light.</p>\n<p>The image given below is of porphyria cutanea tarda: erosions, blisters, pigmentary changes, and scarring.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/68b26904e452490480d79622bf5ffdf2x576x379.PNG"
    ]
  },
  {
    "text": "What is the least likely cause for the finding shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Broad beta disease"
      },
      {
        "id": 2,
        "text": "Familial hypercholestrolemia"
      },
      {
        "id": 3,
        "text": "Type 1 hyperlipoproteinemia"
      },
      {
        "id": 4,
        "text": "Primary biliary cirrhosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows<strong> xanthelasma palpebrarum</strong>. They are seen in:&nbsp;</p>\n<ul>\n<li>Familial hypercholesterolemia</li>\n<li>Type III hyperlipoproteinemia (broad beta disease)</li>\n<li>Primary biliary cirrhosis (chronic cholestasis)</li>\n</ul>\n<p>They are not seen in&nbsp;type I hyperlipoproteinemia (familial chylomicronemia).</p>\n<p>Xanthelasmas most commonly affect the <strong>upper eyelids</strong> and the area around the medial canthus. They are relatively soft on palpation and range from pale yellow to yellow\u2010orange in color.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7dbbfa81557f4459849ff45d5b267b06.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old otherwise healthy man presented with painless, linear, yellowish patches running along the palmar creases and the flexor creases of the wrists. Histopathology revealed lipid-laden macrophages in the dermis. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Type IV hyperlipoproteinaemia"
      },
      {
        "id": 2,
        "text": "Type III hyperlipoproteinaemia"
      },
      {
        "id": 3,
        "text": "Type II hyperlipoproteinaemia"
      },
      {
        "id": 4,
        "text": "Type I hyperlipoproteinaemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Painless, linear, yellow, lipid deposition along the palmar creases and flexor creases of the wrist are descriptive of <strong>xanthomata striata palmaris. </strong>It&nbsp;is<strong>&nbsp;</strong>pathognomonic of <strong>type III hyperlipoproteinaemia.</strong>&nbsp;</p>\n<p>The image given below shows xanthomata striata palmaris.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/18b4fcde272e43f4b61dffb98515503bx576x461.PNG"
    ]
  },
  {
    "text": "Choose the incorrect statement regarding diabetic dermopathy.",
    "choices": [
      {
        "id": 1,
        "text": "Occurs over shins, forearms, thighs and over bony prominences"
      },
      {
        "id": 2,
        "text": "Cannot be used as a marker for microvascular complications of diabetes"
      },
      {
        "id": 3,
        "text": "Lesions are brown atrophic macules"
      },
      {
        "id": 4,
        "text": "Deposition of haemosiderin and melanin in the dermis is present"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diabetic dermopathy</strong>&nbsp;is common and is a <strong>marker for complications</strong> of diabetes such as retinopathy, nephropathy, and neuropathy.</p>\n<p>It presents as asymptomatic, <strong>oval, dull\u2010red papules</strong> 0.5&ndash;1 cm in diameter evolve slowly on the <strong>shins</strong>, forearms, thighs, and over bony prominences, producing a<strong> superficial scale</strong> and, ultimately, <strong>atrophic brown scars</strong>.</p>\n<p>Pathologically, there is hyperpigmentation of the epidermal basal layer, <strong>deposition of haemosiderin </strong>and<strong> melanin</strong> in the dermis<strong>,</strong> and arteriolar <strong>basement membrane thickening.</strong></p>\n<p>The image given below shows Binkley's spots (diabetic dermopathy).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd069ce45acf475095231cc2256a4eedx512x384.PNG"
    ]
  },
  {
    "text": "A 59-year-old lady, a known diabetic for the past 10 years, presents with rashes over shin as shown in the image. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Granuloma annulare"
      },
      {
        "id": 2,
        "text": "Necrobiosis lipoidica"
      },
      {
        "id": 3,
        "text": "Reactive perforating collagenosis"
      },
      {
        "id": 4,
        "text": "Rubeosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option C:&nbsp;Reactive perforating collagenosis (folliculitis)&nbsp;has been reported in patients with diabetes. It is attributed to collagen glycation.</p>\n<p>Option D:&nbsp;Rubeosis&nbsp;is a peculiar rosy reddening of the face, and sometimes hands and feet. In longstanding diabetes, it is attributed to microangiopathy or decreased vascular tone.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/65a87c5efa4d4378aba4bb807bb62216.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/90ac989695be4b35b9939412a1405ad3x800x450.JPEG"
    ]
  },
  {
    "text": "Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Diabetic dermopathy"
      },
      {
        "id": 2,
        "text": "Cutaneous sarcoidosis"
      },
      {
        "id": 3,
        "text": "Lupus vulgaris"
      },
      {
        "id": 4,
        "text": "Rain drop pigmentation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows<strong> Binkley's spots</strong> or diabetic shin spots which is another name for <strong>diabetic dermopathy</strong>.&nbsp;The phrase&nbsp;diabetic dermopathy&nbsp;was coined by&nbsp;Binkley&nbsp;in 1965.</p>\n<p>It is characterized by asymptomatic, oval, dull\u2010red papules 0.5&ndash;1 cm in diameter evolve slowly on the <strong>shins</strong>, forearms, thighs, and over bony prominences, producing a<strong> superficial scale</strong> and&nbsp;<strong>atrophic brown scars</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2754df4229e84203b6aefc8ba80045a9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman presented with the following. Apple jelly nodules are seen on diascopy. Her serum angiotensin-converting enzyme levels were found to be higher than normal. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lupus vulgaris"
      },
      {
        "id": 2,
        "text": "Scleroderma"
      },
      {
        "id": 3,
        "text": "Erythema nodosum"
      },
      {
        "id": 4,
        "text": "Lupus pernio"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lupus pernio </strong>(cutaneous sarcoidosis)&nbsp;is the most likely diagnosis.</p>\n<p><strong>Cutaneous sarcoidosis</strong>&nbsp;or presents as&nbsp;red\u2010brown or red violaceous <strong>nodules</strong> or <strong>plaques,</strong> generally multiple. It is usually <strong>asymptomatic.</strong> Diascopy reveals the subtle brown\u2010yellow or &lsquo;<strong>apple jelly</strong>&rsquo; color characteristic of granulomatous diseases but usually <strong>more opaque</strong> than in lupus vulgaris. At diagnosis, at least 60% of patients have an increased serum angiotensin\u2010converting enzyme level.</p>\n<p><strong>Lupus pernio</strong> is the <strong>most distinctive</strong> manifestation of cutaneous sarcoidosis.&nbsp;<strong>Infiltrated erythematoviolaceous plaques</strong> involve the nose, cheeks, ears, lips, forehead, and fingers. On the cheeks, a prominent <strong>telangiectatic</strong> component is characteristic. The clinical appearance is due to the presence of <strong>epithelioid cell granulomas</strong> in the <strong>dermis</strong>.</p>\n<p>Lupus pernio is usually <strong>painless</strong> and, as it does not tend to ulcerate, is not as mutilating as lupus vulgaris.In more than half of cases, lupus pernio is associated with sarcoidosis of the <strong>upper respiratory tract</strong>, especially in patients with involvement of the <strong>nasal rims</strong>.</p>\n<p>It is also frequently associated with <strong>pulmonary fibrosis</strong>, chronic uveitis, and bony cysts, particularly affecting the terminal phalanges.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b77d948bcc114e72931cdc5b2a9a4b88.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 44-year old previously healthy lady, presented with complaints of pain in both her ankles, knees, and elbows. On examination, a tender rash as shown below is noted. The chest x-ray showed bilateral hilar lymphadenopathy. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Heerfordt Syndrome"
      },
      {
        "id": 2,
        "text": "Tuberculosis"
      },
      {
        "id": 3,
        "text": "L\u00f6fgren Syndrome"
      },
      {
        "id": 4,
        "text": "Rheumatoid arthritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image given shows erythematous shiny plaques over the shin, indicative of erythema nodosum.<strong>&nbsp;</strong>The characteristic triad association of<strong>&nbsp;erythema nodosum</strong> with <strong>bilateral hilar</strong> and right paratracheal <strong>adenopathies,</strong> with or without pulmonary infiltrates, and<strong> polyarthritis</strong> is known as <strong>L&ouml;fgren syndrome</strong>. (it is a type of acute sarcoidosis).</p>\n<p><strong>Arthritis</strong> in sarcoidosis is usually <strong>symmetrical</strong>; the <strong>ankles </strong>(&gt;90% cases), knees, small joints of the hands or feet, wrists, and elbows are involved.</p>\n<p><strong>Erythema nodosum</strong> is the <strong>most common</strong> non\u2010specific lesion of sarcoidosis and the <strong>first</strong> manifestation of the disease but may not be present in all patients.&nbsp;It may be accompanied by fever, polyarthralgia, and uveitis.</p>\n<p><strong>Inflammatory markers</strong> are&nbsp;elevated in &gt;80% of patients with acute sarcoid polyarthritis. <strong>Serum ACE</strong> level is usually<strong> increased</strong>, and rheumatoid factor is negative.&nbsp;</p>\n<p>It usually <strong>resolves spontaneously.</strong> Some require treatment is with <strong>oral corticosteroids</strong>. The <strong>prognosis</strong> is very<strong> good.&nbsp;</strong></p>\n<p>Option A:&nbsp;Heerfordt Syndrome is a&nbsp;rare presentation of sarcoidosis and is characterized by the presence of parotid gland enlargement, facial palsy, anterior uveitis, and fever.</p>\n<p>Option B: Tuberculosis generally does not show bilateral hilar lymphadenopathy.</p>\n<p>Option D:&nbsp;Rheumatoid arthritis&nbsp;also&nbsp;presents with polyarthralgia and erythema nodosum. Rheumatoid factor is often positive without chest involvement.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9fd6a0e2c1f04cc0bd61763e61dc8352.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented with the following. Similar lesions were seen on the palms. The lifetime risk for which malignancy is high in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric cancer"
      },
      {
        "id": 2,
        "text": "Esophageal cancer"
      },
      {
        "id": 3,
        "text": "Colon Cancer"
      },
      {
        "id": 4,
        "text": "Lung cancer"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows <strong>keratoderma</strong> or thickening of the soles. When this condition is present in both palms and soles, it is called&nbsp;<strong>palmoplantar</strong> keratoderma or<strong> tylosis</strong>. It is associated with a very high lifetime risk of developing <strong>squamous cell carcinoma of the esophagus</strong>.</p>\n<p>Pressure points of the sole are predominantly affected, and the palms, less affected.</p>\n<p>Tylosis esophageal cancer syndrome, also called as <strong>Howel-Evans syndrome</strong> is inherited as an <strong>autosomal dominant</strong> trait with complete penetrance of the cutaneous features.&nbsp;</p>\n<p>The cutaneous features usually present by 7 to 8&nbsp;years of age but can present as late as puberty.&nbsp;Esophageal <strong>cancer</strong> associated with tylosis usually presents in <strong>middle to late life</strong> (from mid-fifties onwards) and shows no earlier development than the sporadic form of the disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/93a27aa3086f4f108dd4a9f36c58822b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the condition given in the image :",
    "choices": [
      {
        "id": 1,
        "text": "Dermatomyositis"
      },
      {
        "id": 2,
        "text": "Acanthosis nigricans"
      },
      {
        "id": 3,
        "text": "Pityriasis rotunda"
      },
      {
        "id": 4,
        "text": "Melasma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The condition in the given image is <strong>acanthosis nigricans.&nbsp;</strong>It is characterized by <strong>thickened, gray-brown velvety plaques</strong> seen in <strong>flexural</strong> areas such as the back of the neck, axillae, inframammary creases, waist, and groin.</p>\n<p>The causal mechanism is due to the secretion of epidermal growth factors in the region involved. It can be benign or malignancy-associated.&nbsp;</p>\n<ul>\n<li><strong>Benign -&nbsp;</strong>commonly<strong>&nbsp;</strong>associated with <strong>obesity</strong> or<strong> insulin resistance</strong>, usually mild.&nbsp;</li>\n<li><strong>Malignancy -&nbsp;</strong>much less common, associated with <strong>gastric, lung,&nbsp;</strong>and <strong>uterine</strong> cancers.</li>\n</ul>\n<p>Acanthosis nigricans can also be seen in the following:</p>\n<ul>\n<li>Drugs such as nicotinic acid used to treat hyperlipidemia&nbsp;</li>\n<li>Sudden onset of multiple seborrhoeic keratoses</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c295881c1a6b4ff0bfad5350db08811f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following malignancies is most commonly associated with the paraneoplastic manifestation shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Breast carcinoma"
      },
      {
        "id": 2,
        "text": "Bladder cancer"
      },
      {
        "id": 3,
        "text": "Gastric adenocarcinoma"
      },
      {
        "id": 4,
        "text": "Lung adenocarcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This image shows velvety warty hyperpigmentation on the front of the neck called&nbsp;<strong>acanthosis nigricans</strong>. By far, the commonest site of underlying neoplasm is the <strong>gastrointestinal</strong> tract (70&ndash;90%), and&nbsp;<strong>gastric adenocarcinoma</strong> is the most frequent.</p>\n<p>Production by tumor cells of either<strong> transforming growth factor &alpha; (TGF-&alpha;) or cytokines</strong> that activate insulin\u2010like growth factors or their<strong> cutaneous receptors</strong> has been proposed as the pathogenetic mechanism.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/74dad5ab21bc444691e5934398f2a029.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In 40% of patients, this is the first sign of undiagnosed cancer. This finding in isolation is associated with which of the following internal malignancies?",
    "choices": [
      {
        "id": 1,
        "text": "Lung cancer"
      },
      {
        "id": 2,
        "text": "Gastric carcinoma"
      },
      {
        "id": 3,
        "text": "Breast cancer"
      },
      {
        "id": 4,
        "text": "Colon cancer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows&nbsp;<strong>enhanced dermatoglyphics</strong> with <strong>thickened velvety palms</strong> that have the appearance of tripe, the stomach lining of beef. <strong>Tripe palms</strong> or<strong>&nbsp;acanthosis palmaris</strong> occurring <strong>alone</strong> is more often associated with <strong>bronchial carcinoma.</strong>&nbsp;</p>\n<p>Other sites of tumors are:&nbsp;</p>\n<ul>\n<li>Genitourinary tract</li>\n<li>Carcinoma breast&nbsp;</li>\n</ul>\n<p>Acanthosis nigricans or sign of Leser-Trelat is most commonly associated with&nbsp;<strong>gastric carcinoma</strong></p>\n<p>The <strong>appearance or exacerbation</strong> of tripe palms in a known cancer patient may be a <strong>sign of recurrence</strong> of the malignancy.</p>\n<p>The image below shows tripe palms.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/daa22ba8df1e4979a9f29fcbc1174dee.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/434e7c7d807b4b4c8af346b7f58acf2cx720x1020.PNG"
    ]
  },
  {
    "text": "Pick the incorrectly matched cutaneous marker and its commonly associated internal malignancy.",
    "choices": [
      {
        "id": 1,
        "text": "Acquired Icthyosis - Hodgkin Lymphoma"
      },
      {
        "id": 2,
        "text": "Erythema gyratum repens - Glucagonoma"
      },
      {
        "id": 3,
        "text": "Dermatitis herpetiformis - Lymphoma"
      },
      {
        "id": 4,
        "text": "Porphyria cutanea tarda - Hepatocellular carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Erythema gyratum repens</strong> is commonly associated with <strong>lung cancer</strong>.</p>\n<p><strong>Necrolytic migratory erythema</strong> is commonly associated with <strong>glucagon secreting pancreatic islet cell adenoma</strong>.</p>\n<p>The image given below shows<strong>&nbsp;</strong>erythema gyratum repens of the arm secondary to carcinoma of the bronchus.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f33ee36a841d4d7faa3d17bf929062f8x518x344.PNG"
    ]
  },
  {
    "text": "A 56-year-old man presented with the sudden development of the eruption shown below. Which internal malignancy should be suspected?",
    "choices": [
      {
        "id": 1,
        "text": "Carcinoma pancreas"
      },
      {
        "id": 2,
        "text": "Carcinoid syndrome"
      },
      {
        "id": 3,
        "text": "Bronchial adenocarcinoma"
      },
      {
        "id": 4,
        "text": "Gastrointestinal adenocarcinoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows multiple eruptive <strong>seborrheic keratoses</strong> over the back, abdomen, and neck. This acute onset of an increase in size and number of seborrheic keratoses is a sign of internal malignancy called the&nbsp;<strong>sign of Leser-Tr&eacute;lat. </strong></p>\n<p>When it is<strong>&nbsp;</strong>associated with pruritus or acanthosis nigricans,&nbsp;especially in younger patients, it warrants investigation for internal malignancy.</p>\n<p>About<strong> 1/3rd&nbsp;</strong>of associated tumors are in the <strong>gastrointestinal tract, </strong>and about<strong> half </strong>of these tumors are<strong> adenocarcinomas.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b939154721724494984bf38e53184451.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Leukemia cutis is most commonly seen in association with which of the following malignancies?",
    "choices": [
      {
        "id": 1,
        "text": "Acute lymphocytic leukemia"
      },
      {
        "id": 2,
        "text": "Acute myeloid leukemia"
      },
      {
        "id": 3,
        "text": "Chronic lymphocytic leukemia"
      },
      {
        "id": 4,
        "text": "Chronic myeloid leukemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Leukemia cutis</strong> is most common in patients with myeloid neoplasms, especially&nbsp;<strong>acute myeloid leukemia</strong> (AML).&nbsp;The risk is higher with<strong>&nbsp;translocation t(8,21)</strong>.</p>\n<p>Leukemia cutis is an <strong>infiltration </strong>of the<strong> skin</strong> by myeloid or lymphoid <strong>neoplastic leukocytes</strong> resulting in clinically identifiable cutaneous lesions.&nbsp;When made up of malignant granulocytic precursor cells, leukemia cutis lesions are also called myeloid sarcoma, granulocytic sarcoma, or <strong>chloroma.</strong></p>\n<p>Leukemia cutis typically presents as single or multiple <strong>monomorphic violaceous</strong>, dark\u2010red or hemorrhagic <strong>skin nodules</strong> and<strong> plaques</strong>, especially&nbsp;on the legs, arms, and face.</p>\n<p>The image below shows violaceous&nbsp;infiltrated nodules and plaques on the trunk suggestive of leukemia cutis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ececf63903254b1bb8deb0ef0c467896x720x528.PNG"
    ]
  },
  {
    "text": "A patient with ulcerative colitis presented with the lesion shown below. He gave a history of a papulopustular lesion over his leg that had ulcerated to the current painful form over 4 days. HPE of the ulcer edge revealed neutrophilic infiltrates. Which of the following statements regarding the cutaneous lesion is false?",
    "choices": [
      {
        "id": 1,
        "text": "Pathergy is seen in this condition"
      },
      {
        "id": 2,
        "text": "Cribriform or wrinkled paper scars are seen at the sites of healed ulcer"
      },
      {
        "id": 3,
        "text": "Bullous form of this lesion is associated with hematological malignancy"
      },
      {
        "id": 4,
        "text": "Treatment is with oral and topical antibiotics"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario is suggestive of <strong>pyoderma gangrenosum</strong> (PG). It&nbsp;is an <strong>autoinflammatory</strong> disease (excessive response to an internal&nbsp;<span class=\"term tooltipstered\" data-term-id=\"410\">antigen</span>) due to&nbsp;<span class=\"term tooltipstered\" data-term-id=\"441\">neutrophil</span>&nbsp;<span class=\"term tooltipstered\" data-term-id=\"1253\">dysfunction and hence <strong>antibiotics</strong> have<strong> no role</strong> in its management.</span></p>\n<p>It commonly presents on the anterior aspect of the lower limbs. The disease starts as a <strong>papule/</strong><strong>pustule/bulla</strong>&nbsp;and rapidly progresses to an <strong>ulcer</strong>ative lesion. The undermined edges of the ulcer show <strong>neutrophilic infiltration.</strong> Deep ulcers heal with a characteristic&nbsp;<span class=\"term tooltipstered\" data-term-id=\"2475\">cribriform</span>&nbsp;or criss-cross pattern of scarring.</p>\n<p>The <strong>pustular</strong> form of PG is associated mainly with inflammatory bowel disease (<strong>ulcerative colitis</strong> &gt; Crohn's disease), the<strong> bullous form</strong> with <strong>hematological&nbsp;malignancies.</strong></p>\n<p>Pathergy is&nbsp;the phenomenon whereby skin trauma provokes lesions at the site of injury. It is seen in pyoderma gangrenosum, Behcet's disease.</p>\n<p>The image below shows a large purulent ulcer with violaceous undermined borders which is a feature of pyoderma gangrenosum.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/97f1be7ba346453fa33585c51daee0c1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d5f5c80b33c443e997de14bfb8b9efecx450x338.PNG"
    ]
  },
  {
    "text": "A child presented with fever and multiple erythematous tender plaques. On microscopic examination, the skin lesions have neutrophilic infiltration in the dermis. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Behcet's Syndrome"
      },
      {
        "id": 2,
        "text": "Pyoderma gangrenosum"
      },
      {
        "id": 3,
        "text": "Kasabach-Meritt Syndrome"
      },
      {
        "id": 4,
        "text": "Sweet's Syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Neutrophilic infiltration of the dermis indicates one of the diseases under <strong>n</strong><strong>eutrophilic dermatosis</strong>. <strong>Sweet's Syndrome</strong> presents as an <strong>acute febrile</strong> neutrophilic dermatosis which is&nbsp;characterized by <strong>non\u2010itchy</strong>, sometimes<strong> tender</strong>,<strong> erythematous plaques and papules.</strong></p>\n<p>The plaques are often oedematous and as the process develops they may become studded with <strong>pseudovesicles or pseudopustules</strong> (no fluid collection present).</p>\n<p>The lesions in Sweet's Syndrome are most commonly distributed on the arms, upper body, head, and neck.&nbsp;An associated fever and peripheral leucocytosis are commonly seen and <strong>females</strong> are more frequently affected.</p>\n<p>Histological findings include a dense<strong> dermal neutrophilic infiltrate</strong> with edema.&nbsp;Three subgroups are recognized:</p>\n<ul>\n<li>Classical</li>\n<li>Malignancy-associated</li>\n<li>Drug-induced</li>\n</ul>\n<p>Option A:&nbsp;<strong>Behcet's</strong> syndrome is also a neutrophilic dermatosis but presents as <strong>recurrent oral</strong> and<strong> genital aphthous ulcers</strong> with an erythematous halo.</p>\n<p>Option B:&nbsp;Pyoderma gangrenosum, another neutrophilic dermatosis presents as painful ulcerative erythematous plaques or papules with undermined violaceous borders.</p>\n<p>Option C:&nbsp;Kasabach-Merritt's syndrome shows hemangiomas with thrombocytopenia.</p>\n<p>The image given below shows&nbsp;Sweet syndrome- pseudovesicles may occur within the inflammatory plaques.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dc4ea7dffaa54f53b0d0930bba506548x1280x561.PNG"
    ]
  },
  {
    "text": "A 35-year-old woman presented to the medicine OPD with complaints of fatigue, constipation, and low mood for the past 3 months. Physical examination revealed diffuse enlargement of the thyroid gland and bradycardia. Which of the following skin findings is least likely to be seen in her?",
    "choices": [
      {
        "id": 1,
        "text": "Sign of Hertoghe"
      },
      {
        "id": 2,
        "text": "Aurantiasis cutis"
      },
      {
        "id": 3,
        "text": "Dry coarse skin"
      },
      {
        "id": 4,
        "text": "Palmar erythema"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>hypothyroidism</strong>. Palmar erythema is seen in hyperthyroidism.</p>\n<table style=\"height: 405px;\" width=\"616\">\n<tbody>\n<tr>\n<td style=\"width: 300px; text-align: center;\"><strong>Hypothyroidism&nbsp;</strong></td>\n<td style=\"width: 300px; text-align: center;\"><strong>Hyperthyroidism</strong></td>\n</tr>\n<tr>\n<td style=\"width: 300px;\">\n<p>Cold peripheries with pale and <strong>dry coarse skin</strong></p>\n</td>\n<td style=\"width: 300px;\">\n<p>Smooth, moist, and warm skin</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 300px;\">\n<p><strong>Aurantiasis cutis,&nbsp;</strong>yellowish tinged skin secondary to beta-carotene accumulation</p>\n</td>\n<td style=\"width: 300px;\">Facial and <strong>palmar erythema</strong></td>\n</tr>\n<tr>\n<td style=\"width: 300px;\">\n<p>Sparse and brittle hair</p>\n</td>\n<td style=\"width: 300px;\">\n<p>Fine, soft, and thinned scalp hair</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 300px;\">\n<p><strong>Sign of Hertoghe -</strong> loss of hair&nbsp;in the outer third of eyebrows</p>\n</td>\n<td style=\"width: 300px;\">\n<p>Distorted and overgrown&nbsp;nails&nbsp;(<strong>thyroid acropachy</strong>) that may lift off the nail bed (<strong>onycholysis</strong>)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 300px;\">\n<p>Myxoedema - puffy face, eyelids, hands, and feet</p>\n</td>\n<td style=\"width: 300px;\">\n<p>Generalized pruritis</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 300px;\">\n<p>Delayed wound healing</p>\n</td>\n<td style=\"width: 300px;\">\n<p>Urticaria</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Graves disease may also cause <strong>thyroid&nbsp;dermopathy</strong>&nbsp;resulting in <strong>pretibial myxoedema</strong> and exophthalmos, which are associated with the presence of thyroid&nbsp;antibodies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common cutaneous manifestation of end-stage renal disease?",
    "choices": [
      {
        "id": 1,
        "text": "Pigmentation"
      },
      {
        "id": 2,
        "text": "Pruritus"
      },
      {
        "id": 3,
        "text": "Half and half nails"
      },
      {
        "id": 4,
        "text": "Pseudoporphyria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image given below shows calciphylaxis-&nbsp;also known as <strong>calcific uremic arteriolopathy</strong> (<strong>CUA</strong>) or &ldquo;Grey Scale&rdquo;, is a rare painful syndrome of calcification of the small blood vessels located within the fatty tissue and deeper layers of the skin, blood clots, and the death of skin cells due to too little flow.<a href=\"https://en.wikipedia.org/wiki/Skin\" target=\"_blank\" rel=\"noopener\"></a></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/821dd3eb21d945cfa05c4d103cd2d2ebx1280x1486.7136812411848.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f81823dc653141ef87cc3a980741a79ax1280x805.PNG"
    ]
  },
  {
    "text": "A 44-year-old man came to the OPD with complaints of a violaceous rash on his toes that appeared one day ago. He denies any exposure to cold in the last 24 hours. Which of the following is suspected to be the cause?",
    "choices": [
      {
        "id": 1,
        "text": "Chilblains"
      },
      {
        "id": 2,
        "text": "COVID-19"
      },
      {
        "id": 3,
        "text": "Varicella"
      },
      {
        "id": 4,
        "text": "Eczema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely cause of the above picture is COVID-19, an entity called <strong>COVID toes</strong>.</p>\n<p><strong>Pernio</strong> (chilblains) present as <strong>erythematous-violaceous</strong> or<strong> purpuric macules</strong> on fingers, elbows, toes, and lateral aspect of the feet, with or without accompanying edema and pruritus. The underlying mechanism is thought to be an inflammatory process. They can be:</p>\n<ol>\n<li style=\"font-weight: 400;\">Idiopathic, due to <strong>exposure to cold</strong> that present within 12-24 hours.</li>\n<li style=\"font-weight: 400;\"><strong>Secondary</strong> to hematological disorder (paraproteinemia), autoimmune disease, viral hepatitis or malignancy.</li>\n</ol>\n<p>The latest guidelines suggest patients presenting with <strong>new-onset, pernio-like lesions</strong> that have no other clear cause should be tested for severe acute respiratory syndrome coronavirus 2 (<strong>SARS-CoV-2</strong>) by polymerase chain reaction (PCR). There are no treatment guidelines for COVID-19-associated, pernio-like lesions of the feet or hands. However, <strong>high-potency topical corticosteroids</strong> may be helpful if the lesions are causing discomfort.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e6564e904ff34324864a6ede973b3473.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly woman presents with a sudden increase in size and number of lesions given in the image. Which of the following should be suspected?",
    "choices": [
      {
        "id": 1,
        "text": "Melanoma"
      },
      {
        "id": 2,
        "text": "Visceral malignancy"
      },
      {
        "id": 3,
        "text": "HIV-AIDS"
      },
      {
        "id": 4,
        "text": "Parkinson's disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The finding seen in the case scenario provided is&nbsp;<strong>seborrheic keratosis </strong>and this is highly suggestive of <strong>visceral malignancy.</strong>&nbsp;</p>\n<p>A sudden appearance of multiple seborrheic keratoses in association with skin tags and acanthosis nigricans has been associated with a variety of malignancies, including<strong> gastrointestinal</strong> and<strong> lung cancers; </strong>it is<strong>&nbsp;</strong>also known as the<strong>&nbsp;Leser-Tr&eacute;lat sign.</strong></p>\n<p>Seborrheic keratoses are common <strong>epidermal tumors</strong> consisting of a <strong>benign</strong> proliferation of <strong>immature keratinocytes.</strong> They present as well-demarcated, round or oval lesions with a dull, verrucous surface and a typical stuck-on appearance.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/23738e1968c14ff4afd9b6390fafa7a6.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '23 Systemic Diseases And Skin';
        const quizFilename = '23-systemic-diseases-and-skin-027f41e8.html';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>