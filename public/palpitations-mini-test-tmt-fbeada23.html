<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palpitations Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 60-year-old man, with a history of myocardial infarction 1 year back, presents with complaints of palpitations and syncope. The ECG strip obtained during his admission is given below. What is the long-term treatment for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Amiodarone"
      },
      {
        "id": 2,
        "text": "Atropine only"
      },
      {
        "id": 3,
        "text": "Permanent pacemaker"
      },
      {
        "id": 4,
        "text": "Atropine and isoproterenol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given ECG, the\u00a0<strong>PR segment remains the same</strong>\u00a0in each successive cycle. However, some P waves are not followed by QRS complexes, which means that some of the P waves are not conducted due to an atrioventricular conduction block. This is typical of\u00a0<strong>Mobitz type II block</strong>.\u00a0The definitive long-term treatment is, therefore, a\u00a0<strong>permanent pacemaker.\u00a0</strong></p>\n<p>This patient with a<strong> history of ischemic heart disease (previous history of inferior-wall MI)</strong> and signs of acquired Mobitz type II AV block will benefit most from a permanent pacemaker and it is recommended regardless of symptoms.</p>\n<p>In the ECG below, the <strong>blue arrows</strong> show\u00a0<strong>P waves,</strong> and the last P wave is not followed by a QRS complex. This\u00a0<strong>missed QRS complex</strong> is marked by the <strong>red arrow</strong>. Mobitz type II is often a problem in the infra-nodal conduction system, and therefore,\u00a0is associated with <strong>wide\u00a0QRS complexes </strong>(in leads V1, V2, and V3 of the given ECG), as\u00a0indicated by the\u00a0<strong>red box</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/83a91e95efa549909492d68d40f31952.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9b0310f1672747cb9a200242d8371321x765x510.PNG"
    ]
  },
  {
    "text": "A hypertensive patient was brought to the emergency due to complaints of palpitations and breathing difficulty. Comment on his ECG.",
    "choices": [
      {
        "id": 1,
        "text": "Multifocal PVC"
      },
      {
        "id": 2,
        "text": "Unifocal PVC"
      },
      {
        "id": 3,
        "text": "Ventricular quadrigeminy"
      },
      {
        "id": 4,
        "text": "Ventricular bigeminy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above ECG shows a pattern of premature ventricular contractions,&nbsp;<strong>one premature beat after one normal beat</strong>. This is seen in <strong>ventricular</strong> <strong>bigeminy.</strong></p>\n<p class=\"p1\"><strong>Premature ventricular contractions</strong>/beats (PVC) are single ventricular beats that occur earlier than the next normal supraventricular beat. They originate from abnormal foci in the ventricular tissue:</p>\n<ul>\n<li><strong>Unifocal PVCs</strong> arise from a single focus and hence have the <strong>same QRS morphology</strong></li>\n<li><strong>Multifocal PVCs</strong> arise from multiple foci and therefore have <strong>different QRS morphologies</strong></li>\n</ul>\n<p class=\"p1\">They are <strong>not preceded </strong>by a<strong> P wave</strong> as they do not originate in the atria. They show <strong>wide QRS complexes</strong> (&gt;0.12 ms) on the ECG because they are conducted via normal myocardial tissue instead of the Purkinje system.</p>\n<p class=\"p1\"><span class=\"st\" data-hveid=\"100\" data-ved=\"0ahUKEwiOwOb3xtzZAhUHso8KHe-SD7IQ4EUIZDAM\"><strong>Ventricular bigeminy</strong> refers to a pair of normal and premature ventricular contractions, whereas ventricular trigeminy refers to a premature beat that occurs after two normal beats. Quadrigeminy is when a premature beat follows three normal beats.</span></p>\n<p>Few other terms associated with premature ventricular contractions:</p>\n<ul>\n<li><strong>Two successive PVCs</strong> are known as a <strong>couplet</strong></li>\n<li><strong>Three successive PVCs</strong> are known as a <strong>triplet</strong>.</li>\n</ul>\n<p>The given ECG shows ventricular bigeminy with premature beats circled in red and normal ventricular contractions circled in green.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/56d3f3941c6d447d9e74e846087b52a0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e2b6162528124a3ba471869ec72fd6b5x1280x774.JPEG"
    ]
  },
  {
    "text": "A 72-year-old man comes to the emergency room complaining his heart is pounding and that he is going to die. The emergency physician orders an ECG. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Inferior wall MI"
      },
      {
        "id": 2,
        "text": "Extensive anterior wall MI"
      },
      {
        "id": 3,
        "text": "Anterolateral wall MI"
      },
      {
        "id": 4,
        "text": "Anteroseptal MI"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given ECG shows&nbsp;<strong>ST elevation </strong>in leads<strong> V1-V4</strong>&nbsp;which is suggestive of <strong>acute anteroseptal myocardial infarction</strong> (MI)<strong>. </strong>ST depression in the leads III and aVF signifies an old inferior wall infarction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/edfec934c9dd4e948efdec9aa4fdee9e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old male admitted to the ICU for acute exacerbation of COPD develops a sudden onset of palpitations. The following ECG changes are seen. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 2,
        "text": "Multifocal atrial tachycardia"
      },
      {
        "id": 3,
        "text": "Atrial fibrillation"
      },
      {
        "id": 4,
        "text": "Atrial tachycardia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a <strong>COPD patient</strong> in <strong>ICU</strong> developing <strong>palpitations</strong> and the ECG showing <strong>narrow QRS complex</strong> (&lt;0.12 s) <strong>tachycardia</strong> with more than three <strong>different P wave morphologies</strong>, points to the diagnosis of <strong>multifocal atrial tachycardia</strong> (MAT).</p>\n<p>Multifocal atrial tachycardia (MAT) is characterized by at least <strong>3 distinct P wave morphologies</strong> (shown by arrows in the image) with rates typically between <strong>100 and 150 beats/min</strong>.</p>\n<p>It is usually encountered in patients with <strong>chronic pulmonary disease</strong> and <strong>acute illness</strong>. The clinical features are most commonly related to the underlying precipitating illness (COPD in this case). Unlike atrial fibrillation, there are clear isoelectric intervals between P waves.</p>\n<p><strong>Treating</strong> the <strong>underlying disease</strong> and correcting any metabolic abnormalities is the mainstay of treatment. <strong>Electrical cardioversion</strong> has <strong>no effect</strong>.</p>\n<p>The calcium-channel blockers <strong>verapamil</strong> or <strong>diltiazem</strong> may <strong>slow the atrial and ventricular rate</strong>. MAT may respond to amiodarone, but long-term therapy with this agent is usually avoided due to its toxicities, particularly in pulmonary fibrosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dff48b4c5a7044fc93c59c565f525bc5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old female patient came with complaints of chest pain, palpitation, and shortness of breath. On examination, a mid-diastolic murmur was heard, and a prominent 'a' wave was found on JVP. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral stenosis"
      },
      {
        "id": 2,
        "text": "Tricuspid stenosis"
      },
      {
        "id": 3,
        "text": "Mitral regurgitation"
      },
      {
        "id": 4,
        "text": "Tricuspid regurgitation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The presence of a\u00a0<strong>mid-diastolic murmur</strong> and a prominent <strong>a-wave</strong> in JVP is suggestive of <strong>tricuspid stenosis</strong>.</p>\n<p>Mid-diastolic murmurs result\u00a0from obstruction and/or augmented flow at the level\u00a0of the mitral or tricuspid valve. Thus, both mitral stenosis (MS) and tricuspid stenosis (TS) present with a mid-diastolic murmur. However, the presence of a prominent a-wave in JVP points toward tricuspid stenosis.</p>\n<p>Causes for mid-diastolic murmur:</p>\n<ol>\n<li>Mitral stenosis</li>\n<li>Tricuspid stenosis</li>\n<li>Atrial myxomas</li>\n<li>Austin Flint murmur in severe aortic regurgitation</li>\n<li>Carey-Coombs murmur in acute rheumatic fever</li>\n</ol>\n<p><strong>Tricuspid stenosis:</strong></p>\n<p>It always occurs in <strong>association with MS</strong> and is rheumatic in origin.\u00a0<strong>Mid-diastolic murmur</strong> in TS is best heard along the <strong>left sternal border</strong> and over the <strong>xiphoid process.</strong> Murmur is augmented during <strong>inspiration</strong> and reduced during expiration. The jugular veins are distended, and a <strong>giant a-wave</strong> is seen in JVP. There is a <strong>slow y descent</strong> due to impedance of right atrial emptying during diastole.\u00a0ECG shows features of right atrial enlargement, which includes <strong>tall, peaked P wave in lead II and a prominent, upright P wave in lead V1.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/afedf9b401a545439056c8e634bec646x1279x706.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4c9af9a94804a74845ee48b246e179ax1279x1191.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/353e10b1359042c79229688c5a20c104x1279x1191.JPEG"
    ]
  },
  {
    "text": "A 50 year old male presents to the OPD with chest pain, palpitations and shortness of breath. An ECG is taken to determine the cause of his symptoms. What does the ECG show?",
    "choices": [
      {
        "id": 1,
        "text": "Right bundle branch block"
      },
      {
        "id": 2,
        "text": "Paroxysmal supraventricular tachycardia"
      },
      {
        "id": 3,
        "text": "Right ventricular hypertrophy"
      },
      {
        "id": 4,
        "text": "Ventricular bigeminy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ECG shows <strong>right ventricular hypertrophy</strong>.</p>\n<p><strong>ECG findings suggestive of RVH</strong></p>\n<ul>\n<li>R-V1 &gt;= 7</li>\n<li>R-V1 + S-V5/V6 &gt; 11</li>\n<li>Right axis deviation&nbsp;of +110&deg; or more</li>\n<li>T wave inversion in RV leads (Lead III, V1 &amp; V2)</li>\n</ul>\n<p><strong>Causes of RVH</strong></p>\n<ul>\n<li>Pulmonary hypertension</li>\n<li>Mitral stenosis</li>\n<li>Pulmonary embolism</li>\n<li>Chronic lung disease (Cor pulmonale)</li>\n<li>Congenital heart disease (e.g. Tetralogy of Fallot, pulmonary stenosis)</li>\n<li>Arrhythmogenic right ventricular cardiomyopathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/386cb7866ac5423da7575bba8916f186.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man presents with complaints of breathlessness on walking a few yards. He adds that he has an uncomfortable awareness of his heartbeat, especially on lying down. Examination reveals widened pulse pressure and pulsating uvula. Which of the following would be the most likely auscultatory finding in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Austin Flint murmur"
      },
      {
        "id": 2,
        "text": "Opening snap"
      },
      {
        "id": 3,
        "text": "Gallavardin phenomenon"
      },
      {
        "id": 4,
        "text": "Graham Steel murmur"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical presentation of breathlessness and palpitations, along with the findings of widened pulse pressure and pulsating uvula, is suggestive of <strong>aortic regurgitation(AR).\u00a0</strong>The most likely auscultatory finding in this patient is<strong>\u00a0Austin-Flint murmur.</strong></p>\n<p><strong>Aortic regurgitation</strong> may either be caused due to valvular heart diseases like <strong>endocarditis</strong> and <strong>rheumatic fever;</strong> diseases of the aortic root, like aortic dissection and medial degeneration, or a combination of both.</p>\n<p><strong>Men</strong> are <strong>more commonly affected</strong> than women. Patients present with features of an <strong>uncomfortable awareness of the heartbeat, especially on</strong> <strong>lying down</strong>, and exertional dyspnea.</p>\n<p>The <strong>dyspnea</strong> is followed by <strong>orthopnea,</strong> paroxysmal nocturnal dyspnea, and excessive <strong>diaphoresis.</strong> Anginal chest pain may occur, both at rest as well as during exertion; these episodes of chest pain can be prolonged and often do not respond well to sublingual nitroglycerin.</p>\n<p>Auscultatory findings in aortic regurgitation include\u00a0a <strong>diastolic murmur</strong>\u00a0and <strong>Austin Flint murmur</strong>. The former is a typically high-pitched, blowing, decrescendo murmur. It is called a\u00a0<strong>'cooing dove' murmur</strong>\u00a0when the murmur is of <strong>musical quality.\u00a0</strong>Its presence usually signifies the\u00a0<strong>eversion or perforation</strong> of an <strong>aortic cusp.\u00a0</strong></p>\n<p>An Austin Flint murmur<strong>\u00a0</strong>is a <strong>soft, low-pitched, rumbling mid-to-late diastolic murmur.</strong>\u00a0It is created by the regurgitant stream displacing the anterior leaflet of the normal mitral valve.</p>\n<p>Other options:</p>\n<p>Options B and D:\u00a0<strong>Opening snap</strong> and<strong> Graham Steel murmur</strong> are seen in <strong>mitral stenosis</strong>. The Graham Steel murmur is a <strong>decrescendo diastolic murmur</strong> seen in mitral stenosis patients who have developed <strong>pulmonary hypertension</strong>, and resultant<strong> pulmonary regurgitation.</strong></p>\n<p>Option C:<strong> Gallavardin phenomenon\u00a0</strong>is seen in <strong>aortic stenosis</strong>, where the coarse systolic murmur of aortic stenosis\u00a0may sound higher pitched and more acoustically pure at the apex.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ECG of a patient who presented with palpitations to the ER is shown below. Which of the following is a likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sinus tachycardia"
      },
      {
        "id": 2,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 3,
        "text": "Junctional tachycardia"
      },
      {
        "id": 4,
        "text": "Atrial flutter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above ECG shows increased heart rate with <strong>wide QRS complexes</strong> (&gt; 0.12s). This is suggestive of<strong> ventricular tachycardia </strong>(VT).<strong>\u00a0</strong></p>\n<p>Types of ventricular tachycardia based on QRS morphology:</p>\n<ul>\n<li>Monomorphic<span class=\"term-highlight\">-</span>\u00a0a stable QRS morphology from beat to beat</li>\n<li>Polymorphic<span class=\"term-highlight\">-</span>\u00a0changing or multiform QRS variance from beat to beat. <strong>Torsades de pointes </strong>is an example of polymorphic\u00a0<span class=\"term-highlight\">ventricular</span>\u00a0<span class=\"term-highlight\">tachycardia.</span></li>\n<li>Bidirectional-\u00a0has a beat-to-beat alternation in the QRS frontal plane axis.\u00a0It is associated with digitalis toxicity or catecholaminergic polymorphic VT.</li>\n</ul>\n<p>The most common cause of VT is <strong>ischemic heart disease.</strong></p>\n<p><strong>Ventricular tachyarrhythmias\u00a0</strong>occur due to impulses that originate within the ventricles. These impulses\u00a0are conducted through the normal <strong>ventricular myocardial cells</strong> instead of the fast conducting Purkinje system. Hence, they present with<strong> wide QRS complexes</strong> ( &gt;0.12 sec) on the ECG.</p>\n<p><strong>Supraventricular tachyarrhythmias</strong>\u00a0occur due to impulses originating above the ventricles. These impulses reach the ventricles through the proper fast conduction pathway resulting in a <strong>narrow QRS complex.</strong> SVTs are associated with wide QRS in few exceptional conditions like:</p>\n<ul>\n<li style=\"font-weight: 400;\">Conduction block in the left or right bundle branch</li>\n<li style=\"font-weight: 400;\">Activation of ventricles from an accessory pathway- antidromic AVRT</li>\n</ul>\n<p>The given ECG shows wide stable QRS complexes in monomorphic ventricular tachycardia:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e5bc29d2d1624ae48169c4e04b7e15b0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8037eec9a7e5488ea9f119a5d8ba3269x1280x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9989408335ef46bca7dabd1f13a8628cx1280x1903.JPEG"
    ]
  },
  {
    "text": "A concerned wife brought her 43-year-old husband to the clinic after an episode of light-headedness and palpitations. An ECG was taken. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Mobitz type II block"
      },
      {
        "id": 2,
        "text": "Mobitz type I block"
      },
      {
        "id": 3,
        "text": "Complete Heart block"
      },
      {
        "id": 4,
        "text": "1st Degree AV block"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient has symptoms and ECG findings suggestive of <strong>Mobitz type I or&nbsp;Wenckebach block.</strong></p>\n<p>In the given ECG <strong>PR segment progressively increases</strong> in each successive cycle, until a P wave of the series fails to produce a QRS complex (<strong>dropped QRS</strong>). In this example, for every 5 'P' waves, there are only 4 'QRS' complexes; hence, this is a 5:4 Wenckebach block.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/984406bb7c55446aa29563339e422f4b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with mitral stenosis presented with worsening dyspnea and fatigue, which are now present at rest. He also complained of a heavy pounding sensation in the chest with recurrent chest pain. You decided to evaluate the patient using echocardiography. When would you advise the patient to undergo a valvotomy?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral orifice is <1.8 sq cm"
      },
      {
        "id": 2,
        "text": "Mitral orifice is <2 sq cm"
      },
      {
        "id": 3,
        "text": "Mitral orifice is <1.5 sq cm"
      },
      {
        "id": 4,
        "text": "Mitral orifice is <1.5 sq cm with significant regurgitation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Mitral valvotomy</strong>\u00a0is indicated in symptomatic (NYHA Functional Class II-IV)\u00a0patients with mitral stenosis (MS) with<strong> orifice of\u00a0&lt;1.5 cm<sup>2</sup>\u00a0</strong>in normal-sized adults or &lt;1 cm<sup>2</sup>/m<sup>2\u00a0</sup>body surface area.</p>\n<p>Treatment of mitral stenosis:</p>\n<ul>\n<li>Administration of\u00a0<strong>warfarin</strong>\u00a0in patients with MS who develop\u00a0<strong>atrial fibrillation.</strong></li>\n<li>Surgical treatment:\n<ul>\n<li><strong>Mitral valvotomy:</strong>\u00a0It is done in symptomatic patients whose <strong>mitral orifice is less than\u00a01.5 cm<sup>2</sup>.\u00a0</strong>This can be either percutaneous mitral valvotomy or open surgical valvotomy.</li>\n<li><strong>Mitral valve replacement:</strong>\u00a0This is done in patients whose mitral valve is severely distorted and associated with <strong>significant mitral regurgitation.</strong></li>\n</ul>\n</li>\n</ul>\n<p>Mitral stenosis is a valvular heart disease, most commonly caused by\u00a0<strong>rheumatic fever</strong>. Other causes include congenital defects like cor triatriatum and parachute valve, mitral annular calcification with leaflet involvement, infective endocarditis with large vegetations and left atrial myxomas.</p>\n<p>Patients present with\u00a0<strong>dyspnea,</strong>\u00a0cough,\u00a0<strong>orthopnea</strong>,\u00a0<strong>paroxysmal nocturnal dyspnea,</strong>\u00a0and <strong>hemoptysis.\u00a0</strong></p>\n<p>In a normal mitral valve, there is no obstruction to the flow of blood from the left atrium (LA) to the left ventricle. Therefore a small LA pressure is sufficient to empty the blood into the ventricle.</p>\n<p>When the MVA is &lt;~2 cm<sup>2</sup>, blood flows from the LA to the left ventricle, propelled by mildly elevated atrial pressure. Hence, patients are usually\u00a0<strong>asymptomatic</strong>\u00a0and may develop\u00a0<strong>dyspnea</strong>\u00a0only when the\u00a0<strong>heart rate increases,</strong>\u00a0as seen in exertion, excitement, fever, etc.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female patient complains of palpitations and weight loss. Laboratory evaluation shows thyroid-receptor antibody. Which of the following statements is not true about this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Associated with pretibial myxedema"
      },
      {
        "id": 2,
        "text": "Associated with enlargement of extraocular muscles"
      },
      {
        "id": 3,
        "text": "Radionuclide scan shows low uptake"
      },
      {
        "id": 4,
        "text": "TSH levels are suppressed"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario is suggestive of <strong>Graves</strong>' <strong>disease. Radionuclide scan</strong> shows <strong>increased uptake with diffuse distribution</strong> in Graves' disease.</p>\n<p><span data-preserver-spaces=\"true\">The hyperthyroidism of Graves\u2019 disease is due to the presence of </span><strong><span data-preserver-spaces=\"true\">thyroid-stimulating immunoglobulins (TSI)</span></strong><span data-preserver-spaces=\"true\">. These are synthesized by lymphocytes present in the</span><span data-preserver-spaces=\"true\"> thyroid gland, as well as in bone marrow and lymph nodes. TSI include TSH receptor antibodies (TRAb), which act on the TSH receptors and stimulate the thyroid gland to produce and release more thyroid hormones, T3 and T4. Feedback inhibition by thyroid hormones causes TSH levels to be suppressed (option D).</span></p>\n<p><span data-preserver-spaces=\"true\">Patients present with features of hyperthyroidism like <strong>hyperactivity</strong>, irritability,<strong> heat intolerance</strong>, <strong>sweating</strong>, and <strong>palpitations</strong>. <strong>Diarrhea</strong>, <strong>weight loss</strong> despite increased appetite, and oligomenorrhea are also seen. </span><span data-preserver-spaces=\"true\">On examination, <strong>tremors</strong> and proximal muscle weakness might be seen. <strong>Pretibial myxedema</strong> (option A) refers to the <strong>noninflamed indurated plaque</strong>, pink-<strong>purple</strong> in color, which is seen most commonly on the <strong>skin of the anterior aspect of the leg</strong>. <strong>Thyroid acropachy</strong> is a form of <strong>clubbing</strong> of the fingers. Both these features are relatively specific to Graves' disease but are not seen in all the patients.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Graves ophthalmopathy </span></strong>occurs<span data-preserver-spaces=\"true\"> due to increased volume of the retroorbital connective tissues and extraocular muscles (option B) due to </span><strong><span data-preserver-spaces=\"true\">marked lymphocytic infiltration</span></strong><span data-preserver-spaces=\"true\">\u00a0of the retro-orbital space,\u00a0</span><strong><span data-preserver-spaces=\"true\">accumulation of hydrophilic glycosaminoglycans</span></strong><span data-preserver-spaces=\"true\">\u00a0such as hyaluronic acid and chondroitin sulfate, and\u00a0</span><strong><span data-preserver-spaces=\"true\">increased numbers of adipocytes</span></strong><span data-preserver-spaces=\"true\">. <strong>Early signs</strong> of Graves' ophthalmopathy include <strong>lid retraction </strong>and\u00a0<strong>lid lag</strong> on downgaze. <strong>Later</strong>, the patients develop <strong>proptosis</strong>, <strong>diplopia</strong>, <strong>corneal damage</strong> (due to proptosis), and <strong>optic nerve compression </strong>causing permanent vision loss.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">The diagnosis of Graves' disease is established by measuring<strong> TSH levels (will be suppressed)</strong> and <strong>T3/T4 levels (will be elevated)</strong>. Measurement of TRAb is required if the diagnosis is unclear. Radionuclide scan shows diffusely increased uptake in cases of Graves' disease.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Treatment</strong> of Graves' disease includes:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Anti-thyroid drugs such as <strong>propylthiouracil</strong>, <strong>carbimazole,</strong> and <strong>methimazole</strong>. <strong>Propylthiouracil</strong> is the <strong>preferred</strong> anti-thyroid drug <strong>during</strong> <strong>pregnancy</strong> especially till 14-16 weeks, because <strong>carbimazole</strong> and <strong>methimazole</strong> are associated with <strong>aplasia cutis</strong> (absence of skin, usually on the scalp).\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\"><strong>Propranolol</strong> is given to <strong>control adrenergic effects</strong> before the effect of anti-thyroid drugs takes effect fully.</span></li>\n<li><strong>Radioiodine ablation</strong> can be used as a first-line modality, or can be used for patients who have relapsed despite taking anti-thyroid drugs. <strong>Pregnancy</strong> and <strong>breastfeeding</strong> are <strong>absolute contraindications </strong>for radioiodine ablation.\u00a0</li>\n<li><strong>Total thyroidectomy</strong> is done for patients who have relapsed despite taking anti-thyroid drugs and prefer surgical treatment over radioiodine ablation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old patient with chronic kidney disease suddenly develops chest pain and palpitations. ECG of the patient is shown below. What is the immediate management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Administer Spironolactone"
      },
      {
        "id": 2,
        "text": "Administer intravenous calcium gluconate"
      },
      {
        "id": 3,
        "text": "Administer intravenous regular Insulin with dextrose"
      },
      {
        "id": 4,
        "text": "Administer intravenous Potassium chloride"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A chronic kidney disease (CKD) patient with chest pain, palpitations, and ECG showing <strong>tall, peaked T waves and loss of P waves </strong>indicates that the patient is suffering from <strong>hyperkalemia.</strong> The <strong>immediate management</strong> is to administer <strong>intravenous calcium gluconate</strong> which raises the threshold and reduces excitability.</p>\n<p>Hyperkalemia is defined as a serum potassium level of<strong> more than 5.5 mEq/L.</strong>\u00a0</p>\n<p>The ECG changes that can be seen in hyperkalemia depend on the extent of hyperkalemia.\u00a0</p>\n<table style=\"height: 156.789px; width: 499px;\">\n<tbody>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 160.43px; height: 44.7969px;\"><strong>Serum potassium level</strong></td>\n<td style=\"width: 309.977px; height: 44.7969px;\"><strong>ECG change</strong></td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 160.43px; height: 44.7969px;\">5.5 - 6.5 mEq/L</td>\n<td style=\"width: 309.977px; height: 44.7969px;\">tall, peaked T waves with 'tented' or 'pinched' shape</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 160.43px; height: 22.3984px;\">6.5 - 7.5 mEq/L</td>\n<td style=\"width: 309.977px; height: 22.3984px;\">loss of P waves</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 160.43px; height: 22.3984px;\">7.0 - 8.0 mEq/L</td>\n<td style=\"width: 309.977px; height: 22.3984px;\">widened QRS complex</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 160.43px; height: 22.3984px;\">&gt; 8.0 mEq/L</td>\n<td style=\"width: 309.977px; height: 22.3984px;\">sine wave</td>\n</tr>\n</tbody>\n</table>\n<p>The <strong>most common cause</strong> of hyperkalemia is <strong>kidney failure</strong>. Drugs that cause hyperkalemia include angiotensin-converting enzyme inhibitors, angiotensin receptor blockers, potassium-sparing diuretics.\u00a0</p>\n<p>Treatment of hyperkalemia involves the following:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Administer <strong>intravenous calcium gluconate</strong> which raises the threshold and <strong>reduces excitability.</strong> It is cardioprotective</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Administer <strong>regular insulin</strong> with <strong>dextrose.</strong> The insulin will reduce the serum <strong>potassium</strong> concentration by causing an <strong>intracellular shift.</strong> The dextrose will counteract the hypoglycemic effects of insulin.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Salbutamol nebulization</strong> will also <strong>shift potassium inside</strong> the cell.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Remove potassium with calcium-based resins, diuretics, or hemodialysis.\u00a0</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed2be879308f46cba54dc9cb969b9e63.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbda02ee66a149babb636ab43176abc5x1280x1465.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man presented with a sensation of rapid heartbeat, increased sweating, and dizziness. The ECG obtained is shown below. His BP is 126/82 mm of Hg. After failed attempts of maintenance with vagal maneuvers, what would be your treatment option?",
    "choices": [
      {
        "id": 1,
        "text": "Intravenous adenosine 6\u201312 mg administered slowly"
      },
      {
        "id": 2,
        "text": "Intravenous adenosine 18\u201324 mg administered rapidly"
      },
      {
        "id": 3,
        "text": "Intravenous adenosine 18\u201324 mg administered slowly"
      },
      {
        "id": 4,
        "text": "Intravenous adenosine 6\u201312 mg administered rapidly"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and the ECG showing\u00a0<strong>narrow QRS complexes</strong>\u00a0<strong>without P waves</strong>\u00a0and <strong>pseudo R waves</strong> in aVR lead suggest\u00a0<strong>paroxysmal supraventricular tachycardia\u00a0(PSVT). Intravenous adenosine</strong>\u00a0is preferred for the termination of arrhythmia in <strong>stable patients\u00a0</strong>(blood pressure is normal) with regular, narrow complex PSVT. It is given <strong>rapidly</strong> in a dosage of <strong>6-12 mg.</strong> It successfully terminates the arrhythmia (within 1 minute) in more than 90% of the cases.</p>\n<div class=\"page\" title=\"Page 6\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Adverse effects of adenosine:</p>\n<ul>\n<li>Transient chest pain</li>\n<li>Dyspnea</li>\n<li>Anxiety</li>\n<li>Precipitates atrial fibrillation (AF)</li>\n<li>May aggravate bronchospasm</li>\n</ul>\n<p><strong>Contraindications</strong> of the use of adenosine include patients with <strong>prior cardiac transplants</strong> since they have potential hypersensitivity due to surgical sympathetic denervation.</p>\n<p>It should be <strong>cautiously used</strong> in patients with <strong>Wolff-Parkinson-White</strong> syndrome due to the precipitation of atrial fibrillation leading to hemodynamic instability.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c40aecad2492494aa767d905a06aaf54.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cce217ad8aa24b60b92d58bf21d03894x510x812.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/32ee9f5f00564b369070d8a7601fe4f4x1280x1845.JPEG"
    ]
  },
  {
    "text": "A patient presented with palpitations and light-headedness. His ECG is shown below. Which of the following drugs is least likely to cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Quinidine"
      },
      {
        "id": 2,
        "text": "Disopyramide"
      },
      {
        "id": 3,
        "text": "Procainamide"
      },
      {
        "id": 4,
        "text": "Lidocaine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario and the ECG findings (<strong>rapid asynchronous complexes</strong> and an <strong>undulating</strong> <strong>baseline</strong>) point towards a diagnosis of <strong>torsades de pointes.</strong>\u00a0<strong>Lidocaine</strong> use is unlikely to cause this condition.</p>\n<p><strong>Lidocaine</strong> belongs\u00a0to class IB antiarrhythmics.\u00a0It is considered to have the <strong>least arrhythmogenic</strong> potential among antiarrhythmics.</p>\n<p>Among the antiarrhythmics, <strong>class Ia</strong> and <strong>class III</strong> drugs prolong action potential duration and thus <strong>prolong QT interval.</strong> They are also prone to cause torsades de pointes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/00e9fd31a507460192d5b3caf8c74708.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old patient complains of palpitations. He is hemodynamically stable. An ECG is obtained and is given below. Which of the following is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Carotid massage"
      },
      {
        "id": 2,
        "text": "Chest compressions"
      },
      {
        "id": 3,
        "text": "Electrical cardioversion"
      },
      {
        "id": 4,
        "text": "Intravenous amiodarone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given ECG shows <strong>wide complex tachycardia </strong>(QRS complexes are &gt;120 ms in duration), with <strong>regular QRS complexes</strong> with <strong>uniform morphology</strong> in each lead. This is suggestive of <strong>ventricular tachycardia (VT)</strong>. Since this patient is <strong>hemodynamically stable</strong>, the best management is <strong>IV amiodarone</strong>.\u00a0</p>\n<p>In patients with <strong>sustained VT</strong> who are <strong>hemodynamically stable</strong>, <strong>medical treatment</strong> with <strong>intravenous amiodarone</strong> is preferred. <strong>Alternative</strong> drugs that can be given are <strong>lignocaine</strong> and <strong>procainamide</strong>. However, <strong>if</strong> the <strong>VT fails to resolve</strong> with medical management or if the patient's <strong>symptoms worsen</strong>, <strong>DC cardioversion</strong> is the next step.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Carotid massage</strong> has no role in the management of VT. It is used as an initial step in <strong>paroxysmal supraventricular tachycardia</strong> to block the AV node and terminate the arrhythmia.</p>\n<p>Option B: <strong>Chest compressions</strong> are done until the defibrillator is arranged to ensure some amount of cardiac output even during this period.</p>\n<p>Option C: If a <strong>patient</strong> <strong>with VT has hemodynamic compromise</strong> due to <strong>hypotension</strong> or <strong>impaired consciousness</strong>\u00a0or has pulmonary, <strong>electrical</strong> <strong>cardioversion </strong>is performed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/87b6ffd2ebc14e098ca1f80c934f2385.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young girl complains that she suddenly starts feeling intense fear thinking about her exam. During the episode, she can feel her heart beating very rapidly, her hands will be shaking and she has difficulty in breathing. She feels that she might have a heart attack. This usually occurs before her exams. Which of the following drugs can be used in the treatment of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1,3, and 4"
      },
      {
        "id": 2,
        "text": "1, 4, and 5"
      },
      {
        "id": 3,
        "text": "2, 3, and 5"
      },
      {
        "id": 4,
        "text": "2, 3, and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features are suggestive of <strong>panic disorder</strong>. <strong>Alprazolam, Paroxetine</strong> and <strong>Clomipramine</strong> are useful in the treatment of this condition.</p>\n<p><strong>Panic disorder</strong></p>\n<p>It is characterized by the presence of<strong>\u00a0</strong>an<strong>\u00a0</strong>abrupt surge of <strong>intense fear</strong> or intense discomfort that reaches a peak within minutes. During the episode, the person may experience:</p>\n<ul>\n<li>Palpitations</li>\n<li>Sweating</li>\n<li>Trembling or shaking</li>\n<li>Sensations, of shortness of breath</li>\n<li>Nausea</li>\n<li>Dizziness</li>\n<li>Chest pain or discomfort</li>\n<li>Chills or heat sensations</li>\n<li>Paresthesias</li>\n<li>Fear of dying</li>\n</ul>\n<p>The patient also might feel like losing control, having a heart attack, or going crazy.\u00a0</p>\n<p>It is not attributable to any drug abuse, medication, or medical condition.</p>\n<p>Important drugs that can be used in the management of this condition are</p>\n<ul>\n<li><strong>Benzodiazepines-</strong> <strong>Alprazolam</strong>, lorazepam, clonazepam, etc</li>\n<li><strong>Selective serotonin reuptake inhibitors SSRI</strong>- <strong>Paroxetine</strong>, citalopram, escitalopram, fluvoxamine, and sertraline<span class=\"Apple-converted-space\">\u00a0</span></li>\n<li><strong>Tricyclic antidepressants</strong>- <strong>Clomipramine</strong>, imipramine, desipramine</li>\n<li><strong>Monoamine oxidase inhibitors</strong>-\u00a0Phenelzine, tranylcypromine<span class=\"Apple-converted-space\">\u00a0</span></li>\n</ul>\n<p><strong>Note- Viloxazine</strong> is recently approved for the treatment of <strong>attention deficit hyperactivity disorder (ADHA). </strong></p>\n<p><strong>Rufinamide</strong> is an <strong>antiepileptic drug </strong>used in the treatment of\u00a0<strong>Lennox- Gastaut syndrome</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman comes to the clinic with complaints of recurrent palpitation and lightheadedness. An ECG was taken and is as shown below. What is the best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "DC cardioversion"
      },
      {
        "id": 2,
        "text": "Carotid sinus massage"
      },
      {
        "id": 3,
        "text": "Synchronised cardioversion"
      },
      {
        "id": 4,
        "text": "Catheter ablation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ECG shows the presence of <strong>delta waves\u00a0</strong>(preexcitation wave), <strong>wide QRS,</strong> and <strong>short PR interval </strong>which are classically seen in <strong>Wolff Parkinson White</strong>\u00a0<strong>(WPW) syndrome</strong>. In this patient, <strong>catheter ablation\u00a0</strong>is the best for long-term management.\u00a0</p>\n<p>Patients with preexcitation who have symptoms of arrhythmia are at <strong>risk</strong> for developing <strong>AF</strong> and <strong>sudden death</strong> if they have an accessory pathway that allows rapid antegrade conduction (preexcitation &amp; tachyarrhythmias are features of WPW syndrome due to the abnormal accessory pathway).</p>\n<p>Complications of catheter ablation are rare but include AV block, cardiac tamponade, thromboembolic events, and hematoma at the access site.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ceea5122e7a248ac85308dd2f6c06b26.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents to you with palpitations and a heart rate of 150/minute. An ECG is done which is shown below. If the blood pressure is normal, what is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Perform emergency electrical cardioversion"
      },
      {
        "id": 2,
        "text": "Start therapeutic IV heparin"
      },
      {
        "id": 3,
        "text": "Administer IV beta-blocker"
      },
      {
        "id": 4,
        "text": "Administer IV dihydropyridine calcium channel blocker"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ECG showing <strong>sawtooth flutter waves</strong> along with the clinical scenario suggests a diagnosis of <strong>atrial flutter</strong>. The next best step is to administer an <strong>intravenous (IV) beta-blocker</strong> for<strong> rate control</strong> as the patient is <strong>hemodynamically stable.</strong></p>\n<p>The initial management of atrial flutter targets rate control through IV atrioventricular (AV) nodal blocking agents. These include <strong>beta-blockers</strong> or <strong>non-dihydropyridine calcium channel blockers (CCB)</strong> such as <strong>verapamil</strong> and <strong>diltiazem</strong>. Intravenous <strong>ibutilide</strong>, a class III antiarrhythmic agent can be used for <strong>rhythm control</strong>.</p>\n<p>If the patient presents with severe symptoms or is hemodynamically unstable, <strong>electrical cardioversion</strong> is the first step.\u00a0If the episode <strong>duration is &gt; 48 hours</strong>,\u00a0or\u00a0if the patient has an increased risk of <strong>thromboembolic stroke</strong> based on the\u00a0<strong>CHAD2DS2 -VASc\u00a0</strong>scoring\u00a0system, <strong>anticoagulation</strong>\u00a0must be provided before the cardioversion. The drugs which can be used are<strong> direct oral anticoagulants</strong> (DOAC) such as <strong>apixaban</strong>, edoxaban, and <strong>rivaroxaban</strong>. <strong>Dabigatran</strong>, an antithrombin inhibitor, and <strong>warfarin</strong>, a vitamin K antagonist can also be used.\u00a0</p>\n<p>The first episode does not warrant the continuation of antiarrhythmic drugs after conversion to sinus rhythm. In recurrent episodes, sotalol or amiodarone may be used.</p>\n<p>At least 4 weeks of <strong>anticoagulation therapy</strong> is carried out after electrical or chemical cardioversion, as done in atrial fibrillation. Patients with risk factors for thromboembolism should continue it for longer. The definitive treatment is <strong>catheter ablation\u00a0</strong>for recurrent cases.</p>\n<p>The ECG shows characteristic sawtooth flutter waves due to the atrial activity in the inferior leads ( leads II, III, and aVF). Positive P waves are seen in lead V1. Conduction of more than 230 impulses/ minute through the AV node is not possible in adults. Hence a <strong>2:1</strong> or<strong> greater AV block</strong> is almost always associated. So patients present with tachycardia of <strong>130-150 beats/minute.\u00a0</strong>Typically, the\u00a0atrial rate\u00a0is around\u00a0<strong>240-300/minute</strong>.</p>\n<p>Atrial flutter is more commonly seen in patients with <strong>chronic obstructive pulmonary disease</strong> or structural heart disease. Symptoms include <strong>palpitations</strong>, dizziness, and fatigue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7ba62333813b432f96db17aacf04e2a8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented to the ER with dizziness and palpitations. ECG is shown below. Which of the following drugs cannot be used in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Digoxin"
      },
      {
        "id": 2,
        "text": "Verapamil"
      },
      {
        "id": 3,
        "text": "Quinidine"
      },
      {
        "id": 4,
        "text": "Lignocaine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The scenario and ECG findings (<strong>absent P waves</strong> and <strong>RR intervals</strong> that are <strong>irregularly irregular)</strong> are suggestive of <strong>atrial fibrillation. Lignocaine</strong> is not used in atrial arrhythmias.\u00a0</p>\n<p style=\"text-align: justify;\"><strong>Lignocaine</strong> is a <strong>class</strong>\u00a0<strong>1B anti-arrhythmic agent.</strong> It <strong>blocks Na+</strong> channels mostly in the <strong>closed/inactivated state</strong>. It is not used in atrial arrhythmias because the atrial action potential is so short that the Na+ channels are in a closed/ inactivated state for only a brief amount of time.</p>\n<p style=\"text-align: justify;\">Lignocaine is used in the acute treatment of<strong> ventricular tachycardia</strong> and <strong>ventricular fibrillation.</strong></p>\n<div class=\"O0\">Drugs mostly used for <strong>supraventricular</strong> arrhythmia are:</div>\n<ul>\n<li class=\"O1\">Adenosine</li>\n<li class=\"O1\"><strong>Verapamil</strong></li>\n<li class=\"O1\">Diltiazem</li>\n<li class=\"O1\"><strong>Digoxin</strong></li>\n</ul>\n<div class=\"O1\">Drugs used for <strong>ventricular</strong> arrhythmia are:</div>\n<ul>\n<li class=\"O1\">Lidocaine\u00a0</li>\n<li class=\"O1\">Mexiletine</li>\n</ul>\n<div class=\"O1\">Drugs used in <strong>both</strong> conditions are:</div>\n<ul>\n<li class=\"O1\">Amiodarone</li>\n<li class=\"O1\">Beta-blockers</li>\n<li class=\"O1\">Class 1a / 1c antiarrhythmics</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/910b818d2ef64c448a6bb019951055d6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male patient was brought to the emergency department with palpitations and dizziness. On examination, a new onset diastolic murmur is heard in the left third intercostal space. A diagnosis of acute severe aortic regurgitation is made. Arrange the expected clinical signs in this patient from above downwards with respect to the body part affected.",
    "choices": [
      {
        "id": 1,
        "text": "3-4-1-2"
      },
      {
        "id": 2,
        "text": "1-3-4-2"
      },
      {
        "id": 3,
        "text": "4-3-2-1"
      },
      {
        "id": 4,
        "text": "1-2-3-4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct answer is option B: <strong>1-3-4-2</strong>.</p>\n<p><strong>Landolfi\u2019s sign</strong>: Alternating constriction and dilation of the<strong> pupil</strong></p>\n<p><strong>Muller\u2019s sign</strong>: Systolic pulsation of the <strong>uvula</strong></p>\n<p><strong>Rosenbach\u2019s sign</strong>:<strong> </strong>Pulsation of <strong>liver</strong></p>\n<p><strong>Traube\u2019s sign</strong>:<strong> </strong>A pistol shot sound over<strong> femoral arteries</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Palpitations Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>