<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16 Intestinal Infections - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is an example of disability limitation for polio?",
    "choices": [
      {
        "id": 1,
        "text": "Polio immunization drives for infants to reduce the occurence."
      },
      {
        "id": 2,
        "text": "Arranging for schooling for a child suffering from residual polio paralysis."
      },
      {
        "id": 3,
        "text": "Resting the limbs affected by polio in neutral position."
      },
      {
        "id": 4,
        "text": "Providing calipers for walking to patients affected by polio."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Resting</strong> the&nbsp;<strong>limbs</strong>&nbsp;affected by polio in a&nbsp;<strong>neutral position</strong> is an example of <strong>disability limitation</strong>. It is an intervention done to either <strong>halt or prevent</strong> the transition of the disease process from impairment to handicap.</p>\n<p><strong>Rehabilitation</strong> has been defined as the use of medical, social, educational, and vocational measures for <strong>training</strong>&nbsp;the individual to the highest possible level of <strong>functional ability.&nbsp;</strong>Like providing <strong>calipers</strong> for walking to patients and arranging <strong>schooling</strong> after being affected by polio.</p>\n<p><strong>Immunization</strong> drives are examples of <strong>specific protection</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A person is involved in unsafe sexual practices. Which of the following viruses is least likely to get transmitted via this route?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatitis A"
      },
      {
        "id": 2,
        "text": "Hepatitis E"
      },
      {
        "id": 3,
        "text": "Hepatitis C"
      },
      {
        "id": 4,
        "text": "Hepatitis D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hepatitis E</strong>&nbsp;has <strong>feco-oral</strong> or <strong>waterborne</strong>&nbsp;transmission. It does not transmit sexually. Transmission of&nbsp;<strong>Hepatitis A, C, and D</strong>&nbsp;can occur&nbsp;<strong>sexually.</strong></p>\n<p>Transmission of the <strong>hepatitis A</strong> virus can occur from any sexual activity with an infected person and is not limited to fecal-oral contact. People who are sexually active are considered at risk for hepatitis A if they are MSM, live with or are having sex with an infected person, or inject drugs.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For how long is Hepatitis A excreted in the feces?",
    "choices": [
      {
        "id": 1,
        "text": "One week before the symptoms appear"
      },
      {
        "id": 2,
        "text": "Two weeks after the symptoms appear"
      },
      {
        "id": 3,
        "text": "Two weeks before the symptoms and two weeks thereafter"
      },
      {
        "id": 4,
        "text": "One week before the symptoms and one week thereafter"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>HAV is excreted in the feces for about <strong>2 weeks before the onset</strong> of jaundice and for <strong>up to 2 weeks thereafter</strong>.</p>\n<p>The risk of transmitting is greatest at 2 weeks before to 1 week after the onset of jaundice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An intern sustains a needlestick injury while drawing blood from a Hepatitis B positive patient. Assuming he has been infected, which among the following will be the first to rise?",
    "choices": [
      {
        "id": 1,
        "text": "Anti- HBs"
      },
      {
        "id": 2,
        "text": "Anti- HBc"
      },
      {
        "id": 3,
        "text": "HBeAg"
      },
      {
        "id": 4,
        "text": "HBsAg"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>HbsAg</strong> is the <strong>first</strong> serological marker to be <strong>detected</strong> in Hepatitis B infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old pregnant woman is rushed to the hospital with labor pains at 34 weeks of gestation. She did not attend any prior antenatal visits. On further evaluation, she is found to be positive for HbsAg. Which of the following should be administered to the newborn after delivery?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatitis B vaccine + Immunoglobulin"
      },
      {
        "id": 2,
        "text": "Immunoglobulin only"
      },
      {
        "id": 3,
        "text": "Hepatitis B vaccine only"
      },
      {
        "id": 4,
        "text": "Immunoglobulin, followed by vaccine 1 month later"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>simultaneous </strong>administration of hepatitis B immunoglobulin<strong> (HBIG) and hepatitis B vaccine</strong> is more <strong>efficacious</strong> than HBIG alone for the\u00a0<strong>prevention</strong> of the carrier state in <strong>newborn</strong> babies of HBV-positive mothers.</p>\n<p>HBIG does not interfere with the antibody response to the hepatitis B vaccine.\u00a0This combined procedure is ideal both for <strong>postexposure prophylaxis</strong> of persons accidentally exposed to blood known to contain hepatitis B virus and for the\u00a0<strong>prevention</strong> of the carrier state in the <strong>newborn</strong> babies of carrier mothers.</p>\n<p><strong>HBIG</strong> (0.05\u20130.07 mL/kg) IM\u00a0</p>\n<ul>\n<li>As early as possible, preferably within 24 hours of exposure</li>\n</ul>\n<p><strong>Hepatitis B vaccine</strong> (20 mcg/1.0 mL), IM</p>\n<ul>\n<li>1st dose: within 7 days of exposure</li>\n<li>2nd and 3rd dose: at one and six months, respectively</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "HCV screening is done for which of the following people?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, and 5"
      },
      {
        "id": 2,
        "text": "1, 2, 3, 4 and 5"
      },
      {
        "id": 3,
        "text": "3 and 5"
      },
      {
        "id": 4,
        "text": "1, 2 and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Patients with a history of IV drug abuse, HIV, and a history of blood transfusion 32 years ago are <strong>screened</strong> for <strong>HCV.</strong></p>\n<p>Since the <strong>screening</strong> of <strong>blood</strong> for Hepatitis C was started <strong>after 1992</strong>, hence people who have received a blood transfusion before 1992 (in this MCQ, the year is 1992 in point 3) have to be screened.</p>\n<p>HCV screening is done for people who may be at risk for infection. These include:</p>\n<ul>\n<li>People who <strong>received blood,</strong> blood products, or organs <strong>before screening</strong> for <strong>hepatitis</strong> <strong>C </strong>virus was implemented</li>\n<li>Current or <strong>former</strong> injecting <strong>drug users</strong></li>\n<li>People on <strong>long-term hemodialysis</strong></li>\n<li>Health-care workers</li>\n<li>People living with <strong>HIV</strong></li>\n<li>People with abnormal liver tests or liver disease</li>\n<li>Infants born to infected mothers.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about Rotavirus?",
    "choices": [
      {
        "id": 1,
        "text": "Severe rotavirus infections are limited to children aged 5-7 years."
      },
      {
        "id": 2,
        "text": "Rotavirus is shed in high concentrations for several days in the stools and vomit of infected children."
      },
      {
        "id": 3,
        "text": "Rotavirus diarrhoea increases in frequency during drier, cooler months."
      },
      {
        "id": 4,
        "text": "Clean water supplies and good hygiene are unlikely to have a substantial effect on viral transmission."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Severe <strong>rotavirus gastroenteritis</strong> is largely limited to children <strong>aged 6-24 months</strong>, not 5-7 years.</p>\n<p>Rotavirus is the <strong>leading</strong> cause of severe, dehydrating diarrhea in children aged <strong>&lt;5 years globally.</strong>\u00a0In <strong>developing</strong> countries, 75% of the children acquire their first rotavirus infection in the <strong>first 12 months</strong>.</p>\n<p>The universal occurrence of rotavirus infections shows that clean water supply and good hygiene are unlikely to have a substantial effect on virus transmission.\u00a0In tropical areas, rotavirus diarrhea occurs throughout the year, <strong>increasing</strong> in frequency in <strong>drier, cooler</strong> climates.</p>\n<p>Transmission is through the\u00a0<strong>feco-oral</strong> route, <strong>person-to-person</strong> contact, or indirectly through <strong>fomites</strong>. Infected individuals shed very high concentrations of the virus\u00a0for many days in their stool and vomit.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brought a 2 month old child with complaints of diarrhea and vomiting. As a part of management, you advise her regarding vaccination for rotavirus.  Which is the false statement regarding the same?",
    "choices": [
      {
        "id": 1,
        "text": "Rotarix is administered in 2 oral doses."
      },
      {
        "id": 2,
        "text": "It cannot be given in an immunocompromised child."
      },
      {
        "id": 3,
        "text": "The first dose of Rotarix is contraindicated for infants <12 weeks."
      },
      {
        "id": 4,
        "text": "It is not a part of catchup vaccination programmes due to its risk of intussusception."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>first dose </strong>of the Rotarix vaccine is <strong>contraindicated </strong>for<strong> infants &gt; 12 weeks </strong>of age due to the potential risk of <strong>intussusception.</strong>&nbsp;Hence, it is not a part of catch-up immunization programs as the age is difficult to ascertain in such programs.</p>\n<p>Rotavirus vaccines are<strong> live, attenuated,&nbsp;</strong>and are administered<strong> orally.</strong>&nbsp;So, it is not&nbsp;given to an immunocompromised child.</p>\n<p>Given below are the different Rotavirus vaccines available along with their schedule:</p>\n<table style=\"height: 184px; width: 485px;\">\n<tbody>\n<tr>\n<td style=\"width: 114px;\"><strong>Vaccines</strong></td>\n<td style=\"width: 125px;\"><strong>Number of doses</strong></td>\n<td style=\"width: 116.734px;\"><strong>Interval between doses</strong></td>\n<td style=\"width: 99.2656px;\"><strong>Maximum age limit</strong></td>\n</tr>\n<tr>\n<td style=\"width: 114px;\">Rotarix</td>\n<td style=\"width: 125px;\">2</td>\n<td style=\"width: 116.734px;\">\n<p>6 weeks</p>\n<p>10 weeks</p>\n</td>\n<td style=\"width: 99.2656px;\">\n<p>12 weeks</p>\n<p>24 weeks</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114px;\">RotaTeq</td>\n<td style=\"width: 125px;\">3</td>\n<td style=\"width: 116.734px;\">8, 16, 24 weeks</td>\n<td style=\"width: 99.2656px;\">32 weeks</td>\n</tr>\n<tr>\n<td style=\"width: 114px;\">Rotavac</td>\n<td style=\"width: 125px;\">3</td>\n<td style=\"width: 116.734px;\">6, 10, 14 weeks</td>\n<td style=\"width: 99.2656px;\">32 weeks</td>\n</tr>\n<tr>\n<td style=\"width: 114px;\">Rotasil</td>\n<td style=\"width: 125px;\">3</td>\n<td style=\"width: 116.734px;\">6, 10, 14 weeks</td>\n<td style=\"width: 99.2656px;\">1 year</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false for carriers of cholera?",
    "choices": [
      {
        "id": 1,
        "text": "A convalescent carrier may continue to excrete vibrios for 2-3 weeks."
      },
      {
        "id": 2,
        "text": "Incubatory carriers are potential patients."
      },
      {
        "id": 3,
        "text": "The gall bladder is infected in chronic carriers."
      },
      {
        "id": 4,
        "text": "The antibody titres of a contact carrier is normal while the stool culture is positive."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>antibody titers</strong> of <strong>all carriers</strong> are risen and <strong>positive</strong> till the person harbors the organism.&nbsp;</p>\n<p>A cholera carrier is defined as an apparently healthy person <strong>excreting</strong> <strong>V.cholerae O1 </strong>in<strong> stools</strong>. Selective media and enrichment is needed for their diagnosis. In cholera, 4 types of carriers are described.</p>\n<ol>\n<li><strong>Incubatory/Pre-Clinical carriers</strong>: The duration of carrier state is <strong>1-5 days</strong> (incubation period). They present with symptoms later.</li>\n<li><strong>Convalescent carriers:</strong> Recovered from an attack of cholera, continues to excrete vibrios for <strong>2-3 weeks,</strong> due to ineffective antibiotic treatment.</li>\n<li><strong>Contact/Health carrier:</strong> Due to subclinical infection contracted through a case or an infected environment, may excrete for&nbsp;<strong>10 days.</strong></li>\n<li><strong>Chronic carriers:</strong> Gallbladder is infected, duration may be as long as <strong>10 years.</strong></li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A convalescent carrier of cholera will remain infectious for how many days after recovery?",
    "choices": [
      {
        "id": 1,
        "text": "<7 days"
      },
      {
        "id": 2,
        "text": "7-14 days"
      },
      {
        "id": 3,
        "text": "14-21 days"
      },
      {
        "id": 4,
        "text": "21-28 days"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A <strong>convalescent carrier</strong> of <strong>cholera</strong> will remain <strong>infectious</strong> for&nbsp;<strong>14-21 days</strong> after recovery.</p>\n<p>This type of carrier&nbsp;continues to excrete vibrios after being recovered from an attack of cholera. It is seen due to <strong>ineffective antibiotic treatment</strong>. These carriers can often become chronic or long-term carriers.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is brought to the PHC with acute diarrhea. The doctor based on the history suspects that the child may be suffering from an infection due to shigella over cholera. Which of the following points on the history, apart from bloody stools, favors the doctor's suspicion?",
    "choices": [
      {
        "id": 1,
        "text": "Absence of rectal pain"
      },
      {
        "id": 2,
        "text": "Presence of abdominal cramps"
      },
      {
        "id": 3,
        "text": "Presence of vomiting"
      },
      {
        "id": 4,
        "text": "Presence of fever"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Among the given options, the<strong> presence of fever</strong> favors the suspicion towards <strong>Shigella</strong> as the infectious agent.</p>\n<p>The absence of rectal pain and the presence of vomiting favors cholera while abdominal cramps are present in both of these conditions.</p>\n<p>Symptomatic differential diagnosis of shigella and cholera:</p>\n<table style=\"height: 273px;\" width=\"388\">\n<tbody>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Symptoms</strong></td>\n<td style=\"width: 124px;\"><strong>Cholera</strong></td>\n<td style=\"width: 124px;\"><strong>Shigella</strong></td>\n</tr>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Diarrhea</strong></td>\n<td style=\"width: 124px;\">Acute watery</td>\n<td style=\"width: 124px;\">Acute bloody</td>\n</tr>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Fever</strong></td>\n<td style=\"width: 124px;\">No</td>\n<td style=\"width: 124px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Abdominal cramps</strong></td>\n<td style=\"width: 124px;\">Yes</td>\n<td style=\"width: 124px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Vomiting</strong></td>\n<td style=\"width: 124px;\">Yes</td>\n<td style=\"width: 124px;\">No</td>\n</tr>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Rectal pain</strong></td>\n<td style=\"width: 124px;\">No</td>\n<td style=\"width: 124px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122.667px;\"><strong>Stool</strong></td>\n<td style=\"width: 124px;\">&gt;3 loose stools per day, watery like rice water</td>\n<td style=\"width: 124px;\">&gt; 3 stools/day, with blood or pus.</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following guidelines will you follow to treat a child diagnosed with cholera?",
    "choices": [
      {
        "id": 1,
        "text": "Start ciprofloxacin immediately after admission."
      },
      {
        "id": 2,
        "text": "A cardiotonic should be added if shock persists even after treating with iv fluids."
      },
      {
        "id": 3,
        "text": "If the diarrhoea persists after 48 hours of treatment, suspect resistance."
      },
      {
        "id": 4,
        "text": "Antidiarrheals and antiemetics should be started."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In patients with cholera, if diarrhea persists after <strong>48 hours</strong> of antibiotic therapy, <strong>resistance</strong> to the antibiotic should be suspected.</p>\n<p><strong>Treatment for cholera:</strong></p>\n<ul>\n<li><strong>Rehydration therapy</strong> - is started immediately, either oral or intravenous.</li>\n<li><strong>Antibiotic therapy</strong> -&nbsp;As soon as vomiting has stopped (usually after 3-4 hours of rehydration). Fluoroquinolones, tetracycline, azithromycin, ampicillin, and trimethoprim-sulfamethoxazole are commonly used.</li>\n<li><strong>Shock</strong> in diarrhea must be corrected by <strong>intravenous fluids only.</strong></li>\n</ul>\n<p>Antidiarrhoeals, cardiotonics, antiemetics, antispasmodics, and corticosteroids are <strong>not</strong> used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old man is diagnosed with cholera. Which of the following drug would you prescribe to his family members to prevent the spread of the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Tetracycline"
      },
      {
        "id": 2,
        "text": "Azithromycin"
      },
      {
        "id": 3,
        "text": "Ciprofloxacin"
      },
      {
        "id": 4,
        "text": "Cotrimoxazole"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Tetracycline</strong> is the drug of choice for <strong>chemoprophylaxis</strong> of cholera.</p>\n<p>It should be given for:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Adults - a 3-day period in a twice-daily dose of 500mg</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Children (4-13 years) - 125mg</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Children (0-3 years) - 50mg</li>\n</ul>\n<p><strong>Alternatively</strong>, the long-acting tetracycline (doxycycline) may be used for chemoprophylaxis, if the prevailing strains are not resistant. A single oral dose of <strong>doxycycline</strong> (300 mg for adults and 6 mg/kg for children under 15 years) has proved to be effective.</p>\n<p>Chemoprophylaxis is advised only for <strong>household contacts</strong> or a <strong>closed community </strong>in which cholera has occurred.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most effective prophylactic measure against cholera?",
    "choices": [
      {
        "id": 1,
        "text": "Health education"
      },
      {
        "id": 2,
        "text": "Vaccination"
      },
      {
        "id": 3,
        "text": "Chemoprophylaxis"
      },
      {
        "id": 4,
        "text": "Early case detection"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most important effective</strong>\u00a0measure against cholera is <strong>health education.\u00a0</strong></p>\n<p>The prophylactic measures against <strong>cholera</strong> include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Health education</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Food hygiene practices</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hand washing practices after defecation</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Drinking safe water</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Knowledge about ORS</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a medical officer posted in a village 'X'. The village has been affected by the epidemic of cholera. What is the first step that should be taken to decrease the incidence of the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Safe water supply and sanitation"
      },
      {
        "id": 2,
        "text": "Cholera vaccination to all uninfected individuals"
      },
      {
        "id": 3,
        "text": "Mass chemoprophylaxis"
      },
      {
        "id": 4,
        "text": "Treat everyone in the village with tetracycline"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Safe water supply</strong> and <strong>sanitation</strong> is the <strong>first step</strong> to be taken to <strong>decrease</strong> the <strong>incidence</strong> of cholera.</p>\n<p>Steps taken to decrease the incidence of cholera include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Safe water supply</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Excreta disposal</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Food sanitation</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Disinfection</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Early case detection</li>\n</ul>\n<p><strong>Cholera Vaccines:&nbsp;</strong>available in oral forms</p>\n<ul>\n<li>Dukoral</li>\n<li>Sanchol and mORCVAX</li>\n<li>Euvichol</li>\n<li>Vaxchora</li>\n<li>CVD103-HgR - no longer produced</li>\n</ul>\n<p><strong>Sanchol</strong> and <strong>Euvichol</strong> are available for <strong>mass vaccination</strong> campaigns. The campaigns have been implemented in areas experiencing an <strong>outbreak</strong>, in areas at heightened <strong>vulnerability</strong> during humanitarian <strong>crises</strong>, and among populations living in highly endemic areas, known as <strong>hotspots</strong>.</p>\n<p><strong>Vaxchora</strong> is given for adults (18 &ndash; 64 years) who are <strong>traveling</strong> to an area of active cholera transmission, at least <strong>10 days before</strong> the trip.</p>\n<p><strong>Mass chemoprophylaxis&nbsp;</strong>is <strong>not recommended</strong> for the control of cholera. This is because the drug's effect is only short-lived (a few days). Moreover, for preventing 1 case of cholera, around 10,000 individuals must be given the drug. Chemoprophylaxis is recommended for <strong>only household contacts</strong> of <strong>confirmed cases</strong> with <strong>tetracycline.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the ward, a patient with cholera soils the bed with stools. Which chemical should be used to disinfect the bed?",
    "choices": [
      {
        "id": 1,
        "text": "Bleaching powder"
      },
      {
        "id": 2,
        "text": "Cresol"
      },
      {
        "id": 3,
        "text": "Hydrogen Peroxide"
      },
      {
        "id": 4,
        "text": "Chlorine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most effective <strong>disinfectant</strong> for cholera stool is a <strong>coal</strong> <strong>tar</strong> <strong>disinfectant</strong> with Riedel-Walker <strong>(RW) coefficient</strong> of <strong>&gt;10</strong> such as <strong>cresol</strong>.\u00a0Bleaching powder, if used, should be of good quality.</p>\n<p>For disinfection, attention should be paid to the following: patient's <strong>stools</strong> and <strong>vomit</strong>; <strong>clothes</strong> and other contaminated\u00a0<strong>personal items;</strong>\u00a0the <strong>latrine,</strong>\u00a0the patient's <strong>house,</strong> and neighborhood.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Cholera is a notifiable disease locally and nationally. Which of the following statements is true regarding the international health regulations for the notification of Cholera?",
    "choices": [
      {
        "id": 1,
        "text": "Cholera is notifiable to the WHO by the National Government within 72 hours of its occurence."
      },
      {
        "id": 2,
        "text": "The number of cases and deaths are to be reported daily and weekly till the area is declared free of cholera."
      },
      {
        "id": 3,
        "text": "An area is declared free of cholera when 1 month has elapsed since the last case."
      },
      {
        "id": 4,
        "text": "Mass chemoprophylaxis must be initiated immediately."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The number of cases and deaths due to <strong>cholera</strong> are to be <strong>reported daily and weekly</strong> till the area is declared free of cholera.</p>\n<p><strong>International health regulations</strong> for the notification of Cholera:</p>\n<ul>\n<li>Cholera is notifiable to the <strong>WHO</strong> by the National Government <strong>within 24 hours</strong> of its occurrence.</li>\n<li>The number of cases and deaths due to cholera are to be reported <strong>daily and weekly</strong> till the area is declared free of cholera.</li>\n<li>When twice the incubation period (5 days) i.e. <strong>10 days</strong> has elapsed since the death, recovery, or isolation of the last case, an area is <strong>declared free</strong> of cholera.</li>\n<li>Mass prophylaxis is not advised in cholera, as it fails to stop the spread of the disease. Chemoprophylaxis is only advised for household contacts or a closed community.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy has had 15 episodes of loose stools in the last 24 hours and vomited twice in the last 4 hours. The child is restless and has sunken eyes. On examination, he is irritable but is drinking fluids. What is the optimal therapy for the child?",
    "choices": [
      {
        "id": 1,
        "text": "Intravenous fluids"
      },
      {
        "id": 2,
        "text": "Oral rehydration therapy"
      },
      {
        "id": 3,
        "text": "Intravenous fluid initially for 4 hours followed by oral fluids"
      },
      {
        "id": 4,
        "text": "Intravenous fluids + antibiotic therapy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Oral rehydration therapy</strong> is the <strong>optimal&nbsp;</strong>therapy to treat&nbsp;acute diarrheas in <strong>some dehydration</strong>&nbsp;patients.</p>\n<p><strong>Recommended formulation:&nbsp;</strong>Reduced osmolarity ORS solution, which has a reduced concentration of sodium (75 mmol/liter) and glucose (75 mmol/liter). It helps in reducing the adverse effect of hypertonicity on net fluid absorption.</p>\n<p>According to <strong>IMNCI</strong> guidelines, irritable child who is&nbsp;<strong>able</strong> to drink fluids come under <strong>some dehydration</strong> category.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/12fb0121f03746a282ea92257893c909x510x428.JPEG"
    ]
  },
  {
    "text": "A mother brings her child with complaints of acute diarrhea. After an initial assessment, you diagnose that the child has some dehydration. You counsel the mother to give ORS. After how many hours shall she be advised to discard the old solution and prepare a new one?",
    "choices": [
      {
        "id": 1,
        "text": "4 hours"
      },
      {
        "id": 2,
        "text": "8 hours"
      },
      {
        "id": 3,
        "text": "12 hours"
      },
      {
        "id": 4,
        "text": "24 hours"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The freshly prepared ORS should <strong>not</strong> be used after <strong>24 hours</strong>.</p>\n<p><strong>Guidelines for administering ORS:</strong></p>\n<ul>\n<li>After each loose stool, give:\n<ul>\n<li>Children &lt;2 years of age - 50-100 ml (a quarter to half a large cup) of fluid</li>\n<li>Children 2 to 10 years - 100-200 ml (a half to one large cup)</li>\n<li>Older children and adults - as much fluid as they want</li>\n</ul>\n</li>\n<li>For children &lt;2 years, give a teaspoon every 1 to 2 minutes and offer frequent sips out of a cup for older children. Try to give the<strong> estimated</strong> required amount <strong>within</strong> a <strong>4-hour</strong> period.</li>\n<li>If the child vomits, wait for 10 minutes, then give a spoonful every 2 to 3 minutes.</li>\n<li>If the child wants to drink more ORS solution than the estimated amount and does not vomit, there is no harm in feeding him/her more.</li>\n<li>If the child is breastfeeding, <strong>continue breastfeeding</strong> with ORS solution.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A baby is brought with complaints of diarrhea and vomiting. The weight of the baby is 12 kgs. What is the estimated amount of fluid to be replaced in 4 hours?",
    "choices": [
      {
        "id": 1,
        "text": "0-400 ml"
      },
      {
        "id": 2,
        "text": "400-800 ml"
      },
      {
        "id": 3,
        "text": "800-1200 ml"
      },
      {
        "id": 4,
        "text": "1200-1600 ml"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the guidelines of ORS by WHO, a child with a<strong> weight </strong>of <strong>11-15.9 kg</strong> has to be treated with <strong>800-1200 ml </strong>of ORS solution <strong>within</strong> the <strong>first 4 hours.</strong></p>\n<p>Guidelines for oral rehydration therapy (for all ages) during the first four hours by WHO:</p>\n<table style=\"height: 194px; width: 481px;\">\n<tbody>\n<tr>\n<td style=\"width: 65.75px;\">Age&nbsp;</td>\n<td style=\"width: 63.5625px;\">Under 4 months</td>\n<td style=\"width: 64.1875px;\">4-11 months</td>\n<td style=\"width: 56.4375px;\">1-2 yrs</td>\n<td style=\"width: 60.9375px;\">2-4yrs</td>\n<td style=\"width: 55.75px;\">5-14 yrs</td>\n<td style=\"width: 68.375px;\">15 yrs or over</td>\n</tr>\n<tr>\n<td style=\"width: 65.75px;\">Weight (kg)</td>\n<td style=\"width: 63.5625px;\">under 5&nbsp;</td>\n<td style=\"width: 64.1875px;\">5-7.9</td>\n<td style=\"width: 56.4375px;\">8-10.9</td>\n<td style=\"width: 60.9375px;\">11-15.9</td>\n<td style=\"width: 55.75px;\">16-29.9</td>\n<td style=\"width: 68.375px;\">30 or over</td>\n</tr>\n<tr>\n<td style=\"width: 65.75px;\">ORS solution (ml)</td>\n<td style=\"width: 63.5625px;\">200-400</td>\n<td style=\"width: 64.1875px;\">400-600</td>\n<td style=\"width: 56.4375px;\">600-800</td>\n<td style=\"width: 60.9375px;\">800-1200</td>\n<td style=\"width: 55.75px;\">1200-2200</td>\n<td style=\"width: 68.375px;\">2200-4000</td>\n</tr>\n</tbody>\n</table>\n<p>The patient's <strong>age</strong> should be <strong>used</strong> if weight is not known.</p>\n<p>The approximate amount of ORS required in ml may also be calculated by <strong>75 x body weight (kg).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9-month-old baby with diarrhea is feeding well and is thirsty. Skin pinch when done returns in 2 seconds. What is the treatment?",
    "choices": [
      {
        "id": 1,
        "text": "200-400 ml of ORS to be given in the first four hours."
      },
      {
        "id": 2,
        "text": "400-700 ml of ORS to be given in the first four hours."
      },
      {
        "id": 3,
        "text": "700-900 ml of ORS to be given in the first 4 hours."
      },
      {
        "id": 4,
        "text": "In addition to the usual fluid intake, 100-200 ml should be given after each loose stool."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the <strong>IMNCI</strong> classification, the baby has <strong>some dehydration</strong>&nbsp;and comes under <strong>Plan B</strong>. The amount of ORS given is <strong>75ml/kg</strong> body weight.</p>\n<p>Here, the weight of the child is not specified. Hence,&nbsp;<strong>400-700 ml</strong> of ORS at home is to be given in the <strong>first four hours </strong>according to the&nbsp;<strong>age&nbsp;</strong>of the child.&nbsp;The below table shows the amount of ORS to be given according to the age of the child.</p>\n<table style=\"height: 158px;\" width=\"660\">\n<tbody>\n<tr>\n<td style=\"width: 87.7109px;\"><strong>Age</strong></td>\n<td style=\"width: 87.7109px;\">under 4 months</td>\n<td style=\"width: 87.7109px;\">4-11 months</td>\n<td style=\"width: 87.7109px;\">1-2 years</td>\n<td style=\"width: 87.7109px;\">2-4 years</td>\n<td style=\"width: 87.7109px;\">5-14 years</td>\n<td style=\"width: 87.7344px;\">15 years and over</td>\n</tr>\n<tr>\n<td style=\"width: 87.7109px;\"><strong>Weight(kg)</strong></td>\n<td style=\"width: 87.7109px;\">under 5</td>\n<td style=\"width: 87.7109px;\">5-7.9</td>\n<td style=\"width: 87.7109px;\">8-10.9</td>\n<td style=\"width: 87.7109px;\">11-15.9</td>\n<td style=\"width: 87.7109px;\">16-29.9</td>\n<td style=\"width: 87.7344px;\">30 or over</td>\n</tr>\n<tr>\n<td style=\"width: 87.7109px;\"><strong>ORS solution (ml)</strong></td>\n<td style=\"width: 87.7109px;\">200-400</td>\n<td style=\"width: 87.7109px;\">400-600</td>\n<td style=\"width: 87.7109px;\">600-800</td>\n<td style=\"width: 87.7109px;\">800-1200</td>\n<td style=\"width: 87.7109px;\">1200-2200</td>\n<td style=\"width: 87.7344px;\">2200-4000</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>In addition to this, 50-100 ml extra fluid is given after each loose stool. After four hours, the baby is reassessed and the appropriate plan is selected again for the continuation of the treatment.</p>\n<p>The four rules of home treatment are:</p>\n<ul>\n<li>Give extra fluid</li>\n<li>Give zinc supplements (1 tablet per day for 14 days, dissolved in a small amount of ORS or breast milk or clean water)</li>\n<li>Continue breastfeeding</li>\n<li>Counsel the mother to return if there is blood in stools and if the child is feeding poorly</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29e4fb807eef409285f789dc6b929f0ex780x458.JPEG"
    ]
  },
  {
    "text": "Which among the following home remedies are not advised for a child with diarrhea?",
    "choices": [
      {
        "id": 1,
        "text": "A mixture of 1 teaspoon of  salt and 6 teaspoons of sugar in 1 L of drinking water"
      },
      {
        "id": 2,
        "text": "Unsalted water in which a cereal has been cooked"
      },
      {
        "id": 3,
        "text": "Salted coconut water"
      },
      {
        "id": 4,
        "text": "Soup with 3g/litre salt added to it"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Salted</strong> water in which cereal has been cooked can be given to a child with diarrhoea.</p>\n<p>If the WHO ORS mixture is not available, a simple mixture of <strong>1 teaspoon of salt and 6 teaspoons of sugar </strong>must be dissolved<strong> in 1 L </strong>of drinking<strong> water</strong> and given to the child.</p>\n<p>Fluids that do <strong>not</strong> contain <strong>salt</strong> in water, for eg: rice water, unsalted soup, yoghurt drinks, green coconut water, etc, must <strong>not</strong> be <strong>given</strong>.&nbsp;<strong>3g/litre</strong> of <strong>salt</strong> must be added to such drinks before giving it to the child with diarrhoea.</p>\n<p>The infant's usual diet of cereals, vegetables and other foods should be continued and <strong>never be diluted</strong>. The child should be given as much nutrient-rich food as acceptable.</p>\n<p>Avoid the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Sweetened drinks with sugar, like commercial fruit juices and sweetened tea, as they lead to <strong>osmotic diarrhoea</strong> and <strong>hypernatremia</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Fluids with a stimulant and purgative effect like coffee and medicinal tea infusions.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with severe dehydration is being treated with intravenous fluids for the past 2 hours. Which of the following will be used as an early indicator for adequate rehydration?",
    "choices": [
      {
        "id": 1,
        "text": "Skin elasticity"
      },
      {
        "id": 2,
        "text": "Presence of tears"
      },
      {
        "id": 3,
        "text": "Urine flow rate"
      },
      {
        "id": 4,
        "text": "Moistness of tongue"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Skin elasticity</strong> and <strong>pulse strength</strong> are the most helpful indicators for <strong>adequate</strong> intravenous <strong>rehydration.</strong></p>\n<p>The <strong>urine output</strong> may be <strong>unchanged</strong> even after <strong>3-4 hours</strong> of adequate rehydration. Hence, it cannot be a criterion for continuous examination.</p>\n<p>The initial rehydration must be fast until an easily palpable pulse is present. Reassess the patient every 1-2 hours.</p>\n<p>After 1-2 liters of fluid have been infused, the drip should be slowed down till the blood pressure and pulse return to normal. Rehydration must be continued otherwise till all signs of dehydration have disappeared. ORS should be given when the patient can drink oral fluids.</p>\n<p><strong>Puffy eyelids</strong>&nbsp;are a sign of <strong>excess rehydration</strong> and intravenous fluids must be <strong>stopped</strong> when it occurs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 15-year-old boy is referred from a sub-center due to a feeble pulse and low BP. The patient has had diarrhea for 2 days. He has sunken eyes and is lethargic. On examination, BP is 90/60 mmHg. Which of the following fluids cannot be used for resuscitation in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hartmann's solution"
      },
      {
        "id": 2,
        "text": "Diarrhoea treatment solution"
      },
      {
        "id": 3,
        "text": "Normal saline"
      },
      {
        "id": 4,
        "text": "Dextrose solution"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient has <strong>severe dehydration</strong> which is treated by giving IV fluids.&nbsp;<strong>Plain glucose</strong> and <strong>dextrose</strong> solutions should <strong>not</strong> be used as they <strong>worsen</strong> the <strong>hyperosmolar</strong> state.</p>\n<p>Intravenous rehydration: Used for initial rehydration for patients in <strong>shock</strong> or those who are unable to drink.</p>\n<ul>\n<li><strong>Ringer's lactate solution</strong>/<strong>Hartmann's solution </strong>- Used&nbsp;for injection. Best commercially available solution.&nbsp;</li>\n<li><strong>Diarrhea treatment solution</strong>- Recommended as an ideal polyelectrolyte solution for intravenous infusion.</li>\n<li><strong>Normal saline</strong>- Used if nothing else is available. It is the poorest fluid, as it does not correct the acidosis and will not replace the potassium losses.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the recommended dosage for zinc supplements in children with diarrhea?",
    "choices": [
      {
        "id": 1,
        "text": "20 mg of zinc daily for infants < 12 months of age for 10-14 days"
      },
      {
        "id": 2,
        "text": "20 mg of zinc for children > 6 months of age for 7 days"
      },
      {
        "id": 3,
        "text": "10 mg of zinc for children > 12 months of age for 20 days"
      },
      {
        "id": 4,
        "text": "10 mg of zinc for children < 6 months of age for 10-14 days"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>According to WHO and UNICEF, <strong>10 mg of zinc</strong> is given to infants<strong>&nbsp;&lt; 6 months </strong>of age for 10-14 days.</p>\n<p><strong>20 mg of Zinc</strong> is given to infants<strong> &gt; 6 months </strong>of age for <strong>10-14 days</strong> during an episode of acute diarrhoea. This is done to reduce the duration and severity&nbsp;of the episode and prevent recurrence in the following months.</p>\n<p><strong>Intensified Diarrhea Control Fortnight :&nbsp;</strong>The goal is to attain zero child deaths due to childhood diarrhea.&nbsp;<span class=\"s1\">The overall objective of IDCF is to ensure high coverage of ORS and Zinc use rates in children with diarrhoea. It also&nbsp;</span><span class=\"s2\">complements awareness activities (including Swachh) for prevention and management of diarrhoea in under-five children.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For a child with SAM, what should be the sodium content of his rehydration fluid?",
    "choices": [
      {
        "id": 1,
        "text": "90 mmol/L"
      },
      {
        "id": 2,
        "text": "60 mmol/L"
      },
      {
        "id": 3,
        "text": "45 mmol/L"
      },
      {
        "id": 4,
        "text": "75 mmol/L"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>sodium</strong> content of the&nbsp;<strong>rehydration</strong> solution to treat <strong>SAM</strong> is <strong>45mmol/L.</strong></p>\n<p><strong>ReSoMal</strong>&nbsp;(rehydration solution for malnourished children) contains a lower amount of<strong> sodium (45mmol/L)</strong> and a higher amount of<strong> potassium (40 mmol/L) </strong>than the standard WHO-ORS.</p>\n<p>ReSoMal&nbsp;is used in in-patient centers for the treatment of children with severe acute malnutrition (SAM). It is useful in correcting <strong>hypokalemia,</strong> and in <strong>lowering</strong> the risks of <strong>excess sodium</strong> and/or overhydration.</p>\n<p>Composition of ReSoMal and ORS:</p>\n<table style=\"height: 300px; width: 324px;\">\n<tbody>\n<tr>\n<td style=\"width: 120px;\"><strong>Component (mmol/l)</strong></td>\n<td style=\"width: 88px;\"><strong>Standard ORS</strong></td>\n<td style=\"width: 98px;\"><strong>ReSoMal</strong></td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Glucose</td>\n<td style=\"width: 88px;\">75 (anhydrous)</td>\n<td style=\"width: 98px;\">125</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Sodium</td>\n<td style=\"width: 88px;\">75</td>\n<td style=\"width: 98px;\">45</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Potassium</td>\n<td style=\"width: 88px;\">20</td>\n<td style=\"width: 98px;\">40</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Chloride</td>\n<td style=\"width: 88px;\">65</td>\n<td style=\"width: 98px;\">70</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Citrate&nbsp;</td>\n<td style=\"width: 88px;\">10</td>\n<td style=\"width: 98px;\">7</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Magnesium</td>\n<td style=\"width: 88px;\">-</td>\n<td style=\"width: 98px;\">3</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Zinc</td>\n<td style=\"width: 88px;\">-</td>\n<td style=\"width: 98px;\">0.3</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Copper</td>\n<td style=\"width: 88px;\">-</td>\n<td style=\"width: 98px;\">0.045</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Osmolality</td>\n<td style=\"width: 88px;\">245</td>\n<td style=\"width: 98px;\">300</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the average incubation period of typhoid fever?",
    "choices": [
      {
        "id": 1,
        "text": "10-14 days"
      },
      {
        "id": 2,
        "text": "3-5 days"
      },
      {
        "id": 3,
        "text": "21-25 days"
      },
      {
        "id": 4,
        "text": "7-10 days"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The average <strong>incubation</strong> period of <strong>typhoid</strong> is <strong>10-14 days. </strong></p>\n<p>However, it can vary from <strong>3 days</strong> to <strong>3 weeks</strong> depending on the dose of <strong>bacilli ingested</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a boys hostel, there has been an outbreak of typhoid. The hostel cook is identified as the carrier of the disease. Which is true among the following statements regarding her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gallbladder is usually not involved in carrier state"
      },
      {
        "id": 2,
        "text": "Chronic carriers are those who excrete the bacilli for more than a year"
      },
      {
        "id": 3,
        "text": "Tetracycline is the drug of choice for carriers"
      },
      {
        "id": 4,
        "text": "To treat the carrier state, treatment should be given for 4 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Chronic</strong> carriers of typhoid are those who excrete the bacilli for <strong>more</strong> than a <strong>year.</strong></p>\n<p><strong>Convalescent</strong> carriers excrete bacilli for <strong>6-8 weeks</strong> and chronic carriers excrete for more than a year. The carrier rate in <strong>females</strong> is <strong>higher.</strong> Gallbladder and biliary tract are affected.&nbsp;</p>\n<p>To treat the carrier state, an intensive course of <strong>ampicillin or amoxicillin</strong> (4-6 g a day) together <strong>with Probenecid</strong> (2 g/day) for <strong>6 weeks</strong> is given. <strong>Cholecystectomy</strong> with concomitant ampicillin therapy is the most <strong>successful</strong> treatment for the carrier state.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following patients can the Ty21a vaccine be administered?",
    "choices": [
      {
        "id": 1,
        "text": "A 50-year-old HIV patient who is asymptomatic with CD4+ count 240/mm3"
      },
      {
        "id": 2,
        "text": "A 42-year-old patient with fever and cough for 3 days"
      },
      {
        "id": 3,
        "text": "A 25-year-old woman suffering from amoebiasis"
      },
      {
        "id": 4,
        "text": "A 64-years-old alcoholic on colchicine therapy for acute gout"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ty21a</strong> vaccine <strong>can</strong> be administered in an <strong>HIV-positive asymptomatic</strong> patient as long as the <strong>CD4+</strong> count is <strong>&gt;200/ cubic mm</strong>.&nbsp;</p>\n<p><strong>Ty21a</strong> is an oral vaccine for individuals <strong>&ge;5 years</strong> of age. It is given in <strong>3</strong> doses on the&nbsp;<strong>1st, 3rd, and 5th</strong> day. Repeat every 3 years for endemic areas, and every year for traveling individuals.&nbsp;</p>\n<p>It is not recommended in:</p>\n<ul>\n<li>Patients on <strong>antimitotic</strong> drugs and immunosuppressants</li>\n<li><strong>Acute febrile</strong> illness</li>\n<li><strong>Acute intestinal</strong> infestation</li>\n</ul>\n<p><strong>Proguanil</strong> and <strong>antibacterial</strong> drugs should be <strong>stopped</strong> from 3 days before to 3 days after the vaccine.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding dracunculiasis?",
    "choices": [
      {
        "id": 1,
        "text": "India has eliminated the disease."
      },
      {
        "id": 2,
        "text": "Niridazole prevents transmission of the disease."
      },
      {
        "id": 3,
        "text": "The disease is limited to tropical and subtropical regions."
      },
      {
        "id": 4,
        "text": "No animal reservoir has been proved."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Niridazole</strong> does <strong>not</strong> prevent <strong>transmission</strong> of the disease.&nbsp;</p>\n<p>Dracunculiasis is <strong>treated</strong> by removing the worm by sequentially <strong>rolling</strong> them out over a small stick. <strong>Wet compresses</strong> may relieve discomfort. <strong>Occlusive dressings</strong> limit shedding of infectious larvae.</p>\n<p><strong>Metronidazole</strong> and <strong>mebendazole</strong> are used to <strong>limit inflammation</strong> and facilitate worm removal.</p>\n<p>Dracunculiasis or Guinea-worm disease is amenable to eradication. The eradication strategy comprises the following elements :</p>\n<ul>\n<li>Provision of safe drinking water.</li>\n<li>Control of cyclops.</li>\n<li>Health education regarding drinking boiled water.</li>\n<li>Surveillance: Active search for new cases.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about hookworms?",
    "choices": [
      {
        "id": 1,
        "text": "Blood loss due to Necator americanus infection is more compared to Ancylostoma infection."
      },
      {
        "id": 2,
        "text": "Malnutrition is a predisposing factor for this chronic disabling disease."
      },
      {
        "id": 3,
        "text": "Chandler\u2019s index is used in epidemiological studies of hookworm."
      },
      {
        "id": 4,
        "text": "Chronic blood loss in pregnant women may lead to abortions, stillbirth and low birth weight babies."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The blood loss due to <strong>Ancylostoma (0.2 ml/day)</strong> is more compared to <strong>Necatur americanus (0.03ml/day)</strong></p>\n<p><strong>Malnutrition</strong> is a <strong>predisposing</strong> factor. The chronic disabling disease does not occur in individuals who are well-nourished and whose iron intake is adequate.</p>\n<p><strong>Chandler's index</strong> is used to identify importance of <strong>hookworm</strong> infestation as a <strong>public health</strong> problem. It is calculated as average number of <strong>hookworm eggs/gram of stool</strong>.&nbsp;</p>\n<ul>\n<li>&lt;200: no significance</li>\n<li>200-250: the potential danger</li>\n<li>250-300: minor public health problem</li>\n<li>&gt;300: major public health problem</li>\n</ul>\n<p>Hookworm inection causes <strong>chronic</strong> blood loss and depletion of body's iron stores leading to <strong>iron deficiency</strong> anemia. This in pregnant women can lead to abortions, stillbirth and low birth weight babies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '16 Intestinal Infections';
        const quizFilename = '16-intestinal-infections-d3d350f6.html';
        let hierarchy = ["Marrow", "qBank", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>