<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tumor Markers Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A woman was diagnosed to have metastatic liver adenocarcinoma with CK 7 (+) and CK20 (-) IHC markers. Which of the following is the most likely primary site of origin for this metastasis?",
    "choices": [
      {
        "id": 1,
        "text": "Lung carcinoma"
      },
      {
        "id": 2,
        "text": "Colorectal Carcinoma"
      },
      {
        "id": 3,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 4,
        "text": "Cholangiocarcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely origin of metastasis is <strong>lung carcinoma, </strong>as the IHC of the metastatic tumor revealed CK 7 (+) and CK20 (-).</p>\n<p>Cytokeratin profiles of various primary tumors:</p>\n<table style=\"height: 497.976px; width: 468px;\">\n<tbody>\n<tr style=\"height: 117.195px;\">\n<td style=\"width: 185.375px; height: 117.195px;\">\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 7 Positive</p>\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 20 Positive</p>\n</td>\n<td style=\"width: 254.031px; height: 117.195px;\">\n<ul>\n<li><strong>Cholangiocarcinoma</strong></li>\n<li>Ovarian mucinous carcinoma</li>\n<li>Transitional cell carcinoma</li>\n<li>Pancreatic adenocarcinoma</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 188.789px;\">\n<td style=\"width: 185.375px; height: 188.789px;\">\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 7 <strong>Positive\u00a0</strong></p>\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 20 <strong>Negative</strong></p>\n</td>\n<td style=\"width: 254.031px; height: 188.789px;\">\n<ul>\n<li>Breast carcinoma</li>\n<li>Ovarian serous adenocarcinoma</li>\n<li>Thyroid carcinoma</li>\n<li><strong>Lung carcinoma</strong></li>\n<li>Thymoma</li>\n<li>Endometrial carcinoma</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 92.7969px;\">\n<td style=\"width: 185.375px; height: 92.7969px;\">\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 7 Negative</p>\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 20 Positive</p>\n</td>\n<td style=\"width: 254.031px; height: 92.7969px;\">\n<ul>\n<li><strong>Colorectal adenocarcinoma</strong></li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 99.1953px;\">\n<td style=\"width: 185.375px; height: 99.1953px;\">\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 7 Negative</p>\n<p>\u00a0 \u00a0 \u00a0 \u00a0 CK 20 Negative</p>\n</td>\n<td style=\"width: 254.031px; height: 99.1953px;\">\n<ul>\n<li>Hepatocellular carcinoma</li>\n<li><strong>Renal cell carcinoma</strong></li>\n<li>Prostatic adenocarcinoma</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The image given below shows an H&E-stained section of a lung tumor. The immunohistochemical studies of this tumor are most likely to express which of the following tumor markers?",
    "choices": [
      {
        "id": 1,
        "text": "Alpha-fetoprotein"
      },
      {
        "id": 2,
        "text": "Calretinin"
      },
      {
        "id": 3,
        "text": "Carcinoembryonic antigen"
      },
      {
        "id": 4,
        "text": "Cytokeratins"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above H&amp;E stained histopathological image of a lung tumor shows <strong>keratin pearls</strong> suggestive of <strong>squamous</strong> <strong>cell</strong> <strong>carcinoma</strong>. <strong>Cytokeratins</strong> are the tumor markers that are most likely to be expressed.</p>\n<p>Cytokeratins are the intermediate filaments expressed by <strong>epithelial</strong> <strong>cells</strong>. The presence of cytokeratins on immunohistochemistry suggests a carcinoma of epithelial origin. Tumors of <strong>epithelial origin</strong> include <strong>squamous cell carcinoma</strong>, basal cell carcinoma, malignant melanoma etc.</p>\n<p>Squamous cell carcinoma of the lung is commonly seen in men and has an increased risk with smoking. The tumor appears like a cauliflower-like mass that is gray-white, firm to hard, and bulky with hemorrhage or necrosis.&nbsp;Histopathological features include keratinization in the form of <strong>squamous pearls. </strong>The cells have eosinophilic cytoplasm.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Alpha-fetoprotein</strong> is a marker for <strong>hepatocellular carcinoma</strong> and<strong> non-seminomatous germ cell tumors</strong> of the testis.&nbsp;</p>\n<p>Option B: <strong>Calretinin</strong> serves as a marker for <strong>mesothelioma.</strong></p>\n<p>Option C:<strong> Carcinoembryonic</strong> <strong>antigen</strong> (CEA) is a marker for <strong>colon</strong> carcinoma and other malignancies including the&nbsp;<strong>pancreas, stomach</strong>, and <strong>heart.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e539f02914254a399461c5a6f685ca8e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old postmenopausal woman presented to the clinic with a history of a lump in her right breast for six months. Radiological examination showed an irregular spiculated lesion of 8 mm with microcalcification. A biopsy was taken, and the immunohistochemistry results revealed that the cell membrane was stained brown. Identify the pathophysiological mechanism of the underlying condition.",
    "choices": [
      {
        "id": 1,
        "text": "ERBB2 gene amplification"
      },
      {
        "id": 2,
        "text": "Point mutation of JAK2 receptor gene"
      },
      {
        "id": 3,
        "text": "Point mutation of EGFR tyrosine kinase"
      },
      {
        "id": 4,
        "text": "N-myc amplification"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mechanism of neoplasia(underlying condition) here is due to the <strong>amplification</strong> of the <strong>ERBB2</strong> gene, resulting in <strong>abnormal</strong> <strong>HER2neu</strong> <strong>receptors</strong>.</p>\n<p>The given clinical stem is suggestive of\u00a0<strong>invasive breast carcinoma</strong>. The radiological imaging with irregular, spiculated margins and microcalcifications is an indication for biopsy for further assessment. In the <strong>immunohistochemistry studies,\u00a0</strong>the cell membrane is stained <strong>brown</strong>, indicating a <strong>HER2neu</strong>-<strong>positive tumour.</strong> <strong>Fluorescent in situ hybridisation (FISH)</strong> can be used adjunctively to confirm the diagnosis. HER2-positive is the second most common molecular subtype of invasive breast cancer.</p>\n<p>HER2 receptors (also known as ERBB2) is a receptor tyrosine kinase that promotes cell proliferation and opposes apoptosis by stimulating the RAS- and PI3K-AKT signalling pathways.\u00a0</p>\n<p><strong>Immunohistochemistry staining of breast carcinoma -\u00a0</strong></p>\n<ul>\n<li>The <strong>Estrogen receptor (ER)</strong> and<strong> Progesterone receptor (PR)</strong> are nuclear receptors, and the <strong>nucleus</strong> is stained brown.</li>\n<li>The<strong> human epidermal growth factor receptor type 2 (HER2)</strong> is a membrane receptor. Hence, the <strong>cell membrane</strong> is stained brown if positive.</li>\n</ul>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>The image below shows positive and negative staining for ER, PR, and HER2.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73585e3f88ba4281aaf80a529428b930x243x199.JPEG"
    ]
  },
  {
    "text": "Which of the following tumor markers is least useful in assessing dysgerminoma?",
    "choices": [
      {
        "id": 1,
        "text": "Lactate dehydrogenase"
      },
      {
        "id": 2,
        "text": "Alpha-fetoprotein"
      },
      {
        "id": 3,
        "text": "Placental alkaline phosphatase"
      },
      {
        "id": 4,
        "text": "Beta-hCG"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Alpha-fetoprotein </strong>(AFP) is not a useful marker for dysgerminoma; it is a marker for <strong>endodermal sinus tumors</strong>.\u00a0Dysgerminoma<strong>\u00a0</strong>secretes placental alkaline phosphatase, lactate dehydrogenase (LDH), and \u03b2-hCG.</p>\n<p><strong>Dysgerminoma</strong> is a type of germ cell tumor corresponding to the testis's seminoma. It does not secrete either male or female sex hormones. It secretes <strong>placental</strong> <strong>alkaline phosphatase</strong> (ALP), <strong>lactate dehydrogenase</strong> (LDH), and <strong>\u03b2-hCG</strong>.\u00a0Serum <strong>lactate dehydrogenase (LDH)</strong> is usually\u00a0used to monitor\u00a0these patients for disease recurrence.</p>\n<p><strong>Endodermal sinus tumor/ Yolk sac tumor\u00a0</strong>is a type of ovarian germ cell tumor<strong>\u00a0</strong>that is seen in premenarchal girls.\u00a0<strong>Schiller-Duval\u00a0bodies</strong>\u00a0are pathognomonic in histopathology.\u00a0<strong>Alpha-fetoprotein </strong>(AFP) is commonly produced by this tumor and is used as a tumor marker.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of these tumor markers is elevated in carcinoma breast?",
    "choices": [
      {
        "id": 1,
        "text": "CA-125"
      },
      {
        "id": 2,
        "text": "CA-19-9"
      },
      {
        "id": 3,
        "text": "CA-15-3"
      },
      {
        "id": 4,
        "text": "CA-72-4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>CA-15-3</strong> is elevated in <strong>carcinoma breast</strong>.</p>\n<p>Tumor markers play a crucial role in <strong>identifying cancer</strong> and are often beneficial for monitoring a tumor's reaction to <strong>treatment</strong> and detecting its\u00a0<strong>recurrence</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old female was diagnosed with thyroid carcinoma. The histopathological image is shown below. Which of the following is correct regarding the management of this subtype of thyroid carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Prophylactic neck dissection is not indicated"
      },
      {
        "id": 2,
        "text": "Paclitaxel is the drug of choice for metastatic disease"
      },
      {
        "id": 3,
        "text": "Postoperative management includes Radioactive Iodine Ablation (RAI)"
      },
      {
        "id": 4,
        "text": "Calcitonin and CEA levels testing are used for the follow-up"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The histopathology image shows <strong>amyloid-rich stroma</strong> and spindle cells, which are characteristic of <strong>Medullary Thyroid Carcinoma (MTC).</strong>\u00a0<strong>Calcitonin</strong> and <strong>CEA</strong> are used for the <strong>follow-up</strong> of Medullary Thyroid Carcinoma (MTC) patients.\u00a0</p>\n<p>Medullary Thyroid Carcinoma (MTC) arises from the <strong>parafollicular </strong>or<strong> C cells</strong> of the thyroid, which are concentrated <strong>superolateral</strong> in the thyroid and are derived from the <strong>neural crest</strong>.\u00a0MTC usually occurs in a <strong>sporadic</strong> form (80%). It can also occur as inherited syndromes such as <strong>Familial MTC, MEN2A, </strong>and <strong>MEN2B</strong>. All these variants are associated with germline mutations in the <strong>RET proto-oncogene.</strong></p>\n<p>Clinical features of\u00a0Medullary Thyroid Carcinoma (MTC) include,</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>50-60 years</strong> of age (<strong>younger</strong> age in <strong>familial</strong> MTC)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Mostly <strong>unilateral</strong> (<strong>bilateral</strong> and <strong>multicentric</strong> in<strong> familial</strong> MTC)\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Palpable mass</strong> in the thyroid</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cervical lymphadenopathy</strong> is common</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hematogenous spread is also seen. The most common distant metastasis is seen in <strong>Liver</strong> &gt; Bones (<strong>osteoblastic</strong>).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dysphagia, dyspnea, or dysphonia (due to local invasion)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Diarrhea</strong> may occur in 30% of cases (due to <strong>5-hydroxytryptamine</strong> or<strong> prostaglandins</strong> secreted by tumour cells)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Some develop <strong>Cushing\u2019s</strong> syndrome (due to <strong>ectopic adrenocorticotropic hormone</strong>)</li>\n</ul>\n<p>Medullary Thyroid Carcinoma (MTC) secretes <strong>calcitonin, carcinoembryonic antigen (CEA)</strong>, and other peptides such as <strong>calcitonin gene-related</strong> <strong>peptides, serotonin, prostaglandins E2 and F2\u03b1, </strong>and<strong> histaminadases.</strong></p>\n<p><strong>Diagnosis</strong>\u00a0is made based on the <strong>clinical features</strong>, <strong>raised serum calcitonin</strong>, or <strong>CEA</strong> levels, and <strong>FNAB</strong> cytology.</p>\n<p>All<strong> new patients</strong> with MTC should be <strong>screened for</strong> <strong>RET</strong> point mutations, <strong>pheochromocytoma</strong>, and <strong>hyperparathyroidism</strong>. If patients are found to have a pheochromocytoma, it must be treated first.</p>\n<p><strong>Pentagastrin</strong> (synthetic gastrin analogue), which<strong> increases</strong> the basal rate of <strong>calcitonin</strong> secretion, was formerly used to screen patients with Familial Medullary Thyroid Carcinoma (MTC). <strong>RET testing</strong> has replaced <strong>pentagastrin</strong> or <strong>calcium-stimulated calcitonin</strong> levels testing in the screening of patients with familial MTC.</p>\n<p><strong>Management</strong>\u00a0of\u00a0Medullary Thyroid Carcinoma (MTC) is as follows:</p>\n<table style=\"height: 113px; width: 611px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; height: 18px; width: 195px;\"><strong>Extent of cancer</strong></td>\n<td style=\"text-align: center; height: 18px; width: 402px;\"><strong>Surgery\u00a0</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"height: 46px; width: 195px;\">\n<p>MTC without LN involvement</p>\n</td>\n<td style=\"height: 46px; width: 402px;\">Total thyroidectomy + <strong>Central neck dissection (prophylactic)</strong>(Option A)</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"height: 34px; width: 195px;\">\n<p>MTC + <strong>central neck nodes</strong> involved or tumor size\u00a0<strong>\u22651.5 cm</strong></p>\n</td>\n<td style=\"height: 34px; width: 402px;\">Total thyroidectomy + Central neck dissection (therapeutic) +<strong> Ipsilateral Modified radical neck dissection (prophylactic)</strong></td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"height: 19px; width: 195px;\">\n<p>MTC + <strong>other LNs i</strong>nvolved</p>\n</td>\n<td style=\"height: 19px; width: 402px;\">Total thyroidectomy + Central neck dissection + <strong>Bilateral Modified radical neck dissection (therapeutic)</strong></td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"height: 19px; width: 195px;\">\n<p><strong>Metastatic</strong> disease</p>\n</td>\n<td style=\"height: 19px; width: 402px;\">\n<p>\u00a0</p>\n<ul>\n<li><strong>Debulking thyroidectomy</strong></li>\n<li><strong>Chemotherapy</strong> -</li>\n</ul>\n<ul style=\"list-style-type: circle;\">\n<ul style=\"list-style-type: circle;\">\n<li><strong>Vandetanib </strong>(multi-kinase inhibitor) - <strong>drug of choice\u00a0</strong></li>\n<li>Labetuzumab (anti-CEA)</li>\n</ul>\n</ul>\n<ul>\n<li>External beam radiotherapy</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>There is no role of <strong>Radioactive Iodine Ablation (RAI) </strong>(Option C)\u00a0in MTC as the tumor is not TSH-dependent and doesn\u2019t take up radioactive iodine.</p>\n<p><strong>Annual calcitonin </strong>and <strong>CEA</strong> level testing\u00a0is used for the <strong>follow-up</strong> of Medullary Thyroid Carcinoma (MTC) patients. Imaging (USG/CT neck and mediastinum, FDG-PET/CT scans) is also useful.</p>\n<p>Other options:</p>\n<p>Option B - <strong>Paclitaxel</strong> is used for adjunctive chemotherapy (Adriamycin + Paclitaxel/Cisplatin) in Anaplastic thyroid carcinoma (ATC). It is not a valid chemotherapy option for\u00a0Medullary Thyroid Carcinoma (MTC).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/35f2dce4dbbe4001b0f8332a78aaab16.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old patient was found to have a PSA  of 5.6 ng/ml on routine examination and was advised to undergo a TRUS-guided transrectal biopsy. What is the standard biopsy template?",
    "choices": [
      {
        "id": 1,
        "text": "6 biopsies form 3 areas"
      },
      {
        "id": 2,
        "text": "6 biopsies from 6 areas"
      },
      {
        "id": 3,
        "text": "12 biopsies from 6 areas"
      },
      {
        "id": 4,
        "text": "12 biopsies from 12 areas"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The standard biopsy template usually includes <strong>12 biopsies taken from six areas.</strong></p>\n<p class=\"p1\">Patients who have either an <strong>elevated total PSA level</strong> (i.e. over 2.5 - 4.0 ng/ml) or <strong>abnormal findings</strong> on digital rectal examination (<strong>DRE</strong>) <strong>or both</strong> are advised to undergo <strong>TRUS-guided biopsy</strong> of the prostate.</p>\n<p class=\"p1\">The standard biopsy template involves <strong>12 core biopsies</strong>\u00a0with a spring-loaded biopsy instrument.</p>\n<p class=\"p1\"><strong>Site of biopsy</strong>: The tissue is usually obtained from the <strong>base, mid,</strong> and <strong>apex</strong> regions, medially and laterally from the left and right sides.</p>\n<p class=\"p1\">Patients are asked to <strong>stop anticoagulants</strong> to prevent bleeding complications.</p>\n<p class=\"p1\">Common <strong>adverse effects</strong> that follow TRUS biopsy include rectal bleeding, gross hematuria, and hematospermia, all of which are usually self-limited. Fever, urinary infection and retention occur in less than 5% of patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents with complaints of fatigue, pain over the ribs, and confusion. Laboratory investigations reveal anemia, hypercalcemia, and increased serum creatinine level. The peripheral smear shows the finding given below. The international prognostic staging system for this disease is based on the levels of which of the following parameters?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b22\u00a0microglobulin\u00a0and albumin"
      },
      {
        "id": 2,
        "text": "\u03b22\u00a0microglobulin and serum creatinine"
      },
      {
        "id": 3,
        "text": "\u03b22\u00a0glycoprotein and plasma light chains"
      },
      {
        "id": 4,
        "text": "\u03b22\u00a0glycoprotein and serum creatinine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario and peripheral smear showing a <strong>Mott cell</strong>\u00a0suggest a probable diagnosis of <strong>multiple myeloma.\u00a0</strong>The international prognostic staging system for multiple myeloma is based on<strong>\u00a0</strong>levels of<strong> \u03b22\u00a0microglobulin\u00a0and albumin.</strong></p>\n<p><strong>Mott cells </strong>are plasma cells with globular <strong>cytoplasmic inclusions</strong>\u00a0containing\u00a0<strong>immunoglobulins</strong>\u00a0called\u00a0<strong>Russell bodies</strong>. They may be seen in African trypanosomiasis and multiple myeloma.</p>\n<p>Multiple myeloma is a\u00a0<strong>plasma cell dyscrasia</strong>\u00a0in which there is an\u00a0<strong>unregulated proliferation of plasma cells</strong>. The proliferating cells stimulate osteoclastic activity and suppress osteoblastic activity, leading to the formation of\u00a0<strong>multiple lytic bone lesions</strong>. These lesions can be seen on radiographs as '<strong>punched out' lesions.</strong>\u00a0 In some severe cases, patients may present with pathological fractures.\u00a0</p>\n<p>Other features of multiple myeloma:</p>\n<ul>\n<li aria-level=\"1\">Acute renal failure in a dehydrated state</li>\n<li aria-level=\"1\"><strong>Normocytic normochromic anemia</strong>\u00a0</li>\n<li aria-level=\"1\"><strong>Hyperviscosity syndromes</strong>\u00a0cause headache, exacerbation, or precipitation of heart failure,\u00a0<strong>visual disturbances</strong>, ataxia, and vertigo</li>\n<li aria-level=\"1\">Bony damage leading to cord compression</li>\n<li aria-level=\"1\">Carpal tunnel syndrome</li>\n<li aria-level=\"1\"><strong>Sensory</strong>\u00a0more than motor\u00a0<strong>neuropathy</strong>\u00a0associated with IgM directed against myelin-associated globulin</li>\n</ul>\n<p>The single\u00a0<strong>most important predictor</strong>\u00a0for\u00a0<strong>survival</strong>\u00a0is\u00a0<strong>serum \u03b2<sub>2</sub>-microglobulin</strong>.\u00a0<strong>Serum \u03b2<sub>2</sub>-microglobulin</strong>, along with\u00a0<strong>serum albumin,</strong>\u00a0forms the basis of the\u00a0<strong>International Staging System</strong>\u00a0for multiple myeloma that\u00a0<strong>predicts survival</strong>.</p>\n<p><strong>International Staging System (ISS) for multiple myeloma:</strong></p>\n<table width=\"309\">\n<tbody>\n<tr>\n<td><strong>\u03b22 microglobulin (mg/dL) and albumin (g/dL) level</strong></td>\n<td>Stage</td>\n<td>Median survival months</td>\n</tr>\n<tr>\n<td>\n<p>\u03b22M &lt; 3.5</p>\n<p>alb\u00a0\u22653.5</p>\n</td>\n<td>I</td>\n<td>62</td>\n</tr>\n<tr>\n<td>\n<p>\u03b22M &lt; 3.5, alb &lt; 3.5</p>\n<p>or\u00a0\u03b22M = 3.5-5.5</p>\n</td>\n<td>II</td>\n<td>44</td>\n</tr>\n<tr>\n<td>\u03b22M &gt; 5.5</td>\n<td>III</td>\n<td>29</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f188e13156464995a0790b62297e4944.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a marker for gastrointestinal stromal tumors?",
    "choices": [
      {
        "id": 1,
        "text": "KIT"
      },
      {
        "id": 2,
        "text": "SDH"
      },
      {
        "id": 3,
        "text": "PDGFRA"
      },
      {
        "id": 4,
        "text": "NRG-1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>NRG-1</strong> (Neuregulin-1) is not a marker for <strong>gastrointestinal stromal tumors</strong> (GISTs).</p>\n<p><strong>GIST</strong> is the most common <strong>mesenchymal</strong> tumor of the <strong>abdomen,</strong> the <strong>stomach</strong> being the most common site. They arise from the <strong>interstitial cells</strong> of <strong>Cajal,</strong> the pacemaker cells of the GIT. GIST is seen in the <strong>5th</strong> to <strong>6th decade</strong> of life and has an <strong>equal preponderance</strong> among males and females. Most patients present with <strong>haematemesis, melena,</strong> or <strong>vague abdominal</strong> pain. The most common indications for surgery include <strong>bleeding</strong> and <strong>obstruction.</strong></p>\n<p>The GIST may occur in a <strong>sporadic</strong> form or as part of <strong>familial syndromes.</strong> In sporadic GIST, the most common mutations seen are gain-of-function mutation in <strong>KIT</strong> (75-80%) and <strong>PDGFRA</strong> mutation (8%). Succinate dehydrogenase (<strong>SDH</strong>)-deficient GIST is a subset of wild-type GIST seen with Carney triad or Carney-Stratakis syndrome.\u00a0</p>\n<p>The below image shows the microscopy of GIST composed of bundles, or fascicles, of spindle-shaped tumour cells.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9bf9b67e36847358296aa149b9b4ea8x1280x1033.JPEG"
    ]
  },
  {
    "text": "A 12-year-old child presented with complaints of fatigue, fever, and dyspnea for the past week. Chest X-ray reveals mediastinal widening. Peripheral smear findings are given below. Which of the following findings on immunophenotyping do you expect to find in this case?",
    "choices": [
      {
        "id": 1,
        "text": "MPO positive"
      },
      {
        "id": 2,
        "text": "TdT positive"
      },
      {
        "id": 3,
        "text": "CD33 positive"
      },
      {
        "id": 4,
        "text": "PAS negative"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a<strong> 12-year-old </strong>child presenting with <strong>fatigue, fever,</strong> and <strong>dyspnea</strong>, a chest X-ray showing<strong> mediastinal widening</strong>, and a peripheral smear showing <strong>abundant lymphoblasts</strong> (cells with scant cytoplasm and large nucleus) is suggestive of<strong> acute lymphoblastic leukemia (ALL)</strong>. ALL will be <strong>TdT positive </strong>on immunophenotyping.</p>\n<p><strong>ALL</strong> is the most<strong> common cancer in childhood</strong>. <strong>B-cell ALLs</strong> usually present as <strong>early childhood leukemias,</strong> while <strong>T-cell ALLs </strong>are usually seen in <strong>adolescents </strong>as <strong>thymic lymphomas.</strong> Clinical features include <strong>fatigue, infections, bleeding diathesis</strong> (due to impaired marrow function), <strong>hepatosplenomegaly, fever</strong>, and <strong>dyspnea</strong> due to mediastinal or thymic infiltration.</p>\n<p>Initial evaluation involves a<strong> routine complete blood count</strong> and<strong> peripheral smear</strong>. It typically reveals<strong>\u00a0anemia, thrombocytopenia, </strong>and the <strong>presence of blasts (immature WBCs) </strong>on the smear. <strong>Morphologically</strong>, myeloblasts and lymphoblasts may be<strong> difficult to distinguish</strong>.<strong> Immunophenotyping</strong> thus plays an important role in<strong> confirming</strong> the diagnosis.</p>\n<p>\u00a0</p>\n<table style=\"border-collapse: collapse; width: 57.0649%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 99.985%; text-align: center;\" colspan=\"3\"><strong>Immunophenotyping</strong></td>\n</tr>\n<tr>\n<td style=\"width: 25.4336%;\">\u00a0</td>\n<td style=\"width: 35.3922%; text-align: center;\"><strong>ALL</strong></td>\n<td style=\"width: 39.1592%; text-align: center;\"><strong>AML</strong></td>\n</tr>\n<tr>\n<td style=\"width: 25.4336%;\"><strong>Immunohistochemistry</strong></td>\n<td style=\"width: 35.3922%;\">MPO negative<br />TdT positive\u00a0<br />PAS positive</td>\n<td style=\"width: 39.1592%;\">\n<p>MPO positive<br />TdT negative\u00a0<br />PAS negative</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 25.4336%;\"><strong>Flow cytometry</strong></td>\n<td style=\"width: 35.3922%;\">\n<p>Pre-B cell leukemia -\u00a0</p>\n<ul>\n<li>CD10\u00a0</li>\n<li>CD19\u00a0</li>\n<li>CD20\u00a0</li>\n<li>CD22</li>\n<li>Cytoplasmic IgM heavy chain (\u03bc chain)</li>\n</ul>\n<p>Pre-T cell leukemia -\u00a0</p>\n<ul>\n<li>CD1\u00a0</li>\n<li>CD2\u00a0</li>\n<li>CD5</li>\n<li>CD7</li>\n</ul>\n</td>\n<td style=\"width: 39.1592%; vertical-align: top;\">\n<p>Myeloid blasts -\u00a0</p>\n<ul>\n<li>CD34 (a marker of multipotent stem cells)\u00a0</li>\n<li>Do not express CD64 (a marker of mature myeloid cells)</li>\n<li>CD33 or CD15 in a few subsets</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>AML - Acute myelogenous leukemia</p>\n<p>Other options:</p>\n<p>Option A: <strong>MPO positive\u00a0</strong>on immunohistochemistry is a feature of <strong>myeloblasts</strong> seen in <strong>AML</strong>. Lymphoblasts are MPO-negative.</p>\n<p>Option C: <strong>CD33 positive\u00a0</strong>on flow cytometry is a marker of <strong>myeloid progenitors</strong> and monocytes seen in <strong>AML</strong>.\u00a0</p>\n<p>Option D: <strong>PAS negative </strong>on immunohistochemistry is a feature of <strong>myeloblasts</strong> seen in <strong>AML</strong>. Lymphoblasts are usually PAS-positive.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f350ae5517e24f3bb0e55ac7dce515c5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old patient came to the OPD with complaints of swelling over the cervical region. On examination, it is found to be painless lymphadenopathy along with the presence of splenomegaly. On HPE examination, the following picture given in the image is seen with the absence of centroblasts. Immunophenotyping shows CD23 negative, CD 19 and CD 20 positive.\nWhich of the following is false regarding the above condition?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of t(11;14)"
      },
      {
        "id": 2,
        "text": "Increased expression of cyclin D1"
      },
      {
        "id": 3,
        "text": "Somatic hypermutation of IgH locus"
      },
      {
        "id": 4,
        "text": "Association with lymphomatoid polyposis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical and biopsy picture points to <strong>Mantle cell lymphoma,</strong> which has its origin <strong>from na\u00efve B cells,</strong> which <strong>are characterised by a lack of somatic hypermutation</strong> <strong>of the IgH gene\u00a0</strong>(Due to the tumour arising from Naive B Cells).</p>\n<p><strong>Mantle cell lymphoma : </strong></p>\n<ul>\n<li>Tumor cells resemble the normal mantle zone B- cells which surround the germinal centre</li>\n<li>Seen in the fifth and sixth decades of life</li>\n<li>Has male predominance</li>\n<li>Has (11;14) translocation (Option A)</li>\n<li>IgH locus on \u2013 chromosome 14</li>\n<li>Cyclin D1 locus on \u2013 chromosome 11</li>\n<li>Overexpression of Cyclin D1 is seen (Option B)</li>\n</ul>\n<p><strong>Features: </strong></p>\n<ul>\n<li><strong>Painless lymphadenopathy</strong></li>\n<li><strong>Splenomegaly</strong></li>\n<li>Multifocal mucosal involvement of small bowel and colon \u2013<strong> lymphomatoid polyposis\u00a0</strong>(Option D)</li>\n</ul>\n<p><strong>Histology :</strong></p>\n<ul>\n<li>Nodal tumor cells may surround reactive germinal centres to produce a nodular appearance at low power or diffusely efface the node.</li>\n<li>Typically, the proliferation consists of a<strong> homogeneous population of small lymphocytes with irregular to occasionally deeply cleft (cleaved) nuclear contours</strong></li>\n<li>Large cells resembling\u00a0<strong>centroblasts and proliferation centres are absent</strong>, distinguishing mantle cell lymphoma from follicular lymphoma and CLL/SLL, respectively</li>\n</ul>\n<p><strong>Immunophenotyping :</strong></p>\n<ul>\n<li>CD 5+</li>\n<li>CD 23 negative</li>\n<li>CD19 and\u00a0 CD20 positive</li>\n<li>Moderately high levels of surface Ig (usually IgM and IgD with \u03ba or \u03bb light chain)</li>\n<li>The IgH genes lack somatic hypermutation, supporting an origin from a naive B cell</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d0b1f654696c4a9c88140699b22315e8.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the OPD with a history of swelling over the anterior part of the neck, fatigue, and weight loss for two months. On examination, the mass moves with deglutition. A biopsy from the patient's thyroid gland is shown below. Investigations reveal elevated plasma metanephrines, serum calcium, PTH, and calcitonin. She also gives a history of her mother undergoing surgery for a lump in the neck many years before. Which of the following is likely to result in the above condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gain of function mutation in RET"
      },
      {
        "id": 2,
        "text": "Loss of function mutation in RET"
      },
      {
        "id": 3,
        "text": "Gain of function mutation in K-RAS"
      },
      {
        "id": 4,
        "text": "Loss of function mutation in K-RAS"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette describes the features of <strong>MEN 2A syndrome,</strong> which includes <strong>medullary thyroid carcinoma </strong>(The given histopathology picture shows the presence of <strong>amyloid-rich stroma</strong> and family history of thyroid surgery), <strong>parathyroid adenoma (elevated</strong> serum <strong>calcium, PTH,</strong> and calcitonin) and <strong>pheochromocytoma (elevated</strong> plasma <strong>metanephrines).</strong> The <strong>gain of function mutations</strong> in <strong>RET</strong> proto-oncogene occurs in MEN 2A syndrome.</p>\n<p>Multiple endocrine neoplasia is characterised by the presence of tumors in <strong>two </strong>or<strong> more endocrine glands.\u00a0</strong>It can be MEN 1, MEN 2A, MEN 2B (MEN 3), or MEN 4.</p>\n<p>MEN <strong>1</strong> is associated mainly with <strong>parathyroid adenoma, pancreatic tumors,</strong> and<strong> pituitary tumors.\u00a0</strong></p>\n<p>MEN type <strong>2</strong> comprises groups of disorders caused by gain-of-function mutations of the RET proto-oncogene at chromosomal locus 10q11.2. There are three variants:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">MEN 2A, also known as MEN 2 (most common type)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">MEN 2B, also known as MEN 3</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">MTC only</li>\n</ul>\n<p>MEN <strong>2A</strong> is also known as Sipple's syndrome. It is characterized by medullary thyroid carcinoma (MTC), pheochromocytomas, and parathyroid tumors.</p>\n<p>MEN <strong>2B</strong> is characterised by MTC, pheochromocytoma, mucosal neuromas, marfanoid habitus, medullated corneal nerve fibres, and megacolon.</p>\n<p>MEN <strong>4</strong> is associated with parathyroid adenoma, pituitary adenoma, and <strong>reproductive organ tumors.</strong></p>\n<p>Other options</p>\n<p>Option B: <strong>Loss of function mutation </strong>of<strong> RET </strong>gene leads to<strong> Hirschprung disease.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e31505be1cbb411781f75172bbd94af0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding tumour markers is false?",
    "choices": [
      {
        "id": 1,
        "text": "Biological and analytical variability are some of the commonly encountered disadvantages of tumour markers"
      },
      {
        "id": 2,
        "text": "No existing tumor biomarker possesses high accuracy for prognostic indication"
      },
      {
        "id": 3,
        "text": "Tumor markers have the sensitivity but not the specificity to diagnose cancers"
      },
      {
        "id": 4,
        "text": "Serum levels of AFP and CEA can be elevated in a variety of non-neoplastic conditions, limiting their value as screening tests"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Statement 3</strong> is a false statement regarding tumour markers.</p>\n<p>Biochemical assays for tumour-associated enzymes, hormones, and other tumour markers may aid in cancer diagnosis. They are also frequently helpful in tracking a tumour's response to treatment and identifying tumour recurrence. Nevertheless, they <strong>do not have</strong> both the <strong>sensitivity</strong> and <strong>specificity </strong>required to diagnose cancer.</p>\n<p><strong>Tumour biomarkers</strong> are substances synthesised by cancer cells or other body cells in response to cancer and released into circulation.\u00a0</p>\n<p>The <strong>structural</strong> <strong>makeup</strong> of tumour biomarkers varies greatly. They can be simple molecules like <strong>catecholamines</strong> or well-characterized <strong>proteins</strong> like <strong>hormones</strong>, <strong>enzymes</strong>, or more diverse <strong>glycoproteins</strong> or <strong>mucins</strong> like carbohydrate antigen 125 (CA-125), which can be measured by antibodies. Alpha-fetoprotein (AFP), carcinoembryonic antigen (CEA), and human chorionic gonadotropin (hCG) are examples of significant tumour biomarkers that are oncofetal <strong>antigens</strong> that are present in a normal foetus and are expressed at low levels by healthy tissues but at high concentrations by certain malignancies.</p>\n<p><strong>Disadvantages</strong> of tumour markers are:</p>\n<ul>\n<li>No existing tumour biomarker possesses high specificity, sensitivity, accuracy and reproducibility rates, offering cost-effective screening, diagnosis, and <strong>prognostic indication</strong>.</li>\n<li>Tumor markers cannot be used as standalone diagnostic markers for malignancies. <strong>Biological</strong> and <strong>analytical variability</strong> limit their usage. For example, tumour markers such as AFP are found to be elevated in non-neoplastic conditions like liver diseases. Another example is CEA which is elevated in conditions like ulcerative colitis, pancreatitis, etc. Hence, relying entirely on tumour biomarker assays may lead to <strong>inaccurate</strong> or <strong>incomplete</strong> <strong>diagnostic</strong> <strong>conclusions</strong>.</li>\n</ul>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Therefore, it is pivotal for us to make use of the tumour markers along with other diagnostic methods (imaging studies, biopsies, or clinical evaluations) to establish a comprehensive diagnosis.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old woman who presented with a 3-month history of a painless firm lump in her breast's upper outer quadrant underwent breast conservative surgery and is now awaiting instructions on follow-up. What is the recommended advice regarding the follow-up for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Annual mammograms of the treated and contralateral breast"
      },
      {
        "id": 2,
        "text": "Annual mammograms of the contralateral breast only"
      },
      {
        "id": 3,
        "text": "Annual mammograms of the contralateral breast only and Serum tumor markers"
      },
      {
        "id": 4,
        "text": "Annual mammograms of the treated and contralateral breast and Serum tumor markers"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>For a patient with the given clinical scenario after treatment of breast cancer, the recommended follow-up advice consists of a routine physical examination once in 3 months for the first two years<strong> </strong>and<strong> annual mammograms of the treated and contralateral breast.</strong></p>\n<p><strong>Mammography is the only imaging</strong> modality\u00a0necessary for follow-up after breast cancer surgery. There is currently <strong>no role for tumour markers</strong>, serum investigations, or any other imaging studies like bone scans in follow-up.</p>\n<p>Women who have had a <strong>mastectomy</strong>, including simple mastectomy, modified radical mastectomy, and radical mastectomy would <strong>not need further routine screening mammograms on that side</strong>, but will still need to have a <strong>yearly mammogram</strong> on the remaining breast.</p>\n<p>The guidelines for follow-up are as follows,</p>\n<p><strong>Physical examination:</strong></p>\n<ul>\n<li>For the <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">first 2 years:</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0once every</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> 3 </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">months</span></li>\n<li>For<strong>\u00a03-5 years:</strong> once every <strong>6 </strong>months</li>\n<li><strong>After 5 </strong>years: <strong>Annually</strong></li>\n</ul>\n<p><strong>Mammography: </strong>Annually</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old man presents with vague abdominal pain for the last six months, and a recent blood investigation revealed elevated levels of serum CEA and CA 19-9. He also noticed spontaneously appearing and disappearing tender nodules (clots) under the skin at different locations, as shown below. Which of the other following conditions is most likely associated with his skin lesions?",
    "choices": [
      {
        "id": 1,
        "text": "Deep venous thrombosis"
      },
      {
        "id": 2,
        "text": "Buerger's disease"
      },
      {
        "id": 3,
        "text": "Raynaud's phenomenon"
      },
      {
        "id": 4,
        "text": "Takayasu arteritis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Buerger's disease</strong> is the other condition among the given options that is associated with the given skin lesions.</p>\n<p>This patient with vague abdominal pain, elevated serum markers of CA19-9 and CEA, and skin showing features of migratory thrombophlebitis are consistent with a diagnosis of <strong>pancreatic carcinoma</strong>. Patients with<strong> Buerger\u2019s disease </strong>can also present with <strong>migratory thrombophlebitis</strong>.</p>\n<div class=\"page\" title=\"Page 1001\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Buerger\u2019s disease is a progressive <strong>non-atherosclerotic segmental inflammatory disease</strong> that most often affects small- and medium-sized arteries, veins, and nerves of the upper and lower extremities.</p>\n<div class=\"page\" title=\"Page 1001\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Clinical features:</p>\n<ul>\n<li>Typically presents in <strong>young male smokers</strong>, with symptoms beginning before<strong> age 40</strong>.</li>\n<li>Patients initially present with foot, leg, arm, or hand <strong>claudication,</strong> which may progress to rest pain to calf claudication and eventually ischemic <strong>rest pain</strong> and <strong>ulcerations</strong> on the toes, feet, fingers and even <strong>gangrene.</strong></li>\n<li>A complete history should exclude diabetes, hyperlipidemia, or autoimmune disease as possible etiologies for the occlusive lesions.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p>Pathogenesis:</p>\n<p>Smoking increases the level of carboxyhemoglobin, which causes <strong>vasospasm and hyperplasia of the intima</strong> of small and medium-sized vessels. This eventually results in thrombosis and obliteration of vessels, followed by <strong>segmental pan arteritis</strong>. Eventually, the artery, vein, and nerve are together involved, which causes rest pain (nerve involvement) and ischemia in the limb (arterial involvement).</p>\n<p>Once blockage occurs, plenty of collaterals open up depending on the site of blockage to maintain blood supply to the ischaemic area, resulting in a <strong>compensatory peripheral vascular disease</strong>. If the patient continues to smoke, the disease progresses into the collaterals, blocking them eventually, leading to severe ischemia, which is called <strong>decompensatory peripheral vascular disease</strong>.</p>\n<p>It is presently called <strong>critical limb ischemia.</strong> It causes rest pain, ulceration, and gangrene.</p>\n<p>Investigations:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Arterial<strong>\u00a0doppler </strong>and <strong>duplex</strong> scan (Doppler + B mode U/S)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Transfemoral retrograde angiogram</strong> through Seldinger technique</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Characteristic angiographic findings show disease confinement to the distal circulation, usually infra popliteal and distal to the brachial artery. The occlusions are segmental and show <strong>\u201cskip\u201d lesions</strong> with extensive collateralisation, the so-called <strong>corkscrew collaterals.</strong></li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cessation of smoking</strong> is the definitive management.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Drugs to improve circulation include\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pentoxifylline</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aspirin</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Clopidogrel</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Statins\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cilostazol- Phosphodiesterase inhibitor is ideally used to improve circulation in the collaterals formed.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Vasodilators and anticoagulants have no role in the treatment.</strong></li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Care of limb with Buerger\u2019s exercise and positioning\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Surgical management may include lumbar sympathectomy and amputation according to the presenting features.\u00a0</li>\n</ul>\n<p>Other options</p>\n<p>Option A: <strong>Deep</strong> <strong>vein</strong> <strong>thrombosis</strong> (DVT) is a pathological condition characterised by the obstruction of blood flow in the deep veins, resulting from impaired venous reflux mechanism. <strong>DVT</strong> is <strong>not</strong> associated with <strong>migratory</strong> <strong>thrombophlebitis</strong>.</p>\n<p>Option C: <strong>Raynaud</strong> <strong>phenomenon</strong> is manifested as episodic vasoconstriction of the arteries and arterioles of the extremities, causing pallor of extremities followed by pain and cyanosis. It is seen in virtually all patients with systemic sclerosis or scleroderma and precedes other symptoms in 70% of cases. <strong>Raynaud</strong> <strong>phenomenon</strong> is <strong>not</strong> associated with <strong>migratory thrombophlebitis</strong>.</p>\n<p>Option D: <strong>Takayasu</strong> <strong>arteritis</strong> is the inflammation of the medium to <strong>large-sized arteries</strong>. It mainly affects the aortic arch and its branches. The most commonly affected artery is the subclavian artery. Patients will present with features of arm claudication, Raynaud's phenomenon, etc. They can also present with syncope, transient ischemic attack, abdominal pain, or chest pain, depending on the arteries involved. A biopsy of the affected artery will show <strong>pan</strong> <strong>arteritis</strong> with <strong>mononuclear</strong> <strong>cell</strong> <strong>infiltrates</strong> and occasionally giant cells. <strong>Takayasu</strong> <strong>arteritis</strong> is <strong>not</strong> associated with <strong>migratory</strong> <strong>thrombophlebitis</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/615500ddbcb6413d94c526f16e387773.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "TP53 mutants can be discovered in the serum in all the following cancers except?",
    "choices": [
      {
        "id": 1,
        "text": "Colon Cancer"
      },
      {
        "id": 2,
        "text": "Lung Cancer"
      },
      {
        "id": 3,
        "text": "Pancreatic Cancer"
      },
      {
        "id": 4,
        "text": "Bladder Cancer"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In <strong>Bladder Cancer, </strong>TP53\u00a0mutants are found in<strong> Urine, </strong>and not in serum.</p>\n<p>Meanwhile, <strong>Cell-Free DNA markers</strong> such as <strong>TP53 mutants</strong> are found in the serum in Colon, Lung and Pancreatic cancers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following tumor markers with their malignancies:",
    "choices": [
      {
        "id": 1,
        "text": "1-d, 2-a, 3-b, 4-c"
      },
      {
        "id": 2,
        "text": "1-c, 2-d, 3-b, 4-a"
      },
      {
        "id": 3,
        "text": "1-a, 2-c, 3-b, 4-d"
      },
      {
        "id": 4,
        "text": "1-d, 2-c, 3-a, 4-b"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The correctly matched pair of tumor markers and their malignancies is\u00a0<strong>1-d, 2-c, 3-a,</strong> and<strong> 4-b</strong>\u00a0(option D).</p>\n<table style=\"height: 113px; width: 341.938px;\">\n<tbody>\n<tr style=\"height: 38px;\">\n<td style=\"width: 157px; height: 38px; text-align: center;\">Tumor markers</td>\n<td style=\"width: 163.938px; height: 38px; text-align: center;\">\u00a0Malignancies</td>\n</tr>\n<tr style=\"height: 36.375px;\">\n<td style=\"width: 157px; height: 36.375px;\">1. Alpha-fetoprotein</td>\n<td style=\"width: 163.938px; height: 36.375px;\">\n<p>d. Liver cell cancer</p>\n</td>\n</tr>\n<tr style=\"height: 43px;\">\n<td style=\"width: 157px; height: 43px;\">2. Calretinin</td>\n<td style=\"width: 163.938px; height: 43px;\">c. Mesothelioma</td>\n</tr>\n<tr style=\"height: 30px;\">\n<td style=\"width: 157px; height: 30px;\">\n<p>3. Carcinoembryonic antigen</p>\n</td>\n<td style=\"width: 163.938px; height: 30px;\">a.\u00a0Colon cancer\u00a0</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 157px; height: 46px;\">4. CA-125</td>\n<td style=\"width: 163.938px; height: 46px;\">b. \u00a0Epithelial ovarian cancer</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy presents with pain in the right leg accompanied by symptoms of fever and fatigue. His X-ray shows onion peel appearance with extension into the bone marrow. Which of the following is associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "There is poor response to radio therapy"
      },
      {
        "id": 2,
        "text": "Stains positive for reticulin"
      },
      {
        "id": 3,
        "text": "The serum LDH is elevated"
      },
      {
        "id": 4,
        "text": "There is a t(12:21) translocation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient has pain in the limb with fever and fatigue with onion peel appearance on X-Ray with extension into the bone marrow<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">. This is most likely </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Ewing's sarcoma</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">. It is associated with an</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> elevated serum LDH.</strong></p>\n<p>Ewing\u00a0sarcoma<strong>\u00a0</strong>is the <strong>2nd most common</strong>\u00a0bone sarcoma in children. The majority of the patients affected are usually\u00a0<strong>&lt;20 years</strong> of age. It has a slight <strong>male</strong> <strong>predominance</strong>.\u00a0The majority of Ewing sarcomas have a balanced translocation between the EWSR1 gene on <strong>chromosome 22</strong> and the FLI1 gene on <strong>chromosome 11</strong>.\u00a0</p>\n<p>It commonly involves the\u00a0<strong>diaphysis</strong>\u00a0of the <strong>long bones</strong> like the <strong>femur</strong>,<strong> tibia</strong>, fibula, humerus, and <strong>flat bones</strong> of the <strong>pelvis</strong>. Patients present with\u00a0<strong>painful enlarging mass</strong>, fever, and anemia. The affected area is usually tender, swollen, and warm.</p>\n<p>Laboratory findings may show an elevated WBC count, LDH levels (lactate dehydrogenase) and erythrocyte sedimentation rate (ESR).\u00a0The common diagnostic test used for Ewing\u2019s sarcoma is the detection of translocation <strong>t(11;22) (q24;q12)</strong>.\u00a0</p>\n<p>A histopathological examination of Ewing sarcoma shows sheets of<strong> uniform, round blue cells </strong>arranged in<strong> Homer-Wright rosettes</strong>. Immunohistochemistry is usually\u00a0positive for<strong> synaptophysin </strong>and<strong> mic-2</strong>. The tumor cells\u00a0contain glycogen and are hence <strong>PAS positive </strong>and they are <strong>reticulin negative</strong>.</p>\n<p>Preoperative chemotherapy with\u00a0<strong>vincristine</strong>,<strong>\u00a0ifosfamide</strong>,\u00a0<strong>doxorubicin</strong>\u00a0and\u00a0<strong>etoposide</strong>\u00a0results in extensive tumor necrosis and shrinkage.\u00a0<strong>Wide excision</strong>\u00a0may be combined with\u00a0<strong>adjuvant radiotherapy</strong>\u00a0if surgical margins are poor. Definitive radiotherapy rather than surgical excision may be advocated if it is non-resectable or metastasis has occurred. It is a\u00a0<strong>radio-sensitive</strong>\u00a0tumor.</p>\n<p><strong>Indicators</strong>\u00a0of\u00a0<strong>poor prognosis</strong>\u00a0in patients with\u00a0Ewing's sarcoma:</p>\n<ul>\n<li>Presence of\u00a0<strong>distant</strong>\u00a0<strong>metastasis</strong>\u00a0-\u00a0<strong>worst</strong>\u00a0<strong>prognostic</strong>\u00a0<strong>factor</strong></li>\n<li>Size and location of the primary lesion</li>\n<li>Presence of fever, anemia</li>\n<li><strong>Leukocytosis</strong>, raised ESR.\u00a0</li>\n</ul>\n<p>Other Options:</p>\n<p>Ewing's sarcoma is <strong>radio sensitive</strong>(Option A), reticulin negative(Option B) and associated with a t(11:22) (Option D) translocation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly woman presented with complaints of discoloration on her face. An excisional biopsy was done, and histopathology findings are shown below. They stain positive for HMB - 45. Which of the following statements is incorrect regarding her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Superficial spreading type is the most common variant"
      },
      {
        "id": 2,
        "text": "Mutation in the hedgehog signalling pathway"
      },
      {
        "id": 3,
        "text": "Mutation in receptor tyrosine kinase signalling pathway"
      },
      {
        "id": 4,
        "text": "Shows positive immunohistochemistry staining for S-100"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The given history and histopathology showing <strong>dense intracytoplasmic brownish-black</strong> <strong>melanin pigment</strong> are suggestive of <strong>malignant melanoma</strong>. Mutations&nbsp;in the&nbsp;<strong>hedgehog signaling pathway</strong>&nbsp;are associated with <strong>basal cell carcinoma</strong> and not malignant melanoma.&nbsp;</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Malignant melanoma&nbsp;primarily arises from&nbsp;<strong>melanocytes</strong>&nbsp;at the epidermal-dermal junction but may also originate from mucosal surfaces of the&nbsp;<strong>oropharynx, nasopharynx, eyes, proximal esophagus, anorectal, </strong>and <strong>female genitalia</strong>. It includes<strong>&nbsp;a pigmented lesion</strong>&nbsp;that has enlarged, ulcerated, or bled. Amelanotic lesions appear as raised pink, purple, or flesh-colored skin papules. The diagnostic clue for melanoma is the&nbsp;<strong>ABCDE</strong>&nbsp;criteria.</p>\n<p>It consists of</p>\n<ul>\n<li><strong>A</strong>symmetry</li>\n<li><strong>B</strong>order irregularity</li>\n<li><strong>C</strong>olor variegation</li>\n<li><strong>D</strong>iameter of more than 6 mm&nbsp;</li>\n<li><strong>E</strong>volution or change</li>\n</ul>\n<p>The image below shows a case of malignant melanoma.</p>\n</div>\n</div>\n<div class=\"ng-star-inserted\">\n<div class=\"ng-star-inserted\">\n<div class=\"h-400-scroll mb-2 ng-star-inserted\"><img class=\"img-fluid hover-max\" src=\"https://dhmbxeygs57ff.cloudfront.net/uploads/506a8d63fc0d4accaa9d9ac8a0082518x720x963.JPEG\" width=\"192\" height=\"257\" /></div>\n</div>\n</div>\n<p class=\"p1\">Lentigo maligna, superficial spreading, acral lentiginous, and nodular are the variants of malignant melanoma<strong>. Superficial spreading melanoma</strong>&nbsp;is the&nbsp;<strong>most common</strong>&nbsp;variant (Option A) of malignant melanoma. It is more commonly seen on the&nbsp;<strong>trunk</strong>&nbsp;and&nbsp;<strong>proximal extremities</strong>. It usually arises from a&nbsp;<strong>pre-existing nevus</strong>&nbsp;after a chronic period of change in color and border.&nbsp;<strong>Mutations</strong>&nbsp;in&nbsp;<strong>cell cycle regulators</strong>,&nbsp;receptor&nbsp;<strong>tyrosine kinase</strong>&nbsp;signaling pathway (Option C), and those that&nbsp;<strong>activate telomerase</strong>&nbsp;are associated with&nbsp;<strong>melanomas</strong>.</p>\n<p>Markers for melanoma include:</p>\n<ul>\n<li><strong>S100&nbsp;</strong>(Option D)</li>\n<li>MELAN-A</li>\n<li>HMB (Human Melanoma Black)-45</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c2c32da7588c411a9fa43b6c29c36b89.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child presented with unilateral proptosis. CT scan of the orbit shows poorly defined mass with homogenous density with adjacent bony destruction. Histopathology is shown below. The immunohistochemistry of the cells was Desmin positive. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Neuroblastoma"
      },
      {
        "id": 2,
        "text": "Retinoblastoma"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Medulloblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette and histopathology are suggestive of <strong>Rhabdomyosarcoma.</strong></p>\n<p>Rhabdomyosarcomas are the common soft tissue sarcomas of childhood and adolescence that may occur at virtually any anatomic site but are usually found in the <strong>head and neck (25%)</strong>, genitourinary tract (24%), extremities (19%), and orbit (9%). Retroperitoneum and other sites account for the remainder of primary sites.</p>\n<p>It is classified into three subtypes: alveolar, embryonal, and pleomorphic.</p>\n<table style=\"width: 876px; height: 291px;\">\n<tbody>\n<tr>\n<td style=\"width: 150.297px;\"><strong>Type</strong></td>\n<td style=\"width: 709.703px;\"><strong>Histopathology</strong></td>\n</tr>\n<tr>\n<td style=\"width: 150.297px;\">Embryonal\u00a0</td>\n<td style=\"width: 709.703px;\">\n<p>Tumour consists of sheets of both <strong>primitive round and spindled cells</strong> in a myxoid stroma.</p>\n\u00a0<strong>Sarcoma botryoid</strong> is a variant that occurs in the walls of hollow, mucosal-lined structures, such as the nasopharynx, common bile, bladder, and vagina.</td>\n</tr>\n<tr>\n<td style=\"width: 150.297px;\">Alveolar\u00a0</td>\n<td style=\"width: 709.703px;\">Tumour consists of a network of <strong>fibrous septae</strong> that divide the cells into clusters or aggregates, creating a crude resemblance to pulmonary alveoli.\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 150.297px;\">Pleomorphic</td>\n<td style=\"width: 709.703px;\">Tumour consists of large, sometimes multinucleated, <strong>bizarre eosinophilic tumour</strong> cells.<br /><br /></td>\n</tr>\n</tbody>\n</table>\n<p><br />Clinically, the tumour is usually <strong>aggressive</strong>, with unilateral proptosis when the orbit is involved. Swelling and redness of the overlying skin, diplopia may be present.</p>\n<p><br />In <strong>immunohistochemistry</strong>, they are positive for<strong>\u00a0</strong></p>\n<ul>\n<li><strong>Desmin</strong>\u00a0</li>\n<li>Myoglobin</li>\n<li>Myogenin</li>\n<li>MyoD1</li>\n<li>Vimentin.</li>\n</ul>\n<p>Pleomorphic rhabdomyosarcoma is seen predominantly in adults.</p>\n<p>Rhabdomyosarcoma shows a strong tendency for <strong>local invasion</strong>, local recurrence, and <strong>hematogenous</strong> and <strong>lymphatic</strong> metastases.</p>\n<p>Decision-making for management is based on <strong>histopathologic </strong>confirmation as well as the <strong>staging</strong> of orbital RMS, which includes imaging (MRI of primary tumour, chest-CT, Tc bone scan), pathology, and work-up for metastases(bone marrow biopsy)</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Group I: Localized disease, completely resected (excisional biopsy).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Group II: Microscopic disease remaining after biopsy.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Group III: Gross residual disease remaining after biopsy.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Group IV: Distant metastasis present at onset.</li>\n</ul>\n<p>The below image shows the histopathology of Orbital Rhabdomyosarcoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/91229440a5c546c8bacb4a99ec910d13.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8412a2256a24f59bf2cbda047c8cbc2x512x740.PNG"
    ]
  }
];
        let quizName = 'Tumor Markers Mini Test - -Tmt';
        const quizFilename = 'tumor-markers-mini-test-tmt-c0ac5cc3.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>