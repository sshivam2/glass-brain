<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 Trauma - Spinal, Thoracic And Abdominal Injuries - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">33</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "All of the following can be done to transport a polytrauma patient who is conscious except?",
    "choices": [
      {
        "id": 1,
        "text": "Strap their thorax, abdomen and lower limbs on a stretcher"
      },
      {
        "id": 2,
        "text": "Place in prone position to prevent aspiration"
      },
      {
        "id": 3,
        "text": "Put patient on lateral position and shift him immediately"
      },
      {
        "id": 4,
        "text": "Roll the patient onto a hard board"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Long spine boards</strong> with straps are helpful in the rapid transport of the patient from one place to another. The patient can be put on the long spine board by <strong>log-rolling</strong> (a technique where four people hold the patient and roll the patient like a log without allowing rotation or bending of the spine).</p>\n<p>Conscious and alert patient indirectly means that they don&rsquo;t need intubation and their airway is patent.&nbsp;If the patient is <strong>unconscious</strong> always <strong>check</strong> the <strong>airway</strong> and if needed, <strong>endotracheal intubation</strong> must be done immediately by various methods. Preferably by direct laryngoscopy and intubation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b42ec435b72b4a53b01fc3f802b51bb7x600x1200.PNG"
    ]
  },
  {
    "text": "A man met with a road traffic accident, which resulted in paralysis of both his upper and lower limbs. He has not passed urine and tenderness is elicited in the cervical region. What will you advise regarding radiography?",
    "choices": [
      {
        "id": 1,
        "text": "The patient should not be shifted and portable x-ray machine should be used after neck stabilization."
      },
      {
        "id": 2,
        "text": "Instruct the radiographer to take cervical and chest x-ray."
      },
      {
        "id": 3,
        "text": "Instruct the radiographer to take cervical x-ray AP and lateral view without any cervical support."
      },
      {
        "id": 4,
        "text": "Order a cervical x-ray and shift the patient from the trolley by himself."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical situation suggests a cervical spine injury due to trauma. The patient should not be shifted and a <strong>portable X-ray machine</strong> should be used for radiography after <strong>neck stabilization.</strong></p>\n<p>Management in a trauma patient with a suspected cervical fracture involves the following steps:</p>\n<ol>\n<li>Spinal immobilization with a <strong>rigid cervical collar</strong> and a <strong>long spine board</strong> is the immediate step in the management of blunt/penetrating cervical trauma cases.</li>\n<li>It is followed by a gross <strong>assessment</strong> of spinal cord function by eliciting extremity movement. Tenderness over the injured vertebrae or the presence of a deformity is indicative of an associated fracture.</li>\n<li>Imaging is done by X-ray or CT.&nbsp;<span style=\"font-size: 14px;\"><strong>Portable X-ray</strong> machines are preferred to avoid further injury while mobilizing the patient.&nbsp;</span><span style=\"font-size: 14px;\">They are useful in visualizing <strong>thoracic</strong> and <strong>lumbar</strong> vertebrae but <strong>not</strong></span><span style=\"font-size: 14px;\"><span style=\"font-size: 14px;\"><strong>&nbsp;the cervicothoracic junction</strong>.<strong> Cervical CT</strong> has been made the&nbsp;modality of choice in most emergency departments owing to the high quality of images that can be obtained.</span></span></li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old construction worker sustained an injury to his neck after falling from the tenth floor of a construction site. The first aid team that rushed to his rescue log rolled him. According to  ATLS, what is the minimum number of people required for log-rolling this patient?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "5"
      },
      {
        "id": 4,
        "text": "6"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The 10th edition of ATLS recommends <strong>at least 4 people</strong> for the safe manoeuvre of log-roll in patients suffering from trauma.</p>\n<ul>\n<li>The first person is assigned to <strong>restrict </strong>the<strong> motion </strong>of the <strong>head and neck</strong>.</li>\n<li>The second person is positioned on the same side of the patient\u2019s <strong>torso.</strong> He manually prevents segmental rotation, flexion, extension, lateral bending, or sagging of the chest or abdomen while transferring the patient.</li>\n<li>The third person is responsible for moving the patient\u2019s<strong> legs.</strong></li>\n<li>The fourth person removes the backboard and <strong>examines the back</strong>.</li>\n</ul>\n<p>Note: In a patient known to have a <strong>fracture</strong> of the <strong>extremities,</strong> a minimum of <strong>5 people</strong> are required to safely perform the <strong>log-roll</strong> manoeuvre.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d5c68408a54a4e3b8a843e1d5dc4eacbx509x381.PNG"
    ]
  },
  {
    "text": "Which of the following statements about acute spinal injury is false?",
    "choices": [
      {
        "id": 1,
        "text": "Hypotension in acute spinal injury is due to the loss of parasympathetic tone"
      },
      {
        "id": 2,
        "text": "Immediate respiratory suppression can occur due to the involvement of the phrenic nerve"
      },
      {
        "id": 3,
        "text": "Canadian C-Spine rule and NEXUS help to determine the need for radiographic evaluation"
      },
      {
        "id": 4,
        "text": "Patients with neurological deficits should be removed from the backboard as soon as possible"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span style=\"font-size: 12pt;\">Option D: Patients with or without neurological deficits should be removed from the <strong>backboard</strong> as soon as possible. A patient who is allowed to lie on the hardboard for <strong>more than 2 hours</strong> is at high risk for <strong>pressure ulcers.</strong>\u00a0</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old college student sustained a superficial injury to his neck during a bar fight. What is the probable cause of sudden death in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Injury to phrenic nerve"
      },
      {
        "id": 2,
        "text": "Air embolism through external jugular vein"
      },
      {
        "id": 3,
        "text": "Bleeding from subclavian artery"
      },
      {
        "id": 4,
        "text": "Injury to trachea"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Air embolism</strong> through the <strong>external jugular vein</strong> is a cause of sudden death in patients with <strong>superficial neck injury.</strong></p>\n<p>All other structures are deeper structures, hence are not involved much in superficial injuries of the neck.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man presented to the emergency department after suffering injuries in the neck during an armed robbery. On examination, several bleeding lacerated injuries are visible at the front and lateral aspects of the neck. Which of the following is not an indication for immediate surgical exploration?",
    "choices": [
      {
        "id": 1,
        "text": "Pulsatile bleeding"
      },
      {
        "id": 2,
        "text": "Respiratory distress"
      },
      {
        "id": 3,
        "text": "Fluid responsive hemorrhagic shock"
      },
      {
        "id": 4,
        "text": "Air bubbling from penetrating injury"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fluid responsive hemorrhagic shock is not an indication for immediate surgical intervention.&nbsp;</p>\n<p>The following are the indications for immediate surgical exploration of neck trauma. They are also known as the <strong>hard signs of neck trauma</strong>:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pulsatile bleeding&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Expanding hematoma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Air bubbling from penetrating injury</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Absent radial pulse</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Respiratory distress</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Presence of neurological deficit</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Fluid resistant</strong> hemorrhagic shock</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Audible bruit or palpable thrill</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Signs of stroke/ cerebral ischemia</li>\n</ul>\n<p>The presence of any of these hard signs indicates major neurovascular/ airway injury and is an indication for surgical exploration of the trauma region as soon as possible.</p>\n<p>Neck trauma is classified based on the different regions of the neck.</p>\n<ul>\n<li>Zone I: <strong>thoracic inlet </strong>to<strong> cricoid</strong>, associated with <strong>maximum mortality.</strong> It contains large vascular structures as well as the trachea and esophagus.</li>\n<li>Zone II: <strong>cricoid cartilage</strong> to the <strong>angle of mandible</strong>, <strong>most commonly prone to injury</strong> and most <strong>easily accessible</strong> for surgery. It contains the carotid and vertebral arteries, jugular veins, and structures of the aerodigestive tract.</li>\n<li>Zone III: <strong>angle of the mandible</strong> to the <strong>base of the skull</strong>. Structures within zone III include blood vessels that are <strong>difficult to expose</strong> surgically.</li>\n</ul>\n<p>Management:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&nbsp;If the patient is hemodynamically <strong>unstable</strong>: <strong>neck exploration</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&nbsp;If the patient is stable:</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Zone II injury:&nbsp; <strong>Conservative management</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Zone I and Zone III: <strong>Angiography and angioembolisation</strong> are indicated. If it fails then neck exploration should be done.</li>\n</ul>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/084bd0ee8d4c44ffa98b2c98f80ca228x383x435.PNG"
    ]
  },
  {
    "text": "A 38-year-old man was brought to the emergency department after suffering a stab injury to the lower chest. On presentation, he had bradycardia and hypotension which did not improve despite IV fluid administration. Chest radiography showed clear lung fields. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "eFAST"
      },
      {
        "id": 2,
        "text": "Tube thoracostomy"
      },
      {
        "id": 3,
        "text": "CECT chest"
      },
      {
        "id": 4,
        "text": "CECT abdomen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a patient with a stab injury and hypotension not responding to IV fluids indicates <strong>persistent hypotension</strong> due to <strong>ongoing hemorrhage</strong> and the next step in the management is to perform an <strong>eFAST.</strong></p>\n<p><strong>Cardiogenic shock </strong>or <strong>hemorrhagic shock</strong> are the most likely causes of persistent hypotension in a trauma patient. Ultrasound evaluation using eFAST to look for pericardium, pleural cavities, and abdomen in combination with plain radiographs of the chest and pelvis will usually identify the source of the bleed.\u00a0</p>\n<p>In patients with persistent hypotension due to blunt trauma, the pelvis should be <strong>wrapped in a sheet</strong> for <strong>stabilization</strong> until radiography can be done.\u00a0</p>\n<p>Evaluation of <strong>CVP</strong> or <strong>ultrasound of the IVC</strong> may further assist in <strong>distinguishing</strong> between cardiogenic and hypovolemic shock.</p>\n<p>It is mostly fatal if not controlled, and requires immediate management. Blood and plasma transfusions are provided in a ratio of <strong>2:1</strong>. Patients with persistent hypotension requiring surgical intervention include:</p>\n<ul>\n<li>Blunt trauma and massive hemothorax</li>\n<li>Penetrating trauma</li>\n<li>Hemoperitoneum</li>\n<li>Gunshot injuries to the chest or abdomen</li>\n<li>Penetrating weapon remaining in place.</li>\n</ul>\n<p>Other options:\u00a0</p>\n<p>Options C and D: CECT can be done only when the patient is hemodynamically stable.\u00a0</p>\n<p>Option B: Tube thoracostomy has no role in this patient's management since the X-ray shows clear lung fields.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "eFAST is least helpful in diagnosing which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Pericardial Effusion"
      },
      {
        "id": 2,
        "text": "Pneumothorax"
      },
      {
        "id": 3,
        "text": "Retroperitoneal hematoma"
      },
      {
        "id": 4,
        "text": "Haemothorax"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the given options, eFAST(extended Focused Assessment with Sonography in Trauma) is <strong>least</strong> useful in diagnosing\u00a0<strong>retroperitoneal hematoma </strong>as the sensitivity of ultrasound for detecting retroperitoneal hematomas is extremely poor.\u00a0</p>\n<p>FAST is a rapid, noninvasive bedside test that uses sonography to detect free fluid in the abdomen and assess patients for potential thoracoabdominal injuries.\u00a0</p>\n<p>Technique:</p>\n<ul>\n<li>The patient is placed in a <strong>supine</strong> position</li>\n<li>With a 3.5-5.0 MHz convex\u00a0transducer the following\u00a0regions are scanned :\n<ul>\n<li><strong>Subxiphoid</strong> transverse view: assess for pericardial effusion and left lobe liver injuries</li>\n<li>Longitudinal view of the <strong>right upper quadrant</strong>: assess for right liver injuries, right kidney injury, and Morison pouch</li>\n<li>Longitudinal view of the <strong>left upper quadrant</strong>: assess for splenic injury and left kidney injury</li>\n<li>Transverse and longitudinal views of the <strong>suprapubic region</strong>: assess the bladder and pouch of Douglas</li>\n</ul>\n</li>\n</ul>\n<p><strong>e</strong>FAST stands for <strong>extended</strong> FAST and incorporates Left and right <strong>thoracic views</strong> to assess for pneumothorax and haemothorax.</p>\n<p><strong>Computed Tomography</strong> (CT Scan) is the investigation of choice for <strong>retroperitoneal injury</strong>, but it can only be done in a <strong>hemodynamically stable</strong> patient.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man is rushed to the emergency department following a high-speed road traffic collision. His heart rate is 124 beats/min and BP is 78/56 mmHg on the right arm, and 64/50 mmHg on the left arm. A portable chest x-ray shows a widened mediastinum but normal lung and cardiac silhouette. Which of the following is the investigation of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Transesophageal echocardiography"
      },
      {
        "id": 2,
        "text": "CT angiography"
      },
      {
        "id": 3,
        "text": "MR angiography"
      },
      {
        "id": 4,
        "text": "Transthoracic echocardiography"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette is suggestive of <strong>aortic injury</strong>. The investigation of choice in this <strong>hemodynamically unstable</strong> patient is <strong>transesophageal echocardiography (TEE)</strong>.&nbsp;In <strong>hemodynamically stable</strong> patients, the investigation of choice is <strong>CECT or CT angiogram</strong>.</p>\n<p>Traumatic aortic injuries are commonly seen in <strong>deceleration injuries</strong> (e.g. road traffic accidents). The most common site of aortic injury is the <strong>isthmus</strong>, near the attachment of <strong>ligamentum arteriosum</strong>.&nbsp;</p>\n<p>Clinical features of aortic injuries:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypotension</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Difference in blood pressure in bilateral limbs</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Absent pulse in the unilateral limb</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Widened mediastinum</strong> on chest x-ray</li>\n</ul>\n<p>Management</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Volume replacement: fluid therapy and blood transfusion</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Permissive hypotension</strong>: Beta-blockers, such as esmolol</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Immediate surgical repair:&nbsp;&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Endovascular stenting, or</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Open surgical repair with <strong>Dacron graft</strong></li>\n</ul>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man was rushed to the casualty with multiple rib fractures. On examination, you notice a paradoxical movement of the chest, and the patient is diagnosed with respiratory failure. How would you manage him?",
    "choices": [
      {
        "id": 1,
        "text": "Chest tube drainage"
      },
      {
        "id": 2,
        "text": "Oxygen administration"
      },
      {
        "id": 3,
        "text": "IPPV"
      },
      {
        "id": 4,
        "text": "Internal operative fixation of the fractures segments"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of <strong>flail chest with respiratory failure.</strong> Management of this condition is&nbsp;<strong>IPPV&nbsp;</strong>(invasive positive pressure ventilation).</p>\n<p>A flail chest occurs when a segment of the chest wall does not have bony continuity with the rest of the thoracic cage.&nbsp;This condition results from blunt trauma associated with multiple rib fractures i.e.,&nbsp;<strong>2 adjacent ribs or</strong>&nbsp;<strong>3&nbsp;or more ribs fractured in two or more places</strong>.&nbsp;</p>\n<p>The blunt force required to disrupt the integrity of the thoracic cage typically produces an underlying<strong> pulmonary contusion </strong>as well.</p>\n<p>On<strong> inspiration,&nbsp;</strong>the <strong>loose segment </strong>of the chest wall is <strong>displaced inwards,&nbsp;</strong>and therefore, less air moves into the lungs. On <strong>expiration,</strong> the segment moves <strong>outwards</strong>. This is known as&nbsp;<strong>paradoxical respiration</strong>.</p>\n<p>The <strong>diagnosis</strong> is made&nbsp;<strong>clinically</strong>, not by radiography. To confirm, the paradoxical motion of a chest wall segment can be observed for several respiratory cycles and during coughing.</p>\n<p>Voluntary splinting as a result of pain, mechanically impaired chest wall movement, and the associated lung contusion are all causes of hypoxia and respiratory failure.&nbsp;The patient is also at high risk of developing a <strong>pneumothorax </strong>or <strong>hemothorax.</strong></p>\n<p>Treatment:</p>\n<ul>\n<li><strong>Chest strapping </strong>or splinting should be<strong> avoided.</strong></li>\n<li>Currently, treatment consists of <strong>oxygen administration</strong>, adequate<strong> analgesia </strong>(including opiates) or <strong>epidural</strong> analgesia,<strong>&nbsp;</strong>and <strong>physiotherapy.</strong></li>\n<li><strong>IPPV</strong> (Intermittent Positive Pressure Ventilation) is reserved for patients developing <strong>respiratory failure</strong> despite adequate analgesia and oxygen.</li>\n</ul>\n<p>Treatment algorithm of treatment of flail chest with respiratory failure:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb06c37ba5c841a889511b6eca3a0459x1280x1736.JPEG"
    ]
  },
  {
    "text": "A 30-year-old man involved in a road traffic accident says that his bike handle hit the right side of his chest. On palpation, he had tenderness in the right upper chest. Chest radiograph shows a fracture in the right third rib. Which of the following should you not do while managing him?",
    "choices": [
      {
        "id": 1,
        "text": "Provide opioid analgesia"
      },
      {
        "id": 2,
        "text": "Advise deep breathing"
      },
      {
        "id": 3,
        "text": "Advise frequent coughing"
      },
      {
        "id": 4,
        "text": "Strapping over the affected rib"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is suggestive of a <strong>rib fracture</strong>. <strong>Strapping</strong> is <strong>not done</strong> for rib fractures because it prevents the patient from taking deep breaths. This can lead to <strong>lung collapse</strong>.</p>\n<p>The vital step in the management of rib fractures is to <strong>reduce pain</strong> and <strong>prevent</strong> the development of <strong>pneumonia.</strong> Rib fracture causes intense pain during breathing and increases the risk of pulmonary infections as the patient is not able to cough forcefully.\u00a0</p>\n<p>In mild to moderate cases, pain can be managed by <strong>intravenous opioids.</strong> In severe cases, patients may require <strong>epidural</strong> analgesia.</p>\n<p>In addition to adequate analgesia, <strong>chest physiotherapy</strong> like deep breathing, frequent coughing, incentive spirometry should be encouraged in these patients. This prevents the development of pneumonia and lung collapse. When chest wall injuries result in respiratory failure, <strong>mechanical ventilation</strong> should be provided.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old female presents to the ER with a history of RTA. On examination, GCS is 15/15, heart rate = 110/min, BP = 90/60 mmHg, and there is elevated JVP. The right chest is hyperresonant on percussion with decreased breath sounds. The left chest appears normal. But the patient is dyspneic and ecchymosis is noted over the chest wall. The abdomen was soft. The probable diagnosis is:",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Tension pneumothorax"
      },
      {
        "id": 3,
        "text": "Pericardial effusion"
      },
      {
        "id": 4,
        "text": "Massive hemothorax"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:\u00a0</p>\n<p>Options A:\u00a0 <strong>Pericardial tamponade</strong> can mimic tension pneumothorax, but the absence of a tympanic note on percussion rules out its possibility. A patient with pericardial tamponade can present with hypotension, raised JVP, and muffled heart sounds (<strong>Beck\u2019s triad</strong>), with <strong>normal breath sounds</strong> and <strong>no tracheal shift</strong>.</p>\n<p>Option C: Dullness in percussion at the base of the left inferior angle of scapula in conjunction with tubular breath sounds (<strong>Ewart\u2019s sign</strong>), chest pain that improves while sitting upright and worsens when lying down and pulsus paradoxus are indicative of <strong>pericardial effusion</strong>. Pericardial effusion develops into tamponade when the effusion leads to increased pressure, impairing ventricular filling and reducing cardiac output.</p>\n<p>Option D: <strong>Massive hemothorax</strong> is the accumulation of &gt;1500 ml of blood or one-third or more of the patient\u2019s blood volume in the chest cavity. The patient will have collapsed neck veins, decreased breath sounds and a dull note on percussion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/087c224886f64acca4b8a7eb85d4a22dx720x663.JPEG"
    ]
  },
  {
    "text": "A 20-year-old patient presented to the ER with tension pneumothorax following a road traffic accident. What is the first line of management?",
    "choices": [
      {
        "id": 1,
        "text": "Insert wide bore needle in 5th ICS anterior to the mid-axillary line"
      },
      {
        "id": 2,
        "text": "Insert wide bore needle in 5th ICS in the mid-clavicular line"
      },
      {
        "id": 3,
        "text": "Insert wide bore needle in 2nd ICS in the mid-axillary line"
      },
      {
        "id": 4,
        "text": "Insert wide bore needle in 2nd ICS in the mid-clavicular line"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Insertion of a wide-bore needle in the\u00a0<strong>5th intercostal space</strong> anterior to the\u00a0<strong>mid-axillary</strong> line is the first-line management in <strong>adults</strong> with <strong>tension pneumothorax.</strong></p>\n<p>Management of tension pneumothorax:</p>\n<ul>\n<li><strong>Immediate </strong>management: <strong>Needle decompression</strong> or <strong>needle thoracostomy</strong> i.e. insertion of a wide-bore needle in the 5th ICS anterior to the midaxillary line</li>\n<li><strong>Definitive</strong> management: <strong>Tube thoracostomy</strong> or <strong>chest tube insertion</strong> in the 5th ICS in the triangle of safety</li>\n</ul>\n<p>If a <strong>sucking wound</strong> is present, the <strong>immediate</strong> step is to cover the wound with gauze pieces and <strong>tape on 3 sides</strong>. Following this, chest tube is inserted away from the site of the wound.</p>\n<p>Note: According to<strong> ATLS 10th edition</strong></p>\n<ul>\n<li>In<strong> adults</strong>, needle thoracostomy or needle decompression location is changed to <strong>5th ICS</strong> <strong>anterior</strong> to the <strong>midaxillary line</strong> from 2nd ICS\u00a0midclavicular line.</li>\n<li>In the <strong>pediatric</strong> age group, the needle thoracostomy location remains at the <strong>2nd ICS midclavicular line</strong>.</li>\n</ul>\n<p><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;This is a recently updated guideline in the management of Tension Pneumothorax according to the ATLS-2018. This update was recommended since Chest wall thickness influences the likelihood of success with needle decompression. Recent evidence supports placing the large, over-the-needle catheter at the fifth interspace, slightly anterior to the midaxillary line.&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:769,&quot;3&quot;:{&quot;1&quot;:0},&quot;11&quot;:4,&quot;12&quot;:0}\">This update was recommended since chest wall thickness influences the likelihood of success with needle decompression. Inserting needle in 5th ICS anterior to the midaxillary line had better outcomes.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An intern placed an intercostal drainage tube in a patient. Which of the following steps is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Identified 5th intercostal space anterior to mid axillary line to place the tube"
      },
      {
        "id": 2,
        "text": "Inserted tube along the lower border of upper rib"
      },
      {
        "id": 3,
        "text": "Directed tube posteriorly to prevent injury"
      },
      {
        "id": 4,
        "text": "Incised and digitally explored"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Contraindications include pulmonary adhesions, pulmonary trauma, coagulopathy, and diaphragmatic hernia.</p>\n<p>Complications of this procedure:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Infection</strong> at the site of insertion</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Unintentional injury to the lung - hemothorax</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Intercostal</strong> <strong>nerve</strong>/ vessel <strong>injury</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Subcutaneous</strong> <strong>hematoma</strong>/ emphysema</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbb7828e4d654d018050ab754e95a27dx600x577.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50dafcb6fb95459fb279a729d959b6bex600x1759.JPEG"
    ]
  },
  {
    "text": "Proper functioning of ICD tube is indicated by _____.",
    "choices": [
      {
        "id": 1,
        "text": "Continuous air bubbles coming out of the underwater drain"
      },
      {
        "id": 2,
        "text": "Oscillation of water column in the tube"
      },
      {
        "id": 3,
        "text": "Chest X-ray"
      },
      {
        "id": 4,
        "text": "Auscultation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Oscillation of the water column level</strong> (moving up and down during respiration) within the tube in the water seal chamber is indicative of a <strong>functioning (patent) ICD tube</strong>.&nbsp;</p>\n<p>During spontaneous respiration, the water level rises with inspiration and falls with expiration. Whereas during positive pressure ventilation, the opposite occurs. This oscillation is also known as tidaling.</p>\n<p>Other options:</p>\n<p>Option A: Continous bubbling indicates an air leak in the drainage system, which should be corrected</p>\n<p>Option B: Chest X-ray is useful for assessing the position of the ICD tube inside the chest, not its functioning.</p>\n<p>Option C: Auscultation is not useful for assessing the functioning of an ICD tube.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year old man is brought to the emergency room with a stab injury to his chest. On examination, the patient is found to be hemodynamically unstable. His neck veins are engorged and heart sounds are muffled. Which of the following statements about the patient is false?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade is likely to be present"
      },
      {
        "id": 2,
        "text": "The entry wound is sealed on all 4 sides with an occlusive dressing if pneumothorax is suspected"
      },
      {
        "id": 3,
        "text": "eFAST is done to confirm blood in pericardial sac"
      },
      {
        "id": 4,
        "text": "Needle pericardiocentesis is not recommended"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">Cardiac tamponade must be di<span class=\"s1\">\ufb00</span>erentiated from tension pneumothorax in a patient with hemodynamic instability and distended neck veins.</p>\n<p class=\"p1\">Cardiac tamponade is\u00a0characterized by <strong>Beck\u2019s triad:</strong></p>\n<ul>\n<li class=\"p1\">Muffled heart sounds</li>\n<li class=\"p1\">Distended neck veins</li>\n<li class=\"p1\">Hypotension</li>\n</ul>\n<p><strong>Tension pneumothorax\u00a0</strong>is characterized by\u00a0<strong>absent breath sounds</strong> and <strong>hyper resonance</strong> on percussion on the affected side.\u00a0These\u00a0are not present in a patient with cardiac tamponade.</p>\n<p class=\"p1\">Diagnosis of cardiac tamponade can be done by <strong>eFAST</strong> which shows fluid in the pericardial sac.\u00a0</p>\n<ul>\n<li class=\"p1\">Definitive management - emergency thoracotomy or sternotomy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99bfb258388e41e181c7c466f0401650x407x305.PNG"
    ]
  },
  {
    "text": "In a blast injury, which of the following organs is least vulnerable to the blast wave?",
    "choices": [
      {
        "id": 1,
        "text": "GI tract"
      },
      {
        "id": 2,
        "text": "Lungs"
      },
      {
        "id": 3,
        "text": "Liver"
      },
      {
        "id": 4,
        "text": "Ear drum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In a <strong>blast injury</strong>, the <strong>liver</strong> is the <strong>least</strong> <strong>vulnerable</strong> to blast wave (primary blast) injury.</p>\n<p><strong>Blast injury</strong> is a complex type of <strong>physical</strong> <strong>trauma</strong> resulting from <strong>direct</strong> or <strong>indirect</strong> exposure to an <strong>explosion</strong>. <strong>Primary blast injuries</strong> result from the rapid overpressure or <strong>shock waves</strong> produced by an <strong>explosion</strong>. These injuries result from the dramatic <strong>changes in barometric pressure</strong> projecting outwards from the point of detonation. They <strong>predominantly</strong> cause <strong>damage</strong> to<strong> air-filled hollow organs</strong> of the body from rapid pressure change (barotrauma). This includes the <strong>middle ear, lungs, and GIT</strong>.</p>\n<p>The <strong>most</strong> <strong>sensitive</strong> and most <strong>frequently</strong> <strong>injured</strong> hollow organs are the<strong> tympanic membranes &gt; lungs</strong>. Blast damage to the lungs is the most common cause of life-threatening injury following an explosion.</p>\n<p><strong>Solid organs</strong> are the <strong>most resistan</strong>t to blast injuries as the <strong>parenchymal disruption</strong> requires<strong> very high levels of overpressure</strong>.&nbsp;</p>\n<p><strong>Classification</strong> of blast injuries:</p>\n<table style=\"border-collapse: collapse; width: 63.5154%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 13.8714%;\"><strong>Classification</strong></td>\n<td style=\"width: 19.0416%;\"><strong>Explanation</strong></td>\n<td style=\"width: 25.7251%;\"><strong>Injury type</strong></td>\n<td style=\"width: 41.2358%;\"><strong>Examples</strong></td>\n</tr>\n<tr>\n<td style=\"width: 13.8714%;\">Primary blast</td>\n<td style=\"width: 19.0416%;\">Due to air pressure from the blast</td>\n<td style=\"width: 25.7251%;\">Shockwave (overpressure)</td>\n<td style=\"width: 41.2358%;\"><strong>Tympanic membrane</strong> injury, blast lung, intestinal blast injury</td>\n</tr>\n<tr>\n<td style=\"width: 13.8714%;\">Secondary blast</td>\n<td style=\"width: 19.0416%;\">Fragments from the blast, following a detonation</td>\n<td style=\"width: 25.7251%;\">Penetrating/fragmentation</td>\n<td style=\"width: 41.2358%;\">All <strong>penetrating</strong> injuries</td>\n</tr>\n<tr>\n<td style=\"width: 13.8714%;\">Tertiary blast</td>\n<td style=\"width: 19.0416%;\">Gross movements of persons, objects, or infrastructure by the blast wind</td>\n<td style=\"width: 25.7251%;\">Blunt trauma</td>\n<td style=\"width: 41.2358%;\"><strong>Blunt and crush</strong> injuries. Traumatic amputation.</td>\n</tr>\n<tr>\n<td style=\"width: 13.8714%;\">Quaternary blast</td>\n<td style=\"width: 19.0416%;\">Miscellaneous causes</td>\n<td style=\"width: 25.7251%;\">Exposure to explosive products or toxic substances</td>\n<td style=\"width: 41.2358%;\"><strong>Burns</strong>, inhalation injury</td>\n</tr>\n<tr>\n<td style=\"width: 13.8714%;\">Quinary blast</td>\n<td style=\"width: 19.0416%;\">The <strong>intentional addition</strong> of biological or radioactive material to the explosive device</td>\n<td style=\"width: 25.7251%;\">Environmental contaminants</td>\n<td style=\"width: 41.2358%;\"><strong>Radiation</strong> sickness, <strong>infection</strong>.</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Following a motor vehicle collision, a 30-year-old male sustained blunt trauma to his abdomen. What is the organ most likely to be injured?",
    "choices": [
      {
        "id": 1,
        "text": "Liver"
      },
      {
        "id": 2,
        "text": "Spleen"
      },
      {
        "id": 3,
        "text": "Jejunum"
      },
      {
        "id": 4,
        "text": "Mesentery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>spleen</strong> is the most <strong>common</strong> organ involved in <strong>blunt trauma</strong> injury of the <strong>abdomen.</strong></p>\n<p>In blunt trauma, organs that cannot yield to impact by elastic deformation are most likely to be injured, namely, the <strong>solid organs</strong> (liver, spleen, and kidneys).</p>\n<p>For <strong>penetrating trauma</strong>, organs with the<strong> largest surface area</strong> when <strong>viewed from the front</strong> are most prone to injury (small bowel, liver, and colon). Additionally, since bullets and knives usually follow straight lines, <strong>adjacent structures</strong> are commonly injured (e.g., the <strong>pancreas and duodenum</strong>).</p>\n<p><strong>Deceleration </strong>injures&nbsp;the <strong>pedicled organs</strong>&nbsp;by <strong>shearing</strong>&nbsp;the organs from their points of attachment to the retroperitoneum (intestines and kidney).</p>\n<p>The most <strong>commonly</strong> injured <strong>bowel</strong> in cases of blunt trauma of the abdomen is <strong>jejunum.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man stabbed his elder brother using a knife over a property dispute. Which is the most common organ that is likely to be injured in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Spleen"
      },
      {
        "id": 2,
        "text": "Liver"
      },
      {
        "id": 3,
        "text": "Small intestine"
      },
      {
        "id": 4,
        "text": "Mesentery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> liver i</strong>s the&nbsp;most common organ to be injured in <strong>penetrating stab injury</strong> of the abdomen. It is due to its anterior location, size and fragile parenchyma.</p>\n<p>The most common organ injured in <strong>blunt</strong> trauma to the abdomen is <strong>spleen</strong> &gt; liver.</p>\n<p>The most common organ injured in&nbsp;<strong>gunshot</strong> injury is the <strong>small intestine&nbsp;</strong>&gt; colon.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A landlord who was stabbed in his abdomen by one of his tenants for demanding rent was brought to the casualty. He was taken up for laparotomy which revealed a severely injured cecum. What is the best management option for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Catheter tube cecostomy"
      },
      {
        "id": 2,
        "text": "Right hemicolectomy with ileocolostomy"
      },
      {
        "id": 3,
        "text": "Transverse colostomy"
      },
      {
        "id": 4,
        "text": "End loop sigmoid colostomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Injuries distal to the middle colic artery require <strong>segmental resection</strong> with colocolostomy anastomosis. Immediate anastomosis should be avoided in <strong>patients with shock</strong> due to the high<strong> incidence of</strong> <strong>leaks</strong> following the procedure. In such patients, <strong>colostomy </strong>and<strong> delayed primary anastomosis</strong> should be done.</p>\n<p>Option A:&nbsp;<strong>Catheter tube cecostomy</strong> is of therapeutic value in refractory colonic pseudo-obstruction, cecal volvulus, or distal colonic obstruction.</p>\n<p>Option C: <strong>Transverse colostomy</strong> is generally done in patients with distal obstruction for temporary fecal diversion.</p>\n<p>Option D:&nbsp;An <strong>end-loop sigmoid colostomy</strong> is an ideal stoma for <strong>distal fecal diversion </strong>for<strong> incontinence</strong> or in association with complex anorectal procedures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2b1279c2c614b47839631dbf7062100x600x663.JPEG"
    ]
  },
  {
    "text": "A patient is shifted for emergency laparotomy for the management of an intra-abdominal haemorrhage, following a road traffic accident. Intraoperatively, you find an active bleed from the liver. Which of the following techniques will you use to control the bleed?",
    "choices": [
      {
        "id": 1,
        "text": "Clamping the hepatic artery"
      },
      {
        "id": 2,
        "text": "Occluding the portal vein"
      },
      {
        "id": 3,
        "text": "Clamping the hepatic veins"
      },
      {
        "id": 4,
        "text": "Clamping the hepatoduodenal ligament"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>hepatoduodenal ligament</strong> can be clamped to decrease active hemorrhage from the liver.&nbsp;This is called <strong>Pringle's maneuver.</strong></p>\n<p>This maneuver applies pressure on the <strong>portal triad</strong>&nbsp;which contains bile duct, portal vein and hepatic artery. This helps <strong>distinguish hepatic arterial </strong>and <strong>portal venous bleeding</strong> from hepatic vein bleeding. Hepatic venous bleed will persist with the hepatoduodenal ligament clamped. The liver laceration can then be explored and any actively bleeding vessels controlled with suture ligation.</p>\n<p>4 P's in the management of liver injuries are:&nbsp;</p>\n<ul>\n<li><strong>Push&nbsp;</strong>- compression of the edges of the laceration</li>\n<li><strong>Pringle&nbsp;</strong>- applying pressure on the portal triad</li>\n<li><strong>Plug</strong> the defects with silicon tubes</li>\n<li><strong>Pack&nbsp;</strong>- apply packs in and around the liver to arrest bleeding.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f1210d13d9c4b2f892e09a3c49f2a8cx720x569.GIF"
    ]
  },
  {
    "text": "A patient develops abdominal compartment syndrome following an emergency laparotomy. Which of the following is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Decreased central venous pressure"
      },
      {
        "id": 2,
        "text": "Increased heart rate"
      },
      {
        "id": 3,
        "text": "Increased systemic vascular resistance"
      },
      {
        "id": 4,
        "text": "Decreased GFR"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Central venous pressure</strong> (CVP) <strong>increases</strong> due to inferior vena cava (IVC) and portal vein compression in <strong>abdominal compartment syndrome.</strong></p>\n<p>Abdominal Compartment Syndrome (ACS) is defined as increased intra-abdominal pressure (IAP)<strong>&nbsp;&gt;20 mm Hg</strong>&nbsp;resulting in compression of abdominal structures&nbsp;(Normal IAP = 5-&shy;7 mmHg and<strong> intra&shy;abdominal hypertension IAP &ge; 12 mmHg</strong>).</p>\n<p>This produces fatal complications due to pulmonary failure and mesenteric vascular compromise. Elevated intra-abdominal pressure leads to a <strong>decrease in venous return</strong> resulting in <strong>decreased cardiac output</strong>. An <strong>increase in heart rate</strong> partly compensates this<strong>. </strong></p>\n<p>Systemic vascular resistance (afterload) is increased by the compression of both the aorta and systemic vasculature. This also leads to an increase in renal vascular resistance leading to a <strong>reduced glomerular filtration rate</strong>.&nbsp;</p>\n<p>Causes of <strong>primary ACS</strong> include:</p>\n<ul>\n<li>Abdominal trauma</li>\n<li>Hemorrhage</li>\n<li>Intestinal obstruction</li>\n<li>Retroperitoneal hematoma</li>\n</ul>\n<p>Causes of <strong>secondary&nbsp;ACS</strong> include:</p>\n<ul>\n<li>Pregnancy</li>\n<li>Ascites</li>\n<li>Ileus</li>\n<li>Intra-abdominal sepsis</li>\n<li><strong>Large-volume fluid replacement</strong> (greater than 3L)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about abdominal compartment syndrome is false?",
    "choices": [
      {
        "id": 1,
        "text": "Hypercarbia and respiratory acidosis"
      },
      {
        "id": 2,
        "text": "Hypoxia due to increased peak inspiratory pressure"
      },
      {
        "id": 3,
        "text": "Hypotension due to decrease in venous return"
      },
      {
        "id": 4,
        "text": "Oliguria due to ureter obstruction"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Oliguria</strong> is due to <strong>reduced renal blood flow.&nbsp;</strong></p>\n<p>An increase in renal vascular resistance leads to a reduction in glomerular filtration rate and impaired urine output.</p>\n<p>Abdominal compartment syndrome is characterized by :</p>\n<ul>\n<li>A sudden increase in intra&shy;abdominal pressure</li>\n<li>Increased peak inspiratory pressure</li>\n<li><strong>Hypercarbia</strong> and <strong>respiratory acidosis</strong></li>\n<li><strong>Decreased urinary</strong> <strong>output</strong> &ndash; due to reduced renal blood flow</li>\n<li><strong>Hypotension -&nbsp;</strong> secondary to <strong>decreased venous return</strong> to the heart.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are evaluating a patient in the burns unit, who had sustained third-degree burns to her abdomen and lower limbs (BSA of 30%). She had received 9 liters of Ringer's lactate at a primary center. On examination, extensive abdominal eschars are seen. BP - 84/50 mmHg, HR - 118 bpm and urine output has been less than 15 ml for the past 2 hours. The ventilator shows a peak airway pressure of 42 cm H2O. What is the most appropriate next step?",
    "choices": [
      {
        "id": 1,
        "text": "Administration of dobutamine"
      },
      {
        "id": 2,
        "text": "Measurement of bladder pressure"
      },
      {
        "id": 3,
        "text": "Diuresis with furosemide"
      },
      {
        "id": 4,
        "text": "Increase PEEP"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span style=\"font-size: 14px;\">The given clinical scenario is suggestive of <strong>abdominal compartment syndrome (ACS). </strong>Measurement of <strong>bladder pressure</strong> using a&nbsp;</span><strong>urinary bladder catheter</strong> <span style=\"font-size: 14px;\">is the next best step in the management of this patient.</span></p>\n<p>The <strong>oliguria</strong> and <strong>hypotension</strong>&nbsp;in isolation could be suggestive of under-resuscitation. However, the history of <strong>large volume fluid administration</strong>, presence of <strong>abdominal eschars</strong> along with very <strong>high peak airway pressures</strong> should raise the suspicion for <strong>ACS</strong>.</p>\n<p>Abdominal compartment syndrome refers to an elevation of intra-abdominal pressure &gt; 20mmHg with associated organ compression and dysfunction:</p>\n<ul>\n<li><strong>Compression</strong> of the <strong>IVC</strong>&nbsp;leads to decreased cardiac output, and consequent increase in systemic vascular resistance, leading to&nbsp;<strong>hypotension.</strong>&nbsp;</li>\n<li><strong>Cephalad displacement</strong> of the <strong>diaphragm</strong> results in decreased thoracic volumes and results in <strong>elevated peak</strong> and <strong>plateau pressures.</strong>&nbsp;</li>\n<li><strong>Renal compression</strong> can lead to increased renal vascular resistance, <strong>decreased GFR</strong> and <strong>low urine output</strong>.&nbsp;&nbsp;</li>\n</ul>\n<p><strong>Measurement of bladder</strong> (intravesical) <strong>pressure</strong> is the <strong>standard method</strong> to screen for intra-abdominal hypertension (IAH) and abdominal compartment syndrome.</p>\n<table style=\"height: 188px; width: 413.984375px;\">\n<tbody>\n<tr>\n<td style=\"width: 204px;\">Grade of Intra-abdominal hypertension (IAH)</td>\n<td style=\"width: 202.984375px;\">Intra-abdominal pressure (IAP)</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade I</td>\n<td style=\"width: 202.984375px;\">12&ndash;15 mmHg</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade II</td>\n<td style=\"width: 202.984375px;\">16&ndash;20 mmHg</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade III</td>\n<td style=\"width: 202.984375px;\">21&ndash;25 mmHg</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade IV</td>\n<td style=\"width: 202.984375px;\">&gt;25 mmHg</td>\n</tr>\n</tbody>\n</table>\n<p>Note: Direct methods such as pressure transducers and intraperitoneal catheters are more accurate but are limited by their invasiveness.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is admitted to the intensive care unit following a trauma to the abdomen. His intraabdominal pressure is found to be 24 mmHg. What is the grade of abdominal hypertension?",
    "choices": [
      {
        "id": 1,
        "text": "Grade I"
      },
      {
        "id": 2,
        "text": "Grade II"
      },
      {
        "id": 3,
        "text": "Grade III"
      },
      {
        "id": 4,
        "text": "Grade IV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Intraabdominal pressure <strong>(IAP)</strong> of <strong>24 mm Hg</strong> falls under <strong>grade&nbsp;III</strong> of intra-abdominal hypertension (IAH).</p>\n<p>Normal intraabdominal pressure is<strong> 5 to 7 mmHg.</strong> Any acute process in the abdomen such as <strong>trauma, intestinal perforation, peritonitis,</strong>&nbsp;or acute pancreatitis can increase the intra-abdominal pressure. Increased abdominal pressure can diminish the blood flow to the abdominal organs and decrease the venous return to the heart.</p>\n<p><strong>Measurement of bladder</strong> (intravesical) <strong>pressure</strong> is the <strong>standard method</strong> to screen for intra-abdominal hypertension (IAH) and abdominal compartment syndrome.</p>\n<table style=\"height: 188px; width: 413.984375px;\">\n<tbody>\n<tr>\n<td style=\"width: 204px;\">Grade of Intra-abdominal hypertension (IAH)</td>\n<td style=\"width: 202.984375px;\">Intra-abdominal pressure (IAP)</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade I</td>\n<td style=\"width: 202.984375px;\">12&ndash;15 mmHg</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade II</td>\n<td style=\"width: 202.984375px;\">16&ndash;20 mmHg</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade III</td>\n<td style=\"width: 202.984375px;\">21&ndash;25 mmHg</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\">Grade IV</td>\n<td style=\"width: 202.984375px;\">&gt;25 mmHg</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Grade III</strong> intra-abdominal hypertension is associated with <strong>hypoxia</strong>,&nbsp;<strong>ARDS</strong> and serious complications. It is associated with&nbsp;<strong>abdominal compartment syndrome </strong>which is defined as a <strong>sustained IAP &gt;20 mmHg</strong> associated with organ dysfunction/failure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Following a road traffic accident, a child presents with abdominal pain. On examination, vitals are stable and tenderness is present in the left lumbar region. Which is the best investigation of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast enhanced CT scan"
      },
      {
        "id": 2,
        "text": "Retrograde urethrogram"
      },
      {
        "id": 3,
        "text": "Wait and watch"
      },
      {
        "id": 4,
        "text": "Emergency laparotomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette with <strong>abdominal pain</strong> and tenderness in&nbsp;the left lumbar region following a road traffic accident is suggestive of <strong>blunt renal trauma</strong>. The investigation of choice is <strong>CECT</strong> in a<strong> hemodynamically stable patient.</strong></p>\n<p><strong>Blunt trauma</strong> is the main cause of renal injuries and is self-limiting. Radiological investigations are indicated when there is <strong>gross haematuria</strong>, shock in combination with microscopic haematuria, pediatric renal trauma, and penetrating injuries.</p>\n<p><strong>CECT</strong> is the investigation of choice. It assesses&nbsp;the extent of the injury, showing laceration, extravasation, surrounding hemorrhage, and vessel injury. It also shows non-renal injuries and effectively stages renal pedicle injuries. Arterial occlusion will manifest as rim enhancement of the normal renal contour.</p>\n<p>Blunt trauma is mostly treated <strong>conservatively. </strong>Most of the penetrating injuries require surgical <strong>renal exploration.</strong></p>\n<p>Absolute indications for surgical intervention in renal trauma are:</p>\n<ul>\n<li>Massive hemorrhage</li>\n<li>Renal pedicle avulsion (grade 5 injury)</li>\n<li>Expanding, pulsatile, or uncontained <strong>retroperitoneal</strong> hematoma</li>\n</ul>\n<p>Relative indications are:</p>\n<ul>\n<li>Large laceration of the renal pelvis or avulsion of the ureteropelvic junction</li>\n<li>Bowel or pancreatic injuries</li>\n<li>Persistent urinary leakage, postinjury urinoma, or perinephric abscess&nbsp;</li>\n<li>Complete renal artery thrombosis of both kidneys&nbsp;</li>\n<li>Renal hypertension</li>\n</ul>\n<p><strong>Exploratory laparotomy</strong> is recommended in stable patients with penetrating renal injuries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A trauma patient suffers a renal laceration with urine extravasation. He is managed conservatively. However, after a few days, he presents with a urinoma. The next best management for this patient would be?",
    "choices": [
      {
        "id": 1,
        "text": "Ureteral stenting"
      },
      {
        "id": 2,
        "text": "Surgical repair and exploration"
      },
      {
        "id": 3,
        "text": "Observation"
      },
      {
        "id": 4,
        "text": "Percutaneous drainage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient with a history of <strong>grade IV renal injury </strong>(renal laceration with urine extravasation) who develops a <strong>persistent urinoma </strong>(a mass formed by encapsulated extravasated urine) should be managed with the placement of an internal <strong>ureteral stent. </strong></p>\n<p>In patients not cured by ureteral stenting, percutaneous\u00a0nephrostomy or transcutaneous drain may be required.</p>\n<p><strong>Management of renal injuries</strong></p>\n<p><strong>Blunt trauma</strong> is the main cause of renal injuries and is self-limiting. Blunt trauma is mostly treated <strong>conservatively. </strong>Most penetrating injuries require surgical <strong>renal exploration.</strong></p>\n<ul>\n<li><strong>Grading</strong> of injury through <strong>CECT</strong></li>\n<li>If hemodynamically <strong>stable</strong>\n<ul>\n<li><strong>Conservative</strong> management - Bedrest &amp; hemodynamic monitoring</li>\n<li>In grade <strong>IV</strong>, a <strong>repeat CT</strong> scan to ensure the extravasation of urine has resolved.</li>\n</ul>\n</li>\n<li>If hemodynamically <strong>unstable</strong>\n<ul>\n<li>Surgical exploration and repair</li>\n<li>In grade V, <strong>nephrectomy.</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While performing emergency laparotomy for an unstable RTA case with blunt abdominal trauma, the surgeon notices a hematoma around the left kidney. What will be the next step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Single-shot intravenous pyelography"
      },
      {
        "id": 2,
        "text": "Contrast-enhanced  computed tomography"
      },
      {
        "id": 3,
        "text": "Ultrasonography of the abdomen"
      },
      {
        "id": 4,
        "text": "Direct renal exploration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>The next step</strong> in the surgical management of the patient found to have a hematoma around the kidney,<strong> intraoperatively</strong>,&nbsp;will be a&nbsp;<strong>single-shot intravenous pyelography (IVP)</strong>.&nbsp;</p>\n<p>If immediate operative exploration for other injuries is required, <strong>renal injury staging</strong> can be performed while the patient is still in the operating room, using single-shot IVP.&nbsp;It is useful in assessing the&nbsp;<strong>function </strong>of the <strong>kidneys </strong>and<strong>&nbsp;</strong>the<strong> extent </strong>of the <strong>injury</strong>.&nbsp;If the <strong>IVP&nbsp; is abnormal</strong> or the hematoma is pulsatile, then <strong>renal exploration</strong> should be performed.</p>\n<p>Note:<strong>&nbsp;</strong><strong>CECT </strong>is the method of choice for staging a patient with <strong>hemodynamically stable</strong> renal trauma presenting at the emergency room.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child presents with grade 2 splenic injury following blunt trauma to the abdomen. On examination, there are no signs of bleeding. Which of the following is the most appropriate management for this child?",
    "choices": [
      {
        "id": 1,
        "text": "Conservative management"
      },
      {
        "id": 2,
        "text": "Splenectomy"
      },
      {
        "id": 3,
        "text": "Embolization"
      },
      {
        "id": 4,
        "text": "Splenorrhaphy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Conservative management&nbsp;</strong>is the most appropriate management in this child.</p>\n<p><strong>Selective Non-Operative Management&nbsp;</strong>(SNOM)&nbsp;is usually followed in:</p>\n<ul>\n<li><strong>Stable patients</strong> with no active bleeding</li>\n<li>Patients<strong> younger than 55 years </strong>of age</li>\n<li>Patients with<strong> grade I, II, III injuries</strong>.</li>\n</ul>\n<p>Any patient who is <strong>hemodynamically unstable,&nbsp;</strong>has active bleeding, and has grade <strong>IV</strong> and <strong>V</strong> splenic injury should be managed by <strong>surgery</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/be82875ccf2b43c59b45f7cbc28ad2bdx1280x2099.JPEG"
    ]
  },
  {
    "text": "Which of the following is a correct statement regarding retroperitoneal trauma?",
    "choices": [
      {
        "id": 1,
        "text": "All zone 1 injury to be treated conservatively"
      },
      {
        "id": 2,
        "text": "Zone 3 injury whether blunt or penetrative should always be explored"
      },
      {
        "id": 3,
        "text": "Zone 2 injury with expanding hematoma should be treated surgically"
      },
      {
        "id": 4,
        "text": "Mattox maneuver is when the ascending colon is mobilized to the right to visualise the aorta"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Surgical exploration</strong> is done in cases of <strong>penetrating injuries</strong> to <strong>any zone</strong>.</p>\n<p>Other options:</p>\n<p>Option A: Zone 1 injuries are always <strong>explored</strong>.</p>\n<p>Option B: Depending on the situation, zone 3 injuries can be managed with surgical exploration or conservatively.</p>\n<p>Option D: <strong>Mattox manoeuvre</strong> is <strong>left </strong>medial visceral rotation to expose the <strong>aorta</strong>, while the <strong>Cattell-Braasch manoeuvre</strong> is done by <strong>right </strong>medial visceral rotation to expose <strong>IVC</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8ae306810554d0eb5c8705e99bb0499x1280x1460.JPEG"
    ]
  },
  {
    "text": "A young male patient is taken up for laparotomy following a stab injury. Pringle\u2019s maneuver is done. Which of the following statements is false about this maneuver?",
    "choices": [
      {
        "id": 1,
        "text": "It is used to differentiate between hepatic arterial and hepatic venous bleed"
      },
      {
        "id": 2,
        "text": "Arterial bleed persists on performing the maneuver"
      },
      {
        "id": 3,
        "text": "Hepatic pedicle is compressed at the epiploic foramen"
      },
      {
        "id": 4,
        "text": "Prolonged application of pressure can lead to hepatic necrosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>4 P's in the management of liver injuries are:&nbsp;</p>\n<ul>\n<li><strong>Push&nbsp;</strong>- compression of the edges of the laceration</li>\n<li><strong>Pringle&nbsp;</strong>- applying pressure on the portal triad</li>\n<li><strong>Plug</strong> the defects with silicon tubes</li>\n<li><strong>Pack&nbsp;</strong>- apply packs in and around the liver to arrest bleeding.</li>\n</ul>\n<p>Prolonged intraoperative use of Pringle maneuver can lead to hepatic ischemia and necrosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4daf653832474fc2b639602c4fbe648bx1280x1630.JPEG"
    ]
  },
  {
    "text": "An elderly lady presents to the trauma care centre following a motor vehicle collision. She complains of chest pain and abdominal pain. On examination, breath sounds are decreased on the right side. X ray chest revealed the following finding. Which of the following statements is false regarding the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Most accurate evaluation of this condition is by VATS"
      },
      {
        "id": 2,
        "text": "Operative repair is indicated in all cases"
      },
      {
        "id": 3,
        "text": "In case of penetrating injury, repair can be done via thoracic incision"
      },
      {
        "id": 4,
        "text": "The defect must be closed with polypropylene sutures"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical history and X-ray image showing obliteration of the diaphragmatic outline are suggestive of <strong>traumatic diaphragmatic injury</strong> in this patient. <strong>Penetrating diaphragmatic injury</strong> must be repaired via the <strong>abdomen</strong> and not the thorax, to rule out penetrating hollow viscus injury.&nbsp;</p>\n<p>Patients with diaphragmatic injury are generally asymptomatic. <strong>Chest X ray after the insertion of a nasogastric tube</strong> may help in identifying the herniation of the stomach in the thoracic cavity. However, the most accurate evaluation is by video assisted thoracoscopy (<strong>VATS</strong>) or laparoscopy. Abdominal contents may get herniated into the chest and get strangulated later. This is associated with high mortality. Hence, <strong>operative</strong> <strong>repair</strong> is indicated in all patients. The defect is closed with running 1-0<strong> polypropylene suture</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e77b3b2a39b545539cb7adaf2e80fccc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 17-year-old boy is brought to the ED after being involved in a high-speed motorcycle collision. He is hypotensive with a systolic pressure of 60 mm Hg. A FAST scan is positive. At laparotomy, he is found to have a large amount of bleeding from behind the liver with hollow-viscous perforation. Temporary application of a Pringle manoeuvre does not control the bleeding. However, laparotomy packs are placed, and the bleeding appears to slow down. The systolic blood pressure fails to increase even after aggressive resuscitation. The patient\u2019s pH is 7.06 and his temperature is 34\u00b0C. What would be the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ligate the hepatic arteries"
      },
      {
        "id": 2,
        "text": "Hepatectomy"
      },
      {
        "id": 3,
        "text": "Hepatic artery embolization"
      },
      {
        "id": 4,
        "text": "Shift to ICU to resuscitate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>4 P's in the management of liver injuries are:&nbsp;</p>\n<ul>\n<li>Push- Compression of the edges of the laceration</li>\n<li>Pringle- Applying pressure on the portal triad</li>\n<li>Plug the defects with silicon tubes</li>\n<li>Pack- Apply packs in and around the liver to arrest bleeding</li>\n</ul>\n<p><strong>General guidelines for the management of blunt trauma to the liver:<br /></strong></p>\n<ul>\n<li>Patients who are haemodynamically unstable will require an immediate laparotomy for damage control resuscitation.&nbsp;</li>\n<li>For the patient who is haemodynamically stable, imaging by CT should be performed to further evaluate the nature of the injury.</li>\n<li>Most patients with a blunt liver injury who are haemodynamically stable can be managed conservatively.</li>\n<li>The indication for discontinuing conservative treatment is the development of haemodynamic instability, evidence of ongoing blood loss despite correction of any underlying coagulopathy and the development of signs of generalised peritonitis.</li>\n<li>Interventional radiology has an important role in the management of liver trauma and embolisation to control hepatic artery bleeding is safe and effective in a stable patient with no evidence of hollow viscus perforation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/19a3fbf7b5d0424f80cbf9652a9a5821x1279x1623.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4036cc9b0ec9403abdd9a486966c7714x1280x1630.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5353dd7cd7934093baf22c25862bac2bx720x569.GIF"
    ]
  }
];
        let quizName = '06 Trauma - Spinal, Thoracic And Abdominal Injuries';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>