<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04 Acne, Rosacea And Others - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a specific lesion of acne vulgaris?",
    "choices": [
      {
        "id": 1,
        "text": "Cysts"
      },
      {
        "id": 2,
        "text": "Pustules"
      },
      {
        "id": 3,
        "text": "Comedones"
      },
      {
        "id": 4,
        "text": "Nodules"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 2340\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Comedones </strong>are the&nbsp;specific lesions of <strong>acne vulgaris.</strong></p>\n<p>Acne is a <strong>chronic inflammatory</strong> disease of the <strong>pilosebaceous</strong> unit. Comedonal<strong>&nbsp;</strong>lesions<strong>&nbsp;</strong>are the<strong> earliest</strong> lesions of<strong>&nbsp;</strong>acne.&nbsp;They represent the keratin plugs of the pilosebaceous duct.</p>\n<p>When the <strong>keratin plug</strong> is <strong>inside</strong> the follicle, it is called a&nbsp;<strong>closed</strong> comedone<strong>&nbsp;</strong>(<strong>whitehead</strong>).</p>\n<p>When the keratin plug is <strong>exposed</strong> to the <strong>environment,</strong> it gets oxidized by the air and turns black which is known as <strong>open</strong> comedone<strong>&nbsp;</strong>(<strong>blackhead</strong>).</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3bb36de0f39945b0aa35295123c5ddbdx1280x5399.JPEG"
    ]
  },
  {
    "text": "A 15-year-old girl presents with multiple papulopustular, erythematous lesions on her face. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acne rosacea"
      },
      {
        "id": 2,
        "text": "Acne vulgaris"
      },
      {
        "id": 3,
        "text": "Eczema"
      },
      {
        "id": 4,
        "text": "Tinea faciei"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The age of the patient and the presence&nbsp;of&nbsp;<strong>papules </strong>and&nbsp;<strong>pustules</strong> with an <strong>erythematous base</strong> on the face are suggestive of <strong>acne vulgaris.</strong></p>\n<p>It is commonly seen in <strong>teenagers</strong> and <strong>young adults.&nbsp;</strong>The condition can vary from very mild <strong>comedonal </strong>acne to severe aggressive <strong>pustular</strong> acne.<strong>&nbsp;</strong>These eventually may lead to <strong>scarring</strong> due to <strong>sinus formation</strong>.</p>\n<p>Option A: Acne rosacea or Rosacea is predominantly a disease with onset in middle\u2010aged adults (30&ndash;50 years old) and involves the convexities of the face.</p>\n<p>Option C: Eczema presents more over the flexures and extremities from early adulthood. Features of pruritus and excoriations are predominant.</p>\n<p>Option D: Tinea faciei is a fungal infection of the face and presents with a scaly lesion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a component of SAPHO syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Synovitis"
      },
      {
        "id": 2,
        "text": "Seborrhoea"
      },
      {
        "id": 3,
        "text": "Acne"
      },
      {
        "id": 4,
        "text": "Hyperostosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Seborrhoea</strong> is a constituent of <strong>SAHA</strong> syndrome, not SAPHO syndrome.</p>\n<p><strong>SAPHO syndrome </strong>consists of:</p>\n<ol>\n<li>Synovitis</li>\n<li>Acne</li>\n<li>Pustulosis</li>\n<li>Hyperostosis</li>\n<li>Osteitis</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A teenager presents to the dermatologist with the following finding. Which of the following is not a causative factor for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Androgen"
      },
      {
        "id": 2,
        "text": "Oily food"
      },
      {
        "id": 3,
        "text": "Bacterial proliferation"
      },
      {
        "id": 4,
        "text": "Hypercornification of duct"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A teenager presenting with papulopustular lesions on the face and the presence of comedones is most likely suffering from <strong>acne</strong>&nbsp;<strong>vulgaris</strong>.&nbsp;<strong>Oily skin</strong> due to excessive <strong>sebum</strong> production is one of the causative factors of acne, but&nbsp;<strong>oily food</strong>&nbsp;is <strong>not directly implicated</strong></p>\n<p>Acne results from the combination of:</p>\n<ul>\n<li><strong>Increased sebaceous gland activity</strong>&nbsp;under the influence of androgens - oily skin</li>\n<li>Abnormal follicular differentiation with increased keratinization- <strong>hypercornification </strong>of&nbsp;<strong>duct </strong>due to&nbsp;increased IL-1</li>\n<li><strong>Microbial hypercolonization</strong> of the follicular canal leading to its inflammation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e7c4ab056b37424ea20222e43f5cecad.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents with multiple nodulocystic lesions on the face. Which among the following is the drug of choice in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Steroids"
      },
      {
        "id": 2,
        "text": "Isotretinoin"
      },
      {
        "id": 3,
        "text": "Erythromycin"
      },
      {
        "id": 4,
        "text": "Tetracycline"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The presence of <strong>multiple nodulocystic lesions</strong> implies that this is a case of&nbsp;<strong>severe acne.&nbsp;</strong><strong>Isotretinoin</strong> is the first-line drug for the treatment of <strong>severe acne</strong> (nodular acne and acne conglobata).</p>\n<p><strong>Systemic retinoids</strong>&nbsp;are&nbsp;<strong>highly teratogenic&nbsp;</strong>and are absolutely contraindicated in&nbsp;pregnant women, those planning to become pregnant, or breastfeeding mothers. Two negative pregnancy tests (on separate occasions) are required for females of childbearing age before starting acitretin or isotretinoin.</p>\n<p><strong>Baseline evaluation</strong>&nbsp;of serum&nbsp;<strong>lipids</strong>,&nbsp;<strong>transaminases</strong>, and&nbsp;<strong>complete blood counts</strong>&nbsp;should be done before starting any systemic retinoids. These values should be checked&nbsp;<strong>monthly</strong>&nbsp;for the&nbsp;<strong>first 3&ndash;6 months</strong>&nbsp;and<strong>&nbsp;once every 3 months</strong>&nbsp;thereafter.&nbsp;<strong>Monthly pregnancy tests</strong>&nbsp;should be done while on the drug.&nbsp;</p>\n<p>Note: Female patients should&nbsp;<strong>avoid</strong>&nbsp;<strong>conception</strong>&nbsp;for<strong>&nbsp;3 years</strong>&nbsp;after discontinuing <strong>acitretin</strong> treatment for cutaneous <strong>psoriasis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old girl with pustular acne comes to your clinic for follow-up saying that her acne has not reduced even after taking medications for 6 months. Which of the following drugs will you now prescribe?",
    "choices": [
      {
        "id": 1,
        "text": "Oral erythromycin"
      },
      {
        "id": 2,
        "text": "Topical steroids"
      },
      {
        "id": 3,
        "text": "Oral retinoids"
      },
      {
        "id": 4,
        "text": "Oral tetracyclines"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Oral isotretinoin,&nbsp;</strong>an oral retinoid&nbsp;is indicated for the treatment of <strong>recalcitrant acne.</strong></p>\n<p>Recalcitrant acne is&nbsp;<strong>poorly responsive</strong> acne,<strong> less than 50% improvement</strong> after<strong> 6 months</strong> of therapy with combined oral and topical <strong>antibiotics.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with nodular acne has been on oral retinoids for 3 months. Which of the following tests are required to monitor the therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Liver function test"
      },
      {
        "id": 2,
        "text": "Renal function test"
      },
      {
        "id": 3,
        "text": "WBC count"
      },
      {
        "id": 4,
        "text": "Thyroid function test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Liver function tests (LFT)</strong> must be monitored during <strong>retinoid</strong> <strong>therapy</strong> as it can lead to variation in LFT by causing drug-induced liver injury.</p>\n<p><strong>Side effects</strong> of <strong>retinoids:</strong></p>\n<ul>\n<li><strong>Cheilitis</strong>/dryness of lips (<strong>most&nbsp;</strong><strong>common</strong>)&nbsp;</li>\n<li>Deranged liver function tests</li>\n<li>Hypertriglyceridemia</li>\n<li>Teratogenicity - contraception is required until 1 month of stoppage of <strong>isotretinoin.</strong></li>\n</ul>\n<p>Note: Female patients should&nbsp;<strong>avoid</strong>&nbsp;<strong>conception</strong>&nbsp;for<strong>&nbsp;3 years</strong>&nbsp;after discontinuing&nbsp;<strong>acitretin</strong>&nbsp;treatment to prevent&nbsp;<strong>retinoid-induced embryopathy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old girl with moderate acne also complains of irregular menses. Which of the following is the drug of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Retinoids"
      },
      {
        "id": 2,
        "text": "Tetracycline"
      },
      {
        "id": 3,
        "text": "Oral contraceptive pills"
      },
      {
        "id": 4,
        "text": "Minocycline"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Moderate acne</strong> with <strong>irregular menses</strong>&nbsp;are best treated with <strong>OCPs.</strong></p>\n<p>Giving&nbsp;<strong>OCP&nbsp;</strong>will increase <strong>sex hormone-binding globulin (SHBG)</strong> and hence<strong> reduce free androgens</strong> which play a major role in the pathogenesis of acne.&nbsp;In addition, OCPs also help in regularising the menses.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 17-year-old girl presents with the following skin lesions. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acne vulgaris"
      },
      {
        "id": 2,
        "text": "Acne rosacea"
      },
      {
        "id": 3,
        "text": "Seborrheic dermatitis"
      },
      {
        "id": 4,
        "text": "Milia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Milia</strong> are small cysts formed around the <strong>pilosebaceous follicles</strong> usually seen over nose, cheek, forehead of neonates. Pearly opalescent white epidermal inclusion cysts. Resolve spontaneously without scarring.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/51ca4c1092d543b8bd38e802a62884b2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d50d73c22e64a3aae77eac573ef0b0dx720x524.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/681f37a3a3d946e897e6570766af0be7x1134x1324.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/142d9e6134a642e0a19f4e63259980cfx720x598.JPEG"
    ]
  },
  {
    "text": "A 40-year-old woman presents with a 2-year history of erythematous papulopustular lesions over the center of her face. There is a background of erythema and telangiectasia. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acne vulgaris"
      },
      {
        "id": 2,
        "text": "Rosacea"
      },
      {
        "id": 3,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 4,
        "text": "Lupus pernio"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient comes with <strong>erythema</strong> and <strong>papules</strong> on facial convexities (<strong>central</strong> <strong>face</strong>), a characteristic feature of&nbsp;<strong>acne</strong> <strong>rosacea</strong>.</p>\n<p>It is triggered by exposure to sunlight, spicy food, alcohol, or emotional disturbances.&nbsp;Patients also develop <strong>telangiectasia</strong>&nbsp;later.&nbsp;They also have a tendency for developing <strong>rapid</strong> <strong>flushing</strong> due to temperature change.&nbsp;Rosacea is more common in <strong>women</strong>&nbsp;of age&nbsp;<strong>30-50 years.</strong></p>\n<p>The <strong>innate immune response</strong> in rosacea appears to be altered. There is increased Toll\u2010like receptor 2 (TLR2) activity and increased protease activity.&nbsp;</p>\n<p><strong>Demodex mite proliferation</strong> in the<strong> pilosebaceous follicles</strong> of the face has also been suggested as a possible aetiological factor in cutaneous and ocular inflammation.&nbsp;The pathogenesis of ocular rosacea seems to be closely associated with <strong>meibomian gland dysfunction</strong>.</p>\n<p>The table below shows the 4 subtypes and the corresponding treatment options. The subtypes are not equivalent to the progression of the disease.</p>\n<table style=\"height: 491px; width: 514px;\">\n<tbody>\n<tr>\n<td style=\"width: 189px; text-align: center;\"><strong>Subtype</strong></td>\n<td style=\"width: 309px; text-align: center;\"><strong>Treatment</strong></td>\n</tr>\n<tr>\n<td style=\"width: 189px; text-align: center;\">Erythematotelangiectatic rosacea (ETTR)</td>\n<td style=\"width: 309px;\">\n<ul>\n<li>Sun avoidance and protection</li>\n<li><strong>Topical &alpha;\u2010receptor</strong> agonists - brimonidine or oxymetazoline</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 189px; text-align: center;\">Papulopustular rosacea (PPR)</td>\n<td style=\"width: 309px;\">\n<p><strong>Active inflammatory lesions: </strong></p>\n<ul>\n<li>Topical metronidazole</li>\n<li>Azelaic acid</li>\n<li>Ivermectin</li>\n<li>Sodium sulfacetamide</li>\n<li>Sulfur</li>\n</ul>\n<p><strong>Perilesional erythema: </strong></p>\n<ul>\n<li>Brimonidine</li>\n<li>Oxymetazoline</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 189px; text-align: center;\">Phymatous rosacea</td>\n<td style=\"width: 309px;\">\n<ul>\n<li>Topical skin\u2010peeling agent if there are large occluded follicles</li>\n<li>Electrocautery or laser for telangiectases</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 189px; text-align: center;\">Ocular rosacea</td>\n<td style=\"width: 309px;\">\n<ul>\n<li>Daily lid hygiene</li>\n<li>Oily tear\u2010substitute lubricating eye drops or aqueous gels&nbsp;</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>The image below shows rosacea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c487778c55ac475ea8a913b04bef586dx800x529.JPEG"
    ]
  },
  {
    "text": "Intake of which of the following drugs can produce an acneiform eruption?",
    "choices": [
      {
        "id": 1,
        "text": "Tetracycline"
      },
      {
        "id": 2,
        "text": "Phenytoin"
      },
      {
        "id": 3,
        "text": "Aminoglycoside"
      },
      {
        "id": 4,
        "text": "Quinolone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Drug-induced acne (acneiform eruptions) are associated with the following:</p>\n<ul>\n<li><strong>Topical </strong>or&nbsp;<strong>systemic steroids&nbsp; </strong>(most common)</li>\n<li><strong>Anabolic steroids -&nbsp;</strong>danazol, stanozolol</li>\n<li><strong>Anticonvulsants -&nbsp;</strong>carbamazepine, <strong>phenytoin</strong>, phenobarbitone</li>\n<li><strong>Antituberculosis</strong> drugs- isoniazid, pyrazinamide</li>\n</ul>\n<p>Clinically, acneiform eruptions are characteristically <strong>monomorphic</strong>.</p>\n<p>Drugs <strong>most commonly </strong>implicated in&nbsp;acneiform eruptions:</p>\n<ul>\n<li>Worldwide- <strong>s</strong><strong>teroids</strong></li>\n<li>India- isoniazid (<strong>INH</strong>)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with obsessive-compulsive disorder presents with lesions on his face. He confides that he frequently picks at his face, regardless of the presence of acne. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acne excori\u00e9e"
      },
      {
        "id": 2,
        "text": "Acne fulminans"
      },
      {
        "id": 3,
        "text": "Acne conglobata"
      },
      {
        "id": 4,
        "text": "Acne mechanica"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This given image shows&nbsp;<strong>acn&eacute; excori&eacute;e</strong> on the chin of a male with compulsive picking of the face using nail pliers and tweezers.</p>\n<p>Acn&eacute; excori&eacute;e is regarded as a <strong>self\u2010inflicted</strong> skin condition in which the <strong>sufferer compulsively picks real</strong> or<strong> imagined acne lesions</strong> predominantly on the face. It is mostly seen in adolescent girls.&nbsp;</p>\n<p>Other psychiatric disorders associated with acne are:&nbsp;</p>\n<ul>\n<li><strong>Body dysmorphic disorder -</strong>&nbsp;Some patients have acne as their prime symptom. The perceived acne is out of proportion to physical signs.</li>\n<li><strong>Eating disorders -&nbsp;</strong>reported in anorexia nervosa. Acne itself may be a predisposing factor for anorexia in vulnerable teenaged age groups who adopt a diet in an attempt to control their acne.&nbsp;</li>\n</ul>\n<p>Option B:<strong>&nbsp;</strong>Acne fulminans or acne maligna is a rare and severe destructive form of acne presenting <strong>primarily in adolescent males</strong>. It most frequently affects the <strong>trunk</strong> but can affect the face and presents acutely in association with<strong> systemic symptoms</strong>.</p>\n<p>Options C:<strong>&nbsp;</strong>Acne conglobata represents a <strong>rare</strong> and<strong> severe</strong> form of acne characterized by <strong>multiple</strong> and<strong> extensive inflammatory papules</strong>, tender nodules, and abscesses which commonly <strong>coalesce</strong> to form <strong>malodorous draining sinus tracts</strong>.</p>\n<p>Option D: <strong>Acne mechanica&nbsp;</strong>describes acne that occurs at the site of <strong>repeated mechanical trauma</strong> and/or<strong> frictional obstruction</strong> of the <strong>pilosebaceous</strong> outlet resulting in comedo formation. Examples include &lsquo;fiddler&rsquo;s neck&rsquo;, which may occur on the neck of violin players, and is characterized by well\u2010defined plaques with the presence of comedones, lichenification, and pigmentation</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f05264f835394a4e8b2eebe4086b8b27.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a preferred chemical peel agent for a dark-skinned patient with acne?",
    "choices": [
      {
        "id": 1,
        "text": "Pyruvic acid"
      },
      {
        "id": 2,
        "text": "Lactic acid"
      },
      {
        "id": 3,
        "text": "Jessener's solution"
      },
      {
        "id": 4,
        "text": "Glycolic acid"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Glycolic acid</strong> is the preferred <strong>chemical peel</strong> agent in <strong>dark-skinned</strong>&nbsp;individuals.</p>\n<p><strong>Dark skin</strong> (Fitzpatrick type IV to VI) has a&nbsp;tendency for <strong>post-inflammatory hyperpigmentation</strong> (PIH) after procedures like lasers and chemical peel. Deep chemical peels cannot be used in dark-skinned patients. Even medium-depth peels need to be used with extreme caution.</p>\n<p>Chemical peels are believed to <strong>promote desquamation</strong> which reduces corneocyte cohesion and keratinocyte plugging, so enabling the extrusion of inflammatory contents.<strong>&nbsp;</strong>Light chemical peels are used with the aim of helping to<strong> remove comedones</strong> as well as <strong>superficial scarring and hyperpigmentation</strong>.</p>\n<p>Other peeling agents are:</p>\n<ul>\n<li>Pyruvic acid</li>\n<li>Lactic acid</li>\n<li>Maleic acid</li>\n<li>Citric acid</li>\n<li>Tartaric acid</li>\n<li>Mandelic acid</li>\n<li>Jessener's Solution - lactic acid + salicyclic acid + resorcinol</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the following condition.",
    "choices": [
      {
        "id": 1,
        "text": "Acne rosacea"
      },
      {
        "id": 2,
        "text": "Acne vulgaris"
      },
      {
        "id": 3,
        "text": "Rhinophyma"
      },
      {
        "id": 4,
        "text": "Sebaceous gland neoplasm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Rhinophyma&nbsp;</strong>(also known as <strong>p</strong><strong>otato</strong> <strong>nose</strong>) is a slowly progressive condition due to&nbsp;<strong>hypertrophy</strong> and<strong> hyperplasia</strong> of the<strong> sebaceous glands</strong> of the tip of the nose.</p>\n<p>It is often seen in cases of <strong>long-standing</strong>&nbsp;rosacea called <strong>phymatous rosacea.</strong>&nbsp;It is not a neoplasm.</p>\n<p>It presents as a <strong>pink, lobulated mass</strong> over the nose with superficial vascular dilation.&nbsp;It mostly affects <strong>men past middle age</strong>.&nbsp;Patients seek advice because of the distorted appearance of the enlarged nose, or obstruction in breathing and vision.</p>\n<p>Rhinophyma may be diagnosed <strong>clinically</strong>, but a <strong>skin biopsy</strong> can confirm the diagnosis.&nbsp;On histology, rhinophyma shows sebaceous gland hypertrophy, hyperplasia and fibrosis.</p>\n<p>The most common indication for treatment is <strong>cosmetic</strong>.&nbsp;Ablation using <strong>CO<sub>2</sub> laser</strong> or <strong>surgical resection</strong> of excess tissue with remodelling of nose can be performed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3fb530a4b95944688a4305513e747905.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not associated with the given skin condition?",
    "choices": [
      {
        "id": 1,
        "text": "Photosensitivity"
      },
      {
        "id": 2,
        "text": "Blepharitis"
      },
      {
        "id": 3,
        "text": "Flushing"
      },
      {
        "id": 4,
        "text": "Comedones"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option A: <strong>Photosensitivity</strong> is a feature of rosacea. It may be <strong>triggered/exacerbated</strong> by exposure to sunlight.</p>\n<p>Option B: <strong>Ocular</strong> rosacea is associated with involvement of eye due to <strong>meibomian gland dysfunction</strong>, which causes gritty sensation in the eye, blepharitis, recurrent chalazion, and conjunctivitis.</p>\n<p>Option C:&nbsp;<strong>Erythemato telangiectatic rosacea</strong> (ETT) is associated with facial vascular changes &ndash; redness (<strong>flushing</strong>) and <strong>telangiectasia</strong> on central cheeks.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/65531a12182344969ce481793c53f3c0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fecaacb2e2d74a9eb35b24538d899d03x1280x1907.JPEG"
    ]
  },
  {
    "text": "Fordyce's spots mainly involves which of the following sites?",
    "choices": [
      {
        "id": 1,
        "text": "Lips"
      },
      {
        "id": 2,
        "text": "Scalp"
      },
      {
        "id": 3,
        "text": "Neck"
      },
      {
        "id": 4,
        "text": "Trunk"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Fordyce spots </strong>occur most commonly on the <strong>u</strong><strong>pper lip &gt;buccal mucosa.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following  is a correct statement regarding the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ectopic sebaceous glands"
      },
      {
        "id": 2,
        "text": "Antibiotics are the first line treatment"
      },
      {
        "id": 3,
        "text": "It is asymptomatic"
      },
      {
        "id": 4,
        "text": "Occur commonly on upper lip"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows<strong> pearly, penile papules.&nbsp;</strong>These are exclusively found in males. They consist of <strong>flesh-coloured, smooth papules</strong> most commonly on the <strong>coronal margin</strong> of the glans penis. They are <strong>benign</strong> and <strong>asymptomatic</strong> and treatment involves<strong> reassuring the patient.&nbsp;</strong></p>\n<p>*Note: Pearly, penile papules are commonly mistaken for Fordyce spots (Tyson's glands). Fordyce spots are commonly seen on the shaft of the penis and are ectopic sebaceous glands. Image below depicts Fordyce spots on the penile shaft:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/52fcf076675a4d16afd45f4a87261fa6.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9511ced3a204eeb9dd12285e8dc7780x674x447.JPEG"
    ]
  },
  {
    "text": "During your rounds in the neonatal ward, you see a 2-week-old neonate with the following skin finding. It is a disorder of which of the following glands?",
    "choices": [
      {
        "id": 1,
        "text": "Sebaceous glands"
      },
      {
        "id": 2,
        "text": "Apocrine glands"
      },
      {
        "id": 3,
        "text": "Holocrine glands"
      },
      {
        "id": 4,
        "text": "Eccrine glands"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows<strong>&nbsp;</strong>clear, thin\u2010walled, superficial <strong>vesicles 1&ndash;2 mm </strong>in diameter,<strong> without</strong> associated<strong> erythema</strong>, resembling drops of water in a&nbsp;<strong>newborn. </strong>It is suggestive of<strong> miliaria,&nbsp;</strong>a&nbsp;disorder of&nbsp;<strong>eccrine sweat glands.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f75d9d15bf924ec1a5d06e85cfd57860.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "At what level does the obstruction occur in miliaria crystallina?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>miliaria crystallina</strong>, the obstruction is at the level of&nbsp;<strong>stratum corneum</strong>.</p>\n<p>The image shows the histological appearance of the <strong>epidermis</strong> of the skin. The structures marked are respectively:</p>\n<ol>\n<li style=\"text-align: left;\">Stratum corneum</li>\n<li style=\"text-align: left;\">Stratum granulosum</li>\n<li style=\"text-align: left;\">Stratum spinosum</li>\n<li style=\"text-align: left;\">Stratum basale&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/162f91291a0c412b8efee6d996e1f252.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a disorder of the apocrine glands?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Disorders of the <strong>a</strong><strong>pocrine glands</strong> are:</p>\n<ul>\n<li><strong>Bromhidrosis - </strong>abnormal sweat odor due to bacterial growth.</li>\n<li><strong>Chromhidrosis</strong>&nbsp;- secretion of vividly colored apocrine sweat (blue, yellow, or green color). It is usually of apocrine origin and seen in the axilla, areola of the nipple, or face.</li>\n<li><strong>Fox-Fordyce disease </strong>or apocrine miliaria- obliteration of the apocrine duct at the infundibulum.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4a5a9cb907a7492db92a069ad015d6d8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0580c061590c4684883ad02752a4d12dx1279x1358.JPEG"
    ]
  },
  {
    "text": "Which is the incorrect statement regarding the condition shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Inframammary area  and intermammary folds may be involved"
      },
      {
        "id": 2,
        "text": "TNF alpha inhibitors can be used in treatment"
      },
      {
        "id": 3,
        "text": "Obesity and smoking are associated with it"
      },
      {
        "id": 4,
        "text": "Surgery cannot be done for this condition."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows <strong>hidradenitis supurativa </strong>or&nbsp;<strong>inverse acne</strong>. Surgical excision is the <strong>best treatment</strong> that offers a cure.</p>\n<p>Hidradenitis suppurativa is a chronic, inflammatory, recurrent, debilitating, follicular disease that usually presents after puberty.</p>\n<p>There are <strong>painful, deep\u2010seated inflamed</strong> lesions in the <strong>apocrine</strong> <strong>gland</strong>\u2010bearing areas of the body, most commonly the<strong> axillary</strong>, inguinal, and anogenital regions.</p>\n<p>This definition is based on the San Francisco modification of the Dessau criteria.</p>\n<p>The following three criteria must be met for the diagnosis to be made:</p>\n<ol>\n<li><strong>Typical lesions - </strong>deep\u2010seated, painful nodules or &lsquo;blind boils&rsquo;; abscesses, <strong>draining sinuses</strong>, <strong>bridged scars,</strong> and paired or multiheaded open pseudocomedones in secondary lesions.</li>\n<li><strong>Typical topography -&nbsp;</strong>axillae, groin, perineal and perianal region, buttocks and infra\u2010 and intermammary folds.</li>\n<li><strong>Chronicity</strong> and<strong> recurrence</strong> of lesions.&nbsp;</li>\n</ol>\n<p>More common in young women of ages 20-29 years.<strong> Obesity</strong> and<strong> smoking</strong> are the two main factors associated with hidradenitis suppurativa.</p>\n<p>Treatment includes:&nbsp;</p>\n<ul>\n<li>Antibiotics - tetracycline, clindamycin</li>\n<li>Intralesional corticosteroids</li>\n<li>Immunosuppressants</li>\n<li>Acitretin</li>\n<li>Anti-TNF alpha therapy</li>\n<li>Surgery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ce86981a809b406e8f7049c5fa03d8f3.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '04 Acne, Rosacea And Others';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>