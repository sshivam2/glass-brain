<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procedures Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is an advantage of the procedure shown in the image over its midline counterpart?",
    "choices": [
      {
        "id": 1,
        "text": "Easy repairability"
      },
      {
        "id": 2,
        "text": "Lesser chance of dyspareunia"
      },
      {
        "id": 3,
        "text": "Lesser chance of anal sphincter involvement"
      },
      {
        "id": 4,
        "text": "Lesser amount of blood Loss"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows&nbsp;<strong>mediolateral episiotomy</strong>. The primary advantage of mediolateral episiotomy over midline episiotomy is that there is a <strong>lesser chance of anal sphincter involvement</strong>&nbsp;due to extension.&nbsp;</p>\n<p>An <strong>episiotomy</strong> is an <strong>intended incision</strong> <strong>of</strong> <strong>the</strong> <strong>perineum</strong> with the goal of enlargement of the vaginal opening for birth. Prior to episiotomy, analgesia is provided by existing labor regional analgesia, <strong>bilateral pudendal nerve block</strong>, or local infiltration with 1% lignocaine. Typically, an episiotomy is <strong>completed</strong> <strong>when</strong> the <strong>head is visible</strong> during a contraction to a diameter of 4 to 5 cm.</p>\n<p>Midline episiotomy begins at the fourchette, incises the perineal body in the midline, and ends well before the external anal sphincter. Mediolateral episiotomy begins at the midline of the fourchette and is <strong>directed to the right or left at an angle of 60 degrees</strong> off the midline. This angle accounts for the stretch distortion of the perineal anatomy during crowning. After delivery and resolution of the distortion, it ultimately yields an incision 45 degrees from the midline for suturing.</p>\n<table style=\"height: 173px; width: 407px;\">\n<tbody>\n<tr style=\"height: 30px;\">\n<td style=\"width: 181px; height: 30px;\"><strong>Midline episiotomy</strong></td>\n<td style=\"width: 210px; height: 30px;\"><strong>Mediolateral episiotomy</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 181px; height: 18px;\">Surgical repair is easy</td>\n<td style=\"width: 210px; height: 18px;\">Surgical repair is <strong>difficult</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 181px; height: 18px;\">Blood loss is less</td>\n<td style=\"width: 210px; height: 18px;\">Blood loss is<strong> more</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 181px; height: 18px;\">Healing is superior</td>\n<td style=\"width: 210px; height: 18px;\">Healing is not so good</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 181px; height: 36px;\">Dyspareunia is rare</td>\n<td style=\"width: 210px; height: 36px;\">Dyspareunia is comparatively <strong>more</strong></td>\n</tr>\n<tr style=\"height: 57.375px;\">\n<td style=\"width: 181px; height: 57.375px;\">\n<p class=\"p1\">Postoperative pain is less</p>\n</td>\n<td style=\"width: 210px; height: 57.375px;\">\n<p class=\"p1\">Postoperative pain is <strong>more</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 181px; height: 64px;\">\n<p class=\"p1\">Extension, if occurs, may involve the anal sphincter</p>\n</td>\n<td style=\"width: 210px; height: 64px;\">\n<p class=\"p1\">Extension, even if it occurs, will <strong>not involve the anal sphincter</strong></p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a737297b54d34cbcb0fe000cbb782a3a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Arrange the following steps of nasogastric tube insertion in the correct order.",
    "choices": [
      {
        "id": 1,
        "text": "3 \u2192 2 \u2192 4 \u2192 1 \u2192 5"
      },
      {
        "id": 2,
        "text": "4 \u2192 3 \u2192 2 \u2192 1 \u2192 5"
      },
      {
        "id": 3,
        "text": "4 \u2192 3 \u2192 2 \u2192 5 \u2192 1"
      },
      {
        "id": 4,
        "text": "3 \u2192 2 \u2192 4 \u2192 5 \u2192 1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct order of steps in the process of insertion of a nasogastric (NG) tube is:</p>\n<ol>\n<li>Lubricate the first 2 to 3 inches of the tube with lignocaine jelly lubricant.</li>\n<li><strong>Have the patient flex the neck forward</strong>, bringing his/her chin towards the chest.</li>\n<li><strong>Slowly and gently begin inserting the tube</strong> into the nostril straight back at a 90-degree angle to the long axis of the head.</li>\n<li><strong>Have the patient begin taking small sips of water</strong> through a straw and swallow as you gently advance the tube. Timing the advancement of the tube in conjunction with the patient swallowing greatly facilitates the passage of the NG tube into the stomach.&nbsp;</li>\n<li>Check the position of the tube by:\n<ul>\n<li><strong>Injecting 10 mL air through the tube</strong> and listening to the left upper quadrant for a rush of the air.</li>\n<li>Obtaining radiographs: radiography is the gold standard for determining the correct placement of NG tubes.</li>\n</ul>\n</li>\n<li><strong>Tape the tube in place</strong>.&nbsp;</li>\n</ol>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Indications</strong>&nbsp;for NG tube include:</p>\n<ul>\n<li><strong>Gastrointestinal lavage</strong> or aspiration in patients with suspected or known overdose</li>\n<li><strong>Gastric decompression</strong> in cases of <strong>gastric outlet obstruction</strong>,&nbsp;<strong>intestinal obstruction </strong>and<strong>&nbsp;</strong><strong>paralytic ileus.</strong></li>\n<li><strong>Zollinger-Ellison syndrome</strong> is characterized by hypersecretion of gastrin resulting in acid-induced diarrhoea that is controlled by&nbsp;nasogastric aspiration of gastric secretions</li>\n<li><strong>Nutritional support</strong> and administration of medications via GI route</li>\n</ul>\n<p><strong>Contraindications</strong>&nbsp;for NG tube include:</p>\n<ul>\n<li>Significant facial trauma or <strong>basilar skull fracture</strong></li>\n<li>Esophageal burns or <strong>caustic ingestion</strong></li>\n<li>Recent surgery on esophagus or stomach</li>\n<li>Esophageal <strong>stricture</strong> or atresia</li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the procedure shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Peribulbar block"
      },
      {
        "id": 2,
        "text": "Sac syringing"
      },
      {
        "id": 3,
        "text": "Retrobulbar block"
      },
      {
        "id": 4,
        "text": "Intravitreal steroid injection"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The procedure shown in the given image is <strong>lacrimal sac syringing</strong> or <strong>irrigation</strong>. It is done to check the patency of the lacrimal drainage system.&nbsp;</p>\n<p>Lacrimal sac syringing should be performed only after ascertaining <strong>punctal patency</strong>. If there is severe stenosis, surgical enlargement of the punctum may be required before canalicular and naso-lacrimal duct patency can be confirmed. This procedure is <strong>contraindicated</strong> <strong>in the presence of an acute infection</strong>.&nbsp;</p>\n<p>The procedure begins with the instillation of local anesthetic in the conjunctival sac.&nbsp;A punctum dilator is used to enlarge the punctal orifice. A <strong>lacrimal cannula</strong> on a saline-filled syringe is inserted into the lower punctum and, whilst keeping a gentle stretch laterally on the eyelid, advanced a few millimeters, following the contour of the canaliculus. <strong>A hard stop occurs if the cannula enters the lacrimal sac</strong>, coming to a stop at the medial wall of the sac. The rigid lacrimal bone can be felt through the medial wall. This <strong>excludes</strong> complete <strong>obstruction</strong> <strong>of </strong>the<strong> canalicular system</strong>. Gentle saline irrigation is then tried. If <strong>saline</strong> <strong>passes</strong> <strong>into</strong> the nose and <strong>throat</strong>, it will be <strong>tasted</strong> <strong>by</strong> the <strong>patient</strong>. This indicates the presence of a <strong>patent lacrimal system</strong>. A patient can still have watering of the eye due to subtle lacrimal pump failure or stenosis. Failure of saline to reach the throat is indicative of total obstruction of the nasolacrimal duct. In this situation, the lacrimal sac will distend slightly during irrigation and there will be reflux of the saline through the opposite punctum.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6c7ad9aafcfb45bcabe1fc61a2f19015.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/90071ab0dc5f45889679932fa531071cx1280x891.JPEG"
    ]
  },
  {
    "text": "A senior resident working in an intensive care unit has assembled the following equipment to perform a procedure. Which of the following procedures he would be performing?",
    "choices": [
      {
        "id": 1,
        "text": "Radial artery catheterization"
      },
      {
        "id": 2,
        "text": "Central venous catheterization"
      },
      {
        "id": 3,
        "text": "Catheterization for peritoneal dialysis"
      },
      {
        "id": 4,
        "text": "Pigtail catheter insertion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>From the materials which have been gathered by the senior resident, it can be inferred that he would be performing a <strong>central venous catheterization.</strong></p>\n<p>The image below shows the equipment for performing a central venous catheterization.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/beabb70f27dc4d29b104550f6ced89a1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/997e60e0dbb2446283b09e14e5e79635x1280x909.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a36b6e9056e45c3b06c0555dc3de570x750x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2e8811dbf95c4d99af9478748eb1656bx1280x1134.JPEG"
    ]
  },
  {
    "text": "Identify the injection technique in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Subcutaneous"
      },
      {
        "id": 2,
        "text": "Intradermal"
      },
      {
        "id": 3,
        "text": "Intramuscular"
      },
      {
        "id": 4,
        "text": "Intravenous"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The technique shown in the given image is <strong>intradermal injection</strong>.</p>\n<p>An intradermal injection is usually given on the <strong>ventral</strong> part of the <strong>forearm,</strong> around 10 cm from the antecubital crease. The preparation of the site is done with an alcohol pad, beginning at the center and moving outward in a circular motion. Then the patient's forearm is held and the skin gently stretched with the thumb. The needle is inserted, bevel up, at a <strong>15-degree angle</strong> into the <strong>upper layers of the skin</strong>. On injecting, a small <strong>wheal</strong> or <strong>bleb</strong> will form. This signals <strong>proper intradermal</strong> placement. The needle should be withdrawn at the same 15-degree angle. The wheal or bleb will disappear gradually and should not be rubbed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e32f2f0a673c48539994f01b8db9ca10.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f3cd004ad89c4ab9a794dcb5f68479cfx399x431.PNG"
    ]
  },
  {
    "text": "A primigravida presents to the labor room with adequate uterine contractions. The presenting part of the baby is two buttocks and the external genitalia as shown in the image below. Which of the following maneuver is used to deliver the extended legs of this baby?",
    "choices": [
      {
        "id": 1,
        "text": "Ritgen"
      },
      {
        "id": 2,
        "text": "Lovset"
      },
      {
        "id": 3,
        "text": "Pinard"
      },
      {
        "id": 4,
        "text": "Burns Marshall"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the image in which the presenting&nbsp;part is two buttocks and external genitalia are suggestive of a<strong> frank breech</strong> presentation. <strong>Pinard maneuver&nbsp;</strong>is used to <strong>deliver the extended legs</strong> in this presentation.</p>\n<p>In&nbsp;<strong>frank breech</strong>&nbsp;presentation,&nbsp;<strong>thighs&nbsp;</strong>are<strong>&nbsp;flexed&nbsp;</strong>on the<strong>&nbsp;</strong>trunk,&nbsp;and<strong>&nbsp;legs&nbsp;</strong>are<strong>&nbsp;extended&nbsp;</strong>at the<strong>&nbsp;knees.&nbsp;</strong>The presenting&nbsp;part would be<strong> two buttocks</strong> and<strong> external genitalia. </strong>This maneuver will&nbsp;facilitate delivery of the legs, only after the fetal umbilicus has been reached.</p>\n<p>The patient should be under <strong>general</strong> <strong>anesthesia</strong>. The <strong>palmar</strong> <strong>surface</strong> of the obstetrician is to be introduced facing the ventral surface of the fetus. The breech is pushed up at least to the level of the symphysis pubis.&nbsp;</p>\n<p><strong>Middle</strong> and <strong>index</strong> <strong>fingers</strong> should <strong>apply pressure</strong> in the <strong>popliteal fossa</strong> and cause partial leg flexion. The head is flexed by the other hand abdominally i.e. externally. The foot is brought down by grasping at the ankle with internal fingers. The other leg is brought down in the same manner.</p>\n<p>The image below shows&nbsp;<strong>Pinard&rsquo;s maneuver:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d57d77ff35dd45e692b53b78e0b3229b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd3397a28e034dada0a87d2f3c58c82ax1280x4970.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5747b9a3ac4f4bb2896054ea1961600fx1280x2032.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e25e387952946449d285aa5b323bd12x1280x1395.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/130a6e2eb9354615b79cfa756078433dx720x1563.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/134584385a274d89ae8eb5a8326b428cx417x1600.JPEG"
    ]
  },
  {
    "text": "A 32-year-old fisherman presented to the clinic with complaints of pain and swelling over the left middle finger for 2 days as shown in the image given below. Tenderness is elicited over the affected nail on examination. Which of the following statements is incorrect about the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Incision is made on the hyponychium"
      },
      {
        "id": 2,
        "text": "Nail removal may be required"
      },
      {
        "id": 3,
        "text": "Best treated with incision, drainage and appropriate antibiotics"
      },
      {
        "id": 4,
        "text": "Digital block is given using lignocaine without adrenaline"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 1\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The above clinical scenario with the image showing <strong>erythema</strong> and <strong>swelling</strong> around the<strong> nail folds</strong> is suggestive of <strong>acute paronychia</strong> with <strong>abscess formation</strong>.&nbsp;<strong>Incision and drainage</strong> needs to be done in this case, and the incision is made on the <strong>eponychium</strong>.&nbsp;</p>\n<p>Acute paronychia refers to the infection of the nail bed. It often occurs following minor <strong>trauma</strong> and is caused by <strong><em>Staphylococcus aureus</em></strong>. It presents as a painful red swelling of the area lateral to the nail. After the initial inflammation, pus accumulates beside and sometimes under the nail.&nbsp;A <strong>digital pressure test</strong> is used to assess if an abscess is present or not. <strong>Pressure</strong> is applied&nbsp;<strong>to</strong> <strong>the</strong> <strong>volar aspect</strong> of the involved digit. A larger than expected <strong>area of blanching</strong> <strong>will be visible</strong> at the paronychia if an <strong>abscess is present</strong> and drainage will be needed.&nbsp;</p>\n<p>Acute paronychia is best treated with<strong> incision, drainage</strong> and <strong>appropriate antibiotic</strong> therapy. Incision and drainage is usually done by giving a digital block using <strong>lignocaine without adrenaline</strong>, since digits have an end arterial supply. Occasionally, <strong>nail removal</strong> may also be done to allow full drainage of the pus collection.</p>\n<p>Parts of the nail are shown in the image below:</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/38e3ffb6ed9547ce9a6cdeadb3232a8c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96abfee8aba44962838bedab8bd0fc73x1206x364.JPEG"
    ]
  },
  {
    "text": "Which of the following is the site of placement of the V2 chest lead while recording an ECG?",
    "choices": [
      {
        "id": 1,
        "text": "In the fourth intercostal space just to the left of the sternum"
      },
      {
        "id": 2,
        "text": "In the fifth intercostal space just to the left of the sternum"
      },
      {
        "id": 3,
        "text": "At the anterior axillary line in the fifth intercostal space"
      },
      {
        "id": 4,
        "text": "At the midclavicular line in the fifth intercostal space"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 525\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 523\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>While recording an ECG,\u00a0the <strong>V2</strong> chest lead is placed at the <strong>4th intercostal space</strong>, to the<strong> left of the sternum\u00a0</strong></p>\n<p>The site of placement of the chest leads is as follows:</p>\n<p>V1: 4th intercostal space, right of the sternum\u00a0<br />V2: 4th intercostal space, left of the sternum\u00a0<br />V3: 5th intercostal space, left of the sternum (Option B)<br />V4:\u00a05th intercostal space, centered on clavicle(Option D)<br />V5:\u00a05th intercostal space, left of V4<br />V6:\u00a05th intercostal space, under the left arm</p>\n<p>An ECG can be recorded by using an active electrode that is connected to an electrode at zero potential (<strong>unipolar recording</strong>) or by using two active electrodes (<strong>bipolar recording</strong>).</p>\n<div class=\"page\" title=\"Page 525\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>For unipolar recording, six chest leads or precordial leads (V1\u2013V6) and three limb leads (VR-right arm, VL-left arm, and VF-left foot) are used. Because the heart surfaces are close to the chest wall, the chest lead mainly records the electrical potential of the cardiac musculature immediately beneath it. Therefore, relatively minute abnormalities in the heart muscles can cause marked changes in the ECGs recorded from individual chest leads.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bebb55396029440681ac8d4070a44a44x824x598.PNG"
    ]
  },
  {
    "text": "A patient presents with breathlessness and low-grade fever for the last 2 weeks. Her chest radiograph is given below. Choose the correct statement regarding the management of this patient.",
    "choices": [
      {
        "id": 1,
        "text": "2 litres of fluid may be withdrawn in one go"
      },
      {
        "id": 2,
        "text": "Usual approach is from the anterior aspect"
      },
      {
        "id": 3,
        "text": "Entry site for the needle should be on the inferior aspect of the rib"
      },
      {
        "id": 4,
        "text": "ADA measurement in the sample is indicated"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and the X-ray are suggestive of <strong>pleural effusion</strong>, most likely due to <strong>tuberculosis</strong>. The next step for this patient will be to perform a <strong>thoracocentesis</strong> and send the sample for analysis. For tuberculosis, <strong>adenosine deaminase (ADA)</strong> analysis of the pleural fluid is recommended.&nbsp;</p>\n<p>In any patient diagnosed with a pleural effusion, an effort should be made to find the cause. This requires a diagnostic thoracocentesis and analysis of the pleural fluid in terms of whether it is a <strong>transudate</strong> or an <strong>exudate</strong> based on <strong>Light's criteria</strong>:</p>\n<ol>\n<li>Pleural fluid protein/serum protein &gt;0.5</li>\n<li>Pleural fluid LDH/serum LDH &gt;0.6</li>\n<li>Pleural fluid LDH more than two-thirds the upper limit of normal for serum</li>\n</ol>\n<p>If the pleural fluid meets one of these criteria, it is considered exudative pleural effusion. Sometimes, special investigations like <strong>ADA</strong> and <strong>cytology</strong> might be required to rule out <strong>tuberculosis</strong> and <strong>malignancy</strong> respectively.</p>\n<p>For thoracocentesis, a <strong>posterior approach&nbsp;</strong>(option B) is preferred. The patient should sit on the edge of the bed, leaning forward with the arms abducted onto a pillow on a bedside stand. The patient might have severe dyspnea, so it is important to assess whether they can maintain this position for 10 minutes before performing the procedure. The <strong>entry site</strong> for the thoracocentesis is at the <strong>superior aspect of the rib</strong> (option C). This <strong>prevents</strong> any <strong>injury</strong> <strong>to</strong> the <strong>intercostal nerve and vessels</strong>.&nbsp;</p>\n<p>While maintaining gentle negative pressure, the needle should be slowly advanced into the pleural space. If a diagnostic tap is being performed, 30-50 mL of fluid will be adequate. If a therapeutic thoracocentesis is being performed, a <strong>maximum of 1 liter of pleural fluid</strong> should be withdrawn at a given time (option A). <strong>Withdrawal</strong> of quantities <strong>more</strong> <strong>than</strong> <strong>this</strong> can cause <strong>re-expansion pulmonary edema</strong>.&nbsp;A chest radiograph should be obtained post-procedure to evaluate for a pneumothorax. The patient should be instructed to inform the doctors if new shortness of breath develops.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d58aa0f67d1b49e1b6d9da7000ed9e28.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding the procedure performed with the given instrument?",
    "choices": [
      {
        "id": 1,
        "text": "Used during injection sclerotherapy for hemorrhoids"
      },
      {
        "id": 2,
        "text": "Can be done without prior digital rectal examination"
      },
      {
        "id": 3,
        "text": "Can be done in a patient with acute anal fissure"
      },
      {
        "id": 4,
        "text": "Lower part of sigmoid colon can be visualised"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a <strong>proctoscope</strong>, used for performing <strong>proctoscopy</strong>. One of the therapeutic indications of proctoscopy is performing <strong>injection sclerotherapy</strong> of hemorrhoids.</p>\n<p>Proctoscopy can be used to inspect the <strong>anus</strong>, <strong>anorectal</strong> <strong>junction</strong> and the <strong>lower part of the rectum&nbsp;</strong>(option D). Most commonly the patient is examined in the <strong>left lateral (Sims) position</strong> with the buttocks overlying the edge of the examination couch. Alternatively in younger patients, prone jack-knife or knee-elbow positions may be used. A <strong>digital rectal examination is mandatory</strong> before performing a proctoscopy (option B). Minor procedures such as <strong>injection sclerotherapy</strong> or <strong>banding</strong> of hemorrhoids and <strong>biopsy</strong> of suspected neoplasms can also be carried out in conjunction with proctoscopy (option A). <strong>Acute anal fissure</strong> is a <strong>contraindication</strong> for doing proctoscopy (option C) because it is extremely painful for the patient.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/20f239d886e44864a9ddb9fb7cbb1385.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following techniques would you not follow while performing direct laryngoscopy?",
    "choices": [
      {
        "id": 1,
        "text": "The force for lifting the blade is achieved by radial flexion of wrist."
      },
      {
        "id": 2,
        "text": "The blade is inserted into right side of the mouth."
      },
      {
        "id": 3,
        "text": "The laryngoscope is lifted at a 45-degree angle"
      },
      {
        "id": 4,
        "text": "The procedure is performed in sniffing position."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>While performing&nbsp;direct laryngoscopy, the force for <strong>lifting</strong> the blade is achieved by the <strong>anterior deltoid</strong> and <strong>triceps</strong>, not by radial flexion of the wrist.</p>\n<div class=\"page\" title=\"Page 1647\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Direct laryngoscopy is the technique used for <strong>tracheal intubation</strong> which involves direct visualization of the glottis with the assistance of a <strong>laryngoscope</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 1647\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The procedure is performed in the <strong>sniffing position</strong>. It involves approximately <strong>35 degrees</strong> of <strong>cervical flexion</strong>. During the procedure, the<strong> blade</strong> is inserted on the <strong>right side</strong> of the mouth, and the flange is used to sweep the tongue to the left. (Option B). The&nbsp;base of the tongue is approached and the blade is lifted&nbsp;forward at a <strong>45-degree angle</strong>(Option C).</p>\n<p>Once a complete view of the <strong>glottis</strong> is achieved, the <strong>endotracheal tube</strong> is grasped with the right hand and guided through the vocal cords into the trachea. <strong>Damage</strong>&nbsp;to <strong>upper incisors</strong> can occur when the <strong>tip</strong> of the blade should is <strong>lifted by</strong> using the <strong>laryngoscope</strong> as a lever.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1649\">The procedure is performed by using a laryngoscope. It is an instrument used for the examination of the larynx and the facilitation of tracheal intubation. It has three components: the handle, the blade, and the light source. The Macintosh and Miller blades are the most popularly used blades.</div>\n<p><strong>Miller's </strong>blade&nbsp;is a&nbsp;<strong>straight blade </strong>that&nbsp;is inserted using the para-glossal technique. This technique avoids contact with the maxillary incisors and provides&nbsp;maximal tongue control.</p>\n<p>It is used in:</p>\n<ul>\n<li>Neonates, infants, and young children</li>\n<li>Adults with short thyromental distance and long floppy epiglottis.</li>\n</ul>\n<div class=\"page\" title=\"Page 552\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>A <strong>Macintosh</strong> blade is a sharply <strong>curved</strong> blade with a large flange. The advantages of a curved blade include:</p>\n</div>\n</div>\n</div>\n<ul>\n<li>Greater room available for the passage of an endotracheal tube</li>\n<li>Less damage to the teeth</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/94f7e038c4754c97b5e546a52508b556x1024x700.jpeg"
    ]
  },
  {
    "text": "You are doing urinary bladder catheterization for a patient. Till what point will you insert the Foley catheter before inflating the bulb?",
    "choices": [
      {
        "id": 1,
        "text": "Point A"
      },
      {
        "id": 2,
        "text": "Point B"
      },
      {
        "id": 3,
        "text": "Point C"
      },
      {
        "id": 4,
        "text": "Bulb should be inflated as soon as urine begins to flow"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The bulb of the Foley catheter should be inflated once the catheter has been <strong>inserted almost to the hub</strong>. This ensures that the balloon is not inflated in the prostate, bladder neck, or urethra. The <strong>flow of urine</strong> alone may <strong>not</strong> be <strong>the</strong> <strong>surest sign</strong> that the tip of the Foley has reached the urinary bladder, since it can appear even at the level of the bladder neck.</p>\n<p>Once the balloon is inflated, pull the Foley catheter out gently until it stops. The Foley catheter is now in the proper position. Make sure the drainage bag is properly attached and tape the Foley catheter to the abdomen. <strong>Bacitracin ointment</strong> is applied to the urethral meatus one to three times per day to prevent irritation from the catheter and urinary tract infection. <strong>If the patient is uncircumcised, the foreskin will need to be placed back</strong> into its original position.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e092adaab8894f0d8af6f168d4fa6f0d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are a newly posted intern in the department of surgery. During your routine ward rounds, you notice a patient with an ulcer being treated with the following therapy. Which of the following statements are true regarding this modality of treatment?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 5"
      },
      {
        "id": 2,
        "text": "2, 3, 5"
      },
      {
        "id": 3,
        "text": "1, 4, 5"
      },
      {
        "id": 4,
        "text": "2, 3, 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image above shows the <strong>vacuum-assisted closure </strong>of an <strong>ulcer.\u00a0</strong>The true statements regarding VAC are <strong>2, 3, </strong>and <strong>5.</strong></p>\n<p><strong>VAC therapy\u00a0</strong>is also called <strong>negative pressure wound closure</strong>.\u00a0It creates an\u00a0<strong>intermittent\u00a0</strong>(not continuous)\u00a0<strong>negative pressure of -125 mm Hg </strong>to promote the formation\u00a0<strong>of healthy granulation tissue</strong>.</p>\n<p>It is made up of foam with a <strong>perforated</strong> wound drain covered and plastered with\u00a0<strong>transparent\u00a0</strong>plastic/ adhesive film. It is commonly used in the management of\u00a0<strong>pressure bed sores\u00a0</strong>and\u00a0<strong>diabetic ulcers.\u00a0</strong>It creates a suitable niche and bed for <strong>harvesting flaps</strong>. <strong>Everyday redressing </strong>of the wound is <strong>not required </strong>with this therapy.\u00a0</p>\n<p>It acts by:</p>\n<ul>\n<li><strong>Reducing</strong> tissue <strong>edema</strong></li>\n<li>Clearing interstitial fluid</li>\n<li><strong>Improves perfusion</strong> and increases the healing process</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a03d7c6b5da74c80944640bf368f06fa.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the correct statement about the procedure shown in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "L1-L2 interspace is used for the procedure"
      },
      {
        "id": 2,
        "text": "Extension of the back is required for the procedure"
      },
      {
        "id": 3,
        "text": "Measurement of opening pressure can only be done in lateral recumbent position"
      },
      {
        "id": 4,
        "text": "Recumbent position following the procedure reduces the incidence of headache"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The procedure shown in the given image is <strong>lumbar puncture&nbsp;</strong>(LP). For measuring the opening pressure during lumbar puncture, the procedure must be performed in <strong>lateral recumbent position</strong>.&nbsp;&nbsp;</p>\n<div class=\"page\" title=\"Page 47\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Cerebrospinal fluid (CSF) examination is an important step for the diagnosis of <strong>meningitis</strong>, <strong>subarachnoid hemorrhage</strong> and leptomeningeal neoplastic disease. Lumbar puncture is also used to diagnose <strong>Guillian-Barr&eacute; syndrome</strong> (albumino-cytological dissociation) and to r<strong>elieve the intraventricular pressure in hydrocephalus</strong> while the patient is waiting for a more definitive procedure. Relative <strong>contraindications</strong> to LP include <strong>local skin infection</strong> in the lumbar area and <strong>suspected intracranial</strong> or spinal cord mass lesion. Any bleeding diathesis should also be corrected prior to performing LP to <strong>prevent</strong> the possible occurrence of an <strong>epidural hematoma</strong>.</p>\n<p>Either the <strong>lateral decubitus</strong> or <strong>sitting position</strong> can be used for an LP. However, <strong>measurement of opening CSF pressure</strong> can <strong>only</strong> be done <strong>in</strong> <strong>lateral decubitus</strong>. In either position, the patient should be instructed to <strong>flex the spine</strong>&nbsp;(option B) as much as possible. The entry site for an LP is below the level of conus medullaris, which extends to L1-L2 in most adults. Thus, either the L3-L4 or L4-L5 interspace is used as the entry site (option A). If bone is encountered during entry, the needle should be withdrawn to just below the skin and redirected more caudally.</p>\n<p>The most common <strong>complication</strong> of lumbar puncture is <strong>post-dural puncture headache</strong>. It is a bilateral throbbing headache that increases in upright position, coughing and straining. The factors which have been shown to reduce the incidence of post-dural puncture headache are:</p>\n<ul>\n<li>Use of <strong>atraumatic needle</strong></li>\n<li>Replacement of stylet prior to removal of needle</li>\n<li>Performing LP in lateral decubitus position</li>\n<li>Insertion of needle with <strong>bevel parallel to the longitudinal dural fibers</strong></li>\n</ul>\n<p><strong>Bed rest</strong> following LP and minimizing the volume of the spinal fluid removed have <strong>not</strong> <strong>shown</strong> <strong>to reduce</strong> the incidence of <strong>post-dural puncture headache</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c7bb397e186846abb2df4f0095c76ebb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is incorrect about the procedure shown in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Patient should be asked to sit upright after the procedure"
      },
      {
        "id": 2,
        "text": "Z-track technique is used"
      },
      {
        "id": 3,
        "text": "Post-procedure IV albumin has been shown to be beneficial"
      },
      {
        "id": 4,
        "text": "Lower abdominal quadrants are preferred for the procedure"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The procedure shown in the given image is <strong>paracentesis</strong>. Following paracentesis, the patient should be asked to lie in the <strong>supine position</strong> <strong>for a few hours</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 50\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Paracentesis</strong>, which refers to the <strong>removal of ascitic fluid</strong>, is valuable for evaluating patients with new-onset ascites or ascites of unknown etiology. It is also indicated in patients who have a decompensation in their clinical status. Relative <strong>contraindications</strong> include <strong>bleeding diathesis</strong>, prior abdominal surgery, distended bowels, or <strong>loculated ascites</strong>. Any severe bleeding diathesis should be corrected before the procedure. Bowel distention should be relieved by placement of an NG tube, and the bladder should also be emptied before beginning the procedure.</p>\n<p>During the procedure, the patient should be instructed to <strong>lie</strong> <strong>supine</strong> with the <strong>head end</strong> of the bed <strong>elevated</strong>. This position should be maintained for around 15 minutes so that the fluid accumulates in the dependent portion of the abdomen. The <strong>preferred</strong> <strong>entry</strong> <strong>sites</strong> for paracentesis include r<strong>ight or left lower quadrants</strong> of the abdomen or even a <strong>midline puncture</strong> halfway between pubic symphysis and umbilicus. To prevent leaking of the ascitic fluid,<strong> Z-tracking of the needle</strong> is helpful. The needle is advanced slowly while performing continuous aspiration. Fluid should flow freely into the syringe soon after that. For large volume paracentesis, direct drainage into large vacuum containers is commonly utilized.&nbsp;</p>\n<p>Peritoneal fluid is sent for <strong>total and differential cell count</strong>, <strong>Gram stain</strong> and <strong>bacterial cultures</strong>. Patient should be monitored following the procedure and should be asked to <strong>lie supine</strong> for a few hours. If persistent fluid leakage occurs, continued bedrest and pressure dressings are useful. For patients with decompensated liver disease undergoing large-volume paracentesis, the sudden reduction in intravascular volume can precipitate <strong>hepatorenal syndrome</strong>. Use of <strong>IV albumin</strong> in such a scenario has been shown to decrease the incidence of postprocedure renal failure.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8fa31eaee73c4467892e0230f0680c0f.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d917dc84de64fbc8adf8df1b659a066x600x735.JPEG"
    ]
  },
  {
    "text": "An old lady slipped and fell and sustained a fracture of the upper limb. The procedure shown in the image below was used to reduce her fracture. The most likely fracture she had sustained was:",
    "choices": [
      {
        "id": 1,
        "text": "Extra-articular fracture of distal ulna"
      },
      {
        "id": 2,
        "text": "Extra-articular fracture of distal radius"
      },
      {
        "id": 3,
        "text": "Intra-articular fracture of distal ulna"
      },
      {
        "id": 4,
        "text": "Intra-articular fracture of distal radius"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>traction, palmar flexion, </strong>and <strong>ulnar deviation</strong>. These steps are used in the reduction of <strong>Colle's fracture </strong>which is an&nbsp;<strong>extra-articular fracture </strong>of the <strong>distal radius</strong>.&nbsp;</p>\n<p>Colles' fracture occurs at the&nbsp;<strong>distal end of the radius</strong>, at the cortico-cancellous junction. The&nbsp;<strong>distal fragment</strong>&nbsp;shows&nbsp;<strong>dorsal displacement, dorsal tilt</strong>, lateral displacement and lateral tilt. This fracture is particularly common in&nbsp;<strong>post-menopausal women</strong>&nbsp;because of&nbsp;<strong>osteoporosis</strong>. The patient presents with pain and swelling of the wrist. On examination, there is classic&nbsp;<strong>dinner fork deformity</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ca1a667e17d84a0eac6ece5814353158.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5cbda187062e4aefa4c383e00ff0c302x1279x963.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cc4b850bdd4947caab9a1fc85954b107x1280x2558.JPEG"
    ]
  },
  {
    "text": "A 4-year-old child is brought to the ENT OPD with a history of pain and discharge from the right ear after accidentally inserting a button battery in that ear. Which of the following is contraindicated in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Use of alligator forceps to retrieve the button battery"
      },
      {
        "id": 2,
        "text": "Irrigation of the external auditory canal with water at 37\u00b0C"
      },
      {
        "id": 3,
        "text": "X-ray of the bilateral mastoid region"
      },
      {
        "id": 4,
        "text": "Backward traction on the pinna to better visualise the foreign body"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In this patient with a history of inserting a <strong>button battery in the ear</strong>, <strong>irrigation</strong> of the external auditory canal is <strong>contraindicated.</strong>&nbsp;</p>\n<p>The <strong>contraindications</strong> <strong>to irrigation</strong> of the external auditory canal include:</p>\n<ul>\n<li>Suspected <strong>perforation</strong> of the tympanic membrane</li>\n<li>Presence of a <strong>button battery</strong> in the ear</li>\n<li><strong>Unilateral deafness</strong> (when the side being irrigated is the only hearing ear)</li>\n<li>Sudden onset <strong>pain</strong> <strong>or dizziness</strong> during the procedure (suggests perforation or other trauma)</li>\n<li>History of <strong>prior surgery</strong> on the ear or tympanic membrane</li>\n</ul>\n<p>Before the removal of a foreign body from the ear, the patient should be made to sit in a comfortable and <strong>upright position</strong>. Although it is best to not be working against gravity, some children better tolerate the procedure in a supine position. <strong>Children may also require gentle restraint</strong> on a parent's or assistant's lap. Advise the patient to remain as still as possible and to report any pain or dizziness.&nbsp;</p>\n<p>For removal of foreign bodies from the ear, <strong>alligator forceps</strong> (alternatively, straight or mosquito forceps)&nbsp;are required in addition to items like an <strong>otoscope</strong>, clean water, classic metal <strong>ear syringe</strong> or disposable plastic syringe, and <strong>cerumen spoon</strong> and loop. Pre-treatment with water or saline at body temperature will make the removal of the foreign body easier since it will dissolve the cerumen. However, water should not be used if the foreign body is a button battery.&nbsp;</p>\n<p>The <strong>auditory cana</strong>l is <strong>straightened</strong> with gentle <strong>upward and outward traction</strong>. In children, the traction is given directly backward or even downward. <strong>Adequate</strong> <strong>visualization</strong> using the otoscope is <strong>mandatory</strong> and no instrument should be inserted blindly into the auditory canal. After successful foreign body removal, carefully examine the external auditory canal to make sure the entire object has been removed. Any <strong>inflammation</strong> or <strong>epithelial disruption</strong> on examination warrants the use of <strong>antibiotic drops</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following procedure can be safely performed in which of the following patients?",
    "choices": [
      {
        "id": 1,
        "text": "Primigravida woman at 37 weeks of gestation"
      },
      {
        "id": 2,
        "text": "Primigravida woman with  amniotic fluid index (AFI) of 4 cm"
      },
      {
        "id": 3,
        "text": "Primigravida woman with premature rupture of membranes (PROM)"
      },
      {
        "id": 4,
        "text": "Primigravida woman with twin pregnancy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The procedure shown above is&nbsp;<strong>external cephalic version</strong>. It&nbsp;can be safely performed in a pregnant woman <strong>at 37 weeks</strong> of gestation.</p>\n<p><strong>External cephalic version (ECV)</strong> is done in non-cephalic presentations like<strong> breech</strong> and <strong>transverse lie</strong>, to bring the favorable cephalic pole to the lower pole of the uterus. The ideal time to do the&nbsp;<strong>external cephalic version</strong>&nbsp;is&nbsp;<strong>37 </strong>weeks.&nbsp;<strong>Before 37</strong>&nbsp;weeks, a non-cephalic presentation has a high likelihood of&nbsp;<strong>correcting spontaneously </strong>and, if performed too early, attempts at version may cause a need for immediate delivery.&nbsp;<strong>After 37</strong>&nbsp;weeks, the&nbsp;<strong>success rates</strong>&nbsp;of ECV are&nbsp;<strong>very low</strong>. Although it can be&nbsp;performed until the early stages of labor, it is not recommended.</p>\n<p><strong>Prerequisites</strong> for ECV include:</p>\n<ul>\n<li>Gestational age of<strong> 37 weeks</strong></li>\n<li><strong>Liquor</strong> should be <strong>adequate&nbsp;</strong>(Normal <strong>AFI</strong> of&nbsp;<strong>5&ndash;25 cm</strong>)&nbsp;(Option B)</li>\n<li>The <strong>membranes</strong> should be <strong>intact&nbsp;</strong>(Option C)</li>\n<li>No contraindications for vaginal delivery</li>\n<li><strong>Single fetal</strong> pregnancy&nbsp;(Option D)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a8e928bd371f4eaaa9ecf3e04de79e47.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is used to inflate the bulb of the instrument given in the following image?",
    "choices": [
      {
        "id": 1,
        "text": "0.9% NaCl solution"
      },
      {
        "id": 2,
        "text": "Hypertonic saline"
      },
      {
        "id": 3,
        "text": "Air"
      },
      {
        "id": 4,
        "text": "Sterile water"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows a three-way irrigation Foley catheter. The balloon in the Foley catheter is inflated using <strong>sterile water</strong>. Use of <strong>saline is discouraged</strong> because there is a possibility of <strong>crystallization</strong> of NaCl along the balloon's lumen. If this occurs, the balloon might not deflate when the catheter is to be removed.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5ac1cf1df2bb47b4ad0a222f663fe8df.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old lady visits the Gynecology clinic for a routine check-up, during which her physician schedules a screening test for cervical cancer. Identify the correct statement about the test.",
    "choices": [
      {
        "id": 1,
        "text": "1 and 5"
      },
      {
        "id": 2,
        "text": "1, 3 and 5"
      },
      {
        "id": 3,
        "text": "2, 4, and 5"
      },
      {
        "id": 4,
        "text": "3 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Statements <strong>1 and 5 are correct&nbsp;</strong>regarding the&nbsp;screening test for cervical cancer -the <strong>Pap/&nbsp;Papanicolaou test.</strong></p>\n<p>Before the Pap test:</p>\n<ul>\n<li>The Pap test should&nbsp;not be deferred due to unexplained discharge or unscheduled bleeding as they may be signs of cervical or other genital tract cancers.</li>\n<li>Ideally scheduled to avoid menstruation. It is best performed around the time of ovulation.</li>\n<li>Patients should abstain from vaginal intercourse, douching, tampon use, and intravaginal medications for a minimum of <strong>24 to 48 hours prior</strong> to the test.</li>\n<li>Avoid touching the cervix before performing the Pap test, as dysplastic epithelium may get removed.</li>\n<li>Ideally, confirmed cervicitis or vaginitis should be treated prior to the test</li>\n</ul>\n<p>Procedure:</p>\n<ul>\n<li>The patient is put in a dorsal position and Cusco&rsquo;s self-retaining speculum is introduced.</li>\n<li>The squamocolumnar junction is scraped with <strong>Ayre&rsquo;s spatula&nbsp;</strong>completing at least one full rotation. It&nbsp;predominantly samples the <strong>ectocervix</strong>.&nbsp;</li>\n<li><strong>Endocervix</strong> is scraped with a <strong>cytobrush,&nbsp;</strong>which is rotated only one-quarter to one-half turn after the ectocervix has been sampled.</li>\n<li>A <strong>broom</strong> simultaneously samples both endo- and ectocervix.&nbsp;<strong>Five rotations</strong> in the<strong> same direction</strong> are recommended, since reversing direction may cause loss of cellular material.&nbsp;</li>\n<li>Samples are spread separately on 2 different glass slides and fixed using 95% ethyl alcohol.</li>\n<li>Stained with Pap stain or Short stain.</li>\n</ul>\n<p>The image below shows the instruments used in cervical sampling: The broom, spatula, and cytobrush in order.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bc86785838a498b8b655e9a3b18a261x353x660.PNG"
    ]
  }
];
        let quizName = 'Procedures Mini Test - -Tmt';
        const quizFilename = 'procedures-mini-test-tmt-973dfc5b.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>