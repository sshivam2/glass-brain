<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test- 4 (Investigation Of Choice) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A term neonate is being evaluated for altered level of consciousness. There are also decreased spontaneous movements and abnormal respiration on examination prompting the suspicion for Intraventricular hemorrhage. Which of the following is the investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Cranial ultrasonography"
      },
      {
        "id": 2,
        "text": "Electroencephalogram"
      },
      {
        "id": 3,
        "text": "CT scan"
      },
      {
        "id": 4,
        "text": "MRI scan"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>\u00a0<strong>Cranial Ultrasonography</strong> is the preferred modality for diagnosis of<strong> intraventricular hemorrhage </strong>(IVH) because of the high sensitivity, ease of access and lack of radiation exposure.\u00a0</p>\n<p>The most important risk factor for intraventricular hemorrhage (IVH) is <strong>prematurity</strong> with high incidence in <strong>very low birth weight (VLBW)</strong> infants weighing &lt;1500 g at birth. The risk of GMH-IVH increases with decreasing gestational age and birth weight. Some other risk factors that increase its incidence include respiratory distress, mechanical ventilation, cardiopulmonary resuscitation and hypotension.</p>\n<p>The origin of bleeding is the small blood vessels in the <strong>germinal matrix</strong>,\u00a0located between the caudate nucleus and the thalamus at the level of the foramen of Monro.\u00a0In preterm infants, a weak structural support system makes the germinal matrix vulnerable to hemorrhage and injury particularly when there is hemodynamic instability.</p>\n<p>\u00a0Most cases present on the first day of life and the majority in the first few days of life. The most common presentation is a stuttering course with <strong>altered levels</strong> of <strong>consciousness</strong>, <strong>respiratory cycle alterations</strong>,<strong> hypotonia</strong>, <strong>decreased spontaneous</strong> and <strong>elicited movements,</strong> and subtle changes in eye position and movement. Catastrophic deterioration occurs in very few patients with <strong>seizures</strong>, <strong>coma</strong> and <strong>decerebrate posturing</strong> progressing over minutes to hours. Some patients may have a clinically silent presentation.</p>\n<p><strong>Ultrasound</strong> is the preferred modality because of the high sensitivity, ease of access and lack of radiation exposure. Routine ultrasound screening is recommended for infants born at &lt; 28 weeks gestation. CT scan is useful to detect cortical neuronal injury and Magnetic resonance imaging (MRI) is used to evaluate any hypoxic ischemic brain injury.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Investigation of choice to diagnose congenital adrenal hyperplasia due to 21-hydroxylase deficiency is estimation of ____________ levels.",
    "choices": [
      {
        "id": 1,
        "text": "21-Hydroxylase"
      },
      {
        "id": 2,
        "text": "17-Hydroxyprogesterone"
      },
      {
        "id": 3,
        "text": "3\u03b2-Hydroxysteroid dehydrogenase"
      },
      {
        "id": 4,
        "text": "11-Deoxycortisol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>17-hydroxyprogesterone </strong>levels estimation<strong>\u00a0</strong>is<strong>\u00a0</strong>the<strong>\u00a0</strong>investigation of choice to diagnose\u00a0<strong>CAH</strong> due to <strong>21 hydroxylase deficiency.\u00a0</strong>It will be markedly <strong>elevated</strong>.</p>\n<p>Congenital adrenal hyperplasia (CAH)/adrenogenital syndrome is a family of <strong>autosomal-recessive</strong> disorders associated with the diminished synthesis of cortisol and aldosterone. The <strong>most common cause</strong> of <strong>ambiguous genitalia</strong> in a newborn is a classic <strong>21-hydroxylase deficiency</strong>.</p>\n<p>Virilization is usually apparent at birth in females and within 2 to 3 years of life in males.\u00a0</p>\n<p>Severe 21-hydroxylase deficiency presents with symptoms including <strong>weight loss, dehydration, weakness, hypotension, and electrolyte imbalances.</strong> Accumulated steroid precursors like 17-hydroxyprogesterone, are shunted into the pathway of androgen synthesis leading to elevated levels of androstenedione and testosterone. This can result in abnormal genital development in affected female fetuses during early gestation.\u00a0</p>\n<p>Females may have masculinized external genitalia. This can include <strong>enlargement of the clitoris,</strong> partial or complete<strong> labial fusion,</strong> and a shared opening of the vagina and urethra (urogenital sinus).\u00a0</p>\n<p>Untreated individuals develop signs of androgen excess after birth. \u00a0These signs include<strong> accelerated skeletal maturation, premature epiphyseal closure</strong> leading to stunted adult stature, excessive muscular development, the appearance of pubic and axillary hair, acne, and deepening of the voice. In males, enlargement of the penis, scrotum, and prostate. In females, the clitoris may become further enlarged.\u00a0</p>\n<p>Other findings include:</p>\n<ol>\n<li>Elevated androstenedione and testosterone (in females).</li>\n<li>Low cortisol and aldosterone.</li>\n<li>Elevated ACTH levels.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/16d10c557fe24ef5859ddc65e9c58f4bx1280x1969.6473906911142.JPEG"
    ]
  },
  {
    "text": "A 50-year-old smoker presented with miosis, ptosis of the right eye, and anhidrosis of the right side of the face. He also has occasional chest pain along with fever and weight loss for the past month. A pancoast tumour is suspected. Which of the following is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "CT scan"
      },
      {
        "id": 2,
        "text": "FDG-PET scan"
      },
      {
        "id": 3,
        "text": "Bronchoscopy"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical picture is suggestive of a\u00a0<strong>Pancoast tumor (superior sulcus tumor)</strong> and the <strong>investigation of choice</strong> is <strong>MRI</strong>.</p>\n<p>Investigations in Pancoast tumor:</p>\n<div class=\"ng-scope\">\n<ul>\n<li><strong>MRI (MRI &gt; CT)</strong>\u00a0is the<strong> investigation of choice</strong> for superior sulcus tumor/ Pancoast tumor as the associated <strong>soft tissue infiltration</strong>, the extent of which can be best visualized using an MRI.</li>\n<li><strong>FDG-PET</strong> scan shows <strong>high uptake</strong> by the tumor cells. FDG is taken up by all metabolizing cells but more avidly by cancer cells.</li>\n<li><strong>Bronchoscopy</strong> can be done in endobronchial tumors to obtain a tissue diagnosis.</li>\n</ul>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Pancoast syndrome/ superior sulcus tumor</strong> results from a local extension of a tumor growing in the <strong>apex of the lung</strong>, with the involvement of\u00a0<strong>C8, T1, and T2</strong>\u00a0nerve roots, stellate ganglion, and the chest wall.</p>\n<p>It presents with pain that radiates to the <strong>ulnar distribution of the arm</strong>, often with the destruction of the 1st and 2nd ribs.</p>\n<p>Patients with the central or <strong>endobronchial growth</strong> of the primary tumor may present with a cough, hemoptysis, wheeze, stridor, dyspnea, or post-obstructive pneumonitis.</p>\n<p><strong>Regional spread</strong> can cause</p>\n<ul>\n<li>Tracheal obstruction</li>\n<li>Esophageal compression with dysphagia</li>\n<li>Recurrent laryngeal paralysis with hoarseness</li>\n<li><strong>Phrenic nerve palsy</strong> with the elevation of the hemidiaphragm and dyspnea</li>\n<li>Sympathetic nerve paralysis with <strong>Horner\u2019s syndrome</strong> (enophthalmos, ptosis, miosis, and anhydrosis)</li>\n</ul>\n<p>The below images show chest x-ray, FDG-PET images, and management of the Pancoast tumor.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7813405796f1470994bde7636f9d62d9x720x591.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7522ab2428ee44678da76324cfc822bfx720x426.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47460bc51cd64c32a49dcf30dabb28a6x1280x2864.JPEG"
    ]
  },
  {
    "text": "A child presented with bilateral proptosis. He is suspected of having chloroma based on his peripheral smear. What is the next investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet count"
      },
      {
        "id": 2,
        "text": "WBC count"
      },
      {
        "id": 3,
        "text": "Flow cytometry"
      },
      {
        "id": 4,
        "text": "Bone marrow biopsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The next investigation of choice, in a child suspected to have a<strong> chloroma</strong>, is a <strong>bone marrow biopsy</strong>.</p>\n<div class=\"page\" title=\"Page 4947\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Chloroma, </strong>also called <strong>myeloid sarcoma</strong>,\u00a0<strong>granulocytic sarcoma</strong>, or\u00a0<strong>myeloblastoma</strong>\u00a0is an <strong>extramedullary tumor</strong> that occurs in 2% to 14% of patients with <strong>acute myeloid leukemia (AML)</strong>. Frequent sites of involvement are the skin, lymph nodes, gastrointestinal tract, bone, soft tissue, testis, and peritoneum.</p>\n<p>Isolated orbital involvement of myeloid sarcoma is rare.\u00a0<strong>Proptosis</strong> is the most common presentation. Other symptoms include lacrimal swelling, conjunctival mass lesion, retinal hemorrhages, ptosis, dystopia.\u00a0<sup id=\"cite_ref-21\" class=\"reference\"></sup><sup id=\"cite_ref-22\" class=\"reference\"></sup>Decreased visual acuity and ocular movement restriction have also been reported.</p>\n<p>Most cases of chloroma can be diagnosed on <strong>peripheral smear</strong> examination, which is easily available and is relatively inexpensive. Sometimes it may not be associated with any peripheral smear abnormality, and hence <strong>bone marrow aspirate</strong> and <strong>biopsy</strong> should be done to confirm AML.\u00a0The diagnosis can also be made if Auer rods are detected.\u00a0Myeloid sarcomas have immunophenotypic features that are identical to AML.</p>\n<p>Although myeloid sarcomas are <strong>radiosensitive</strong>, they are managed with systemic <strong>chemotherapy</strong> in most cases, even in the absence of bone marrow involvement. <strong>Surgery</strong> and/or <strong>radiation</strong> therapy may be indicated for <strong>symptomatic</strong> lesions or tumors causing local organ dysfunction or obstruction.</p>\n<p>The image shows <strong>Auer\u00a0rods</strong> contained within myeloblasts.\u00a0</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/831bac512bc84d9aa0fe758b3c63d5dex352x512.JPEG"
    ]
  },
  {
    "text": "A 36-year-old man presents with a painless testicular mass with a sense of heaviness in the scrotum. His blood work showed raised LDH and AFP. Which of the following is the diagnostic investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast enhanced computed tomography"
      },
      {
        "id": 2,
        "text": "Ultrasonography"
      },
      {
        "id": 3,
        "text": "Trans-scrotal biopsy"
      },
      {
        "id": 4,
        "text": "Magnetic resonance imaging"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a middle-aged man presenting\u00a0with a <strong>painless testicular mass</strong> with a sense of <strong>heaviness</strong> in the scrotum suggests the diagnosis of a\u00a0<strong>testicular tumour</strong>. Blood work showed raised LDH and AFP which are tumour markers for <strong>non-seminomatous germ cell tumours </strong>(NSGCTs).<strong> </strong>The\u00a0diagnostic<strong> investigation\u00a0of\u00a0choice\u00a0</strong>is<strong>\u00a0ultrasonography.</strong></p>\n<p>Testicular tumours are uncommon male malignancies. <strong>Seminomas</strong> generally occur in the <strong>4th decade</strong> of life, while <strong>NSGCTs</strong>\u00a0are common in the <strong>3rd</strong> decade of life. <strong>Spermatocytic seminomas</strong> occur commonly in men older than <strong>50 years</strong>. WHO classification of testicular tumours is given below.</p>\n<p>Clinical features of testicular tumours are:</p>\n<ul>\n<li>Occurrence in the specific age group.</li>\n<li><strong>Painless testicular mass</strong> is the usual symptom</li>\n<li>Sense of <strong>scrotal heaviness</strong></li>\n<li>Abdominal or lumbar mass due to metastasis</li>\n<li>Chest pain, dyspnea, and haemoptysis due to lung metastasis</li>\n<li><strong>Prepubertal interstitial</strong> cell tumours produce <strong>androgens</strong>, causing precocious puberty</li>\n<li><strong>Postpubertal interstitial</strong> cell tumours produce <strong>feminising hormones</strong>, leading to gynecomastia, erectile dysfunction, loss of libido and azoospermia.</li>\n</ul>\n<p><strong>The diagnostic investigation </strong>of<strong> choice </strong>is<strong> ultrasonography (USG)</strong>. USG of the affected as well as the unaffected testis is done and is mandatory. Tumour markers aid in the diagnosis. <strong>Chest X-ray</strong> is done to detect <strong>'cannon ball'</strong> metastasis\u00a0in the lungs.</p>\n<p>Other options:</p>\n<p>Option A -\u00a0<strong>Contrast-Enhanced Computed Tomography\u00a0</strong>(CECT) is done to assess the thoracic, abdominal and pelvic areas for <strong>metastasis</strong>. Although it is essential in staging and monitoring response to therapy it is not the diagnostic investigation of choice.</p>\n<p>Option C:\u00a0<strong>Trans-scrotal biopsy</strong>\u00a0has <strong>no role</strong> in the diagnosis of testicular tumours.</p>\n<p>Option D:\u00a0<strong>Magnetic Resonance Imaging\u00a0</strong>(MRI) may be used as an adjunct if ultrasound findings are equivocal, or if the location of the mass is uncertain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the investigation of choice for the diagnosis of kala-azar?",
    "choices": [
      {
        "id": 1,
        "text": "Rapid dipstick test"
      },
      {
        "id": 2,
        "text": "Aldehyde test of Napier"
      },
      {
        "id": 3,
        "text": "ELISA"
      },
      {
        "id": 4,
        "text": "Indirect fluorescent antibody test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> rapid dipstick test\u00a0</strong>is the method of choice for the diagnosis of <strong>kala</strong>-<strong>azar</strong>.</p>\n<p>The following tests are used for the laboratory diagnosis of kala-azar:</p>\n<ul>\n<li>Rapid diagnostic tests\u00a0<strong>-</strong>\u00a0<strong>rK39</strong>\u00a0and dipstick test strip.</li>\n<li>Parasitological diagnosis - demonstration of <strong>LD bodies\u00a0</strong>on microscopy is confirmatory</li>\n<li>Surveillance purposes - <strong>Aldehyde test of Napier</strong></li>\n<li>Serological diagnosis - Rapid dipstick test, direct agglutination test, ELISA, indirect fluorescent antibody test</li>\n<li>Assessing immune status - <strong>Leishmanin </strong>(Montenegro)<strong> test</strong>\u00a0\n<ul>\n<li>Induration of \u2265 5 mm is considered positive</li>\n<li>Usually becomes positive 4-6 weeks after onset of cutaneous leishmaniasis</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old man presents with severe pulsatile proptosis, chemosis, diplopia, and an orbital bruit in the left eye, three weeks following a motor vehicle accident. He also reports headaches and tinnitus on the left side. Intraocular pressure in the left eye is elevated. What is the investigation of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CT head"
      },
      {
        "id": 2,
        "text": "Digital subtraction angiography"
      },
      {
        "id": 3,
        "text": "Orbital doppler imaging"
      },
      {
        "id": 4,
        "text": "MRI head"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a patient with pulsatile proptosis, chemosis, and a bruit is suggestive of a <strong>traumatic carotid-cavernous fistula</strong>. <strong>Selective catheter digital subtraction angiography </strong>is the investigation of choice.</p>\n<p><strong>A carotid cavernous fistula</strong>\u00a0is an arteriovenous fistula communicating between the internal carotid artery and the cavernous sinus.<br /><strong>Causes:\u00a0</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Severe <strong>head trauma </strong>(most common in males)\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Degenerative vessels</strong> (atheromatous or syphilitic disease) without discoverable trauma, especially in women</li>\n</ul>\n<p><strong>Types:\u00a0</strong></p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Direct fistula:\u00a0</strong></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">High-flow shunts in which carotid artery blood passes directly into the cavernous sinus through a defect in the wall of the intracavernous portion of the internal carotid artery\u00a0</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Indirect fistula\u00a0</strong></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Dural shunt/ low flow shunt in which the arterial blood flows through the meningeal branches of the external or internal carotid arteries indirectly into the cavernous sinus. Clinical manifestations are subtler than in a direct fistula.</li>\n</ul>\n</ol>\n<p>It presents within days or weeks following trauma; usually ipsilateral to the fistula but may be bilateral, or even contralateral. The <strong>classical triad</strong> of presentation is <strong>pulsatile proptosis, chemosis, and bruit. </strong>Other features include:</p>\n<ul>\n<li>Marked epibulbar vascular dilatation - \u201c<strong>Corkscrew vessels</strong>\u201d</li>\n<li>Chemosis</li>\n<li>Pulsatile proptosis associated with a <strong>bruit and a thrill</strong></li>\n<li>Increased IOP</li>\n<li>Anterior segment ischemia, characterized by corneal epithelial edema, aqueous cells, and flare and in severe cases iris atrophy, cataract, and rubeosis iridis.</li>\n<li><strong>Ophthalmoplegia</strong> (III-VI nerve palsies)</li>\n<li>Ophthalmoscopy findings: optic disc swelling, venous dilatation, intraretinal hemorrhage from venous stasis, and impaired retinal blood flow.</li>\n<li>Visual loss\n<ul>\n<li>Immediate - due to ocular or optic nerve damage</li>\n<li>Delayed - as a result of exposure keratopathy, secondary glaucoma, central retinal vein occlusion, anterior segment ischemia, or ischaemic optic neuropathy.</li>\n</ul>\n</li>\n</ul>\n<p><strong>Investigations:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Selective catheter Digital subtraction angiography is the investigation of choice.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">CT and MRI angiography can also be done</li>\n</ul>\n<p>Treatment is\u00a0mostly conservative. <strong>Embolization</strong> during arteriography is the treatment of choice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old female presents with gradually worsening shortness of breath over the past 6 months. She is on methotrexate for rheumatoid arthritis, and interstitial lung disease is suspected. What is the investigation of choice to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "PFT"
      },
      {
        "id": 3,
        "text": "HRCT"
      },
      {
        "id": 4,
        "text": "Chest x-ray"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>High-resolution CT</strong> is the <strong>investigation of choice</strong> for <strong>ILD</strong>.\u00a0\u00a0</p>\n<p><strong>Interstitial lung disease</strong> (ILD) refers to the <strong>remodeling of interstitial space</strong>, the region between the epithelium and endothelium. The main pathology is <strong>fibrosis</strong>.</p>\n<p>It can be broadly classified into:</p>\n<ul>\n<li>\u00a0ILD of known causes like occupational(coal workers' pneumoconiosis, silicosis), rheumatological(rheumatoid arthritis,<strong> diffuse&gt;limited</strong> cutaneous <strong>systemic sclerosis,</strong> polymyositis, dermatomyositis, and occasionally SLE and Sjogren syndrome), and treatment-induced.</li>\n<li>ILD of unknown cause, which is also called <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">idiopathic interstitial pneumonia (IIP).\u00a0</strong></li>\n</ul>\n<div><strong>IIP</strong> is further divided into:</div>\n<ul>\n<li><strong>Idiopathic pulmonary fibrosis</strong> (<strong>IPF</strong>)/ Usual Interstitial Pneumonia (UIP): It is the <strong>most common</strong> form of idiopathic interstitial pneumonia.</li>\n<li>Non-specific interstitial pneumonia (NSIP)</li>\n<li>Cryptogenic Organizing pneumonia (COP)</li>\n<li>Acute interstitial pneumonia (AIP)</li>\n<li>Respiratory bronchiolitis associated ILD (RB-ILD)</li>\n<li>Desquamative interstitial pneumonia (DIP)</li>\n<li>Lymphocytic interstitial pneumonia (LIP)</li>\n<li>ILD is a <strong>restrictive</strong> lung disease with <strong>low V/Q mismatch</strong> where\u00a0the alveolar-arterial oxygen gradient <strong>(a-A O<span style=\"font-size: 11.6667px;\">2</span>\u00a0gradient)</strong> is <strong>increased</strong> due to a <strong>defect</strong> <strong>in</strong> <strong>diffusion</strong> resulting in <strong>hypoxemia</strong>.</li>\n</ul>\n<p>ILD(pulmonary fibrosis) is the <strong>most</strong> <strong>serious adverse</strong> <strong>effect</strong> of prolonged <strong>amiodarone</strong> (class iii antiarrhythmic) use. Thus, amiodarone is <strong>contraindicated</strong> in ILD patients<strong>.</strong></p>\n<div class=\"row mt-3\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with a high fever, altered sensorium, headache, neck rigidity, and seizures. He was diagnosed with HSV encephalitis. Which of the following tests can be used to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "IgM in CSF"
      },
      {
        "id": 2,
        "text": "Tzanck smear of CSF"
      },
      {
        "id": 3,
        "text": "CSF PCR for viral DNA"
      },
      {
        "id": 4,
        "text": "CSF culture on chick embryo lines"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>HSV-DNA demonstration in<strong> CSF by PCR </strong>is the<strong> investigation of choice</strong> for<strong> HSV encephalitis.\u00a0</strong></p>\n<p><strong>Herpes simplex virus (HSV)</strong>\u00a0encephalitis is defined as inflammation of brain parenchyma caused by the herpes virus, and it typically presents as an<strong> acute febrile illness</strong>.</p>\n<div class=\"page\" title=\"Page 1135\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Patients typically present with acute onset of <strong>fever</strong>,\u00a0<strong>altered levels of consciousness</strong>, personality changes, and evidence of either <strong>focal or diffuse neurologic signs and symptoms, </strong>especially in the<strong> temporal lobe.</strong>\u00a0<strong>Focal or generalized seizures</strong> occur in many patients with HSV encephalitis. Other most commonly encountered focal findings include aphasia, ataxia, upper motor neuron or lower motor neuron type lesions, and cranial nerve deficits.</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>HSV-DNA</strong> demonstration in CSF by <strong>PCR </strong>is the investigation of choice for HSV encephalitis. Other investigations that can help include CSF examination, CSF culture, serological studies, MRI, CT, EEG, and brain biopsy.</p>\n<p>The <strong>T2-weighted MRI of the brain</strong> will show <strong>hyperintensity in the temporal lobe</strong> in most of the patients. <strong>Bilateral</strong> involvement of the temporal lobe is <strong>more common</strong> in HSV encephalitis.</p>\n<p>The image below is a<strong>\u00a0</strong><strong>coronal T2-weighted MR</strong> image showing a high signal intensity in the temporal lobes in a patient with HSV encephalitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e8c33e7dde164fd8adfa7d0badbcc4ddx480x512.JPEG"
    ]
  },
  {
    "text": "A neonate is brought on the 5th day of life with abdominal distension. The mother informs that the child has not passed meconium yet. Distal bowel obstruction is suspected. What is the diagnostic test of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Rectal manometry"
      },
      {
        "id": 2,
        "text": "Contrast enema"
      },
      {
        "id": 3,
        "text": "Rectal suction biopsy"
      },
      {
        "id": 4,
        "text": "Calretinin immunostain\u00ading"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation (abdominal distension and failure to pass meconium) is suggestive of <strong>Hirschsprung\u2019s disease</strong>. <strong>Contrast enema</strong> is used as the <strong>initial</strong> <strong>investigation</strong>\u00a0when Hirschsprung\u2019s disease is suspected and is the diagnostic test of choice. <strong>Rectal biopsy</strong> is the <strong>gold standard investigation.</strong></p>\n<p>Hirschsprung disease or <strong>congenital aganglionic colon</strong> is characterized by the <strong>absence of ganglion cells</strong> in the <strong>myenteric (Auerbach) plexus</strong> and <strong>submucosal (Meissner) plexus</strong> of the <strong>distal intestinal segment</strong>. This is because of the <strong>premature arrest</strong> of normal migration of neural crest cells from the cecum to the rectum.</p>\n<p>It causes a muscular spasm of the <strong>distal intestinal segment</strong>, resulting in <strong>functional obstruction</strong> of the affected bowel and proximal dilation (<strong>megacolon</strong>). The area between the dilated and contracted segments is referred to as the <strong>transition zone</strong>.</p>\n<p>Hirschsprung disease is classified into -</p>\n<ul>\n<li>Short-segment - limited to the rectosigmoid segment</li>\n<li>Long-segment - proximal extension beyond the rectosigmoid segment</li>\n</ul>\n<p><strong>Note</strong>: while the<strong> gold standard</strong> investigation for Hirschsprung\u2019s disease is <strong>rectal suction biopsy</strong>, an <strong>imaging study</strong> will <strong>first</strong> be required to figure out the <strong>location</strong> from where the sample needs to be taken.</p>\n<p>The image below shows dilated ganglionic and contracted aganglionic segments in Hirschsprung's disease,</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0fc3cdfe0f2d4a268398a2afe3839034x1280x1573.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4079f7c1f83426ca6094d5d37bf059ax720x816.PNG"
    ]
  },
  {
    "text": "A male patient comes to the outpatient clinic with dilated tortuous veins in his lower limb. Varicose veins is suspected. Which of the following is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Duplex scan"
      },
      {
        "id": 2,
        "text": "Plethysmography"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "CT scan"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Duplex ultrasound</strong>\u00a0is the investigation of choice for varicose veins.</p>\n<p><strong>Varicose veins</strong> refer to subcutaneous dilated veins of more than\u00a0<strong>3 mm</strong>\u00a0in diameter.\u00a0</p>\n<p>Investigations :\u00a0</p>\n<ul>\n<li aria-level=\"1\">Clinical examination</li>\n<li aria-level=\"1\"><strong>Venous duplex ultrasound</strong>\u00a0which tells about:\n<ul>\n<li aria-level=\"1\">The site of reflux</li>\n<li aria-level=\"1\">Size of vein</li>\n<li aria-level=\"1\">Location of perforators</li>\n<li aria-level=\"1\">Presence of obstruction in the deep venous system</li>\n<li aria-level=\"1\">Indication of pelvic source of reflux or obstruction</li>\n</ul>\n</li>\n<li aria-level=\"1\">MR venography</li>\n<li aria-level=\"1\">Invasive procedures such as contrast venography or intravenous ultrasound.</li>\n</ul>\n<p>Management of varicose veins</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Incompetence</strong></td>\n<td><strong>Management</strong></td>\n</tr>\n<tr>\n<td>Great saphenous vein (GSV) and saphenofemoral (SFJ)\u00a0</td>\n<td>\n<ul>\n<li><strong>Endothermal ablation</strong>\u00a0(<strong>gold standard</strong>\u00a0treatment for varicose veins). It includes:</li>\n</ul>\n<ul>\n<li><strong>Endovenous laser ablation</strong>\u00a0(<strong>EVLA</strong>)</li>\n<li>Radiofrequency ablation (RFA)</li>\n</ul>\n<ul>\n<li><strong>Trendelenburg procedure</strong>\u00a0(<strong>Flush Ligation</strong>\u00a0of Saphenofemoral Junction (<strong>SFJ</strong>) after ligation of 6 tributaries) \u00b1\u00a0<strong>stripping</strong>\u00a0(retrogradely\u00a0<strong>up to the knee</strong>, to prevent<strong>\u00a0saphenous</strong>\u00a0nerve injury.)\u00a0 \u00a0 \u00a0</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Short saphenous vein (SSJ) and saphenopopliteal (SPJ)</td>\n<td>\n<ul>\n<li><strong>Flush ligation</strong>\u00a0of\u00a0<strong>SPJ</strong>\u00a0(<strong>Stripping</strong>\u00a0is\u00a0<strong>not done</strong>\u00a0to prevent\u00a0<strong>sural nerve</strong>\u00a0injury)</li>\n<li><strong>Endothermal ablation:</strong></li>\n</ul>\n<ul>\n<li><strong>Endovenous laser ablation (EVLA)</strong></li>\n<li>Radiofrequency ablation (RFA)</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Perforator\u00a0</td>\n<td>\n<ul>\n<li>Dodd and Crockett surgery - Multiple subfascial ligations</li>\n<li><strong>Subfascial endoscopic perforator surgery (SEPS)</strong>\u00a0- smaller incision, so cosmetically better</li>\n<li><strong>Endothermal ablation:</strong></li>\n</ul>\n<ul>\n<li><strong>Endovenous laser ablation (EVLA)</strong></li>\n<li>Radiofrequency ablation (RFA)</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>New treatment modalities:</p>\n<ul>\n<li aria-level=\"1\"><strong>Foam sclerotherapy -</strong>\u00a0The Tessari method is a widely used method to prepare foam for sclerotherapy. Sclerosant: air ratio taken is 1:3 or 1:4.</li>\n<li aria-level=\"1\"><strong>Endovenous glue therapy</strong>\u00a0- endoluminal application of cyanoacrylate adhesive\u00a0</li>\n<li aria-level=\"1\"><strong>TriVex</strong>\u00a0- Transilluminated powered phlebectomy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old boy with persistent diurnal incontinence and abdominal distention is being evaluated for a posterior urethral valve. What is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Transrectal ultrasound scan"
      },
      {
        "id": 2,
        "text": "Renal nuclear scintigraphy"
      },
      {
        "id": 3,
        "text": "Voiding cystourethrogram"
      },
      {
        "id": 4,
        "text": "Non-contrast CT scan"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Voiding cystourethrogram (VCUG)</strong>\u00a0is the investigation of choice for a posterior urethral valve<strong>.</strong></p>\n<p>Posterior urethral valves (<strong>PUV</strong>) are obstructing membranous folds within the lumen of the posterior urethra, which hinders the outflow of urine from the urinary bladder and may precipitate chronic renal disease in children.</p>\n<p>It occurs due to <strong>disruption of normal embryonic development</strong> of the male urethra between the 9th and 14th weeks of intrauterine life, resulting in the formation of membranous folds within the lumen of the posterior urethra.</p>\n<p>Children with PUV who are not diagnosed before birth may present with delayed voiding or a poor urinary stream. Infants are predisposed to <strong>repeated urinary tract infections (UTIs).</strong> Other common signs and symptoms may include a palpable abdominal mass, failure to thrive, lethargy, poor feeding, urosepsis, and urinary ascites. Older boys may have persistent diurnal incontinence or abdominal distention. Physical examination in the newborn typically discloses a palpable walnut-sized bladder, which corresponds to the hypertrophic detrusor muscle.</p>\n<div class=\"page\" title=\"Page 748\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 748\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Other options:<br /><br />Option A: <strong>Trans-rectal ultrasound scan (TRUS)</strong> is usually performed in conjunction with a biopsy of the prostate in male patients with an abnormal digital rectal examination of the prostate</p>\n<p>Option B: <strong>Renal nuclear scintigraphy</strong> with a technetium-99m-labelled dimercaptosuccinic acid can be used to visualise any abnormality or thinning of the renal parenchyma, like renal scarring</p>\n<p>Option D: A <strong>Non-contrast CT scan</strong> is the investigation of choice in a patient with suspected urinary tract calculi</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old obese male with a history of alcohol use presents to the emergency department with severe abdominal pain radiating to the back. Blood tests reveal elevated serum amylase and lipase levels. What is the investigation of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Erect abdominal X-ray"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "Ultrasonography"
      },
      {
        "id": 4,
        "text": "MRI scan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation of the patient is suggestive of <strong>acute pancreatitis</strong>. Contrast-enhanced computed tomography <strong>(CECT)</strong> is the <strong>imaging investigation of choice</strong>.\u00a0</p>\n<p>Acute pancreatitis is a condition characterized by inflammatory damage to the pancreas. Various causes of acute pancreatitis are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Gallstone-induced</strong> (most common cause)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Alcohol</strong> (2nd most common cause)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Trauma</strong> (most common cause in children)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Iatrogenic- Post-endoscopic retrograde cholangiopancreatography (ERCP)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Drug-induced pancreatitis (Thiazides, Azathioprine, Anti-cancer drugs, etc)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypertriglyceridemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypercalcemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Scorpion bite</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Idiopathic</li>\n</ul>\n<p>Clinical presentation of acute pancreatitis is characterized by <strong>epigastric pain radiating</strong> to the <strong>back</strong> which is<strong> relieved by bending forward</strong>, nausea, and vomiting. Acute hemorrhagic pancreatitis can present with certain named signs like:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Fox sign: </strong>Discoloration in the inguinal region<strong><br /></strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Bryant\u2019s sign: </strong>Discoloration on the scrotum</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cullen\u2019s sign</strong>: Discoloration around the umbilicus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d403ca5261614f95a3abe2b87e39f85bx720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43b3c227be5841fa84024367771de01dx720x535.JPEG"
    ]
  },
  {
    "text": "The radiological imaging of choice for pheochromocytoma is ___",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "Ultrasound"
      },
      {
        "id": 3,
        "text": "CECT"
      },
      {
        "id": 4,
        "text": "FDG PET"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>MRI</strong>\u00a0is the\u00a0<strong>investigation of choice</strong> for localizing the tumor in pheochromocytoma.</p>\n<p><strong>Pheochromocytoma</strong>\u00a0is a catecholamine-secreting tumor derived from the chromaffin cells of the adrenal medulla.\u00a0</p>\n<p>Clinical features of pheochromocytoma are due to the\u00a0autonomic effects of excess epinephrine and norepinephrine.\u00a0</p>\n<ul>\n<li><strong>Weight loss</strong>\u00a0is due to<strong>\u00a0</strong>the increase in catecholamines which increase basal metabolism.</li>\n<li><strong>Pallor</strong>\u00a0is due to alpha 1-mediated vasoconstriction.\u00a0</li>\n<li><strong>Abdominal pain </strong>with nausea and vomiting is commonly seen.</li>\n</ul>\n<p>Diagnosis of pheochromocytoma requires biochemical testing followed by imaging.</p>\n<ul>\n<li><strong>Urinary and plasma levels</strong>\u00a0of\u00a0<strong>catecholamines and metanephrines</strong>\u00a0</li>\n<li><strong>MRI</strong>\u00a0is the\u00a0<strong>investigation of choice</strong>\u00a0for localizing the tumor\u00a0</li>\n<li><strong>MIBG Scintigraphy</strong>\u00a0and\u00a0<strong>PET</strong>\u00a0Scans like\u00a0<strong>Ga- DOTATE</strong>,\u00a0<strong>DOPA-</strong>\u00a0or\u00a0<strong>FDG- PET</strong>\u00a0can be used for extra-adrenal tumors and metastases</li>\n</ul>\n<p>Treatment of pheochromocytoma:</p>\n<p><strong>Surgical resection</strong>\u00a0of the tumor is the definitive treatment. Preoperatively, an\u00a0<strong>alpha-receptor blocker\u00a0</strong>(phenoxybenzamine)<strong>\u00a0</strong>is given to control the effects produced by excess catecholamines.\u00a0<strong>Beta-blockers</strong>\u00a0are used\u00a0to control tachycardia\u00a0after adequate\u00a0alpha blockade<strong>\u00a0</strong>is achieved. This is to prevent\u00a0<strong>unrestricted alpha-mediated vasoconstriction</strong>.</p>\n<p>Following surgery,\u00a0<strong>yearly follow-ups</strong>\u00a0lifelong should be done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the initial investigation of choice in a 14-year-old girl who has not attained menarche?",
    "choices": [
      {
        "id": 1,
        "text": "Sex Hormones Assay"
      },
      {
        "id": 2,
        "text": "Thyroid Function Tests"
      },
      {
        "id": 3,
        "text": "Pelvic ultrasonography"
      },
      {
        "id": 4,
        "text": "Chromosomal analysis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Pelvic ultrasonography\u00a0</strong>is the initial investigation of choice in suspected primary amenorrhea, to determine the presence of the vagina, uterus, tubes and ovaries.\u00a0</p>\n<p><strong>Primary amenorrhea</strong> is defined as the absence of menstruation by <strong>14 years</strong>\u00a0without the development of secondary sexual characteristics or by <strong>16 years</strong>\u00a0regardless\u00a0of the presence of secondary sexual characteristics.</p>\n<p>The following is the\u00a0investigation algorithm for amenorrhea:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e30b740ef37546b4919500be3193c838x600x933.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb64265a9824434da633f6bdfef5c6ddx600x878.JPEG"
    ]
  },
  {
    "text": "A 7-year-old boy presents with a white pupillary reflex, for which enucleation was performed. Histopathological examination of the specimen revealed Flexner-Wintersteiner rosettes. What is the investigation of choice for staging his condition?",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "USG"
      },
      {
        "id": 3,
        "text": "CT"
      },
      {
        "id": 4,
        "text": "Biopsy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis with a histopathological finding of <strong>Flexner Winterstein</strong> <strong>rosettes</strong>\u00a0in a 7-year-old child with a <strong>whitish pupillary reflex </strong>is\u00a0<strong>retinoblastoma</strong>.\u00a0<strong>MRI</strong>\u00a0is considered to be the <strong>investigation</strong> of <strong>choice</strong> in the pretreatment <strong>staging</strong> of retinoblastoma.</p>\n<p>Retinoblastoma is a malignant proliferation of immature retinal neural cells and is the <strong>most common</strong> <strong>intraocular malignancy</strong> in <strong>children</strong>. It is associated with mutations in the <strong>RB1 gene</strong> at chromosome <strong>13q14. </strong>It is a\u00a0tumour of a group called small round blue cell tumours because the immature retinal neural cells are seen as small round cells with large nuclei.\u00a0</p>\n<p><strong>White pupillary reflex</strong>\u00a0or <strong>leukocoria</strong> is the most common presenting feature, followed by a squint which is usually convergent. Rarely, the child may present with nystagmus and defective vision.</p>\n<p>Image showing leukocoria of left eye</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df14a240df724365a0ab9d8046e809e7x720x331.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/520953bab5e9459eb251a6b384c78e27x510x525.GIF"
    ]
  },
  {
    "text": "An 18-year-old male presents to the emergency department with  epistaxis and a nasal mass. What is the investigation of choice to evaluate his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Plain CT"
      },
      {
        "id": 2,
        "text": "CECT PNS and nose"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "X-ray"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>History of <strong>nasal mass</strong> and associated <strong>epistaxis</strong> in an 18-year-old raises the suspicion of <strong>nasopharyngeal angiofibroma</strong>. <strong>CECT</strong> of the <strong>PNS</strong> and <strong>nose</strong> can be done to <strong>evaluate</strong> the patient.</p>\n<p>CECT of the PNS and nose is particularly useful for revealing characteristic findings such as the <strong>anterior</strong> <strong>bowing</strong> of the <strong>posterior</strong> <strong>wall</strong> of the <strong>maxillary</strong> <strong>sinus</strong>, known as the <strong>Antral</strong> <strong>sign</strong> or <strong>Holman</strong>-<strong>Miller</strong> <strong>sign</strong> (shown in the image below), which is indicative of <strong>nasopharyngeal</strong> <strong>angiofibroma</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60b3695f168e4db489b2f585fd52d74ex1280x1304.JPEG"
    ]
  },
  {
    "text": "Which of the following is considered the investigation of choice for the evaluation of a patient with suspected peptic ulceration?",
    "choices": [
      {
        "id": 1,
        "text": "Gastroduodenoscopy"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "Barium meal"
      },
      {
        "id": 4,
        "text": "Barium swallow"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Gastroduodenoscopy</strong> is considered the <strong>investigation of choice</strong> for the evaluation of a patient with <strong>suspected peptic ulcer disease.</strong></p>\n<p>Gastroduodenoscopy<strong>\u00a0</strong>helps to directly <strong>visualise</strong> the ulcer and simultaneously perform a <strong>biopsy</strong>\u00a0to <strong>rule out</strong> <strong>malignancy</strong>. This makes it a better investigation compared to others.</p>\n<p>Gastric peptic ulcers are predominantly located along the lesser curvature near the interface of the body and antrum. The most common site of <strong>peptic ulcer</strong> is the\u00a0<strong>anterior wall </strong>of the <strong>proximal duodenum,\u00a0</strong>within a few centimeters of the pyloric valve.\u00a0</p>\n<p>The image below shows a peptic ulcer with a <strong>round </strong>to<strong> oval and sharply punched-out defect,</strong> and a clean mucosal margin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c779b2a090da476886059e6556f9a787x400x408.JPEG"
    ]
  },
  {
    "text": "The radiological investigation of choice for avascular necrosis of bone is ________",
    "choices": [
      {
        "id": 1,
        "text": "X-ray"
      },
      {
        "id": 2,
        "text": "CT"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "Scintigraphy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> investigation of choice</strong> for <strong>avascular necrosis</strong> of bone is<strong> MRI</strong> as initially, bone infarction occurs in the marrow.</p>\n<p>Avascular necrosis or\u00a0<strong>osteonecrosis</strong>\u00a0is a painful bone condition resulting from diminished blood supply mainly due to trauma or non-traumatic etiologies.\u00a0</p>\n<p>The typical features are pain with movements in or near the joint, click in the joint, joint stiffness, limping gait, and deformity. Restriction of actions is also a feature of this condition.</p>\n<p>The radiograph shows reactive new bone formation,<strong>\u00a0increased radiolucency</strong>\u00a0in the subchondral bone, and\u00a0a<strong>\u00a0distorted articular surface</strong>. MRI has high sensitivity and specificity in diagnosis.</p>\n<p>Management in the early stages can involve osteotomy while in late stages pain control, splinting, arthrodesis and total or partial replacement are preferred.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the investigation of choice for neurosyphilis?",
    "choices": [
      {
        "id": 1,
        "text": "Venereal disease research laboratory (VDRL) test"
      },
      {
        "id": 2,
        "text": "FTA-ABS- Fluorescent Treponemal Antibody Absorption test"
      },
      {
        "id": 3,
        "text": "RPR- Rapid Plasma Reagin test"
      },
      {
        "id": 4,
        "text": "TPI-Treponema pallidum immobilization test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The investigation of choice for <strong>neurosyphilis</strong> is <strong>VDRL.</strong></p>\n<p>The <strong>CSF-</strong><strong>VDRL </strong>test is highly specific and, when reactive, is considered<strong> diagnostic of neurosyphilis.</strong></p>\n<p>Involvement of the CNS in syphilis is detected by examination of <strong>CSF</strong> for:</p>\n<ul>\n<li>Mononuclear pleocytosis (&gt;5 white blood cells/\u03bcL).</li>\n<li>Increased protein concentration (&gt;45 mg/dL).</li>\n<li>CSF VDRL reactivity.</li>\n</ul>\n<p>Other options :</p>\n<p>Option B: <strong>Fluorescent treponemal antibody absorption test</strong> (FTA-ABS) is a sensitive test for syphilis, detecting specific antibodies to Treponema pallidum. While it can remain positive for life, even after treatment, it is <strong>less specific</strong> for active neurosyphilis compared to the VDRL test, which is why it is not the first-line test for this condition.</p>\n<p>Option C: <strong>Rapid plasma reagin Test </strong>(RPR) is another non-treponemal test like the VDRL, but it is <strong>performed on serum</strong>, not CSF. It is used for diagnosing syphilis in the bloodstream and <strong>monitoring treatment response</strong>, but it <strong>cannot specifically diagnose neurosyphilis</strong>. Thus, it is not the preferred investigation for central nervous system involvement.</p>\n<p>Option D:\u00a0<strong>Treponema pallidum immobilization test </strong>(TPI) is an older, treponemal test once used for detecting syphilis. Due to its<strong> complex</strong> and <strong>labor-intensive nature</strong>, it has been largely replaced by more efficient and widely available tests like the FTA-ABS. Given its outdated status, the TPI test is rarely utilized in modern clinical practice and is <strong>no longer recommended</strong> for diagnosing neurosyphilis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Mini Test- 4 (Investigation Of Choice)';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>