<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>109 Forensic Medicine Aiims 2020 (May And Nov Ini-Cet) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Forensic Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">18</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Identify the type of skull fracture in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Ring"
      },
      {
        "id": 2,
        "text": "Depressed"
      },
      {
        "id": 3,
        "text": "Fissured"
      },
      {
        "id": 4,
        "text": "Comminuted"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows a <strong>fissured fracture of skull</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90a4f203158546f2a70b4f30da02154b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man was brought to the ER after an assault with a sharp axe. Identify the type of wound?",
    "choices": [
      {
        "id": 1,
        "text": "Incised wound"
      },
      {
        "id": 2,
        "text": "Chop wound"
      },
      {
        "id": 3,
        "text": "Lacerated wound"
      },
      {
        "id": 4,
        "text": "Abrasion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given wound caused by an axe, is likely to be a <strong>chop wound.</strong></p>\n<p>Chop wounds are so-called because of the action in which they are produced. Depending on the type of instrument, they may resemble an incised or a lacerated wound. The shape of the wound may give clues to the type of weapon. It would be a <strong>deep, well-margined wound, gaping&nbsp;</strong>with limited damage to the surrounding skin.&nbsp;</p>\n<p>For example, in the given image, the wound resembles an injury produced by a sharp axe. Such wounds may be inflicted with homicidal intent on the skull/scalp.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4dfed7c2de4468ab8bc473b9f20b352.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient comes to the casualty with life-threatening injuries. There was no time for taking consent. The doctor started doing life-saving procedures with all precautions, and despite best efforts, the death of the patient occurred. The doctor is not responsible under which doctrine?",
    "choices": [
      {
        "id": 1,
        "text": "Res ipsa loquitor"
      },
      {
        "id": 2,
        "text": "Doctrine of anticipation"
      },
      {
        "id": 3,
        "text": "Doctrine of extended consent"
      },
      {
        "id": 4,
        "text": "Doctrine of conjugated consent"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Under <strong>IPC 92</strong>, the doctor can perform life-saving procedures in a patient with life-threatening injuries without obtaining consent. The guiding principle is whether the delay in treatment in order to obtain consent would result in harm to the patient. This is&nbsp;the <strong>doctrine of anticipation</strong>.</p>\n<p>Under some circumstances like emergencies, informed consent may be neither possible nor necessary.</p>\n<p>IPC 92 states that <strong>nothing is an offense by reason of any harm</strong> which it may cause to a person for <strong>whose benefit it is done in</strong> <strong>good faith,</strong> even without that person&rsquo;s consent, if the circumstances are such that it is impossible for that person to signify consent, or if that person is incapable of giving consent, and has no guardian or other person in lawful charge of him from whom it is possible to obtain consent in time for the thing to be done with benefit.</p>\n<p>Other options:</p>\n<p>'<strong>Res Ipsa Loquitor</strong>' means '<strong>the thing or fact speaks for itself</strong>'. It is obvious evidence for the negligent act committed. For example, swabs left in the abdominal cavity post laparotomy.</p>\n<p><strong>The doctrine of extended consent</strong>: It is used in <strong>u</strong><strong>nanticipated conditions during surgery.</strong>&nbsp;This comes into play when a surgeon encounters an unanticipated abnormality within the field of surgery. It is called the &ldquo;extension doctrine,&rdquo; and it assumes that the surgeon is using reasonable judgment. For example, a surgeon incurred no liability for draining some ovarian cysts during the course of an appendectomy. The condition must be one that was <strong>unforeseen</strong>, and the patient must not have expressly refused such an intervention.</p>\n<p><strong>Doctrine of conjugated consent</strong> - Dummy option (No such consent has been defined).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding the management of snakebite in India?",
    "choices": [
      {
        "id": 1,
        "text": "Atropine and neostigmine are very useful in the management of krait bite"
      },
      {
        "id": 2,
        "text": "Neostigmine and ventilatory support are used  in treatment along with ASV"
      },
      {
        "id": 3,
        "text": "ASV is the mainstay  of treatment"
      },
      {
        "id": 4,
        "text": "Current ASV in India is not effective against humped pit viper"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Atropine is not useful in the management of krait bite. The toxin in common krait's venom <strong>acts presynaptically</strong>, hence atropine is not used in the treatment of envenomation by krait.&nbsp;</p>\n<p>As the&nbsp;<strong>cobra</strong> venom acts <strong>postsynaptically</strong>, atropine can be used in the management.</p>\n<p><strong>ASV</strong>(Anti Snake Venom) is the <strong>mainstay</strong> of snakebite treatment.</p>\n<p>ASV used in India is effective against:</p>\n<ul>\n<li>Cobra</li>\n<li>Common krait</li>\n<li>Russel viper</li>\n<li>Saw scaled viper</li>\n</ul>\n<p>Neostigmine and ventilatory support are used in the treatment of snakebite.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old girl comes to the OPD with her mother. History of penovaginal penetration by the neighbour is reported to the doctor. The girl admits to giving the neighbor the consent for the same and says she does not want to be examined. As a medical officer, which of the following should you do?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,3 are true"
      },
      {
        "id": 2,
        "text": "2,3,4 are true"
      },
      {
        "id": 3,
        "text": "1,3,5 are true"
      },
      {
        "id": 4,
        "text": "3,4,5 are true"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given scenario 1, 3, 5 are true.</p>\n<p>The scenario describes a 14-year-old girl with a history of sexual intercourse with her neighbor albeit with consent. Consent for intercourse is valid only after 18 years in an unmarried girl. As she is less than 18 years, it is presumed to be a medicolegal case of sexual assault.</p>\n<p>Examination of a victim of sexual assault should be done after the consent of the victim (if she is less than 12 years of age or unsound mind, consent from the guardian needs to be taken). If she denies examination, counseling has to be done regarding the need for examination and how it could be held up against her in the court of law. If she still refuses for part or whole of examination or sample collection, an informed refusal needs to be documented.</p>\n<p>Information to the police is given in all medicolegal cases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A surgeon performs a hysterectomy for uterine fibroids after obtaining relevant informed consent from the patient.  Despite adequate precaution, the ureter was injured intraoperatively. Under which of the following principles will the doctor not be held responsible for this act?",
    "choices": [
      {
        "id": 1,
        "text": "Novus actus interveniens"
      },
      {
        "id": 2,
        "text": "Medical maloccurrence"
      },
      {
        "id": 3,
        "text": "Res ipsa loquitur"
      },
      {
        "id": 4,
        "text": "Physician error"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The doctor will not be responsible for the above act under <strong>medical\u00a0maloccurrence.</strong></p>\n<p><strong>Medical Maloccurrence/Inevitable Accident</strong>: Every human being responds differently to different drugs as well as to different treatment modalities. On certain occasions, despite all proper care given by the doctor during treatment, the patient fails to respond properly or may suffer some adverse reactions to the drug which may lead to severe injuries or permanent deformities. This is known as a medical maloccurrence/inevitable accident.\u00a0</p>\n<p>If the doctor can prove this before the court, it will be an absolute defence against malpractice.</p>\n<p>'<strong>Res ipsa loquitur</strong>' means '<strong>the thing or fact speaks for itself</strong>'. It is obvious evidence of the negligent act committed. For example, swabs left in the abdominal cavity post laparotomy.</p>\n<p><strong>'Novus actus interveniens'</strong>: This essentially means that the <strong>negligence</strong> at the core of the lawsuit stems from the <strong>actions</strong> of a <strong>third party</strong> and that this negligence was unforeseeable. The viability of this defence heavily relies on the specific details of each case. For instance, if a doctor writes a prescription that is allegedly illegible, and the pharmacist misreads it, fails to verify it with the doctor, and then dispenses the wrong medication to the patient, resulting in an injury, the doctor might use this defence in such a scenario.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The punishment for the death of a patient by spurious drug:",
    "choices": [
      {
        "id": 1,
        "text": "5 years"
      },
      {
        "id": 2,
        "text": "7 years"
      },
      {
        "id": 3,
        "text": "Life imprisonment"
      },
      {
        "id": 4,
        "text": "1 year"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The punishment for the death of a patient by a spurious drug is&nbsp;<strong>imprisonment for life.</strong></p>\n<p>In case of an adulterated, <strong>spurious,</strong> or any drug that when used&nbsp;by any person for or in the diagnosis, treatment, mitigation, or&nbsp;prevention of any disease or disorder is likely to cause ill health&nbsp;or is likely to cause such harm on his body as would <strong>amount to&nbsp;grievous hurt</strong> within the meaning of <strong>Section 320</strong> of IPC, shall&nbsp;be punishable with imprisonment for a term that shall not be&nbsp;less than 3 years but that may extend to a term of life.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the seeds shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Tropicana canna"
      },
      {
        "id": 2,
        "text": "Nigella sativa"
      },
      {
        "id": 3,
        "text": "Datura seeds"
      },
      {
        "id": 4,
        "text": "Opium seeds"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The seeds shown in the given image are of the plant&nbsp;<strong>Nigella sativa. </strong>These are also known as black cumin or kalonji.</p>\n<p>The seeds are the most commonly used parts of the plant in traditional medicine. Seeds have a pungent and bitter taste with a considerable amount of oil inside.&nbsp;The seeds are used as a spice in cooking. They are also used as a food preservative and the most often used therapeutic agent is its oil.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c551088f46c408a88dbb9446552c079.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old boy presents with the following injury that he sustained on being tackled by an opponent during the course of a football match. As the Casualty medical officer, you would enter the wound description in the case sheet as ____________________",
    "choices": [
      {
        "id": 1,
        "text": "Incised wound"
      },
      {
        "id": 2,
        "text": "Abrasion"
      },
      {
        "id": 3,
        "text": "Laceration"
      },
      {
        "id": 4,
        "text": "Bruise"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows<strong>&nbsp;a laceration.</strong></p>\n<p>A laceration is a tear or a split in the skin, mucous membrane, muscle, or any internal organ, with a depth spanning more than the covering epithelium of the skin or an organ, and is produced by blunt force.</p>\n<p>Features of laceration:</p>\n<ul>\n<li>Margins are irregular with pieces of tissue attached in between called <strong>tissue tags or bridges</strong></li>\n<li><strong>Bruising </strong>is&nbsp;seen around the margin</li>\n<li>Deeper tissues are unevenly divided with tissue tags</li>\n<li>Hair bulbs are crushed</li>\n<li>Depth of the wound contains abundant foreign material such as dust particles, paint material of the vehicle involved, etc</li>\n<li>In skin lacerations, usually one of the margins overhangs the other, which could help in assessing the direction of the force</li>\n<li>A laceration, on healing, produces a permanent scar.</li>\n</ul>\n<p>Classification of a laceration:</p>\n<ul>\n<li><strong>Split laceration (incised - like laceration)</strong>\n<ul>\n<li>This occurs when the skin is <strong>crushed between two hard objects</strong></li>\n<li>For example, during a fall, the scalp gets crushed between the skull from inside and hard ground outside. This results in a wound, which usually mimics an incised one unless examined closely.</li>\n</ul>\n</li>\n<li><strong>Stretch laceration</strong>\n<ul>\n<li>As the name implies, it occurs due to the <strong>over-stretching of the skin</strong>, beyond its elasticity.</li>\n<li>This typically occurs in the setting of a fractured femur, where the fracture fragment may stretch and pierce the skin to project out</li>\n</ul>\n</li>\n<li><strong>Avulsed laceration</strong>\n<ul>\n<li>An avulsion is a lesion where the <strong>skin only separates</strong> by tearing from the underlying tissues or <strong>peels off</strong> and overhangs the wound</li>\n<li>This is common in road traffic accidents.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d215022770134c968161437df4077395.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are posted as an intern in casualty when an MLC case is brought by the police with the following appearance. She was declared brought dead. What would you mark as the likely cause of death before sending the patient for postmortem?",
    "choices": [
      {
        "id": 1,
        "text": "Drowning"
      },
      {
        "id": 2,
        "text": "Hanging"
      },
      {
        "id": 3,
        "text": "Strangulation"
      },
      {
        "id": 4,
        "text": "Traumatic asphyxia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>frothing from nostrils</strong> and no clear signs of facial or conjunctival congestion. It is likely a case of <strong>drowning.</strong></p>\n<p>Frothing may also be seen in throttling or strangulation, but it might be associated with signs of conjunctival congestion, facial congestion, patterned bruise on neck etc. In the absence of these features, it is unlikely to be caused by strangulation.&nbsp;</p>\n<p>Traumatic asphyxia is unlikely as the face of this patient is all whitened without signs of congestion or any obvious signs of trauma</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/658bd37d0bb5486fa338289db643291d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the approximate age of a person in whom the medial end of the clavicle is fused and also the  sternum is completely fused",
    "choices": [
      {
        "id": 1,
        "text": "<18 years"
      },
      {
        "id": 2,
        "text": "18-22 years"
      },
      {
        "id": 3,
        "text": "22-25 years"
      },
      {
        "id": 4,
        "text": ">25 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Approximate age for the given person with fused medial end of clavicle and completely fused sternum is most likely &gt;25 years.</p>\n<table style=\"height: 130px;\" width=\"347\">\n<tbody>\n<tr>\n<td style=\"width: 165px;\">Age</td>\n<td style=\"width: 166px;\">Age determination</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">&lt;5 years</td>\n<td style=\"width: 166px;\">The appearance of ossification centers</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">5-16 years</td>\n<td style=\"width: 166px;\">Analysis of hand and wrist</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">&gt;16 years(male)</td>\n<td style=\"width: 166px;\">Complete fusion of distal radius or ulna</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\"><span style=\"text-decoration: underline;\">&gt;</span>16 years(female)</td>\n<td style=\"width: 166px;\">Complete fusion of distal ulna</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\"><span style=\"text-decoration: underline;\">&gt;</span>18 years(male)</td>\n<td style=\"width: 166px;\">Complete fusion of distal femur or proximal tibia</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\"><span style=\"text-decoration: underline;\">&gt;</span>18 years(female)</td>\n<td style=\"width: 166px;\">Complete fusion of iliac crest</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">&gt;21 years</td>\n<td style=\"width: 166px;\">Complete fusion of medial end of clavicle</td>\n</tr>\n</tbody>\n</table>\n<p>The sternum is formed from the fusion of Manubrium, 4 sternebrae(body), and the xiphoid process. The fusion of sternebrae occurs from below upwards, followed by its fusion to the xiphoid process and then fusion of manubrium to the fused sternum.</p>\n<table>\n<tbody>\n<tr>\n<td>Manubrio-sternal joint</td>\n<td>60-70 years</td>\n</tr>\n<tr>\n<td>1st and 2nd Sternebrae</td>\n<td>25 years&nbsp;</td>\n</tr>\n<tr>\n<td>2nd and 3rd sternebrae</td>\n<td>20 years</td>\n</tr>\n<tr>\n<td>3rd and 4th sternebrae</td>\n<td>15 years</td>\n</tr>\n<tr>\n<td>Xiphoid process and body</td>\n<td>40-45 years</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condition shown in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Postmortem lividity"
      },
      {
        "id": 2,
        "text": "Marbling"
      },
      {
        "id": 3,
        "text": "Filigree burns"
      },
      {
        "id": 4,
        "text": "Subcutaneous emphysema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows postmortem <strong>marbling</strong>. It is a visible postmortem change that is characterized by linear branching patterns on skin that correspond to the course of superficial veins.</p>\n<p>Intestinal bacteria infest the venous system as blood acts as a nutrient medium for their proliferation. There is subsequent hemolysis which stains the vessel walls and the adjacent tissues, giving rise to <strong>marbling</strong>. This becomes prominent in about&nbsp;<strong>36&ndash;48 hours</strong>&nbsp;after death in the summer and is distinctly appreciable in the superficial veins of the abdomen, shoulders, chest, and inguinal region.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf724167a1e74cee97dbe9b715268b64.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the image shown below",
    "choices": [
      {
        "id": 1,
        "text": "Shot gun wound"
      },
      {
        "id": 2,
        "text": "Tattooing"
      },
      {
        "id": 3,
        "text": "Arsenic poisoning"
      },
      {
        "id": 4,
        "text": "Graze wound"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows entry wound of a shot gun from a mid-range or long distance.</p>\n<ul>\n<li>There is a <strong>central round hole,</strong> with <strong>multiple pellet holes</strong> scattered around the central hole.&nbsp;</li>\n<li>This wound is most likely to have been caused by a shotgun from a range of<strong> 1-5 m.</strong></li>\n</ul>\n<p>Following are the appearances of shot gun entry wound from different distance:</p>\n<p>Appearance of shotgun entry wounds at different ranges:</p>\n<p>Contact shot</p>\n<ul>\n<li>Soft tissues - single circular wound about the diameter of the muzzle with muzzle imprint and no soot soiling, tattooing, singeing.</li>\n<li>Bone - same as with soft tissues, but wound may be ragged and split because of gas rebound.</li>\n</ul>\n<p>&lt;30 cm</p>\n<ul>\n<li class=\"p1\">Circular wound with surrounding soot soiling.</li>\n<li class=\"p1\">Burnt hairs (singeing).</li>\n<li class=\"p1\">Punctate skin lesions from powder particles (tattooing).</li>\n</ul>\n<p>30cm - 1m</p>\n<ul>\n<li class=\"p1\"><strong>Circular rat-hole wound.</strong></li>\n<li class=\"p1\">Soot soiling.</li>\n<li class=\"p1\">Powder tattooing.</li>\n</ul>\n<p>1 - 5 meters</p>\n<ul>\n<li class=\"p1\"><strong>Central rat-hole wound.</strong></li>\n<li class=\"p1\">No soot, tattooing +/-.</li>\n<li class=\"p1\">Satellite pellet holes around the periphery.</li>\n</ul>\n<p>&gt;5 meters</p>\n<ul>\n<li>Diffuse pellet pattern</li>\n<li>No central hole, no soot soiling, tattooing, singeing.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0614a84992604a69a6bf986a252957de.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44784d9eba994d2895be6a4d4f0730b6x1279x1246.JPEG"
    ]
  },
  {
    "text": "A 22-year-old woman was found dead at home. She was brought to the mortuary by the police and the following findings were noted on examination. Which of the following is the likely cause of her death?",
    "choices": [
      {
        "id": 1,
        "text": "Strangulation by ligature"
      },
      {
        "id": 2,
        "text": "Hanging"
      },
      {
        "id": 3,
        "text": "Throttling"
      },
      {
        "id": 4,
        "text": "Drowning"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given case scenario and autopsy images showing <strong>carotid intimal tear</strong> and <strong>muscle hematoma</strong> with <strong>nail marks</strong> on neck and <strong>absence of ligature mark</strong> point towards a diagnosis of <strong>throttling</strong>.</p>\n<p>Other options</p>\n<p>Option A-<strong> Strangulation by ligature</strong> - ligature mark with signs of a struggle would've made this diagnosis more likely.</p>\n<p>Option B- <strong>Hanging</strong> - ligature mark with a suicide note would've made it more likely.</p>\n<p>Option C-<strong> Drowning</strong>- Body recovered from a pond or other water body with other suggestive features like frothing etc&nbsp; would've made this more likely.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/05da8e141e634bd9b17c3e05823b34ba.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is seen in freshwater drowning?",
    "choices": [
      {
        "id": 1,
        "text": "A,B,C,D"
      },
      {
        "id": 2,
        "text": "A,B,C"
      },
      {
        "id": 3,
        "text": "B,C,D"
      },
      {
        "id": 4,
        "text": "A,C,D"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In cases of <strong>freshwater drowning</strong>, <strong>hyperkalemia</strong> is seen due to <strong>hemolysis of swollen RBCs</strong> and not hypokalemia.</p>\n<p><strong>Freshwater is hypotonic</strong> to plasma and is rapidly absorbed from the alveoli and into the RBCs. The RBCs finally swell up and lyse resulting in the release of intracellular potassium causing hyperkalemia. Increased intravascular blood volume combined with hyperkalemia causes arrhythmia.&nbsp;</p>\n<p><strong>Seawater is hypertonic</strong> to plasma and causing a shift of fluid from the blood to alveoli causing pulmonary edema. There is a net decrease in blood volume causing a fall in blood pressure.</p>\n<p>The table below summarises the cause of death in different types of drowning.</p>\n<table style=\"width: 319px; height: 400px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 129.132px; text-align: center; height: 18px;\"><strong>Type of drowning</strong></td>\n<td style=\"width: 175.799px; height: 18px;\"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cause of death</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 129.132px; height: 36px;\">\n<p>Freshwater drowning</p>\n<p>Seawater drowning</p>\n</td>\n<td style=\"width: 175.799px; height: 36px;\">Disruption of surfactant&nbsp;</td>\n</tr>\n<tr style=\"height: 69px;\">\n<td style=\"width: 129.132px; height: 69px;\">\n<p>Dry drowning</p>\n</td>\n<td style=\"width: 175.799px; height: 69px;\">Laryngeal spasm/Vagal inhibition</td>\n</tr>\n<tr style=\"height: 118px;\">\n<td style=\"width: 129.132px; height: 118px;\">Post immersion Syndrome / Secondary drowning</td>\n<td style=\"width: 175.799px; height: 118px;\">\n<ul>\n<li>Cerebral anoxia</li>\n<li>Pneumonia</li>\n<li>Pulmonary edema</li>\n<li>Chemical pneumonitis</li>\n<li>Metabolic acidosis</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following weapons with the possible injuries caused by them:",
    "choices": [
      {
        "id": 1,
        "text": "A-4, B-3, C-1, D-2"
      },
      {
        "id": 2,
        "text": "A-1, B-3, C-4, D-2"
      },
      {
        "id": 3,
        "text": "A-1, B-2, C-4, D-3"
      },
      {
        "id": 4,
        "text": "A-4, B-1, C-3, D-2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;</p>\n<p>The image below shows production of a tramline bruise associated with a lathi strike:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d1453ad8ebf45c9a2fbde658ffa8114x720x740.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8266b626853a49379445990a032a0d6cx1280x610.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3148f3dbf02642c788cbc8d8cd711c3bx600x439.JPEG"
    ]
  },
  {
    "text": "You are working as a medical officer at a PHC. A 17-year-old girl presents to you after an alleged sexual assault, the girl refuses physical examination. Which of the following steps would you take to proceed in this case?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 3"
      },
      {
        "id": 2,
        "text": "2, 3 and 5"
      },
      {
        "id": 3,
        "text": "1, 2 and 5"
      },
      {
        "id": 4,
        "text": "2 and 3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario, you need to <strong>start treatment for STI</strong>, inform the <strong>police</strong>, and record <strong>refusal of consent</strong> for examination.</p>\n<p>Examination of a sexual assault victim shouldn't be forced upon, but an informed refusal is to be <strong>documented</strong> after explaining to them the consequences of choice.</p>\n<p>Medical treatment and testing for pregnancy have to be done for all victims of sexual assault free of cost and police should be informed as per <strong>Section 397 of BNSS</strong> (<strong>357-C</strong> of CrPc).</p>\n<p>As the girl is under 18 years of age, as per <strong>POCSO</strong> (The Protection of Children from Sexual Offences) act 2012, the medical practitioner should initiate treatment for exposure to sexually transmitted diseases (STDs) including prophylaxis for identified STDs (including HIV if suspected) and possible pregnancy and emergency contraceptives should be discussed with the victim and her parent/guardian.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following poisons with their probable mechanism of action:\nA. Zinc chloride\nB. Chloral hydrate\nC. Quinine\nD. Potassium carbonate\n1.Abortifacient\n2. Irritant\n3. Corrosive\n4. Stupefying",
    "choices": [
      {
        "id": 1,
        "text": "A-2, B-4, C-1, D-3"
      },
      {
        "id": 2,
        "text": "A-4,B-3, C-2,D-1"
      },
      {
        "id": 3,
        "text": "A-4, B-2, C-1,D-3"
      },
      {
        "id": 4,
        "text": "A-2, B-3, C-4,D-1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>For the above-given options, the correct match is given as&nbsp;</p>\n<table>\n<tbody>\n<tr>\n<td>Poison</td>\n<td>Mechanism</td>\n</tr>\n<tr>\n<td>A.Zinc Chloride</td>\n<td>2. Irritant</td>\n</tr>\n<tr>\n<td>B.Chloral hydrate</td>\n<td>4. Stupefying</td>\n</tr>\n<tr>\n<td>C. Quinine</td>\n<td>1. Abortifacient</td>\n</tr>\n<tr>\n<td>D.Potassium<br />carbonate</td>\n<td>3. Corrosive</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Rationale for the classification</strong></p>\n<p><strong>Zinc chloride</strong> also known as butter of zinc is <strong>highly irritant</strong> to the eyes on topical application. It can cause erosive esophagitis on ingestion. It has a fatal dose of 350mg. It could've also been classified as a corrosive, but since potassium carbonate is an alkali with stronger corrosive action, it is better classified as an irritant for this question</p>\n<p><strong>Chloral hydrate</strong> is a <strong>CNS depressant</strong>. It is also known as <strong>knockout drops</strong> because of its rapid action and used in robbery or rape to quickly render the victim helpless.</p>\n<p><strong>Quinine</strong> is a <strong>cardiotoxic drug</strong> with the additional action of being an <strong>abortifacient</strong>. It's overdose may lead to an echolic action (contract the pregnant uterus)</p>\n<p><strong>Potassium carbonate</strong> is a <strong>caustic alkali</strong> with a predominant action of <strong>corrosive</strong> due to its high pH.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '109 Forensic Medicine Aiims 2020 (May And Nov Ini-Cet)';
        let hierarchy = ["Marrow", "PYQs", "Forensic Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>