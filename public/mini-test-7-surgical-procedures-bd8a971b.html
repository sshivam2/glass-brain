<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test- 7 (Surgical Procedures) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 62-year-old woman was admitted with a retrosternal goiter, which had been discovered during an evaluation for chest discomfort and dyspnea. After routine investigations, including fine needle aspiration cytology (FNAC) and imaging, the surgical team determined she is at high risk of requiring conversion from a transcervical approach to a median sternotomy. Which of the following conditions would not justify the need for a median sternotomy in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Goiter extending into the posterior mediastinum"
      },
      {
        "id": 2,
        "text": "Invasive retrosternal thyroid malignancy"
      },
      {
        "id": 3,
        "text": "Diameter of goiter > Diameter of thoracic inlet"
      },
      {
        "id": 4,
        "text": "Goiter extending up to the superior margin of the aortic arch"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A goiter extending up to the superior margin of the aortic arch is <strong>not</strong> a high risk for conversion into open sternotomy. Goiters that extend below the inferior margin of the aortic arch are at high risk of conversion to median sternotomy.</p>\n<p><strong>Retrosternal goiter</strong>\u00a0is an extension of the multinodular goiter into the mediastinum. It receives its blood supply from the <strong>inferior thyroid arteries</strong>\u00a0and venous drainage through the <strong>inferior thyroid veins.\u00a0</strong>This condition is usually asymptomatic and may not require surgery.\u00a0If the gland enlarges within the thoracic inlet, the pressure may lead to dysphagia, tracheal compression, and eventually airway symptoms. But the majority of retrosternal goiters are asymptomatic or show very few symptoms.</p>\n<p>Patients considered for surgery :</p>\n<ul>\n<li>Significant airway compression</li>\n<li>Symptoms are present</li>\n<li>In young patients in whom symptoms are likely to develop</li>\n</ul>\n<p>Elderly patients where retrosternal goiters are incidentally found, it observed rather than treated.</p>\n<p>&gt;95% of retrosternal goiters can be removed through the transcervical approach.</p>\n<p>Retrosternal goiters that are at most risk of requiring conversion to an open sternotomy approach :</p>\n<ul>\n<li>Malignant cases</li>\n<li>Revision cases</li>\n<li>Goiters extending into the posterior mediastinum</li>\n<li>Diameter of the goiter exceeding that of the thoracic inlet</li>\n<li>Goiters that reach the carina</li>\n<li>Goiters that extend below the inferior margin of the aortic arch</li>\n</ul>\n<p>If the gland is fixed and immobile or too large to deliver through a cervical approach, a midline sternotomy is performed and the gland can be dissected from below to achieve a safe total thyroidectomy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was brought following blunt abdominal trauma. On examination, he was hemodynamically stable. Contrast-enhanced CT (CECT) showed splenic trauma with a subcapsular hematoma over 30% of the surface area. Angiography and embolization were done but failed to achieve hemostasis. Which of the following is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Repeat angiography and embolization"
      },
      {
        "id": 2,
        "text": "Conservative management with monitoring"
      },
      {
        "id": 3,
        "text": "Splenectomy"
      },
      {
        "id": 4,
        "text": "Splenorrhaphy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The next step in management is <strong>splenorrhaphy</strong>.&nbsp;</p>\n<p>The <strong>non-expanding subcapsular hematoma</strong> over <strong>30% of the surface area</strong> is suggestive of <strong>grade II splenic injury</strong>. These patients are managed by <strong>angiography</strong> and <strong>embolization,</strong> and if it fails, the next step in management is a spleen-saving technique or <strong>splenorrhaphy</strong>.</p>\n<p><strong>Splenorrhaphy&nbsp;</strong>is a procedure done to preserve the spleen parenchyma. These involve all the surgical procedures done to save the spleen parenchyma while splenectomy is the entire surgical removal of the viscera. Splenorrhaphy should not be performed if the patient is unstable if there are multiple injuries or extensive splenic injury.&nbsp;</p>\n<p><strong>Grades of splenic injury</strong>:</p>\n<table style=\"width: 368.425px;\">\n<tbody>\n<tr>\n<td style=\"width: 52px;\">Grade</td>\n<td style=\"width: 300.425px;\">Injury</td>\n</tr>\n<tr>\n<td style=\"width: 52px;\">I</td>\n<td style=\"width: 300.425px;\">Non-expanding subcapsular hematoma (&lt;10% of surface area) or laceration, &lt;1 cm of parenchymal depth</td>\n</tr>\n<tr>\n<td style=\"width: 52px;\"><strong>II</strong></td>\n<td style=\"width: 300.425px;\">Non-expanding subcapsular hematoma (<strong>10-50% of surface area</strong>) or laceration, 1-3 cm of parenchymal depth which does not involve the trabecular vessels</td>\n</tr>\n<tr>\n<td style=\"width: 52px;\">III</td>\n<td style=\"width: 300.425px;\">\n<p>Hematoma &gt; 50% of surface area or expanding</p>\n<ul>\n<li>Ruptured subcapsular or parenchymal hematoma,</li>\n<li>Intraparenchymal hematoma &gt;5 cm or expanding Or<br /> Laceration, &gt;3 cm parenchymal depth or involving<br /> trabecular vessels</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 52px;\">IV</td>\n<td style=\"width: 300.425px;\">Laceration involving segmental or hilar vessels leading to major devascularization (&gt;25% of the spleen)</td>\n</tr>\n<tr>\n<td style=\"width: 52px;\">V</td>\n<td style=\"width: 300.425px;\">Shattered spleen<br /> or<br />A hilar vascular injury that devascularizes the spleen.</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Management of splenic trauma:</strong></p>\n<p><strong>Grade I and II injuries:</strong></p>\n<p>They are usually hemodynamically stable and are managed non-operatively. Initially, these patients are managed conservatively with regular monitoring of vitals, hematocrit, and serial CECT.</p>\n<p>If the grade of injury is found to increase, then <strong>angiography</strong> and <strong>embolization</strong> of the bleeding vessel are done to achieve hemostasis. If angiography and embolization fail to achieve hemostasis, or if the patient becomes hemodynamically unstable, then a <strong>splenorrhaphy</strong> is done.</p>\n<p><strong>Grade III injuries</strong> that are hemodynamically stable are managed like that of grades I and II, while those that are hemodynamically unstable are managed like that of grades IV and V.</p>\n<p><strong>Grade IV and V injuries patients&nbsp;</strong>are usually hemodynamically unstable and splenectomy is done.</p>\n<p>Other options:&nbsp;</p>\n<p>Option A: <strong>Repeat angiography and embolization</strong> are unlikely to help as it has already failed once in this patient.&nbsp;</p>\n<p>Option B: <strong>Conservative management</strong> will not stop the ongoing hemorrhage that is present in this patient. It is useful in patients who are no longer bleeding.&nbsp;</p>\n<p>Option C: <strong>Splenectomy</strong> is not required in this patient as they have a grade II injury and are still hemodynamically stable.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is planned for surgical correction of simple congenital ptosis. He has poor levator function. What is the appropriate treatment in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Levator resection"
      },
      {
        "id": 2,
        "text": "Frontalis sling suspension"
      },
      {
        "id": 3,
        "text": "Fasanella-Servat operation"
      },
      {
        "id": 4,
        "text": "Mullerectomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Frontalis sling&nbsp;suspension</strong>&nbsp;is the treatment of choice for&nbsp;<strong>congenital ptosis</strong> with <strong>poor levator function</strong>.</p>\n<p>Ptosis refers to the drooping of the upper eyelid such that it covers more than 2 mm of the superior cornea. It may be congenital or acquired.</p>\n<p><strong>Congenital Ptosis</strong> may be classified as:</p>\n<ul>\n<li>Simple - isolated abnormality</li>\n<li>Complicated -associated with ocular motor anomalies, blepharophimosis syndrome, and Marcus Gunn ptosis.</li>\n</ul>\n<p>When the levator function is poor (3 mm or less), the eyelid is suspended from the frontalis muscle using sutures, a fascia lata sling, or a silicone band.&nbsp;Infection of the suture bed is a complication of this surgery and the suture should be monitored.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old primigravida at 39 weeks in active labor requires an episiotomy as the fetal head crowns. The incision is made at a 45-degree angle to the midline. Post-delivery, the patient reports minimal pain. What is the most likely reason for choosing a mediolateral episiotomy over a midline episiotomy in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Reduced risk of excessive bleeding"
      },
      {
        "id": 2,
        "text": "Faster healing time compared to midline episiotomy"
      },
      {
        "id": 3,
        "text": "Greater protection against involving the anal sphincter"
      },
      {
        "id": 4,
        "text": "Increased patient comfort during the procedure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The obstetrician did a <strong>mediolateral episiotomy </strong>because<strong> </strong>there is <strong>greater protection </strong>against involving the <strong>anal sphincter </strong>in a mediolateral episiotomy.</p>\n<p>An <strong>episiotomy</strong> is an <strong>intended incision</strong> of the <strong>perineum</strong> with the goal of enlargement of the vaginal opening for birth. Prior to episiotomy, analgesia is provided by existing labor regional analgesia, <strong>bilateral pudendal nerve block</strong>, or local infiltration with 1% lignocaine. Typically, an episiotomy is <strong>completed</strong> <strong>when</strong> the <strong>head is visible</strong> during a contraction to a diameter of 4 to 5 cm.</p>\n<p><strong>Midline episiotomy</strong> begins at the fourchette, incises the perineal body in the midline, and ends well before the external anal sphincter. Mediolateral episiotomy begins at the midline of the fourchette and is <strong>directed to the right or left at an angle of 60 degrees</strong> off the midline. This angle accounts for the stretch distortion of the perineal anatomy during crowning. After delivery and resolution of the distortion, it ultimately yields an incision 45 degrees from the midline for suturing.</p>\n<table style=\"height: 173px; width: 407px;\">\n<tbody>\n<tr style=\"height: 30px;\">\n<td style=\"width: 181px; height: 30px;\"><strong>Midline episiotomy</strong></td>\n<td style=\"width: 210px; height: 30px;\"><strong>Mediolateral episiotomy</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 181px; height: 18px;\">Surgical repair is easy</td>\n<td style=\"width: 210px; height: 18px;\">Surgical repair is <strong>difficult</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 181px; height: 18px;\">Blood loss is less</td>\n<td style=\"width: 210px; height: 18px;\">Blood loss is<strong> more</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 181px; height: 18px;\">Healing is superior</td>\n<td style=\"width: 210px; height: 18px;\">Healing is not so good</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 181px; height: 36px;\">Dyspareunia is rare</td>\n<td style=\"width: 210px; height: 36px;\">Dyspareunia is comparatively <strong>more</strong></td>\n</tr>\n<tr style=\"height: 57.375px;\">\n<td style=\"width: 181px; height: 57.375px;\">\n<p class=\"p1\">Postoperative pain is less</p>\n</td>\n<td style=\"width: 210px; height: 57.375px;\">\n<p class=\"p1\">Postoperative pain is <strong>more</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 181px; height: 64px;\">\n<p class=\"p1\">Extension, if occurs, may involve the anal sphincter</p>\n</td>\n<td style=\"width: 210px; height: 64px;\">\n<p class=\"p1\">Extension, even if it occurs, will <strong>not involve the anal sphincter</strong></p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6e5971d8efba460fb2a9049edab92d8b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a possible complication of this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Abortion"
      },
      {
        "id": 2,
        "text": "Placental abruption"
      },
      {
        "id": 3,
        "text": "Postpartum hemorrhage"
      },
      {
        "id": 4,
        "text": "Intrauterine growth restriction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The procedure shown in the image is <strong>chorionic villus sampling (CVS).</strong><strong>\u00a0Abortion </strong>is a possible complication of the procedure.</p>\n<p>Chorionic villus sampling:<br />Study material: Chorionic villi from trophoblastic cells of <strong>chorion frondosum</strong><br />Time: 10 to 13 weeks (transcervically), 10 weeks to term (transabdominally)</p>\n<p>The best time to perform chorionic villus sampling is<strong> 11\u201313 weeks</strong>.</p>\n<p>Indications</p>\n<ul>\n<li>To detect <strong>chromosomal abnormalities</strong> such as Down syndrome.</li>\n<li>To detect <strong>inborn errors of metabolism</strong> like phenylketonuria.</li>\n<li>For <strong>DNA analysis</strong> in hemoglobinopathies, thalassemia, and sickle cell anemia.</li>\n</ul>\n<p>Complications: <strong>Abortion</strong> (CVS&gt; Amniocentesis), <strong>limb reduction defects</strong> and <strong>oro-mandibular defects</strong> (when done before 10 weeks)</p>\n<p>Drawback: Not suitable for the detection of neural tube defects.</p>\n<p>Below is an image showing the procedure of amniocentesis vs chorionic villus sampling.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5530dd21f9c4501928f01ee87d1acb1.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b254bbad07f04e35bfd9db5d9c9acdecx1280x3002.JPEG"
    ]
  },
  {
    "text": "A boy diagnosed with acute otitis media 1 week back, presents with fever, post-auricular pain (image shown), and purulent discharge from his ear. There is mastoid tenderness and the meatus immediately fills with pus when it's cleaned. What is the definitive management for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cortical mastoidectomy"
      },
      {
        "id": 2,
        "text": "IV Antibiotics and observation"
      },
      {
        "id": 3,
        "text": "Myringotomy"
      },
      {
        "id": 4,
        "text": "Radical mastoidectomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The definitive management of this child who presented with <strong>acute mastoiditis</strong> and has a<strong> positive reservoir sign</strong> is a <strong>cortical mastoidectomy</strong>.</p>\n<p><strong>Mastoiditis </strong>involves inflammation and infection of the mastoid air cells and often follows <strong>acute otitis media</strong>. It is characterized by symptoms such as <strong>fever</strong>, <strong>postauricular pain </strong>and\u00a0<strong>tenderness</strong>, <strong>swelling</strong>, and <strong>ear discharge.</strong> A diagnosis can be made through clinical examination, imaging studies like CT scans, and culture of ear discharge to identify causative organisms.</p>\n<p>Initial <strong>treatment</strong> includes<strong> antibiotics</strong>, but when these and other conservative measures fail, and symptoms persist or worsen, surgical intervention is necessary to prevent further <strong>complications</strong> such as <strong>subperiosteal abscesses</strong>, <strong>facial nerve paralysis</strong>, and <strong>intracranial spread</strong>. A <strong>cortical mastoidectomy</strong>, which involves removing the infected air cells within the mastoid bone, draining abscesses, and ensuring adequate aeration of the mastoid cavity, is often the <strong>first surgical step </strong>aimed at eradicating infection and preventing further complications.\u00a0</p>\n<p><strong>Indications for Cortical Mastoidectomy:</strong></p>\n<ul>\n<li>Presence of a subperiosteal abscess</li>\n<li>Sagging of the posterosuperior meatal wall</li>\n<li><strong>Positive reservoir sign</strong> (meatus immediately fills with pus after it has been mopped out)</li>\n<li>Lack of improvement or worsening of symptoms despite adequate antibiotic treatment for 48 hours</li>\n<li>Development of complications from mastoiditis, such as:</li>\n<li>Facial paralysis</li>\n<li>Labyrinthitis</li>\n<li>Intracranial complications (e.g., meningitis, brain abscess)</li>\n</ul>\n<p>Other Options:</p>\n<p>Option B: While <strong>IV antibiotics</strong> are initially used, the severity and persistence of symptoms in this case require surgical intervention to prevent further complications.</p>\n<p>Option C: <strong>Myringotomy</strong> involves creating an incision in the tympanic membrane to drain middle ear fluid. It is a less invasive procedure often used in <strong>early </strong>or <strong>uncomplicated cases</strong> but insufficient for advanced mastoiditis.</p>\n<p>Option D:<strong> Radical mastoidectomy</strong> is a more extensive procedure involving the removal of more structures within the mastoid and middle ear. It is typically reserved for <strong>chronic</strong> or <strong>recurrent cases</strong> where less invasive surgeries have failed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7bd83c52c7084a3f87da673e14fc6677.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A surgical consultation is requested for a neonate currently in the neonatal intensive care. On examination, the following findings were found along with a bifid uvula. Which of the following is the most appropriate management in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Cleft lip repair immediately"
      },
      {
        "id": 2,
        "text": "Cleft soft palate repair at 9 to 12 months"
      },
      {
        "id": 3,
        "text": "Cleft lip and soft palate repair at 5 to 6 months"
      },
      {
        "id": 4,
        "text": "Cleft soft and hard palate repair at 12-15 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most appropriate management for this patient would be <strong>cleft lip and soft palate repair at 5 to 6 months</strong>.&nbsp;As the neonate in question has a <strong>unilateral right-sided cleft lip along with cleft hard and soft palate</strong>, the appropriate management for this patient would be (two separate procedures):</p>\n<ol>\n<li style=\"font-weight: 400;\">Cleft lip and soft palate repair at <strong>5 to 6 months,</strong> followed by&nbsp;</li>\n<li style=\"font-weight: 400;\">Hard palate repair with or without a revision surgery for the lip and soft palate at <strong>15 to 18 months</strong>.</li>\n</ol>\n<p><strong>The different types of facial clefts are shown below:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b15081bc459c4fa79a2ced696123e285.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/364b499ac1cf4032820cae789aab36dex600x336.JPEG"
    ]
  },
  {
    "text": "You are a resident doctor in the General Surgery Department of a Hospital. You have been given the task of arranging the following surgeries to be posted for tomorrow\u2019s Operation Theatre. Which of the following surgeries will you post first in the OT list",
    "choices": [
      {
        "id": 1,
        "text": "Breast abscess I & D"
      },
      {
        "id": 2,
        "text": "Elective appendicectomy"
      },
      {
        "id": 3,
        "text": "Elective cholecystectomy"
      },
      {
        "id": 4,
        "text": "Right hemithyroidectomy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Right hemithyroidectomy</strong> is a <strong>Clean Procedure</strong> and hence shall occupy the <strong>first position</strong> in the given list of surgeries.</p>\n<p><strong>Cleaner surgeries </strong>are posted first in the OT list.</p>\n<p><strong>Clean Procedures</strong></p>\n<ul>\n<li><strong>CABG, Thyroid Sx, Breast Sx</strong> ( except abscess), Knee Replacement</li>\n</ul>\n<p><strong>Clean contaminated\u00a0</strong></p>\n<ul>\n<li>Gastrointestinal or genitourinary system <strong>without inflammation</strong>\u00a0</li>\n<li>Eg: Elective appendicectomy, Elective cholecystectomy</li>\n</ul>\n<p><strong>Contaminated procedures\u00a0</strong></p>\n<ul>\n<li>GI / GU system with <strong>Non purulent</strong> <strong>inflammation</strong>\u00a0\u00a0</li>\n<li>Eg Same as above in an emergency setting</li>\n</ul>\n<p><strong>Dirty wounds\u00a0</strong></p>\n<ul>\n<li><strong>Pus </strong>present , Peritonitis , <strong>Traumatic wound</strong> not managed for &gt; 6 hrs</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old female who has an anal fistula is advised for surgery. She browsed about the surgical procedures and came to know that a few procedures may lead to fecal incontinence. She was worried and asks you about the surgeries that does not lead to this complication. Which among the following surgeries allow sphincter preservation?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 4, and 5"
      },
      {
        "id": 2,
        "text": "1, 2, and 4 Only"
      },
      {
        "id": 3,
        "text": "1, 3, and 5 only"
      },
      {
        "id": 4,
        "text": "3 and 5 only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Out of the given options, <strong>1, 2, 3, 4, </strong>and <strong>5</strong> surgeries allow sphincter preservation. The surgeries for anal fistula that allow sphincter preservation are:</p>\n<ul>\n<li><strong>Ligation of intersphincteric fistula tract.</strong></li>\n<li><strong>Flap advancement.</strong></li>\n<li><strong>Over-the-scope clip.</strong></li>\n<li><strong>Video-assisted anal fistula treatment (VAAFT)</strong></li>\n<li><strong>Fistula tract laser closure (FiLaC)</strong></li>\n</ul>\n<p><strong>Ligation of the intersphincteric fistula tract</strong> (LIFT) is done at the level of the <strong>intersphincteric plane</strong> where the internal opening and fistula are\u00a0disconnected. This is followed by the removal of the residual gland without involving the sphincter complex.</p>\n<p><strong>Flap advancement</strong> is done for the tracts that are not\u00a0indurated and adequate intra-anal access can be obtained. The <strong>internal opening</strong> of the fistula is closed with a <strong>well-vascularized flap</strong> of anorectal mucosa. This procedure aims at <strong>preserving</strong> the <strong>anatomy</strong> and <strong>function</strong> of the sphincter.</p>\n<div class=\"page\" title=\"Page 1461\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Over-the-scope</strong> procedure involves using a <strong>nitinol clip</strong> and closing the internal opening and disconnecting the external tract. Clip migration and elective removal because of pain are the main complications.</p>\n<div class=\"page\" title=\"Page 1461\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Video-assisted anal fistula treatment</strong> (VAAFT) and<strong> fistula tract laser</strong> <strong>closure</strong> (FiLaC) are other procedures that allow sphincter preservation.</p>\n<p>A<strong> fistulotomy\u00a0</strong>is preferred mainly for\u00a0<strong>intersphincteric fistulae </strong>and<strong> trans-sphincteric fistulae. </strong>Here, all\u00a0structures lying between the external and internal openings are divided. In\u00a0<strong>fistulectomy</strong>, the entire fistula tract is removed by diathermy cautery.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are assisting in a tubal sterilization procedure where the senior resident performs the following technique. This procedure is known as:",
    "choices": [
      {
        "id": 1,
        "text": "Pomeroy's procedure"
      },
      {
        "id": 2,
        "text": "Kroener's technique"
      },
      {
        "id": 3,
        "text": "Irving's procedure"
      },
      {
        "id": 4,
        "text": "Uchida's method"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The sterilization procedure shown in the above image is\u00a0<strong>Irving's procedure</strong>. It involves ligating and <strong>excising the mid-portion</strong> of the tube after which<strong>\u00a0</strong>the<strong> proximal stump</strong> is<strong> buried into the myometrium</strong>. The <strong>distal stump</strong> is buried in the <strong>broad ligament</strong>.</p>\n<p>It is often done in conjunction with caesarian sections. It is a<strong>\u00a0reliable method</strong>\u00a0of sterilization, but\u00a0<strong>not a reversible</strong>\u00a0technique and may require a laparotomy incision.</p>\n<p>Other methods of sterilization include:</p>\n<p>1. Laparotomy/Minilaparotomy:</p>\n<ul>\n<li><strong>Pomeroy's procedure</strong>: The fallopian tube is identified on each side, brought out through the incision, and the middle portion is formed into a\u00a0<strong>loop</strong>\u00a0which is tied at the base with catgut and\u00a0<strong>excised</strong>. It is surgically\u00a0<strong>reversible.<br /></strong></li>\n<li><strong>Madlener's procedure:</strong>\u00a0A loop of the fallopian tube is\u00a0<strong>crushed</strong>\u00a0and then ligated with a nonabsorbable suture.</li>\n<li><strong>Kroener's technique:\u00a0</strong>It refers to\u00a0<strong>fimbriectomy</strong>\u00a0done by ligating the distal ampulla of the tube with two permanent sutures followed by division and removal of the infundibulum. It is irreversible.</li>\n<li><strong>Uchida's method</strong>: The serosa in the midsegment of the tube is stripped off from the mucosa and then excised. The proximal segment is ligated and buried in the broad ligament. The minimum tubal excision preserves the potential for tuboplasty.</li>\n<li><strong>Cornual resection</strong>: The cornual part of the tube is resected between two clamps.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5b59dc51b5c9456ab584b2b37258bcd3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/417ea18431a342268453182c5dd6dcaax1280x2577.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e77f71975b54f0d9df6c3642834a362x1200x2309.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c0d4acab35d4d6eab90ca9c98eeb99ax1280x2110.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3579c10928114e46930a5d490bd4905ex1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0c421eacaa34e29ab6af3a2f240d9a5x1200x1451.JPEG"
    ]
  },
  {
    "text": "Which of the following is not true regarding the image given below?",
    "choices": [
      {
        "id": 1,
        "text": "It is a drainage procedure for chronic pancreatitis."
      },
      {
        "id": 2,
        "text": "Resection of tail with longitudinal pancreaticojejunostomy."
      },
      {
        "id": 3,
        "text": "Failed due to restenosis and segmental obstruction of the pancreas."
      },
      {
        "id": 4,
        "text": "Used in resectable tumors of the body or the tail of the pancreas."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the distal resection of the pancreatic tail, with end-to-end pancreaticojejunostomy, i.e.<strong>, Duval procedure.</strong></p>\n<p><strong>Resection of tail with longitudinal pancreaticojejunostomy\u00a0</strong>is known as Puestow Procedure.</p>\n<p>It is a drainage procedure for <strong>chronic pancreatitis </strong><strong>(Option A).</strong> It was developed on the basis of presumption that a single stricture of duct of Wirsung near the ampulla was responsible for the obstructive pathology and terminal drainage would treat the condition.</p>\n<p>It consists of a <strong>d</strong><strong>istal pancreatectomy with roux-en-Y pancreaticojejunostomy.\u00a0</strong>But it almost invariably failed due to restenosis and segmental obstruction of the pancreas due to progressive scarring. <strong>(Option C)</strong></p>\n<p><strong>Note:\u00a0</strong>This procedure is outdated and not in use due to low improvement rates. It is now used in resectable tumors of the body or the tail of the pancreas. (<strong>Option D)</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ceb4c02236bf4929acde300ec4bc6b55.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child presents with pain and swelling in the right side of his scrotum and testicular torsion is suspected. Which is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Immediate exploration on both symptomatic and asymptomatic side"
      },
      {
        "id": 2,
        "text": "Immediate exploration on symptomatic side only"
      },
      {
        "id": 3,
        "text": "Delayed exploration on both symptomatic and asymptomatic side"
      },
      {
        "id": 4,
        "text": "Delayed exploration on symptomatic side only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a case of suspected testicular torsion,<strong> immediate exploration </strong>needs to be done on both the<strong> symptomatic </strong>as well as the<strong> asymptomatic side.</strong></p>\n<p>In <strong>testicular torsion</strong>, the blood supply to the testicle is compromised due to the twisting of the spermatic cord within the tunica vaginalis, resulting in <strong>ischemia</strong> of the <strong>epididymis</strong> and the <strong>testis</strong>.</p>\n<p class=\"p1\">At the time of surgical exploration <strong>contralateral testes</strong> also must be explored and <strong>fixed to the dartos fascia</strong> due to the possibility that the same anatomic defect allowing torsion exists on the contralateral side.</p>\n<p class=\"p1\">More than 80% of <strong>testes</strong> can be <strong>salvaged</strong> if surgery is performed within <strong>6 hours</strong>. If the testis is found to be <strong>necrosed</strong> on scrotal exploration, <strong>orchidectomy</strong> of the <strong>necrosed testis</strong> and <strong>orchidopexy</strong> of the <strong>contralateral testis</strong> is done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male patient, during his routine annual checkup, is found to have an abdominal aortic aneurysm measuring 40 mm in diameter on USG. Which of the following is true about the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Urgent endovascular aneurysm repair"
      },
      {
        "id": 2,
        "text": "Surgery is indicated if aneurysmal diameter is >55mm"
      },
      {
        "id": 3,
        "text": "Urgently wheel the patient to OT for surgery"
      },
      {
        "id": 4,
        "text": "Surgery is indicated only if aneurysm is >77mm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Surgery is indicated in asymptomatic abdominal aortic aneurysm only if its diameter is <strong>more than 55mm</strong>.</p>\n<p>If the diameter is less than <strong>55mm</strong>, regular <strong>ultrasound monitoring</strong> is required. This is because elective open surgery has a higher rate of mortality when compared to conservative management for aneurysms of size &lt; 55mm.</p>\n<p>Management of aortic aneurysm<br />AAA is surgically managed by <strong>dacron graft repair</strong>. It can be either <strong>open or EVAR.</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Open surgical repair</strong> is done by exposing the aorta through a mid sternal incision and graft replacement. To expose the aorta the <strong>descending colon should be mobilized medially</strong> and this is known as <strong>left</strong> <strong>visceral rotation</strong> or <strong>Mattox procedure</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>EVAR</strong> (endovascular aneurysm repair) is a <strong>minimally</strong> <strong>invasive</strong> procedure in which an aortic stent graft is placed on the nonaneurysmal aortoiliac segment.</li>\n</ul>\n<p>Complications of following abdominal aortic aneurysm repair</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cardiovascular (ischemia and infarction)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Respiratory (atelectasis or consolidation).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Colonic ischemia.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Renal failure.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aortoduodenal fistula</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">spinal cord ischemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient was brought to the ER after a road traffic accident. On examination, left-sided hydropneumothorax was noted. Thoracostomy was done and around 1800 ml of blood was drained in 1 hour. What is the most appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Urgent thoracentesis"
      },
      {
        "id": 2,
        "text": "Continue resuscitation for the next 6 Hours"
      },
      {
        "id": 3,
        "text": "Administer a hemostatic agent through the chest tube"
      },
      {
        "id": 4,
        "text": "Emergency thoracotomy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Given the significant<strong> blood loss (1800 ml)</strong>\u00a0and the patient's <strong>critical</strong> condition, the most appropriate management in this scenario would be an\u00a0<strong>emergency thoracotomy</strong>.</p>\n<p>A thoracotomy is a surgical procedure in which an incision is made into the chest to access the thoracic cavity. It is performed in critical situations to control bleeding and repair injuries to the chest structures, including the lung and blood vessels.</p>\n<p>In this case, the patient's condition is serious due to the combination of <strong>pneumothorax</strong>, <strong>hydrothorax</strong>, and a <strong>rapid blood loss </strong>of <strong>1800 ml</strong> in just <strong>1 hour. </strong>This level of bleeding suggests a severe injury to blood vessels or vital structures within the chest. Emergency thoracotomy would provide direct access to the bleeding source, allowing for immediate control of bleeding, repair of injuries, and restoration of stable conditions.</p>\n<p><strong>Indications for thoracotomy:</strong></p>\n<ul>\n<li><strong>Initial</strong>\u00a0tube thoracostomy drainage of<strong>\u00a0&gt;1000 ml (penetrating injury)</strong>\u00a0or<strong>\u00a0&gt;1500 ml (blunt injury)\u00a0</strong>of frank blood</li>\n<li><strong>Ongoing\u00a0</strong>tube thoracostomy drainage of<strong>\u00a0&gt;200 ml/ hr</strong>\u00a0for<strong>\u00a03 consecutive hours</strong>\u00a0in<strong>\u00a0non-coagulopathic</strong>\u00a0patients with<strong>\u00a0hemothorax</strong></li>\n<li>Caked hemothorax despite the placement of two chest tubes</li>\n<li>Massive air leak from chest tube with inadequate ventilation</li>\n<li>Open pneumothorax</li>\n<li>Great vessel injury</li>\n<li>Pericardial tamponade</li>\n<li>Cardiac herniation</li>\n<li>Tracheobronchial injury</li>\n<li>Esophageal perforation</li>\n</ul>\n<p><strong>Other Options:</strong></p>\n<p><strong>Option A: Thoracentesis</strong> involves the removal of fluid or air from the pleural space using a needle or catheter. However, given the severity of the situation with rapid blood loss, this procedure alone would not adequately address the underlying issues or stop the significant bleeding.</p>\n<p>Option B: Continued resuscitation for the next <strong>6 hours\u00a0</strong>is not appropriate in this scenario due to the patient's critical condition and substantial blood loss. Immediate intervention is required to stabilize the patient's condition and address the underlying causes of the blood loss.</p>\n<p>Option C: While <strong>hemostatic agents </strong>can be useful in certain bleeding situations, the rapid blood loss and critical nature of the presented case call for a more immediate and direct approach, such as an emergency thoracotomy, to achieve rapid control of bleeding and prevent further complications.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to a surgeon with a complaint of bleeding per rectum. On examination, the following finding was seen. The mass did not reduce spontaneously or manually. What is the next step of management done in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Analgesics and a sitz bath"
      },
      {
        "id": 2,
        "text": "Rubber band ligation"
      },
      {
        "id": 3,
        "text": "Open hemorrhoidectomy"
      },
      {
        "id": 4,
        "text": "Sclerotherapy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario with the image showing a <strong>reddish</strong> <strong>mass</strong> protruding out of the anal canal that <strong>does not</strong> <strong>reduce</strong> spontaneously or manually is suggestive of\u00a0<strong>grade IV internal hemorrhoids. Surgery </strong>is indicated and <strong>open hemorrhoidectomy</strong> is done in this patient.<strong>\u00a0</strong></p>\n<p><strong>Management</strong>\u00a0of\u00a0<strong>internal</strong>\u00a0hemorrhoids:</p>\n<ul>\n<li><strong>Bleeding</strong>\u00a0from\u00a0<strong>grade 1</strong>\u00a0and\u00a0<strong>grade 2</strong>\u00a0hemorrhoids often\u00a0<strong>improve</strong>\u00a0with the addition of\u00a0<strong>dietary fiber,</strong>\u00a0stool softeners, increased\u00a0<strong>fluid</strong>\u00a0intake, and avoidance of straining.</li>\n<li>Grade 1, grade 2,\u00a0and\u00a0some grade 3 hemorrhoids with only an internal component\u00a0can be treated with simple procedures like rubber\u00a0<strong>band ligation,</strong>\u00a0<strong>sclerotherapy,</strong>\u00a0infrared and laser coagulation, and cryotherapy.</li>\n<li><strong>Surgery</strong>\u00a0is\u00a0indicated\u00a0in:\u00a0\n<ul>\n<li>Internal grade 3 or grade 4 hemorrhoids</li>\n<li>Hemorrhoids with a significant external component</li>\n<li>Early-grade hemorrhoids not responding to simple procedures</li>\n</ul>\n</li>\n</ul>\n<p><strong>Surgical</strong>\u00a0<strong>procedures</strong>\u00a0used in the <strong>removal</strong> of <strong>internal hemorrhoids</strong> are:</p>\n<ul>\n<li>\u00a0Doppler-guided hemorrhoidal artery ligation</li>\n<li><strong>Open hemorrhoidectomy</strong></li>\n<li><strong>Closed </strong>(Ferguson)<strong>\u00a0</strong>hemorrhoidectomy</li>\n<li>Stapled hemorrhoidopexy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc331cbb15854b7d8bf294ff6222f076.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47bf92c5c2d643c5a39e4f7a61a209b3x1280x3706.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0999acf83ea43c1a18c9f431abb5794x1280x3049.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/66ceb8ab86294bcb9615b94d6c72d4fax450x900.PNG"
    ]
  },
  {
    "text": "A 30-year-old female who was using IUCD for contraception presents in the emergency following two episodes of painless spotting per vagina preceded by amenorrhea for 8 weeks. She complained of lightheadedness and her blood pressure is 80/50 mmHg and the pulse rate is 138 beats/minute, with a positive urine pregnancy test.  What should be the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "IV fluids followed by oral methotrexate"
      },
      {
        "id": 2,
        "text": "Immediate laparotomy"
      },
      {
        "id": 3,
        "text": "Stabilizing the patient followed by suction evacuation"
      },
      {
        "id": 4,
        "text": "Dilatation and currettage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario implies a case of hemodynamically <strong>unstable ruptured ectopic pregnancy,</strong> and the management of this patient would be a <strong>laparotomy</strong>.</p>\n<p>The given clinical scenario strongly indicates a case of <strong>ruptured ectopic pregnancy</strong> based on several key clinical findings. The patient's history of IUCD usage is significant as it <strong>increases</strong> the risk of <strong>ectopic pregnancy</strong>. The presence of <strong>amenorrhea</strong> for <strong>8 weeks</strong> is particularly noteworthy, as clinical manifestations of ectopic pregnancy typically manifest between six to eight weeks after the last normal menstrual period.</p>\n<p>The patient's presentation with vaginal bleeding, preceded by <strong>amenorrhea</strong> of more than <strong>4 weeks</strong>, is highly suggestive of an <strong>ectopic gestation</strong>. This suspicion is further strengthened by a positive urine pregnancy test. Most critically, the patient's unstable vital signs point to internal blood loss, which is a classic presentation of a ruptured ectopic pregnancy. The combination of these findings creates a clinical picture that warrants immediate medical attention for suspected ruptured ectopic pregnancy.</p>\n<p>An <strong>unstable patient</strong> with this finding should undergo urgent surgical consultation and exploration ie, <strong>laparotomy</strong>. It reduces hemorrhage and hemodynamic instability, also giving a better view of the operating field for the surgeon.</p>\n<p>Risk factors of tubal ectopic pregnancy:</p>\n<ul>\n<li>Abnormal tube anatomy</li>\n<li>Surgeries done on the tubes earlier- previous ectopic, fertility restorative, sterilization.</li>\n<li>Sexually transmitted diseases causing distortion of tubal architecture</li>\n<li>Peritubal adhesions</li>\n<li>Salpingitis isthmica nodosa</li>\n<li>Congenital anomalies secondary to diethyl stilbesterol exposure\u00a0</li>\n<li>Infertility, Artificial reproductive techniques\u00a0</li>\n<li>Smoking\u00a0</li>\n<li><strong>Intrauterine contraceptive systems\u00a0</strong></li>\n</ul>\n<p><strong>Other differentials :</strong></p>\n<ul>\n<li>In\u00a0Abruptio placenta there is painful vaginal bleeding that is associated with contractions and uterine hypertonicity which have not been mentioned in the question, which is basically a shock scenario due to an underlying a condition.</li>\n<li>\u00a0In Placenta previa the classic presentation is painless, bright red vaginal bleeding that often stops spontaneously and then recurs with labor. The bleeding most likely occurs in 3rd trimester and does not lead to a shock-like condition.</li>\n<li>In an un-ruptured ectopic pregnancy, there is no history of shock-like symptoms.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man presents with complaints of regurgitation on bending down, gurgling noises from the neck on swallowing, and awakening at night with a feeling of tightness in the throat and a fit of coughing. A barium swallow was done, and findings are given below. What is the most preferred surgical technique for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Transoral endoscopic carbon dioxide laser resection"
      },
      {
        "id": 2,
        "text": "Endoscopic stapling of the diverticular wall"
      },
      {
        "id": 3,
        "text": "Pharyngoplasty"
      },
      {
        "id": 4,
        "text": "Abscess drainage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The preferred surgical technique for this patient is<strong> endoscopic stapling of the diverticular wall</strong>.\u00a0</p>\n<p>The patient presents with symptoms of<strong> Zenker\u2019s diverticulum(pharyngeal pouch)</strong>- regurgitation on bending down, gurgling noises from the neck on swallowing, and awakening at night with a feeling of tightness in the throat and a fit of coughing.</p>\n<p>A pharyngeal pouch is a protrusion of mucosa through <strong>Killian\u2019s dehiscence</strong>, a weak area of the posterior pharyngeal wall between the oblique fibres of the thyropharyngeus and the transverse fibers of cricopharyngeus at the lower end of the inferior constrictor muscle\u00a0</p>\n<p>Despite endoscopic stapling being the preferred technique in the management of\u00a0 Zenker\u2019s diverticulum(pharyngeal pouch), in case of inadequate endoscopic access, open excision of the pouch is performed. \u00a0 \u00a0\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Transoral endoscopic carbon dioxide laser resection</strong> is usually performed in early-stage <strong>squamous cell carcinoma(SCC)</strong> of the hypopharynx\u00a0</p>\n<p>Option C: <strong>Pharyngoplasty</strong> is done in conditions like velopharyngeal dysfunction and sleep apnea. This procedure removes tonsillar tissue, preserving the uvula and soft palate.</p>\n<p>Option D:<strong> Drainage</strong> of the abscess is usually done in cases of <strong>retropharyngeal abscess</strong> which presents with gross swelling and an abscess pointing beneath the thinned mucosa in the posterior wall of the pharynx. Marked dyspnea, neck rigidity, dysphagia, and croupy cough are some of the presenting symptoms in an acute retropharyngeal abscess.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe7e47846fd446b1851f5655c21bc611.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An intern noticed the following findings while removing the catheter in a 30-year-old patient.  A manual reduction was attempted but was unsuccessful and hence a dorsal slit was made. Surgery was planned 3 weeks later.  Which of the following statements is false regarding the condition and the definitive procedure done for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Reactionary hemorrhage from frenular artery"
      },
      {
        "id": 2,
        "text": "It is precipitated after sexual intercourse"
      },
      {
        "id": 3,
        "text": "Priapism is a rare complication"
      },
      {
        "id": 4,
        "text": "It is associated with dorsal chordee"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical history and the image showing swollen glans are suggestive of\u00a0<strong>paraphimosis</strong>\u00a0and<strong> circumcision </strong>is the definitive procedure done after 3 weeks. It is not associated with\u00a0dorsal chordee but can lead to\u00a0<strong>ventral chordee.</strong>\u00a0</p>\n<p><strong>Paraphimosis\u00a0</strong>is a condition in which the retracted prepuceal skin over the glans cannot be placed back as a result of which a ring-like constriction is seen proximal to the corona and prepuceal skin.\u00a0</p>\n<p>This leads to pain and swelling of the glans. <strong>Sexual intercourse</strong> and <strong>urethral catheterization</strong> can precipitate the condition.\u00a0</p>\n<p>Treatment includes <strong>manual reduction</strong>\u00a0of the skin. When it is not possible, a\u00a0<strong>dorsal slit</strong> has to be made to relieve the pain and compression along with analgesics and antibiotics. This is followed by<strong> circumcision </strong>after\u00a03 weeks.\u00a0Alternatively, Sedation and multiple\u00a0<strong>hyaluronidase injection</strong>\u00a0in 10 ml saline are injected to reduce edema followed by circumcision.\u00a0</p>\n<p><strong>Circumcision</strong> is a surgical procedure which involves cutting the dorsal skin up to the corona later extending it circumferentially and ventrally.\u00a0</p>\n<p>Indications for circumcision include</p>\n<ul>\n<li>Religious</li>\n<li><strong>Phimosis</strong> - In this condition, the prepuce cannot be retracted over the glans.</li>\n<li><strong>Paraphimosis</strong> after doing initial dorsal slit</li>\n<li><strong>Balanitis</strong> and <strong>balanoposthitis</strong> - Balanitis is the inflammation of the glans, whereas balanoposthitis involves both glans and prepuce</li>\n<li>Early carcinoma of the glans penis or prepuce\u2014Here it is both diagnostic as\u00a0well as therapeutic</li>\n<li>Certain sexually transmitted diseases, e.g. herpes infection</li>\n</ul>\n<p>Complications:</p>\n<ul>\n<li>Infection</li>\n<li><strong>Reactionary hemorrhage</strong> - It can be due to slippage of ligature from the <strong>frenular artery</strong> and dorsal vein</li>\n<li>Urethral stricture near the external meatus in children</li>\n<li>Chordee due to removal of excess skin on the ventral aspect-<strong>Ventral chordee</strong></li>\n<li><strong>Priapism</strong> can occur rarely</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9ae957ba3eaa476fa2ffcd188e845fbb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A male patient presents to the clinic with complaints of jaundice with clay-colored stools and pruritis. After a detailed radiological and pathological investigations, a 2 cm adenocarcinoma is found at the head of the pancreas. There is no spread to the adjacent structures. What is the preferred surgical management in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Whipple\u2019s procedure"
      },
      {
        "id": 2,
        "text": "Pylorus preserving pancreaticoduodenectomy"
      },
      {
        "id": 3,
        "text": "Radical pancreaticodudenectomy"
      },
      {
        "id": 4,
        "text": "Cholecystojejunostomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The preferred surgical management in this patient is\u00a0<strong>pylorus-preserving pancreatoduodenectomy (PPPD), </strong>also known as Longmire\u2013Traverso procedure. This procedure involves the\u00a0removal of the duodenum and the pancreatic head and the distal part of the bile duct.</p>\n<p>The original pancreatoduodenectomy, as proposed by <strong>Whipple</strong>, included resection of the gastric antrum. <strong>Preserving the antrum </strong>and the <strong>pylorus</strong> is thought to result in a better physiological outcome, with no difference in survival or recurrence rates. Currently, the pylorus is removed in cases when:</p>\n<ul>\n<li>entire duodenum has to be removed (e.g. in familial adenomatous polyposis\u00a0(FAP)),</li>\n<li>tumor encroaches in the first part of the duodenum, or\u00a0stomach</li>\n<li>A clear resection margin is not achieved by PPPD</li>\n</ul>\n<p>For <strong>tumors of the body and tail</strong>, <strong>distal pancreatectomy</strong>\u00a0is the preferred surgical management.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Whipple's procedure</strong> is a complex surgery done for carcinomas involving the head of the pancreas. It is done only in cases when the entire duodenum has to be removed e.g. in familial adenomatous polyposis (FAP), tumor encroaches in the first part of the duodenum, or stomach or a clear resection margin is not achieved by pylorus-preserving pancreatoduodenectomy.</p>\n<p>Option C:<strong> Radical pancreaticoduodenectomy</strong> involves removing the head of the pancreas, the first part of the small intestine (duodenum), the gallbladder, and part of the bile duct. It is primarily performed to treat pancreatic cancer and other tumors in the pancreatic head region, though it may also be used for chronic pancreatitis in some cases.</p>\n<p>Option D:\u00a0<strong>Cholecystojejunostomy</strong> is a surgical bypass procedure that creates a connection between the gallbladder and jejunum. It is done for unresectable pancreatic head tumors causing biliary obstruction, distal common bile duct obstruction and when hepaticojejunostomy is not feasible.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Nesbitt procedure is used for _____.",
    "choices": [
      {
        "id": 1,
        "text": "Peyronie\u2019s disease"
      },
      {
        "id": 2,
        "text": "Marion's disease"
      },
      {
        "id": 3,
        "text": "Priapism"
      },
      {
        "id": 4,
        "text": "Erectile dysfunction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common procedure used in Peyronie\u2019s disease is the <strong>Nesbitt</strong> procedure.</p>\n<p>This corrects the deformity by <strong>plicating</strong> t<strong>he opposite side of the deformity</strong>, thereby straightening the penis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25d8f6fca4674c9cac353508423d4605x361x231.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba25e4035edc43b58b9e5245b2d54567x1280x1560.JPEG"
    ]
  }
];
        let quizName = 'Mini Test- 7 (Surgical Procedures)';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>