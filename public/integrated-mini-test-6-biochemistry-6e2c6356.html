<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 6 - Biochemistry - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 20-year-old primigravida in her third trimester is brought to the ER in an altered state of consciousness. Lab tests reveal elevated AST, ALT, and bilirubin, while a liver biopsy shows microvesicular fatty infiltration. Which enzyme deficiency is associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Long chain acyl CoA dehydrogenase"
      },
      {
        "id": 2,
        "text": "Medium chain acyl CoA dehydrogenase"
      },
      {
        "id": 3,
        "text": "HMG CoA lyase"
      },
      {
        "id": 4,
        "text": "HMG CoA reductase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mother has <strong>acute fatty liver of pregnancy</strong> (AFLP), which is associated with <strong>long-chain 3-hydroxyacyl CoA dehydrogenase (3-LCHAD) deficiency</strong>. This enzyme is involved in the beta-oxidation of fatty acids.</p>\n<p>Women who develop AFLP have heterozygous mutations in the recessive gene for 3-LCHAD. The beta-oxidation capacity is reduced, but patients are asymptomatic outside pregnancy. AFLP develops when such women become pregnant with a fetus homozygous for the 3-LHCAD mutation. The fetus is unable to oxidize fatty acids, which then enter the maternal circulation. These fatty acids overwhelm the maternal oxidation capacity and cause acute fatty liver of pregnancy.</p>\n<p>Liver function tests such as AST, ALT, and serum bilirubin levels are raised. <strong>Biopsy reveals a characteristic microvesicular fatty infiltration</strong>. Fulminant liver failure can lead to hepatic encephalopathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-month-old infant is found to be hypotonic, with a high forehead, large anterior fontanelle, markedly separated cranial sutures, and hepatomegaly. Further investigations confirmed a diagnosis of the cerebro-hepato-renal syndrome. Which of the following biochemical findings would not be seen in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated levels of very long chain fatty acids"
      },
      {
        "id": 2,
        "text": "Elevated plasma phytanic acid"
      },
      {
        "id": 3,
        "text": "Elevated plasmalogen content of phospholipids"
      },
      {
        "id": 4,
        "text": "Abnormal synthesis of bile acids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>cerebro-hepato-renal syndrome</strong> or&nbsp;<strong>Zellweger syndrome,&nbsp;</strong>there is a <strong>decreased level </strong>of <strong>plasmalogens.</strong></p>\n<p>Zellweger syndrome is caused by mutations in the peroxins (<em>PEX</em>) family of genes. As a result of this, there is a defective transport of the proteins to the peroxisomes. It severely impairs the functions of peroxisomes, resulting in defective&nbsp;<strong>beta-oxidation</strong>&nbsp;of very-long-chain fatty acids (VLCFA), defective&nbsp;<strong>alpha oxidation</strong>, and impaired synthesis of bile acids and plasmalogens.</p>\n<p>The child presents with</p>\n<ul>\n<li><strong>Dysmorphic facial features</strong>&nbsp;like wide anterior fontanelles markedly separated cranial sutures, epicanthal folds, broad nasal bridge, hypoplastic supraorbital ridges, etc.</li>\n<li>Profound&nbsp;<strong>developmental delay,&nbsp;</strong>profound hypotonia with depressed deep tendon reflexes, neonatal seizures, and impaired hearing</li>\n<li>Calcific stippling of the epiphyses</li>\n<li>Renal cysts</li>\n<li>Hepatomegaly</li>\n</ul>\n<p>Biochemical findings will show:</p>\n<ul>\n<li>Accumulation of&nbsp;<strong>very-long-chain fatty acids, phytanic acid, </strong>and&nbsp;pipecolic acids</li>\n<li>Abnormalities of the synthesis of bile acids</li>\n<li>Marked reduction of plasmalogens</li>\n<li>Elevated levels of plasma phytanic acid</li>\n</ul>\n<p>There is no appropriate treatment for Zellweger syndrome. It is very severe, and infants rarely survive beyond six months of age.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant was brought to the pediatrics department with a history of passing foul-smelling and greasy stools. A small intestine biopsy was taken and is shown below. The peripheral smear showed acanthocytes. Which of the following is unlikely to be deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "LDL"
      },
      {
        "id": 2,
        "text": "HDL"
      },
      {
        "id": 3,
        "text": "VLDL"
      },
      {
        "id": 4,
        "text": "Chylomicron"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an infant presenting with <strong>steatorrhea</strong>, <strong>acanthocytosis</strong> on peripheral smear and histopathological slide showing<strong> lipid-laden enterocytes&nbsp;</strong>is most likely to be <strong>abetalipoproteinemia</strong>. Abetalipoproteinemia is a rare&nbsp;<strong>autosomal recessive</strong> disease. It is caused due to the <strong>mutation in microsomal triglyceride transfer protein (MTTP)</strong>. MTTP is necessary to transfer lipids to nascent chylomicrons in the small intestine and to VLDL in the liver. In abetalipoproteinemia, there is an <strong>absence of chylomicrons, VLDL, LDL</strong> (<strong>apoB</strong> containing lipoproteins), and deficient levels of plasma cholesterol and triglycerides.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/852e4f838f4d4337819cb283156a2dce.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60ffdd80c7fc4a239628d5825d0af8cdx1280x1573.JPEG",
      "https://cdn1.dailyrounds.org/uploads/fbf1f3e25b1c428fac8cfcbaee1e5773.JPEG"
    ]
  },
  {
    "text": "A 10-year-old boy with the history of polyuria and polydipsia was diagnosed to be suffering from type 1 DM. What will be the effect of this condition on the free fatty acid(FFA) level in this boy?",
    "choices": [
      {
        "id": 1,
        "text": "Decreased FFA level due to High glucagon: insulin ratio"
      },
      {
        "id": 2,
        "text": "Increased FFA level due to Low glucagon: insulin ratio"
      },
      {
        "id": 3,
        "text": "Increased FFA level due to High glucagon: insulin ratio"
      },
      {
        "id": 4,
        "text": "Decreased FFA level due to low glucagon: insulin ratio"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>type I diabetes mellitus,</strong> there is an Increased FFA level due to High glucagon: insulin ratio.</p>\n<p>Type I diabetes mellitus is a <strong>low insulin state&nbsp;</strong>and hence&nbsp;glucagon: insulin ratio will be high. The level of FFA, in turn, is controlled by glucagon:insulin ratio. Glucagon increases the FFA level and insulin has the opposite effect.</p>\n<p>Note: <strong>Low insulin state</strong> also causes increased fatty acid oxidation leading to increased ketone body production and <strong>ketosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-month-old infant is brought with hypotonia and loss of motor milestones. On examination, hepatosplenomegaly and macular cherry-red spot are noted. Foam cells are seen on bone marrow biopsy. Which is the most likely deficient enzyme in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Sphingomyelinase"
      },
      {
        "id": 2,
        "text": "Hexosaminidase A"
      },
      {
        "id": 3,
        "text": "Glucocerebrosidase"
      },
      {
        "id": 4,
        "text": "Galactocerebrosidase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of <strong>progressive neurodegeneration </strong>(loss of motor milestones, hypotonia) along with <strong>hepatosplenomegaly</strong>, <strong>macular cherry-red spot</strong>, and <strong>foam cells</strong> <strong>on bone marrow biopsy</strong> point to a diagnosis of <strong>Niemann-Pick disease</strong>. The <strong>enzyme</strong> <strong>deficient</strong> in this disease is <strong>sphingomyelinase</strong>.</p>\n<p>Niemann-Pick disease is disorder of infancy which is almost always fatal by 2-3 years of age. Although the affected <strong>infants</strong> are <strong>normal at birth</strong>, they <strong>soon</strong> <strong>present</strong> <strong>with</strong> failure to thrive, <strong>hepatosplenomegaly</strong>, and rapid <strong>psychomotor</strong> <strong>retardation</strong>. Over time, there is severe loss of motor function and deterioration of intellect and death occurs by 3 years of age.</p>\n<p>Niemann-Pick disease occurs due to the <strong>deficient activity</strong> <strong>of</strong> <strong>acid sphingomyelinase </strong>enzyme. There is extensive <strong>accumulation</strong> <strong>of</strong> <strong>sphingomyelin</strong> <strong>in</strong> the <strong>monocyte-macrophage</strong> system. Lipid laden <strong>foam cells </strong>are observed <strong>in bone marrow</strong> and lymph nodes. The <strong>diagnosis</strong> is <strong>confirmed by</strong> measuring the <strong>sphingomyelinase</strong> <strong>levels</strong> in the peripheral leucocytes.\u00a0</p>\n<p>The <strong>management</strong> of Niemann-Pick disease is mostly <strong>supportive</strong>, such as physical therapy and a feeding tube for nutrition. <strong>Olipudase alfa</strong> has been <strong>recently approved </strong>for non-CNS manifestations of Niemann-Pick disease.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>Hexoseaminidase A deficiency</strong> is seen in <strong>Tay-Sachs disease</strong>. While it also <strong>presents with</strong> progressive <strong>neurodegeneration</strong> and macular <strong>cherry-red spot</strong>, there is <strong>no organomegaly</strong> and lysosomes with onion skin are seen.\u00a0</p>\n<p>Option C: <strong>Glucocerebrosidase</strong> <strong>deficiency</strong> is seen in <strong>Gaucher disease</strong>. The patients present with <strong>hematological</strong> <strong>abnormalities</strong>, <strong>organomegaly</strong>, and <strong>skeletal manifestations</strong> in the form of bone pain and <strong>pathological fractures</strong>. Bone marrow examination shows <strong>macrophages with</strong> characteristic<strong> crumbled tissue paper appearance</strong>.</p>\n<p>Option D: <strong>Galactocerebrosidase</strong> <strong>deficiency</strong> is seen in <strong>Krabbe disease</strong>. Both <strong>peripheral</strong> and <strong>central</strong> <strong>myelin</strong> is <strong>affected</strong> in this disease. The patients present with <strong>spasticity</strong> and <strong>intellectual impairment</strong> (destruction of central myelin) and <strong>peripheral neuropathy</strong> and <strong>absent deep tendon reflexes</strong> (destruction of peripheral myelin). <strong>Optic atrophy</strong> may also be seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man presents with blistering shortly after consuming alcohol at a party. He notes that this has occurred several times in the past. The lesions are shown below. What is the most likely enzyme affected in his conditon?",
    "choices": [
      {
        "id": 1,
        "text": "ALA dehydratase"
      },
      {
        "id": 2,
        "text": "Uroporphyrinogen-I synthase"
      },
      {
        "id": 3,
        "text": "Uroporphyrinogen decarboxylase"
      },
      {
        "id": 4,
        "text": "Ferrochelatase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image given above is of porphyria cutanea tarda: erosions, blisters, pigmentary changes, and scarring. <strong>Porphyria cutanea tarda</strong> (PCT) is the commonest porphyria, as is likely in the case of blistering following <strong>alcohol consumption</strong>. It results from the deficiency of <strong>uroporphyrinogen decarboxylase </strong>(UROD). This causes an accumulation of uroporphyrin and other highly carboxylated porphyrins. It is usually acquired (75%, sporadic) and is often associated with <strong>liver disease</strong>. It does not cause <strong>acute attacks</strong>.\u00a0</p>\n<p>Patients notice increased fragility on light\u2010exposed skin, particularly the backs of the hands and forearms, with minor trauma shearing the skin away to leave sharply marginated erosions that crust and resolve over few weeks leaving atrophic scars, milia, and often mottled hyper\u2010 or hypopigmentation. <strong>Hypertrichosis</strong> on the upper face and forehead is common</p>\n<p><strong>Pink or coral-red fluorescence</strong> of urine is seen under <strong>Wood's light.</strong></p>\n<p>The classification of porphyrias based on their enzyme deficiencies is as shown below:</p>\n<p>Option A: ALA dehydratase: ALA dehydratase deficiency</p>\n<p>Option B: Uroporphyrinogen I synthase: Acute intermittent porphyria</p>\n<p>Option D: Ferrochelatase: Erythropoietic Protoporphyria</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9a42bc3f75ae45aa8a9b97788ea896b9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 7-day-old term neonate presents with jaundice and on blood investigations, unconjugated hyperbilirubinemia is seen. The baby is otherwise healthy and exclusively breastfed. A diagnosis of breast milk jaundice is suspected. What is the pathogenesis of the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Inadequate breastfeeding"
      },
      {
        "id": 2,
        "text": "MRP 2 mutation"
      },
      {
        "id": 3,
        "text": "Absence of UDP-glucoronyl transferase"
      },
      {
        "id": 4,
        "text": "Increased \u00df-glucuronidase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The pathogenesis of breast milk jaundice is <strong>increased \u00df-glucuronidase</strong>.</p>\n<p><strong>Breast milk jaundice</strong> is a type of neonatal jaundice that occurs in neonates due to <strong>breast milk feeding</strong>. It usually happens within the first week of life due to the abnormal accumulation of unconjugated bilirubin, leading to jaundice. The pathology of <strong>breast milk jaundice</strong> is attributed to the <strong>contents of breast milk</strong> whereas in <strong>breastfeeding jaundice</strong> there is <strong>inadequate breastfeeding</strong>. \u00a0 \u00a0 \u00a0</p>\n<p>Breast milk contains <strong>inhibitors</strong> of <strong>UDP-glucuronyl transferase</strong> that prevents hepatic conjugation of unconjugated bilirubin.\u00a0Another constituent of breast milk is <strong>\u00df-glucuronidase</strong> which is an enzyme that <strong>deconjugates bilirubin</strong> in the intestinal brush border, leading to increased serum reabsorption instead of excretion of bilirubin. Thus<strong> increases enterohepatic recirculation</strong> of unconjugated bilirubin.\u00a0</p>\n<p>Infant factors contributing to breast milk jaundice include <strong>decreased gut flora</strong> that converts conjugated bilirubin into stercobilinogen and excreted in stools. As well as <strong>increased gut permeability</strong> in infants promotes the enterohepatic recirculation of bilirubin.\u00a0</p>\n<p>Breast milk jaundice usually is self-limiting in the <strong>2nd to 3rd week of life</strong>. Other causes should be ruled out in infants with severe or persistent jaundice. Rarely due to persistent elevated bilirubin levels, they may require changing from breast milk to infant formula for 24-48 hr and/or treatment with phototherapy without cessation of breastfeeding.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Breastfeeding jaundice</strong> occurs due to<strong> inadequate breastfeeding</strong> which typically reaches its peak between the <strong>third and fifth day</strong> <strong>after birth </strong>and is often accompanied by <strong>excessive weight loss</strong>. They also show increased<strong> unconjugated hyperbilirubinemia</strong>.</p>\n<p>Option B: <strong>Dubin Johnson syndrome</strong> shows <strong>multi-drug-resistant protein 2(MRP- 2) mutation</strong>. It is an autosomal recessive hyperbilirubinemia syndrome characterised by <strong>conjugated </strong>hyperbilirubinemia and <strong>black-pigmented</strong> liver on biopsy due to an epinephrine metabolite.\u00a0</p>\n<p>Option C: <strong>Crigler-Najjar syndrome type-I</strong> is due to the<strong> absence of UDP-glucoronyl transferase</strong> enzyme. It is an autosomal recessive hyperbilirubinemia syndrome characterized by severe <strong>unconjugated hyperbilirubinemia</strong> and usually presents with <strong>kernicterus</strong>. It is usually fatal in the neonatal period. \u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A father reports to a pediatrician with his daughter saying that she has episodes of lethargy, irritability, and vomiting right after she drinks fruit juice. Investigations show a deficiency of aldolase B enzyme. Which of the following need not be restricted in the patient's diet?",
    "choices": [
      {
        "id": 1,
        "text": "Galactose"
      },
      {
        "id": 2,
        "text": "Fructose"
      },
      {
        "id": 3,
        "text": "Sucrose"
      },
      {
        "id": 4,
        "text": "Sorbitol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case scenario with symptoms occurring after ingesting fruit juices (containing fructose) and the <strong>absence of aldolase B enzyme</strong> point to a diagnosis of <strong>hereditary fructose intolerance</strong>. While <strong>fructose</strong>, <strong>sucrose</strong>, and <strong>sorbitol</strong> should be <strong>restricted</strong> in this patient, there is no rationale for restricting galactose.</p>\n<p><strong>Fructose 1-phosphate aldolase/aldolase B hydrolyzes</strong>&nbsp;<strong>fructose-1-phosphate</strong> into dihydroxyacetone phosphate and glyceraldehyde. Aldolase B is present in liver, kidneys, and small intestine. Note that while<strong> fructose 1-phosphate</strong> can be <strong>broken down only by aldolase B</strong>, <strong>fructose 1,6-bisphosphate hydrolysis</strong> (during glycolysis) can be undertaken by <strong>both</strong> <strong>aldolase</strong> <strong>A</strong> <strong>and</strong> aldolase <strong>B</strong>.</p>\n<p><strong>Hereditary fructose intolerance</strong> is an <strong>autosomal recessive</strong> condition due to <strong>aldolase B deficiency</strong>.&nbsp;Patients are <strong>asymptomatic</strong> <strong>until fructose or sucrose</strong>&nbsp;is <strong>ingested</strong> (usually from fruit, fruit juice, sweetened cereal, or table sugar). It usually <strong>presents</strong> <strong>during</strong> <strong>infancy</strong> when sugar-containing feeds are introduced, but some patients (who are less sensitive) can present at older ages as well. Clinical features include jaundice, hepatomegaly, vomiting, lethargy, irritability, and convulsions. Hereditary fructose intolerance can lead to hypoglycemia despite adequate glycogen reserves because fructose 1-phosphate is an inhibitor of liver glycogen phosphorylase.</p>\n<div class=\"page\" title=\"Page 3061\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Benedict's test </strong>is<strong> positive</strong>&nbsp;as fructose is present in the urine and it is a reducing sugar. Reduced levels of <strong>aldolase B activity</strong> in the <strong>liver </strong>and demonstration of <strong>pathogenic variants in ALDOB gene</strong> on molecular genetic testing give a <strong>definitive diagnosis. </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Treatment involves </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">complete</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">cessation</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of fructose, sucrose (glucose + fructose), and sorbitol (metabolized to fructose) from the diet.</span></p>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1228\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The image below summarizes the metabolic pathway of fructose:</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1eda4b94a2824baa8e58207f06aa2277x1279x1703.JPEG"
    ]
  },
  {
    "text": "A young non-smoker with chronic cough and wheezing was diagnosed with \u03b11 antitrypsin deficiency. The following image shows the normal electrophoresis of serum proteins. Which of the following bands (A, B, C, D) becomes thin in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "D"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "B"
      },
      {
        "id": 4,
        "text": "A"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In&nbsp;<strong>&alpha;1 antitrypsin</strong> deficiency,<strong>&nbsp;t</strong>he band that is marked as <strong>B,</strong> representing&nbsp;<strong>&alpha;1 globulin,</strong>&nbsp;<strong>becomes thin</strong>.</p>\n<p><strong>Serum protein electrophoresis</strong> is a method of separation and identification of proteins based on their net charge, size, and shape.&nbsp;The largest peak that lies closest to the positive electrode (left corner) is that of <strong>albumin</strong> since it is present in the largest proportion in plasma. <strong>Globulins</strong> make up a much smaller fraction of the total serum protein and are represented by smaller peaks to the right. Five globulin categories are represented: alpha-1, alpha-2, beta-1, beta-2, and gamma, with the gamma fraction being closest to the negative electrode (right corner).</p>\n<p>Certain common diseases and their electrophoretic pattern:</p>\n<table style=\"width: 493px; height: 233px;\">\n<tbody>\n<tr style=\"height: 34px;\">\n<td style=\"width: 187.273px; height: 34px;\"><strong>Condition </strong></td>\n<td style=\"width: 288.727px; height: 34px;\"><strong>&nbsp;Electrophoretic pattern</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 187.273px; height: 18px;\">Chronic infections</td>\n<td style=\"width: 288.727px; height: 18px;\">Smooth increase in gamma globulins</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 187.273px; height: 18px;\">Multiple myeloma</td>\n<td style=\"width: 288.727px; height: 18px;\">Gamma globulin part is increased as a single narrow peak (<strong>M BAND</strong>)</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 187.273px; height: 36px;\">Malnutrition, cachexia, liver cirrhosis, nephrotic syndrome, severe burns</td>\n<td style=\"width: 288.727px; height: 36px;\">Albumin is reduced</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 187.273px; height: 36px;\"><strong>&alpha;1 antitrypsin deficiency</strong></td>\n<td style=\"width: 288.727px; height: 36px;\">&alpha;1 band is thin and even lost sometimes</td>\n</tr>\n</tbody>\n</table>\n<p>The following image shows the bands with their corresponding proteins in normal serum electrophoresis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b81001842fb14c4087d08b6afc00c708.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fbd0983139604b11ad59a24ebd1bfdefx1280x606.JPEG"
    ]
  },
  {
    "text": "A 12-year-old boy comes to your OPD with pain in his right loin. The pain is colicky and radiates to his right testis. The patient has a history of recurrent urinary tract infections. Urine analysis shows crystals as in the image. What is a likely finding in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Homocystinuria"
      },
      {
        "id": 2,
        "text": "Ornithinemia"
      },
      {
        "id": 3,
        "text": "Urinary excretion of lysine"
      },
      {
        "id": 4,
        "text": "Hyperammonemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has <strong>cystine crystals </strong>in urine as depicted in the image implicating a diagnosis of <strong>cystinuria</strong>, in which<strong> urinary excretion </strong>of<strong> lysine</strong> is a likely finding.</p>\n<p><strong>Cystinuria</strong> is the most common <strong>inherited aminoaciduria</strong>.<strong> </strong>In this condition, a<strong> defective amino acid transporter </strong>in the proximal tube results in the<strong> urinary excretion </strong>of <strong>cystine, ornithine, lysine,</strong> and<strong> arginine (COLA).\u00a0</strong></p>\n<p>Cystine is urine insoluble, while the rest of the amino acids are urine soluble; thus, only cystine causes renal calculi(6-8% of total prevalence in childhood). Apart from cystine stones in the urinary tract, cystinuria is a benign condition not associated with any gastrointestinal or nutritional deficiency because of compensation by alternative transporters.</p>\n<p>Homocystinuria, ornithinemia, and hyperammonemia are not found in cystinuria.\u00a0</p>\n<p>Management is ample hydration, urine alkalinization, and cystine-binding thiol drugs to increase the solubility of cystine.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6326e1781ef34fdb9cb1003c88e4fed9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old boy presents with a rash on sun-exposed areas of the body and a history of ataxia and diarrhea. His urine shows the presence of only neutral amino acids. Which of the following tests is positive in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Obermeyer test"
      },
      {
        "id": 2,
        "text": "Benedict's test"
      },
      {
        "id": 3,
        "text": "Guthrie's test"
      },
      {
        "id": 4,
        "text": "Seliwanoff's test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A patient with manifestations of pellagra (rash in sun-exposed areas, ataxia, and psychiatric manifestations) along with the presence of neutral amino-aciduria points to the diagnosis of&nbsp;<strong>Hartnup disorder. </strong>The<strong> Obermeyer test </strong>is positive in this condition.</p>\n<p class=\"p1\">The <strong>Obermeyer</strong> test detects the urinary excretion of&nbsp;<strong>indole compounds</strong>.&nbsp;Indole derivates such as <strong>indican</strong> are found in large amounts in patients&nbsp;due to bacterial breakdown of <strong>unabsorbed tryptophan</strong>&nbsp;in the intestines.&nbsp;</p>\n<p>Hartnup disorder is an <strong>autosomal recessive</strong> disorder due to a defect in the transporter for <strong>neutral amino acids</strong> like <strong>tryptophan</strong>. Decreased intestinal absorption of tryptophan in conjunction with its increased renal loss leads to its reduced bioavailability. This <strong>hampers</strong> <strong>niacin</strong> <strong>synthesis</strong>, and Hartnup disorder can thus present with manifestations of niacin deficiency (<strong>pellagra</strong>) like diarrhea, dermatitis, and dementia.</p>\n<p>The major clinical manifestation is<strong> cutaneous photosensitivity</strong>. The skin becomes erythematous after sun exposure and might develop a <strong>pellagra-like rash</strong> and eczema over time. Some patients might have <strong>intermittent ataxia</strong> manifested as unsteady, wide-based gait. Cognitive development is usually normal, but there may be <strong>episodic psychiatric manifestations</strong> such as irritability, emotional instability, and depression.&nbsp;</p>\n<p>The diagnosis of Hartnup disorder is established by typical clinical history and the <strong>presence of neutral amino acids in the urine</strong>. <strong>Urinary excretion of other amino acids remains normal</strong>, which differentiates it from causes of generalized aminoaciduria like Fanconi syndrome.&nbsp;<strong>Treatment</strong> <strong>with</strong> <strong>nicotinamide</strong> and a high-protein diet gives a good response in symptomatic patients.</p>\n<p>Other options:</p>\n<p>Option B:&nbsp;<strong>Benedict's test&nbsp;</strong>detects the excretion of<strong>&nbsp;reducing substances&nbsp;</strong>in the urine. About 0.5 ml of urine is boiled with 5 ml of Benedict's reagent for 2 minutes. The formation of a precipitate is observed on cooling. The test is semi-quantitative and the color of the precipitate roughly parallels the concentration of reducing sugar.</p>\n<p>Option C:&nbsp;<strong>Guthrie bacterial inhibition</strong>&nbsp;test is a screening test for phenylketonuria. This test uses a phenylalanine requiring strain of&nbsp;<strong><em>Bacillus subtilis.</em></strong></p>\n<p>Option D:&nbsp;<strong>Seliwanoff's test</strong>&nbsp;will&nbsp;<strong>distinguish glucose</strong>&nbsp;and&nbsp;<strong>fructose</strong>. The reagent is resorcinol in HCl. 3 ml of the reagent and 0.5 ml of urine are heated for 30 seconds up to a boiling point. A red color indicates the presence of fructose.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old male patient comes with multiple musculoskeletal complaints. Urine examination revealed blackish discoloration of urine on standing. Which of the following is not consistent with the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Calcification of the intervertebral discs is seen on imaging."
      },
      {
        "id": 2,
        "text": "It is a disorder of\u00a0tryptophan metabolism."
      },
      {
        "id": 3,
        "text": "Bluish-black pigmentation of the connective tissue is seen."
      },
      {
        "id": 4,
        "text": "It is inherited in an autosomal recessive manner."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario points to a diagnosis of alkaptonuria, which is an autosomal recessive disorder of&nbsp;<strong>tyrosine metabolism</strong>.<strong>&nbsp;</strong>Hence,&nbsp;<strong>Option B</strong> is not consistent with the diagnosis.&nbsp;</p>\n<p>Alkaptonuria develops due to a defect in&nbsp;<strong>homogentisate oxidase</strong>, an enzyme<strong>&nbsp;</strong>that oxidizes homogentisate to maleylacetoacetate.&nbsp;A defect in this enzyme leads to the accumulation of homogentisate, which is then excreted in the urine.&nbsp;</p>\n<p><strong>Hartnup disease</strong> is due to impaired intestinal and renal transport of <strong>tryptophan</strong>. The availability of tryptophan for the synthesis of niacin is reduced, which leads to&nbsp;<strong>pellagra-like</strong> manifestations.</p>\n<p>Alkaptonuria is characterized by homogentisic aciduria, ochronosis, and arthropathy (joint pain).</p>\n<p><strong>Homogentisic aciduria&nbsp;</strong>is the black discoloration of urine on prolonged exposure to air caused due to oxidation of the excreted homogentisate.&nbsp;</p>\n<p><strong>Arthritis</strong>&nbsp;generally begins in the third decade. Arthritis often begins in the spine and resembles ankylosing spondylitis in its large-joint distribution. Radiographs of the spine showing&nbsp;<strong>flattened</strong>&nbsp;and&nbsp;<strong>calcified intervertebral discs&nbsp;(Option A)</strong>&nbsp;are pathognomonic.</p>\n<p><strong>Ochronosis</strong>&nbsp;is <strong>bluish-black pigmentation in connective tissue&nbsp;(Option B)</strong> that generally occurs after the third decade of life. It occurs due to the accumulation of homogentisic acid and its oxidation products like benzoquinone acetic acid in connective tissue.</p>\n<p>Alkaptonuria is inherited in an&nbsp;<strong>autosomal recessive</strong>&nbsp;manner <strong>(Option D)</strong>.</p>\n<p>Diagnosis:&nbsp;<strong>Blackish discoloration</strong> of <strong>urine</strong> on standing is diagnostic of alkaptonuria (shown below). The ferric chloride test<strong>&nbsp;</strong>will be positive.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91b800ba6e0a4bbaa9233c2073b86841x512x358.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c2138e0a3be4956a6f97c4e46460777x408x267.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f24c19e813e4bad9c612beb6c866c97x972x1198.JPEG"
    ]
  },
  {
    "text": "A 5-year-old boy has a history of biting his fingers and lips. He has been diagnosed with hypoxanthine-guanine phosphoribosyltransferase deficiency. What is an unlikely feature to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated urine uric acid: creatinine"
      },
      {
        "id": 2,
        "text": "Basal ganglia involvement"
      },
      {
        "id": 3,
        "text": "Developmental delay"
      },
      {
        "id": 4,
        "text": "Decreased purine synthesis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient has<strong> Lesch Nyhan syndrome. </strong>Purine overproduction causes this syndrome; thus, decreased purine synthesis is unlikely to be seen in this patient.\u00a0\u00a0</p>\n<p><strong>Lesh Nyhan syndrome</strong> is an<strong> X-linked disorder </strong>of purine metabolism that results from the deficiency of<strong> HGPRT enzyme </strong>(hypoxanthine-guanine phosphoribosyltransferase). It is characterized by <strong>self-mutilation</strong> of fingers/mouth and <strong>dystonic movements</strong>. Other features include hyperuricemia, intellectual disability, and developmental delay (option c).</p>\n<p><strong>HGPRT</strong> enzyme is present in every cell but it is maximally present in <strong>basal ganglia</strong>, thus its deficiency affects basal ganglia by a reduction in its volume with loss of nigrostriatal terminals. This effect on the extrapyramidal system manifests as dystonic movements (option b).\u00a0</p>\n<p>Investigations reveal <strong>elevated serum uric acid, urine uric acid: creatinine ratio, </strong>and HGPRT enzyme deficiency (option a).</p>\n<p>The treatment mainstay is the prevention of renal failure by treating hyperuricemia with allopurinol/febuxostat and purine purine-restricted diet.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/764269fa534c4c6391df37e80cdd0bb3x1280x1203.JPEG"
    ]
  },
  {
    "text": "A young girl is brought with a deformity of the upper limbs. She has a history of multiple fractures and her father has a similar history since his childhood. The image of the patient's eye and the radiographs of the upper limb are shown below. Which of the following is defective in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Type 2 collagen"
      },
      {
        "id": 2,
        "text": "Type 4 collagen"
      },
      {
        "id": 3,
        "text": "Type 3 collagen"
      },
      {
        "id": 4,
        "text": "Type 1 collagen"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario and the image showing the<strong> blue sclera</strong> and <strong>bowing </strong>of the<strong> upper limbs</strong> are suggestive of<strong> osteogenesis imperfecta</strong> (OI). It occurs due to the <strong>defect</strong> in the <strong>formation</strong> of <strong>type 1 collagen</strong>.</p>\n<p>Osteogenesis imperfecta, also called\u00a0<strong>brittle bone disease,</strong>\u00a0is an <strong>autosomal dominant disorder. </strong>There are 8 types of osteogenesis imperfecta.<strong>\u00a0</strong>It\u00a0occurs most commonly due to <strong>mutation</strong> in the <strong>COL1A </strong>and <strong>COL2A genes.</strong> These mutations lead to the replacement of glycine amino acid with another amino acid resulting in an <strong>abnormal</strong> <strong>triple</strong> <strong>helix</strong> of <strong>collagen.</strong> This results in the abnormal formation of type 1 collagen.</p>\n<p>Since type 1 collagen is mainly present in the bone, ligament, dentin, and sclera, patients will present with\u00a0repeated fractures<strong>,</strong>\u00a0<strong>deformities of bone</strong>,\u00a0<strong>blue sclera</strong>, and\u00a0dental abnormalities.</p>\n<p>The image given below shows different metabolic disorders of the bone.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d442893ceb854b2090190d2434ff7dfa.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/617f4d04bfb048a7837cf3a52e281fbbx1280x1434.JPEG"
    ]
  },
  {
    "text": "A 33-year-old male comes to casualty with complaints of severe abdominal pain, nausea, and vomiting. The onset of complaints is acute and the pain radiates to the back. You collect blood for lab investigations, however, the EDTA tube appears as shown in the image below after a few hours. Further investigations reveal liposomal lipase deficiency. What is the likely diagnosis of the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Familial hypercholesterolemia"
      },
      {
        "id": 2,
        "text": "Familial dysbetalipoproteinemia"
      },
      {
        "id": 3,
        "text": "Familial hyperchylomicronemia"
      },
      {
        "id": 4,
        "text": "Abetalipoproteinemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has features of <strong>acute pancreatitis </strong>with blood showing a<strong> supernatant creamy layer</strong> after a few hours of collection and<strong> liposomal lipase enzyme deficiency</strong>. This points towards a diagnosis of<strong> hyperchylomicronemia syndrome (type 1 familial hyperlipoproteinemia).</strong></p>\n<p><strong>Familial chylomicronemia </strong>is an <strong>autosomal recessive </strong>disorder with<strong> liposomal lipase deficiency.</strong> Liposomal lipase enzyme is required for hydrolysis of triglycerides in chylomicrons and VLDL. Apo C II is the cofactor required for this enzyme.\u00a0Deficient liposomal lipase in familial hyperchylomicronemia leads to elevated triglycerides, mostly in chylomicrons(= chylomicronemia), and elevated VLDL. When the blood is drawn, it is turbid, and with time, the<strong> chylomicrons with triglycerides </strong>rise to the top, forming a <strong>creamy supernatant.</strong> Apo CII mutation may present similarly but is a rarer cause.\u00a0</p>\n<p>The patient has an elevated fasting triglyceride level (&gt;500 mg/dL) and presents with acute pancreatitis, eruptive xanthomas (small yellow-white papules present in clusters on the extensor surface, back, and buttocks), and lipemia retinalis(opalescent retinal blood vessels).</p>\n<p>Other options:-</p>\n<p><strong>Type II familial hyperlipoproteinemia </strong>caused by<strong> LDL receptor mutation </strong>is characterized by tendon xanthomas, raised triglycerides and LDL.</p>\n<p><strong>Type III hyperlipoproteinemia </strong>(familial dysbetalipoproteinemia) is caused by <strong>defective APOE</strong>, characterized by defective clearance of lipoprotein remnants in the liver. This increases serum chylomicron, VLDL, cholesterol, and triglycerides levels, causing xanthoma and vascular disease.</p>\n<p><strong>Abetalipoproteinemia </strong>is caused by an<strong> MTTP</strong> <strong>defect</strong> characterized by reduced serum cholesterol and triglycerides, negligible levels of chylomicron and VLDL, failure to thrive, and neurological manifestations due to a deficiency of fat-soluble vitamins.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/36ba5bcbe738430eb493f4329e284aa2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An infant was brought to OPD with complaints of copious nasal discharge. On examination, there was a clouding of the cornea and hepatomegaly. The developmental assessment showed significant delay. An x-ray of the chest was taken and is given below. Which of the following enzyme is defective in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Iduronate 2-sulphatase"
      },
      {
        "id": 2,
        "text": "Heparan sulfate-N-sulfatase"
      },
      {
        "id": 3,
        "text": "\u03b1-N-Acetylglucosaminidase"
      },
      {
        "id": 4,
        "text": "\u03b1-L-Iduronidase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given clinical scenario presence of corneal clouding with hepatomegaly with developmental delay and the X-ray showing <strong>oar-shaped ribs</strong> is suggestive of <strong>Hurler's syndrome</strong> and the enzyme deficient in this condition is&nbsp;<strong>&alpha;-L-Iduronidase.</strong></p>\n<p><strong>Hurler's syndrome&nbsp;</strong>is a&nbsp;<strong>severe</strong>&nbsp;type of mucopolysaccharidoses&nbsp;<strong>(MPS) - I</strong>. It is caused due to deficiency of&nbsp;<strong>&alpha;-L-iduronidase.&nbsp;</strong>This enzyme is required for the breakdown of <strong>dermatan and heparan sulfate</strong>. The deficiency of the enzyme leads to the accumulation of these mucopolysaccharides.&nbsp;</p>\n<p>Affected children usually present between&nbsp;<strong>6-24 months</strong> of age. Clinical features include <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>hepatosplenomegaly,</strong> coarse facial features, <strong>corneal clouding</strong>, large tongue, enlarged head circumference, joint stiffness, short stature, skeletal dysplasia, </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">recurrent upper respiratory tract and ear </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">infections, noisy breathing, and <strong>persistent copious nasal discharge. </strong>Children with Hurler's syndrome have <strong>impaired language function</strong> because of <strong>i</strong></span><strong>ntellectual disability</strong> which occurs due to the <strong>accumulation of heparan sulfate </strong>and combined <strong>conductive and sensorineural </strong>hearing loss.</p>\n<p><strong>Skeletal dysplasia,</strong> called dysostosis multiplex includes <strong>oar-shaped ribs(widening of anterior ribs)</strong>, ovoid vertebral bodies, enlarged diaphyses of the long bones, macrocephaly, and enlarged J-shaped sella.</p>\n<p>The image below shows <strong>coarse facial features</strong> and the radiograph shows&nbsp;<strong>enlarged diaphyses</strong>&nbsp;of the metacarpal and phalanges.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1145ee9064e441ab0c05967cc443a1a.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dde6608a05dd498b9e137195c96bf8c7x720x1757.JPEG"
    ]
  },
  {
    "text": "A child presents with lesions as shown in the image below. He also complained of decreased vision at night. Which of the following dose of vitamin A prophylaxis given to children under the vitamin A distribution scheme in India could have prevented this condition?",
    "choices": [
      {
        "id": 1,
        "text": "2,00,000 IU  given yearly between the ages 1-6 years"
      },
      {
        "id": 2,
        "text": "1,00,000 IU  given yearly between the ages 1-6 years"
      },
      {
        "id": 3,
        "text": "1,00,000 IU  given 6-monthly between the ages 1-6 years"
      },
      {
        "id": 4,
        "text": "2,00,000 IU given 6-monthly between the ages 1-6 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image above showing\u00a0<strong>phrynoderma\u00a0</strong>along with the history of decreased vision at night suggests a likely diagnosis of <strong>vitamin A deficiency</strong>. Under the <strong>vitamin-A distribution scheme </strong>in <strong>India</strong>, <strong>200000 IU </strong>of vitamin A are given orally at<strong> 6-monthly intervals </strong>between the ages<strong>\u00a0of 1 to 6 years</strong>.</p>\n<div class=\"page\" title=\"Page 1656\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1656\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Vitamin A deficiency</strong> can lead to mucocutaneous disease and result in various ocular complications, including blindness. The earliest signs of vitamin A deficiency are defective <strong>dark adaptation</strong> and <strong>night blindness </strong>(nyctalopia). Xerosis and scaling are commonly present in cutaneous findings.<strong> </strong></p>\n<p><strong>Phrynoderma</strong>, which is characterized by the presence of <strong>keratotic follicular papules</strong> over anterolateral thighs and <strong>posterolateral upper arms,</strong> is also seen.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1657\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Treatment</strong> is done by administering <strong>50,000\u20132,00,000 IU of daily vitamin A supplementation</strong> until clinical signs and symptoms resolve and serum retinol levels normalize.\u00a0</p>\n<p>The image below shows a Bitot's spot (due to vitamin A deficiency) seen as a foamy appearance on the surface of the conjunctiva:</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/74d0a3e5aee045689211be328f1f418c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e6afff1d0a2943f2b9be1fda9a8f900fx720x449.PNG"
    ]
  },
  {
    "text": "A scientist is trying to develop a drug for a genetic condition. He seeks a drug that could cause epigenetic alteration in the DNA and could prevent the disease or seemingly improve the condition. All the following would include epigenetic modifications, except _______.",
    "choices": [
      {
        "id": 1,
        "text": "Altering the gene sequence of DNA"
      },
      {
        "id": 2,
        "text": "Histone methylation"
      },
      {
        "id": 3,
        "text": "DNA methylation at CpG islands in promoter regions"
      },
      {
        "id": 4,
        "text": "Histone acetylation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Epigenetic changes </strong>are&nbsp;<strong>heritable chemical changes</strong> in <strong>gene expression&nbsp;</strong>that are&nbsp;not&nbsp;caused by the&nbsp;alteration in the gene sequence. They&nbsp;<strong>alter&nbsp;</strong>gene <strong>expression without mutation</strong>.</p>\n<p>The term &ldquo;epigenetics&rdquo; means &ldquo;above genetics.&rdquo; It refers to the regulatory mechanisms that <strong>do not change</strong> the<strong> underlying regulated DNA sequence</strong>, but rather <strong>change </strong>the<strong> expression patterns</strong>, or<strong> function</strong>, of the DNA. Epigenetic mechanisms play key roles in the establishment, maintenance, and reversibility of transcriptional states. It can&nbsp;cause <strong>both&nbsp;gene activation </strong>and <strong>inactivation</strong>.</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Epigenetic modifications include</p>\n<ol>\n<li><strong>DNA methylation- </strong>It&nbsp;is the covalent addition and subtraction of a methyl group to DNA. Methylation is typically done in&nbsp;cytosine preceding a guanine (<strong>CpG)</strong> dinucleotides. CpG islands are mainly present in the <strong>promoter</strong> region.</li>\n<li><strong>Histone modifications</strong> such as <strong>acetylation</strong>,&nbsp;deacetylation,<strong>&nbsp;methylation,</strong>&nbsp;phosphorylation, etc. Acetylation of histone activates transcription, while deacetylation represses transcription.</li>\n<li><strong>miRNA-&nbsp;</strong>micro RNA or miRNA are approximately 22 nucleotides long. They do not code. They bind to mRNA and inhibit its translation.</li>\n</ol>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly patient on a vegetarian diet presenting with easy fatigability and pallor was investigated. Peripheral smear showed findings of macrocytic anemia. Investigations reveal elevated serum homocysteine levels and normal serum methylmalonic acid levels. What is the probable cause of anemia in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B9 deficiency"
      },
      {
        "id": 2,
        "text": "Vitamin B12 deficiency"
      },
      {
        "id": 3,
        "text": "Vitamin B1 deficiency"
      },
      {
        "id": 4,
        "text": "Vitamin B6 deficiency"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of megaloblastic <strong>anemia</strong> in a vegetarian with <strong>elevated</strong> homocysteine levels and <strong>normal </strong>serum methylmalonic acid (MMA) levels is due to folic acid deficiency.</p>\n<p><strong>Folic acid</strong> (vitamin\u00a0<strong>B9</strong>) is a <strong>water-soluble</strong> vitamin, and its <strong>active form</strong> is tetrahydrofolate (<strong>THFA</strong>). It acts as a carrier of\u00a0<strong>one-carbon groups.\u00a0</strong>THFA is involved in the formation of many <strong>coenzymes</strong> in metabolic systems, particularly for <strong>purine</strong> and <strong>pyrimidine synthesis</strong>, nucleoprotein synthesis, and maintenance in erythropoiesis.</p>\n<p>Folate deficiency results in megaloblastic anemia, homocysteinemia, and <strong>neural tube defects</strong>\u00a0(spina bifida, Anencephaly) in the fetus.</p>\n<p>Folic acid deficiency is associated with the following clinical and laboratory findings:</p>\n<ul>\n<li><strong>Raised MCV</strong> (normal range: 80\u2013100 fL)\u00a0- <strong>macrocytosis</strong></li>\n<li><strong>Decrease </strong>in<strong> hemoglobin </strong>and <strong>hematocrit levels.</strong></li>\n<li><strong>Normal MMA </strong>level</li>\n<li><strong>Elevated homocysteine </strong>levels<strong>.</strong></li>\n</ul>\n<p>where MCV<strong>\u00a0</strong>is<strong>\u00a0</strong>the\u00a0mean corpuscular volume.</p>\n<p>Patients with folate deficiency should be offered <strong>supplemental folic acid</strong> for the correction of the deficiency. Typically, oral folic acid (1 to 5 mg daily) suffices to treat folate deficiency\u00a0</p>\n<p>Other options:</p>\n<p>Option B:\u00a0<strong>Vitamin B12</strong> or<strong> cobalamin</strong>\u00a0deficiency presents as<strong>\u00a0anemia</strong>, fatigue, and pallor symptoms. Other presenting complaints may include\u00a0<strong>peripheral neuropathy</strong>,\u00a0glossitis, diarrhea, headaches, neuropsychiatric disturbances like\u00a0dementia, and\u00a0<strong>subacute combined degeneration of the spinal cord</strong> (SACD) leading to ataxia. A peripheral smear shows macrocytic anemia and hypersegmented neutrophils. Vitamin B12 deficiency is associated with <strong>raised </strong>serum methylmalonic acid (MMA) levels.</p>\n<p>Option C: A patient with <strong>thiamine </strong>or\u00a0<strong>vitamin B1</strong>\u00a0deficiency presents either\u00a0<strong>dry Beriberi</strong>\u00a0with\u00a0<strong>predominantly neurological</strong>\u00a0symptoms like\u00a0<strong>neuropathy</strong>, muscle weakness, and wasting or\u00a0<strong>wet Beriberi</strong>\u00a0with predominant cardiac symptoms like <strong>cardiomegaly</strong>, tachycardia, high output congestive cardiac failure.</p>\n<p>Option D: A patient with <strong>pyridoxine or</strong>\u00a0<strong>vitamin B6</strong>\u00a0deficiency presents with symptoms of seborrhea, glossitis, convulsions, neuropathy, depression, confusion, and\u00a0<strong>normocytic</strong>\u00a0<strong>anemia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female patient underwent trucut biopsy of a breast lump. The following test was done on the specimen to confirm HER2 neu mutation. Identify the technique used.",
    "choices": [
      {
        "id": 1,
        "text": "Fluorescent in situ hybridisation"
      },
      {
        "id": 2,
        "text": "Karyotyping"
      },
      {
        "id": 3,
        "text": "Immunohistochemistry"
      },
      {
        "id": 4,
        "text": "Microarray"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The technique shown in the image is <strong>f</strong><strong class=\"ng-binding\">luorescent in situ hybridization </strong>(FISH).</p>\n<p>FISH<strong class=\"ng-binding\">&nbsp;</strong>is a technique where cells are stained with <strong>fluorescent stains</strong>. It uses DNA probes that recognize sequences specific to particular chromosomal regions. FISH can be performed on <strong>prenatal samples</strong>, peripheral blood cells, touch preparations from cancer biopsies, and even fixed archival tissue sections. Uses include :</p>\n<ul>\n<li><strong>Numerical abnormalities</strong> of chromosomes e.g., aneuploidy.</li>\n<li>Subtle <strong>microdeletions </strong>and<strong>&nbsp;rearrangements</strong>.</li>\n<li>Complex <strong>translocations</strong> that are not demonstrable by routine karyotyping.</li>\n<li><strong>Gene amplification</strong>&nbsp;of HER2 in breast cancer or NMYC amplification in neuroblastomas.</li>\n</ul>\n<p>Other options:</p>\n<p>Option B:&nbsp;<strong>Karyotyping</strong>&nbsp;is the process by which chromosomes are isolated, stained, and examined to find chromosomal anomalies. It is used in prenatal diagnosis, <strong>investigation of repeat pregnancy loss</strong>, investigation of children and adults suspected of having a chromosomal disorder, and subtyping of lymphomas and leukemias for the purpose of exact diagnosis, giving a&nbsp;prognosis, and treatment.</p>\n<p>The karyotyping of a normal human male is given below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a4167d4db9a443e6b06da74ae3086aff.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bda1837e4df41da95a780816883d72ax1280x979.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd644d7d31584a419114e794cbfe5ffdx1280x963.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4513da0aab93417b9539d90522f33456x1280x1280.JPEG"
    ]
  }
];
        let quizName = 'Integrated Mini Test 6 - Biochemistry';
        const quizFilename = 'integrated-mini-test-6-biochemistry-6e2c6356.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>