<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>250 Orthopedics Ini-Cet 2022 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Orthopedics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">17</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The most common pattern of involvement in Pott's spine is",
    "choices": [
      {
        "id": 1,
        "text": "Paradiscal"
      },
      {
        "id": 2,
        "text": "Central"
      },
      {
        "id": 3,
        "text": "Anterior"
      },
      {
        "id": 4,
        "text": "Posterior"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Clinical features</strong>&nbsp;of spinal tuberculosis:</p>\n<ul>\n<li>Back&nbsp;<strong>pain,</strong>&nbsp;<strong>stiffness&nbsp;</strong>and reduced movements&nbsp;are the usual early complaints</li>\n<li><strong>Cautious</strong>&nbsp;<strong>gait&nbsp;</strong>-&nbsp;a person with spinal tuberculosis will walk carefully with short steps to avoid pain resulting from movement</li>\n<li>Pott's paraplegia</li>\n<li>Cold abscess</li>\n<li><strong>Concertina collapse</strong> - a type of compression fracture without involvement of the interverterbral disc</li>\n<li>Deformity - <strong>kyphus</strong> and <strong>gibbus</strong> (gradually increasing prominence).</li>\n</ul>\n<p>Images showing concertina collapse and the deformities seen TB spine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aff31a53e9934371b590fdbb68b7cea3x1280x1484.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87631c3ed5714b1aae6168264ce61530x1280x3667.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0a4667442254fe5a6f12e50518ddbdbx1280x1968.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/81202c7073ea417a9ce53137a562baaex1279x2309.JPEG"
    ]
  },
  {
    "text": "Anterior dislocation of the shoulder is likely to result in the damage of which of the following nerves?",
    "choices": [
      {
        "id": 1,
        "text": "Axillary nerve"
      },
      {
        "id": 2,
        "text": "Median nerve"
      },
      {
        "id": 3,
        "text": "Radial nerve"
      },
      {
        "id": 4,
        "text": "Suprascapular nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Anterior shoulder dislocation</strong> is most likely to damage the <strong>axillary nerve</strong>.</p>\n<p>Axillary nerve injury presents with an <strong>anaesthetic patch</strong> over the deltoid muscle, and <strong>deltoid muscle weakness</strong> (inability to abduct at the shoulder joint). It is usually a <strong>neuropraxia</strong> type of injury and resolves spontaneously. Other nerves that can be injured include the radial nerve, musculocutaneous nerve, median nerve or ulnar nerve.</p>\n<p>Other complications of anterior dislocation of the shoulder joint:</p>\n<ul>\n<li>Early complications\n<ul>\n<li><strong>Rotator cuff injury </strong>is seen in older people and presents with difficult abduction (palpable contraction of deltoid muscle rules out nerve injury).</li>\n<li><strong>Vascular injury</strong>: <strong>Axillary artery</strong> may be injured, especially in <strong>older</strong> individuals, either at the time of injury or during the reduction.</li>\n<li><strong>Fracture-dislocation</strong>: There may be an associated fracture of the humerus (e.g. greater tuberosity) due to the traumatic injury. This may require open reduction and internal fixation.</li>\n</ul>\n</li>\n<li>Late complications\n<ul>\n<li><strong>Recurrent dislocations</strong>: Most common sequelae of anterior dislocation. Usually seen when there is associated injury to the<strong> glenoid labrum</strong> or <strong>stripping of the capsule</strong> is present.</li>\n<li>Shoulder stiffness: Due to prolonged immobilization.</li>\n<li>Untreated dislocation: Sometimes it may go unnoticed, especially in older and unconscious individuals. The reduction can be tried up to 6 weeks after the dislocation, after which 'active neglect' (no treatment) is followed.</li>\n</ul>\n</li>\n</ul>\n<p>Radiograph showing anterior dislocation with<strong> humeral head&nbsp;</strong>lying&nbsp;<strong>below</strong>&nbsp;and&nbsp;<strong>medial</strong>&nbsp;<strong>to</strong>&nbsp;the&nbsp;<strong>glenoid</strong>&nbsp;socket.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb53cf0258c24082b19d03367a0634aax720x1158.JPEG"
    ]
  },
  {
    "text": "A 60 year old patient presents with limping gait and left hip pain. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculosis of the hip"
      },
      {
        "id": 2,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 3,
        "text": "Ankylosing spondylitis"
      },
      {
        "id": 4,
        "text": "Avascular necrosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario of <strong>limping gait</strong> and left<strong> hip pain</strong> with radiographic findings of the radiolucency and distorted articular surface is suggestive of <strong>avascular necrosis of the head of femur.</strong></p>\n<p>Avascular necrosis (AVN) or <strong>osteonecrosis</strong> is a painful bone condition as a result of diminished blood supply mainly due to trauma or non-traumatic etiologies.&nbsp;</p>\n<p>The typical features are pain with movements in or near the joint, click in the joint, joint stiffness, limping gait, and deformity. Restriction of movements is also a feature of this condition.</p>\n<p>An x-ray shows reactive new bone formation,<strong> increased radiolucency</strong> in the subchondral bone, and&nbsp;a<strong> distorted articular surface</strong>.</p>\n<p><strong>MRI</strong> is the investigation of choice. It allows the identification of AVN of the femoral head and also determines the exact stage and extent of the pathologic process.</p>\n<p>Management is based on <strong>Ficat and Arlet Classification:&nbsp;</strong></p>\n<table>\n<tbody>\n<tr>\n<td><strong>Stage</strong>&nbsp;</td>\n<td><strong>Findings</strong>&nbsp;</td>\n<td><strong>Management</strong>&nbsp;</td>\n<td><strong>Method</strong>&nbsp;</td>\n</tr>\n<tr>\n<td>1</td>\n<td>X-ray normal, MRI +ve</td>\n<td>Conservative&nbsp;</td>\n<td>Bisphosphonates&nbsp;</td>\n</tr>\n<tr>\n<td>2a</td>\n<td>X-ray: sclerosis, cysts, no collapse&nbsp;</td>\n<td>Conservative&nbsp;</td>\n<td>Bisphosphonates&nbsp;</td>\n</tr>\n<tr>\n<td>2b</td>\n<td>X-ray: crescent sign, no collapse&nbsp;</td>\n<td>Surgical decompression&nbsp;</td>\n<td>Core decompression&nbsp;</td>\n</tr>\n<tr>\n<td>3&nbsp;</td>\n<td>Collapse+loss of sphericity&nbsp;</td>\n<td>Surgical&nbsp;</td>\n<td>Osteotomy&nbsp;</td>\n</tr>\n<tr>\n<td>4&nbsp;</td>\n<td>Advanced arthritis&nbsp;</td>\n<td>Reconstructive&nbsp;</td>\n<td>Total hip replacement&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>Other options:&nbsp;</p>\n<p>Option A:&nbsp;<strong>Tuberculosis of the hip</strong> is characterized by painful and restricted movements of the hip. The radiographic findings are&nbsp;not appreciable in the early stages. But late stages show <strong>periarticular osteoporosis</strong>, hazy, and irregular joint margins with a reduction in the joint space, and<strong> wandering</strong> <strong>acetabulum</strong>.&nbsp;</p>\n<p>Option B:&nbsp;<strong>Rheumatoid arthritis </strong>(RA) is usually seen in <strong>females</strong>&nbsp;in the <strong>4th </strong>to<strong> 5th decade</strong>. Patients present with symmetrical polyarthritis of the <strong>proximal finger joints</strong>, tenosynovitis, <strong>early morning stiffness</strong> and<strong> pain.</strong>&nbsp;RA of the hip can be bilateral. Radiographic findings such as<strong> joint space</strong> <strong>narrowing</strong> due to hyaline cartilage destruction, cyst formation, and acetabular protrusion-type deformity can be seen.</p>\n<p>Option C: <strong>Ankylosing spondylitis</strong> is a chronic inflammatory disease of the spine and sacroiliac joint. It typically occurs in the age group <strong>15-25 years</strong> with a male preponderance. Features include <strong>backache, stiffness, sciatica, </strong>and<strong> fixed flexion contracture.</strong>&nbsp;Radiographic findings show erosion of sacroiliac joints, squaring, and bridging of the vertebral body leading to a <strong>bamboo spine appearance</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4d99ed053c740f89ffd942b56104a07.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old man came with complaints of unilateral knee pain. X-ray examination showed reduced joint space. Pathological findings shown below are of:",
    "choices": [
      {
        "id": 1,
        "text": "Osteoarthritis"
      },
      {
        "id": 2,
        "text": "Tuberculosis of the knee"
      },
      {
        "id": 3,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 4,
        "text": "Lyme disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Lyme disease</strong> is a tick-borne infection with skin lesions and flu-like symptoms. It presents with asymmetric inflammatory polyarthritis of the large joints when left untreated.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b3cd8d40fce84e749baab3620dd6e69b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/041949e21b904c12b1f5f3e579bdb4b0x640x481.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b49cc453ea5479585ffc1ba885607c8x1280x853.JPEG"
    ]
  },
  {
    "text": "Which of the following is false regarding hip dislocation?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior dislocation of hip has flexion and adduction"
      },
      {
        "id": 2,
        "text": "Vessel injury more common in anterior"
      },
      {
        "id": 3,
        "text": "Nerve injury more common in anterior"
      },
      {
        "id": 4,
        "text": "Posterior dislocation is more common than anterior"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Statement C</strong> is false. Nerve injury is more common in\u00a0<strong>posterior hip</strong> <strong>dislocation.</strong>\u00a0The <strong>sciatic nerve</strong>, lying <strong>behind</strong> the posterior wall of the acetabulum is most commonly involved here.</p>\n<p><strong>Sciatic nerve injury</strong> is seen in 10-20 % of cases with posterior hip dislocation. It is usually a <strong>neuropraxia</strong> type of injury and resolves spontaneously. But, if it is suspected after a reduction maneuver, immediate exploration must be carried out.</p>\n<p><strong>Posterior hip dislocation</strong> is the\u00a0<strong>commonest </strong>type of hip dislocation (80%), commonly seen following dashboard injuries. The patient presents with <strong>flexion, adduction, and internal rotation</strong> deformities.</p>\n<p>X-ray findings include:</p>\n<ul>\n<li>Femoral head lying above and behind the acetabulum and appears <strong>smaller</strong> than normal</li>\n<li><strong>Lesser trochanter</strong>\u00a0is\u00a0<strong>not visualized</strong> as the thigh is internally rotated</li>\n<li>Femoral head and posterior acetabular wall fractures may also be seen</li>\n</ul>\n<p><strong>Treatment\u00a0</strong>includes<strong>\u00a0</strong>an <strong>early reduction</strong> to reduce the risk of osteonecrosis and osteoarthritis.\u00a0<strong>Closed reduction</strong>\u00a0under sedation or general anaesthesia is done in most cases. If there is an associated\u00a0<strong>femoral neck fracture</strong>, the\u00a0<strong>closed reduction</strong>\u00a0<strong>should not be attempted</strong>\u00a0as it can lead to the displacement of the femoral neck and disrupt the blood supply to the femoral head.</p>\n<p><strong>Anterior hip dislocation\u00a0</strong>is less common than posterior hip dislocations and accounts for about 10-20% of all hip dislocations. This injury is usually sustained following a high-energy accident. The affected limb in this condition will be<strong>\u00a0abducted, externally rotated, and slightly flexed.</strong></p>\n<p><strong>Note</strong>: Although vascular injuries are seen in posterior dislocations as well, they are most likely with anterior dislocation. This is because of the femoral artery lying anterior to the head. (statement B)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6a3cf4b848244b12bf9da7c77ad2899cx720x553.PNG"
    ]
  },
  {
    "text": "A 35-year-old man presented with knee pain. The x-ray of his knee joint is given below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chondroblastoma"
      },
      {
        "id": 2,
        "text": "Osteochondroma"
      },
      {
        "id": 3,
        "text": "Osteoclastoma"
      },
      {
        "id": 4,
        "text": "Fibrous dysplasia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows the common locations of various bone tumors:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6a305aafbdbe4dabaa1eb56cab66a55d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2b925f79ed9404b9e3d33fca9fe8890x1280x1184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd98dd4298c94c38af85c85f8d6a98fex621x747.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/24482c8423fb4c2eb0bd7f995f2cf0b2x720x1299.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/101f0792357e4e3cb3fc4495c9108db8x1280x2072.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb13ce9c98a847948d20a213075101fcx1279x1560.JPEG"
    ]
  },
  {
    "text": "Book test is used to assess the function of adductor pollicis. Which of the following nerves supplies this muscle?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior interosseous nerve"
      },
      {
        "id": 2,
        "text": "Ulnar nerve"
      },
      {
        "id": 3,
        "text": "Radial nerve"
      },
      {
        "id": 4,
        "text": "Median nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>deep terminal branch</strong> of the <strong>ulnar nerve</strong> supplies the adductor pollicis muscle.</p>\n<p>A<strong> positive book test </strong>or<strong>&nbsp;Froment's&nbsp;sign </strong>indicates<strong>&nbsp;weakness of the adductor pollicis muscle</strong>, due to ulnar nerve weakness.</p>\n<p>In this test, the patient is asked to hold a book between the thumb and index finger against resistance, and the sign is positive if there is&nbsp;<strong>flexion</strong> at the <strong>interphalangeal joint</strong>. This is because if the weakness of&nbsp;<strong>adductor pollicis </strong>is present, thumb adduction is weak; the&nbsp;<strong>flexor pollicis longus</strong>&nbsp;muscle <strong>compensates</strong> for this weakness by inducing flexion of the interphalangeal joint.</p>\n<div class=\"page\" title=\"Page 321\">Adduction paralysis occurs as a result of&nbsp;<strong>low lesions</strong> of the ulnar nerve, which are commonly caused by cuts on shattered glass. The patient has <strong>numbness</strong> in the <strong>medial&nbsp;one-and-a-half fingers</strong>. The hand assumes the <strong>claw-hand deformity</strong>, with hyperextension of the metacarpophalangeal joints of the ring and little fingers, due to weakness of the intrinsic muscles. Hypothenar and interosseous wasting may be seen in the affected hand when compared to the normal hand.</div>\n<div class=\"page\" title=\"Page 321\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The image below shows the test being demonstrated:</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e20fec6237e74727ae6993deb5d2c422x720x456.JPEG"
    ]
  },
  {
    "text": "A 6-year-old girl sustained a fracture of the lateral condyle of the humerus which led to the development of elbow deformity. Which of the following findings can be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ape thumb deformity"
      },
      {
        "id": 2,
        "text": "Pointing index sign"
      },
      {
        "id": 3,
        "text": "Inability to adduct the fingers"
      },
      {
        "id": 4,
        "text": "Kiloh-Nevin sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Ape thumb deformity&nbsp;</strong>is characterized by the inability to abduct the thumb due to paralysis of<strong>&nbsp;the thenar</strong>&nbsp;<strong>muscles</strong> supplied by the median nerve. The thumb remains in the same plane as the wrist.&nbsp;</p>\n<p>Option B:&nbsp;In&nbsp;<strong>median nerve injury </strong>of the forearm or elbow, there is paralysis of long flexors of the digits. This leads to the characteristic <strong>pointing index finger</strong>.</p>\n<p>Option C: The inability to perform the 'OK' sign is called as&nbsp;<strong>Kiloh Nevin sign. </strong>It is<strong>&nbsp;</strong>seen in the involvement of the&nbsp;<strong>anterior interosseous nerve</strong>.&nbsp;The patient is unable to bend the terminal phalanx of the thumb and index finger joints due to weakness of the <strong>flexor pollicis longus</strong> and lateral half <strong>flexor digitorum profundus</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/075032e5184741db9838274dc8ccceeex1280x1508.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae6e924757bf4462a2bf2f9b5fd4a34bx1280x1335.JPEG"
    ]
  },
  {
    "text": "A 65-year-old postmenopausal female patient comes with persistent backache not responding to conservative treatment. She has a history of lifting heavy weights 4 months back and progressively increasing pain that worsens on walking. The pain starts radiating down her legs after walking for a distance of around 100 m. However, she feels no pain on walking uphill. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoporotic compression fracture"
      },
      {
        "id": 2,
        "text": "Lumbar stenosis"
      },
      {
        "id": 3,
        "text": "Thromboangiitis obliterans"
      },
      {
        "id": 4,
        "text": "Atherosclerosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an old woman with <strong>back pain</strong>&nbsp;that <strong>worsens on walking</strong> and <strong>relieves walking uphill</strong> points to the diagnosis of<strong>&nbsp;lumbar stenosis</strong>.&nbsp;</p>\n<p><strong>Walking uphill</strong> may be <strong>preferred</strong> as it flexes the spine and <strong>maximizes the spinal canal capacity</strong>,&nbsp;relieving the pain.&nbsp;</p>\n<p><strong>Spinal stenosis</strong> is the narrowing of the spinal canal, causing nerve compression. It can be congenital or acquired, with<strong> degeneration</strong> being the <strong>most common cause</strong>. Other factors include conditions like spondylolysis, trauma, infection, and metabolic disorders.&nbsp;</p>\n<p>Degenerative spinal stenosis involves&nbsp;disc degeneration, facet joint hypertrophy, and ligamentum flavum calcification. These changes lead to <strong>reduced</strong> spinal canal dimensions and <strong>compression</strong> of the nerves resulting in <strong>neurogenic claudication</strong>.&nbsp;</p>\n<p>They present with symptoms such as <strong>back pain</strong> (most common), <strong>sciatica</strong>, sensory disturbances in the legs, motor weakness, and sometimes urinary disturbances. <strong>Pain</strong> typically occurs after <strong>standing or walking</strong> for a few minutes and is <strong>relieved by sitting, squatting</strong>, or <strong>flexing the spine</strong>.&nbsp;</p>\n<p><strong>MRI</strong> is the imaging method of choice for the investigation of spinal stenosis.&nbsp;<strong>Conservative treatment</strong> is the<strong> first line</strong> for spinal stenosis, including reassurance, pain relief, exercise, and activity modification.</p>\n<p><strong>Surgery</strong> is considered if conservative measures fail and there is significant functional impairment and severe neurological symptoms. <strong>Posterior</strong> <strong>decompression</strong> is the surgical method. <strong>Laminectomy</strong> is performed for central stenosis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Disruption of the axon with an intact endoneurium is seen in which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Neurapraxia"
      },
      {
        "id": 2,
        "text": "Axonapraxia"
      },
      {
        "id": 3,
        "text": "Axonotmesis"
      },
      {
        "id": 4,
        "text": "Neurotmesis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Disruption of the axon with an intact endoneurium is seen in<strong>&nbsp;axonotmesis.</strong>&nbsp;There is an&nbsp;<strong>axonal disruption&nbsp;</strong>(inner axon is damaged) and loss of conductivity, with an intact outer sheath.&nbsp;</p>\n<p><strong>Axonotmesis</strong> (axonal interruption): There is a&nbsp;<strong>loss of conduction</strong>, but the <strong>continuity of the nerve is maintained</strong> and the neural tubes are intact.&nbsp;There is <strong>disruption of the axon</strong> i.e., the continuity of the axon is broken. But the <strong>endoneurium</strong> and perineurium are <strong>intact</strong>, maintaining the continuity of the nerve. It occurs following trauma such as <strong>closed</strong>&nbsp;<strong>fractures and dislocations</strong>.</p>\n<p>Distal to the lesion,&nbsp;<strong>Wallerian degeneration</strong> of the disrupted axon occurs, where axons disintegrate and are resorbed by phagocytes. It is then followed by axonal regeneration where numerous fine unmyelinated fibres grow from the proximal stumps to the endoneurial tubes.</p>\n<p>Other options:</p>\n<p>Option A- <strong>Neurapraxia </strong>is the&nbsp;reversible <strong>physiological nerve conduction block</strong> causing some loss of sensation and muscle power. There is spontaneous recovery after a few days or weeks. It occurs following <strong>prolonged compression</strong>, as in Saturday night palsy, and crutch palsy. Here, there is&nbsp;<strong>segmental demyelination</strong> but the <strong>axon is intact</strong>. Nerve conduction is&nbsp;slowed because of the loss of myelin. It is followed by the regeneration of the myelin.</p>\n<p><strong>Option B- Neurotmesis </strong>is the complete transection of the nerve trunk. It is usually associated with open wounds. The endoneurial tubes are destroyed and the scar tissue prevents the regenerating axons from entering the distal segment. The regenerating fibers mingle with proliferating Schwann cells and fibroblasts to form a neuroma at the site of injury.</p>\n<p><strong>Option D- Axonapraxia</strong>&nbsp;is a disruption to the axoplasmic flow of neurochemicals temporarily.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the OPD with Trendelenburg sign positive on one side. Which of the following muscles are involved?",
    "choices": [
      {
        "id": 1,
        "text": "2 only"
      },
      {
        "id": 2,
        "text": "1,3"
      },
      {
        "id": 3,
        "text": "2,4"
      },
      {
        "id": 4,
        "text": "1,4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The muscles involved in a <strong>positive Trendelenburg</strong> sign are the <strong>hip abductors</strong>\u2014the <strong>gluteus medius</strong> and <strong>gluteus minimus</strong>.</p>\n<p>The gluteus medius and minimus are powerful abductors of the hip supplied by the <strong>s</strong><strong>uperior gluteal nerve</strong>. Stabilizing the pelvis on the femur during walking is done by these muscles. It is demonstrated by asking the subject to stand on one limb. If the <strong>ipsilateral abductors are normal</strong>, the pelvis remains in a <strong>horizontal position</strong>. If the <strong>ipsilateral</strong> <strong>abductors are weak</strong>, then the <strong>pelvis tilts towards the opposite</strong> (unsupported) side. This is called <strong>positive Trendelenburg\u2019s sign</strong>.</p>\n<p>Other causes of positive Trendelenburg signs include <strong>shortening</strong> of the <strong>femoral neck,</strong> abductor tendon rupture, and <strong>dislocation</strong> or <strong>subluxation</strong> of the hip joint.\u00a0</p>\n<p>Patients are known to have a characteristic gait, which is called <strong>Trendelenburg</strong> or <strong>waddling gait.\u00a0</strong>The trunk is thrown from side to side with each step, and the patient <strong>lurches toward</strong> the <strong>affected limb</strong> while walking.</p>\n<p>The image below depicts Trendelenburg's gait.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7026cc757bb14f768d2c9586586d80c3x1280x4280.JPEG"
    ]
  },
  {
    "text": "You visit a newborn near your house and notice that the baby has CTEV, as shown below. When would you advise the baby's parents for a consultation to put on a cast?",
    "choices": [
      {
        "id": 1,
        "text": "In 1 month"
      },
      {
        "id": 2,
        "text": "In 6 months"
      },
      {
        "id": 3,
        "text": "In a few days"
      },
      {
        "id": 4,
        "text": "When the child starts walking"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image below shows the CTEV shoes:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/afd8a981bca546acb21ee078341b4cf7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e59e90661cd9489da70e48c66b033465x720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f1dac6a8b584f309c6f4575ff1db633x1200x1399.JPEG"
    ]
  },
  {
    "text": "Combination of appearance in CTEV",
    "choices": [
      {
        "id": 1,
        "text": "Equinus, eversion, forefoot adduction, cavus"
      },
      {
        "id": 2,
        "text": "Equinus, inversion, forefoot adduction, cavus"
      },
      {
        "id": 3,
        "text": "Equinus, eversion, forefoot abduction, cavus"
      },
      {
        "id": 4,
        "text": "Equinus, inversion, forefoot adduction, planus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;<strong>Ponseti's method</strong> is a successful method of manipulation in CTEV. It should begin as early as the <strong>first 2 weeks </strong>after <strong>birth</strong>. Weekly manipulation of the foot is done with the help of plaster casts.&nbsp;The order of correction according to <strong>Ponseti's method</strong> is <strong>cavus-adduction-varus-equinus&nbsp;</strong>(CAVE).</p>\n<p>The <strong>first metatarsal</strong> is <strong>elevated</strong>&nbsp;initially to correct the <strong>cavus</strong>. This creates a flat longitudinal medial border of the foot. Then, the<strong> forefoot</strong> is <strong>abducted</strong> in the plane of the <strong>metatarsals</strong>. This everts the hindfoot and corrects the forefoot out of supination. Finally, the <strong>equinus</strong> is corrected by <strong>dorsiflexing</strong> the foot at the<strong> ankle joint</strong>. In most cases, a <strong>percutaneous Achilles' tenotomy</strong> is required later for complete correction of the equinus deformity.&nbsp;</p>\n<p>Typically,<strong> five casts</strong> are required for correction, followed by a cast for 3 weeks. After correction, a <strong>foot abduction brace</strong> (FAB) is used to maintain the corrected position,<strong> initially full-time</strong> (for 3 months) and then<strong> night-time</strong> and <strong>nap-time for 4 years</strong>. This helps prevent relapse of the deformity.&nbsp;<strong>CTEV shoes</strong> are worn during the day once the child starts walking for <strong>up to 5 years</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82f399c414fc44e2b2490c082abb40e7x720x540.JPEG"
    ]
  },
  {
    "text": "A child presents with poor growth and swelling at joints. A radiograph of his wrist is given below. Lab investigations reveal serum ALP levels of >1500. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Scurvy"
      },
      {
        "id": 2,
        "text": "Rickets"
      },
      {
        "id": 3,
        "text": "Osteogenesis imperfecta"
      },
      {
        "id": 4,
        "text": "Paget's disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;</p>\n<p>The laboratory findings on vitamin D deficiency rickets would be <strong>normal/decreased serum calcium</strong>, decreased phosphorous, <strong>elevated PTH</strong>, and <strong>increased ALP</strong> levels. Thickening and <strong>widening of the growth plate</strong>, <strong>cupping</strong> of the metaphysis, and potential <strong>bowing of the diaphysis</strong> are seen on X-ray.&nbsp;</p>\n<p>Children with nutritional vitamin D deficiency should receive vitamin D supplementation and ensure adequate intake of calcium and phosphorus. Two strategies for vitamin D administration are <strong>stoss therapy</strong> (300,000-600,000 IU over 1 day) and <strong>daily supplementation</strong> (2,000 IU/day for at least 3 months).&nbsp;</p>\n<p>Other options:</p>\n<p>Option A:<strong> Scurvy</strong> is caused by<strong> vitamin C deficiency</strong>, resulting in bleeding tendencies and various manifestations such as petechiae, gum bleeding, and scorbutic rosary. Radiographically, it shows characteristic findings like the <strong>white line of Frankel,&nbsp;Pelkan spurs</strong>, and <strong>periosteal elevation</strong>.</p>\n<p>Option C: <strong>Osteogenesis imperfecta</strong> (Brittle bone disease) is caused by deficiencies in the synthesis of <strong>type I collagen</strong>. It&nbsp;presents with the hallmark features of osteoporosis with <strong>increased fragility</strong> of bones along with<strong> blue sclera</strong>, dental fragility as well as hearing loss.</p>\n<p>Option D: <strong>Paget's disease</strong> of the bone&nbsp;is a condition where there is an <strong>increased bone turnover</strong> followed by enlargement and thickening of the bone. In this condition,&nbsp;calcium levels are normal with <strong>raised ALP</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b96ba0de255c405891527173735b0de5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8304d32eb63241a79bb599822608ba51x1280x1326.JPEG"
    ]
  },
  {
    "text": "What is not required on an emergency basis in an open fracture?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "2 only"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "2 and 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Emergency management</strong> of open fractures is mainly focused on the\u00a0prevention of infection by providing\u00a0<strong>antibiotic coverage</strong> and <strong>splinting </strong>(statements 3 and 4). <strong>Reduction</strong> of the fracture (statement 1) can be done in the emergency room.<strong> Internal fixation</strong> is <strong>not done</strong> on an emergency basis for an <strong>open fracture</strong> due to the <strong>risk of infection </strong>(statement 2). It\u00a0is a part of <strong>definitive</strong> management and is done after the patient is stabilized.</p>\n<p>Open fractures are\u00a0characterized by a break in the overlying skin and soft tissues. Hence, the fracture fragment is exposed to the external environment. There\u00a0are more prone to be\u00a0<strong>infected</strong>.\u00a0</p>\n<p>The major components of the management of open fractures:</p>\n<ul>\n<li><strong>Antibiotic</strong> prophylaxis - It should be given <strong>as early as possible (within 3 hours of injury)</strong>. Amoxiclav is commonly used.\u00a0</li>\n<li><strong>Early debridement</strong> of the wound and fracture - This includes the following steps:\n<ul>\n<li><strong>Excision</strong> of the wound margins</li>\n<li><strong>Extension</strong> of the wound if required</li>\n<li>Delivery of the fracture outside the wound for proper examination</li>\n<li>Removal of the devitalized tissue</li>\n<li><strong>Cleansing of the wound</strong> to remove all the foreign materials</li>\n<li>Nerves and tendons are usually left alone, but if the wound is clean, a repair can be considered</li>\n</ul>\n</li>\n<li><strong>Wound cover</strong>:\n<ul>\n<li>In <strong>Gustilo Type I and II fractures</strong>, wound cover can be done <strong>at the time of debridement </strong>(early wound cover)</li>\n<li><strong>Delayed wound cover</strong> is usually practiced in <strong>Type III</strong> fractures</li>\n</ul>\n</li>\n<li><strong>Fracture stabilization:</strong>\u00a0External fixators are used to stabilize the fractures in the emergency room. Definitive management is later done by open reduction and internal fixation (ORIF).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following structures are involved in the unhappy triad?",
    "choices": [
      {
        "id": 1,
        "text": "A, D, E"
      },
      {
        "id": 2,
        "text": "D, E, F"
      },
      {
        "id": 3,
        "text": "A, B, C"
      },
      {
        "id": 4,
        "text": "C, D, E"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>unhappy triad of O&rsquo;Donoghue </strong>consists of<strong>&nbsp;</strong>injury to</p>\n<ul>\n<li><strong>Anterior cruciate ligament (A)</strong></li>\n<li><strong>Medial collateral ligament (B)</strong></li>\n<li><strong>Medial meniscus (C)</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b65f8b53111041c39278b847228fcdae.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87dabdf789f04fb7b2605b7c7bd5649cx600x688.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3a26050a1a0b4eda9f47b902a8796838x1280x1354.JPEG"
    ]
  },
  {
    "text": "A radiograph of the wrist is given below. Identify the true statements regarding this condition.",
    "choices": [
      {
        "id": 1,
        "text": "1, 3"
      },
      {
        "id": 2,
        "text": "2, 3"
      },
      {
        "id": 3,
        "text": "3 only"
      },
      {
        "id": 4,
        "text": "2, 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>&nbsp;</p>\n<p><strong>Malignancy transformation</strong> is rare (<strong>&lt;1%</strong>) in GCTs, though possible (statement 4).</p>\n<p>The treatment of choice for GCT is&nbsp;<strong>extended curettage</strong>&nbsp;and&nbsp;<strong>bone grafting</strong>. GCT in the&nbsp;relatively insignificant bone&nbsp;like the distal ulna, clavicle, and proximal fibula&nbsp;is treated by&nbsp;resection&nbsp;without reconstruction.<strong>&nbsp;Bisphosphonates</strong>&nbsp;have been shown to&nbsp;reduce&nbsp;the&nbsp;proliferation&nbsp;of&nbsp;osteoclasts&nbsp;and hence have been shown to stabilize local and metastatic disease.&nbsp;<strong>Radiation&nbsp;</strong>can be used for&nbsp;spinal&nbsp;or&nbsp;sacral tumors.</p>\n<p><strong>Denosumab</strong> is an anti-RANKL antibody that can be used to stop the osteolytic process. It can be used in advanced stage 3 lesions or lesions in inoperable locations.</p>\n<p>The given image shows the common locations of various bone tumors:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc6b8f86f8b743a4b849b24a2a173c10.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ce70bc4237aa476895fa17ad1ba0052ax720x775.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4fa0d93be1a74fd1b912ae6e6fdb11e9x1280x1184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0b87da53c294194bad5fc8a83c1222fx1279x1560.JPEG"
    ]
  }
];
        let quizName = '250 Orthopedics Ini-Cet 2022';
        let hierarchy = ["Marrow", "PYQs", "Orthopedics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>