<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Audiometric Tests And Special Tests Of Hearing - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / ENT
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The audiogram of a patient with difficulty in hearing is given below. What is your interpretation?",
    "choices": [
      {
        "id": 1,
        "text": "Left-sided conductive deafness"
      },
      {
        "id": 2,
        "text": "Left-sided sensorineural deafness"
      },
      {
        "id": 3,
        "text": "Right-sided conductive deafness"
      },
      {
        "id": 4,
        "text": "Right-sided sensorineural deafness"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient has <strong>left-sided conductive</strong> hearing loss.&nbsp;</p>\n<p>Interpretation of the above audiogram:</p>\n<ul>\n<li><strong>Blue</strong> color indicates <strong>left</strong> ear.</li>\n<li>] indicates BC and threshold is &lt;25dB. <strong>BC</strong> is<strong> normal</strong> which means the sensorineural pathway is normal.</li>\n<li>&times; indicates AC and threshold is &gt;15 dB and hence <strong>AC</strong> is<strong> abnormal</strong>.</li>\n<li>So, it indicates <strong>conductive deafness</strong>.</li>\n<li>The<strong> air-bone gap </strong>is a feature of<strong> conductive hearing loss.</strong></li>\n<li>Hence, the chart is suggestive of left-sided conductive deafness.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cd5dd7eb3e0545e18f7472ea88fafa32.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presents to the ENT OPD with complaints of difficulty in hearing. A pure tone audiometry test is performed and the result is given below. What is the interpretation?",
    "choices": [
      {
        "id": 1,
        "text": "Left-sided conductive deafness"
      },
      {
        "id": 2,
        "text": "Left-sided sensorineural deafness"
      },
      {
        "id": 3,
        "text": "Right-sided conductive deafness"
      },
      {
        "id": 4,
        "text": "Right-sided sensorineural deafness"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given pure tone audiometry is suggestive of&nbsp;<strong>right-sided sensorineural</strong> deafness.</p>\n<p>Interpretation of the result:</p>\n<ul>\n<li><strong>Red</strong> indicates the <strong>right</strong> ear.</li>\n<li>O indicates air conduction(AC). The threshold here is &gt;15 dB indicating&nbsp;<strong>abnormal&nbsp;</strong><strong>AC.</strong></li>\n<li>&lt; indicates bone conduction(BC). The threshold is &gt;25 dB indicating&nbsp;<strong>abnormal B</strong><strong>C.</strong></li>\n<li>Both AC and BC are abnormal which&nbsp;indicates<strong>&nbsp;</strong>a <strong>sensorineural hearing loss.</strong></li>\n<li>There is <strong>no air-bone gap.</strong></li>\n<li>Hence, it is right side sensorineural hearing loss.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f08324dac8054c00bb1c1ba76a6e1d64.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The audiogram of a patient who presented with a gradually progressive hearing loss is given below. Which among the following would be the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Prebyacusis"
      },
      {
        "id": 2,
        "text": "Ototoxicity"
      },
      {
        "id": 3,
        "text": "Noise induced hearing loss"
      },
      {
        "id": 4,
        "text": "Early stages of M\u00e9ni\u00e8re's disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given audiogram is seen in&nbsp;<strong>M&eacute;ni&egrave;re's disease</strong> in its <strong>early stages</strong>.&nbsp;It shows an <strong>upsloping/ascending</strong> curve suggesting that the lower frequencies are affected first.</p>\n<p>Presbycusis, ototoxicity, and sound-induced hearing loss have<strong> downsloping audiograms </strong>since the higher frequencies are affected first in these conditions.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1ac2d82f64f449988e59a15319b79f37.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old woman presented with hearing loss that developed shortly after her first pregnancy. Her audiometry report is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ototoxicity"
      },
      {
        "id": 2,
        "text": "Meniere disease"
      },
      {
        "id": 3,
        "text": "Otosclerosis"
      },
      {
        "id": 4,
        "text": "Noise induced hearing loss"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario describes a patient with <strong>post-pregnancy hearing loss</strong>. The audiogram shows <strong>conductive deafness</strong>&nbsp;along with Carhart's notch (<strong>dip </strong>in<strong> bone conduction </strong>at<strong> 2000 Hz</strong>).<strong>&nbsp;</strong>These findings are highly suggestive of&nbsp;<strong>otosclerosis</strong>.&nbsp;</p>\n<p>Ototoxicity, Meniere&rsquo;s disease, and noise-induced hearing loss cause <strong>sensory neural hearing loss (SNHL)</strong> and<strong>&nbsp;</strong>not conductive hearing loss.</p>\n<p><strong>Otosclerosis</strong> is caused by bony overgrowth involving the enchondral layer of the <strong>bony otic capsule</strong>. It presents with <strong>bilateral</strong> progressive <strong>conductive hearing loss</strong> and tinnitus. It has an autosomal dominant inheritance and can&nbsp;<strong>worsen</strong>&nbsp;with stress and hormonal changes like during <strong>pregnancy</strong> and <strong>menopause</strong>.&nbsp;</p>\n<p><strong>Stapedial</strong> otosclerosis is the most common type of otosclerosis. Here the lesion starts just in front of the oval window in an area called <strong>fistula ante fenestrae</strong>.</p>\n<p>The presence of a <strong>reddish hue</strong> on the promontory through the tympanic membrane, known as the <strong>Schwartze sign</strong>, suggests an active focus.&nbsp;<strong>PTA</strong> shows <strong>loss of air conduction with air-bone gap</strong>, more for <strong>lower frequencies</strong> and Carhart's notch may be seen.&nbsp;Tympanometry shows an <strong>As</strong> type of tympanogram in which there is reduced compliance at or near the ambient air pressure.</p>\n<p>Medical management with <strong>sodium fluoride</strong> is used in the active stage. Definitive treatment is <strong>stapedectomy/stapedotomy</strong> with the placement of a prosthesis. Carhart notch usually disappears after a successful stapedectomy.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Ototoxicity</strong> causes <strong>SNHL</strong> and shows a high-frequency hearing loss in the SNHL curve.</p>\n<p>Option B: In <strong>Meniere's disease</strong>, pure tone audiometry shows an <strong>SNHL</strong> pattern with a<strong> rising curve in the early stages&nbsp;</strong>(as lower frequencies are involved first)&nbsp;and as the disease <strong>progresses higher frequencies</strong> are involved, the<strong> curve becomes flat or a falling type</strong>.</p>\n<p>Option D:&nbsp;<strong>Noise-induced hearing loss</strong> is <strong>SNHL</strong> and PTA shows a characteristic <strong>acoustic dip at 4000 Hz</strong> both for air and bone conduction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dbb16254a36a44638721fd4dba997bf9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A prisoner who was brought to the hospital with deafness after a brawl with another inmate is suspected of malingering. Which of the following tests can be used to assess the authenticity of his complaints?",
    "choices": [
      {
        "id": 1,
        "text": "Pure-tone audiometry"
      },
      {
        "id": 2,
        "text": "Speech audiometry"
      },
      {
        "id": 3,
        "text": "Impedance audiometry"
      },
      {
        "id": 4,
        "text": "Tone decay"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Impedance audiometry</strong>&nbsp;can be used to test malingering.&nbsp;It is an <strong>objective test</strong> and consists of <strong>tympanometry</strong> and <strong>acoustic reflex measurements</strong>.</p>\n<p>A person who feigns total deafness and does not give any response on pure tone audiometry but shows a positive acoustic reflex is a malingerer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with hearing loss is being evaluated with the following instrument. What is the frequency of the probe used?",
    "choices": [
      {
        "id": 1,
        "text": "220 Hz"
      },
      {
        "id": 2,
        "text": "446 Hz"
      },
      {
        "id": 3,
        "text": "512 Hz"
      },
      {
        "id": 4,
        "text": "128 Hz"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>impedance audiometry</strong> and the frequency of the probe used here is&nbsp;<strong>220 Hz.</strong></p>\n<p>Impedance audiometry consists of <strong>tympanometry</strong> and <strong>acoustic reflex measurements.</strong></p>\n<p>Tympanometry equipment consists of a probe that snugly fits into the external auditory canal and has three channels.</p>\n<ul>\n<li>To deliver a tone of 220Hz</li>\n<li>To absorb reflected sound</li>\n<li>To change the pressure in EAC</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3289eb4b002249b2999ccaeb8a63edeb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The tympanogram of a young patient who presented with a progressive hearing loss is given below. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Thin and lax tympanic membrane"
      },
      {
        "id": 2,
        "text": "Otosclerosis"
      },
      {
        "id": 3,
        "text": "Ossicular discontinuity"
      },
      {
        "id": 4,
        "text": "Serous otitis media"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The tympanogram&nbsp;shows<strong> A<sub>s</sub> type </strong>of curve suggestive of&nbsp;<strong>otosclerosis</strong>. It<strong>&nbsp;</strong>indicates that <strong>pressure</strong> is <strong>normal</strong> but <strong>compliance</strong> is <strong>reduced.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7fc35b7cd7b64701903f27270371c230.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Using impedance audiometry, stapedial reflexes are being assessed in a child with cranial nerve palsy. Which of the following cranial nerves is being tested here?",
    "choices": [
      {
        "id": 1,
        "text": "6th and 8th cranial nerves"
      },
      {
        "id": 2,
        "text": "5th and 7th cranial nerves"
      },
      {
        "id": 3,
        "text": "7th and 8th cranial nerves"
      },
      {
        "id": 4,
        "text": "6th and 7th cranial nerves"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> 7<sup>th</sup></strong> and <strong>8<sup>th</sup></strong> cranial nerves are being tested in a child by assessing the <strong>stapedial reflexes.&nbsp;</strong></p>\n<p>The<strong> afferent </strong>of stapedial reflex is&nbsp;the<strong> 8<sup>th</sup> </strong>cranial nerve and <strong>efferent </strong>is&nbsp;the<strong> 7<sup>th</sup> </strong>cranial nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the instrument shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Meniette device"
      },
      {
        "id": 2,
        "text": "Barany noise box"
      },
      {
        "id": 3,
        "text": "Portable audiometer"
      },
      {
        "id": 4,
        "text": "Higginson apparatus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The instrument shown is&nbsp;<strong>Barany&rsquo;s noise box</strong> which is used to mask non-test ear while testing bone conduction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1eb29b0d96e44ebcb6c605ec1e526a7f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman is brought by her son to the ENT OPD due to hearing problems. He says that she always requests him to speak loud and whenever he speaks slightly louder, she tells him to stop shouting. Which of the following is the likely cause for this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Middle ear pathology"
      },
      {
        "id": 2,
        "text": "Cochlear pathology"
      },
      {
        "id": 3,
        "text": "Retrocochlear disease"
      },
      {
        "id": 4,
        "text": "External ear pathology"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given symptom is indicative of a\u00a0<strong>recruitment</strong> phenomenon and is seen in\u00a0<strong>cochlear hearing loss\u00a0</strong>(e.g. M\u00e9ni\u00e8re\u2019s disease and presbycusis). It refers to <strong>abnormal growth of loudness</strong>.\u00a0</p>\n<p>It is tested by <strong>ABLB </strong>(Alternate Binaural Loudness Balance)<strong> test. </strong>Lesser intensity sounds are heard louder in the normal ear. However, a greater intensity sound is heard equally, or even better in the abnormal ear. This is referred to as abnormal growth of loudness.</p>\n<p>However, in the <strong>conductive hearing loss,</strong> a <strong>constant difference</strong> of intensity is <strong>maintained</strong> throughout.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/912d6426a5c64869a16ccd419c34a812x1280x2975.JPEG"
    ]
  },
  {
    "text": "Patient with hearing loss undergoes speech audiometry whose report is given below. What is it suggestive of?",
    "choices": [
      {
        "id": 1,
        "text": "Normal finding"
      },
      {
        "id": 2,
        "text": "Cochlear pathology"
      },
      {
        "id": 3,
        "text": "Retrocochlear pathology"
      },
      {
        "id": 4,
        "text": "Conductive deafness"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given speech audiometry shows <strong>roll-over&nbsp;phenomenon</strong>&nbsp;suggestive of&nbsp;<strong>retrocochlear hearing loss.&nbsp;</strong></p>\n<p>With an increase in speech intensity above a particular level, the speech discrimination score&nbsp;falls rather than maintaining a plateau as seen in the cochlear type of sensorineural hearing loss.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7e2b1c8898304862888d7dc45e52a461.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presents to you with a progressive hearing loss accompanied by tinnitus. An MRI of the patient with gadolinium contrast is given below. Which of the following results is consistent with the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "<25 dB decay in threshold tone decay test"
      },
      {
        "id": 2,
        "text": "SISI score 70 \u2013 100%"
      },
      {
        "id": 3,
        "text": "Presence of otoacoustic emissions"
      },
      {
        "id": 4,
        "text": "Presence of recruitment phenomenon"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the MRI are suggestive of <strong>vestibular schwannoma</strong>&nbsp;which is a <strong>retrocochlear disease.</strong> The<strong> presence&nbsp;</strong>of<strong> otoacoustic emissions</strong> is a feature consistent with the diagnosis.</p>\n<p>Vestibular schwannoma typically presents at 40-60 years of age.&nbsp;Progressive <strong>unilateral sensorineural hearing loss</strong>, often accompanied by <strong>tinnitus</strong>, is the presenting symptom in the majority of cases.</p>\n<p>The MRI shows left <strong>cerebellopontine&nbsp;angle mass</strong> causing widening of the porous acousticus. The mass is seen extending into intracanalicular portion of the internal acoustic meatus which is suggestive of vestibular schwannoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c9538d94588d48c1895aacd052b13664.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What does summating potential in electrocochleography indicate?",
    "choices": [
      {
        "id": 1,
        "text": "Electrical activity of cochlea"
      },
      {
        "id": 2,
        "text": "Electrical activity of hair cells"
      },
      {
        "id": 3,
        "text": "Electrical activity of distal part of auditory nerve"
      },
      {
        "id": 4,
        "text": "Sum of all the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Summating potential</strong> in electrocochleography indicates the sum of <strong>electrical activity</strong> in <strong>hair cells</strong> within the organ of Corti.</p>\n<p><strong>Electrocochleography</strong> (ECoG) is an <strong>objective test</strong> which records the electrical activity of the cochlea and 8<sup>th</sup> nerve in response to auditory stimuli. The recording\u00a0electrode is passed through the tympanic membrane to rest over the promontory.</p>\n<p>The three parameters measured in ECoG are:</p>\n<ol>\n<li><strong>Cochlear microphonics</strong> \u2013 measures the electrical activity that follows the stimulus and reflects the instantaneous displacement of the basilar membrane.</li>\n<li><strong>Summating potential (SP)</strong> \u2013 measures the electrical activity of the hair cells within the organ of Corti.</li>\n<li><strong>Action potential (AP)</strong> \u2013 electrical activity in the distal part of the auditory nerve.</li>\n</ol>\n<p><strong>Normal SP: AP ratio</strong> is<strong> &lt;30% </strong>but it is<strong> increased</strong> in<strong> Meniere\u2019s disease.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A preterm neonate with an Apgar score of 4 at 5 minutes of birth undergoes otoacoustic emission study.  Which of the following is false about this test?",
    "choices": [
      {
        "id": 1,
        "text": "Otoacoustic emissions are generated by inner hair cells"
      },
      {
        "id": 2,
        "text": "It is used as a screening test for hearing loss in infants"
      },
      {
        "id": 3,
        "text": "Spontaneous type is present in 50% of normal individuals"
      },
      {
        "id": 4,
        "text": "Evoked type is present in all individuals with normal hearing"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>otoacoustic emissions</strong> (OAEs) are generated by the <strong>outer hair cells</strong> of the cochlea. Presence of otoacoustic emissions is used to test hearing in a high-risk neonate as given in the clinical scenario.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Wave V in brainstem evoked response audiometry is produced by which of the following structures?",
    "choices": [
      {
        "id": 1,
        "text": "Superior olivary complex"
      },
      {
        "id": 2,
        "text": "Lateral lemniscus"
      },
      {
        "id": 3,
        "text": "Inferior colliculus"
      },
      {
        "id": 4,
        "text": "Distal part of cochlear nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Wave V in BERA</strong> is produced by <strong>lateral lemniscus.</strong></p>\n<p>The generators of ABEPs (Auditory nerve and brainstem evoked potentials) have been the subject of much research and controversy and are still not entirely agreed upon.</p>\n<p>The literature available to us states the following:</p>\n<ul>\n<li><strong>Scott Brown's Otorhinolaryngology</strong>- wave <strong>IV\u2013V complex</strong>\u00a0probably arises from neural activity within the superior olivary complex and nuclei of the<strong> lateral lemniscus,</strong> possibly\u00a0some contribution from the<strong> inferior colliculus.</strong>\u00a0So <strong>lateral lemniscus</strong> is the<strong> better option.</strong></li>\n<li><strong>Current Diagnosis and Treatment in Otorhinolaryngology- </strong>auditory brainstem response waves 2, 3, 4, and <strong>5</strong> represent the sequential activation of neurons as the signal is passed up the brainstem from the proximal part of the cochlear nerve, cochlear nucleus, superior olivary complex, and<strong> lateral lemniscus.</strong>\u00a0</li>\n<li><strong>NIH Journals-</strong>\u00a0generation of wave V reflects the activity of multiple anatomic auditory structures. A sharp<strong>\u00a0</strong>positive peak of <strong>wave V</strong> arises mainly from the <strong>lateral lemniscus</strong>, following a slow negative wave represents dendritic potential in the inferior colliculus.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient undergoes hearing assessment using cortical evoked response audiometry. Which of the following is false regarding this test?",
    "choices": [
      {
        "id": 1,
        "text": "Recording is made from cortical potentials"
      },
      {
        "id": 2,
        "text": "Click stimulus is used"
      },
      {
        "id": 3,
        "text": "Not suitable for children"
      },
      {
        "id": 4,
        "text": "Response is frequency specific"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>CERA</strong> or cortical evoked response audiometry, a <strong>tone stimulus</strong> is used instead of a click stimulus.&nbsp;</p>\n<p>It is an <strong>objective hearing test,</strong> that records the signals from the auditory cortex (part of the brain that recognizes sound) that have been generated in response to sounds introduced to the ears.&nbsp;</p>\n<p>The test gives information about the level of sound needed to produce a signal and confirms the <strong>status of</strong> the <strong>auditory cortex.</strong> This is valuable information that we can not obtain from a normal hearing test.</p>\n<p>Difference between BERA and CERA:</p>\n<table>\n<tbody>\n<tr style=\"height: 31px;\">\n<td style=\"height: 31px;\"><strong>BERA</strong></td>\n<td style=\"height: 31px;\"><strong>CERA</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"height: 18px;\">The recording is made from brain stem potentials</td>\n<td style=\"height: 18px;\">The recording is made from cortical potentials</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"height: 18px;\">Click stimulus is used</td>\n<td style=\"height: 18px;\">Tone stimulus is used</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"height: 18px;\">Responses are not frequency specific</td>\n<td style=\"height: 18px;\">Responses are frequency specific</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"height: 18px;\">Can be performed in awake and restless patients</td>\n<td style=\"height: 18px;\">The patient must lie still throughout the process</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"height: 18px;\">Responses begin after 1 -10 milliseconds after stimuli</td>\n<td style=\"height: 18px;\">Responses begin after 50 &ndash; 300 milliseconds after stimulation</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"height: 18px;\">Suitable for even younger children</td>\n<td style=\"height: 18px;\">Unsuitable for children</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a medical officer in an occupational health program, you encounter an employee with hearing loss. You are suspicious that he is faking it to claim compensation. Which of the following tests is least useful in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Stenger test"
      },
      {
        "id": 2,
        "text": "Lombard test"
      },
      {
        "id": 3,
        "text": "Stapedial reflex"
      },
      {
        "id": 4,
        "text": "Rinne test"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario is suggestive of <strong>malingering</strong> and Rinne's test is least useful here.</p>\n<p>Tests for malingering or nonorganic hearing loss:</p>\n<ul>\n<li>Stenger test</li>\n<li>Lombard test</li>\n<li>Stapedial reflex</li>\n<li>Inconsistent results on repeat pure tone and speech audiometry tests</li>\n<li>BERA</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While performing a caloric test, what type of nystagmus would you expect on cold water irrigation?",
    "choices": [
      {
        "id": 1,
        "text": "Horizontal nystagmus towards the same side"
      },
      {
        "id": 2,
        "text": "Vertical nystagmus towards the same side"
      },
      {
        "id": 3,
        "text": "Horizontal nystagmus towards the opposite side"
      },
      {
        "id": 4,
        "text": "Vertical nystagmus towards the opposite side"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In caloric testing,<strong> cold</strong> water irrigation produces <strong>h</strong><strong>orizontal nystagmus</strong> towards the<strong> opposite side</strong>&nbsp;of irrigation. The direction of nystagmus can be remembered by the mnemonic,&nbsp;<strong>COWS</strong> (cold&ndash;opposite, warm&ndash;same).<strong>&nbsp;</strong></p>\n<p>The mechanism for the nystagmus is the creation of a<strong> temperature gradient</strong>&nbsp;by the cold water, which<strong> pulls the cupula away from the utricle,</strong> causing nystagmus towards the oppsite side.&nbsp;As the <strong>horizontal semicircular canal</strong> is closer to the outer ear canal, most of the response comes from it and the nystagmus is horizontal.&nbsp;&nbsp;</p>\n<p>The <strong>Fitzgerald&ndash;Hallpike test</strong>&nbsp;(bithermal caloric test) is done to assess this phenomenon. The patient lies in a <strong>supine</strong> position with&nbsp;<strong>head tilted forward at a 30&deg;</strong> angle, ensuring the horizontal canal becomes vertical. Alternatingly, <strong>water</strong> at temperatures of <strong>30&deg;C</strong> and <strong>44&deg;C</strong> (7&deg; below and above normal body temperature, respectively) is irrigated into the ears for a duration of 40 seconds each. The examiner closely observes the patient's eyes for the emergence of nystagmus until its endpoint is reached. The time taken from the start of irrigation to the endpoint of nystagmus is recorded and plotted on a calorigram.</p>\n<p>If <strong>no nystagmus</strong> is evoked from either ear, the <strong>test is repeated</strong> with water at a temperature of <strong>20&deg;C</strong> for a duration of 4 minutes before labeling the labyrinth dead. A 5-minute interval should be allowed between testing each ear to ensure accurate results.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are the objective tests for the hearing?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, and 4"
      },
      {
        "id": 2,
        "text": "1,2, and 3"
      },
      {
        "id": 3,
        "text": "2,3, and 4"
      },
      {
        "id": 4,
        "text": "1,2,3, and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>BERA,&nbsp;OAE,</strong> and<strong> tympanometry&nbsp;</strong>are the <strong>objective tests</strong> for hearing.&nbsp;<strong>PTA</strong> (pure tone audiometry) is a <strong>subjective test</strong> for hearing as it relies on patient responses to&nbsp;pure tone&nbsp;stimuli. Other examples of <strong>subjective tests</strong> include <strong>tuning fork tests</strong> and <strong>speech audiometry</strong>.</p>\n<p><strong>Tympanometry</strong> is an&nbsp;<strong>objective test </strong>of the<strong> middle ear</strong> and<strong>&nbsp;eustachian tube functions</strong>&nbsp;(conductive compartment of hearing). Here, the <strong>compliance</strong> of the TM, i.e., how much it moves to the pressure differentials applied from the external ear is measured.&nbsp;</p>\n<p>The image below shows the types of tympanogram:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/434200c4b833472289c379754af17c3cx1280x2078.JPEG"
    ]
  }
];
        let quizName = '17 Audiometric Tests And Special Tests Of Hearing';
        let hierarchy = ["Marrow", "qBank", "ENT"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>