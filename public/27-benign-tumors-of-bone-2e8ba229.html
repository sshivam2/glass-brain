<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27 Benign Tumors Of Bone - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Orthopedics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">29</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most common benign tumor of the bone?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoma"
      },
      {
        "id": 2,
        "text": "Osteoblastoma"
      },
      {
        "id": 3,
        "text": "Osteochondroma"
      },
      {
        "id": 4,
        "text": "Unicameral bone cyst"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> most common benign tumor</strong> of the bone is <strong>osteochondroma</strong>.</p>\n<p>However, osteochondromas are <strong>developmental malformations</strong> rather than true neoplasms. Hence, <strong>osteoid osteoma</strong> is the most common<strong> true benign tumor&nbsp;</strong>of the bone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "According to the Enneking system of classification, which of the following is not a feature of an active benign bone tumour?",
    "choices": [
      {
        "id": 1,
        "text": "Intracapsular location"
      },
      {
        "id": 2,
        "text": "Wide area of activity"
      },
      {
        "id": 3,
        "text": "Well defined margins"
      },
      {
        "id": 4,
        "text": "Thin rim of reactive bone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the Enneking system\u00a0of classification, an <strong>active benign tumor</strong> will have a <strong>narrow zone of activity</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false with respect to a solitary bone cyst?",
    "choices": [
      {
        "id": 1,
        "text": "They are asymptomatic unless complicated by pathological fracture"
      },
      {
        "id": 2,
        "text": "Trapdoor sign can be seen on X-ray"
      },
      {
        "id": 3,
        "text": "They commonly occur in the diaphysis of the bone"
      },
      {
        "id": 4,
        "text": "They may cause growth abnormalities"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A <strong>solitary bone cyst</strong> (unicameral bone cyst/ simple bone cyst)<strong>&nbsp;</strong>most commonly occurs in the <strong>metaphysis&nbsp;</strong>of the bone.</p>\n<p>Simple bone cyst always occurs during the <strong>first two decades</strong> of life, most often between 4-10 years of age with a <strong>2:1</strong> <strong>male</strong> <strong>preponderance</strong>.&nbsp;It is a <strong>benign unilocular cyst</strong> filled with<strong> straw coloured</strong> serosanguinous fluid.</p>\n<p>The <strong>commonest site</strong> is the&nbsp;<strong>proximal humerus</strong>. They are usually asymptomatic, but <strong>pathological fractures</strong> may occur through the cyst wall and may cause<strong> pain</strong> and <strong>swelling</strong>.&nbsp;The cyst may cause <strong>growth disturbances</strong> due to its<strong> proximity to</strong> the <strong>growth plate</strong>.</p>\n<p>On X-ray, a bone fracture fragment may be seen resting in a dependent portion of the cyst.<strong>&nbsp;</strong>This is known as the<strong>&nbsp;fallen fragment/fallen leaf sign&nbsp;</strong>and it&nbsp;is pathognomonic of a simple bone cyst.</p>\n<p>The <strong>trapdoor sign </strong>is&nbsp;a variant of the fallen leaf sign. Here, a <strong>periosteal hinge</strong> keeps the fragment from falling dependently and allows it to <strong>change position </strong>with&nbsp;a change in the patient's position.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy presents to the OPD with pain in the right upper arm and a history of a trivial fall a few days ago. His X-ray is given below. Which of the following is not a treatment modality for the above condition?",
    "choices": [
      {
        "id": 1,
        "text": "Curettage and bone grafting"
      },
      {
        "id": 2,
        "text": "Intra-lesional steroids"
      },
      {
        "id": 3,
        "text": "Radiotherapy"
      },
      {
        "id": 4,
        "text": "Injection of a sclerosing agent"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Radiotherapy</strong> is not a treatment modality used in the treatment of the above condition.<br />The given X-ray reveals a fracture running through a<strong> central cystic lesion </strong>situated on the <strong>proximal humeral metaphysis, </strong>and&nbsp;also shows a&nbsp;<strong>fallen fragment sign</strong>.&nbsp;This along with the clinical scenario (male within 2nd decade of life) is strongly suggestive of a&nbsp;<strong>unicameral bone cyst </strong>(simple bone cyst).&nbsp;<br /><br /><strong>Treatment of simple bone cyst</strong>:</p>\n<ul>\n<li><strong>Small</strong>, <strong>asymptomatic</strong> lesions - serial observation with plain radiographs as lesions will regress following skeletal maturity</li>\n<li><strong>Larger</strong> lesions (at risk of pathologic fracture) and <strong>symptomatic</strong> lesions -&nbsp;\n<ul>\n<li>Curettage&nbsp;</li>\n<li>Aspiration and injection&nbsp;using:\n<ul>\n<li>Corticosteroids</li>\n<li>Bone marrow aspirate</li>\n<li>Demineralized bone matrix</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Pathological fractures</strong> -\n<ul>\n<li>Upper limb: managed conservatively as the fracture may initiate cyst healing</li>\n<li>Lower limb: curettage, bone grafting, and internal fixation</li>\n</ul>\n</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ae2adf20dbb14c0bbb7f853fa88eab6b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f9dfbe4e67e3494f973556330af9d062x720x987.JPEG"
    ]
  },
  {
    "text": "A 16-year-old girl presented to the OPD with a painful swelling below her left knee. An X-ray is obtained which is given below. Aspiration of the lesion revealed blood.  Which of the following statements is true with regards to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is a uniloculated lesion"
      },
      {
        "id": 2,
        "text": "It is central in location"
      },
      {
        "id": 3,
        "text": "It is not locally destructive"
      },
      {
        "id": 4,
        "text": "It can rarely occur in the spine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and X-ray are suggestive of an <strong>aneurysmal bone cyst.</strong>\u00a0It <strong>can involve</strong> the <strong>spine</strong> in 15-20% of cases.</p>\n<p>Aneurysmal bone cysts are <strong>eccentric</strong>, expansile,\u00a0<strong>multiloculated</strong> cysts filled with blood. They are\u00a0benign lesions but they are\u00a0<strong>locally destructive</strong>.\u00a0Most cases occur in patients <strong>younger than 20 years</strong> old.\u00a0There is a slight <strong>female preponderance.</strong></p>\n<p>The most <strong>common sites</strong> involved are the <strong>metaphysis </strong>of <strong>long bones</strong> like proximal humerus,\u00a0distal femur, and proximal tibia.<strong>\u00a0</strong>It presents with pain and swelling. Spinal lesions may cause neurologic deficits or radicular pain.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/160fc87b00014d13b68aee75077cd0fd.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following X-ray shows a lytic lesion of the lower limb. The biopsy shows fibroblastic proliferation, osteoclast and inflammatory cells. From the given options, the most likely diagnosis that can be inferred from the above clinical picture is______.",
    "choices": [
      {
        "id": 1,
        "text": "Aneurysmal bone cyst"
      },
      {
        "id": 2,
        "text": "Giant cell tumor"
      },
      {
        "id": 3,
        "text": "Chondroblastoma"
      },
      {
        "id": 4,
        "text": "Langerhan cell histiocytosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: <strong>Langerhans cell histiocytosis</strong> commonly involves the <strong>skull</strong>, pelvis, femur, and mandible. Radiographs show a<strong> lytic lesion with periosteal new bone formation</strong>. In the <strong>skull</strong>, lesions appear as a <strong>hole within a hole</strong>, and in the <strong>vertebra</strong>, <strong>vertebra plana</strong> (flattening of the vertebral body) can be seen. Histopathologically, <strong>Langerhans cells</strong> have a single large nucleus with a characteristic folded or grooved nucleus (<strong>&ldquo;coffee-bean&rdquo; appearance</strong>) with small inconspicuous nucleoli. On electron microscopy, the presence of <strong>Birbeck granules</strong> in the cytoplasm is characteristic.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f3b7f0d294a44616a1b09c5dd80ef9b4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7e6c8cb39a614e46af41f2552241ba7dx720x775.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f79aff460557411cac3576f11aa7c0e8x1280x1184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9bf7630d650446cbbd31f759bec0384fx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/12d550a4b97c4bcebd9290c10b6a5739x621x747.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/492e53b6461b4e2abee9a32ef7e2489cx720x828.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman developed a tumor at the knee joint. Biopsy-image is given below. What is the most likely condition?",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Ewing's sarcoma"
      },
      {
        "id": 3,
        "text": "Giant cell tumour"
      },
      {
        "id": 4,
        "text": "Osteoblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option D: Histologically, <strong>osteoblastoma</strong> shows randomly interconnecting <strong>trabeculae of woven bone</strong>, which are prominently rimmed by a single layer of osteoblasts. The stroma surrounding the neoplastic bone is composed of loose connective tissue that contains numerous dilated and congested capillaries.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ae1b667bb4c14cc187d5b800fd8fd26b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6575f63e47d747e8a353f125ede85ecdx1280x1184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2ae5241ab2d1449ca6ae99e24d12da33x1279x1048.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0fe9ab3f5b57492cac9b9f566b049027x1280x1407.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f31f099f9f34197ae94f77dad9b2f9ax1279x2018.JPEG"
    ]
  },
  {
    "text": "Identify the following correctly.",
    "choices": [
      {
        "id": 1,
        "text": "1 - Simple bone cyst, 2 - Aneurysmal bone cyst, 3- Osteoclastoma"
      },
      {
        "id": 2,
        "text": "1- Aneurysmal bone cyst, 2 - Osteoclastoma, 3- Simple bone cyst"
      },
      {
        "id": 3,
        "text": "1 - Osteoclastoma, 2- Aneurysmal bone cyst, 3- Simple bone cyst"
      },
      {
        "id": 4,
        "text": "1- Osteoclastoma, 2 - Simple bone cyst, 3 - Aneurysmal bone cyst"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The below table summarises the findings seen in these conditions:</p>\n<table style=\"height: 749px;\" width=\"512\">\n<tbody>\n<tr>\n<td style=\"width: 87px;\">\u00a0</td>\n<td style=\"width: 101px;\"><strong>GCT</strong></td>\n<td style=\"width: 149px;\"><strong>ABC</strong></td>\n<td style=\"width: 147px;\"><strong>Simple bone cyst</strong></td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Location</td>\n<td style=\"width: 101px;\">Epiphyseo-Metaphyseal<br /><br /></td>\n<td style=\"width: 149px;\">Metaphyseal<br /><br /></td>\n<td style=\"width: 147px;\">Meta-diaphyseal<br /><br /></td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Commonly involved</td>\n<td style=\"width: 101px;\">Distal femur/radius<br />Proximal humerus/tibia</td>\n<td style=\"width: 149px;\">Humerus/femur/tibia<br />Posterior spine</td>\n<td style=\"width: 147px;\">Proximal humerus/femur/tibia</td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Age</td>\n<td style=\"width: 101px;\">2nd-4th decade<br /><br /></td>\n<td style=\"width: 149px;\">1st-2nd decade</td>\n<td style=\"width: 147px;\">1st-2nd decade</td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Xray appearance</td>\n<td style=\"width: 101px;\">Eccentric, lytic lesion<br />Soap bubble appearance<br />Minimal marginal sclerosis</td>\n<td style=\"width: 149px;\">Eccentric,lytic lesion<br />Highly trabeculated, lobulated<br /><br /></td>\n<td style=\"width: 147px;\">Central location, lytic location<br />Fallen fragment sign\u00a0<br />(Fracture fragment sinks in fluid)</td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Gross examination</td>\n<td style=\"width: 101px;\">Reddish Brown mass\u00a0<br />with cystic degeneration</td>\n<td style=\"width: 149px;\">Blood filled cystic spaces<br />lined by fibrous septa</td>\n<td style=\"width: 147px;\">usually Solitary tumor <br />filled with serous fluid</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/11262c763a5c49a490439683d01f5ba8.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb1e21b9c5334896962b82c4e97eec11x1280x604.PNG"
    ]
  },
  {
    "text": "An X-ray is done for a patient with a knee swelling and the lesion is noted to have a soap-bubble appearance. Which of the following is false about the condition he is likely suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "It commonly presents in the 20-40 years age group"
      },
      {
        "id": 2,
        "text": "Egg shell crackling is seen on palpation"
      },
      {
        "id": 3,
        "text": "Osteoclastic giant cells form the proliferative component of the tumor"
      },
      {
        "id": 4,
        "text": "It can produce lung metastasis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of<strong> giant cell tumor </strong>(GCT). The <strong>proliferative component</strong> of this tumor is made up of\u00a0<strong>mononuclear</strong> <strong>stromal cells.\u00a0</strong>\u00a0Their nuclei are identical to the\u00a0osteoclast-like giant cells which are characteristically seen in this condition.</p>\n<p>GCT is a very <strong>aggressive benign tumor</strong> arising from the <strong>epiphysis</strong> and typically in the\u00a0age group of<strong> 20-40 years</strong>. It has slight <strong>female</strong> predominance.</p>\n<p>The most common site is lower end of femur. It has an\u00a0<strong>egg shell crackling</strong>\u00a0feel on palpation.\u00a0Benign <strong>pulmonary metastasis</strong> can occur in about 3% of cases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old boy presents to the orthopedician with complaints of painful swelling below the knee joint.  An X-Ray was obtained which is given below. Which of the following is the preferred treatment modality for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Extended curettage and bone grafting"
      },
      {
        "id": 2,
        "text": "Simple curettage and bone grafting"
      },
      {
        "id": 3,
        "text": "Radiofrequency ablation"
      },
      {
        "id": 4,
        "text": "Radical excision"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An ABC is treated by extended curettage and grafting with a bone graft substitute (option B).</p>\n<p><strong>GCT</strong> is most commonly seen in the distal femur, proximal tibia, proximal humerus, and distal radius. It presents with complaints of\u00a0<strong>swelling</strong>\u00a0and vague<strong>\u00a0pain </strong>and\u00a0Sometimes, the patient can presents for the first time with a\u00a0<strong>pathological fracture</strong>\u00a0because of the lesion.</p>\n<p>Important x-ray features of a GCT:</p>\n<ul>\n<li><strong>Eccentric, solitary lytic </strong>lesion</li>\n<li>In<strong> epiphysis </strong>and<strong> metaphysis</strong></li>\n<li><strong>Expansile</strong>- expands overlying cortex</li>\n<li><strong>Soap bubble appearance - </strong>due to the\u00a0trabeculae\u00a0of the\u00a0remnants of bone\u00a0traversing the lytic lesion, giving it a\u00a0loculated appearance.</li>\n<li><strong>No</strong>\u00a0or minimal\u00a0<strong>reactive sclerosis</strong>\u00a0around the tumor</li>\n<li>No calcification</li>\n</ul>\n<p>Histologically, GCTs consist\u00a0of\u00a0<strong>undifferentiated spindle cells</strong>\u00a0profusely interspersed with\u00a0<strong>multi-nucleated giant cells</strong>. The tumor stroma is well-vascularized with bands of cellular or collagenous fibrous tissue.</p>\n<p>The treatment of choice for GCT is by</p>\n<ul>\n<li><strong>Extended curettage\u00a0</strong>and\u00a0<strong>bone grafting </strong>(Option A).</li>\n<li>GCT in the\u00a0relatively<strong> insignificant bone\u00a0</strong>like the distal ulna, clavicle, and proximal fibula\u00a0is treated by\u00a0<strong>resection</strong>\u00a0<strong>without reconstruction</strong>.</li>\n<li><strong>Bisphosphonates</strong>\u00a0have been shown to\u00a0<strong>reduce\u00a0</strong>the<strong>\u00a0proliferation\u00a0</strong>of<strong>\u00a0osteoclasts</strong>\u00a0and hence have been shown to stabilize local and metastatic disease.</li>\n<li><strong>Radiotherapy</strong>\u00a0can be used for <strong>vertebral\u00a0tumors</strong></li>\n<li>Additional supportive therapy such as <strong>c</strong><strong>ryotherapy</strong>, when used <strong>reduce the reccurence</strong> rate.</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eb85d2edfb7d4174a89aa54a63798e48.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/74cf4e2886044d87879e31fbd4d4756cx720x720.JPEG"
    ]
  },
  {
    "text": "A patient with a giant cell tumor is set to undergo an extended curettage. Which of the following adjuvants used in this procedure is associated with least rate of recurrence?",
    "choices": [
      {
        "id": 1,
        "text": "Liquid nitrogen"
      },
      {
        "id": 2,
        "text": "Phenol"
      },
      {
        "id": 3,
        "text": "Polymethyl methacrylate"
      },
      {
        "id": 4,
        "text": "Thermal cautery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note: Even though phenol and methacrylate can also be used as adjuvants for extended curettage, studies have shown that liquid nitrogen is far superior for the purpose.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following lesions contain giant cells?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,4,5"
      },
      {
        "id": 2,
        "text": "3,4,5,6"
      },
      {
        "id": 3,
        "text": "2,3,4,6"
      },
      {
        "id": 4,
        "text": "1,2,3,5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Aneurysmal bone cyst, brown's tumor,&nbsp;osteoclastoma, and osteosarcoma all contain giant cells.</p>\n<p>Enchondroma and osteoid osteoma do not contain giant cells.</p>\n<p><strong>Lesions containing giant cells are:&nbsp;</strong></p>\n<ul>\n<li>Simple bone cyst</li>\n<li><strong>Aneurysmal bone cyst</strong></li>\n<li><strong>Osteoclastoma</strong></li>\n<li>Chondroblastoma</li>\n<li>Fibrous dysplasia</li>\n<li>Non-ossifying fibroma</li>\n<li><strong>Brown's tumor</strong></li>\n<li><strong>Osteosarcoma</strong></li>\n<li>Clear cell chondrosarcoma</li>\n</ul>\n<p>The most common variant of a giant cell tumor is&nbsp;non-ossifying fibroma&gt;fibrous dysplasia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During an annual health check-up, the following finding was seen on the ankle X-ray of a man. Which of the following is false about the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is a metaphyseal tumor"
      },
      {
        "id": 2,
        "text": "It commonly presents in 4th-5th decade"
      },
      {
        "id": 3,
        "text": "It is usually asymptomatic"
      },
      {
        "id": 4,
        "text": "Histology shows  spindle cells, foam cells and giant cells"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given X-ray shows a well-defined <strong>lobulated lesion</strong> located eccentrically and <strong>sclerotic scalloped borders</strong> is suggestive of&nbsp;<strong>non-ossifying fibroma. </strong>The common age of presentation of this condition is <strong>2-20 years.</strong></p>\n<p>It is also known as fibrous cortical defect and it<strong>&nbsp;</strong>is the <strong>most common benign lesion</strong> of bone.<strong>&nbsp;</strong>It is a <strong>metaphyseal eccentric lesion</strong> that usually affects the distal femur, tibia and fibula.&nbsp;</p>\n<p>On biopsy, foam cells, spindle shape cells and&nbsp;giant cells may be seen.&nbsp;</p>\n<p>It is usually <strong>asymptomatic</strong>&nbsp;and <strong>regresses spontaneously</strong> in adulthood. If the defect is <strong>very large</strong>, it can be treated by <strong>curettage and bone grafting.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/719f087c673343588752851fffc748c9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 49-year-old woman presented to your clinic with progressive pain in her left thigh. The X-ray of her thigh is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ossifying fibroma"
      },
      {
        "id": 2,
        "text": "Fibrous dysplasia"
      },
      {
        "id": 3,
        "text": "Aneurysmal bone cyst"
      },
      {
        "id": 4,
        "text": "Enchondroma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above X-ray shows bending of the femur known as<strong>\u00a0Shepherd's crook deformity.\u00a0</strong>It<strong>\u00a0</strong>is seen in\u00a0<strong>fibrous dysplasia </strong>of proximal femur.</p>\n<p>Fibrous dysplasia is a developmental disorder in which areas of<strong> trabecular bone </strong>are\u00a0<strong>replaced </strong>by cellular <strong>fibrous tissue.\u00a0</strong>If this occurs in the weight-bearing bones like the femur, it will lead to bending of the bones.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a522513ebaa34d1d92a296750f670d82.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf126e6c690c4afc9a24e0adef28deeex1024x700.jpeg"
    ]
  },
  {
    "text": "Which condition is characterized by the presence of polyostotic fibrous dysplasia with intramuscular myxomas?",
    "choices": [
      {
        "id": 1,
        "text": "Mazabraud syndrome"
      },
      {
        "id": 2,
        "text": "McCune Albright syndrome"
      },
      {
        "id": 3,
        "text": "Maffucci syndrome"
      },
      {
        "id": 4,
        "text": "Stewart- Treves syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Polyostotic fibrous dysplasia with<strong> intramuscular myxomas</strong> is seen in<strong>&nbsp;Mazabraud syndrome</strong>.</p>\n<p>Fibrous dysplasia is a disorder where <strong>bone</strong> is <strong>replaced</strong> by <strong>fibrous tissue</strong>, leading to weak bones, uneven growth, and deformity. <strong>Polyostotic fibrous dysplasia</strong> is a&nbsp;form of this condition affecting<strong> more than one bone</strong>.</p>\n<p><strong>McCune - Albright syndrome </strong>consists of<strong>&nbsp;</strong>a characteristic triad of polyostotic fibrous dysplasia, <strong>cafe au lait spots</strong> with rough borders and <strong>hyperfunction</strong> of an <strong>endocrine</strong> system.</p>\n<p><strong>Maffucci syndrome </strong>is characterised by<strong> multiple enchondromas</strong> with soft tissue hemangiomas and phleboliths. Malignant transformation is common in these lesions.</p>\n<p><strong>Stewart- Treves syndrome </strong>refers to the occurrence of <strong>lymphangiosarcoma</strong> in the setting of <strong>chronic lymphedema</strong>. It can be evident as upper extremity lymphedema following radical mastectomy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not seen in patients with McCune-Albright syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Polyostotic fibrous dysplasia"
      },
      {
        "id": 2,
        "text": "Cafe-au-lait lesions with smooth borders"
      },
      {
        "id": 3,
        "text": "Hyperfunction of an endocrine system"
      },
      {
        "id": 4,
        "text": "Mutation affecting G protein signal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cafe-au-lait </strong>lesions&nbsp;with <strong>rough borders</strong>&nbsp;(coast of Maine) are seen in <strong>McCune Albright</strong> syndrome. Cafe-au-lait lesions with&nbsp;<strong>smooth borders&nbsp;</strong>(coast of California) is seen in&nbsp;<strong>neurofibromatosis</strong>.&nbsp;</p>\n<p><strong>Features of McCune Albright syndrome</strong>:</p>\n<ul>\n<li><strong>Polyostotic fibrous dysplasia</strong> - most commonly in maxilla and other craniofacial bones, ribs, femur or tibia</li>\n<li><strong>Cafe-au lait spots</strong> with rough borders (coast of Maine)</li>\n<li>Hyperfunction of an endocrine system - most common endocrinopathy is <strong>precocious puberty </strong>in girls</li>\n</ul>\n<p>McCune-Albright syndrome<strong>&nbsp;</strong>occurs due to <strong>activating mutations</strong> in the <strong>GNAS1 gene</strong>, which encodes the alpha subunit of the G protein Gs alpha.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old man presented with pain in the thigh which is worse at night and relieved by aspirin. An X-ray is performed which is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Solitary bone cyst"
      },
      {
        "id": 2,
        "text": "Osteoid osteoma"
      },
      {
        "id": 3,
        "text": "Chondroblastoma"
      },
      {
        "id": 4,
        "text": "Aneurysmal bone cyst"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Osteoid osteoma is the <strong>most common benign bone tumour</strong> of the body. It contains <strong>osteoblastic </strong>as well as<strong> osteoclastic components</strong>.</p>\n<p><span class=\"fontstyle0\">It is most often seen in <strong>young men</strong>. The most common site is <strong>diaphysis of femur</strong>. It t</span>ypically presents with&nbsp;<strong>pain </strong>that is<strong> worse at night </strong>and is<strong> relieved by aspirin</strong> or other nonsteroidal antiin\ufb02ammatory medications.</p>\n<p>Multiple treatment options are available for this condition as follows:</p>\n<ul>\n<li>If <strong>symptoms</strong> are <strong>adequately controlled</strong> and patient is willing to undergo long-term medical management,<strong> anti-inflammatory</strong> <strong>medication</strong> can be used as the definitive treatment. <strong>Spontaneous healing</strong> of the lesion usually occurs within <strong>3 to 4 years</strong>.</li>\n<li>Patients having<strong> lesions of</strong> the <strong>pelvis</strong> or <strong>long bones</strong> of the extremities can be treated with <strong>percutaneous radiofrequency ablation</strong>. This method is not preferred for vertebral lesions and lesions of small bones of hand and feet.</li>\n<li><strong>Surgical managemen</strong>t involves removal of the entire nidus.&nbsp;This can be accomplished by <strong>curettage</strong> or <strong>en bloc resection</strong>.</li>\n<li>Magnetic resonance-guided focused ultrasound (<strong>MRgFUS</strong>) <strong>ablation</strong> is a new method that is under investigation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4876fc04f99d4b74b1c897013da62afa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d06fbb9487e744ad81601650b21ab447x1024x700.jpeg"
    ]
  },
  {
    "text": "Which of these is the least likely cause of multiple bone lesions in a patient?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoid osteoma"
      },
      {
        "id": 2,
        "text": "Enchondroma"
      },
      {
        "id": 3,
        "text": "Osteochondroma"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Osteoid osteoma </strong>is the least likely cause of multiple bone lesions. It is <strong>usually solitary</strong>.</p>\n<p><strong>Differential diagnosis for multiple bone lesions</strong>:</p>\n<ul>\n<li>Histiocytosis</li>\n<li><strong>Enchondroma</strong></li>\n<li><strong>Osteochondroma</strong></li>\n<li>Fibrous dysplasia</li>\n<li><strong>Multiple myeloma</strong></li>\n<li>Metastases</li>\n<li>Hemangioma</li>\n<li>Osteomyelitis</li>\n<li>Giant cell tumor</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old woman presents with multiple bony swellings in her hands as seen in the image below marked 1. The X-ray of her hands is as shown in the image marked 2. Identify her condition.",
    "choices": [
      {
        "id": 1,
        "text": "Ollier disease"
      },
      {
        "id": 2,
        "text": "Maffucci\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Melorheostosis"
      },
      {
        "id": 4,
        "text": "Hemangiopericytoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Malignant potential </strong>of enchondromas:</p>\n<ul>\n<li><strong>Maffucci's</strong> syndrome has a&nbsp;<strong>100%</strong> risk of turning into malignancy</li>\n<li><strong>Ollier</strong> disease has a <strong>30% </strong>risk of turning into malignancy</li>\n<li><strong>Solitary enchondroma</strong> has a&nbsp;<strong>&lt;2%</strong> risk of conversion to chondrosarcoma</li>\n</ul>\n<p>The most common tumor&nbsp;affecting&nbsp;small&nbsp;bones of the hand&nbsp;is enchondroma.&nbsp;<strong>Ollier disease&nbsp;</strong>is characterized by multiple enchondromas when present without hemangiomas.</p>\n<p><strong>Melorheostosis</strong>&nbsp;is an uncommon mesenchymal dysplasia manifesting as regions of sclerosing bone with a characteristic&nbsp;dripping wax appearance<a href=\"https://radiopaedia.org/articles/dripping-candle-wax-sign-melorheostosis?lang=us\" target=\"_blank\" rel=\"noopener\"></a>&nbsp;a.k.a.&nbsp;<strong>flowing candle wax appearance</strong>. It is also known as<strong>&nbsp;Leri disease</strong>,&nbsp;</p>\n<p><strong>Haemangiopericytomas</strong> are soft tissue sarcomas of vascular origin, comprised of <strong>pericytes</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d907b4d34db44d64920d0750a35752b4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6fa8ae21ff524e1cbb36dca771ff9defx1280x2184.JPEG"
    ]
  },
  {
    "text": "Which of the following tumors do not have osteoblasts as the predominant histological cell type?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoid osteoma"
      },
      {
        "id": 2,
        "text": "Osteochondroma"
      },
      {
        "id": 3,
        "text": "Osteosarcoma"
      },
      {
        "id": 4,
        "text": "Osteoblastoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Osteochondroma</strong> does not have osteoblast as the predominant cell type. It is made up of physeal<strong>&nbsp;chondrocytes&nbsp;</strong>showing active cartilage formation.</p>\n<p>Osteoid osteoma, osteoblastoma, and osteosarcoma are bone-forming tumors. They show active ossification and have osteoblasts as the predominant histological cell type.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common cause of pain in osteochondroma?",
    "choices": [
      {
        "id": 1,
        "text": "Nerve compression"
      },
      {
        "id": 2,
        "text": "Fracture"
      },
      {
        "id": 3,
        "text": "Malignant transformation"
      },
      {
        "id": 4,
        "text": "Bursitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Bursitis</strong> is the most common cause of&nbsp;<strong>pain</strong> in an <strong>osteochondroma.</strong></p>\n<p>Osteochondromas are common benign bone tumors which are <strong>developmental malformations</strong> rather than true neoplasms.</p>\n<p>Many of these lesions cause no symptoms and are <strong>discovered incidentally</strong>. However, some of them may become painful. <strong>Causes of pain</strong> in an osteochondroma are:</p>\n<ul>\n<li>Inflammation of overlying bursa</li>\n<li>Fracture of the bony stalk</li>\n<li>Compression of the neurovascular bundle of the limb</li>\n<li>Malignant transformation</li>\n</ul>\n<p>The following X-ray shows a well-defined exostosis.&nbsp;It <strong>emerges</strong> from the <strong>metaphysis</strong> and moves towards the diaphysis. It&nbsp;<strong>angles away</strong> from the <strong>growth plate</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/342bac1abd474840a3a0ca01d797fed0x720x1299.JPEG"
    ]
  },
  {
    "text": "A young boy with a bony swelling at his knee is diagnosed to have an osteochondroma. Which of the following suggests malignant degeneration of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Fracture displacement >2 cm"
      },
      {
        "id": 2,
        "text": "Obstruction to joint movement"
      },
      {
        "id": 3,
        "text": "Weight loss >10%"
      },
      {
        "id": 4,
        "text": "Thickness of cartilage cap >2cm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Malignant degeneration</strong> in an osteochondroma is suggested by&nbsp;the thickness of the&nbsp;<strong>cartilage cap exceeding</strong>&nbsp;<strong>2 cm</strong>.</p>\n<p>The cartilage cap overlies a bony stalk. It is irregular and usually cannot be seen on radiographs. Occasionally, calcification within the cap may be seen on X-rays.</p>\n<p>Other <strong>features suggestive of malignant change</strong> in an osteochondroma are:</p>\n<ul>\n<li>Persistence of tumor <strong>growth after skeletal maturity</strong></li>\n<li>Irregularly scattered flecks of<strong> calcification</strong> within the <strong>cartilage cap</strong></li>\n<li><strong>Spread into</strong> the surrounding&nbsp;<strong>soft tissue</strong></li>\n</ul>\n<p>Malignant degeneration of an osteochondroma may lead to development of chondrosarcoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the pathology seen in patients with Trevor's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Multiple osteochondromas"
      },
      {
        "id": 2,
        "text": "Intraarticular epiphyseal osteochondroma"
      },
      {
        "id": 3,
        "text": "Osteochondroma  associated with false aneurysms"
      },
      {
        "id": 4,
        "text": "Osteochondroma  associated with hemangiomas"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Trevor's disease&nbsp;is characterized by the presence of&nbsp;<strong>intra-articular epiphyseal osteochondromas</strong>.<strong>&nbsp;</strong></p>\n<p>In <strong>Trevor's disease</strong>, bony lesions appear on the medial or lateral aspect of the epiphysis. The lesions are localized to a <strong>single side</strong> of the body. <strong>Knee</strong> and <strong>ankle</strong> are most frequently involved.</p>\n<p>Multiple osteochondromas are seen in a condition known as<strong>&nbsp;</strong>diaphyseal aclasis or<strong>&nbsp;multiple hereditary exostoses.</strong></p>\n<p>The below <strong>lateral view X-ray</strong> of the lower limb shows&nbsp;<strong>non-uniform bone growth</strong>, and <strong>unconnected ossification centers</strong> related to the epiphyses at the knee and ankle. This is seen in <strong>Trevor's disease</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8690f3ad4d14d21a006211444998f5fx626x600.JPEG"
    ]
  },
  {
    "text": "Which of the following is false with respect to multiple hereditary exostoses?",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant disorder"
      },
      {
        "id": 2,
        "text": "Affected genes are EXT1 and EXT2"
      },
      {
        "id": 3,
        "text": "Associated with multiple enchondromas"
      },
      {
        "id": 4,
        "text": "Increased risk of malignant transformation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Multiple hereditary exostoses </strong>is associated with <strong>multiple osteochondromas</strong>.<strong>&nbsp;</strong>Multiple enchondromas are seen in Maffucci's syndrome and Ollier's disease.</p>\n<p>Multiple hereditary exostoses is an <strong>autosomal dominant</strong> disease. The affected genes are&nbsp;<strong>EXT1 </strong>and<strong> EXT2</strong>&nbsp;which are located on <strong>chromosomes</strong> <strong>8 </strong>and<strong> 11</strong> respectively.</p>\n<p>There is an<strong> increased risk</strong> of <strong>malignant transformation</strong> of the osteochondromas in case of multiple lesions (about 5%).&nbsp;Solitary lesions have a 1% risk of malignant transformation.</p>\n<p>The following X-ray image shows multiple osteochondromas around the knee.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b77a298c0ba94accb4b9553861079c28x309x420.JPEG"
    ]
  },
  {
    "text": "Which of the following lesions is an epiphyseal lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Enchondroma"
      },
      {
        "id": 2,
        "text": "Osteoid osteoma"
      },
      {
        "id": 3,
        "text": "Chondroblastoma"
      },
      {
        "id": 4,
        "text": "Osteoblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the given options, <strong>chondroblastoma</strong> is an epiphyseal lesion.</p>\n<p><strong>Epiphyseal lesions include:</strong></p>\n<ul>\n<li>Chondroblastoma</li>\n<li>Giant cell tumor in adults</li>\n<li>Clear chondrosarcoma</li>\n<li>Articular osteochondroma (Trevor's disease)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c03b0be99919464ca5915ccb0bb6e0c4x1280x1560.JPEG"
    ]
  },
  {
    "text": "A bone biopsy was performed on a child with a skull swelling.  It showed the presence of eosinophils and dendritic cells and was found to be CD 207 positive on immunohistochemistry. Which of the following skeletal manifestations would you not expect to see in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Vertebra plana"
      },
      {
        "id": 2,
        "text": "Geographic skull"
      },
      {
        "id": 3,
        "text": "Floating tooth"
      },
      {
        "id": 4,
        "text": "Short 4th metacarpal"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Langerhans cell histiocytosis.</strong>&nbsp;It is not characterised by the presence of&nbsp;a <strong>short 4th metacarpal</strong>. This feature is seen in <strong>pseudohypoparathyroidism</strong>.</p>\n<p>The <strong>skeletal and radiological manifestations</strong> of Langerhan's cell histiocytosis are:</p>\n<ul>\n<li><strong>Skull:</strong>\n<ul>\n<li>solitary or multiple punched out lytic lesion without sclerotic rim</li>\n<li>double contour or beveled edge appearance (hole-within-a-hole sign)</li>\n<li>button sequestra representing residual bone</li>\n<li><strong>geographic skull</strong></li>\n</ul>\n</li>\n<li><strong>Mandible:</strong>\n<ul>\n<li><strong>floating</strong> <strong>tooth</strong>: loss of lamina dura</li>\n</ul>\n</li>\n<li><strong>Spine:</strong>\n<ul>\n<li><strong>vertebra</strong>&nbsp;<strong>plana:</strong>&nbsp;most common cause of vertebra plana in children; mostly seen in thoracic spine</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child presents with difficulty in walking. On biopsy of the hip, some cells with grooved nuclei and eosinophilic cytoplasm are present. Which investigation would you order next?",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "Serum calcium"
      },
      {
        "id": 3,
        "text": "Serum PTH"
      },
      {
        "id": 4,
        "text": "CD1a marker"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Histopathologically, <strong>cells with grooved nuclei </strong>and<strong> eosinophilic cytoplasm</strong> can be observed in both <strong>Langerhans cell histiocytosis</strong> (LCH) and <strong>chondroblastoma</strong>. Therefore, the next step to differentiate between them would be to obtain a<strong> CD1a marker</strong>, which is typically<strong> positive in LCH</strong>.</p>\n<p>The specific markers for LCH are <strong>CD1a</strong> and <strong>langerin</strong> (CD207)</p>\n<p>It is worth noting that while an MRI can provide valuable information for evaluating the pathology, it is ideally performed before the biopsy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The CT scan image of a 50-year-old female with backache is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Vertebral metastasis"
      },
      {
        "id": 2,
        "text": "Hemangioma"
      },
      {
        "id": 3,
        "text": "Eosinophilic granuloma"
      },
      {
        "id": 4,
        "text": "Ossifying fibroma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the classical <strong>polka dot</strong> <strong>sign</strong>(on axial section)<strong>&nbsp;</strong>and the&nbsp;<strong>C</strong><strong>orduroy sign /jailhouse appearance</strong>(on vertical section). These are seen in <strong>vertebral hemangioma</strong>.</p>\n<p>These signs are the result of the replacement of normal cancellous bone by thickened vertical trabeculae.</p>\n<p>The corduroy sign is shown in the following image.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bb74399c2ad44eaba37c3f8cd8b0e73e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9198caee955245d8a7ca0778a2f7243cx720x764.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false with respect to hemangiomas?",
    "choices": [
      {
        "id": 1,
        "text": "Biopsy is rarely needed for diagnosis"
      },
      {
        "id": 2,
        "text": "They usually arise from posterior elements of vertebra"
      },
      {
        "id": 3,
        "text": "They cause local gigantism when they occur on an extremity"
      },
      {
        "id": 4,
        "text": "They are also common in the skull"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hemangioma</strong>&nbsp;<strong>arises</strong> more commonly from the <strong>vertebral</strong> <strong>body.</strong></p>\n<p>Hemangioma is a benign tumor and consists of vascular channels (capillary, venous or cavernous). Apart from the spine, <strong>skull</strong> is also a <strong>common site</strong> for hemangiomas.</p>\n<p><strong>Biopsy</strong> is rarely needed due to the threat of <strong>hemorrhagic shock. </strong>Imaging techniques such as <strong>CT/MRI</strong> are used to make the <strong>diagnosis</strong>.</p>\n<p>A hemangioma on a <strong>limb</strong> can lead to local <strong>hypertrophy</strong>. This can cause<strong> localised gigantism</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '27 Benign Tumors Of Bone';
        const quizFilename = '27-benign-tumors-of-bone-2e8ba229.html';
        let hierarchy = ["Marrow", "qBank", "Orthopedics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>