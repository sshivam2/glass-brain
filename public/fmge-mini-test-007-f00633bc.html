<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 007 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 55-year-old male presented with angina. Coronary angiography revealed a block in the right coronary artery. The condition is likely to cause a \u200bdecrease in blood supply through all of the following blood vessels except:",
    "choices": [
      {
        "id": 1,
        "text": "Acute marginal"
      },
      {
        "id": 2,
        "text": "Posterior interventricular artery"
      },
      {
        "id": 3,
        "text": "Artery to SA node"
      },
      {
        "id": 4,
        "text": "Circumflex artery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Circumflex artery </strong>is<strong> not a branch </strong>of the <strong>right coronary artery.&nbsp;</strong>It is a branch of the left coronary artery.</p>\n<p>The branches of the right coronary artery are:</p>\n<ul>\n<li><strong>Right conal artery</strong> - It is the first branch of the right coronary artery.</li>\n<li><strong>Artery of the SA node&nbsp;</strong></li>\n<li><strong>Acute right marginal artery&nbsp;</strong></li>\n<li><strong>Posterior interventricular artery</strong> (in 65% population)</li>\n<li>Atrial and anterior and posterior ventricular branches</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/76895c44dd884e8da76d1d984b81bad5x1280x2059.JPEG"
    ]
  },
  {
    "text": "A patient with parathyroid deficiency 10 days after inadvertent damage to the parathyroid glands during thyroid surgery would probably have",
    "choices": [
      {
        "id": 1,
        "text": "Low plasma phosphate and Ca2+ levels and tetanus."
      },
      {
        "id": 2,
        "text": "Low plasma Ca2+ level, increased muscular excitability, and upper extremity muscle spasms."
      },
      {
        "id": 3,
        "text": "High plasma phosphate and Ca2+ levels and bone demineralization."
      },
      {
        "id": 4,
        "text": "Increased muscular excitability, a high plasma Ca2+ level, and bone demineralization"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 966\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Parathyroid hormone deficiency leads to<strong> low Ca+2 levels and tetany.</strong> (Not tetanus, caused by an infection of bacteria&nbsp;<em>Clostridium tetani</em>)</p>\n<p>Actions of PTH include</p>\n<ul>\n<li>PTH stimulates bone resorption, causing the release of calcium into the extracel&shy;lular fluid;</li>\n<li>PTH <strong>increases</strong> reabsorption of <strong>calcium</strong> and <strong>decreases</strong> <strong>phosphate</strong> reabsorption by the renal tubules, leading to decreased excretion of calcium and increased excretion of phosphate; and</li>\n<li>PTH is necessary for the conversion of 25&shy;-hydroxycholecalciferol to 1,25&shy; dihydroxycholecalciferol, which, in turn, increases calcium absorption by the intestines.&nbsp;</li>\n</ul>\n<p>So, a <strong>deficiency</strong> of PTH would lead to <strong>low Ca+2</strong> levels and <strong>high phosphate</strong> levels.&nbsp;</p>\n<div class=\"page\" title=\"Page 393\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The signs of tetany in humans include <strong>Chvostek sign</strong>, a quick contraction of the ipsilateral facial muscles elicited by tapping over the facial nerve at the angle of the jaw, and <strong>Trousseau sign</strong>, a spasm of the muscles of the upper extremity that causes flexion of the wrist and thumb.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/f4c16818d8364ff1b989df4411075b41x330x389.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/740cce11a46044db98e3e9cde3d86238x518x390.JPEG"
    ]
  },
  {
    "text": "Which is the largest human plasma lipoprotein?",
    "choices": [
      {
        "id": 1,
        "text": "VLDL"
      },
      {
        "id": 2,
        "text": "LDL"
      },
      {
        "id": 3,
        "text": "HDL"
      },
      {
        "id": 4,
        "text": "Chylomicron"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Chylomicrons&nbsp;</strong>are the <strong>largest among plasma lipoproteins</strong>, which are especially rich in triacylglycerol.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ecd14a228d0e4721b9857b0d75fd1213x304x512.JPEG"
    ]
  },
  {
    "text": "A 20-year-old woman presenting with fatigue and weakness shows the following laboratory values: Hemoglobin 9 gm%; MCV  70 fl; MCH 22 pg/cell; and RDW 28. There is no history of blood transfusion. The peripheral smear is as seen below. What is the most likely diagnosis of the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thalassemia major"
      },
      {
        "id": 2,
        "text": "Thalassemia minor"
      },
      {
        "id": 3,
        "text": "Iron-deficiency anemia"
      },
      {
        "id": 4,
        "text": "Anemia of chronic disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above peripheral smear showing microcytic, hypochromic blood picture with pencil cells implies that the most likely diagnosis for the patient is iron-deficiency anemia.&nbsp;</p>\n<p><strong>Hemogram:</strong></p>\n<ul>\n<li>MCV of 70 fl is suggestive of&nbsp;<strong>microcytosis&nbsp;</strong>(normal MCV is 82&ndash;96 fl)</li>\n<li>MCH of 22 pg is suggestive of<strong> hypochromia&nbsp;</strong>(normal MCH is 27&ndash;33 pg/cell)</li>\n<li>Red cell distribution width (RDW) of 28 is suggestive of <strong>anisocytosis</strong> (normal RDW is 11.5-14.5%).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a0892ca296234fa8b244d3e13f56f757.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old male presented with high-grade fever, and purpuric rash as shown in the image below. CSF sample showed gram-negative diplococci. Which of the following is the most likely aetiology?",
    "choices": [
      {
        "id": 1,
        "text": "Neisseria meningitidis"
      },
      {
        "id": 2,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 3,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 4,
        "text": "E.coli"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a <strong>purpuric rash</strong> seen in meningococcemia caused by <strong>Neisseria meningitidis,</strong> which are gram-negative diplococci.&nbsp;</p>\n<p>Pathogenesis &amp; clinical features:</p>\n<ul>\n<li>The organism enters the body through the nasopharynx. From nasopharynx, they enter the bloodstream producing bacteremia, and the symptoms may resemble upper respiratory tract infection.</li>\n<li>Fulminant meningococcemia is the severe form, where the patient presents with high-grade fever and <strong>hemorrhagic</strong>&nbsp;<strong>rash.</strong> There is thrombosis of several small blood vessels in various organs with perivascular infiltration and <strong>petechial haemorrhages.&nbsp;</strong></li>\n<li>Some patients with fulminant meningococcemia may also develop disseminated intravascular coagulation, and circulatory collapse,&nbsp;a condition known as&nbsp;Waterhouse&ndash;Friderichsen syndrome.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a2bdb1ee34214aea9657c7a2e5d49e98.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Corticosteroid indicated for the stimulation of fetal lung maturation in preterm labor______",
    "choices": [
      {
        "id": 1,
        "text": "Hydrocortisone"
      },
      {
        "id": 2,
        "text": "Triamcinolone"
      },
      {
        "id": 3,
        "text": "Methylprednisolone"
      },
      {
        "id": 4,
        "text": "Betamethasone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Betamethasone</strong> is indicated for the stimulation of <strong>fetal lung maturation in preterm labor.</strong></p>\n<p><strong>Dexamethasone</strong>, another long-acting glucocorticoid is also indicated. It has benefits such as less risk of intraventricular hemorrhage and a shorter length of stay in the NICU.</p>\n<p class=\"p1\">Maternal administration of glucocorticoids is advised in preterm labor when the period of gestation is&nbsp;<strong>less</strong>&nbsp;than&nbsp;<strong>34 weeks</strong>.&nbsp;<strong>Intramuscular injection</strong>&nbsp;of either betamethasone or dexamethasone is given.</p>\n<p class=\"p1\"><strong>Dosage</strong>:&nbsp;</p>\n<ul>\n<li class=\"p1\">Betamethasone(Betnesol): Two doses of 12 mg each, given 24 hours apart.</li>\n<li class=\"p1\">Dexamethasone: Four doses of 6 mg each, given every 12 hours.</li>\n</ul>\n<p class=\"p1\">This helps in fetal lung maturation and minimizes the incidence of:</p>\n<ul>\n<li class=\"p1\">Respiratory distress syndrome</li>\n<li class=\"p1\">Intraventricular hemorrhage</li>\n<li class=\"p1\">Necrotizing enterocolitis</li>\n</ul>\n<p>It is beneficial when the delivery is delayed beyond 48 hours after the first dose.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following postmortem staining is seen in ____?",
    "choices": [
      {
        "id": 1,
        "text": "Opioid poisoning"
      },
      {
        "id": 2,
        "text": "CO poisoning"
      },
      {
        "id": 3,
        "text": "H2S poisoning"
      },
      {
        "id": 4,
        "text": "Phosphorous poisoning"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image above is characteristic of Cherry red postmortem lividity. It is seen in <strong>carbon monoxide poisoning</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/45ae292cfafa43f2a98d3ff2eda5932d.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The only abductor of the vocal cord is ______",
    "choices": [
      {
        "id": 1,
        "text": "Cricothyroid"
      },
      {
        "id": 2,
        "text": "Posterior cricoarytenoid"
      },
      {
        "id": 3,
        "text": "Lateral cricoarytenoid"
      },
      {
        "id": 4,
        "text": "Interarytenoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Posterior cricoarytenoid is the only intrinsic muscle of the larynx that causes abduction of vocal cords.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lady wants LASIK surgery for her daughter. Which of the following is not an eligibility criteria for LASIK?",
    "choices": [
      {
        "id": 1,
        "text": "Stable refraction for the past 1 year"
      },
      {
        "id": 2,
        "text": "Corneal thickness of 600 microns"
      },
      {
        "id": 3,
        "text": "Age of 15 years"
      },
      {
        "id": 4,
        "text": "Myopia of 4D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Age of 15 years is not a criteria for LASIK surgery. LASIK surgery is performed after 18 years of age.</p>\n<p>Laser-assisted in situ keratomileusis (LASIK) is performed</p>\n<ul>\n<li>using <strong>excimer laser</strong></li>\n<li>in individuals aged <strong>&gt; 18 years</strong></li>\n<li>in individuals who have a <strong>stable refractive error</strong></li>\n<li>in individuals who have had <strong>unsatisfactory results</strong> with<strong> non-surgical treatment</strong></li>\n<li>in individuals in whom corneal-thinning disorders such as <strong>keratoconus have been ruled out</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0218bf6b33284cefb4740f46ad0fef01x1280x1238.JPEG"
    ]
  },
  {
    "text": "Immunization is ____.",
    "choices": [
      {
        "id": 1,
        "text": "Primordial prevention"
      },
      {
        "id": 2,
        "text": "Primary prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Immunization</strong> is a form of<strong> primary prevention,</strong> through <strong>specific protection</strong>.</p>\n<ul>\n<li>Primary prevention is <strong>action taken prior</strong> to the onset of disease, which removes the possibility that disease will ever occur.</li>\n<li><strong>Population strategy and high risk strategy </strong>are used as part of primary prevention.</li>\n<li><strong>Examples:</strong>&nbsp;Immunization, sanitation, and protection of food.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Specificity of a screening test is the ability of a test to detect ____",
    "choices": [
      {
        "id": 1,
        "text": "True positives"
      },
      {
        "id": 2,
        "text": "False positives"
      },
      {
        "id": 3,
        "text": "True negatives"
      },
      {
        "id": 4,
        "text": "False negatives"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Specificity </strong>of a screening test is the ability of the test to identify correctly <strong>those who don&rsquo;t have the disease</strong> or the true negatives.</p>\n<p><strong>Sensitivity </strong>of a screening test is the ability of the test to identify correctly <strong>those who have the disease</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The cornerstone of treatment for a patient of dengue with warning signs is:",
    "choices": [
      {
        "id": 1,
        "text": "IV Fluids"
      },
      {
        "id": 2,
        "text": "Platelets"
      },
      {
        "id": 3,
        "text": "Cryoglobulins"
      },
      {
        "id": 4,
        "text": "FFP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mainstay of treatment for a patient of dengue with warning signs is <strong>IV fluid</strong>s.</p>\n<p>The main pathology in dengue is plasma leakage resulting in intravascular volume depletion and thereby shock. So, the supportive management with continuous&nbsp;infusion of crystalloid IV fluids remains the primary modality of treatment in these patients. And often patients respond well to supportive management.</p>\n<p><strong>Platelet transfusion</strong> is limited to patients with <strong>severe thrombocytopenia (&lt;10,000/mm<sup>3</sup></strong>) and <strong>active bleeding</strong>.</p>\n<p>FFP and cryoglobulins are not the preferred treatment modality in dengue.</p>\n<p><strong>Warning signs</strong> in dengue include&nbsp;</p>\n<ul>\n<li><strong>Abdominal pain</strong> or tenderness</li>\n<li>Persistent <strong>vomiting</strong></li>\n<li><strong>Clinical fluid accumulation</strong> (ascites, pleural effusion)</li>\n<li><strong>Mucosal bleeding</strong></li>\n<li>Lethargy or restlessness</li>\n<li>Hepatomegaly &gt;2 cm</li>\n<li>Increase in hematocrit concurrent with a rapid decrease in platelet count</li>\n</ul>\n<p><strong>Inpatient management</strong> is advised to all patient of <strong>dengue with warning signs</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An adolescent boy presents with yellowish discoloration of sclera. His liver function tests reveal conjugated hyperbilirubinemia and normal liver enzyme levels. Liver biopsy revealed an accumulation of dark melanin like pigment in the hepatocytes. What is the probable diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Gilbert syndrome"
      },
      {
        "id": 2,
        "text": "Crigler- najjar syndrome"
      },
      {
        "id": 3,
        "text": "Dubin johnson syndrome"
      },
      {
        "id": 4,
        "text": "Rotor syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario describes <strong>conjugated hyperbilirubinemia</strong> with <strong>dark pigment deposition</strong>&nbsp;(image below) in the liver. These features are suggestive of <strong>Dubin Johnson syndrome</strong>.</p>\n<p>In<strong> Dubin Johnson syndrome</strong> (DJS) there is&nbsp;<strong>defective excretion </strong>of conjugated <strong>bilirubin </strong>and&nbsp;various compounds like <strong>epinephrine metabolites&nbsp;</strong>causing the liver to appear<strong> black</strong>.</p>\n<p><strong>Rotor syndrome</strong> also has conjugated hyperbilirubinemia but there is <strong>no&nbsp;pigmentation</strong> of the liver. Serum bilirubin levels are not helpful in differentiating between&nbsp;<strong>Dubin Johnson</strong>&nbsp;syndrome (DJS) and&nbsp;<strong>Rotor's</strong>&nbsp;syndrome as both these conditions present with&nbsp;<strong>mild elevation</strong>&nbsp;of&nbsp;<strong>serum bilirubin</strong>.</p>\n<p>These two conditions can be differentiated as follows:</p>\n<table width=\"904\">\n<tbody>\n<tr>\n<td><strong>Test</strong></td>\n<td><strong>Rotor Syndrome</strong></td>\n<td><strong>Dubin Johnson syndrome</strong></td>\n</tr>\n<tr>\n<td>Oral cholecystography</td>\n<td>Gall bladder is visualized</td>\n<td>\n<p>Gall bladder not visualised&nbsp;</p>\n<p>Impaired ability to concentrate the contrast material into bile</p>\n</td>\n</tr>\n<tr>\n<td>Total urinary coproporphyrin</td>\n<td>Elevated</td>\n<td>\n<p>Normal&nbsp;</p>\n<p>Increased excretion of coproporphyrin 1 and decreased excretion of coproporphyrin 3</p>\n</td>\n</tr>\n<tr>\n<td>Bromsulphalein (BSP) clearance test</td>\n<td>\n<p>Delayed clearance of BSP</p>\n<p>No reflux</p>\n</td>\n<td>\n<p>Rise in plasma levels of BSP after 90 minutes of injection</p>\n<p>Reflux of BSP from hepatocytes&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Gilbert and Crigler-Najjar syndromes are characterized by unconjugated hyperbilirubinemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef4edf340f114f7aaac451fa89ec025bx432x287.JPEG"
    ]
  },
  {
    "text": "A 60-year-old man with a history of COPD presents with increased shortness of breath. His ABG analysis reveals pH - 7.24; pCO2 - 60 mm Hg, pO2- 52 mmHg, HCO3 - 27 mmol/L. What is the most probable underlying acid-base disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic Acidosis"
      },
      {
        "id": 2,
        "text": "Metabolic Alkalosis"
      },
      {
        "id": 3,
        "text": "Respiratory Acidosis"
      },
      {
        "id": 4,
        "text": "Respiratory Alkalosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The underlying acid-base disorder is respiratory acidosis.</p>\n<ul style=\"list-style-type: circle;\">\n<li>Step 1: A pH of <strong>7.24</strong> signifies&nbsp;<strong>acidosis</strong>.</li>\n<li>Step 2: A plasma HCO<sub>3</sub><sup>-</sup> is <strong>27 mEq/L</strong> is within normal limits. This is very likely to be due to compensation as it does not reflect the direction of the pH change.</li>\n<li>Step 3: A pCO<sub>2</sub> of <strong>60 mmHg</strong>&nbsp;along with an acidotic pH signifies <strong>respiratory acidosis</strong>.&nbsp;</li>\n<li>Step 4: The expected compensatory increase in HCO<sub>3</sub><sup>-&nbsp;</sup>can be calculated using the following formula:</li>\n</ul>\n<ul>\n<li>Increase in HCO<sub>3</sub><sup>-&nbsp;</sup>= 0.4 X &Delta; PaCO<sub>2</sub> (as COPD is a chronic condition and the presentation of the patient is not acute)</li>\n<li>Thus, the increase in&nbsp;HCO<sub>3</sub><sup>- </sup>= 0.4 x (60-40) = 8 mEq/L</li>\n<li>Therefore expected HCO<sub>3</sub><sup>-</sup> is 24 + 8 = <strong>32 mEq/L</strong>.</li>\n<li>The actual HCO3- measured is 27 mEq/L (which is less than the expected value) indicating that&nbsp;there could be a component of metabolic acidosis also.</li>\n<li>But, the predominant disorder is <strong>respiratory acidosis</strong>&nbsp;and thus it is the best answer.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presented to the OPD with a history of fever for the past 5 days. On examination, tender lesions were found in his extremities as marked below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Snake bite"
      },
      {
        "id": 2,
        "text": "Infective endocarditis"
      },
      {
        "id": 3,
        "text": "Cat scratch disease"
      },
      {
        "id": 4,
        "text": "Rocky Mountain Spotted Fever"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most probable diagnosis for this patient would be <strong>infective endocarditis</strong>.</p>\n<p><strong>Tender</strong> <strong>violaceous subcutaneous nodules</strong> in the fingers shown in the image are <strong>Osler nodes</strong>. They usually occur in the pads of fingers and toes but can also occur on the thenar and hypothenar eminences.</p>\n<p>Other lesions that are highly suggestive of infective endocarditis include:</p>\n<ul>\n<li><strong>Roth spots</strong>: These are&nbsp;are exudative, edematous <strong>hemorrhagic lesions of the retina</strong> with pale centres.</li>\n<li><strong>Janeway lesions:</strong>&nbsp;They are <strong>nontender, slightly raised haemorrhages</strong> on the palms and soles.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c8b97e1828f467d84249ab1b8ef3c83.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1cad717c18d34dc19aa657b5a2c344a3x720x526.JPEG"
    ]
  },
  {
    "text": "Diagnose the given ECG.",
    "choices": [
      {
        "id": 1,
        "text": "Anterior wall MI"
      },
      {
        "id": 2,
        "text": "Lateral wall MI"
      },
      {
        "id": 3,
        "text": "Inferior wall MI"
      },
      {
        "id": 4,
        "text": "Anteroseptal MI"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lateral wall MI</strong> (and posterior wall MI) is the diagnosis.</p>\n<p><strong>ST-elevation</strong> is present in the high lateral leads (<strong>I and aVL</strong>) <strong>and in V5 and V6</strong>.&nbsp;<strong>Reciprocal ST depression</strong> is seen in the inferior leads (<strong>III and aVF</strong>) with <strong>associated ST depression in V1, V2, and V3</strong> (which could represent posterior wall MI). This pattern is consistent with an acute infarction localized to the superior portion of the lateral wall of the left ventricle (high lateral STEMI).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b36e100b8f9417e8d38a74213ec814e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3025f15bdbef485eb7f4edc5806e5c42x1280x1979.JPEG"
    ]
  },
  {
    "text": "A 15-year-old male undergoes bilateral adrenalectomy for phaeochromocytoma. On the third postoperative day, the boy feels lethargic and tired. Blood pressure is 80/60 mm Hg, there is no sign of bleed. What could be the cause of this?",
    "choices": [
      {
        "id": 1,
        "text": "Addison's crisis"
      },
      {
        "id": 2,
        "text": "SIADH"
      },
      {
        "id": 3,
        "text": "Diabetes insipidus"
      },
      {
        "id": 4,
        "text": "Cerebral salt wasting disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features given in the question are suggestive of <strong>Addisonian crisis.</strong></p>\n<p><strong>Addisonian crisis</strong> is a life-threatening condition caused due to <strong>sudden insufficiency</strong> <strong>of adrenal hormones</strong>. Normally, adrenal corticosteroids help to retain sodium and maintain normal intravascular volume. Sudden lack of these hormones causes excessive <strong>loss of sodium, decreased intravascular volume, low blood pressure</strong> and eventually <strong>circulatory collapse.</strong></p>\n<p>The <strong>causes</strong> are either primary or secondary. Primary causes include adrenal haemorrhage, acute infection, etc, while the secondary causes include surgery, cessation of steroid therapy, postpartum pituitary necrosis, etc.</p>\n<p><strong>Treatment</strong> includes fluid and glucocorticoid replacement.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the imaging modality.",
    "choices": [
      {
        "id": 1,
        "text": "Retrograde pyelogram"
      },
      {
        "id": 2,
        "text": "Retrograde urethrogram"
      },
      {
        "id": 3,
        "text": "Intravenous pyelography"
      },
      {
        "id": 4,
        "text": "Antegrade pyelography"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts a <strong>retrograde pyelogram. </strong></p>\n<p>Retrograde Pyelogram is particularly valuable when<strong> IVP/CT is contraindicated </strong>and excels at providing detailed imaging of the <strong>collecting system, especially for evaluating ureteral strictures</strong> and <strong>filling defects</strong>, making it especially useful in surgical planning.\u00a0</p>\n<p>Other Options:</p>\n<p>Option B: In <strong>Retrograde urethrogram,</strong> the urethra is visualized with the instillation of contrast into the anterior urethra (penile urethra and bulbar urethra). It helps diagnose <strong>anterior urethral abnormalities.</strong> The following image shows an image of retrograde urethrogram contrast leakage at the <strong>membranous urethra.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/332be08ddd9940b6bd594e4a745b0603.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3c0107c7e17146ceb791c463d277f57ax720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd6beebe22594cdfb4908f7b74a1b670x720x964.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67031746ef214b3ca5e3fd541b607d41x452x547.JPEG"
    ]
  },
  {
    "text": "The most common salivary gland to develop stones is______.",
    "choices": [
      {
        "id": 1,
        "text": "Parotid"
      },
      {
        "id": 2,
        "text": "Minor salivary glands"
      },
      {
        "id": 3,
        "text": "Submandibular"
      },
      {
        "id": 4,
        "text": "Sublingual"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>80% of salivary gland stones occur in the submandibular gland and are mostly radioopaque.</strong></p>\n<p><strong>Sialolithiasis:</strong></p>\n<ul>\n<li>It is less common in the parotid gland (20%) than in the&nbsp;<strong>submandibular gland</strong> (80%), leading to sialadenitis.</li>\n<li><strong>Parotid duct stones</strong> are <strong>usually radiolucent and rarely visible on plain radiography.</strong></li>\n<li>They are frequently located at the confluence of the collecting ducts or located in the distal aspect of the parotid duct adjacent to the parotid papilla.</li>\n<li><strong>Parotid gland sialography</strong> is usually required to identify the stone.</li>\n<li>A stone located in the collecting duct or within the gland may be managed by either <strong>endoscopic retrieval, or lithotripsy; in rare cases, surgical removal via a parotidectomy approach may be required.</strong></li>\n<li>In the case of sialadenitis, treatment is either <strong>marsupialization or total excision of the gland.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the following incision used for appendicectomy.",
    "choices": [
      {
        "id": 1,
        "text": "Gridiron incision"
      },
      {
        "id": 2,
        "text": "Lanz incision"
      },
      {
        "id": 3,
        "text": "Rutherford\u2013Morison incision"
      },
      {
        "id": 4,
        "text": "Rockey\u2013Davis incision"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Lanz incision</strong> is a Transverse or skin crease incision for appendicitis,2 cm below the&nbsp; umbilicus, centred on the midclavicular&ndash;midinguinal line</li>\n<li><strong>Rockey&ndash;Davis incision :</strong>&nbsp;Transverse right lower quadrant incision.</li>\n<li><strong>Gridiron</strong>&nbsp;i<strong>ncision :</strong>&nbsp;Oblique muscle <strong>splitting</strong> incision in the right lower quadrant. Also called as <strong>Mc Burney</strong> incision.</li>\n<li><strong>Rutherford&ndash;Morrison incision :&nbsp;</strong>oblique muscle <strong>cutting</strong> incision with its lower end over McBurney&rsquo;s point and <strong>extending obliquely upwards and laterally</strong> as necessary(Shown on the left side in the image for the sake of clarity)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a78a0432c24e4ce9b94c2ff77b54f972.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7fcf2d22eeb94e2686b24dca63e0784ex1200x1486.JPEG"
    ]
  },
  {
    "text": "Chadwick sign is seen in _____",
    "choices": [
      {
        "id": 1,
        "text": "Fallopian tube"
      },
      {
        "id": 2,
        "text": "Vagina"
      },
      {
        "id": 3,
        "text": "Uterus"
      },
      {
        "id": 4,
        "text": "Ovary"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Jacquemier&rsquo;s</strong> or <strong>Chadwick&rsquo;s sign</strong>&nbsp;is the&nbsp;<strong>dusky hue</strong> of the vestibule and<strong> anterior vaginal wall</strong>&nbsp;visible at around 8th week of pregnancy. The discolouration is due to <strong>local vascular congestion</strong>.</p>\n<div class=\"page\" title=\"Page 69\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>During pregnancy, there is increased vascularity and hyperemia in the skin and muscles of the perineum and vulva. This increased vascularity prominently affects the vagina and cervix and results in the&nbsp;<strong>bluish tint</strong>&nbsp;of the <strong>vagina </strong>and<strong> ectocervix</strong> which is characteristic of the Chadwick sign.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/50c10bd7407848ce93706e40b58dc4b2x1280x2558.JPEG"
    ]
  },
  {
    "text": "After successful delivery of the baby, the obstetrician witnesses that the episiotomy performed has extended away backwards beyond the perineal body. Which among the following structures is likely to be injured in this case?",
    "choices": [
      {
        "id": 1,
        "text": "External anal sphicter"
      },
      {
        "id": 2,
        "text": "Ischiocavernosus"
      },
      {
        "id": 3,
        "text": "Bulbospongiosis"
      },
      {
        "id": 4,
        "text": "Urethral sphincter"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The structure injured in an episiotomy done posteriorly beyond the perineal body is the <strong>external anal sphincter</strong>.&nbsp;</p>\n<p class=\"p1\">The lacerations of the perineum have been divided into four degrees:</p>\n<ul>\n<li class=\"p1\">First degree- laceration is restricted to the <strong>skin</strong> of the fourchette</li>\n<li class=\"p1\">Second degree- <strong>muscles</strong> of the perineal body are torn through</li>\n<li class=\"p1\">Third degree- the tear extends partially backward through the <strong>external anal sphincter</strong></li>\n<li class=\"p1\">Fourth degree- the external anal sphincter is torn and <strong>anal</strong> <strong>mucosa</strong> is also involved</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pap smear is ________",
    "choices": [
      {
        "id": 1,
        "text": "Screening test"
      },
      {
        "id": 2,
        "text": "Diagnostic test"
      },
      {
        "id": 3,
        "text": "Confirmative test"
      },
      {
        "id": 4,
        "text": "Both a & b"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Pap smear is a <strong>screening</strong> test. In case of positive&nbsp;test further investigations should be done.</p>\n<p><strong>Pap Smear&nbsp;Schedule</strong></p>\n<ul>\n<li>Time for initiation: <strong>21 years</strong>, regardless of the age of first sexual intercourse.</li>\n<li>Women aged 21-29 years: Every <strong>3 years</strong>(earlier it was done annually)</li>\n<li>Women aged 30-65 years: Pap test + HPV testing every <strong>5 years</strong>.</li>\n<li>Women should stop having cervical cancer screening after the age of 65 years.&nbsp;If suspicious PAP, screening till 75 years.</li>\n<li>HIV+ women: annual checkup until three consecutive negative tests followed by testing every 3 years for life.</li>\n<li>HPV DNA testing in combination with PAP improves the sensitivity of screening.</li>\n</ul>\n<p>Ayres spatula and endocervical brush are the instruments used for the pap test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea2611c6fd594b378534c87172d8620ex1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/632a126becc3436088ff92325108ae48x486x724.JPEG"
    ]
  },
  {
    "text": "A 5-year-old boy presents with a short history of facial oedema that has now progressed to total body swelling involving the face, abdomen, scrotum, and feet. Urinalysis revealed protein 4+ with no hematuria and a urine protein:creatinine ratio of 3. What is the initial treatment of choice for this child?",
    "choices": [
      {
        "id": 1,
        "text": "Prednisolone"
      },
      {
        "id": 2,
        "text": "Cyclophosphamide"
      },
      {
        "id": 3,
        "text": "Levamisole"
      },
      {
        "id": 4,
        "text": "Cyclosporine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical picture and investigations are suggestive of <strong>minimal change nephrotic syndrome</strong> and the initial treatment of choice is corticosteroids such as <strong>prednisolone.</strong></p>\n<p>Minimal change nephrotic syndrome is the <strong>most common cause of nephrotic syndrome</strong>. It is seen in <strong>ages 2-6 years</strong> with a clinical picture of nephrotic syndrome with</p>\n<ul>\n<li>heavy proteinuria</li>\n<li>oedema</li>\n<li>hypoalbuminemia</li>\n<li>hyperlipidemia.</li>\n</ul>\n<p>They show <strong>excellent response to steroid</strong> therapy. A daily dose of 2mg/kg (max 60mg) for 6 weeks followed by an alternate day dose of 1.5mg/kg (max 40mg) for the next 6-8 weeks is recommended.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the following-",
    "choices": [
      {
        "id": 1,
        "text": "Cock-up splint"
      },
      {
        "id": 2,
        "text": "Dynamic finger splint"
      },
      {
        "id": 3,
        "text": "Colle's cast"
      },
      {
        "id": 4,
        "text": "Knuckle bender splint"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image provided above is that of <strong>cock-up splint&nbsp;</strong>and is used in <strong>radial nerve palsy.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5e93a4a2b326479f83499b6c4b93b00a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b4097bb9a3aa4a9ba3d409acd0469620x1280x1395.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b74d7887f7d44865a41f06b2a26122e0x1280x754.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/92e12acd218442248ab27e1db7ef5eb4x355x321.JPEG"
    ]
  },
  {
    "text": "The egg in cup heart is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Pericardial effusion"
      },
      {
        "id": 2,
        "text": "Constrictive pericarditis"
      },
      {
        "id": 3,
        "text": "TOF"
      },
      {
        "id": 4,
        "text": "HOCM"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Egg in a Cup</strong>&nbsp;appearance is seen with <strong>Constrictive pericarditis.</strong></p>\n<ul>\n<li>Constrictive pericarditis results with <strong>calcification of the pericardium</strong>. There is a s<strong>traightening of the right heart border</strong> and <strong>roughening of the cardiac outline</strong> as a result of pleuropericardial thickening. Calcification has a characteristic distribution involving the anterior and lateral aspects of the heart.</li>\n<li>Constrictive pericarditis is a type of pericarditis which leads to diastolic dysfunction and potential symptoms of right heart failure. Characterized by <strong>fibrous</strong> or <strong>calcific constrictive thickening of the&nbsp;</strong><strong>pericardium,&nbsp;</strong>which prevents normal diastolic filling of the heart.</li>\n<li>MRI is the investigation done to assess the thickness of pericardium.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d1e04a5c48444cc480b14c3c16bf150d.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Premature ejaculation is a disorder of which phase of the normal sexual cycle?",
    "choices": [
      {
        "id": 1,
        "text": "Desire"
      },
      {
        "id": 2,
        "text": "Arousal"
      },
      {
        "id": 3,
        "text": "Orgasm"
      },
      {
        "id": 4,
        "text": "Pain"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Premature ejaculation is a disorder of the <strong>orgasm</strong> phase of normal sexual cycle.</p>\n<div class=\"page\" title=\"Page 597\">In premature ejaculation, there is a <strong>persistent</strong> or<strong> recurrent achievement</strong>of orgasm and ejaculation <strong>before</strong> the patient actually wishes to. According to DSM-5, it is classified as follows:</div>\n<div class=\"page\" title=\"Page 597\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li><strong>Mild</strong> if ejaculation occurs within approximately <strong>30 sec&shy;onds </strong>to <strong>1 minute</strong> of vaginal penetration</li>\n<li><strong>Moderate</strong> if ejaculation occurs within approximately <strong>15 to 30 seconds</strong> of vaginal pen&shy;etration</li>\n<li><strong>Severe</strong> if ejaculation occurs at the <strong>start</strong> of sexual activity or within approximately <strong>15 seconds</strong> of vaginal penetra&shy;tion.</li>\n</ul>\n<p>Pharmacologic therapy when combined with behavioral treatment appears to be more effective in treating <strong>premature&nbsp;ejaculation.&nbsp;</strong></p>\n<p>The <strong>squeeze technique</strong> is a behavioral method used on the penis to prevent premature ejaculation. Here, the penis is stimulated until just before orgasm after which it is gently squeezed.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The device shown in the given image is used for the monitoring of:",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen saturation"
      },
      {
        "id": 2,
        "text": "Oxygen content of the blood"
      },
      {
        "id": 3,
        "text": "Partial pressure of oxygen"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image depicts a <strong>pulse oximeter</strong>. Pulse oximetry is used for <strong>monitoring pulse rate and oxygen saturation</strong> of a patient.</p>\n<p>A small sensor is placed on the finger, toe, earlobe, or another convenient place.</p>\n<p>The <strong>relative absorption of light by oxyhemoglobin</strong> (HbO) and deoxyhemoglobin is assessed by <strong>measuring the amount of red and infrared light emerging from tissues</strong> traversed by light rays and processed by the device, producing an oxygen saturation level.</p>\n<p>Pulse oximetry does <strong>not measure the absolute content or the partial pressures of oxygen or carbon dioxide</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bfbaff03740845859ba1be1ce2b528e5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which among the following is not true regarding atopic eczema?",
    "choices": [
      {
        "id": 1,
        "text": "Pruritus is the hallmark"
      },
      {
        "id": 2,
        "text": "Dennie Morgan fold can be found under lower eyelid"
      },
      {
        "id": 3,
        "text": "It has an extensor distribution in the adult phase"
      },
      {
        "id": 4,
        "text": "Allergic shiners may be present"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Option (c) is not true</strong> as <strong>atopic eczema</strong> has a <strong>flexural distribution.&nbsp;</strong></p>\n<ul>\n<li>Only in <strong>infantile type</strong> there is an <strong>extensor distribution.</strong></li>\n<li><strong>Atopic dermatitis</strong> is an<strong> itchy, chronic or chronically relapsing inflammatory skin condition </strong>that often starts<strong> in early childhood (usually before 2 years of age)</strong></li>\n<li>The rash is characterized by <strong>erythema, itchy papules/papulovesicles</strong> (occasionally vesicles in infants) which may become excoriated and lichenified.</li>\n<li><strong>AD </strong>is frequently associated with <strong>other atopic conditions</strong> in the individual or other family member and in patients harbouring a <strong>filaggrin mutation.</strong></li>\n<li><strong>Dennie morgan fold</strong> is found under lower eyelid.</li>\n<li><strong>Allergic shiners</strong> is the <strong>periorbital pigmentation</strong> found under the eyelids.</li>\n<li><strong>Allergic salute</strong> is the horizontal groove on dorsum of nasal bridge.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/736d147492184142a4d2a3d4be24a89cx541x599.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59ecc59d422b432ab7e8323e8444f948x1280x1190.JPEG"
    ]
  },
  {
    "text": "All are causes of high RAIU (radioactive iodine uptake) except:",
    "choices": [
      {
        "id": 1,
        "text": "Graves\u2019 Disease"
      },
      {
        "id": 2,
        "text": "Endemic Iodine deficiency"
      },
      {
        "id": 3,
        "text": "Subacute thyroiditis"
      },
      {
        "id": 4,
        "text": "HCG induced thyrotoxicosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Subacute thyroiditis</strong> shows <strong>low uptake</strong> of radioactive iodine as it involves destruction and inflammation of the thyroid follicles, which also accounts for the thyrotoxic symptoms due to exocytosis of the hormone.</p>\n<p>The other three are classical examples of high RAIU.</p>\n<p><strong>Radioactive Iodine Scan</strong>:</p>\n<ul>\n<li>Nonpregnant, hyperthyroid patients with physical examination suggesting nodular thyroid disease, radioactive iodine should be the initial test to determine the aetiology of hyperthyroidism.</li>\n<li><strong>Pregnancy and breastfeeding</strong> are <strong>absolute contraindications</strong> to radionuclide imaging.</li>\n<li>Hyperthyroidism with a <strong>high</strong> (or normal) radioiodine uptake indicates <strong>de-novo synthesis of the hormone</strong>.</li>\n<li>Hyperthyroidism with a <strong>low</strong> (nearly absent) radioiodine uptake indicates either <strong>inflammation</strong> and <strong>destruction of thyroid tissue</strong> with release of <strong>preformed hormone</strong> into the circulation or an <strong>extrathyroidal source</strong> of thyroid hormone, such as in patients with <strong>factitious thyrotoxicosis</strong> and in patients with <strong>struma ovari</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 007';
        const quizFilename = 'fmge-mini-test-007-f00633bc.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>