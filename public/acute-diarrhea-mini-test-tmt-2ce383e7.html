<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acute Diarrhea Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 65-year-old man presents with abdominal pain and diarrhoea for the past few hours, and noticed blood in the stool during the recent episodes. He also had two episodes of vomiting. On evaluation, he has a temperature of 39\u00baC with clinical signs of dehydration. All of the following are indications to initiate empirical antibiotic therapy in this patient, except?",
    "choices": [
      {
        "id": 1,
        "text": "Fever  >38.5\u00baC"
      },
      {
        "id": 2,
        "text": "Bloody stools"
      },
      {
        "id": 3,
        "text": "Elderly patient"
      },
      {
        "id": 4,
        "text": "Vomiting"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Two episodes of <strong>vomiting</strong> are <strong>not an indication </strong>for antibiotic therapy.</p>\n<p>Stool analysis and culture is the initial investigation of choice and antibiotic therapy should be instituted based on microbiological evidence. However, empirical antibiotic therapy may be initiated if diarrhoea persists even with anti-diarrhoeal agents when the patient has <strong>grossly bloody stools, fever &gt; 38.5\u00b0C,</strong> is<strong> immunocompromised</strong> or is an <strong>elderly </strong>patient. The <strong>empirical antibiotics </strong>of choice are either <strong>metronidazole </strong>or <strong>fluoroquinolones</strong>.</p>\n<p>In a patient with acute diarrhoea, the following are indications for further evaluation:</p>\n<ol>\n<li>Profuse diarrhoea with dehydration</li>\n<li><strong>Fever &gt; 38.5\u00b0C (101\u00b0F)</strong></li>\n<li><strong>Bloody stools (dysentery)</strong></li>\n<li>Duration &gt; 48 hours without improvement</li>\n<li>History of recent antibiotic use</li>\n<li>Patients aged&gt;50 years with associated acute abdominal pain\u00a0</li>\n<li><strong>Patients aged&gt;70 years</strong></li>\n<li>Immunocompromised patients</li>\n</ol>\n<p>The following flowchart highlights the approach to a patient with acute diarrhoea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/460ca662b8664fbd9f729920d21425b7x1280x2558.JPEG"
    ]
  },
  {
    "text": "In which of the following types of diarrhoea would a patient's symptoms be likely to improve with fasting?",
    "choices": [
      {
        "id": 1,
        "text": "Secretory diarrhoea"
      },
      {
        "id": 2,
        "text": "Inflammatory diarrhoea"
      },
      {
        "id": 3,
        "text": "Osmotic diarrhoea"
      },
      {
        "id": 4,
        "text": "Factitious diarrhoea"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Osmotic</strong> diarrhoea <strong>ceases with fasting.</strong></p>\n<p><strong>Based on the mechanism</strong> by which it occurs,<strong> diarrhoea </strong>is classified broadly as <strong>secretory </strong>or <strong>osmotic.</strong></p>\n<p><strong>Osmotic diarrhoea</strong> occurs when the contents in the gut contain <strong>osmotically active</strong> substances that <strong>draw fluid into the lumen </strong>resulting in loose stools. The presence of these contents may be due to ingestion of certain types of food, such as dairy products in the case of <strong>lactose intolerance</strong>, or abuse of drugs like <strong>osmotic laxatives</strong>. The patient's symptoms tend to subside once the inciting osmotic solute is removed. Osmotic diarrhoea is associated with a <strong>high stool osmotic gap.</strong></p>\n<p><strong>Secretory diarrhoea</strong> (Option A) occurs due to an<strong> abnormality</strong> in <strong>fluid and electrolyte transport across the enteric mucosa</strong>. Clinically, it is differentiated from osmotic diarrhoea by the<strong> persistence of diarrhoea even after fasting</strong> and<strong> lack of stool osmotic gap</strong>. Secretory diarrhoea is typically watery, with large volume, and commonly occurs due to infective pathology, such as seen in cholera.</p>\n<p>Although there may be some overlap in the mechanism, diarrhoea is also categorised as follows:</p>\n<ul>\n<li><strong>Inflammatory </strong>(Option B) - characterized by pain, fever and bleeding along with diarrhoea. eg - inflammatory bowel disease</li>\n<li><strong>Steatorrheal</strong> - loose stools which are foul-smelling, greasy and difficult to flush, occurring to various causes of fat malabsorption. eg -\u00a0 pancreatitis, abetalipoproteinemia</li>\n<li><strong>Iatrogenic</strong> - following surgery such as vagotomy, bariatric surgery, or terminal ileal resection.</li>\n<li><strong>Factitious </strong>(Option D)\u00a0 - in the case of eating disorders or psychiatric illness where the patient abuses laxatives or intentional contamination of stool with water</li>\n<li><strong>Motility disorders</strong> - such as autonomic neuropathy in diabetic adults</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with Crohn's disease who has undergone terminal ileal resection complains of diarrhoea. On further questioning, you would be likely to learn that the stool has all of the following characteristics, except?",
    "choices": [
      {
        "id": 1,
        "text": "Greasy"
      },
      {
        "id": 2,
        "text": "Floats"
      },
      {
        "id": 3,
        "text": "Dark colored"
      },
      {
        "id": 4,
        "text": "Difficult to flush"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Diarrhoea</strong> following<strong> terminal ileal resection</strong> would most likely be<strong> steatorrhoea. </strong>The typical description of steatorrhea is stool which is<strong> bulky, pale, greasy, foul-smelling</strong> and<strong> floats, </strong>hence making it <strong>difficult to flush.</strong></p>\n<p><strong>Steatorrhoea refers</strong> to <strong>fatty stools a</strong>nd is quantitatively defined as <strong>stool fat &gt; 7g/dl. </strong>It is caused due to <strong>fat malabsorption</strong>, as a result of which fatty acids in the gut lumen exert an osmotic effect and cause diarrhoea.<strong> Bile salts </strong>are essential for the absorption of fat from the gut.<strong> </strong>The ileum is the only site of absorption of vitamin B12 and bile salts. Following resection of the ileum, the loss of bile salts increases and is not met by an increase in synthesis and hence the depletion of the bile salt pool results in fat malabsorption and steatorrhea. The loss of bile salts into the colon affects the colonic mucosa, causing a reduction in salt and water absorption, which increases stool losses.\u00a0</p>\n<p>Other causes of fat malabsorption and steatorrhea include exocrine pancreatic insufficiency, abetalipoproteinemia, celiac disease, alcohol consumption and biliary tract diseases such as gallstones and primary biliary cholangitis</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5943d19b9074d70b9551d54fe3e3846x1200x1616.JPEG"
    ]
  },
  {
    "text": "Which of the following organisms would not cause diarrhoea due to a pre-formed toxin?",
    "choices": [
      {
        "id": 1,
        "text": "S. aureus"
      },
      {
        "id": 2,
        "text": "B. cereus"
      },
      {
        "id": 3,
        "text": "C. perfringens"
      },
      {
        "id": 4,
        "text": "EPEC"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Enteropathogenic E. Coli (EPEC)</strong> does not cause a toxin-induced diarrhoea.\u00a0</p>\n<p>EPEC causes diarrhoea mainly in infants and children by <strong>adhering to the mucosa</strong> leading to <strong>microvilli effacement</strong>. Adherence is regulated by <strong>EPEC adherence factor (EAF)</strong>, a plasmid-encoded protein and <strong>locus of enterocyte effacement (LEE)</strong>, which is regulated chromosomally.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cbfa4379efe149c883779ca731baae05x1280x1131.JPEG"
    ]
  },
  {
    "text": "A 60-year-old male patient admitted with a hemorrhagic stroke was trasnferred from the ICU to the ward 1 week ago. He has a tracheostomy and Ryle's tube in-situ, is on antiepileptics and antihypertensives, and is currently still in the hospital for physiotherapy. 3 days ago he was started on laxatives as he had not passed stools for 3 days before that. During evening rounds, the patient bystander complains that the patient has loose stools. Urine output is adequate. Which of the following would be the next best step ?",
    "choices": [
      {
        "id": 1,
        "text": "Start IV fluids"
      },
      {
        "id": 2,
        "text": "Start antibiotics"
      },
      {
        "id": 3,
        "text": "Change the on-going Ryle's tube feeds"
      },
      {
        "id": 4,
        "text": "Discontinue laxatives"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The next best step in managing this patient would be to <strong>discontinue any laxatives</strong> as it is one of the possible causes for<strong> non-infectious diarrhoea.</strong></p>\n<p>Bed-ridden patients commonly develop altered bowel habits due to <strong>change in diet, lack of physical activity</strong> and use of <strong>medications</strong>. Diarrhoea due to laxative use is a common clinical scenario, especially in instances where patient bystanders are involved in medicating the patient as part of their rehabilitation and education prior to discharge.</p>\n<p>This patient currently has no indications for starting IV fluids as adequate urine output suggests that there is no dehydration. Empirical antibiotics should only be started in case diarrhoea does not improve after 48 hours or there are other signs of infection. A change in Ryle's tube feed might be tried but would not be helpful in case laxatives are not discontinued.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/460ca662b8664fbd9f729920d21425b7x1280x2558.JPEG"
    ]
  },
  {
    "text": "Apart from the presence of blood, which of the following features is more likely associated with dysentery as compared to diarrhoea?",
    "choices": [
      {
        "id": 1,
        "text": "Large volume"
      },
      {
        "id": 2,
        "text": "Absence of pus cells"
      },
      {
        "id": 3,
        "text": "Tenesmus"
      },
      {
        "id": 4,
        "text": "Absence of mucus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The term\u00a0<strong>dysentery\u00a0</strong>refers to\u00a0<strong>bloody diarrhoea.\u00a0</strong>However, there are other characteristics that differentiate the two, as follows:</p>\n<table style=\"border-collapse: collapse; width: 59.249%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 49.9618%; text-align: center;\"><strong>Diarrhoea</strong></td>\n<td style=\"width: 49.9618%; text-align: center;\"><strong>Dysentery</strong></td>\n</tr>\n<tr>\n<td style=\"width: 49.9618%;\">Voluminous fluid faeces</td>\n<td style=\"width: 49.9618%;\">Scanty sticky faeces</td>\n</tr>\n<tr>\n<td style=\"width: 49.9618%;\">No blood in faeces</td>\n<td style=\"width: 49.9618%;\">Blood in faeces</td>\n</tr>\n<tr>\n<td style=\"width: 49.9618%;\">No mucus in faeces</td>\n<td style=\"width: 49.9618%;\">Mucus in faeces</td>\n</tr>\n<tr>\n<td style=\"width: 49.9618%;\">Less pus cells</td>\n<td style=\"width: 49.9618%;\">Abundant pus cells</td>\n</tr>\n<tr>\n<td style=\"width: 49.9618%;\">Less straining during defecation</td>\n<td style=\"width: 49.9618%;\">Tenesmus</td>\n</tr>\n</tbody>\n</table>\n<p>Other terms associated with blood in stool that are to be differentiated from dysentery are:</p>\n<ul>\n<li><strong>Malena -\u00a0</strong>refers to the presence of altered blood in stool, which appears blackish, usually signifying an upper GI bleed.</li>\n<li><strong>Hematochezia -\u00a0</strong>refers to the presence of frank red blood in stool, usually signifying fresh bleeding from the lower GI tract.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following types of thyroid malignancies would a patient be most likely to complain of diarrhoea?",
    "choices": [
      {
        "id": 1,
        "text": "Medullary carcinoma of thyroid"
      },
      {
        "id": 2,
        "text": "Papillary carcinoma of thyroid"
      },
      {
        "id": 3,
        "text": "Follicular carcinoma of thyroid"
      },
      {
        "id": 4,
        "text": "Anaplastic carcinoma of thyroid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Diarrhoea</strong> is a common feature of <strong>medullary carcinoma</strong> of the thyroid gland.</p>\n<p>Medullary carcinoma of the thyroid (MTC) arises from the\u00a0<strong>parafollicular C cells </strong>of the thyroid gland. MTC secretes\u00a0<strong>calcitonin, serotonin </strong>and\u00a0<strong>prostaglandins\u00a0</strong>which are secretory peptides that cause <strong>watery diarrhoea</strong>, which is not a common feature in other types of thyroid cancer. MTC is also associated with increased levels of <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">carcinoembryonic antigen\u00a0</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">(CEA)</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0and\u00a0</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">adrenocorticotrophic hormone\u00a0</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">(ACTH).\u00a0</span></p>\n<p>Important features of MTC include:</p>\n<ul>\n<li>Painful neck mass with cervical lymphadenopathy</li>\n<li>Dysphagia, dysphonia, or dyspnea if there is local invasion</li>\n<li><strong>Diarrhea</strong>\u00a0due to increased intestinal motility</li>\n<li>Cushingoid habitus\u00a0due to ectopic ACTH production</li>\n<li><strong>Blood-borne metastasis\u00a0</strong></li>\n<li>Microscopically, they consist of sheets of neoplastic cells separated by collagen and amyloid stroma.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male was recently diagnosed with rectal carcinoma and is scheduled for elective surgery in the coming month. He visits the clinic complaining that over the past week, he has felt the urge to visit the toilet several times a day but only passes blood and mucus. What is this known as?",
    "choices": [
      {
        "id": 1,
        "text": "Factitious diarrhoea"
      },
      {
        "id": 2,
        "text": "Spurious diarrhoea"
      },
      {
        "id": 3,
        "text": "Hematochezia"
      },
      {
        "id": 4,
        "text": "Dysentery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Spurious diarrhoea\u00a0</strong>is a common and characteristic complaint in rectal carcinoma wherein the patient complains of diarrhoea as they evacuate the bowels multiple timea a day,\u00a0 but pass only mucous and blood rather than faecal matter.</p>\n<p>Symptoms of rectal carcinoma include:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Painless bleeding</strong> - earliest and most common</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Alteration of bowel habits - change in frequency and consistency of the stool</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Tenesmus</strong> - unable to pass a motion even when there is the sensation of needing to evacuate the bowel. It is suggestive of a tumor of the lower half of the rectum\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Early morning bloody diarrhea and <strong>spurious diarrhoea</strong>. Pain and weight loss are usually late symptoms</li>\n</ol>\n<p>Abdominal examination and digital rectal examination are used for the primary evaluation. Rigid sigmoidoscopy is performed to obtain a biopsy. A synchronous tumor (primary tumor with a different origin than the one currently investigated) is excluded by performing a colonoscopy.</p>\n<p>Patients with rectal carcinoma are staged according to the <strong>Modified Duke\u2019s classification\u00a0</strong>as follows:</p>\n<table>\n<tbody>\n<tr>\n<td width=\"61\">\n<p>A</p>\n</td>\n<td width=\"577\">\n<p>Growth limited up to the rectal mucosa (option D)</p>\n</td>\n</tr>\n<tr>\n<td width=\"61\">\n<p>B</p>\n</td>\n<td width=\"577\">\n<p>B1: Tumor invading muscularis propria, no lymph node invasion.</p>\n<p>B2: Tumors invading into or through serosa, no lymph node invasion.</p>\n</td>\n</tr>\n<tr>\n<td width=\"61\">\n<p>C</p>\n</td>\n<td width=\"577\">\n<p>C1: The tumour did not exceed the bowel wall, lymph node metastasis.</p>\n<p>C2: Tumour exceeded the intestinal wall and lymph node metastasis.</p>\n</td>\n</tr>\n<tr>\n<td width=\"61\">\n<p>D</p>\n</td>\n<td width=\"577\">\n<p>Distant metastasis</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47e1db89a4e348d5bff23ccb79e35475x1280x1193.JPEG"
    ]
  },
  {
    "text": "A 17-year-old girl presents with complaints of headache, vomiting and diarrhoea associated with lower abdominal pain since her period started two days ago. She has previously had regular menstrual cycles with no excessive bleeding , but has had similar symptoms in almost every preceding month since she first started having periods. Abdominal, vaginal and systemic examination findings are all normal. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Influenza"
      },
      {
        "id": 2,
        "text": "Gastroenteritis"
      },
      {
        "id": 3,
        "text": "Catamenial migraine"
      },
      {
        "id": 4,
        "text": "Primary dysmenorrhea"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette of <strong>lower abdominal pain</strong> associated with symptoms such as <strong>headache, vomiting</strong> and <strong>diarrhoea</strong>, during the<strong> beginning of menstrual cycles</strong> is suggestive of <strong>primary dysmenorrhea</strong>. Onset within 2 years of menarche further supports the diagnosis.</p>\n<p><strong>Dysmenorrhea</strong> is defined as <strong>cramping pain accompanying menstruation</strong>. It is further classified as follows:</p>\n<p>A. Etiological classification:</p>\n<ul>\n<li><strong>Primary </strong>dysmenorrhea does not have an associated organic cause but is associated with <strong>increased circulating prostaglandins</strong> which are responsible for the systemic and non-specific symptoms such as headache, vomiting and diarrhoea.</li>\n<li><strong>Secondary</strong> (acquired) dysmenorrhea is associated with the <strong>presence of organic pelvic pathologies</strong> such as fibroids, adenomyosis, PID, and endometriosis.</li>\n</ul>\n<p>B. \u00a0Clinical classification:</p>\n<ul>\n<li><strong>Spasmodic </strong>dysmenorrhea is the most prevalent type characterized by cramping pain before or at the start of menstruation, especially on the first and second days of menstruation.</li>\n<li><strong>Congestive</strong> dysmenorrhea is seen in PID, IUCD users, pelvic vein varicosities, pelvic endometriosis, and fibroids. These patients have increasing pelvic discomfort and pelvic pain a few days before menstruation after which they have rapid relief of the symptoms.\u00a0</li>\n<li><strong>Membranous</strong> dysmenorrhea is characterized by endometrial shedding as a cast during menses, and this passage of cast leads to painful uterine cramps. It is the rarest variety.</li>\n</ul>\n<p>Primary dysmenorrhea is <strong>managed supportively</strong> with symptomatic treatment using NSAIDs, antispasmodics and antiemetics.\u00a0</p>\n<p>Other options:</p>\n<p>Options A and B : Patients with <strong>gastroenteritis</strong> may have symptoms such as vomiting and diarrhoea, associated with headache, and patients with <strong>influenza </strong>might also be likely to have fever and malaise but these may occur <strong>without any temporal association with the onset of menstral cycles.</strong></p>\n<p>Option C: <strong>Catamenial migraine</strong> refers to migraine headaches occurring in women before, or at the onset of menstrual cycles. Symptoms are likely to be more typical of migraine with the presence of an <strong>aura</strong>, with <strong>longer lasting headaches </strong>and <strong>severe nausea</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Assertion: Loperamide should not be administered to children with acute diarrhea\nReason: Loperamide is a synthetic opiate that causes reduction of gut motility",
    "choices": [
      {
        "id": 1,
        "text": "Both Assertion and Reason are independently true/correct statements and the Reason is the correct explanation for the Assertion"
      },
      {
        "id": 2,
        "text": "Both Assertion and Reason are independently true/correct statements, but the Reason is not the correct explanation for the Assertion"
      },
      {
        "id": 3,
        "text": "The assertion is independently a true/correct statement, but the Reason is independently a false/incorrect statement"
      },
      {
        "id": 4,
        "text": "The assertion is independently a false/incorrect statement, but the Reason is independently a true/correct statement"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Loperamide should <strong>not be administered to children with</strong> <strong>acute diarrhea</strong> because it is a synthetic opiate that causes a <strong>reduction of gut motility</strong>. Inhibition of gut motility/ intestinal peristalsis results in <strong>more time for harmful bacterial multiplication</strong> within the gut. Also, synthetic opiates may result in <strong>distension of abdomen, paralytic ileus, bacterial overgrowth and sepsis</strong> when used in children with acute diarrhea and may even prove fatal in infants.\u00a0</p>\n<p>So,</p>\n<p>Both Assertion and Reason are independently true/correct statements and the Reason is the correct explanation for the Assertion</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old woman was diagnosed with right leg cellulitis and was admitted to the hospital for 3 days. She was prescribed clindamycin. Two days after her discharge, she developed diarrhea and abdominal pain. Her temperature was 38.8 degrees Celcius. Her blood reports are given below. What is the most probable etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium difficile"
      },
      {
        "id": 2,
        "text": "Escherichia coli"
      },
      {
        "id": 3,
        "text": "Norovirus"
      },
      {
        "id": 4,
        "text": "Rotavirus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette of a patient with hospital-acquired diarrhea (nosocomial) following antibiotic administration is suggestive of <strong>pseudomembranous colitis</strong> due to&nbsp;<strong><em>Clostridium difficile.</em>&nbsp;</strong></p>\n<p>Clostridium difficile is the <strong>most common cause of infectious diarrhea</strong> in nosocomial infection.&nbsp;</p>\n<p><span data-preserver-spaces=\"true\">It is the <strong>most common antibiotic-associated diarrhea</strong>. It is commonly seen in individuals who receive a prolonged antibiotic course, which causes a change in the composition of gastrointestinal microbial flora, leading to colonization of C. difficile.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Clinical features:</span></strong></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Lower abdominal pain with loose watery diarrhea.</span></li>\n<li>Fever, leukocytosis</li>\n<li><span data-preserver-spaces=\"true\">In some patients, the disease may progress to life-threatening pseudomembranous colitis</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Investigations</span></strong><span data-preserver-spaces=\"true\">:</span></p>\n<ul>\n<li>Nucleic acid amplification tests, including polymerase chain reaction assays, for C. difficile toxin A or B gene in stool&nbsp;</li>\n<li>Stool culture in selective media</li>\n<li>Demonstrating toxin by cell cytotoxin cultures</li>\n<li>Toxin gene identification by enzyme immunoassay</li>\n<li>Colonoscopy or sigmoidoscopy&nbsp;<span data-preserver-spaces=\"true\">reveals a characteristic</span><strong><span data-preserver-spaces=\"true\">&nbsp;pseudomembrane.</span></strong></li>\n</ul>\n<p>Nucleic acid amplification tests, including PCR assays, for C. difficile toxin A or B gene in stool, have now been approved for diagnostic purposes and appear to be both rapid and sensitive while retaining high specificity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A family of four from London developed recurrent episodes of watery diarrhea and abdominal pain after their trip to Bali. Stool culture on MacConkey medium is given below. Biochemical tests done show IMViC ++-- and negative Eiken's test. What is the mechanism of action of the toxin secreted by the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibition of elongation factor-2 (EF-2)"
      },
      {
        "id": 2,
        "text": "Increase in cAMP"
      },
      {
        "id": 3,
        "text": "Inhibition of 60s ribosome"
      },
      {
        "id": 4,
        "text": "Increase in cGMP"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette along with <strong>lactose fermenting MacConkey agar</strong> (bright pink), <strong>IMViC : ++--</strong>, and <strong>negative Eiken's </strong>test is suggestive of <strong>Enterotoxigenic <em>E. coli</em> (ETEC)/traveler's diarrhea</strong> caused by the <strong><em>E. coli</em> heat-stable enterotoxin</strong> which acts by <strong>activation </strong>of<strong> cGMP</strong> in the intestine.</p>\n<p>Persons from developed countries visiting endemic areas often suffer from\u00a0<strong>ETEC diarrhea</strong>, a condition known as\u00a0<strong>Traveler's diarrhea.\u00a0</strong>Enterotoxigenic <em>Escherichia coli</em> is the most common cause of Traveler\u2019s Diarrhoea. It can range from mild watery diarrhea to fatal disease, similar to cholera.</p>\n<p>The first step in pathogenesis is adherence to the intestinal mucosa by fimbria called colonization factor antigens. ETEC then produces enterotoxins which may be either heat-labile (LT) or heat-stable (ST).</p>\n<p>This is distinguished by several tests, one of the serological tests being <strong>Precipitin test</strong> (Eikien's) which is positive in LT and negative in ST.\u00a0<strong>IMViC </strong>test includes indole, methyl red (MR), Voges-Proskauer (VP) and citrate utilisation. E.coli is indole positive and MR positive, and VP negative and citrate negative.</p>\n<p>Two types of heat-stable\u00a0enterotoxins are known :</p>\n<ol>\n<li>STa/ST I</li>\n<li>STb/ST II</li>\n</ol>\n<p><strong>STa</strong> acts by <strong>activation </strong>of the<strong> cyclic guanosine monophosphate</strong> (cGMP) in the intestine. This is rapid and accumulates fluid in the intestine in the infant mice (infant mouse test) which is the standard method for the demonstration of STa.</p>\n<p>The mode of action of STb is unknown but it is neither through cAMP or cGMP.</p>\n<p>ETEC with<strong>\u00a0heat-labile</strong>\u00a0enterotoxins act by<strong> activation </strong>of<strong>\u00a0cAMP.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cff5ee4269d64394a0f71974d71c4894.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man with diarrhoea and abdominal pain for the past 7 days after eating biriyani at an Arabian restaurant. His diarrhea can be best classified as?",
    "choices": [
      {
        "id": 1,
        "text": "Persistent diarrhoea"
      },
      {
        "id": 2,
        "text": "Acute diarrhoea"
      },
      {
        "id": 3,
        "text": "Subacute diarrhoea"
      },
      {
        "id": 4,
        "text": "Chronic diarrhoea"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diarrhoea</strong> lasting for <strong>less than 2 weeks</strong> is defined as <strong>acute</strong> diarrhoea. (According to Harrison's 21st edition, CMDT mentions &lt;/= 7 days)</p>\n<p>Diarrhoea can be broadly characterized as the excretion of unusually liquid or unformed faeces with an elevated frequency. In the context of individuals adhering to a standard Western diet, a <strong>stool weight above 200 g per day</strong> can generally indicate diarrhoea. Typically, healthcare professionals define diarrhoea as a condition characterized by an elevated number of bowel movements (<strong>exceeding three per day</strong>) or the presence of loose or watery stool consistency. Diarrhoea can be classified into three categories based on its duration: acute, persistent, and chronic. <strong>Acute</strong> diarrhoea refers to cases lasting<strong> less than two weeks</strong>, while <strong>persistent</strong> <strong>diarrhoea</strong> lasts between<strong> two and four weeks</strong>. <strong>Chronic</strong> <strong>diarrhoea</strong> is characterised by a duration <strong>beyond four weeks</strong>.</p>\n<p>Two prevalent illnesses are often characterized by the excretion of <strong>less than 200 grams of stool per day</strong>.\u00a0</p>\n<p><strong>Pseudodiarrhoea</strong>, characterised by the frequent excretion of small amounts of faeces, is commonly observed in conjunction with symptoms such as rectal urgency, tenesmus, and a sensation of incomplete bowel movement. This condition is commonly observed in individuals with irritable bowel syndrome (IBS) or proctitis. <strong>Faecal incontinence</strong> refers to the involuntary expulsion of rectal contents and is primarily attributed to neuromuscular disorders or structural anorectal abnormalities.\u00a0</p>\n<p>Causes of acute diarrhoea can be classified under :</p>\n<table style=\"border-collapse: collapse; width: 79.8531%; height: 201.586px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">\u00a0</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Non-inflammatory diarrhoea</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Inflammatory diarrhoea</td>\n</tr>\n<tr>\n<td style=\"width: 33.3333%;\">Appearance</td>\n<td style=\"width: 33.3333%;\">Watery, without blood, pus, or mucus\u00a0</td>\n<td style=\"width: 33.3333%;\">Loose to watery, often with blood, pus, or mucus\u00a0</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 33.3333%; height: 44.7969px;\">Viral</td>\n<td style=\"width: 33.3333%; height: 44.7969px;\">Noroviruses, astrovirus, adenovirus, rotavirus, SARS-CoV-2\u00a0</td>\n<td style=\"width: 33.3333%; height: 44.7969px;\">Cytomegalovirus\u00a0</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">Parasite</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Giardia lamblia Cryptosporidium Cyclospora\u00a0</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Entamoeba histolytica</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">Bacteria</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">\n<p>1. Preformed enterotoxin production\u00a0</p>\n<ul>\n<li>Staphylococcus aureus</li>\n<li>Bacillus cereus</li>\n<li>Clostridium perfringens\u00a0</li>\n</ul>\n<p>2. Enterotoxin production Enterotoxigenic\u00a0</p>\n<ul>\n<li>Escherichia coli (ETEC)</li>\n<li>Vibrio cholera,</li>\n<li>Vibrio\u00a0vulnificus\u00a0</li>\n</ul>\n</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">\n<p>1. Cytotoxin production Enterohemorrhagic E coli\u00a0</p>\n<ul>\n<li>O157:H5 and O157:H7 (EHEC)\u00a0</li>\n<li>Vibrio parahaemolyticus\u00a0</li>\n<li>Clostridioides difficile\u00a0</li>\n</ul>\n<p>2. Mucosal invasion\u00a0</p>\n<ul>\n<li>Shigella</li>\n<li>Campylobacter jejuni</li>\n<li>Salmonella</li>\n<li>Enteroinvasive E coli (EIEC)</li>\n<li>Listeria monocytogenes</li>\n<li>Aeromonas</li>\n<li>Yersinia enterocolitica\u00a0</li>\n</ul>\n<p>3. Infectious proctitis\u00a0</p>\n<ul>\n<li>Chlamydia</li>\n<li>Neisseria gonorrhoeae\u00a0</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c7d10435a7894c2a9aca5ac9d2619c8bx1280x1933.JPEG"
    ]
  },
  {
    "text": "A 25-year-old man with diarrhea and abdominal pain. He can be advised to eat any of the following except?",
    "choices": [
      {
        "id": 1,
        "text": "Toast"
      },
      {
        "id": 2,
        "text": "Cottage cheese"
      },
      {
        "id": 3,
        "text": "Banana"
      },
      {
        "id": 4,
        "text": "Apple Sauce"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Among the given options <strong>cottage</strong> <strong>cheese</strong> is <strong>not</strong> <strong>advisable</strong> to be consumed in patients with acute diarrhoea. All <strong>dairy</strong> products must be <strong>restricted</strong> in patients with acute diarrhoea.</p>\n<p>In the majority of cases, <strong>mild to moderate</strong> diarrhoea <strong>does</strong> <strong>not</strong> typically <strong>result in dehydration</strong> as long as the patient consumes sufficient oral fluids that contain carbohydrates and electrolytes. Patients often have greater comfort when they choose to <strong>abstain</strong> <strong>from</strong> consuming foods that are <strong>high in fibre</strong>, <strong>fats</strong>, <strong>milk</strong> products, <strong>caffeine</strong>, and <strong>alcohol</strong> since these dietary choices can help alleviate bowel-related discomfort. The use of tea, carbonated beverages with low levels of carbonation, and readily digestible foods such as soups, crackers, bananas, applesauce, rice, and bread is recommended. Some sources describe this diet as a <strong>BRAT</strong> <strong>diet</strong> which consists of <strong>b</strong>ananas, <strong>r</strong>ice, <strong>a</strong>pplesauce, and <strong>t</strong>oast.\u00a0</p>\n<p style=\"text-align: justify;\">The <strong>glucose-dependent</strong> sodium and water absorption is the principle behind replacing glucose and sodium in a <strong>1:1</strong> molar ratio in the WHO oral rehydration solution (ORS). The low osmolarity of the ORS in the lumen as compared to the blood facilitates the absorption of fluid and hence the electrolytes due to the solvent drag. Studies have shown that low osmolarity ORS causes a reduction of stool output, a decrease in vomiting and a decrease in the use of unscheduled intravenous fluids without increasing the risk of hyponatremia. Other <strong>home available fluids</strong> that can be used are salted <strong>rice</strong> <strong>water</strong>/<strong>salted</strong> <strong>yoghurt</strong> drinks, and vegetable/chicken <strong>soup</strong> with salt.</p>\n<p><strong>Diarrhoea</strong> can be broadly characterized as the excretion of unusually liquid or unformed faeces with an elevated frequency. In the context of individuals adhering to a standard Western diet, a stool weight above 200 g per day can generally indicate diarrhoea. Typically, healthcare professionals define diarrhoea as a condition characterized by an elevated number of bowel movements (exceeding three per day) or the presence of loose or watery stool consistency. Diarrhoea can be classified into <strong>three</strong> categories <strong>based</strong> <strong>on</strong> its <strong>duration</strong>: <strong>acute</strong>, <strong>persistent</strong>, and <strong>chronic</strong>. <strong>Acute</strong> diarrhoea refers to cases lasting<strong> less than two weeks</strong>, while <strong>persistent</strong> diarrhoea lasts between<strong> two and four weeks</strong>. <strong>Chronic</strong> diarrhoea is characterised by a duration <strong>beyond four weeks</strong>.</p>\n<p>Two prevalent illnesses are often characterized by the excretion of <strong>less than 200 grams </strong>of stool per day.\u00a0</p>\n<p><strong>Pseudodiarrhea</strong>, characterised by the frequent excretion of small amounts of faeces, is commonly observed in conjunction with symptoms such as rectal urgency, tenesmus, and a sensation of incomplete bowel movement. This condition is commonly observed in individuals with irritable bowel syndrome (IBS) or proctitis. <strong>Faecal incontinence</strong> refers to the involuntary expulsion of rectal contents and is primarily attributed to neuromuscular disorders or structural anorectal abnormalities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old girl with complaints of bloody diarrhoea for the past 6 days is found to be infected with E. coli O157:H7. Which of the following is contraindicated in the management of this child?",
    "choices": [
      {
        "id": 1,
        "text": "Antibiotics"
      },
      {
        "id": 2,
        "text": "Oral Rehydration Solution"
      },
      {
        "id": 3,
        "text": "Antacids"
      },
      {
        "id": 4,
        "text": "Blood transfusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Antibiotics</strong> are <strong>contraindicated</strong> in the management of <strong>enterohemorrhagic E. coli (EHEC) </strong>infection, especially in children. This is because antibiotics induce the replication of Shiga toxin\u2013producing bacteriophages and <strong>increase toxin production</strong> which may worsen the disease and significantly <strong>increase the risk</strong> of developing <strong>hemolytic-uremic syndrome</strong> and renal failure.</p>\n<p><strong>O157: H7</strong> is a strain of E.coli called <strong>enterohemorrhagic E. coli (EHEC)</strong> which produces verocytotoxin or <strong>Shiga-like-toxin</strong>. Shiga toxin <strong>acts by inactivating the 60s ribosomal subunit</strong> thereby <strong>inhibiting protein synthesis.</strong> It is absorbed from the inflamed gastrointestinal mucosa into the circulation and causes <strong>endothelial dysfunction,</strong> and causes platelet activation and aggregation. <strong>Children and older adults</strong> are at the highest risk. It causes mild non-bloody diarrhea to hemorrhagic colitis, or a severe form of <strong>dysentery</strong>, with <strong>hemolytic uremic syndrome</strong>, a disease resulting in acute <strong>renal failure, microangiopathic hemolytic anemia, and thrombocytopenia</strong>.</p>\n<p>EHEC are gram-negative bacilli which are <strong>lactose fermenting</strong>. Unlike most other E. coli serotypes, <strong>O157: H7 does not use sorbitol</strong> and produces <strong>clear colonies on the Sorbitol MacConkey agar,</strong> whereas other serotypes produces pink colonies<strong>.\u00a0</strong></p>\n<p>EHEC dysentery is commonly <strong>self-limiting</strong> and management is <strong>conservative</strong> with the mainstay being <strong>correction of dehydration and electrolyte imbalances</strong> and other symptomatic <strong>supportive</strong> treatment such as blood tranfusion in case of severe blood loss anaemia, but antibiotics are not to be used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 73-year-old man with diarrhoea and abdominal pain for the past 7 days after eating biriyani at an Arabian restaurant. He has had two episodes of vomiting and 4 episodes of diarrhoea over the last 1 day. On evaluation, he has a temperature of 37.5\u00baC and a capillary refill time of 1 second. Which of the following features present in him warrants further investigation of his acute diarrhoea?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated capillary refill time"
      },
      {
        "id": 2,
        "text": "Age > 70 years"
      },
      {
        "id": 3,
        "text": "Increased vomiting"
      },
      {
        "id": 4,
        "text": "Elevated body temperature"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient's acute diarrhoea would require further testing as he is aged <strong>more than 70 years</strong>.</p>\n<p>Concomitant features in patients with <strong>acute</strong> <strong>diarrhoea</strong> that warrant further testing include:</p>\n<p>Severe illness</p>\n<ul>\n<li>Fever <strong>&gt;/= 38.5</strong> degree Celsius (101.3 degrees Fahrenheit)\u00a0</li>\n<li>Signs or symptoms of hypovolemia</li>\n<li><strong>&gt;/= 6 </strong>unformed stools per 24 hours</li>\n<li>Severe abdominal pain</li>\n</ul>\n<p>High-risk host features\u00a0</p>\n<ul>\n<li>Age<strong> &gt;/= 70 years</strong></li>\n<li><strong>Comorbidities</strong> such as cardiac disease, immunocompromising conditions (including advanced HIV ie CD4&lt;200 cells)</li>\n</ul>\n<p><strong>Diarrhoea</strong> lasting for <strong>less than 2 weeks</strong> is defined as <strong>acute</strong> diarrhoea. (According to Harrison's 21st edition, CMDT mentions &lt;/= 7 days)</p>\n<p>Diarrhoea can be broadly characterized as the excretion of unusually liquid or unformed faeces with an elevated frequency. In the context of individuals adhering to a standard Western diet, a <strong>stool weight above 200 g per day</strong> can generally indicate diarrhoea. Typically, healthcare professionals define diarrhoea as a condition characterized by an elevated number of bowel movements (<strong>exceeding three per day</strong>) or the presence of loose or watery stool consistency. Diarrhoea can be classified into three categories based on its duration: acute, persistent, and chronic. <strong>Acute</strong> diarrhoea refers to cases lasting<strong> less than two weeks</strong>, while <strong>persistent</strong> <strong>diarrhoea</strong> lasts between<strong> two and four weeks</strong>. <strong>Chronic</strong> <strong>diarrhoea</strong> is characterised by a duration <strong>beyond four weeks</strong>.</p>\n<p>Two prevalent illnesses are often characterized by the excretion of <strong>less than 200 grams of stool per day</strong>.\u00a0</p>\n<p><strong>Pseudodiarrhoea</strong>, characterised by the frequent excretion of small amounts of faeces, is commonly observed in conjunction with symptoms such as rectal urgency, tenesmus, and a sensation of incomplete bowel movement. This condition is commonly observed in individuals with irritable bowel syndrome (IBS) or proctitis. <strong>Faecal incontinence</strong> refers to the involuntary expulsion of rectal contents and is primarily attributed to neuromuscular disorders or structural anorectal abnormalities.\u00a0</p>\n<p>Causes of acute diarrhoea can be classified under :</p>\n<table style=\"border-collapse: collapse; width: 79.8531%; height: 201.586px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">\u00a0</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Non-inflammatory diarrhoea</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Inflammatory diarrhoea</td>\n</tr>\n<tr>\n<td style=\"width: 33.3333%;\">Appearance</td>\n<td style=\"width: 33.3333%;\">Watery, without blood, pus, or mucus\u00a0</td>\n<td style=\"width: 33.3333%;\">Loose to watery, often with blood, pus, or mucus\u00a0</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 33.3333%; height: 44.7969px;\">Viral</td>\n<td style=\"width: 33.3333%; height: 44.7969px;\">Noroviruses, astrovirus, adenovirus, rotavirus, SARS-CoV-2\u00a0</td>\n<td style=\"width: 33.3333%; height: 44.7969px;\">Cytomegalovirus\u00a0</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">Parasite</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Giardia lamblia Cryptosporidium Cyclospora\u00a0</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Entamoeba histolytica</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">Bacteria</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">\n<p>1. Preformed enterotoxin production\u00a0</p>\n<ul>\n<li>Staphylococcus aureus</li>\n<li>Bacillus cereus</li>\n<li>Clostridium perfringens\u00a0</li>\n</ul>\n<p>2. Enterotoxin production Enterotoxigenic\u00a0</p>\n<ul>\n<li>Escherichia coli (ETEC)</li>\n<li>Vibrio cholera,</li>\n<li>Vibrio\u00a0vulnificus\u00a0</li>\n</ul>\n</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">\n<p>1. Cytotoxin production Enterohemorrhagic E coli\u00a0</p>\n<ul>\n<li>O157:H5 and O157:H7 (EHEC)\u00a0</li>\n<li>Vibrio parahaemolyticus\u00a0</li>\n<li>Clostridioides difficile\u00a0</li>\n</ul>\n<p>2. Mucosal invasion\u00a0</p>\n<ul>\n<li>Shigella</li>\n<li>Campylobacter jejuni</li>\n<li>Salmonella</li>\n<li>Enteroinvasive E coli (EIEC)</li>\n<li>Listeria monocytogenes</li>\n<li>Aeromonas</li>\n<li>Yersinia enterocolitica\u00a0</li>\n</ul>\n<p>3. Infectious proctitis\u00a0</p>\n<ul>\n<li>Chlamydia</li>\n<li>Neisseria gonorrhoeae\u00a0</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8575e4e1e68142b8b5f7b60f3861d184x1280x2558.JPEG"
    ]
  },
  {
    "text": "A 70-year-old presents to you with bloody diarrhoea for the past 5 days. On examination, pallor was noted. A stool examination showed a positive faecal lactoferrin agglutination test. Which of the following can be ruled out as a cause of this patient's diarrhoea?",
    "choices": [
      {
        "id": 1,
        "text": "Cytomegalovirus"
      },
      {
        "id": 2,
        "text": "Vibrio parahaemolyticus"
      },
      {
        "id": 3,
        "text": "Norovirus"
      },
      {
        "id": 4,
        "text": "Yersinia enterocolitica"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Norovirus</strong> is a known cause of <strong>non-inflammatory diarrhoea</strong> which would show a <strong>negative</strong> faecal lactoferrin agglutination assay test.\u00a0</p>\n<p>The faecal <strong>lactoferrin</strong> <strong>agglutination</strong> assay test is the <strong>best</strong> <strong>test</strong> to <strong>distinguish</strong> between <strong>inflammatory</strong> and <strong>non</strong>-<strong>inflammatory</strong> causes of acute <strong>diarrhoea</strong> owing to a very high <strong>sensitivity</strong> of <strong>90%.</strong></p>\n<p><strong>Diarrhoea</strong> lasting for less than 2 weeks is defined as acute diarrhoea. (According to Harrison's 21st edition and Upto Date, CMDT mentions &lt;/= 7 days)</p>\n<p>Diarrhoea can be broadly characterized as the excretion of unusually liquid or unformed faeces with an elevated frequency. In the context of individuals adhering to a standard Western diet, a stool weight above 200 g per day can generally indicate diarrhoea. Typically, healthcare professionals define diarrhoea as a condition characterized by an elevated number of bowel movements (exceeding three per day) or the presence of loose or watery stool consistency. Diarrhoea can be classified into three categories based on its duration: acute, persistent, and chronic. Acute diarrhoea refers to cases lasting less than two weeks, while persistent diarrhoea lasts between two and four weeks. Chronic diarrhoea is characterised by a duration beyond four weeks.</p>\n<p>Causes of acute diarrhoea can be classified under :</p>\n<table style=\"border-collapse: collapse; width: 100%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 32.0511%;\">\u00a0</td>\n<td style=\"width: 32.0511%;\">Non-inflammatory diarrhoea</td>\n<td style=\"width: 32.0511%;\">Inflammatory diarrhoea</td>\n</tr>\n<tr>\n<td style=\"width: 32.0511%;\">Appearance</td>\n<td style=\"width: 32.0511%;\">Watery, without blood, pus, or mucus</td>\n<td style=\"width: 32.0511%;\">Loose to watery, often with blood, pus, or mucus\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 32.0511%;\">Viral</td>\n<td style=\"width: 32.0511%;\"><strong>Noroviruses</strong>, astrovirus, adenovirus, rotavirus, SARS-CoV-2\u00a0</td>\n<td style=\"width: 32.0511%;\"><strong>Cytomegalovirus</strong></td>\n</tr>\n<tr>\n<td style=\"width: 32.0511%;\">Parasite</td>\n<td style=\"width: 32.0511%;\">Giardia lamblia Cryptosporidium Cyclospora\u00a0</td>\n<td style=\"width: 32.0511%;\">Entamoeba histolytica</td>\n</tr>\n<tr>\n<td style=\"width: 32.0511%;\">Bacteria</td>\n<td style=\"width: 32.0511%;\">\n<p>1. Preformed enterotoxin production\u00a0</p>\n<ul>\n<li>Staphylococcus aureus</li>\n<li>Bacillus cereus</li>\n<li>Clostridium perfringens \u00a0</li>\n</ul>\n<p>2. Enterotoxin production Enterotoxigenic\u00a0</p>\n<ul>\n<li>Escherichia coli (ETEC)</li>\n<li>Vibrio cholera</li>\n<li>Vibrio vulnificus\u00a0</li>\n</ul>\n</td>\n<td style=\"width: 32.0511%;\">\n<p>1. Cytotoxin production Enterohemorrhagic E coli\u00a0</p>\n<ul>\n<li>O157:H5 and O157:H7 (EHEC)</li>\n<li><strong>Vibrio</strong> <strong>parahaemolyticus </strong></li>\n<li>Clostridioides difficile\u00a0</li>\n</ul>\n<p>2. Mucosal invasion\u00a0</p>\n<ul>\n<li>Shigella</li>\n<li>Campylobacter jejuni</li>\n<li>Salmonella</li>\n<li>Enteroinvasive E coli (EIEC)</li>\n<li>Listeria monocytogenes</li>\n<li>Aeromonas</li>\n<li><strong>Yersinia</strong> <strong>enterocolitica</strong>\u00a0</li>\n</ul>\n<p>3. Infectious proctitis\u00a0</p>\n<ul>\n<li>Chlamydia<br />Neisseria gonorrhoeae\u00a0</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man with diarrhoea and abdominal pain for the past 15 days after eating biriyani at an Arabian restaurant. Which of the following tests best helps distinguish between an inflammatory or a non-inflammatory etiology of this patient's diarrhea?",
    "choices": [
      {
        "id": 1,
        "text": "Fecal lactoferrin"
      },
      {
        "id": 2,
        "text": "Fecal leucocytes"
      },
      {
        "id": 3,
        "text": "Stool culture"
      },
      {
        "id": 4,
        "text": "Stool guaiac test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>faecal</strong> lactoferrin agglutination assay test is the best test to distinguish between <strong>inflammatory</strong> and <strong>non</strong>-<strong>inflammatory</strong> causes of <strong>acute</strong> <strong>diarrhoea</strong> owing to a very <strong>high</strong> <strong>sensitivity</strong> and <strong>specificity</strong> of <strong>90</strong>%.</p>\n<p><strong>Diarrhoea</strong> lasting for <strong>less than 2 weeks</strong> is defined as <strong>acute</strong> diarrhoea. (According to Harrison's 21st edition, CMDT mentions &lt;/= 7 days)</p>\n<p><strong>Diarrhoea</strong> can be broadly characterized as the excretion of unusually liquid or unformed faeces with an <strong>increased</strong> <strong>frequency</strong>. In the context of individuals adhering to a standard Western diet, a stool weight <strong>above 200 g per day</strong> can generally indicate diarrhoea. Typically, healthcare professionals define diarrhoea as a condition characterized by an elevated number of bowel movements (<strong>exceeding</strong> <strong>three</strong> <strong>per</strong> <strong>day</strong>) or the presence of loose or watery stool consistency. Diarrhoea can be classified into three categories based on its duration: acute, persistent, and chronic. <strong>Acute</strong> diarrhoea refers to cases lasting<strong> less than two weeks</strong>, while <strong>persistent</strong> diarrhoea lasts between <strong>two and four weeks</strong>. <strong>Chronic</strong> diarrhoea is characterised by a duration <strong>beyond four weeks</strong>.</p>\n<p>Other options:</p>\n<p>Option B: With a sensitivity and specificity of 70% and 50% respectively, <strong>faecal</strong> <strong>leukocytes</strong> are a <strong>poor</strong> <strong>indicator</strong> of an inflammatory aetiology of diarrhoea.</p>\n<p>Option C: The incidence of <strong>positive</strong> <strong>stool</strong> <strong>cultures</strong> in cases of acute diarrhoea is generally quite low, except in individuals with <strong>very</strong> <strong>severe</strong> disease.\u00a0</p>\n<p>Option D: The stool <strong>guaiac</strong> <strong>test</strong> is also not as sensitive or specific as that of fecal lactoferrin to detect a difference between inflammatory and non-inflammatory diarrhoea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old man presents with sudden onset loose stools, vomiting, and muscular cramps. Stools were colorless, like rice water, and had an inoffensive sweetish odor. Identify the false statement regarding the causative agent.",
    "choices": [
      {
        "id": 1,
        "text": "Can cause metabolic acidosis and hypokalemia"
      },
      {
        "id": 2,
        "text": "String test is positive"
      },
      {
        "id": 3,
        "text": "Produces greyish black colonies on TCBS medium"
      },
      {
        "id": 4,
        "text": "Toxin disrupts the zona occludens"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette of sudden onset colorless rice watery, stools having an inoffensive sweetish odor is indicative of <strong>cholera</strong> and the causative agent is <strong><em>Vibrio cholerae</em></strong>. They produce large <strong>yellow convex colonies</strong> on the TCBS medium.</p>\n<p>The cells of <em>Vibrio cholerae</em> are gram-negative and typically comma-shaped. They show <strong>darting motility</strong>, with a single sheathed polar flagellum. They are aerobic and produce <strong>large yellow convex colonies</strong> on the thiosulphate citrate bile salt sucrose (TCBS) medium.</p>\n<p>They are <strong>late lactose fermenters</strong>, producing pink colonies on MacConkey agar after prolonged incubation. They are <strong>aerobic</strong>. Special media for transporting and cultivating vibrio species are:</p>\n<ul>\n<li>Venkatraman Ramakrishnan (VR) medium</li>\n<li>Cary-Blair medium</li>\n<li>Autoclaved seawater</li>\n<li>Enrichment media like\u00a0Monsur's taurocholate tellurite peptone water\u00a0</li>\n<li>Plating media:\n<ul>\n<li>Alkaline bile salt agar</li>\n<li>Monsur's gelatin taurocholate trypticase tellurite agar (GTTA)</li>\n<li>Thiosulphate citrate bile salt sucrose agar (colonies shown in the image below)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/066027e007b74bb0813a27a47ce6756fx848x987.JPEG"
    ]
  },
  {
    "text": "A young man presents with sudden onset nausea, vomiting, and four episodes of passing loose stools. He gives a history of having food from a nearby bakery three hours ago. Which of the following organisms is most likely implicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio cholerae"
      },
      {
        "id": 2,
        "text": "Salmonella typhi"
      },
      {
        "id": 3,
        "text": "Bacillus cereus"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario is suggestive of <strong>acute food poisoning </strong>most likely caused by <em><strong>Staphylococcus aureus.</strong></em>&nbsp;</p>\n<p><strong>Food poisoning</strong> by <em>Staphylococcus aureus </em>is caused due to ingestion of <strong>preformed enterotoxin.</strong> The preformed<strong> enterotoxin</strong> is <strong>heat-stable. </strong>Eight antigenic types of enterotoxin are currently known, of which,&nbsp;<strong>Type A&nbsp;</strong>toxin is responsible for most cases. It contaminates food products such as meat, fish, milk products, mayonnaise, cream <strong>pastries,</strong> etc. when left at room temperature for a long time. </p>\n<p>Enterotoxin acts directly on the autonomic nervous system to cause food poisoning, rather than on the gastrointestinal mucosa. It stimulates the <strong>vagus nerve</strong> and <strong>vomiting center</strong> of the brain and also stimulates intestinal peristaltic activity.</p>\n<p>Staphylococcal food poisoning has a very short incubation period of about <strong>1 - 8 hours</strong>. Patients usually present with <strong>nausea, vomiting</strong>, and <strong>diarrhea</strong> <strong>2-6 hrs</strong> after the consumption of contaminated food.</p>\n<p>Other options:</p>\n<p>Option A:<em> <strong>Vibrio cholera</strong></em>&nbsp;leads to dysentery that presents with acute, profuse, watery stools (<strong>rice water stools</strong>) and vomiting which may lead to severe dehydration, hypokalemia, and shock. The incubation period is usually around <strong>1-5 days</strong>.&nbsp;</p>\n<p>Option B:<em> <strong>Salmonella typhi</strong>&nbsp;</em>can present with diarrheal disease along with typical step-ladder patterns of fever, relative bradycardia, malaise, and abdominal discomfort. The incubation period is usually around <strong>7-14 days</strong>.</p>\n<p>Option C: Infection with <strong><em>Bacillus cereus</em></strong> causes food poisoning with a longer incubation period of 8-16 hours. But patients usually have a history of consumption of <strong>fried rice.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Acute Diarrhea Mini Test - -Tmt';
        const quizFilename = 'acute-diarrhea-mini-test-tmt-2ce383e7.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>