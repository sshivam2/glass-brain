<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>64 Cell Cycle Specific Cytotoxic Drugs - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pharmacology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">28</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The Nobel Prize in Physiology or Medicine, 2018 was awarded to James P. Allison and Tasuku Honjo for which of the following discoveries?",
    "choices": [
      {
        "id": 1,
        "text": "Discovery of mechanisms of autophagy"
      },
      {
        "id": 2,
        "text": "Discoveries of molecular mechanisms controlling the circadian rhythm"
      },
      {
        "id": 3,
        "text": "Discovery of cancer therapy by inhibition of negative immune regulation"
      },
      {
        "id": 4,
        "text": "Discovery that mature cells can be reprogrammed to become pluripotent"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The Nobel prize in Physiology or Medicine, 2018 was awarded to James P. Allison and Tasuku Honjo for the&nbsp;discovery of <strong>cancer therapy by inhibition of negative immune regulation.</strong></p>\n<p><strong>Immune checkpoint inhibitors</strong>&nbsp;inhibit proteins that keep immune responses to cancer cells in check. When these proteins are blocked, the brake on the immune system is released and&nbsp;<strong>T cells</strong> are able to <strong>kill</strong> <strong>cancer cells</strong> more <strong>efficiently.</strong></p>\n<p>The&nbsp;Nobel prize 2018 in Physiology or Medicine&nbsp;was awarded to&nbsp;James P. Allison&nbsp;and&nbsp;Tasuku Honjo&nbsp;for their breakthrough work on unleashing the body&rsquo;s immune system to attack cancer, that has led to an entirely new class of these drugs and brought lasting remissions to many patients who had run out of options.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a cell-cycle specific agent?",
    "choices": [
      {
        "id": 1,
        "text": "Ifosfamide"
      },
      {
        "id": 2,
        "text": "Melphalan"
      },
      {
        "id": 3,
        "text": "Vinblastine"
      },
      {
        "id": 4,
        "text": "Cyclophosphamide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vinblastine </strong>is a<strong> cell cycle-specific</strong> agent and a vinca alkaloid. It arrests mitosis and acts specifically on<strong> M-phase. </strong></p>\n<p>Cyclophosphamide, melphalan, and ifosfamide are nitrogen mustards and are cell-cycle non-specific agents.</p>\n<div class=\"panel-body ng-scope\">\n<p>Cell cycle specific agents:</p>\n<ul>\n<li>Antimetabolites: S phase</li>\n<li>Camptothecin analogs: S Phase</li>\n<li>Taxanes, Vinca alkaloids: M phase</li>\n<li>Epipodophyllotoxin: G1-S phase</li>\n<li>Bleomycin: G2-M phase</li>\n</ul>\n<p>Cell cycle non-specific agents:</p>\n<ul>\n<li>Alkylating agents</li>\n<li>Platinum analogs</li>\n<li>Anthracyclines</li>\n<li>Mitomycin, dactinomycin</li>\n</ul>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an antimetabolite?",
    "choices": [
      {
        "id": 1,
        "text": "Cyclosporine"
      },
      {
        "id": 2,
        "text": "Methotrexate"
      },
      {
        "id": 3,
        "text": "Etoposide"
      },
      {
        "id": 4,
        "text": "Vinblastine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Methotrexate is an antimetabolite.&nbsp;It is a <strong>folic acid analog</strong> that <strong>inhibits</strong> the enzyme <strong>dihydrofolate reductase (DHFR)</strong>.&nbsp;Methotrexate and its polyglutamate<strong> also inhibit</strong> the enzymes involved in<strong>&nbsp;denovo purine and thymidylate synthesis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following disease-modifying anti rheumatoid drug increases extracellular adenosine?",
    "choices": [
      {
        "id": 1,
        "text": "Methotrexate"
      },
      {
        "id": 2,
        "text": "Lefunamide"
      },
      {
        "id": 3,
        "text": "Sulphasalazine"
      },
      {
        "id": 4,
        "text": "Hydroxychloroquine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Methotrexate</strong> is the disease-modifying anti rheumatoid drug that <strong>increases extracellular adenosine</strong>. Methotrexate&rsquo;s principal mechanism of action relates to inhibition of amino-imidazole carboxamide ribonucleotide (AICAR) transformylase and thymidylate synthetase.</p>\n<p>AICAR accumulates intracellularly, competitively inhibits AMP deaminase, leading to an <strong>accumulation of AMP</strong>.&nbsp;The AMP is released and converted extracellularly to <strong>adenosine, </strong>which is a <strong>potent inhibitor of inflammation</strong>. As a result, the inflammatory functions of neutrophils, macrophages, dendritic cells, and lymphocytes are suppressed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f8d4a9516b044e2a3f0355baf01eb5cx1280x1905.JPEG"
    ]
  },
  {
    "text": "In which of the following conditions is methotrexate not used?",
    "choices": [
      {
        "id": 1,
        "text": "Giant cell arteritis"
      },
      {
        "id": 2,
        "text": "Psoriasis"
      },
      {
        "id": 3,
        "text": "Sickle cell anemia"
      },
      {
        "id": 4,
        "text": "Organ transplantation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Indications for methotrexate (inflammatory conditions) include:</p>\n<ul>\n<li>Rheumatoid arthritis</li>\n<li><strong>Psoriasis&nbsp;</strong></li>\n<li>Psoriatic arthritis</li>\n<li>Ankylosing spondylitis</li>\n<li>Polymyositis</li>\n<li>Dermatomyositis</li>\n<li>Wegener&rsquo;s granulomatosis</li>\n<li><strong>Giant cell arteritis&nbsp;</strong></li>\n<li>Systemic lupus erythematosus</li>\n<li>Other systemic vasculitis</li>\n<li><strong>Graft versus host disease associated with organ transplantation.</strong></li>\n</ul>\n<p>Sickle cell anemia appears to be the most appropriate answer among the options. Though small trials have shown positive results in sickle cell disease, it is neither extensively used nor approved for this indication.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions is high dose methotrexate indicated in?",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 3,
        "text": "Retinoblastoma"
      },
      {
        "id": 4,
        "text": "Ewing\u2019s sarcoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>High-dose methotrexate with leucovorin rescue (HDM-L) is a standard agent for adjuvant therapy of <strong>osteosarcoma</strong>.&nbsp;HDM is critical in the management of childhood acute lymphocytic leukemia (ALL). HDM-L also produces a high response rate in CNS lymphomas.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old lady was diagnosed with gestational trophoblastic neoplasia and started on methotrexate. However the hCG levels of the patient kept rising. What could be the cause of this phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Depletion of folate"
      },
      {
        "id": 2,
        "text": "Overproduction of DHFR"
      },
      {
        "id": 3,
        "text": "Overproduction of thymidylate kinase"
      },
      {
        "id": 4,
        "text": "Decreased DHFR"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The scenario depicts a case of<strong> Methotrexate resistance</strong>. This happens due to the <strong>overproduction of DHFR&nbsp;</strong>(dihydrofolate reductase).</p>\n<p>Mechanism of resistance to methotrexate includes:</p>\n<ul>\n<li>Impaired transport of methotrexate into cells</li>\n<li>Production of altered forms of DHFR that have decreased affinity for methotrexate</li>\n<li>The increased concentration of intracellular DHFR through gene amplification or gene regulation</li>\n<li>Decreased ability to form methotrexate polyglutamates</li>\n<li>Increased expression of drug efflux transporter</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with impaired renal function, undergoing chemotherapy, develops methotrexate toxicity. Which of the following drugs is a methotrexate cleaving enzyme that can be used to manage this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Adenyl cyclase"
      },
      {
        "id": 2,
        "text": "Glucarpidase"
      },
      {
        "id": 3,
        "text": "Rasburicase"
      },
      {
        "id": 4,
        "text": "Serine protease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Glucarpidase</strong>, which is a methotrexate cleaving enzyme, can be used in this condition. Glucarpidase&nbsp;is an FDA approved intravenous drug for the treatment of <strong>methotrexate</strong> <strong>toxicity&nbsp;</strong>in the treatment of cancer patients who have<strong>&nbsp;impaired kidney function.&nbsp;</strong></p>\n<p>Glucarpidase is a recombinant bacterial enzyme that breaks down methotrexate into inactive metabolites rapidly after injection. These inactive metabolites are then eliminated by the liver.</p>\n<p>Note: Leucovorin is also a substrate of glucarpidase. Leucovorin is avoided 2 hours before and after the administration of glucarpidase to avoid its breakdown.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about methotrexate is false?",
    "choices": [
      {
        "id": 1,
        "text": "Folinic acid enhances its action"
      },
      {
        "id": 2,
        "text": "It inhibits dihydrofolate reductase"
      },
      {
        "id": 3,
        "text": "Non-proliferative cells are resistant to it"
      },
      {
        "id": 4,
        "text": "It targets the S-phase of the cell cycle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Folinic acid,&nbsp;</strong>also known as&nbsp;leucovorin, the active form of folic acid,<strong>&nbsp;</strong>is administered <strong>with methotrexate</strong> to <strong>reduce the toxicity</strong> associated with higher doses. It does not enhance the action of methotrexate.</p>\n<p><strong>Methotrexate</strong> is an antimetabolite that <strong>inhibits dihydrofolate reductase</strong>.&nbsp;It is a cell cycle (S-phase) specific antineoplastic agent and non-proliferative cells are relatively resistant to it.&nbsp;</p>\n<p><strong>Bone marrow suppression</strong> and&nbsp;gastrointestinal mucosa inflammation (<strong>mucositis</strong>) are the common <strong>side effects</strong> seen due to inhibition of DNA synthesis.&nbsp;</p>\n<p><strong>Methotrexate toxicity:</strong></p>\n<ul>\n<li><strong>Prevention -</strong>&nbsp;administration of <strong>leucovorin/folinic acid</strong>.</li>\n<li><strong>Treatment -</strong>&nbsp;maintaining<strong> adequate hydration</strong> and <strong>forced alkaline diuresis</strong> in patients with normal renal function.</li>\n<li>Glucarpidase&nbsp;is an intravenous drug administered in patients&nbsp;who have<strong>&nbsp;</strong>impaired renal function.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is on methotrexate therapy as part of his chemotherapy regimen. Which of the following tests is not indicated for monitoring in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Liver function test"
      },
      {
        "id": 2,
        "text": "Lung function test"
      },
      {
        "id": 3,
        "text": "Fundoscopy"
      },
      {
        "id": 4,
        "text": "Hemogram"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fundoscopy is not monitored in a patient on methotrexate therapy. This is because no significant eye-related adverse effect is associated with either low, normal or high-dose methotrexate use, mandating frequent monitoring.</p>\n<p>Option A - <strong>Hepatic fibrosis</strong> or cirrhosis is a significant side effect of long-term therapy of methotrexate that requires regular hepatic function monitoring.</p>\n<p>Option B - <strong>Allergic interstitial pneumonitis</strong> and other pulmonary-related adverse effects are associated with methotrexate.</p>\n<p>Option D - <strong>Myelosuppression</strong> is a common and a serious adverse effect that mandates routine monitoring of hemogram.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During rounds, one of your colleagues suggested alkalization of urine with sodium bicarbonate for a patient, to reduce the toxicity of a chemotherapeutic agent. Which is the chemotherapeutic drug being discussed here?",
    "choices": [
      {
        "id": 1,
        "text": "Arabinoside-cytosine"
      },
      {
        "id": 2,
        "text": "Ifosfamide"
      },
      {
        "id": 3,
        "text": "Cisplatin"
      },
      {
        "id": 4,
        "text": "Methotrexate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The drug being discussed here is <strong>methotrexate</strong>. Alkalization of urine ameliorates the toxicity of methotrexate.&nbsp;<strong>Methotrexate</strong> is an acidic drug and the<strong> excretion</strong> is <strong>increased by alkalization of urine</strong>.&nbsp;</p>\n<p>High-dose methotrexate with leucovorin (HDM-L) used in some conditions has a higher incidence of nephrotoxicity. It is attributed to the precipitation of methotrexate in the acidic tubular fluid.&nbsp;Vigorous hydration and alkalinization of urine prior to HDM-L administration is required to minimize the chance of nephrotoxicity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an inhibitor of DNA synthesis?",
    "choices": [
      {
        "id": 1,
        "text": "6-mercaptopurine"
      },
      {
        "id": 2,
        "text": "Mitomycin"
      },
      {
        "id": 3,
        "text": "Actinomycin"
      },
      {
        "id": 4,
        "text": "Asparaginase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>6-Mercaptopurine</strong> is an inhibitor of DNA synthesis.</p>\n<p>6-Mercaptopurine is inactive in its parent form. It must be metabolized by hypoxanthine-guanine&nbsp;phosphoribosyltransferase to form <strong>monophosphate nucleotide 6-thioinosinic acid.</strong> This inhibits several enzymes of de novo purine nucleotide synthesis.</p>\n<p>Option B- <strong>Mitomycin</strong> acts as an <strong>alkylating agent</strong> and crosslinks DNA. It also generates free radicals which damage DNA.</p>\n<p>Option C-<strong> Actinomycin</strong> causes <strong>single-strand breaks in DNA</strong>. It&nbsp;blocks RNA transcription as well.</p>\n<p>Option D-<strong> L-Asparaginase</strong>&nbsp;causes the breakdown of asparagine and thus <strong>interferes with protein synthesis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What should be done to the dose of intravenous 6-mercaptopurine when it is administered in a patient taking allopurinol?",
    "choices": [
      {
        "id": 1,
        "text": "Reduce by 75%"
      },
      {
        "id": 2,
        "text": "Reduce by 50%"
      },
      {
        "id": 3,
        "text": "Increase by 50%"
      },
      {
        "id": 4,
        "text": "No dose adjustment necessary"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Intravenous </strong>dosing of <strong>6-mercaptopurine</strong> (6MP) <strong>does&nbsp;not require</strong> any <strong>dosing adjustment </strong>when administered with allopurinol.&nbsp;</p>\n<p>6MP undergoes the first-pass metabolism by xanthine oxidase in the liver and intestine. Since allopurinol inhibits xanthine oxidase, it causes elevated levels of 6-MP. Hence, the <strong>oral dose of 6MP</strong> needs to be <strong>reduced by 75 % if allopurinol is given</strong>.</p>\n<p>In the case of<strong> intravenous administration</strong>, the dosage need not be changed as it <strong>escapes the first-pass metabolism.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient developed the following lesions after 10 days of initiation of chemotherapy. The patient also complains of similar lesions over soles and they are sensitive to touch. Which is the most likely agent to cause this adverse effect?",
    "choices": [
      {
        "id": 1,
        "text": "Cisplatin"
      },
      {
        "id": 2,
        "text": "Vincristine"
      },
      {
        "id": 3,
        "text": "Capecitabine"
      },
      {
        "id": 4,
        "text": "Mitomycin-C"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image depicts classical findings of <strong>hand-foot syndrome</strong> and <strong>capecitabine</strong> is commonly associated with this prominent side effect.</p>\n<p>Hand foot syndrome or palmar-plantar erythrodysesthesia consists of erythema, desquamation, pain and sensitivity to touch of the palms and soles.&nbsp;</p>\n<p>Drugs commonly implicated are:</p>\n<ul>\n<li>Capecitabine</li>\n<li>5-Fluorouracil</li>\n<li>Cytarabine</li>\n<li>Pemetrexed</li>\n<li>Doxorubicin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9fe119a45cdc49f8adf56e21ec3b07a3.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following patients is pemetrexed the drug of choice?",
    "choices": [
      {
        "id": 1,
        "text": "A patient with malignant mesothelioma"
      },
      {
        "id": 2,
        "text": "A patient with small cell carcinoma"
      },
      {
        "id": 3,
        "text": "A patient with stage II non-small cell lung carcinoma"
      },
      {
        "id": 4,
        "text": "A patient with inflammatory breast cancer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Pemetrexed</strong> is the drug of choice for the treatment of <strong>malignant</strong>&nbsp;<strong>mesothelioma</strong>. It is an <strong>antifolate</strong> drug that belongs to the antimetabolite group.</p>\n<p>It acts by <strong>inhibiting thymidylate synthase</strong>&nbsp;and<strong> dihydrofolate reductase (DHFR)</strong> and prevents the formation of DNA and RNA, which are required for the growth and survival of both normal cells and cancer cells.</p>\n<p>Pemetrexed is used for the treatment of stage IV non-small cell carcinoma along with cisplatin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who is undergoing chemotherapy is to be started on allopurinol. Which of these drugs might require dose reduction?",
    "choices": [
      {
        "id": 1,
        "text": "6-mercaptopurine"
      },
      {
        "id": 2,
        "text": "Cyclophosphamide"
      },
      {
        "id": 3,
        "text": "6-thioguanine"
      },
      {
        "id": 4,
        "text": "Methotrexate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A patient receiving allopurinol requires a dose reduction of&nbsp;<strong>6-mercaptopurine.</strong>&nbsp;</p>\n<p><strong>Allopurinol</strong> is a potent<strong> xanthine oxidase inhibitor</strong> that is often used in acute leukemias as supportive care to prevent the development of hyperuricemia due to tumor lysis syndrome.</p>\n<p><strong>6-mercaptopurine</strong> is converted to an <strong>inactive</strong> metabolite (6-thiouric acid) by <strong>xanthine oxidase</strong> in the liver and intestine.&nbsp;Therefore, the oral bioavailability of the 6-mercaptopurine is reduced significantly due to <strong>high first-pass metabolism.</strong></p>\n<p>Concomitant <strong>allopurinol</strong> use increases<strong> 6-mercaptopurine</strong> availability which leads to <strong>toxicity,</strong> thereby mandating<strong> oral dose reduction.</strong></p>\n<p>Note: Intravenous dosing of 6-mercaptopurine need not require any dosing adjustment when administered with allopurinol.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following enzymes is inhibited by pentostatin?",
    "choices": [
      {
        "id": 1,
        "text": "Adenosine deaminase"
      },
      {
        "id": 2,
        "text": "Aldolase"
      },
      {
        "id": 3,
        "text": "Adenosine aminase"
      },
      {
        "id": 4,
        "text": "Adenylyl cyclase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Pentostatin <strong>mimics adenosine</strong> and inhibits the enzyme <strong>adenosine deaminase</strong>.&nbsp;Adenosine deaminase inhibition leads to the accumulation of adenosine and deoxyadenosine nucleotides that <strong>blocks&nbsp;DNA synthesis</strong> by inhibiting RNR (ribonucleotide reductase).</p>\n<p>Pentostatin also<strong> inhibits RNA synthesis</strong>, its triphosphate derivative is incorporated into DNA causing strand breakage.&nbsp;</p>\n<p>It is indicated in the treatment of <strong>hairy cell leukemia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old patient presented with weakness, fatigue, and abdominal discomfort. On examination, splenomegaly was present. Investigations revealed pancytopenia, and his peripheral blood smear is shown below. Immunophenotype testing revealed CD11c, CD25, and CD103\u00a0positive. What is the drug of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pentastatin"
      },
      {
        "id": 2,
        "text": "Cladribine"
      },
      {
        "id": 3,
        "text": "Fludarabine"
      },
      {
        "id": 4,
        "text": "Clofarabine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario, characteristic immunophenotype, and the presence of hairy cells&nbsp;on the Wright-stained peripheral blood smear point to a diagnosis of&nbsp;<strong>hairy cell leukaemia.&nbsp;</strong><strong>Cladribine</strong> is considered the drug of choice for hairy cell leukemia.</p>\n<p>It is administered daily by continuous infusion for <strong>7 days</strong>.&nbsp;A <strong>single course</strong> of therapy achieves a complete response in about 80% of the patients.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3d647ef16074c1594341da1fd62d3af.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs is a topoisomerase I inhibitor?",
    "choices": [
      {
        "id": 1,
        "text": "Doxorubicin"
      },
      {
        "id": 2,
        "text": "Irinotecan"
      },
      {
        "id": 3,
        "text": "Etoposide"
      },
      {
        "id": 4,
        "text": "Vincristine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Irinotecan</strong> is a topoisomerase I inhibitor.</p>\n<p>Doxorubicin and etoposide inhibit topoisomerase II.</p>\n<p>Vincristine is a vinca alkaloid derivative that inhibits microtubule polymerization.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a mitotic polymerization inhibitor?",
    "choices": [
      {
        "id": 1,
        "text": "Vinblastine"
      },
      {
        "id": 2,
        "text": "Paclitaxel"
      },
      {
        "id": 3,
        "text": "Dactinomycin"
      },
      {
        "id": 4,
        "text": "Gemcitabine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\"><strong>Vinca alkaloids</strong> like vinblastine and vincristine bind to beta-tubulin and <strong>inhibit</strong> its <strong>polymerization</strong> with alpha-tubulin into microtubules.</p>\n<p style=\"text-align: left;\"><strong>Paclitaxel</strong> does not inhibit polymerization, rather it <strong>stabilizes polymerization</strong> and inhibits the breakdown of microtubules.</p>\n<p style=\"text-align: left;\"><strong>Gemcitabine</strong> is an <strong>antimetabolite</strong> and a pyrimidine analog.</p>\n<p style=\"text-align: left;\"><strong>Dactinomycin</strong> or actinomycin D is an <strong>actinomycin.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who was diagnosed with myocardial infarction underwent PCI and stenting with paclitaxel coated drug-eluting stent. What is the mechanism of action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Topoisomerase inhibition"
      },
      {
        "id": 2,
        "text": "Increases the polymerisation of tubulin"
      },
      {
        "id": 3,
        "text": "Inhibits protein synthesis"
      },
      {
        "id": 4,
        "text": "Alkylation of DNA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Paclitaxel binds specifically to beta-tubulin and <strong>promotes</strong> the<strong> polymerization</strong> and inhibits the disassembly of this cytoskeletal protein, resulting in the <strong>arrest </strong>of the cell cycle in<strong> M-phase.</strong></p>\n<p>The first generation drug eluting stents used in PCI were coated with paclitaxel or sirolimus as an anti-proliferative agent. Second-generation drug-eluting stents use newer agents such as everolimus, biolimus, and zotarolimus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Bone marrow suppression is not seen with which of the following drugs?",
    "choices": [
      {
        "id": 1,
        "text": "Vincristine"
      },
      {
        "id": 2,
        "text": "Vinblastine"
      },
      {
        "id": 3,
        "text": "Vinorelbine"
      },
      {
        "id": 4,
        "text": "Methotrexate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Bone marrow suppression is not seen with<strong> vincristine</strong>.</p>\n<p>Vinblastine and vinorelbine have prominent bone marrow depression.</p>\n<p><strong>Bone marrow sparing</strong> cytotoxic drugs are:</p>\n<ul>\n<li>Vincristine</li>\n<li>Bleomycin</li>\n<li>L-asparaginase</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man was diagnosed with AML and initiated on chemotherapy. During the course of his treatment, he develops ataxia and slurred speech. Which of the following drugs could have caused this?",
    "choices": [
      {
        "id": 1,
        "text": "Cisplatin"
      },
      {
        "id": 2,
        "text": "Cytarabine"
      },
      {
        "id": 3,
        "text": "Bleomycin"
      },
      {
        "id": 4,
        "text": "Actinomycin D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This scenario describes a case of <strong>cerebellar toxicity</strong> and <strong>cytarabine</strong> is associated with this condition.</p>\n<p>It is seen especially with <strong>intrathecal</strong> administration or high dose systemic use.&nbsp;Cerebellar toxicity manifests as ataxia and slurred speech.&nbsp;Cerebral toxicity (seizures, dementia, and coma) is also seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding vincristine?",
    "choices": [
      {
        "id": 1,
        "text": "It is an alkaloid"
      },
      {
        "id": 2,
        "text": "Its use is associated with neurotoxicity"
      },
      {
        "id": 3,
        "text": "It does not cause alopecia"
      },
      {
        "id": 4,
        "text": "It is a useful drug for induction of remission in ALL"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vincristine </strong>use is associated with<strong> alopecia.</strong>&nbsp;It is usually reversible frequently without discontinuation of the drug.</p>\n<p>Vincristine is a vinca alkaloid derivative.&nbsp;It is mainly indicated for induction of remission in acute leukemias including ALL.&nbsp;Neurotoxicity is one of the main side effects.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions can all-trans-retinoic acid be used for treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Acute promyelocytic leukemia"
      },
      {
        "id": 2,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 3,
        "text": "Chronic myelogenous leukemia"
      },
      {
        "id": 4,
        "text": "Chronic lymphocytic leukemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>All-trans-retinoic acid</strong> (tretinoin) is used in the treatment of <strong>acute promyelocytic leukemia</strong> (APL).&nbsp;RAR-alpha and retinoid X receptor dimer binds tretinoin tightly and causes differentiation of promyelocytes resulting in decreased proliferation.&nbsp;</p>\n<p>As monotherapy, tretinoin induces a high rate of complete remission and in combination with anthracyclines cures most of the patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antineoplastic agents is extracted from the plant shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Epothilones"
      },
      {
        "id": 2,
        "text": "Camptothecin analogs"
      },
      {
        "id": 3,
        "text": "Vinca alkaloids"
      },
      {
        "id": 4,
        "text": "Taxanes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shown is of the<strong> periwinkle plant&nbsp;</strong>(<em>Catharanthus roseus)</em>. Vinca alkaloids like vinblastine and vincristine are extracted from this plant.</p>\n<p>Sources&nbsp;of few other drugs are:</p>\n<ul>\n<li>Epothilones - Myxobacterium <em>Sorangium cellulosum</em></li>\n<li>Camptothecin analogs -&nbsp;<em>Camptotheca acuminata&nbsp;</em>tree</li>\n<li>Taxanes - bark of the western yew tree.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8cfcd125db234466ab771d63e1ead398.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old woman is diagnosed with melanoma. On examination, a palpable lymph node was present in the posterior triangle. Biopsy revealed presence of tumour cells. Which of the following drugs used to treat this condition is a MEK inhibitor?",
    "choices": [
      {
        "id": 1,
        "text": "Dabrafenib"
      },
      {
        "id": 2,
        "text": "Vemurafenib"
      },
      {
        "id": 3,
        "text": "Trametinib"
      },
      {
        "id": 4,
        "text": "Ipilimumab"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Recent update:</strong>&nbsp;The FDA has approved the combination of the <strong>BRAF inhibitor encorafenib </strong>and the<strong> MEK inhibitor binimetinib</strong> for the treatment of patients with<em>&nbsp;</em>BRAF-mutant unresectable or metastatic melanoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old woman had undergone modified radical mastectomy followed by chemotherapy with trastuzumab. She now presents with liver metastases. Which of the following drugs could be used in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lapatinib"
      },
      {
        "id": 2,
        "text": "Panitumumab"
      },
      {
        "id": 3,
        "text": "Erlotinib"
      },
      {
        "id": 4,
        "text": "Imatinib"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario depicts a case of <strong>trastuzumab-refractory breast cancer&nbsp;</strong>and <strong>lapatinib</strong> is used in this condition.</p>\n<table>\n<tbody>\n<tr>\n<td>Drug</td>\n<td>Use</td>\n</tr>\n<tr>\n<td>Lapatinib</td>\n<td>Refractory and metastatic breast carcinoma</td>\n</tr>\n<tr>\n<td>Panitumumab</td>\n<td>Colorectal carcinoma</td>\n</tr>\n<tr>\n<td>Erlotinib</td>\n<td>\n<ul>\n<li>Non small cell lung carcinoma</li>\n<li>Pancreatic carcinoma</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Imatinib</td>\n<td>\n<ul>\n<li>Chronic myeloid leukemia</li>\n<li>Gastrointestinal stromal tumour</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '64 Cell Cycle Specific Cytotoxic Drugs';
        let hierarchy = ["Marrow", "qBank", "Pharmacology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>