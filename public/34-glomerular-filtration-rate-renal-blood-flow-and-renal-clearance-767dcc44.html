<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>34 Glomerular Filtration Rate, Renal Blood Flow, And Renal Clearance - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Physiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">35</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Principal cells and intercalated cells are present in which part of the nephron?",
    "choices": [
      {
        "id": 1,
        "text": "Distal collecting tubule and collecting duct"
      },
      {
        "id": 2,
        "text": "Glomerulus and proximal collecting tubule"
      },
      {
        "id": 3,
        "text": "Proximal collecting tubule and loop of Henle"
      },
      {
        "id": 4,
        "text": "Loop of Henle and distal collecting tubule"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note:&nbsp;Principal cells are the primary sites of action of&nbsp;potassium-sparing diuretics.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5965b14279cc4af68a343f93cdad61ffx1280x1780.JPEG"
    ]
  },
  {
    "text": "How does DCT differ from PCT?",
    "choices": [
      {
        "id": 1,
        "text": "Brush border in luminal membrane"
      },
      {
        "id": 2,
        "text": "Carbonic anhydrase in its luminal membrane"
      },
      {
        "id": 3,
        "text": "\u2018Tight\u2019 tight junctions"
      },
      {
        "id": 4,
        "text": "No Na+ - K+ ATPase in its basolateral membrane"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>DCT</strong> has <strong>'tight' tight junctions,</strong> while PCT has 'leaky' tight junctions.</p>\n<p>The&nbsp;'tight' tight junctions can maintain the high electrochemical gradients produced by active transcellular transport. This configuration is used to produce <strong>either highly concentrated or diluted secretions</strong>, as in the <strong>distal nephron.&nbsp;</strong>Hence, it&nbsp;can produce urine with osmolarity severalfold higher or lower than plasma.</p>\n<p>In contrast, epithelia with '<strong>leaky' tight junctions</strong> move large amounts of <strong>isosmotic fluids.&nbsp;</strong>A good example is a transport in <strong>PCT.</strong></p>\n<table style=\"width: 347px; height: 311px;\">\n<tbody>\n<tr>\n<td style=\"width: 167.637px; text-align: center;\">\n<p><strong>PCT</strong></p>\n</td>\n<td style=\"width: 164.121px; text-align: center;\">\n<p><strong>DCT</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 167.637px;\">\n<p>Brush border present in the apical membrane</p>\n</td>\n<td style=\"width: 164.121px;\">\n<p>No brush border</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 167.637px;\">\n<p>Cytoplasmic carbonic anhydrase (type 2 &amp; type 4) present</p>\n</td>\n<td style=\"width: 164.121px;\">\n<p>Cytoplasmic carbonic anhydrase (type 2 only)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 167.637px;\">\n<p>Has &lsquo;leaky&rsquo; tight junctions</p>\n</td>\n<td style=\"width: 164.121px;\">\n<p>Has &lsquo;tight&rsquo; tight junctions</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 167.637px;\">\n<p>Paracellular transport is possible via leaky tight junctions</p>\n</td>\n<td style=\"width: 164.121px;\">\n<p>No paracellular transport</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Na<sup>+</sup>- K<sup>-&nbsp;</sup>ATPase is present throughout most parts of the nephron.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In comparison to cortical nephron, juxtamedullary nephron______",
    "choices": [
      {
        "id": 1,
        "text": "Are more in number"
      },
      {
        "id": 2,
        "text": "Has long loop of Henle"
      },
      {
        "id": 3,
        "text": "Has low filtration rate"
      },
      {
        "id": 4,
        "text": "Have no vasa recta"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In comparison to cortical nephrons, <strong>juxtamedullary nephrons</strong>&nbsp;are characterized by a <strong>long loop of Henle</strong> that descends deep into the inner medulla. It is essential for the <strong>concentration of urine.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/376f6a47381f4159b11ea116cb41c058x1280x1999.JPEG"
    ]
  },
  {
    "text": "About what percentage of the cardiac output do the kidneys receive?",
    "choices": [
      {
        "id": 1,
        "text": "5%"
      },
      {
        "id": 2,
        "text": "10%"
      },
      {
        "id": 3,
        "text": "15%"
      },
      {
        "id": 4,
        "text": "20%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Kidneys</strong> receive approximately<strong> 20 to 25% </strong>of the<strong> cardiac output</strong>, which&nbsp;is approximately <strong>1000 mL per minute</strong>.</p>\n<table>\n<tbody>\n<tr style=\"height: 29.5508px;\">\n<td style=\"text-align: center; height: 29.5508px;\"><strong>Region</strong></td>\n<td style=\"text-align: center; height: 29.5508px;\"><strong>Blood flow (ml/min)</strong></td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">\n<p>Liver</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">1500</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">\n<p>Kidneys</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">1260</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">\n<p>Brain</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">750</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">\n<p>Skeletal muscle</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">840</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">\n<p>Heart muscles</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">250</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the normal resting GFR?",
    "choices": [
      {
        "id": 1,
        "text": "125 ml/min"
      },
      {
        "id": 2,
        "text": "90 ml/min"
      },
      {
        "id": 3,
        "text": "60 ml/min"
      },
      {
        "id": 4,
        "text": "150 ml/min"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>GFR</strong> in a healthy adult of average size is approximately <strong>125 mL/min.</strong></p>\n<p><span class=\"Apple-converted-space\">Glomerular filtration rate (GFR) is the volume of fluid filtered from the renal glomerular&nbsp;capillaries into the Bowman's capsule per unit time.</span></p>\n<p>The GFR is determined by</p>\n<ol>\n<li><strong>Sum of</strong> the<strong> hydrostatic&nbsp;and colloid osmotic forces</strong> across the glomerular membrane,&nbsp;which gives the net filtration pressure</li>\n<li>Glomerular <strong>Kf&nbsp;</strong>(glomerular ultrafiltration coefficient)</li>\n</ol>\n<p>Mathematically, it can be expressed as follows:</p>\n<p>GFR= K<sub>f</sub> [ forces favoring filtration- forces opposing filteration]</p>\n<p>GFR= K<sub>f</sub> [P<sub>G </sub>+&nbsp;&pi;<sub>B</sub>&nbsp;-P<sub>B</sub>-&nbsp;&pi;<sub>G</sub>]</p>\n<p><strong>Forces Favoring Filtration</strong></p>\n<p>P<sub>G</sub>: Glomerular hydrostatic pressure&nbsp;</p>\n<p>&pi;<sub>B</sub>: Bowman&rsquo;s capsule oncotic pressure&nbsp;</p>\n<p><strong>Forces Opposing Filtration&nbsp;</strong></p>\n<p>P<sub>B</sub>: Bowman&rsquo;s capsule hydrostatic pressure&nbsp;</p>\n<p>&pi;<sub>G</sub>: Glomerular capillary oncotic pressure</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the renal blood flow in a resting adult?",
    "choices": [
      {
        "id": 1,
        "text": "1-1.5  L/min"
      },
      {
        "id": 2,
        "text": "1.5-2  L/min"
      },
      {
        "id": 3,
        "text": "2-2.5  L/min"
      },
      {
        "id": 4,
        "text": "2.5-3  L/min"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note: Renal blood flow = Renal plasma flow/ 1- Hematocrit</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/84c59f3baf464720a364c6086519c3a3x565x115.PNG"
    ]
  },
  {
    "text": "What is the normal renal filtration fraction?",
    "choices": [
      {
        "id": 1,
        "text": "0.3"
      },
      {
        "id": 2,
        "text": "0.4"
      },
      {
        "id": 3,
        "text": "0.2"
      },
      {
        "id": 4,
        "text": "1.5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>When there is a<strong> fall in systemic blood pressure</strong>, the GFR falls less<span class=\"Apple-converted-space\">&nbsp;</span>than the RPF because of efferent arteriolar constriction, and consequently, the <strong>filtration fraction rises.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c7d7cc84430443108d95854bdda75bb9x280x71.PNG"
    ]
  },
  {
    "text": "Which of the following does not form filtration barrier?",
    "choices": [
      {
        "id": 1,
        "text": "Podocytes"
      },
      {
        "id": 2,
        "text": "Mesangium"
      },
      {
        "id": 3,
        "text": "Endothelial cell"
      },
      {
        "id": 4,
        "text": "Basement membrane"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A. The endothelial cells of the glomerulus; 1. Pore (fenestra)</p>\n<p>B. Glomerular basement membrane: 1. Lamina rara interna 2. Lamina densa 3. Lamina rara externa</p>\n<p>C. Podocytes: 1. Enzymatic and structural protein 2. Filtration slit 3. Diaphragm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8efc38654e1c461f97b05bfdf07277e2x1280x720.PNG"
    ]
  },
  {
    "text": "Two particles share the same diameter. The one which will pass through the glomerular membrane has ______",
    "choices": [
      {
        "id": 1,
        "text": "Positive charge"
      },
      {
        "id": 2,
        "text": "Negative charge"
      },
      {
        "id": 3,
        "text": "No charge"
      },
      {
        "id": 4,
        "text": "Filtration across GBM does not depend on charge"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>For any given molecular radius, <strong>positively charged molecules</strong> are<strong> filtered</strong> much more<strong> readily</strong> than are negatively charged molecules.</p>\n<p>This is because the <strong>sialoproteins</strong> in the glomerular capillary wall are <strong>negatively charged</strong>, and this negative charge repels the negatively charged substances in the blood.</p>\n<p>Studies have showed that for tracer molecules presumed to be of similar size, charges which are filtered are&nbsp;positive charge &gt; neutral charge &gt; negative charge.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What size of neutral substances are permitted by the filtration barriers?",
    "choices": [
      {
        "id": 1,
        "text": "8-10 nm"
      },
      {
        "id": 2,
        "text": "4-8 nm"
      },
      {
        "id": 3,
        "text": "8-10 \u03bcm"
      },
      {
        "id": 4,
        "text": "4-8 \u03bcm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Clinical correlation:</p>\n<ul>\n<li>Genetically abnormal basement membranes:&nbsp;<strong>Alport&rsquo;s syndrome (&alpha;3 and&nbsp;&alpha;4</strong> chains on the&nbsp;<strong>long arm of chromosome 2</strong>&nbsp;involved in autosomal dominant and recessive pattern;&nbsp;<strong>&alpha;5 chain</strong> on X chromosome involved in X-linked inheritance)</li>\n<li>Autoimmune response to basement membrane <strong>collagen IV</strong>&nbsp;(<strong>&alpha;3 NC1 domain</strong>):&nbsp;<strong>Goodpasture&rsquo;s&nbsp;</strong><strong>syndrome</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a part of the juxtaglomerular apparatus?",
    "choices": [
      {
        "id": 1,
        "text": "Lacis cells"
      },
      {
        "id": 2,
        "text": "Macula densa"
      },
      {
        "id": 3,
        "text": "JG cells"
      },
      {
        "id": 4,
        "text": "Glomerular mesangial cells"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Glomerular mesangial cells are not a part of the juxtaglomerular apparatus.\u00a0</p>\n<p>Juxtaglomerular apparatus contains:</p>\n<ul>\n<li>Macula densa: Specialized cells at the end of the thick ascending limb of Henle forms the macula densa. They detect sodium concentration of the fluid in the tubule<strong> (Chemoreceptor). </strong>In response to <strong>elevated sodium</strong>, the macula densa cells trigger<strong> contraction of the afferent arteriole</strong>, <strong>reducing</strong> flow of blood to the glomerulus and the <strong>glomerular filtration rate</strong>.\u00a0</li>\n<li>Lacis cells:<strong> Extraglomerular mesangial cells</strong> situated between afferent and efferent arteriole.</li>\n<li>Granular cells/JG cells:\u00a0Modified <strong>smooth muscle cells</strong> of the <strong>afferent arteriole, </strong>that<strong>\u00a0</strong>secrete renin.\u00a0<strong>Fall in pressure</strong> in afferent arteriole stimulates renin release <strong>(mechanoreceptor)</strong>, which, in turn, <strong>increases blood pressure.</strong></li>\n</ul>\n<p>Note: The distal convoluted tubule starts at the macula densa.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9512c61fde2b4724828a30873cf54f59x1280x1384.JPEG"
    ]
  },
  {
    "text": "In patients with renal diseases, albumin is the first to appear in the urine. What is the reason behind this?",
    "choices": [
      {
        "id": 1,
        "text": "Its high concentration in plasma"
      },
      {
        "id": 2,
        "text": "Its effective molecular diameter"
      },
      {
        "id": 3,
        "text": "Its high albumin: globulin ratio"
      },
      {
        "id": 4,
        "text": "Epithelial cells are sensitive"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In renal diseases, <strong>albumin</strong> is the&nbsp;<strong>first</strong> to <strong>appear</strong> because of its <strong>effective molecular diameter</strong>.&nbsp;</p>\n<p>In minimal change nephropathy, the negative charges on the&nbsp;basement membrane are lost even before there are noticeable&nbsp;changes in kidney histology. As a result of&nbsp;this <strong>loss of negative charges</strong> on the basement membranes,&nbsp;some of the <strong>lower molecular weight proteins</strong>, especially<strong>&nbsp;albumin </strong>(effective molecular diameter of<strong> 7 nm</strong>), <strong>are filtered</strong> and appear in the urine, a condition&nbsp;known as <strong>proteinuria or albuminuria.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Calculate the net filtration pressure across the GBM for a patient with \nGlomerular ultrafiltration coefficient = 6\nGlomerular hydrostatic pressure  =45\nGlomerular capillary oncotic pressure =20\nBowman\u2019s capsule hydrostatic pressure  =10\nBowman\u2019s capsule oncotic pressure  =0",
    "choices": [
      {
        "id": 1,
        "text": "90 mmHg"
      },
      {
        "id": 2,
        "text": "60 mmHg"
      },
      {
        "id": 3,
        "text": "30 mmHg"
      },
      {
        "id": 4,
        "text": "15 mmHg"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Net filtration pressure = Hydrostatic pressure in the glomerular capillaries - Pressure in Bowman's capsule - Oncotic pressure in the glomerular capillaries.</p>\n<p>Net filtration pressure=\u00a0[P<sub>G</sub> -P<sub>B</sub>-\u00a0\u03c0<sub>G</sub>+\u00a0\u03c0<sub>B</sub>]</p>\n<p>Therefore,</p>\n<p><strong>Net filtration pressure\u00a0 \u00a0 \u00a0 </strong>= (45-10-20+0)</p>\n<p>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0= 25-10 \u00a0</p>\n<p>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <strong>\u00a0= 15 mmHg</strong></p>\n<p>Note:\u00a0</p>\n<p>Here, just the\u00a0<strong>net filtration pressure</strong> is asked and<strong> not the GFR.</strong></p>\n<p>GFR= K<sub>f</sub> [P<sub>G</sub> -P<sub>B</sub>-\u00a0\u03c0<sub>G</sub>+\u00a0\u03c0<sub>B</sub>]</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "How much is the inulin clearance?",
    "choices": [
      {
        "id": 1,
        "text": "55 ml/ min"
      },
      {
        "id": 2,
        "text": "625 ml/ min"
      },
      {
        "id": 3,
        "text": "125 ml/ min"
      },
      {
        "id": 4,
        "text": "40 ml/min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Inulin clearance</strong> is equal to <strong>125 ml/ min</strong>. Since it is used for the measurement of GFR, inulin clearance will be equal to GFR, i.e 125 ml/min</p>\n<p><strong>Renal clearance </strong>is the volume of plasma completely cleared of a substance by the kidneys per unit time.&nbsp;</p>\n<p>A higher renal clearance suggests the substance may be cleared almost completely in one pass through the kidneys while a low value describes a substance that may not be eliminated by the kidneys at all.</p>\n<p>Clearance refers to the&nbsp;volume of plasma that would be necessary to supply the&nbsp;amount of substance excreted in the urine per unit of&nbsp;time. Stated mathematically,</p>\n<p>Cx.&nbsp;Px = Ux. V</p>\n<p>where Cx is the clearance rate of a substance x</p>\n<p>Px is the plasma concentration of x</p>\n<p>Ux is the urine&nbsp;concentration of that x</p>\n<p>V is the urine&nbsp;flow rate</p>\n<p>Rearranging this equation, clearance can be&nbsp;expressed as</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0caaf47efb874212a23c32bf57feafd1x404x132.PNG"
    ]
  },
  {
    "text": "In a patient, urine flow rate is 10 mL/min; plasma inulin is 2 mg/mL; and urine inulin is 25 mg/mL. Which of the following is true assuming GFR to be normal?",
    "choices": [
      {
        "id": 1,
        "text": "Inulin clearance = GFR"
      },
      {
        "id": 2,
        "text": "Inulin clearance > GFR"
      },
      {
        "id": 3,
        "text": "Inulin clearance < GFR"
      },
      {
        "id": 4,
        "text": "GFR cannot be calculated"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Thus, Inulin clearance=GFR (normal GFR= 125 ml/min)</p>\n<p><strong>Inulin</strong> is a <strong>polymer of fructose,</strong>&nbsp;clearance of inulin can be used for measurement of GFR, because of the following reasons:&nbsp;</p>\n<ul>\n<li>Freely filtered</li>\n<li>Neither reabsorbed nor secreted in the tubules</li>\n<li>Nontoxic</li>\n<li>Not metabolized by the body</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/deab2b5e11cc4e0f808c354f496d06d2x253x102.PNG",
      "https://cdn1.dailyrounds.org/uploads/bcf213931b134361b6c0794f78dadf7dx361x82.PNG"
    ]
  },
  {
    "text": "A patient's urine flow rate is 2 ml/min. What is the clearance of a substance x whose plasma concentration is 10mg/mL and in urine is 100mg/mL?",
    "choices": [
      {
        "id": 1,
        "text": "0.2 ml/min"
      },
      {
        "id": 2,
        "text": "2 ml/min"
      },
      {
        "id": 3,
        "text": "20 ml/min"
      },
      {
        "id": 4,
        "text": "200 ml/min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>C = Clearance (mL/min)</p>\n<p>[U]x = Urine concentration of substance x (mg/mL)=100mg/mL</p>\n<p>V= Urine flow rate per minute (mL/min)=2mL/min</p>\n<p>[P]x = Plasma concentration of substance x (mg/mL)=10mg/mL</p>\n<p>Substituting the values,</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/743ceaa607804d2f9375b239c487cec5x404x132.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11f17ecec63e4d38b5d8c53166278132x303x46.PNG"
    ]
  },
  {
    "text": "What is the effect of sympathetic stimulation on GFR?",
    "choices": [
      {
        "id": 1,
        "text": "\u2191 GFR with afferent arteriolar dilation"
      },
      {
        "id": 2,
        "text": "\u2191 GFR with efferent arteriolar dilation"
      },
      {
        "id": 3,
        "text": "\u2193 GFR with afferent arteriolar constriction"
      },
      {
        "id": 4,
        "text": "\u2193 GFR with Efferent arteriolar constriction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>GFR decreases</strong> with <strong>sympathetic stimulation</strong> as there is <strong>afferent arteriolar constriction</strong>.</p>\n<p>Strong activation of the renal sympathetic nerves constrict the afferent and efferent renal arterioles through the <strong>&alpha;1 receptors</strong>. As the afferent areterioles have far more &alpha;1 receptors than the efferent, it results in&nbsp;<strong>decreased renal blood flow</strong> and<strong> GFR.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/18e9e5dcdeeb454b8842917326c8ece3x1280x2564.JPEG"
    ]
  },
  {
    "text": "If a patient is on a high protein diet, what will be the effect on the GFR?",
    "choices": [
      {
        "id": 1,
        "text": "Increases GFR"
      },
      {
        "id": 2,
        "text": "Decreases GFR"
      },
      {
        "id": 3,
        "text": "Has no effect"
      },
      {
        "id": 4,
        "text": "Is unpredictable"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note<strong>:</strong> Increase in the <strong>plasma protein</strong> concentration is<strong> not</strong> the <strong>same</strong> as <strong>high protein intake.</strong> An increase in the plasma protein concentration decreases GFR due to a raised oncotic pressure. A high protein intake raises the amino acid concentration in the blood, not the plasma protein concentration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/908a39889f5a4050bf7ddb21edde0423x1280x1237.JPEG"
    ]
  },
  {
    "text": "Which of the following would cause an increase in both GFR and RPF?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperproteinemia"
      },
      {
        "id": 2,
        "text": "Constriction of efferent arteriole"
      },
      {
        "id": 3,
        "text": "Dilation of efferent arteriole"
      },
      {
        "id": 4,
        "text": "Dilation of the afferent arteriole"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Dilation</strong> of the <strong>afferent arteriole</strong> will <strong>increase</strong> both <strong>GFR</strong> and <strong>RPF.</strong></p>\n<ul>\n<li><strong>Increase renal plasma flow (RPF)</strong> - because renal vascular resistance is decreased</li>\n<li><strong>Increase glomerular filtration rate (GFR)</strong> - because glomerular capillary hydrostatic pressure is increased.</li>\n<li>Filtration fraction (FF) remains normal&nbsp;</li>\n</ul>\n<p><strong>Dilation</strong> of the <strong>efferent</strong> arteriole will <strong>increase RPF</strong>&nbsp;but <strong>decrease GFR.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following causes relaxation of the mesangial cells?",
    "choices": [
      {
        "id": 1,
        "text": "cAMP"
      },
      {
        "id": 2,
        "text": "Endothelin"
      },
      {
        "id": 3,
        "text": "PGF2"
      },
      {
        "id": 4,
        "text": "Vasopressin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>cAMP</strong> causes <strong>relaxation</strong> of the <strong>mesangial cells.</strong> The other agents mentioned in the options cause contraction of the mesangial cells.</p>\n<p>Agents causing relaxation of mesangial cells (mnemonic - <strong>DA</strong>n<strong>CE</strong>)</p>\n<ul>\n<li><strong>D</strong>opamine</li>\n<li><strong>A</strong>NP</li>\n<li><strong>c</strong>AMP</li>\n<li>PG<strong>E</strong>2</li>\n</ul>\n<p><strong>Angiotensin II</strong> is an important regulator of mesangial<strong> contraction</strong>, and there are angiotensin II receptors in the glomeruli.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the effect of prostaglandins on renal blood flow?",
    "choices": [
      {
        "id": 1,
        "text": "Increase blood flow to cortex and medulla"
      },
      {
        "id": 2,
        "text": "Increase blood flow to cortex and decrease blood flow to medulla"
      },
      {
        "id": 3,
        "text": "Decrease blood flow to cortex and increase blood flow to medulla"
      },
      {
        "id": 4,
        "text": "Decrease blood flow to cortex as well as medulla"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Prostaglandins increase</strong> blood<strong> flow</strong> in the<strong> renal cortex</strong> and <strong>decrease</strong> blood<strong> flow</strong> in the<strong> renal medulla.&nbsp;</strong></p>\n<p>PGE2 is partially responsible for the <strong>vasodilatation </strong>of the<strong> afferent arteriole,</strong> which increases blood flow to the glomerulus. This phenomenon describes why <strong>NSAIDs</strong> (which inhibit prostaglandin synthesis) result in afferent arteriole vasoconstriction. It can cause a <strong>reduced GFR</strong> in patients<strong> who rely heavily on prostaglandin</strong> synthesis to maintain renal blood flow.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which part of the proximal tubule is most susceptible to ischemic injury?",
    "choices": [
      {
        "id": 1,
        "text": "S1"
      },
      {
        "id": 2,
        "text": "S2"
      },
      {
        "id": 3,
        "text": "S3"
      },
      {
        "id": 4,
        "text": "S4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Regions of the kidney most prone to <strong>ischemic injury</strong> are the <strong>S3 segment</strong> of the<strong> proximal tubule </strong>and the<strong> medullary thick ascending limb </strong>of the loop of Henle (mTAL).&nbsp;These tubular areas exist physiologically in relatively lower oxygen conditions.</p>\n<p>The S3 segment, in particular, has a much lower capability of producing energy through glycolysis under anaerobic conditions than the mTAL.</p>\n<p>Based on the ultrastructure proximal tubule is divided into three segments:</p>\n<ul>\n<li>S1 segment: 1st half of PCT</li>\n<li>S2 segment: 2nd half of PCT and 1st half of proximal straight tubule</li>\n<li>S3 segment: 2nd half of proximal straight tubule</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8fd7a5b39cd04dc1b02695551a6bb180x1280x1681.JPEG"
    ]
  },
  {
    "text": "What is the effective renal plasma flow?",
    "choices": [
      {
        "id": 1,
        "text": "425 mL/min"
      },
      {
        "id": 2,
        "text": "625 mL/min"
      },
      {
        "id": 3,
        "text": "525 mL/min"
      },
      {
        "id": 4,
        "text": "725 mL/min"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Note:&nbsp;Renal blood flow= Renal plasma flow/ 1- Hematocrit</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/968f559278284587a6fd873b40b0a018x271x87.JPEG"
    ]
  },
  {
    "text": "Which of the following formulae is correct?",
    "choices": [
      {
        "id": 1,
        "text": "ERPF = RPF/ Extraction ratio"
      },
      {
        "id": 2,
        "text": "RPF = ERPF/ Extraction ratio"
      },
      {
        "id": 3,
        "text": "ERPF = Extraction ratio/ RPF"
      },
      {
        "id": 4,
        "text": "RPF = Extraction ratio/ ERPF"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>When we inject para-aminohippuric acid, 90% of it is filtered through the glomerulus at the rate of 625mL per minute - which is the effective renal plasma flow (ERPF). Using that, to we calculate the <strong>true RPF,&nbsp;</strong> we divide it by the extraction ratio to account for the 10% that is not filtered by dividing the ERPF by 0.9, hence getting the final value of ~ 700mL per minute</p>\n<p>When peripheral venous plasma concentration of PAH is used for calculation of RPF, RPF obtained is called <strong>effective renal plasma flow (ERPF)</strong>. This is because PAH concentration is essentially identical to that in the arterial plasma reaching the kidney.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a21e9c20c27b4472abe1283f6184e482x1279x951.JPEG"
    ]
  },
  {
    "text": "In a patient with renal disease, you want to measure the filtration fraction. Which of the following substances will you use?",
    "choices": [
      {
        "id": 1,
        "text": "Inulin and mannitol"
      },
      {
        "id": 2,
        "text": "Urea and diodrast"
      },
      {
        "id": 3,
        "text": "PAH and phenol red"
      },
      {
        "id": 4,
        "text": "Inulin and PAHA"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Inulin</strong> and <strong>PAHA</strong> are used to determine the filtration fraction.&nbsp;The <strong>filtration fraction</strong> is the <strong>ratio of GFR and RPF</strong>&nbsp;</p>\n<p><strong>Inulin,</strong> a polymer of fructose can be used to measure<strong> GFR</strong>.&nbsp;Para-aminohippuric acid <strong>(PAHA)</strong>&nbsp;is used to measure<strong> RPF.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "According to myogenic hypothesis of renal autoregulation the afferent arterioles contract in response to stretch-induced by______",
    "choices": [
      {
        "id": 1,
        "text": "NO"
      },
      {
        "id": 2,
        "text": "Noradrenaline"
      },
      {
        "id": 3,
        "text": "Opening of calcium channels"
      },
      {
        "id": 4,
        "text": "Adenosine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>afferent arterioles contract</strong> in <strong>response</strong> to <strong>stretch induced</strong> by the <strong>opening</strong> of <strong>calcium channels.</strong> The mechanism is called <strong>myogenic autoregulation </strong>of renal blood flow and GFR.\u00a0</p>\n<p><strong>The stretch</strong> of the vascular wall allows <strong>increased movement of calcium ions</strong> from the extracellular fluid into the cells, causing them to <strong>contract</strong>. This contraction <strong>prevents excessive stretch</strong> of the vessel. This prevents excessive increase of renal blood flow and GFR by raising vascular resistance.</p>\n<p>This mechanism may be more important in protecting\u00a0the kidney from hypertension-induced injury.</p>\n<p>Autoregulation has two main mechanisms:</p>\n<ul>\n<li><strong>Metabolic mechanism</strong>: Tissues produce vasodilatory metabolites that regulate flow e.g. prostaglandins, NO, CO<sub>2</sub>, H<sup>+</sup> and K<sup>+</sup></li>\n<li><strong>Myogenic mechanism</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5cf2730d99944a29e93e6bc23f866b5x600x748.JPEG"
    ]
  },
  {
    "text": "Tubuloglomerular feedback is mediated by the sensing of_____",
    "choices": [
      {
        "id": 1,
        "text": "Increased Na + concentration in thick ascending loop of Henle"
      },
      {
        "id": 2,
        "text": "Increased Cl - concentration in thick ascending loop of Henle"
      },
      {
        "id": 3,
        "text": "Increased Na + concentration in macula densa"
      },
      {
        "id": 4,
        "text": "Increased Cl- concentration in macula densa"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tubuloglomerular feedback</strong> is mediated by the sensing of <strong>increased Na<sup>+</sup> concentration in macula densa.</strong></p>\n<p><strong>Macula densa</strong> are the specialized cells present at the distal end of the thick ascending loop of Henle where it reaches the glomerulus. Distal convoluted tubule starts from macula densa. Macula forms part of the juxtaglomerular apparatus.</p>\n<p>While both Na<sup>+</sup> and Cl<sup>-</sup> are delivered to the macula densa cells, it is the <strong>increased concentration</strong> of<strong> Na<sup>+</sup></strong> in the cells that <strong>increases</strong> the <strong>Na<sup>+</sup>-K ATPase activity</strong> leading to the feedback.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c540074de90f418dac2bac0db8d1e334x1280x1970.JPEG"
    ]
  },
  {
    "text": "Renal autoregulation is absent in which of the following cases?",
    "choices": [
      {
        "id": 1,
        "text": "Denervated kidney"
      },
      {
        "id": 2,
        "text": "Isolated, perfused kidney"
      },
      {
        "id": 3,
        "text": "Paralysis of vascular smooth muscle"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Renal <strong>autoregulation</strong> is<strong> absent</strong> in case of <strong>p</strong><strong>aralysis of vascular smooth muscle.&nbsp;</strong></p>\n<p>Paralysis of vascular smooth muscles abolishes its action i.e.,&nbsp;<strong>autoregulation</strong> of<strong> renal blood flow</strong> and<strong> GFR</strong>. Vascular smooth muscles act through myogenic mechanism of renal autoregulation.<strong>&nbsp;</strong>Paralysis of vascular smooth muscles can be brought about by administration of drugs.</p>\n<p>Renal autoregulation is <strong>present</strong> in <strong>denervated and in iso&shy;lated, perfused kidneys.</strong></p>\n<p>Feedback mechanisms <strong>intrinsic</strong> to the kidneys&nbsp;keep the <strong>renal blood flow and GFR relatively constant</strong>,&nbsp;despite marked <strong>changes in arterial blood pressure</strong>. This relative constancy of GFR and renal&nbsp;blood flow is referred to as autoregulation.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/985f48a844ae4ab88100852effb1e937x1280x1384.JPEG"
    ]
  },
  {
    "text": "Kidney responds to shock by _______.",
    "choices": [
      {
        "id": 1,
        "text": "Increasing renal blood flow"
      },
      {
        "id": 2,
        "text": "Increasing afferent arteriole resistance"
      },
      {
        "id": 3,
        "text": "Increasing GFR"
      },
      {
        "id": 4,
        "text": "Both B and C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Kidney responds to shock by <strong>increasing afferent arteriolar resistance.</strong></p>\n<p>During shock, <strong>both afferent</strong> and <strong>efferent</strong> arterioles in kidney are <strong>constricted</strong>, however, the efferent vessels are constricted much more.<br />The <strong>glomerular filtration rate</strong> and the <strong>plasma renal flow</strong> is <strong>decreased</strong> during shock. As plasma renal flow is decreased to a greater extent, the filtration fraction increases. (Option 1 &amp; 3)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the function of tubuloglomerular feedback?",
    "choices": [
      {
        "id": 1,
        "text": "Regulate GFR"
      },
      {
        "id": 2,
        "text": "Decrease plasma sodium"
      },
      {
        "id": 3,
        "text": "Increase plasma volume"
      },
      {
        "id": 4,
        "text": "Decrease tubular secretion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Tubuloglomerular feedback regulates</strong> glomerular filtration rate <strong>(GFR).</strong></p>\n<p>As the rate of \ufb02ow through the ascending limb of the loop of Henle and first part of the distal tubule increases, glomerular filtration in the same nephron decreases, and, conversely, a decrease in \ufb02ow increases the GFR.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The concentration of a substance is 2 mg % in afferent arteriole and 0 mg% in the efferent arteriole of a patient. This substance is",
    "choices": [
      {
        "id": 1,
        "text": "Freely filtered"
      },
      {
        "id": 2,
        "text": "Secreted"
      },
      {
        "id": 3,
        "text": "Absorbed in PCT"
      },
      {
        "id": 4,
        "text": "Impermeable to loop of henle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>concentration</strong> of <strong>0 mg%</strong> is <strong>efferent</strong> arteriole indicates the substance is <strong>freely filtered.</strong></p>\n<p>Afferent arterioles \u2192 glomerulus (filtration) \u2192 efferent arterioles \u2192 peritubular capillaries (reabsorption+secretion).</p>\n<p>Note: The question compares the concentration in afferent and efferent arterioles. Reabsorption and secretion happen between the tubular lumen of the nephron and the peritubular capillaries and not the efferent arteriole.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The protein in the glomerular basement membrane responsible for charge-dependent filtration is?",
    "choices": [
      {
        "id": 1,
        "text": "Fibronectin"
      },
      {
        "id": 2,
        "text": "Heparan sulfate"
      },
      {
        "id": 3,
        "text": "Collagen Type IV"
      },
      {
        "id": 4,
        "text": "Entactin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The protein in the glomerular basement membrane responsible for <strong>charge-dependent filtration</strong> is <strong>heparan sulfate. </strong>It prevents filtration by repelling<strong> negatively charged proteins.</strong></p>\n<p>Collagen type IV, fibronectin, entactin are structural components of basement membrane.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Efferent arteriolar constriction causes all except:",
    "choices": [
      {
        "id": 1,
        "text": "Decrease in GFR"
      },
      {
        "id": 2,
        "text": "Decreases renal blood flow"
      },
      {
        "id": 3,
        "text": "Decreases oncotic pressure in glomerular capillaries"
      },
      {
        "id": 4,
        "text": "Increases hydrostatic pressure in glomerular capillaries"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Efferent arteriolar constriction<strong> increases oncotic pressure</strong> in<strong> glomerular capillaries.</strong></p>\n<p>Efferent arteriolar constriction has a&nbsp;<strong>biphasic response&nbsp;</strong>on GFR depending on the severity of resistance.</p>\n<p><strong>Moderate efferent arteriolar constriction</strong> causes increased glomerular hydrostatic pressure and <strong>slightly</strong>&nbsp;<strong>increased GFR</strong>.&nbsp;</p>\n<p>However, in cases of <strong>severe efferent arteriolar constriction</strong>&nbsp;(more than threefold increase in efferent arteriolar resistance), the renal blood flow is significantly reduced. This results in increased plasma protein concentration, thereby increasing the glomerular colloid oncotic pressure. As the increase in colloid oncotic pressure exceeds the increase in hydrostatic pressure, the net force for filtration decreases, resulting in <strong>decreased GFR</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d0a53d8dd1b4b35909256f8a69b8a6bx1280x2564.JPEG"
    ]
  },
  {
    "text": "GFR is increased by all except",
    "choices": [
      {
        "id": 1,
        "text": "Increased renal blood flow"
      },
      {
        "id": 2,
        "text": "Efferent arteriolar constriction"
      },
      {
        "id": 3,
        "text": "Ureteric stone"
      },
      {
        "id": 4,
        "text": "Decreased oncotic pressure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ureteric stone</strong> causes a <strong>reduction in glomerular filtration rate (GFR).</strong></p>\n<p>Following ureteral obstruction, there is a progressive fall in glomerular filtration rate (GFR) due to a reduction in a&nbsp;single-nephron glomerular filtration rate (SNGFR) and a reduced number of filtering nephrons.</p>\n<p>All the other factors/options increase GFR.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "This is the graph depicting the filterability of dextran through the kidney, 1 representing complete filtration and 0 representing no filtration. Choose the substance A, B, C respectively.",
    "choices": [
      {
        "id": 1,
        "text": "Polycationic, Neutral, Polyanionic"
      },
      {
        "id": 2,
        "text": "Polyanionic, Neutral, Polycationic"
      },
      {
        "id": 3,
        "text": "Neutral, Polycationic, Polyanionic"
      },
      {
        "id": 4,
        "text": "Polyanionic, Polycationic, Neutral"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given graph, the order of filterability is<strong> A&gt;B&gt;C,</strong> which likely indicates that the substances are&nbsp;Polycationic, Neutral, Polyanionic.</p>\n<p>The glomerular filtration barrier is <strong>negatively charged,</strong> which will <strong>repel</strong> most of the negative charged <strong>(anionic substances).</strong> Whereas, the <strong>cationic</strong> <strong>substances</strong> are <strong>easily filtered.</strong></p>\n<p>Hence, the order of filterability would be:&nbsp;<strong>Polycationic &gt; Neutral &gt; Polyanionic</strong>, represented by A, B, and C in the graph shown.</p>\n<p>The glomerular filtration barrier consists of:</p>\n<ul>\n<li><strong>Endothelium </strong>of the capillary</li>\n<li><strong>Basement membrane:&nbsp;</strong>\n<ul>\n<li>Lamina densa - electron-dense layer. It contains type IV collagen</li>\n<li>Lamina rara interna -&nbsp;contains glycosaminoglycan heparan sulfate which has a negative charge</li>\n<li>Lamina rara externa - contains glycosaminoglycan heparan sulfate which has a negative charge</li>\n</ul>\n</li>\n<li>Layer of <strong>epithelial cells (podocytes)</strong> surrounding the outer surface of the capillary basement membrane</li>\n</ul>\n<div class=\"page\" title=\"Page 317\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The capillary endothelium is perforated by thousands of small holes called <strong>fenestrae</strong>, which measure from <strong>4 nm up to 8nm.</strong> Therefore, <strong>neutral substances</strong> with molecular diameters of less than 4 nm are freely filtered, and filtration of those with diameters of more than 8 nm approaches zero.</p>\n<p>However, in addition to the size of the particles, the filtration also depends mainly on the charge of the particle being filtered. The glomerular capillary wall consists of highly negatively charged proteins called <strong>sialoproteins,</strong> which repel the negatively charged substances (anions). The property can be studied by using charged dextran.</p>\n<p>When the filtration of the negatively and positively charged <strong>dextrans</strong> was studied, the results indicated that the <strong>negatively charged dextrans</strong> in the blood are <strong>repelled,</strong> with the result that filtration of anionic substances 4 nm in diameter is less than half that of neutral substances of the same size.</p>\n<p>This explains, why <strong>albumin</strong> despite having an effective molecular diameter of approximately 7 nm, has a very low filtration rate.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f9e9ddb302d944008de20d3d789832a1.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '34 Glomerular Filtration Rate, Renal Blood Flow, And Renal Clearance';
        let hierarchy = ["Marrow", "qBank", "Physiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>