<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>22 Dna Viruses - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 23-year-old lady presents with the lesions shown below. What is the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Herpes simplex virus type 1"
      },
      {
        "id": 2,
        "text": "Epstein-Barr virus"
      },
      {
        "id": 3,
        "text": "Cytomegalovirus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus type 2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The lesions shown are cold sores, also known as&nbsp;<strong>herpes</strong> <strong>labialis</strong> caused by <strong>Herpes simplex virus type 1</strong> (HSV-1).&nbsp;Herpes labialis<strong>&nbsp;</strong>primarily affects the <strong>lip </strong>and typically present<strong> as</strong>&nbsp;thin-walled, umbilicated vesicles, the roof of which breaks down with superficial ulcers. They generally heal without scarring.</p>\n<div class=\"page\" title=\"Page 482\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>HSV-1 can be isolated from lesions in and around the mouth and is transmitted by <strong>direct contact</strong> or <strong>droplet spread</strong> from cases or carriers. <strong>HSV-2</strong> is responsible for the majority of <strong>genital herpes</strong> infections and is commonly transmitted <strong>venereally.</strong></p>\n</div>\n</div>\n</div>\n<p>The images below show lesions of herpes labialis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/373df5382e464be5aa07581cf9d6bbb7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8fbc897979774742a5cb588b86704e64x736x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f845c9879d64503840dee6e3c2778f1x358x257.JPEG"
    ]
  },
  {
    "text": "Cowdry Type A inclusions are seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Herpes simplex"
      },
      {
        "id": 2,
        "text": "Rabies"
      },
      {
        "id": 3,
        "text": "Molluscum contagiosum"
      },
      {
        "id": 4,
        "text": "Adenovirus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cowdry type A </strong>inclusions are seen in the vesicles of <strong>Herpes Simplex infection&nbsp;</strong></p>\n<p>The classic Cowdry type A inclusion appears as a light purple, homogeneous <strong>intranuclear</strong> <strong>structure</strong> surrounded by a <strong>clear halo</strong>. The inclusions stain with antibodies to HSV, permitting a rapid, specific diagnosis of HSV infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bb5ebf2e6424f1ca1e40c95cb94e659x510x499.GIF"
    ]
  },
  {
    "text": "A 13-year-old girl has had 4 episodes of meningitis over the last 4 years, with the disease lasting a few days at a time, leaving slowly resolving neurological symptoms such as visual and memory loss. A CSF cytology shows lymphocytic pleocytosis and a diagnosis of Mollaret\u2019s meningitis is made. Which organism is implicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Measles virus"
      },
      {
        "id": 2,
        "text": "Mumps virus"
      },
      {
        "id": 3,
        "text": "Herpes simplex virus"
      },
      {
        "id": 4,
        "text": "Rubella virus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Mollaret&rsquo;s meningitis</strong>&nbsp;or&nbsp;benign recurrent lymphocytic meningitis&nbsp;is most commonly caused by the&nbsp;<strong>herpes simplex virus</strong> (<strong>HSV</strong>).&nbsp;Demonstration of <strong>HSV antibodies</strong> in CSF or persistence of HSV DNA in CSF can establish the diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A dentist presents to the surgery OPD with the findings shown below. He is febrile. Microscopic examination of the tissue reveals Tzanck cells. What is the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Pox virus"
      },
      {
        "id": 2,
        "text": "Adenovirus"
      },
      {
        "id": 3,
        "text": "Picornavirus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Diagnosis of herpes simplex virus:</p>\n<ul>\n<li><strong>Most sensitive </strong>test-<strong>&nbsp;HSV DNA- PCR&nbsp;</strong>(can differentiate between HSV 1 and 2)</li>\n<li><strong>Most definitive </strong>test-<strong><strong>&nbsp;virus isolation using&nbsp;</strong></strong>human diploid fibroblast in which cytopathic changes can be observed as early as 24 - 48 hours.</li>\n<li>Microscopy - Tzanck smear is prepared by Wright or Giemsa stain. <strong>Intranuclear type A</strong> inclusion bodies may be seen in Giemsa-stained smears.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b175172a8a9b4728bb5e10b1df2476af.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58b89681312d4be080c0ed8741576282x510x460.GIF"
    ]
  },
  {
    "text": "A young male presents to the STD clinic with painful lesions as shown in the image. What is the most likely microscopic finding of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Tzank cells"
      },
      {
        "id": 2,
        "text": "Pund cells"
      },
      {
        "id": 3,
        "text": "Henderson-Patterson bodies"
      },
      {
        "id": 4,
        "text": "Guarnieri bodies"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Clusters</strong> of <strong>vesicles</strong> are seen on an <strong>erythematous base</strong> along with painful and pruritic lymphadenopathy suggest a diagnosis of&nbsp;<strong>genital herpes.&nbsp;</strong><strong>Tzanck cells</strong> or multinucleated giant cells are present on microscopy.</p>\n<p>The Tzanck smear is a rapid, sensitive, and inexpensive diagnostic method.&nbsp; Smears are prepared from the lesions, from the <strong>base</strong> of vesicles, and stained with a 1% aqueous solution of<strong>&nbsp;O-toluidine blue </strong>for 15 seconds. <strong>Multinucleated giant cells</strong> with <strong>faceted nuclei</strong> and homogeneously stained<strong>&nbsp;ground glass chromatin -&nbsp;</strong>&nbsp;<strong>Tzanck cells&nbsp;</strong>are seen.</p>\n<p>The typical herpes lesions are <strong>thin-walled, umbilicated vesicles,</strong> the roof of which breaks down, leaving tiny superficial <strong>ulcers.</strong> They heal without scarring.&nbsp;The most common site of cutaneous lesions in the face - on the cheeks, chin, around the mouth, or on the forehead.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49a4c88ed515471590b7045acf046d9b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98e87950f6db446582d5731227815c88x510x460.GIF"
    ]
  },
  {
    "text": "Your neighbor\u2019s child complains of fever and develops a rash. On examination, the rashes are present all over the body, and look like \u2018dewdrops lying on the skin\u2019. The child says that his friend in school had similar complaints a few days ago. Which of the given statements is true about this rash?",
    "choices": [
      {
        "id": 1,
        "text": "It is centripetal in distribution"
      },
      {
        "id": 2,
        "text": "The rash usually starts on the distal parts of limbs"
      },
      {
        "id": 3,
        "text": "All the lesions are of same age"
      },
      {
        "id": 4,
        "text": "Scabs are also infectious in chicken pox"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The condition described here is <strong>chickenpox.</strong> It is caused by the <strong>varicella-zoster</strong>&nbsp;<strong>virus. </strong>The following are the characteristics of rash seen in chicken pox :</p>\n<ul>\n<li>The rash is <strong>centripetal</strong> in distribution.&nbsp;</li>\n<li>It evolves rapidly, progressing through <strong>macule, papule, vesicle, pustule,</strong> and finally <strong>scab.</strong></li>\n<li>It is a <strong>pleomorphic</strong> rash and appears in crops, hence varying stages&nbsp;of lesions can be noticed at a given time.</li>\n<li>The lesions resemble a <strong>dewdrop lying on the skin</strong>, as they are <strong>superficial</strong> and do not involve the deeper layers of the skin.</li>\n</ul>\n<p><strong>&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7882dbb84f28498490140ab48ee62c84x525x599.JPEG"
    ]
  },
  {
    "text": "While on rounds in the NICU, you notice a newborn baby with a zig-zag dermatomal cicatrix on the forehead and left side of the face. The limbs are small and atrophied. Microcephaly is noted. Which maternal infection are these findings characteristically associated with?",
    "choices": [
      {
        "id": 1,
        "text": "Toxoplasma"
      },
      {
        "id": 2,
        "text": "Cytomegalovirus"
      },
      {
        "id": 3,
        "text": "Varicella zoster virus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus type - 1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">The given clinical scenario is suggestive of&nbsp;<strong>congenital varicella syndrome</strong>. Hence, an&nbsp;<strong>antenatal history</strong>&nbsp;of&nbsp;<strong>varicella</strong>&nbsp;<strong>zoster</strong>&nbsp;<strong>virus</strong> (VZV) infection would be significant in the mother of this baby.</p>\n<p><strong>Fetal varicella infection&nbsp;</strong>occurs if the mother gets infected during the&nbsp;<strong>first half of pregnancy.</strong></p>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Clinical features include:</p>\n<ul>\n<li><strong>Cicatrix</strong>, a zigzag scarring in a dermatomal distribution</li>\n<li>Microphthalmia</li>\n<li>Cataracts</li>\n<li>Optic atrophy</li>\n<li>Chorioretinitis</li>\n<li><strong>Microcephaly</strong></li>\n<li><strong>Limb hypoplasia</strong></li>\n<li>Motor and sensory deficits</li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the predominant pathogen to infect renal transplant recipients one to four months following transplantation?",
    "choices": [
      {
        "id": 1,
        "text": "Cytomegalovirus"
      },
      {
        "id": 2,
        "text": "JC virus"
      },
      {
        "id": 3,
        "text": "BK virus"
      },
      {
        "id": 4,
        "text": "Epstein-Barr virus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The predominant pathogen to <strong>infect</strong> <strong>renal transplant recipients</strong> in the period around <strong>1 to 4 months</strong> following the transplantation&nbsp;is <strong>cytomegalovirus (CMV)</strong>.</p>\n<p class=\"p1\">The most common CMV presentation in kidney transplant patients are fever (common), leukopenia, hepatosplenomegaly, myalgia,&nbsp;and arthralgia.&nbsp;</p>\n<p class=\"p1\">JC virus and BK virus are common infections after solid organ transplantation based on the site of infection. This means <strong>BK and JC viruses</strong> are the most common organisms to<strong> infect the kidney</strong> after <strong>any solid organ transplant</strong>. But&nbsp;<strong>CMV</strong> is the predominant organism to <strong>cause infection in a person who has undergone a renal transplant.</strong> (Not the most common organism to affect the kidney after any solid organ transplant).&nbsp;</p>\n<div class=\"page\" title=\"Page 1184\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Because of the frequency and severity of CMV disease, antiviral <strong>prophylaxis</strong> with ganciclovir or valganciclovir is being used&nbsp;in <strong>renal transplan</strong>t recipients whenever indicated to<strong> prevent CMV disease</strong>.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant is brought by his worried parents with a rash and yellowish discoloration of the skin. On examination, the baby has petechiae, jaundice, hepatosplenomegaly, and microcephaly. The developmental assessment shows global developmental delay. An axial cut of the non-contrast CT of the brain is given below. What is the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Rubella"
      },
      {
        "id": 2,
        "text": "Herpes simplex virus"
      },
      {
        "id": 3,
        "text": "Cytomegalovirus"
      },
      {
        "id": 4,
        "text": "Varicella"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>&nbsp;</p>\n<p>Option A: <strong>Congenital rubella syndrome</strong> is a triad of cardiac defects, cataracts,&nbsp;and congenital&nbsp;hearing loss.</p>\n<p>Option B: Neonatal <strong>herpes</strong> presents as skin lesions with eye involvement, encephalitis, and disseminated disease.</p>\n<p>Option D: <strong>Fetal</strong> <strong>varicella</strong> <strong>syndrome</strong>&nbsp;is manifested as cicatrizing/scarring skin lesions, chorioretinitis, hypoplastic limbs, low birth weight, and CNS defects due to cerebral atrophy.</p>\n<p><strong>Note:</strong> In 15-20% of infants with congenital CMV infection, microcephaly is not detected at birth. It may develop as the child grows and is detected at follow-up visits for other complaints.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cb0e4c8cadd748eb8a57948e98a5f829.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96932f1d92dc460f968d69a1c8c0fb12x1280x1243.JPEG"
    ]
  },
  {
    "text": "Choose the correct statement regarding CMV.",
    "choices": [
      {
        "id": 1,
        "text": "Ganciclovir resistance is due to mutation in UL97 phosphotransferase gene"
      },
      {
        "id": 2,
        "text": "CMV can be cultured in vitro in any mammalian cell"
      },
      {
        "id": 3,
        "text": "Commonest manifestation of CMV associated disease is watery diarrhea"
      },
      {
        "id": 4,
        "text": "UL54 mutated CMV strains do not show cross resistance to Foscarnet"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Resistance</strong> to <strong>ganciclovir</strong> most commonly occurs due to<strong> mutations</strong> in the<strong> UL97 phosphotransferase gene.&nbsp;</strong></p>\n<p>Option B: Human CMV replicates in vitro <strong>only in human fibroblasts</strong>, although the virus is often isolated from epithelial cells of the host.</p>\n<p>Option C: CMV infection is mostly <strong>subclinical.</strong></p>\n<p>Option D: UL54 mutations can confer resistance to ganciclovir, cidofovir, and foscarnet.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where are owl's eye inclusion bodies seen?",
    "choices": [
      {
        "id": 1,
        "text": "Yellow fever"
      },
      {
        "id": 2,
        "text": "Cytomegalovirus"
      },
      {
        "id": 3,
        "text": "Adenovirus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Owl&rsquo;s eye inclusion bodies</strong> are intranuclear basophilic inclusion bodies seen in <strong>CMV</strong> infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7f8eca580cf425b8dde6c1454b276b4x510x480.GIF"
    ]
  },
  {
    "text": "What does the Paul-Bunnell test diagnose?",
    "choices": [
      {
        "id": 1,
        "text": "Kissing disease"
      },
      {
        "id": 2,
        "text": "Hand-foot-and-mouth disease"
      },
      {
        "id": 3,
        "text": "Barlow's disease"
      },
      {
        "id": 4,
        "text": "Fifth disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Paul-Bunnell</strong> test is used to diagnose <strong>kissing disease</strong> (infectious mononucleosis) caused by <strong>Epstein&ndash;Barr virus</strong> (EBV).</p>\n<p>It&nbsp;is <strong>a heterophile agglutination test</strong> used to identify the heterophile antibodies that agglutinate sheep erythrocytes. Patients suffering from <strong>infectious</strong> <strong>mononucleosis</strong> due to Epstein&ndash;Barr virus (<strong>EBV</strong>) will produce antibodies that will react and agglutinate <strong>sheep</strong> <strong>erythrocytes.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are studying the association of human herpesvirus-4 with other diseases. Which of the following patients have diseases associated with this virus?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 5 only"
      },
      {
        "id": 2,
        "text": "2, 3 and 4"
      },
      {
        "id": 3,
        "text": "3 and 4 only"
      },
      {
        "id": 4,
        "text": "1, 2 and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Human herpesvirus-4</strong> or <strong>Epstein-Barr virus</strong>&nbsp;causes <strong>infectious mononucleosis, Burkitt&rsquo;s lymphoma,</strong> and is associated with <strong>oral hairy leukoplakia</strong> in HIV patients.&nbsp;</p>\n<p>EBV may cause the following malignancies:</p>\n<ul>\n<li><strong>Burkitt&rsquo;s</strong> lymphoma</li>\n<li><strong>Nasopharyngeal carcinoma</strong> (in people of Chinese origin),</li>\n<li>Lymphomas in immunodeficient persons such as <strong>AIDS</strong> or transplant recipients.</li>\n</ul>\n<p>Endemic or African Burkitt's lymphoma has got nearly 100% association with EBV, as compared to non-endemic and HIV-associated Burkitt's lymphoma.&nbsp;</p>\n<p>Oral hairy leukoplakia is triggered by EBV in patients with poor immune status, most commonly with HIV.&nbsp;</p>\n<p>Oral submucous fibrosis is associated with the human papillomavirus (HPV).&nbsp;</p>\n<p>Adult T cell leukemia is associated with the human T-cell leukemia virus.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following viruses is known to cause hemorrhagic cystitis, diarrhea, and conjunctivitis?",
    "choices": [
      {
        "id": 1,
        "text": "RSV"
      },
      {
        "id": 2,
        "text": "Adenovirus"
      },
      {
        "id": 3,
        "text": "Rhinovirus"
      },
      {
        "id": 4,
        "text": "Rotavirus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Adenovirus</strong> is known to cause hemorrhagic cystitis, diarrhea, and conjunctivitis.</p>\n<p><strong>Acute hemorrhagic cystitis</strong> in children is caused by adenoviruses <strong>types 11 and 21.</strong></p>\n<p>The following table shows various syndromes caused by adenoviruses and associated serotypes:</p>\n<table style=\"height: 113px;\" width=\"419\">\n<tbody>\n<tr>\n<td style=\"width: 201.6px; text-align: center;\"><strong>Syndrome</strong></td>\n<td style=\"width: 202.4px; text-align: center;\"><strong>Adenovirus serotypes</strong></td>\n</tr>\n<tr>\n<td style=\"width: 201.6px; text-align: left;\">Respiratory disease in children</td>\n<td style=\"width: 202.4px; text-align: left;\">1, 2, 5, 6</td>\n</tr>\n<tr>\n<td style=\"width: 201.6px; text-align: left;\">Sore throat, febrile cold, pneumonia</td>\n<td style=\"width: 202.4px; text-align: left;\">3, 4, 7, 14, 21</td>\n</tr>\n<tr>\n<td style=\"width: 201.6px; text-align: left;\">ARD in military recruits</td>\n<td style=\"width: 202.4px; text-align: left;\">4, 7, 21</td>\n</tr>\n<tr>\n<td style=\"width: 201.6px; text-align: left;\">Follicular (swimming pool) conjunctivitis/ Pharyngoconjunctival fever</td>\n<td style=\"width: 202.4px; text-align: left;\">3, 7</td>\n</tr>\n<tr>\n<td style=\"width: 201.6px; text-align: left;\">Epidemic keratoconjunctivitis (shipyard eye)</td>\n<td style=\"width: 202.4px; text-align: left;\">8, 19, 37</td>\n</tr>\n<tr>\n<td style=\"width: 201.6px; text-align: left;\">Diarrhea</td>\n<td style=\"width: 202.4px; text-align: left;\">40, 41</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Viral infection mimicking erythroblastosis fetalis is:",
    "choices": [
      {
        "id": 1,
        "text": "HSV"
      },
      {
        "id": 2,
        "text": "Epstein-Barr virus"
      },
      {
        "id": 3,
        "text": "Picornavirus"
      },
      {
        "id": 4,
        "text": "Parvovirus B19"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Parvovirus</strong> <strong>B19 infection</strong> mimics <strong>erythroblastosis fetalis.</strong>&nbsp;</p>\n<p>Parvovirus B19 is associated with:&nbsp;</p>\n<ol>\n<li>Erythema infectiosum (fifth disease)</li>\n<li>Transient aplastic crisis</li>\n<li>Pure red cell aplasia</li>\n<li>Erythroblastosis&nbsp;fetalis (most commonly in early pregnancy)</li>\n</ol>\n<p>Picornavirus, Epstein-Barr virus, HSV infection do not mimic erythroblastosis fetalis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which organism causes the disease shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Roseola virus"
      },
      {
        "id": 2,
        "text": "Parvovirus B19"
      },
      {
        "id": 3,
        "text": "Rubella virus"
      },
      {
        "id": 4,
        "text": "Rubeola virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image showed a rash on the cheeks and face, with a slapped cheek appearance, characteristic of <strong>erythema infectiosum/&nbsp;fifth disease.&nbsp;</strong>It&nbsp;is caused by <strong>Parvovirus B19.</strong></p>\n<p>Parvovirus B19 usually presents as a&nbsp;<strong>respiratory infection,</strong> with an erythematous maculopapular<strong> rash</strong> and <strong>arthralgia</strong>. The rash&nbsp;starts as prominent erythema of the cheek, popularly known as <strong>slapped-cheek appearance. </strong>The rash&nbsp;further spreads&nbsp;to the trunk and limbs followed by lymphadenopathy and arthralgia.</p>\n<p>It induces <strong>aplastic crisis</strong> in sickle cell anemia patients.</p>\n<p>Infection during&nbsp;pregnancy leads to non-immune fetal hydrops (highest risk in the first half of gestational period).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a8926fe00b824457a0157d285fab223e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child presents with skin lesions, suspected to be molluscum contagiosum. How is the diagnosis of this condition typically made?",
    "choices": [
      {
        "id": 1,
        "text": "Viral Culture"
      },
      {
        "id": 2,
        "text": "Skin biopsy"
      },
      {
        "id": 3,
        "text": "PCR for Viral DNA"
      },
      {
        "id": 4,
        "text": "Clinical appearance"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option B: Skin biopsy or smear of expressed material shows characteristic inclusion bodies but is necessary only when the<strong> diagnosis is uncertain</strong>.</p>\n<p>Options A and C: Viral culture and PCR for viral DNA are not used for diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d0e3284b95554515aaeaf94a3d30b634x400x327.JPEG"
    ]
  },
  {
    "text": "What is the causative organism of the condition shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Treponema pallidum"
      },
      {
        "id": 2,
        "text": "Human papillomavirus 6 and 11"
      },
      {
        "id": 3,
        "text": "Human papillomavirus 16 and 18"
      },
      {
        "id": 4,
        "text": "Hemophilus ducreyi"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option C:&nbsp;<strong>Human papillomavirus</strong>&nbsp;<strong>16</strong> and <strong>18</strong> are associated with carcinoma of the cervix and anogenital region.</p>\n<p>Option D:<strong>&nbsp;<em>Hemophilus ducreyi</em></strong> causes chancroid. Given below is the image of chancroid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ac3ca39e86564c9c9ae5d2d20e48dfd3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/549a7e76325a4cfe90d431fc9f39f2f1x1053x842.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/840612835c7b48dea1e2ffa29dedda79x247x199.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7a17485596ac463ca54ab653df5c7faax720x377.JPEG"
    ]
  },
  {
    "text": "A patient presents with plantar warts as shown below. Which type of human papillomavirus is responsible for causing these?",
    "choices": [
      {
        "id": 1,
        "text": "6"
      },
      {
        "id": 2,
        "text": "11"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "7"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>HPV types 1a, 57, and 27</strong> accounts for most&nbsp;<strong>plantar warts.</strong></p>\n<p><strong>HPV 7</strong> causes hand warts in butchers (butcher's warts).</p>\n<p><strong>HPV 6 and 11</strong> cause condyloma acuminata, sinonasal papilloma, and squamous papilloma of the larynx.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4087abc46e8d435787884500a1942c37.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "As a CHC medical officer, you organize an outreach program for HPV vaccination and the prevention of cervical cancer. Which protein is used for antigenic response in this vaccine?",
    "choices": [
      {
        "id": 1,
        "text": "E6, E7"
      },
      {
        "id": 2,
        "text": "L1"
      },
      {
        "id": 3,
        "text": "E1, E2"
      },
      {
        "id": 4,
        "text": "L2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<table style=\"height: 128px; width: 310px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 149.659px; text-align: center; height: 18px;\"><strong>HPV Vaccine&nbsp;</strong></td>\n<td style=\"width: 145.114px; text-align: center; height: 18px;\"><strong>Types</strong></td>\n</tr>\n<tr style=\"height: 3.12784px;\">\n<td style=\"width: 149.659px; text-align: center; height: 3.12784px;\">Quadrivalent (<strong>Gardasil)</strong></td>\n<td style=\"width: 145.114px; text-align: center; height: 3.12784px;\">\n<p>6, 11,&nbsp;16, 18</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 149.659px; text-align: center; height: 18px;\">Bivalent (<strong>Cervarix)</strong></td>\n<td style=\"width: 145.114px; text-align: center; height: 18px;\">16, 18</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 149.659px; text-align: center; height: 36px;\">Nonavalent (<strong>Gardasil-9)</strong></td>\n<td style=\"width: 145.114px; text-align: center; height: 36px;\">6, 11, 16, 18, 31, 33, 45, 52, 58</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Nonavalent HPV vaccine works against which of the following strains of the virus?",
    "choices": [
      {
        "id": 1,
        "text": "1, 6, 11, 16, 18, 31, 45, 52, 58"
      },
      {
        "id": 2,
        "text": "6, 11, 16, 18, 31, 33, 45, 52, 58"
      },
      {
        "id": 3,
        "text": "1, 16, 18, 21, 33, 45, 48, 52, 58"
      },
      {
        "id": 4,
        "text": "6, 11, 16, 18, 33, 45, 48, 52, 58"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>The <strong>nonavalent HPV vaccine</strong> works against strains <strong>6, 11, 16, 18, 31, 33, 45, 52 and 58</strong>. It is usually commercialized in the name of&nbsp;<strong>Gardasil-9.&nbsp;</strong>It has received expanded indication which now includes the prevention of oropharyngeal and other head and neck cancers.&nbsp;</p>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<table style=\"width: 390.734px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; height: 18px; width: 141px;\"><strong>HPV Vaccine&nbsp;</strong></td>\n<td style=\"text-align: center; height: 18px; width: 231.734px;\"><strong>Types</strong></td>\n</tr>\n<tr style=\"height: 53.9375px;\">\n<td style=\"text-align: center; height: 53.9375px; width: 141px;\">\n<p>Quadrivalent (<strong>Gardasil)</strong></p>\n</td>\n<td style=\"text-align: center; height: 53.9375px; width: 231.734px;\">\n<p>6, 11,&nbsp;16, 18</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; height: 18px; width: 141px;\">Bivalent (<strong>Cervarix)</strong></td>\n<td style=\"text-align: center; height: 18px; width: 231.734px;\">16, 18</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; height: 18px; width: 141px;\">Nonavalent (<strong>Gardasil-9)</strong></td>\n<td style=\"text-align: center; height: 18px; width: 231.734px;\">6, 11, 16, 18, 31, 33, 45, 52, 58</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An HIV-positive patient presents with the following skin lesions. Which of the following diseases is associated with the virus implicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Post-transplant lymphoproliferative disease"
      },
      {
        "id": 2,
        "text": "Merkel cell carcinoma"
      },
      {
        "id": 3,
        "text": "Adult T-cell leukemia"
      },
      {
        "id": 4,
        "text": "Primary effusion lymphoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image showing red-purple macules and plaques in an HIV-positive patient is suggestive of <strong>Kaposi</strong> <strong>sarcoma, </strong>caused by <strong>human herpesvirus 8</strong>.&nbsp;It also causes <strong>primary effusion lymphoma.</strong>&nbsp;It is one of seven currently known human cancer viruses or <strong>oncoviruses</strong>.</p>\n<p>&nbsp;HHV-8 or <strong>Kaposi&rsquo;s sarcoma-associated herpesvirus (KSHV)&nbsp;</strong>is known to cause Kaposi&rsquo;s sarcoma, in immunocompromised persons.&nbsp;Cancer patients receiving chemotherapy, AIDS patients, and organ transplant recipients are all at a high risk of showing signs of infection.</p>\n<p><strong>KSHV</strong> is a known causative agent of <strong>four diseases</strong>:</p>\n<ol>\n<li>Kaposi's sarcoma</li>\n<li>KSHV-associated multicentric Castleman's disease (MCD)</li>\n<li>Primary effusion lymphoma</li>\n<li>KSHV inflammatory cytokine syndrome&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fece6b7ec1014a0383a9e26eceda6e32.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following viruses is implicated in progressive multifocal leukoencephalopathy?",
    "choices": [
      {
        "id": 1,
        "text": "JC virus"
      },
      {
        "id": 2,
        "text": "BK virus"
      },
      {
        "id": 3,
        "text": "Measles virus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Progressive multifocal leukoencephalopathy</strong> is caused by the&nbsp;<strong>JC virus.</strong>&nbsp;JC&nbsp;virus-induced&nbsp;progressive multifocal leukoencephalopathy is one of the neurologic diseases associated with <strong>HIV infection</strong>.</p>\n<p>Option B: BK virus is associated with nephropathy in transplant recipients.</p>\n<p>Option C: The&nbsp;long-term sequelae associated with measles infection is&nbsp;subacute sclerosing panencephalitis.</p>\n<p>Option D: Herpes simplex virus causes temporal lobe encephalitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '22 Dna Viruses';
        const quizFilename = '22-dna-viruses-ad17367c.html';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>