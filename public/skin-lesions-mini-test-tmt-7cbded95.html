<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skin Lesions Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Match the following skin lesions with their most suitable clinical descriptions.",
    "choices": [
      {
        "id": 1,
        "text": "1-C, 2-D, 3-B, 4-A"
      },
      {
        "id": 2,
        "text": "1-D, 2-C, 3-B, 4-A"
      },
      {
        "id": 3,
        "text": "1-C, 2-D, 3-A, 4-B"
      },
      {
        "id": 4,
        "text": "1-C, 2-B, 3-D, 4-A"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct match is option A: <strong>1-C, 2-D, 3-B, 4-A</strong></p>\n<p>Image 1 shows a <strong>psoriatic plaque</strong>\u00a0which is shaped as a\u00a0<strong>filled circular</strong> lesion. This is known as <strong>nummular</strong>\u00a0<strong>shape</strong>.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8555582e4cb04c458c0824b558eeee12.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17e57e9de0ce46bba69d19f5518c85bex720x720.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a117c850432b4a43be2f9f9ba44b6ea1x720x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a73c4e105cc64bce8b234e39470c6c41x930x768.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61b4cb4169d44a768e70b2b689c8d357x720x960.JPEG"
    ]
  },
  {
    "text": "Which of the following is a secondary skin lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Image A"
      },
      {
        "id": 2,
        "text": "Image B"
      },
      {
        "id": 3,
        "text": "Image C"
      },
      {
        "id": 4,
        "text": "Image D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Image C</strong> represents <strong>crust lesions,</strong> which are <strong>secondary</strong> <strong>skin lesions.</strong></p>\n<div class=\"page\" title=\"Page 116\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The crust is a collection of<strong> </strong>inflammatory cells<strong>,</strong> red blood cells, plasma, and fibrin in the <strong>superficial portion</strong> <strong>of the epidermis.</strong></p>\n<p>Other options:</p>\n<p>Image A shows <strong>purpura.</strong></p>\n<p>Image B shows a <strong>bulla.</strong></p>\n<p>Image D shows a\u00a0<strong>pustule.</strong></p>\n<p>The following image shows the classification of skin lesions:</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e3d8680bd52b4b6dabd9eb08a1be8fbd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5567b789d0714fb786c5d0d93116ee08x1280x6447.JPEG"
    ]
  },
  {
    "text": "Which of the following diseases is unlikely to present with skin lesions on the shin?",
    "choices": [
      {
        "id": 1,
        "text": "Sarcoidosis"
      },
      {
        "id": 2,
        "text": "Diabetes"
      },
      {
        "id": 3,
        "text": "Hyperthyroidism"
      },
      {
        "id": 4,
        "text": "Hypothyroidism"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hypothyroidism</strong>\u00a0is unlikely to present with skin lesions on shin.\u00a0<strong>Myxedema\u00a0</strong>(severe <strong>hypothyroidism</strong>) and <strong>pretibial myxedema</strong> are different entities. <strong>Pretibial myxedema </strong>is the infiltrative dermopathy (mucin deposition) seen over shin in <strong>Grave's disease</strong>, a type of <strong>hyperthyroidism</strong>.\u00a0</p>\n<p>Other options :</p>\n<p>Option B: <strong>Diabetes</strong>: Necrobiosis lipoidica diabeticorum is classically seen on the anterior leg.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/105b2f830cca4a4394a3356ee8465e9ex1280x1675.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d55d9337fb3646fb8382a7e0b9fdb41ex640x465.JPEG"
    ]
  },
  {
    "text": "The following skin lesion is caused by ___________",
    "choices": [
      {
        "id": 1,
        "text": "Trichophyton verrucosum"
      },
      {
        "id": 2,
        "text": "Microsporum ferrugineum"
      },
      {
        "id": 3,
        "text": "Trichophyton concentricum"
      },
      {
        "id": 4,
        "text": "Hypersensitivity to Herpes Simplex virus infection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows numerous <strong>concentric rings</strong> indicative of\u00a0<strong>Tinea imbricata</strong>, resulting from infection by <strong><em>Trichophyton concentricum</em>.</strong></p>\n<p>The lesion presents as\u00a0a scaling ring; centrifugal spread follows, but within the area of central clearing a <strong>second wave of scaling</strong> soon arises. The process is repeated to give numerous concentric rings.\u00a0<strong>Pruritus</strong> is intense and may lead to <strong>lichenification</strong>.\u00a0<strong>Hypopigmentation</strong> may accompany the lesions. It is restricted to the natives of southern Asia, the islands of the South Pacific, Guatemala, southern Mexico and Brazil.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9c60a92320a04b4cac73532dd83c85b2.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Migratory necrolytic skin rash is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Somatostatinoma"
      },
      {
        "id": 2,
        "text": "VIPoma"
      },
      {
        "id": 3,
        "text": "Glucagonoma"
      },
      {
        "id": 4,
        "text": "ACTHoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Glucagonoma, </strong>a neuroendocrine tumor of the pancreas presents with <strong>migratory necrolytic skin rash</strong>.</p>\n<p>Glucagonoma is a rare syndrome, with a classic presentation of the \u201c4 D\u2019s\u201d: <strong>diabetes, dermatitis, deep vein thrombosis(positive</strong> Homan\u2019s sign and Moses Sign is suggestive of DVT), and <strong>depression.</strong></p>\n<p><strong>Necrolytic migrating erythema/skin rash</strong> is a characteristic skin lesion seen in <strong>glucagonoma</strong> patients usually before the appearance of other symptoms It is thought to be caused by <strong>low levels of amino acids. </strong>Therefore parenteral administration of amino acids was found to result in the disappearance of the skin lesions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/262c033758b54360be5abbc2342d08e8x720x468.PNG"
    ]
  },
  {
    "text": "A patient presents with the following skin lesion. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Erysipelas"
      },
      {
        "id": 2,
        "text": "Staphylococcal scalded skin syndrome"
      },
      {
        "id": 3,
        "text": "Necrotizing fasciitis"
      },
      {
        "id": 4,
        "text": "Gas gangrene"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a skin lesion that is <strong>red, edematous,</strong> and <strong>well-demarcated</strong> from the surrounding skin. These features are suggestive of\u00a0<strong>erysipelas</strong>.\u00a0</p>\n<p>Erysipelas is a skin infection involving <strong>superficial lymphatics.</strong> It is caused by <strong>streptococcus.</strong> It presents as erythematous, indurated, and inflamed skin lesions.</p>\n<p>Other options:</p>\n<p>Option B: Staphylococcal scalded skin syndrome is caused by the <strong>exfoliative toxin</strong> and presents with <strong>peeling</strong> of the <strong>affected</strong> skin.</p>\n<p>Option C: <strong>Necrotizing fasciitis</strong> is a streptococcal infection involving the <strong>fascial planes.</strong> The lesions show dark areas of necrosis along with erythema.</p>\n<p>Option D: <strong>Gas gangrene</strong> is a form of <strong>myonecrosis.</strong> It is a bacterial infection in which tissue gas is produced in gangrene. It is usually caused by Clostridium perfringens. The given image of gas gangrene shows necrotic bullae, erythema, and edema:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c06164be5e8e45fa8056b2372fbfd576.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0796290e7af7482e9fa33fd939eb5f22x1200x960.JPEG"
    ]
  },
  {
    "text": "A 10-year-old child is brought to your OPD with lesions as shown below. The parent says he also had similar lesions in childhood. The lesions are present on the forearm, face, and flexures and are very itchy on the background of dry skin showing signs of lichenification. Grattage test or scratching reveals oozing of serous fluid. What could be the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lichen simplex chronicus"
      },
      {
        "id": 2,
        "text": "Psoriasis"
      },
      {
        "id": 3,
        "text": "Atopic dermatitis"
      },
      {
        "id": 4,
        "text": "Scabies with suppuration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Image showing <strong>eczematous lesions</strong> on the forearm, and flexures. This along with the history of them being very <strong>itchy</strong> and being located on the dry skin showing signs of <strong>lichenification</strong> and a <strong>grattage test </strong>revealing<strong> oozing of serous fluid</strong> points towards <strong>atopic dermatitis</strong> as the likely diagnosis.</p>\n<p>Atopic dermatitis can be divided into 3 phases: Infantile, childhood, and adult phases.</p>\n<p><strong>Infantile phase:\u00a0</strong>The lesions of Atopic Eczema most frequently start on the<strong> face</strong> but may occur anywhere on the skin surface. Often, the <strong>napkin area</strong> is relatively <strong>spared.</strong></p>\n<ul>\n<li>When the child begins to crawl, the exposed surfaces, <strong>especially the extensor aspect of the knees and elbows</strong> are most involved.</li>\n<li>The lesions consist of<strong> erythema</strong> and discrete or confluent <strong>oedematous papules</strong>. The papules are <strong>intensely itchy\u00a0</strong>and may become exudative and crusted as a result of rubbing.</li>\n<li>Secondary infection and lymphadenopathy are common.</li>\n</ul>\n<p><strong>Childhood Phase</strong>:\u00a0From 18 to 24 months onwards, the sites most characteristically involved are the<strong> elbow and knee flexures</strong>, a mixture of erythema, crusting, <strong>excoriation</strong>, hyper\u2010 and hypopigmentation, and <strong>warty lichenification</strong> may be seen depending on the skin type on the sides of the neck, wrists, and ankles.</p>\n<ul>\n<li>The sides of the neck may show a striking <strong>reticulate pigmentation</strong>, sometimes referred to as <strong>atopic dirty neck</strong>.</li>\n<li>The erythematous and oedematous papules tend to be replaced by<strong> lichenification</strong>.</li>\n</ul>\n<p><strong>Adult Phase:</strong> The picture is essentially similar to that in later childhood, with lichenification, especially of the <strong>flexures and hands</strong>.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Lichen simplex chronicus</strong> usually presents as an <strong>itchy plaque.</strong> Chronic itching produces secondary lichenification. It may be associated with the history of atopy. It is less likely to appear as oozing on scratching. A predilection for flexural aspect in childhood as in this case is not classically seen.</p>\n<p>Option B:<strong> Psoriasis</strong> classically involves <strong>extensor aspect unlike flexures</strong> as in this child. Moreover, it is associated with silvery scaling and grattage reveals fresh bleeding points (Auspitz sign) and not oozing of serous fluid.</p>\n<p>Option D: <strong>Scabies</strong> is caused by <strong>itch mites</strong> laying eggs in burrows made in the skin. The burrows are visible as <strong>serpiginous erythematous lesions.</strong> It classically causes itching more during the evening and involves lesions in the circle of hebra unlike flexures as in this case.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9550ae01c71a40b0b0d5105bc7035da5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old baby was examined in a village camp. The child had a poor appetite and visible peripheral edema. The hair was sparse and easily pluckable. The skin showed peeling as depicted below.  What could be the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Marasmus"
      },
      {
        "id": 2,
        "text": "Pellagra"
      },
      {
        "id": 3,
        "text": "Vitamin A deficiency"
      },
      {
        "id": 4,
        "text": "Kwashiorkor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most probable diagnosis is <strong>kwashiorkor.\u00a0</strong>The above clinical vignette and the image showing\u00a0<strong>flaky paint dermatosis</strong>\u00a0are seen characteristically in kwashiorkor.</p>\n<p>Kwashiorkor results due to severe <strong>protein</strong> and essential amino acid deprivation along with <strong>adequate calorie intake</strong>. It is particularly seen in children at the time of weaning, to a diet consisting majorly of corn, rice, or beans.\u00a0</p>\n<p>The clinical features include a classic cutaneous finding of diffuse reddish-brown scaling dermatosis that has been likened to cracked skin,<strong> peeling paint</strong>, enamel paint, <strong>flaky paint</strong>, or crazy paving. This is due to the typical scaling and irregular fissuring.\u00a0Nails are thin and soft. Hairs are thin and sparse and display a <strong>flag sign</strong> consisting of alternative light and dark bands of hair.\u00a0The\u00a0consistent feature is the <strong>peripheral edema</strong> due to the associated <strong>hypoproteinaemia</strong>. Edema of the face results in <strong>moon facies</strong>.\u00a0<strong>Abdominal distention</strong> (pot belly)\u00a0is a feature and is due to hepatomegaly from increased fatty deposition due to a lack of available apolipoproteins.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Marasmus</strong> results due to global <strong>macro-nutrient deficiency</strong>, which leads to <strong>growth retardation</strong> with\u00a0<strong>&lt;60%</strong> of<strong> ideal body weight</strong>.<strong>\u00a0</strong>Loss of subcutaneous tissue, growth stunting, dyspigmentation, and desquamative changes are seen in these patients. Marasmus patients <strong>do not</strong> <strong>demonstrate hypoproteinaemia or edema</strong>. There is distension of the abdomen due to hypotonia of the abdominal musculature. These patients typically have <strong>wrinkled, loose, </strong>and <strong>dry skin</strong>. The hair and nails often grow slowly and may show brittleness. The hair falls out easily and often shows features of alopecia.</p>\n<p>Below is the image of a child with marasmus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/99c7efa73b1d44fe8483b6652ba3f856.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b09297ea159a40e38d22343d30966901x241x354.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e09dff74d1d4b4398e83562a6b1f38fx412x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0c2428be3e54ae8ad914fcd9f045d4bx283x169.PNG"
    ]
  },
  {
    "text": "Identify the skin lesions shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "A- Shingles, B-Molluscum contagiosum, C- Herpangina, D- Cutaneous larva migrans"
      },
      {
        "id": 2,
        "text": "A- Cutaneous larva migrans, B- Folliculitis, C- Molluscum contagiosum, D-Herpangina"
      },
      {
        "id": 3,
        "text": "A- Molluscum contagiosum, B- Herpangina, C- Cutaneous larva migrans, D- Folliculitis"
      },
      {
        "id": 4,
        "text": "A- Folliculitis, B-Shingles, C- Molluscum contagiosum, D- Cutaneous larva migrans"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct match is\u00a0<strong>A- Shingles, B-Molluscum contagiosum, C- Herpangina, D- Cutaneous larva migrans.</strong></p>\n<p><strong>Shingles or herpes zoster\u00a0</strong>consist of red papules, which later become vesicular and pustular. They are <strong>dermatomal</strong> in distribution.</p>\n<p>Below Image- Shingles</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1177b0dec98d47b2bd36bbf12d998c9a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db0a10f92bbe40338deebe1a3bff81aex720x453.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f7aa77def9548558b457f23f701c893x400x327.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/06ca6fe89d594521a3577c66e940604bx830x768.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f8cf402f68b4dcdab225fcbceb7d283x720x567.JPEG"
    ]
  },
  {
    "text": "A patient presents with itching around the periorbital region. Identify the given skin lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Guttate Psoriasis"
      },
      {
        "id": 2,
        "text": "Tinea corporis"
      },
      {
        "id": 3,
        "text": "Lichen Planus"
      },
      {
        "id": 4,
        "text": "Pityriasis Rosea"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This given image is of <strong>Lichen Planus dermatitis</strong> of the face.</p>\n<p>Typically the lesion shows firm, shiny, polygonal, papules with a red to violet color. On closer observation, tracers of <strong>thin white lines </strong>can be seen on the surface of the lesions (<strong>Wickham\u2019s striae</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80a97149907f4915960af9f26379db59.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 17-year-old girl presents with the following skin lesions. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acne vulgaris"
      },
      {
        "id": 2,
        "text": "Acne rosacea"
      },
      {
        "id": 3,
        "text": "Seborrheic dermatitis"
      },
      {
        "id": 4,
        "text": "Milia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows typical <strong>erythematous papules</strong> and<strong> nodules</strong> along with few <strong>whiteheads,</strong>\u00a0suggestive of<strong> acne vulgaris.</strong></p>\n<p><strong>Other options:</strong></p>\n<p>Option B: <strong>Acne rosacea</strong> is a disorder that appears mainly in people within <strong>30 to 50 years of age</strong>. The lesions are mainly present on the <strong>convexities</strong> <strong>of the face</strong> but don't lead to central crusting or scarring. It is followed by triggering factors such as sunlight exposure, emotional disturbances, spicy food, alcohol, etc.,</p>\n<p>Given below is an image showing acne rosacea:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/51ca4c1092d543b8bd38e802a62884b2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d50d73c22e64a3aae77eac573ef0b0dx720x524.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/681f37a3a3d946e897e6570766af0be7x1134x1324.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/142d9e6134a642e0a19f4e63259980cfx720x598.JPEG"
    ]
  },
  {
    "text": "Shown below is a skin lesion. Which of the following is not a criterion to assess its malignant potential?",
    "choices": [
      {
        "id": 1,
        "text": "Irregular border"
      },
      {
        "id": 2,
        "text": "Inhomogenous colour"
      },
      {
        "id": 3,
        "text": "Diameter >4 mm"
      },
      {
        "id": 4,
        "text": "Asymmetry"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shown above depicts a <strong>nevus. Diameter &gt;6 mm</strong> is the diagnostic clue for the transformation of a nevus to a <strong>melanoma</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/78aca27520a740c2979176e39a1fec7c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old boy developed skin lesions on his trunk and proximal portion of his arms, 10 days after he recovered from an episode of pharyngitis. The skin lesions are shown in the image below.  Which among the following are correct about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 3"
      },
      {
        "id": 2,
        "text": "2, 3 and 5"
      },
      {
        "id": 3,
        "text": "4 and 5"
      },
      {
        "id": 4,
        "text": "1, 3 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical stem of small, red, drop-like lesions on the trunk and arms (shown in the image) after an attack of pharyngitis is suggestive of <strong>Guttate psoriasis</strong>, and <strong>statements 2 and 3 are correct.</strong></p>\n<div class=\"page\" title=\"Page 1144\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Guttate psoriasis is a type of psoriasis occurring as a <strong>sudden onset shower of small lesions</strong> seen diffusely over the body, more on the trunk and proximal limbs.\u00a0It is more common in children and young adults, <strong>following infection with group A streptococcus</strong> and is often the first presentation of psoriasis. It can also occur as a flare-up in adults with plaque psoriasis that began in childhood.\u00a0It is linked to <strong>HLA\u2010C:06:02 </strong>(statement 2).</p>\n<p>Lesions usually resolve over about 3 months. Some patients with acute guttate psoriasis might develop plaque psoriasis in the future.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/41f42b2d51af4bd383b40aba0ab18adc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An HIV-positive patient presents with the following skin lesions. Identify the virus causing these lesions.",
    "choices": [
      {
        "id": 1,
        "text": "Human papilloma virus"
      },
      {
        "id": 2,
        "text": "Pox virus"
      },
      {
        "id": 3,
        "text": "Human herpes virus 7"
      },
      {
        "id": 4,
        "text": "Human herpes virus 8"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image showing red-purple macules and plaques in an<strong> HIV-positive patient</strong> is suggestive of <strong>Kaposi</strong> <strong>sarcoma</strong>, and is<strong>\u00a0</strong>caused by the\u00a0<strong>human herpes virus 8 </strong>(otherwise known as\u00a0<strong>Kaposi Sarcoma-associated Herpes Virus </strong>(KSHV) ).</p>\n<p>The sarcoma is a <strong>soft tissue carcinoma</strong> characterized by <strong>red papules</strong> and has a <strong>vascular origin</strong>. There are two forms of Kaposi sarcoma namely the sporadic form and the HIV-associated form. The latter form is more aggressive and involves the skin, gastrointestinal tract, and mucous membranes. The lesions are widespread and progressive in nature. They contain <strong>spindle cells</strong> that <strong>promote pro-inflammatory factors</strong> leading to the occurrence of malignancy.\u00a0</p>\n<p>HHV8 virus infiltrates B lymphocytes, macrophages, epithelial, and endothelial cells predisposing the patient to a number of malignancies.\u00a0<strong>KSHV</strong> is a known causative agent of <strong>four diseases</strong>:</p>\n<ol>\n<li>Kaposi's sarcoma</li>\n<li>KSHV-associated multicentric Castleman's disease (MCD)</li>\n<li>Primary effusion lymphoma</li>\n<li>KSHV inflammatory cytokine syndrome\u00a0</li>\n</ol>\n<p>It is one of the<strong> seven</strong> currently known human cancer viruses or\u00a0<strong>oncoviruses</strong>. The other oncoviruses include HBV (Hepatitis B virus), HTLV (Human T lymphotrophic virus), HCV (Hepatitis C virus), MCV (Merkel cell virus), EBV (Ebstein Barr virus), and HPV (Human papillomavirus).</p>\n<p>Other options:</p>\n<p>Option A: <strong>Human papilloma virus types 16 and 18</strong> cause <strong>cervical cancer</strong> due to mutations in the\u00a0RAS gene.</p>\n<p>Option B &amp; C: Pox virus and HHV 7 are <strong>not oncogenic viruses.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/556429b0c348488db0a76c5bfbbe00df.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The clinical picture and a biopsy from the skin lesion of a patient are shown below. This condition is associated with which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Langerhans cell histiocytosis"
      },
      {
        "id": 2,
        "text": "Benign fibrous histiocytoma"
      },
      {
        "id": 3,
        "text": "Mycosis fungoides"
      },
      {
        "id": 4,
        "text": "Mastocytosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical image shows diffuse erythema and scaling of the entire body surface (<strong>erythroderma</strong>) and histopathology shows the presence of lymphocytes in the epidermal cell layer (<strong>epidermotropism</strong>). This is suggestive of\u00a0<strong>S\u00e9zary</strong><strong> syndrome</strong> which is<strong> </strong>a disseminated and severe form of\u00a0<strong>mycosis fungoides </strong>(cutaneous T-cell lymphoma).</p>\n<p>Mycosis fungoides is\u00a0a <strong>cutaneous T-cell lymphoma</strong> (CD4+ T-cells) that presents in the skin. It remains localized to the skin for many years, but it may eventually evolve into a systemic lymphoma.</p>\n<p>The image of mycosis fungoides showing hallmark features - <strong>Sezary Lutzner cells</strong> showing <strong>epidermal infiltration (epidermotropism),</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f0c44ee8e18a490d82d71f1ba22ff760.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3c46783c4664406c81d7209f723855dbx1280x2049.JPEG"
    ]
  },
  {
    "text": "A 60-year-old diabetic female patient presents with progressive skin lesions, as shown in the image. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Squamous cell carcinoma"
      },
      {
        "id": 2,
        "text": "Basal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Discoid lupus eryhtematosus"
      },
      {
        "id": 4,
        "text": "Melasma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image above shows a\u00a0<strong>central ulcer\u00a0</strong>with<strong>\u00a0raised borders\u00a0</strong>and<strong>\u00a0</strong>rolled-out edges\u00a0(rodent ulcer) suggesting a diagnosis of\u00a0<strong>basal cell carcinoma</strong>.</p>\n<p>Basal cell carcinoma is a\u00a0<strong>slow-growing malignant tumor</strong>\u00a0with\u00a0<strong>locally invasive</strong>\u00a0characteristics. It affects the pilosebaceous skin.</p>\n<p><strong>Ultraviolet radiation</strong>\u00a0exposure is the\u00a0<strong>strongest predisposing</strong>\u00a0factor. Other risk factors include exposure to arsenic, coal tar, aromatic hydrocarbons, and ionizing radiation.\u00a0</p>\n<p>Basal cell carcinoma mainly affects <strong>elderly</strong>\u00a0or\u00a0<strong>middle-aged men</strong>\u00a0with excessive skin exposure, commonly in the age group of 40\u201380 y and in white-skinned people.</p>\n<p><strong>Macroscopically</strong>, it is categorized as localized and generalized.\u00a0<strong>Nodular, nodulocystic\u00a0</strong>(nodular and nodulocystic together account for 90% of basal cell carcinoma), pigmented, and nevoid are the localized cancers, while superficial multifocal and superficial spreading, infiltrative, and cicatrizing are the generalized types. The nodular type is described as\u00a0<strong>pearly</strong>\u00a0waxy\u00a0<strong>nodules</strong>\u00a0at the margins. A central depression (umbilication) or ulceration and rolled-out edges are characteristic of basal cell carcinoma.</p>\n<p>The below gross image shows\u00a0pearly, rolled-out borders suggestive of basal cell carcinoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f7f305aaf267404e83dc1b7209ce4b2d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a5f70a19ea9495894674d3b9581c4bfx720x761.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/526a9613bd5d4f59b4cdf695750d44c7x720x527.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e337d287aabe440599fa0778b316dd1bx720x533.PNG"
    ]
  },
  {
    "text": "A 35-year-old woman with history of sarcoidosis presents with skin lesions shown in the image below. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Acne rosacea"
      },
      {
        "id": 2,
        "text": "Lupus pernio"
      },
      {
        "id": 3,
        "text": "Heliotrope rash"
      },
      {
        "id": 4,
        "text": "Malar rash"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given condition is\u00a0<strong>lupus pernio\u00a0</strong>which\u00a0is a cutaneous manifestation of <strong>sarcoidosis</strong>.</p>\n<p><strong>Lupus pernio</strong> is a <strong>chronic inflammatory</strong> skin lesion, which is diagnostic for a <strong>chronic</strong> form of <strong>sarcoidosis.</strong> It involves the <strong>bridge</strong> of the <strong>nose,</strong> the area beneath the eyes, and the cheeks and often is <strong>purple</strong> in color.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Acne rosacea</strong> is a skin disorder with onset in middle\u2010aged adults (30\u201350 years old) and involves the convexities of the face.</p>\n<p>Option C:<strong>\u00a0Heliotrope rash</strong>\u00a0presents as violaceous lesions around eyelids. It is seen in <strong>dermatomyositis</strong>.</p>\n<p>Option D: <strong>Malar rash</strong>\u00a0or <strong>butterfly rash</strong> is classically seen in <strong>SLE</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d6e8e64d2a6c4ec284fcf07fa6f8c05d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the OPD with skin lesions that are associated with loss of sensation. What is the most unstable form of this patient's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Borderline tuberculoid"
      },
      {
        "id": 2,
        "text": "Lepromatous leprosy"
      },
      {
        "id": 3,
        "text": "Borderline borderline"
      },
      {
        "id": 4,
        "text": "Borderline lepromatous"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows <strong>punched-out</strong>\u00a0<strong>anesthetic</strong> lesions characteristic of the <strong>borderline spectrum</strong> of leprosy. The <strong>most unstable</strong> form of leprosy is the<strong>\u00a0borderline-borderline</strong> type.</p>\n<p>This type is <strong>rare</strong>ly seen as it <strong>rapidly upgrades </strong>towards <strong>tuberculoid</strong> or <strong>downgrades </strong>towards <strong>lepromatous</strong>, based on the immune status of the individual. However, clinical features may lag behind the immunological and histological findings. This leads to numerous skin lesions and with features of both ends of the spectrum.\u00a0</p>\n<p>Lepromatous and tuberculoid\u00a0types are the most stable.</p>\n<p><strong>Classification</strong> systems of<strong> leprosy:</strong></p>\n<ul>\n<li><strong>Ridley Jopling</strong> classification:\n<ul>\n<li>Tuberculoid (TT)</li>\n<li>Borderline tubercular (BT)</li>\n<li>Borderline (BB)</li>\n<li>Borderline lepromatous (BL)</li>\n<li>Lepromatous (LL)</li>\n</ul>\n</li>\n<li><strong>Madrid</strong> classification:\n<ul>\n<li>Lepromatous (LL)</li>\n<li>Tuberculoid (TT)</li>\n<li>Borderline/dimorphous</li>\n<li>Indeterminate (early unstable type)</li>\n</ul>\n</li>\n<li><strong>Indian</strong> classification<strong> -</strong>\u00a0includes categories under Madrid classification +\u00a0<strong>pure neuritic type</strong></li>\n<li><strong>WHO</strong> classification:</li>\n</ul>\n<table style=\"width: 395px; height: 222px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 115.484px; text-align: center; height: 36px;\">\u00a0</td>\n<td style=\"width: 128.969px; text-align: center; height: 36px;\"><strong>Paucibacillary Leprosy</strong></td>\n<td style=\"width: 128.547px; text-align: center; height: 36px;\"><strong>Multibacillary Leprosy</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 115.484px; height: 46px;\">\n<p><strong>Number of skin lesions\u00a0</strong></p>\n</td>\n<td style=\"width: 128.969px; height: 46px;\">\n<p>up to 5\u00a0</p>\n</td>\n<td style=\"width: 128.547px; height: 46px;\">\n<p>6 or more</p>\n</td>\n</tr>\n<tr style=\"height: 50px;\">\n<td style=\"width: 115.484px; height: 50px;\">\n<p><strong>Nerve involvement\u00a0</strong></p>\n</td>\n<td style=\"width: 128.969px; height: 50px;\">\n<p>0-1\u00a0</p>\n</td>\n<td style=\"width: 128.547px; height: 50px;\">\n<p>2 or more\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 115.484px; height: 64px;\"><strong>Slit skin smear\u00a0</strong></td>\n<td style=\"width: 128.969px; height: 64px;\">Negative on all sites</td>\n<td style=\"width: 128.547px; height: 64px;\">\n<p>Positive at any site</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 115.484px; height: 64px;\"><strong>Ridley-Jopling\u00a0</strong></td>\n<td style=\"width: 128.969px; height: 64px;\">TT, BT</td>\n<td style=\"width: 128.547px; height: 64px;\">\n<p>BB, LL, BL\u00a0</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/70205059d4fa43f58100a19da83545a7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A wildlife photographer presents with complaints of fever and a skin lesion as shown below. He also gives the history of insect bite at the site of skin lesion. A blood test reveals a positive Weil-Felix test with OX K agglutinins.  Which of the following is the most likely etiological agent causing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Rickettsia akari"
      },
      {
        "id": 2,
        "text": "Orientia  tsutsugamushi"
      },
      {
        "id": 3,
        "text": "Rickettsia prowazekii"
      },
      {
        "id": 4,
        "text": "Rickettsia rickettsii"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario and the image showing\u00a0<strong>eschar</strong>\u00a0at the bite site along with a positive<strong>\u00a0Weil-Felix</strong>\u00a0reaction with<strong>\u00a0OX K</strong>\u00a0<strong>agglutinins</strong> is suggestive of <strong>scrub typhus</strong>. It is caused by\u00a0<em><strong>Orientia</strong> <strong>tsutsugamushi.</strong></em></p>\n<p><strong><span data-preserver-spaces=\"true\">Scrub typhus\u00a0</span></strong><span data-preserver-spaces=\"true\">is also known as chigger-borne typhus which is caused by\u00a0<em><strong>O. tsutsugamushi</strong></em>. The vector is <strong>trombiculid mite.</strong> Humans are infected when they are bitten by the mite larvae known as\u00a0</span><strong><span data-preserver-spaces=\"true\">chiggers.\u00a0</span></strong></p>\n<p><span data-preserver-spaces=\"true\">The incubation period is 1\u20133 weeks. The patient typically develops a characteristic<strong>\u00a0eschar</strong>\u00a0at the site of the mite bite, with\u00a0</span><strong><span data-preserver-spaces=\"true\">regional lymphadenopathy</span></strong><span data-preserver-spaces=\"true\">\u00a0and\u00a0<strong>maculopapular rash</strong>.</span></p>\n<p>Weil-Felix reaction is a\u00a0<strong>heterophile agglutination reaction</strong>, wherein the sera are tested for agglutinins to the O antigens of certain <em>Proteus</em> strains\u2014<em>Proteus vulgaris</em> -\u00a0<strong>OX 19 and OX 2 and <em>Proteus mirabilis</em> OX K.\u00a0</strong>The basis of the test is sharing an alkali-stable carbohydrate antigen by some <em>Rickettsiae</em> and by some strains of <em>Proteus</em>.</p>\n<p><strong>OX K</strong>\u00a0is agglutinated\u00a0<strong>only\u00a0</strong>in scrub typhus.</p>\n<p>\u00a0<strong>Inference of Agglutination pattern in Weil-Felix Reaction:</strong></p>\n<table style=\"width: 352.625px;\">\n<tbody>\n<tr>\n<td style=\"width: 154px;\">\n<p><strong>DISEASE\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</strong></p>\n</td>\n<td style=\"width: 65px;\">\n<p><strong>OX 19</strong></p>\n</td>\n<td style=\"width: 49px;\">\n<p><strong>OX 2</strong></p>\n</td>\n<td style=\"width: 53.625px;\">\n<p><strong>OX K</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Epidemic typhus</p>\n</td>\n<td style=\"width: 65px;\">\n<p>+++</p>\n</td>\n<td style=\"width: 49px;\">\n<p>+</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Endemic typhus</p>\n</td>\n<td style=\"width: 65px;\">\n<p>+++</p>\n</td>\n<td style=\"width: 49px;\">\n<p>+/-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>RMSF</p>\n</td>\n<td style=\"width: 65px;\">\n<p>++</p>\n</td>\n<td style=\"width: 49px;\">\n<p>++</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p><strong>Scrub typhus</strong></p>\n</td>\n<td style=\"width: 65px;\">\n<p>-</p>\n</td>\n<td style=\"width: 49px;\">\n<p>-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p><strong>+++</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Rickettsial pox</p>\n</td>\n<td style=\"width: 65px;\">\n<p>-</p>\n</td>\n<td style=\"width: 49px;\">\n<p>-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Trench fever</p>\n</td>\n<td style=\"width: 65px;\">\n<p>-</p>\n</td>\n<td style=\"width: 49px;\">\n<p>-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Q fever</p>\n</td>\n<td style=\"width: 65px;\">\n<p>-</p>\n</td>\n<td style=\"width: 49px;\">\n<p>-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/01859df5cdc34706b614ca61dc3e6c51.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy develops discolouration of the skin after pressure from a metallic object. This phenomenon is known as?",
    "choices": [
      {
        "id": 1,
        "text": "White dermographism"
      },
      {
        "id": 2,
        "text": "Symptomatic dermographism"
      },
      {
        "id": 3,
        "text": "Black dermographism"
      },
      {
        "id": 4,
        "text": "Urticaria pigmentosa"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Black dermographism</strong> is characterized by <strong>discoloration</strong> of the skin after pressure from a<strong> metallic object.</strong></p>\n<p><strong>Dermographism</strong>\u00a0refers to an exaggerated\u00a0flare and\u00a0<span class=\"term tooltipstered\" data-term-id=\"302\">weal</span>\u00a0response that occurs when skin is stroked or scratched.\u00a0Dermographism is the most common form of chronic inducible urticaria or physical urticaria.</p>\n<p><strong>Other options:</strong></p>\n<ul>\n<li><strong>White dermographism:</strong> This is due to <strong>capillary vasoconstriction</strong> following light stroking of the skin and occurs normally but is particularly pronounced in <strong>atopic eczema</strong></li>\n<li><strong>Symptomatic dermographism:\u00a0</strong>The <strong>triple response</strong> of local erythema due to capillary vasodilatation, followed by edema and a surrounding flare due to axon\u00a0reflex\u2010induced dilatation of arterioles after stroking the skin accompanied by severe itching.</li>\n<li><strong>Urticaria pigmentosa:</strong> Presence of <strong>itchy pigmented macules on the trunk</strong> of a child due to numerous deposition of cutaneous mast cells.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Skin Lesions Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>