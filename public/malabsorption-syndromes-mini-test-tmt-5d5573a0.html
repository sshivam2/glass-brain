<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malabsorption Syndromes Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 10-year-old child is brought for evaluation of repeated lung infections. The bronchial fluid samples show gram-negative, oxidase-positive bacteria that produce a bluish-green pigment. He also has been experiencing foul-smelling diarrhea with pale, floating stools. What is the mode of inheritance of the condition that the child is most likely to have?",
    "choices": [
      {
        "id": 1,
        "text": "Mitochondrial"
      },
      {
        "id": 2,
        "text": "X-linked dominant"
      },
      {
        "id": 3,
        "text": "Autosomal recessive"
      },
      {
        "id": 4,
        "text": "Autosomal dominant"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Repeated lung infections</strong> and <strong>steatorrhea</strong> (foul-smelling diarrhea with pale, floating stools) suggest a diagnosis of<strong> cystic fibrosis.</strong>&nbsp;It has an <strong>autosomal recessive</strong> inheritance pattern.&nbsp;Gram-negative, oxidase-positive bacteria that produce a blue-green pigment indicate infection with&nbsp;<em><strong>Pseudomonas aeruginosa</strong>,&nbsp;</em>which is commonly seen in this condition.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are evaluating a 39-year-old male patient for malabsorption and vitamin B12 deficiency. He undergoes a Schilling test and the findings observed are given in the table. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pernicious anemia"
      },
      {
        "id": 2,
        "text": "Ileal disease"
      },
      {
        "id": 3,
        "text": "Small intestinal bacterial overgrowth (SIBO)"
      },
      {
        "id": 4,
        "text": "Chronic pancreatitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Normal absorption of Vit B12 with intrinsic factor is seen in&nbsp;<strong>Pernicious Anemia.</strong></p>\n<p>Pernicious anemia can be defined as a severe lack of intrinsic factor due to gastric atrophy. People who have pernicious anemia can't absorb enough vitamin B12 from food. This is because they lack intrinsic factor, a protein made in the stomach.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with fatigue and chronic diarrhea for 4 months. Endoscopy reveals several ulcers in the gastric antrum and the descending duodenum. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "VIPoma"
      },
      {
        "id": 2,
        "text": "Zollinger-Ellison syndrome"
      },
      {
        "id": 3,
        "text": "Glucagonoma"
      },
      {
        "id": 4,
        "text": "Insulinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of gastrinoma-\u00a0<strong>Zollinger-Ellison</strong>\u00a0<strong>syndrome</strong>.\u00a0</p>\n<div class=\"page\" title=\"Page 776\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Zollinger-Ellison syndrome is caused by <strong>gastrin-secreting neuroendocrine tumors</strong>. In 75% of patients, gastrinomas are sporadic, solitary lesions. The remaining 25% of patients with gastrinomas have multiple endocrine neoplasia type 1 (MEN1).\u00a0Gastrinomas usually arise in the small intestine or pancreas. The most remarkable feature in the stomach is an<strong> increase in oxyntic mucosal thickness</strong> due to massive parietal cell hyperplasia.</p>\n<p>Patients present with <strong>duodenal ulcers</strong> or <strong>chronic diarrhea</strong>. The acidic environment <strong>impairs the function of digestive enzymes </strong>(pancreatic enzymes), leading to the <strong>malabsorption of nutrients</strong>. This malabsorption results in an <strong>osmotic gradient</strong>, drawing water into the intestinal lumen, which contributes to <strong>diarrhea.</strong>\u00a0</p>\n<p><strong>Treatment</strong> of individuals with Zollinger-Ellison syndrome includes blockade of acid hypersecretion, typically with <strong>proton pump inhibitors</strong>.\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Other options:</strong></p>\n<p>Option A:<strong>\u00a0VIPoma</strong>\u00a0is characterized by watery diarrhea, hypokalemia, and achlorhydria (<strong>WDHA syndrome</strong>). It is caused by the release of vasoactive intestinal peptide (VIP) from the tumor.</p>\n<p>Option C:<strong> Glucagonomas</strong>, \u03b1-cell tumors are associated with increased serum levels of glucagon. The patient presents with mild diabetes mellitus, a characteristic skin rash (necrolytic migratory erythema), and anemia. They occur most frequently in perimenopausal and postmenopausal women and are characterized by extremely high plasma glucagon levels.</p>\n<p>Option D: <strong>Insulinomas</strong>,\u00a0\u03b2-cell tumors are the most common pancreatic endocrine neoplasms. These are usually <strong>benign</strong> and often cause symptomatic hypoglycemia. Hypoglycemic symptoms appear when <strong>blood glucose </strong>levels fall<strong> below 50 mg/dL</strong>. The symptoms usually develop after fasting or exertion and improve after glucose intake.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant was brought to the pediatrics department with poor sucking and difficulty in taking feed. He also had severe foul smelling greasy loose stools. A peripheral smear showed acanthocytosis. A biopsy specimen of the small intestine is shown below. Identify the underlying condition.",
    "choices": [
      {
        "id": 1,
        "text": "Lactase deficiency"
      },
      {
        "id": 2,
        "text": "Abetalipoproteinemia"
      },
      {
        "id": 3,
        "text": "Celiac disease"
      },
      {
        "id": 4,
        "text": "Whipple's disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation of an<strong> infant</strong> presenting with&nbsp;<strong>failure to thrive</strong>, <strong>steatorrhea</strong>,<strong> acanthocytosis</strong> in the peripheral smear, and a histopathological image showing <strong>lipid-laden vacuolated epithelium</strong>&nbsp;is suggestive of <strong>abetalipoproteinemia</strong>.</p>\n<p>Abetalipoproteinemia is a rare&nbsp;<strong>autosomal recessive</strong> disease. It is caused due to the <strong>mutation</strong> in microsomal triglyceride transfer protein which leads to the inability to assemble triglyceride-rich lipoproteins. Thus <strong>lipids</strong> get <strong>accumulate</strong> intracellularly. It is predominantly seen in<strong> children</strong> during their <strong>first year of life</strong>. They present with failure to thrive and steatorrhea.</p>\n<p>Deep tendon reflexes are absent due to peripheral neuropathy and peripheral smear shows <strong>acanthocytosis</strong> due to lipid membrane defects, which is secondary to marked&nbsp;<strong>vitamin E deficiency</strong>.</p>\n<p>Histopathology shows&nbsp;<strong>normal intestinal mucosa</strong>&nbsp;except <strong>lipid-laden vacuolated epithelium</strong> due to triglyceride accumulation.&nbsp;Accumulated lipids disappear after infants stop taking feed.</p>\n<p>Low fat, high caloric, vitamin-enriched diet, and vitamin E in large doses should be given. Inadequate supply of vitamin E results in <strong>neurological degeneration</strong> and the development of <strong>retinitis pigmentosa</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/53812b29d0554b23991e31b93dd2a985.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60ffdd80c7fc4a239628d5825d0af8cdx1280x1573.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e350973fe940450396ab932bb0a4f99dx800x533.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f6796907615746a0b75f5d889d524d6cx1280x1574.JPEG"
    ]
  },
  {
    "text": "A 44-year-old male patient with Crohn's disease underwent resection of a segment of the bowel. Following resection, the patient noticed that his stools have become bulky, pale, foul-smelling, and float in the toilet bowl. Which of the following statements is false regarding the resected segment of the bowel?",
    "choices": [
      {
        "id": 1,
        "text": "It is the only site of absorption of bile salts"
      },
      {
        "id": 2,
        "text": "It is the only site of absorption of vitamin B12"
      },
      {
        "id": 3,
        "text": "Resection of this segment leads to decreased gastric motility"
      },
      {
        "id": 4,
        "text": "Oral cholestyramine may be required in resections as small as 100cm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The history of&nbsp;<strong>bulky, pale, and floating stools </strong>indicates<strong>&nbsp;steatorrhea </strong>which is seen in<strong> ileal resection.&nbsp;</strong>Resection of the ileum does not lead to decreased gastric motility.</p>\n<p>Small bowel <strong>motility</strong> is three times <strong>slower in</strong> the <strong>ileum</strong> than in the jejunum. In addition, the <strong>ileocaecal valve</strong> may <strong>slow</strong> the <strong>transit</strong>. Resection of the ileum, thus, results in a significant <strong>enhancement </strong>of<strong> gastric motility and</strong> acceleration of <strong>intestinal transit</strong>. This&nbsp;<strong>results in</strong> <strong>increased</strong> delivery of <strong>fluids and electrolytes</strong> to the <strong>colon</strong> which results in symptoms of<strong> diarrhea</strong>.&nbsp;</p>\n<p>The <strong>ileum</strong> is the <strong>only</strong> <strong>site</strong> of <strong>absorption</strong> of <strong>vitamin B<sub>12</sub></strong> and <strong>bile salts </strong>(Options A &amp; B). <strong>Following resection</strong> of the ileum, the <strong>loss of bile salts increases</strong> and is not met by an increase in synthesis. Depletion of the bile salt pool <strong>results in</strong> fat malabsorption (<strong>steatorrhea</strong>).&nbsp;The loss of<strong> bile salts into</strong> the <strong>colon</strong> affects the colonic mucosa, causing a<strong> reduction</strong> in <strong>salt and water absorption</strong>, which increases stool losses.&nbsp;</p>\n<p>Resections as small as 100cm can cause steatorrhoea, which<strong> requires</strong> the administration of <strong>oral cholestyramine to bind</strong> the<strong> bile salts </strong>(Option D). <strong>Larger resections</strong> may <strong>require dietary fat restriction</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5943d19b9074d70b9551d54fe3e3846x1200x1616.JPEG"
    ]
  },
  {
    "text": "Which of the following alpha beta 7 integrin inhibitors is used in the treatment of Crohn's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Certolizumab"
      },
      {
        "id": 2,
        "text": "Adalimumab"
      },
      {
        "id": 3,
        "text": "Natalizumab"
      },
      {
        "id": 4,
        "text": "Vedolizumab"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Vedolizumab</strong> is a humanized <strong>anti-alpha-4-beta-7\u00a0integrin</strong> <strong>monoclonal antibody</strong> that <strong>prevents lymphocyte</strong> recruitment to the intestinal mucosa and is\u00a0approved for use in moderate-severe <strong>Crohn's</strong> disease and <strong>ulcerative</strong> colitis.</p>\n<p><strong>Anti-TNF alpha</strong> monoclonal antibodies indicated in IBD are:\u00a0</p>\n<ul>\n<li>Infliximab</li>\n<li><strong>Adalimumab</strong></li>\n<li><strong>Certolizumab</strong> pegol</li>\n</ul>\n<p>Other options :\u00a0</p>\n<p>Option C: <strong>Natalizumab</strong> is an <strong>anti-alpha-4-beta-7\u00a0integrin</strong> inhibitor <strong>monoclonal antibody</strong> used in treating <strong>Multiple Sclerosis</strong>, particularly in patients who are JC virus negative.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with celiac disease presents with peripheral neuropathy and decreased vibration and position sense. Investigations show hemolytic anemia and normal methylmalonic acid levels. Which of the following is most likely deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pyridoxine"
      },
      {
        "id": 2,
        "text": "Folate"
      },
      {
        "id": 3,
        "text": "Vitamin B12"
      },
      {
        "id": 4,
        "text": "Vitamin E"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient has <strong>chronic malabsorption</strong> due to <strong>celiac disease</strong>, and has now presented with <strong>peripheral neuropathy</strong> and <strong>posterior column involvement</strong> (loss of vibration and position sense). The presence of <strong>hemolytic anemia</strong> along with these features points to a diagnosis of <strong>vitamin E deficiency</strong>.</p>\n<p><strong>Vitamin E (&alpha;-tocopherol)</strong> acts as an <strong>antioxidant</strong> by scavenging free radicles. It is a <strong>fat-soluble vitamin</strong>, and so the <strong>deficiency</strong> is only seen <strong>in</strong> patients with <strong>prolonged malabsorption</strong>, such as <strong>celiac disease</strong> and <strong>chronic cholestatic liver disease</strong>. Children with <strong>abetalipoproteinemia</strong> cannot absorb vitamin E and also show symptoms of deficiency.&nbsp;</p>\n<p><strong>Deficiency</strong> of vitamin E <strong>causes</strong> <strong>axonal degeneration of myelinated neurons</strong>, causing <strong>posterior column</strong> and <strong>spinocerebellar involvement</strong>. Patients can have <strong>peripheral neuropathy</strong>, <strong>ataxia</strong>, and <strong>loss of vibration </strong>and<strong> position sense</strong>. Along with this, there is <strong>hemolytic anemia&nbsp;</strong>because of unchecked lipid peroxidation of the RBC membrane in the absence of the antioxidant effects of vitamin E.</p>\n<p>Vitamin B12 deficiency (option C) can also present with involvement of the posterior column, but the following features differentiate it from vitamin E deficiency:</p>\n<table style=\"border-collapse: collapse; width: 52.8683%; height: 111.992px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">&nbsp;</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\"><strong>Vitamin E deficiency</strong></td>\n<td style=\"width: 33.3333%; height: 22.3984px;\"><strong>Vitamin B12 deficiency</strong></td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">Anemia</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Hemolytic anemia</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Megaloblastic anemia</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 33.3333%; height: 44.7969px;\">Peripheral smear</td>\n<td style=\"width: 33.3333%; height: 44.7969px;\">Acanthocytes</td>\n<td style=\"width: 33.3333%; height: 44.7969px;\">Macroovalocytes with hypersegmented neutrophils</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 33.3333%; height: 22.3984px;\">Serum methylmalonic acid levels</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Normal</td>\n<td style=\"width: 33.3333%; height: 22.3984px;\">Elevated</td>\n</tr>\n</tbody>\n</table>\n<p>Other options:</p>\n<p>Option A: <strong>Pyridoxine</strong> <strong>deficiency</strong> presents with <strong>epithelial changes</strong> such as cheilitis, along with <strong>peripheral neuropathy</strong>,&nbsp;personality changes, and depression. There is <strong>no involvement of</strong> the <strong>posterior column</strong> tracts. Pyridoxine deficiency can cause <strong>microcytic hypochromic anemia </strong>due to diminished hemoglobin synthesis, since the aminolevulinate synthase enzyme in heme synthesis is PLP dependent.&nbsp;</p>\n<p>Option B: <strong>Folate deficiency </strong>presents with <strong>megaloblastic anemia</strong> <strong>without neurological symptoms</strong>. There is an <strong>elevation of serum homocysteine</strong> levels but <strong>methylmalonic acid levels</strong> are <strong>normal</strong>, versus vitamin B12 deficiency, where both are elevated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old gentleman presents to the clinic with bloody diarrhea, tenesmus, and crampy abdominal pain for the past week. The colonoscopy image is given below. Which of the following is commonly not associated with the patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Arthritis"
      },
      {
        "id": 2,
        "text": "Urethritis"
      },
      {
        "id": 3,
        "text": "Iritis"
      },
      {
        "id": 4,
        "text": "Pyoderma gangrenosum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the endoscopic image point to a diagnosis of&nbsp;<strong>ulcerative colitis</strong>.<strong> Urethritis</strong> is <strong>not</strong> an&nbsp;extraintestinal manifestation of ulcerative colitis.</p>\n<p>Ulcerative colitis is characterized by recurring episodes of inflammation limited to the mucosa of the colon and rectum. It presents with chronic diarrhea, <strong>tenesmus,</strong> mucus and blood passage per rectum, and crampy abdominal pain.</p>\n<p><strong>Sigmoidoscopy</strong> shows severe colon inflammation with erythema, friability, and exudates. Active disease is associated with a rise in acute-phase reactants (C-reactive protein), platelet count, erythrocyte sedimentation rate (ESR), and a decrease in hemoglobin.&nbsp;Diagnosis is based on the patient&rsquo;s clinical symptoms, sigmoidoscopic appearance, and histology of rectal or colonic biopsy specimens.</p>\n<p><strong>Extraintestinal manifestations of ulcerative colitis&nbsp;</strong></p>\n<ul>\n<li>Musculoskeletal -\n<ul>\n<li><strong>Arthritis</strong></li>\n<li>Sacroiliitis</li>\n<li>Ankylosing spondylitis</li>\n</ul>\n</li>\n<li>Eye -<br />\n<ul>\n<li><strong>Uveitis/Iritis</strong></li>\n<li>Episcleritis</li>\n</ul>\n</li>\n<li>&nbsp;Skin -\n<ul>\n<li>Erythema nodosum</li>\n<li><strong>Pyoderma gangrenosum</strong></li>\n</ul>\n</li>\n<li>Hepatobiliary -\n<ul>\n<li><strong>Primary sclerosing cholangitis</strong></li>\n<li>Fatty liver</li>\n<li>Cholelithiasis</li>\n</ul>\n</li>\n<li>Hematopoietic/coagulation -\n<ul>\n<li>Venous and arterial thromboembolism</li>\n</ul>\n</li>\n<li>Cardiopulmonary -<br />\n<ul>\n<li>Interstitial lung disease</li>\n<li>pleuropericarditis</li>\n<li>endocarditis</li>\n<li>myocarditis</li>\n</ul>\n</li>\n<li>Urologic -\n<ul>\n<li>Calculi</li>\n<li>Ureteral obstruction</li>\n<li>Ileal bladder fistula</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b8e331355f5941a28cf3440c4df8af64.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An obese patient was prescribed a drug for weight loss that acts by inhibiting gastrointestinal lipase. Which among the following is the prescribed drug?",
    "choices": [
      {
        "id": 1,
        "text": "Liraglutide"
      },
      {
        "id": 2,
        "text": "Orlistat"
      },
      {
        "id": 3,
        "text": "Phentermine"
      },
      {
        "id": 4,
        "text": "Ezetimibe"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Orlistat</strong> is a drug indicated for <strong>weight loss</strong> and acts by <strong>inhibiting gastrointestinal lipase</strong> resulting in <strong>reduced lipid absorption</strong>.</p>\n<p><strong>Orlistat</strong> is a <strong>reversible gastrointestinal lipase inhibitor</strong> required for the hydrolysis of dietary fat into fatty acids and monoacylglycerols. Orlistat acts in the lumen of stomach and small intestine by forming covalent bonds with the active site of lipases. This leads to <strong>reduced digestion and absorption</strong> <strong>of dietary fat</strong>. <strong>Adverse effects</strong> include <strong>flatus with discharge, fecal urgency, fatty/oily stool</strong>, and <strong>increased defecation</strong>. These side effects are experienced early and <strong>diminish</strong> as patients <strong>control their dietary fat intake</strong>. <strong>Vitamin supplements</strong> are indicated to prevent fat soluble vitamin deficiency.<br /><br /><strong>Adjuvant pharmacologic treatments</strong> for <strong>obesity</strong> should be considered for patients with a <strong>BMI \u226530 kg/m2</strong>, or for patients with a <strong>BMI \u226527 kg/m2 </strong>who have <strong>concomitant obesity-related diseases</strong> and for whom <strong>dietary and physical activity therapy</strong> has <strong>not been successful</strong>. Medications for obesity include those that affect <strong>appetite</strong> (liraglutide, phentermine)\u00a0 and those that <strong>inhibit gastrointestinal fat absorption</strong> (orlistat).</p>\n<p>Other options:</p>\n<p>Option A: <strong>Liraglutide</strong> is a <strong>glucagon-like peptide-1 (GLP-1)</strong> <strong>analogue</strong> which is approved for the treatment of <strong>type 2 diabetes</strong>, and is used as an off label indication for <strong>weight loss</strong>. It acts as an <strong>incretin hormone</strong> (glucose-induced insulin secretion), <strong>inhibits both gastric emptying</strong> and <strong>glucagon</strong> <strong>secretion</strong> and stimulates GLP-1 receptors in the arcuate nucleus of hypothalamus to <strong>reduce feeding</strong>.</p>\n<p>Option C: <strong>Phentermine</strong> is a <strong>sympathomimetic central appetite suppressant</strong> medication that acts by increasing central norepinephrine release.</p>\n<p>Option D: <strong>Ezetimibe</strong> selectively <strong>inhibits intestinal absorption of cholesterol</strong> and phytosterols, and is used in the management of <strong>hypercholesterolemia</strong>. It is not indicated in the treatment of obesity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old boy presented with complaints of weight loss, malaise, and passing loose, bulky stools for the past 4 months. Stools were initially profuse and watery and later became greasy and foul-smelling, often associated with abdominal pain. A wet preparation of the stool sample is shown in the image below. All of the following drugs are used to treat this condition, except:",
    "choices": [
      {
        "id": 1,
        "text": "Tinidazole"
      },
      {
        "id": 2,
        "text": "Nitazoxanide"
      },
      {
        "id": 3,
        "text": "Metronidazole"
      },
      {
        "id": 4,
        "text": "Albendazole"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette showing the child having loose<strong> greasy stools</strong> and pain abdomen along with the image showing <strong>cysts of Giardia lamblia</strong> is strongly suggestive of <strong>Giardiasis.\u00a0</strong>For this condition, Metronidazole/tinidazole/Nitazoxanide are the first-line agents while Albendazole is not used in treatment.\u00a0</p>\n<p>Infection occurs by the <strong>ingestion of cysts</strong> in contaminated water, food, or by the fecal-oral route (hands or fomites). The incubation period is usually about<strong> 2 weeks.\u00a0</strong>Cysts are the infective form of the parasite. Cysts are resistant forms and are responsible for the transmission of giardiasis. Both cysts and trophozoites can be found in the faeces (diagnostic stages). The cysts are hard and can survive up to 3 months in cold water.</p>\n<p>In the<strong> small intestine,</strong> excystation releases trophozoites (each cyst produces two trophozoites).\u00a0It is the\u00a0<strong>only\u00a0</strong>common pathogenic<strong>\u00a0protozoan</strong>\u00a0in the human intestines, adhering to the\u00a0duodenal or upper jejunal mucosa\u00a0by a ventral sucking disk.</p>\n<p>Clinical features:</p>\n<ul>\n<li>Diarrhea, fat malabsorption, dull epigastric pain, belching, and flatulence. The stool contains excess mucus and fat but no blood.</li>\n<li>Abnormal stool patterns may alternate with periods of constipation and normal bowel movements.</li>\n<li>It is associated with iron deficiency and growth stunting</li>\n</ul>\n<p>Diagnosis:-</p>\n<ul>\n<li>Wet mount preparation of stool samples for microscopy to identify cysts and trophozoites during the active stage of the disease.</li>\n<li>The String test/Entero test is used. It is a useful method for obtaining the duodenal specimen in giardiasis.</li>\n<li>Sero diagnosis: Commercially available ELISA kits detect Giardia-specific antigen ( GSA 65 ). <strong>ELISA\u00a0</strong>kits (ProSpecT/ Giardia kit) detect Giardia-specific antigen 65 (GSA 65)<strong>\u00a0</strong>and have a<strong>\u00a0sensitivity of 95%\u00a0</strong>and<strong>\u00a0specificity of 100%,\u00a0</strong>compared to conventional microscopy.</li>\n</ul>\n<p>Treatment: <strong>Metronidazole/tinidazole/nitazoxanide</strong> are the first-line agents.</p>\n<p>Other options :</p>\n<p><strong>Entamoeba histolytica</strong> causes\u00a0<strong>amoebic dysentery</strong> which can be acute intestinal amebiasis presenting with dysentery, lower abdominal discomfort, and flatulence, or chronic amebiasis which presents with low-grade symptoms such as occasional diarrhoea, weight loss, and fatigue. Fat malabsorption is not commonly seen.</p>\n<p><strong>Balantidium coli</strong>\u00a0is the\u00a0<strong>only ciliated protozoa</strong>\u00a0and it is present in the\u00a0<strong>large intestine as a commensal.</strong> It is also the largest protozoan parasite of humans. Living trophozoites/cysts are yellowish or greenish on wet mount which can be easily differentiated from Giardia lamblia.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/248e5be188164bcba60771a2b6cc8f7a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old female patient comes with a history of chronic weight loss, loss of appetite, and diarrhea along with pale bulky stools and is diagnosed with malabsorption syndrome. Steatorrhea is defined in this patient by stool fat exceeding:",
    "choices": [
      {
        "id": 1,
        "text": "7 g per day"
      },
      {
        "id": 2,
        "text": "14 g per day"
      },
      {
        "id": 3,
        "text": "28 g per day"
      },
      {
        "id": 4,
        "text": "32 g per day"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Steatorrhea is a symptom&nbsp;defined by stool fat exceeding <strong>7 g per day.</strong></p>\n<p>Steatorrhea is the passage of <strong>greasy, foul-smelling, difficult-to-flush</strong> stools.&nbsp;It is often associated with weight loss &amp; nutritional deficiencies due to concomitant malabsorption of amino acids &amp; fat-soluble vitamins. It is one of the clinical features of <strong>fat malabsorption</strong> and is noted in many conditions causing intraluminal maldigestion, mucosal malabsorption, or lymphatic obstruction.</p>\n<p>Causes of steatorrhea:</p>\n<ul>\n<li class=\"half_rhythm\">\n<div>Exocrine <strong>pancreatic insufficiency</strong>: Chronic pancreatitis, cystic fibrosis (CF), pancreatic tumors</div>\n</li>\n<li class=\"half_rhythm\">\n<div><strong>Bile acid deficiency</strong>: Primary biliary cholangitis&nbsp;(PBC), primary sclerosing cholangitis (PSC), ileal resection, Crohn disease, small&nbsp;intestinal bacterial overgrowth (SIBO)</div>\n</li>\n<li class=\"half_rhythm\">\n<div><strong>Enteropathy </strong>or<strong>&nbsp;</strong>Malabsorption syndrome: Celiac disease (most common), tropical sprue, giardiasis, Whipple disease, amyloidosis, SIBO, abetalipoproteinemia</div>\n</li>\n</ul>\n<p>Screening of steatorrhea is by the detection of fat&nbsp;by <strong>Sudan III staining. </strong>Stool fat can be quantified&nbsp;by calculating the coefficient of fat absorption <strong>(CFA), </strong>which is an essential step in the diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man presented to the OPD with complaints of fever, epigastric discomfort, progressive weight loss, and foul-smelling diarrhea for the past 6 months. He recently also developed severe pain in his right knee. A malabsorption syndrome is suspected and a biopsy is taken which shows the following picture. A disturbance in which phase of nutrient absorption is seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lymphatic transport"
      },
      {
        "id": 2,
        "text": "Terminal digestion"
      },
      {
        "id": 3,
        "text": "Intraluminal digestion"
      },
      {
        "id": 4,
        "text": "Transepithelial transport"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette showing foul-smelling diarrhea, weight loss, arthralgia, and histopathology showing\u00a0dense accumulation of\u00a0<strong>distended, foamy macrophages in the small intestinal lamina propria </strong>and\u00a0macrophages containing<strong>\u00a0periodic acid\u2013Schiff (PAS)-positive, diastase-resistant granules</strong> is suggestive of <strong>Whipple disease</strong> where there is a disturbance in the <strong>lymphatic transport</strong> of absorbed lipids.</p>\n<p>Whipple's disease is a chronic multisystem disorder caused by the gram-positive bacteria Tropheryma whipplei. It presents as diarrhea, steatorrhea, weight loss, arthralgia, and central nervous system &amp; cardiac problems.\u00a0The morphologic hallmark of Whipple disease is a dense accumulation of\u00a0<strong>distended, foamy macrophages in the small intestinal lamina propria</strong>. Macrophages contain<strong>\u00a0periodic acid\u2013Schiff (PAS)-positive, diastase-resistant granules</strong>\u00a0that represent lysosomes stuffed with partially digested bacteria.</p>\n<p><strong>Steatorrhea</strong>\u00a0is characterized by excessive fecal fat and bulky, frothy, greasy, yellow, or clay-colored stools. Chronic malabsorptive disorders commonly occur due to pancreatic insufficiency, celiac disease, and Crohn's disease.\u00a0In Whipple disease, the cause of malabsorption is<strong>\u00a0impaired lymphatic transport.\u00a0</strong>In Whipple disease, clinical symptoms occur because organism-laden macrophages accumulate within the small intestinal lamina propria and mesenteric lymph nodes, causing lymphatic obstruction.</p>\n<p><strong>Malabsorption</strong>\u00a0occurs due to disturbance in at least one of the<strong>\u00a0four phases of nutrient absorption:</strong></p>\n<ul>\n<li><strong>Intraluminal digestion:</strong>\u00a0In this phase, the proteins, carbohydrates, and fats are broken down into suitable forms for absorption. Diseases with abnormalities in this phase include <strong>chronic pancreatitis</strong> and <strong>cystic fibrosis</strong>.</li>\n<li><strong>Terminal digestion:</strong>\u00a0This phase involves hydrolysis of carbohydrates and peptides by the enzymes in the brush border of the small intestinal mucosa. Diseases with abnormalities in this phase include <strong>celiac disease, inflammatory bowel disease</strong>.</li>\n<li><strong>Transepithelial transport:\u00a0</strong>In this phase nutrients, fluid, and electrolytes are transported across the small intestinal epithelium, and are processed within the epithelium as they pass.\u00a0Diseases with abnormalities in this phase include <strong>cystic fibrosis, celiac disease, and\u00a0inflammatory bowel disease</strong>.</li>\n<li><strong>Lymphatic transport:\u00a0</strong>The absorbed lipids are transported. Abnormality in this phase is seen in <strong>Whipple disease</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/124d7894e36d44a987864dfa1e55d8b7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman is suffering from diarrhea, floating stools, and weight loss for the past 3 months. An intestinal biopsy is provided below showing partial villous atrophy and marked intraepithelial lymphocytosis. Her symptoms do not improve after eliminating gluten from the diet. Which treatment should be administered?",
    "choices": [
      {
        "id": 1,
        "text": "Tetracycline + Vitamin B12"
      },
      {
        "id": 2,
        "text": "Metronidazole + Folic acid"
      },
      {
        "id": 3,
        "text": "Tetracycline + Folic acid"
      },
      {
        "id": 4,
        "text": "Amoxicillin + Vitamin B12"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario of a woman presenting with <strong>diarrhoea, floating stools and weight loss</strong> for 3 months with given histopathology\u00a0indicating <strong>inflammation of lamina propria</strong>\u00a0and<strong> no improvement with a gluten-free diet </strong>is suggestive of <strong>tropical sprue.\u00a0</strong>The treatment of tropical sprue is <strong>tetracycline + folic acid</strong>. Because of marked folate deficiency, folic acid is most often given together with broad-spectrum antibiotics for <strong>up to 6 months.</strong>\u00a0</p>\n<p><strong>Tropical sprue</strong> is an acquired malabsorptive condition of probable <strong>infectious </strong>aetiology. Patients present with <strong>diarrhoea, steatorrhoea, weight loss</strong>, <strong>folic acid,</strong> and <strong>vitamin B12 deficiency.</strong></p>\n<p>The small intestinal mucosal biopsy is <strong>diagnostic</strong> and reveals partial villous atrophy and mononuclear cell infiltration in the lamina propria.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/558934b3f28849c4b44f7d90aabbf728.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old girl has had a history of recurrent bulky stools and abdominal pain since 3 years of age. She has pallor, and her weight and height are below the 3rd percentile. Which of the following is the most appropriate investigation to make a specific diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Small intestinal biopsy"
      },
      {
        "id": 2,
        "text": "Barium studies"
      },
      {
        "id": 3,
        "text": "24-hour fecal fat estimation"
      },
      {
        "id": 4,
        "text": "Urinary D-xylose test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>A small intestinal biopsy</strong> can help diagnose <strong>documented steatorrhea or chronic diarrhea (&gt;3 weeks).</strong> Failure to thrive in the setting of recurrent bulky stools and abdominal pain suggests a diagnosis of <strong>chronic malabsorption.</strong></p>\n<p>Endoscopy is the preferred method of obtaining histologic material from the proximal small-intestinal mucosa.</p>\n<p>The other options are not specific tests used to confirm malabsorption syndromes.</p>\n<p>Lesions seen on small-bowel biopsy can be classified into three categories according to their distribution and specificity of findings; diseases in which these lessons are seen and the associated pathologic findings are given below:</p>\n<table style=\"height: 332px; width: 436px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 79.805px; text-align: center;\"><strong>Lesions</strong></td>\n<td style=\"width: 327.602px; text-align: center;\"><strong>Pathologic Findings</strong></td>\n</tr>\n<tr>\n<td style=\"width: 407.407px;\" colspan=\"2\"><strong>Diffuse, Specific</strong>\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 79.805px;\">Whipple disease</td>\n<td style=\"width: 327.602px;\">Lamina propria includes macrophages containing material positive on periodic acid\u2013Schiff staining</td>\n</tr>\n<tr>\n<td style=\"width: 407.407px;\" colspan=\"2\"><strong>Patchy, Specific</strong>\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 79.805px;\">Crohn disease</td>\n<td style=\"width: 327.602px;\">Noncaseating granulomas</td>\n</tr>\n<tr>\n<td style=\"width: 407.407px;\" colspan=\"2\"><strong>Diffuse, Nonspecific</strong>\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 79.805px;\">Celiac disease</td>\n<td style=\"width: 327.602px;\">Short or absent vill, mononuclear infiltrate, epithelial cell damage,\u00a0 hypertrophy of crypts</td>\n</tr>\n<tr>\n<td style=\"width: 79.805px;\">Folate deficiency</td>\n<td style=\"width: 327.602px;\">Short villi, decreased mitosis in crypts, megalocytosis</td>\n</tr>\n<tr>\n<td style=\"width: 79.805px;\">Zollinger-Ellison syndrome \u00a0</td>\n<td style=\"width: 327.602px;\">Mucosal ulceration and erosion from acid</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tests helps to distinguish inflammatory bowel disease from irritable bowel syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Fecal calprotectin"
      },
      {
        "id": 2,
        "text": "Serum albumin"
      },
      {
        "id": 3,
        "text": "C - reactive protein"
      },
      {
        "id": 4,
        "text": "Erythrocyte sedimentation rate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Assessment of <strong>fecal calprotectin</strong> levels helps to distinguish inflammatory bowel disease (IBD) from irritable bowel syndrome (IBS).</p>\n<p>The <strong>fecal calprotectin</strong> and <strong>lactoferrin</strong> are elevated in <strong>inflammatory conditions</strong> like inflammatory bowel disease, but not in irritable bowel syndrome. Hence, they are often assessed to distinguish the two conditions. These tests are also done to check if the disease is active and to detect postoperative recurrence. Other features of IBD include <strong>elevated</strong> <strong>erythrocyte sedimentation rate</strong> (ESR) and <strong>C-reactive protein</strong> (CRP), <strong>hypoalbuminemia</strong>, anemia, and leukocytosis.</p>\n<div class=\"page\" title=\"Page 9094\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Irritable bowel syndrome (IBS) is a <strong>functional disorder</strong> characterized by abdominal pain or discomfort and altered bowel habits in the <strong>absence of structural abnormalities</strong>. There are <strong>no clear diagnostic markers</strong> for IBS. The presence of anemia, elevated ESR, leukocytosis, bloody stool, or stool volume of more than 200 - 300 ml/day argues <strong>against</strong> the diagnosis of IBS. The diagnosis is mainly based on clinical presentation.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old male patient presented to the clinic with a history of diarrhoea and poor appetite. He has been having 4-5 episodes of non-bloody, loose stools per day for the last 3 months. A duodenal biopsy is taken and the histopathology is shown below. Which of the following statements is false about this given condition?",
    "choices": [
      {
        "id": 1,
        "text": "MARSH score is used for diagnosis of this condition"
      },
      {
        "id": 2,
        "text": "Increased association with dermatitis herpetiformis"
      },
      {
        "id": 3,
        "text": "Histopathological study reveals raised intraepithelial macrophages"
      },
      {
        "id": 4,
        "text": "Anti-endomysial antibodies are associated with this condition"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario of diarrhoea and poor appetite and histopathology findings (explained below) are suggestive of <strong>celiac disease</strong>. Histopathological study reveals <strong>raised</strong> <strong>intraepithelial</strong> <strong>lymphocytes.\u00a0</strong>Hence, Option C is a false statement.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e2995477e6d34796b6802fa634f98511.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a7edd0b4a5014729be77edb0f15b1779x1280x1230.JPEG"
    ]
  },
  {
    "text": "A patient with Crohn's disease who underwent multiple sequential ileal resections and removal of his terminal ileum and proximal cecum presents with bloating, flatulence, and watery diarrhea. The lactulose breath test shows a higher-than-normal reading after 1 hour.  Which of the following is the cause of his symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Bile irritation to intestinal wall"
      },
      {
        "id": 2,
        "text": "Resection of the ileo cecal valve"
      },
      {
        "id": 3,
        "text": "Dumping syndrome"
      },
      {
        "id": 4,
        "text": "Increased colonic motility"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Multiple sequential ileal resections, typical of patients with <strong>Crohn\u2019s disease</strong> can cause\u00a0<strong>short bowel syndrome\u00a0</strong>(<strong>&lt;150 cm </strong>of the<strong> residual small bowel). Flatulence</strong>, <strong>diarrhea</strong>, and a <strong>higher than normal</strong> concentration of <strong>Hydrogen</strong> on lactulose breath test make <strong>small intestinal bacterial overgrowth (SIBO)</strong> the most likely diagnosis. Resection of the <strong>ileocecal</strong> valve is the probable cause of his symptoms as it removes the barrier between the small and large bowel allowing for the colonic bacteria to colonise the small intestine.\u00a0</p>\n<p>Massive intestinal resection (<strong>&lt;150 cm</strong> of the <strong>residual small bowel</strong>) results in metabolic and nutritional consequences, is known as <strong>short bowel syndrome</strong>.</p>\n<p>Complications of short bowel syndrome include:</p>\n<ul>\n<li><strong>Diarrhea</strong> (due to <strong>hypergastrinemia</strong> and <strong>gastric hypersecretion</strong>, SIBO or unabsorbed <strong>bile salts</strong> in the colon)</li>\n<li><strong>Steatorrhea</strong> (due to the depletion of the bile salt pool)</li>\n<li><strong>Gallstones</strong> (due to interruption of the enterohepatic cycle of bile salts)</li>\n<li><strong>Renal stones</strong> (due to <strong>increased</strong> absorption of <strong>oxalate</strong> in the colon).</li>\n</ul>\n<p>SIBO is a condition characterized by overgrowth of bacteria in the small bowel. this can lead to bloating, flatulence, and secretory diarrhea.</p>\n<p>Risk factors for SIBO:</p>\n<ul>\n<li>Surgically created blind loops</li>\n<li><strong>Short bowel syndrome</strong></li>\n<li>Decreased intestinal motility</li>\n<li><strong>Resection of ileocecal valve</strong></li>\n<li><strong>Type 2 diabetes mellitus</strong></li>\n<li><strong>Decreased gastric acid secretion</strong></li>\n</ul>\n<p>Diagnosis is by small bowel cultures or Lactulose hydrogen breath test which shows more than <strong>20ppm </strong>of hydrogen. Treatment is with an antibiotic like <strong>rifaximin</strong>.\u00a0</p>\n<p>Other Options:\u00a0</p>\n<p>Option A:<strong> Bile irritation</strong> to the intestinal walls presents with <strong>secretory</strong> <strong>diarrhoea</strong> that occurs even at night. However, the presence of a positive lactulose hydrogen breath test makes SIBO more likely in this case.</p>\n<p>Option C: Dumping syndrome occurs in patients post <strong>Roux en Y jejunal </strong>bypass due to direct bypass to the jejunum which leads to symptoms of bloating and abdominal pain. However a positive lactulose hydrogen breath test makes SIBO more likely in this case.</p>\n<p>Option D: Increased colonic motility is protective and decreases the incidence of SIBO.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old man presented with nausea, watery diarrhea and bloating following the consumption of skimmed milk. Which of the following is the most likely cause of this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pancreatic enzyme deficiency"
      },
      {
        "id": 2,
        "text": "Immune mediated enterocyte damage"
      },
      {
        "id": 3,
        "text": "Brush border enzyme deficiency"
      },
      {
        "id": 4,
        "text": "Luminal bacterial overgrowth"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient with crampy abdominal pain, bloating and water diarrhea following the consumption of <strong>skimmed milk</strong> is most likely <strong>lactose intolerant</strong> with a <strong>brush border enzyme deficiency</strong> (ie. <strong>Lactase</strong>).&nbsp;</p>\n<p><strong>Lactase </strong>is a <strong>brush border enzyme</strong> that <strong>hydrolyzes lactose into glucose and galactose</strong>. In lactase deficiency, patients have great variability in clinical symptoms, depending on both the severity of lactase deficiency and the amount of lactose ingested.</p>\n<p>Lactose intolerance is a common cause of <strong>adult-onset diarrhea</strong> caused by malabsorption that affects individuals aged<strong> 20 to 40.</strong> &nbsp;It has been described throughout the world, with significant variations amongst groups.</p>\n<p><strong>Lactose</strong> is converted to <strong>glucose</strong> and <strong>galactose</strong> <strong>by</strong> intestinal <strong>lactase</strong> on the brush border of the duodenum. As the osmotic burden of undigested lactose moves through the intestines, it <strong>draws water</strong> into the lumen and <strong>shortens transit time</strong>. &nbsp;Colonic bacteria also ferment lactose, producing short-chain fatty acids and <strong>hydrogen gas</strong> (bloating).</p>\n<p>Foods that are high in lactose include milk (12 g/cup), ice cream (9 g/cup), and cottage cheese (8 g/cup). Aged cheese has lower lactose content. Most people can tolerate up to 12g of lactose a day without significant symptoms.</p>\n<p><strong>Yogurt</strong> is the least likely to cause symptoms of lactose intolerance. It contains<strong> lactobacillus that produces lactase</strong> and is generally well tolerated.</p>\n<p>For patients with <strong>inconclusive</strong> <strong>diagnosis</strong>, a <strong>lactose breath hydrogen test</strong> can be performed.</p>\n<p>The goal of treatment in patients with isolated lactase deficiency is achieving patient comfort through the <strong>elimination of dietary lactose </strong>or <strong>supplementation</strong> with lactase.</p>\n<p>Other options :</p>\n<p>Option A : Patients with <strong>exocrine pancreatic insufficiency</strong> have defective digestion of fat and protein with symptoms of steatorrhea. Patients with pancreatic insufficiency have risk factors such as cystic fibrosis, <strong>chronic pancreatitis</strong> or a history of bowel or pancreatic resection.</p>\n<p>Option D : <strong>Luminal bacterial overgrowth</strong> is seen in small intestinal bacterial overgrowth (<strong>SIBO</strong>) which occurs when <strong>colonic bacteria migrate into the small intestine</strong>. <strong>Diarrhea</strong> in SIBO is most likely <strong>oily/greasy</strong>. It is usually associated with patients with fistulas or a motility disorder. This patient did not present with symptoms of greasy stool nor did he have any underlying disorder making this diagnosis unlikely.&nbsp;</p>\n<p>Option C : <strong>Immune mediated damage</strong> to the <strong>enterocytes</strong> are seen in autoimmune conditions such as <strong>Celiac disease</strong> which leads to damage to the enterocytes as well as <strong>villous atrophy.</strong> Patients with this disease usually have <strong>foul</strong> <strong>smelling</strong> stools or <strong>greasy</strong> <strong>stools</strong> which is not seen in this patient making this diagnosis unlikely.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about Intestinal lymphangiectasia?",
    "choices": [
      {
        "id": 1,
        "text": "Can cause protein loss"
      },
      {
        "id": 2,
        "text": "Associated with fat malabsorption"
      },
      {
        "id": 3,
        "text": "Disorder of mucosal absorption"
      },
      {
        "id": 4,
        "text": "Can occur secondarily due to lymphoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Intestinal lymphangiectasia</strong>\u00a0is not primarily a <strong>disorder of mucosal absorption</strong>, as the issue lies in the lymphatics (post-mucosal absorption) rather than the intestinal mucosa. Hence, Option C is a false statement.<br /><br />Intestinal lymphangiectasia involves the <strong>dilation</strong> of<strong> intestinal lymphatic vessels</strong>, leading to <strong>protein loss</strong> and <strong>fat malabsorption</strong> due to <strong>impaired lymphatic drainage.</strong></p>\n<p>The condition can be either <strong>primary</strong> (congenital) or <strong>secondary.</strong> Primary intestinal lymphangiectasia is usually congenital and may be associated with other lymphatic disorders. Secondary causes include conditions that obstruct the lymphatic system, such as <strong>lymphoma</strong>(Option D), filariasis or constrictive pericarditis.\u00a0</p>\n<p>The primary issue in intestinal lymphangiectasia is the dilation and dysfunction of the intestinal lymphatic vessels. This leads to the leakage of protein-rich lymph into the gastrointestinal tract, causing <strong>protein-losing enteropathy</strong> (option A). There is impaired absorption of fats and fat-soluble vitamins due to the loss of chylomicrons (Option B), which are essential for fat transport.</p>\n<p>Patients typically present with:</p>\n<ul>\n<li>Chronic Diarrhea: Often steatorrhea (fatty stools) due to fat malabsorption.</li>\n<li>Edema: Resulting from protein loss and hypoalbuminemia.</li>\n<li>Weight Loss: Due to malabsorption of nutrients.</li>\n<li>Lymphopenia: Low lymphocyte levels due to the loss of lymphocytes in the gastrointestinal tract.</li>\n</ul>\n<p>Diagnosis is usually confirmed by <strong>endoscopy and biopsy</strong>, showing dilated lymphatic vessels in the mucosa. Laboratory tests typically reveal hypoalbuminemia, hypoproteinemia, and lymphopenia.</p>\n<p>Management focuses on:</p>\n<ul>\n<li>Dietary Modification: A low-fat, high-protein diet supplemented with medium-chain triglycerides (MCTs) to reduce lymphatic pressure.</li>\n<li>Medical Therapy: <strong>Octreotide,</strong> a somatostatin analogue, can be used to reduce lymphatic leakage and manage symptoms.</li>\n<li>Surgical Intervention: In cases where lymphatic obstruction is localized, surgery may be required to relieve the obstruction.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding IPEX syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Males are primarily affected"
      },
      {
        "id": 2,
        "text": "It is an X-linked dominant disorder"
      },
      {
        "id": 3,
        "text": "It includes autoimmune endocrinopathy"
      },
      {
        "id": 4,
        "text": "It is associated with IBD"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>IPEX syndrome </strong>(Immune dysregulation, <strong>Polyendocrinopathy</strong>, Enteropathy, X-linked) is an <strong>X-linked recessive disorder </strong>(<strong>not </strong>X-linked dominant), primarily affecting <strong>males </strong>(Option A).</p>\n<p>It is caused by mutations in the <strong>FOXP3 gene</strong>. The syndrome manifests early in life with symptoms like <strong>Type 1 diabetes, Eczema, </strong>and<strong> </strong>autoimmune<strong> enteropathy</strong>. It often leads to severe immune system dysregulation.</p>\n<p>It is also a primary genetic disorder associated with autoimmune conditions like <strong>inflammatory bowel disease</strong>(Option D).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Malabsorption Syndromes Mini Test - -Tmt';
        const quizFilename = 'malabsorption-syndromes-mini-test-tmt-5d5573a0.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>