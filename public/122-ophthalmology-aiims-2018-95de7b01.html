<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>122 Ophthalmology Aiims 2018 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "All of the following are true about oculomotor nerve palsy except _____.",
    "choices": [
      {
        "id": 1,
        "text": "Ptosis"
      },
      {
        "id": 2,
        "text": "Mid-dilated pupil"
      },
      {
        "id": 3,
        "text": "Loss of light reflex"
      },
      {
        "id": 4,
        "text": "Lateral and upward gaze"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>4th</strong> cranial <strong>nerve palsy</strong> presents with <strong>superior oblique</strong> muscle <strong>paralysis.</strong></p>\n<p>Clinical findings of<strong> trochlear nerve palsy </strong>include:</p>\n<ul>\n<li><strong>Hypertropia</strong> (elevation) in the primary position</li>\n<li><strong>Extorsion</strong> that is greatest in abduction</li>\n<li><strong>Compensatory</strong> head posture with <strong>contralateral</strong> face turn and <strong>head tilt</strong> with <strong>chin</strong> slightly <strong>depressed</strong>. This position is assumed to <strong>avoid Diplopia</strong>.</li>\n<li><strong>Limitation</strong> of depression</li>\n<li><strong>Normal</strong> abduction and elevation</li>\n</ul>\n<p>The below given image depicts <strong>4th cranial nerve palsy</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de63b725531447d287a063eb37ac45b2x1280x3519.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b0f4ee4c3c3480eb7c35f09e3748a81x720x1577.JPEG"
    ]
  },
  {
    "text": "The center for vertical gaze is ________",
    "choices": [
      {
        "id": 1,
        "text": "Pontine Paramedian Reticular Formation"
      },
      {
        "id": 2,
        "text": "Raphe Nuclues"
      },
      {
        "id": 3,
        "text": "Rostral Interstitial Nucleus of Cajal"
      },
      {
        "id": 4,
        "text": "Nucleus of Perlia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>Rostral Interstitial Nucleus of Cajal</strong> is the center for vertical gaze.</p>\n<p><strong>Vertical</strong> <strong>eye movement</strong> initiation in the frontal lobes is mediated by the impulses generated via the <strong>vertical gaze center</strong> called <strong>Rostral interstitial Nucleus of Cajal</strong>. This nucleus is a prominent group of cells present within the Medial Longitudinal Fasciculus (MLF) in the <strong>midbrain</strong>.</p>\n<p><strong>Pontine Paramedian Reticular Formation</strong>(Option A) is the <strong>center</strong> for <strong>horizontal gaze</strong>. Classically, initiation occurs in the premotor cortex frontal eye fields from where impulses for horizontal movement pass to the <strong>contralateral</strong> paramedian pontine reticular formation (<strong>PPRF</strong>).</p>\n<p>Both horizontal and vertical gaze are <strong>saccadic</strong> types of <strong>conjugate eye movements</strong>. Conjugate eye movements, also known as <strong>versions</strong>, are <strong>binocular</strong> movements in which the eyes move synchronously in the <strong>same direction</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f150f08cf244109826252abf20fddcex1280x2228.JPEG"
    ]
  },
  {
    "text": "You can use a stenopaeic slit for all of the following except ____________.",
    "choices": [
      {
        "id": 1,
        "text": "Fincham\u2019s test"
      },
      {
        "id": 2,
        "text": "Corneal tattooing"
      },
      {
        "id": 3,
        "text": "Optical Iridectomy"
      },
      {
        "id": 4,
        "text": "To find out the axis in astigmatism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Stenopaeic slit is not used for <strong>corneal tattooing</strong>.</p>\n<p>Stenopaeic slit is an <strong>ophthalmological instrument</strong> that is used in:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Fincham&rsquo;s test</strong> (Option A) : This test is used to <strong>differentiate</strong> between the <strong>colored halos</strong> due to <strong>immature cataract</strong> and corneal abnormalities such as <strong>corneal edema</strong> due to <strong>glaucoma</strong>.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">To find out the <strong>axis </strong>in<strong> astigmatism</strong> (option D) for prescribing the <strong>correction glasses.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">To find out the optimal site for <strong>optical iridectomy</strong> (option C) for treating cases of central macular or leucomatous <strong>corneal opacities.</strong></li>\n</ul>\n<p><strong>Corneal tattooing</strong> was done mainly in the past for <strong>cosmetic purposes</strong>. It is commonly done for firm scars of corneal opacities in a eye <strong>without</strong> any <strong>useful vision</strong>.</p>\n<p>The below given image is of <strong>stenopaeic slit</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/85cfd33548674705811a110ecfb0081bx719x430.PNG"
    ]
  },
  {
    "text": "A 55-year-old male patient came to OPD with the complaints of glare during night drives. He had undergone cataract surgery 1 year back. The best-corrected visual acuity is RE = 6/12 and  LE = 6/9. No improvement with pinhole. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystoid macular edema"
      },
      {
        "id": 2,
        "text": "Pseudophakic bullous keratopathy"
      },
      {
        "id": 3,
        "text": "ARMD"
      },
      {
        "id": 4,
        "text": "Posterior capsular opacification"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>&nbsp;</p>\n<p>Option B: <strong>Pseudophakic bullous keratopathy</strong> is a postoperative <strong>complication</strong> of <strong>cataract surgery</strong> where the patient presents with <strong>corneal edema</strong>. This occurs due to a surgical or chemical <strong>insult</strong> to the <strong>corneal endothelium</strong> during the cataract surgery. It is treated by <strong>penetrating keratoplasty</strong>.</p>\n<p>Option C: <strong>Age related Macular degeneration</strong> (ARMD) also known as senile macular degeneration is a chronic and <strong>progressive</strong> <strong>bilateral</strong> degenerative disorder of the macula that affects <strong>older individuals &gt;50 yrs.&nbsp;</strong>ARMD is classified as <strong>d</strong><strong>ry</strong> and <strong>w</strong><strong>et </strong>ARMD where the <strong>hallmarks</strong> are presence of <strong>d</strong><strong>rusen</strong> and <strong>choroidal neovascularization</strong> respectively.&nbsp;</p>\n<p><strong>Drusen</strong> are <strong>extracellular eosinophilic deposits</strong> between RPE and Bruch&rsquo;s membrane. Clinical features include <strong>loss of central vision</strong>, <strong>distorted vision</strong> (lines seen as wavy) and <strong>sudden painless loss of vision</strong> as seen in wet ARMD. The below given image shows <strong>Drusens</strong> in the macular area in <strong>Dry</strong> macular degeneration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5cfcd35166b8422b85dc0bedd0ef4eefx1279x1981.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ddd1486e7ec4416da3a2cf358b19d1abx720x544.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c89b4b2d19134b38855db2bfad55e70ex396x401.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3c7a6d9a718a4d838e9aac61d63866eex1280x1152.JPEG"
    ]
  },
  {
    "text": "Identify the lesion in the histopathological image of retina.",
    "choices": [
      {
        "id": 1,
        "text": "Drusen"
      },
      {
        "id": 2,
        "text": "Hard exudates"
      },
      {
        "id": 3,
        "text": "Cotton wool spots"
      },
      {
        "id": 4,
        "text": "Macular Edema"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D:<strong>Cystoid Macular edema</strong>(CME) is a collection of fluid between the <strong>outer plexiform</strong> layer(Henle's layer) and the <strong>inner nuclear</strong> layer of the retina.</p>\n<p>In CME, on <strong>fundoscopy</strong> a <strong>honeycomb</strong> appearance and on <strong>FFA</strong>,&nbsp;<strong>flower peta</strong>l pattern can be seen.<strong> Optical coherence tomography</strong>(OCT) of CME shows <strong>loss of foveal depression</strong> and <strong>intraretinal cystoid spaces</strong>.</p>\n<p>The below given <strong>OCT imag</strong>e shows <strong>intraretinal cystoid spaces</strong> seen in CME.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c9dc10ee935c4857b8ba149936b4adeb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75801a4aebe842c29f0ffb67770bef8fx1280x1152.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e27a2ed7e1744128a0a53b2b65102165x500x375.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/937e849a6bac4dd9be1590c476a7c781x359x220.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c6eea8533e4e43fd872e153cd0827aeax512x384.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6e6b1b6bd51d42b6afb8c028d481d0d5x1280x670.JPEG"
    ]
  },
  {
    "text": "Identify the picture",
    "choices": [
      {
        "id": 1,
        "text": "Macular Hole"
      },
      {
        "id": 2,
        "text": "Cystoid Macular Edema"
      },
      {
        "id": 3,
        "text": "Smoke stack pattern"
      },
      {
        "id": 4,
        "text": "Age related Macular degeneration"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D:<strong>Age related Macular degeneration</strong> (ARMD) also known as senile macular degeneration is a chronic and <strong>progressive</strong> <strong>bilateral</strong> degenerative disorder of the <strong>macula</strong> that affects <strong>older individuals &gt;50 yrs</strong>. ARMD generally starts as <strong>dry ARMD</strong> which is characterized by the presence of <strong>drusen</strong> and gradually progresses to the advanced form known as <strong>wet ARMD</strong> whose hallmark is <strong>choroidal neovascularization</strong> with additional findings such as <strong>geographic atrophy.</strong></p>\n<p>Drusen are <strong>extracellular eosinophilic</strong> deposits between <strong>retinal Pigment Epithelium</strong>&nbsp;and <strong>Bruch&rsquo;s membrane</strong>. The below given <strong>FFA</strong> image shows <strong>stars in sky</strong> appearance of <strong>Drusen.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fbc54987b79647b6a8bd0e4e678201b8.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3cf9b1f079d74ff19e67d51c07a58cd5x1280x670.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f46fe1c49b6f45cdb58bf429b91d9467x1166x346.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5584dfd6d3184499be8b06d12c3e695dx362x280.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/14562abd654541d7b9530c39524eed69x499x333.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/10f9591e367c4165a3da3cdc3fde8b00x500x375.JPEG"
    ]
  },
  {
    "text": "What is the adjuvant therapy in fungal corneal ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "Pilocarpine e/d"
      },
      {
        "id": 2,
        "text": "Lignocaine e/d"
      },
      {
        "id": 3,
        "text": "Dexamethasone e/d"
      },
      {
        "id": 4,
        "text": "Atropine Sulfate eye ointment"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Atropine sulfate </strong>(1%)&nbsp;eye ointment or eye drops is used as the nonspecific <strong>supportive treatment</strong> in both <strong>bacterial</strong> as well as a <strong>fungal corneal ulcer</strong>.</p>\n<p>Atropine sulphate (1%) is a <strong>cycloplegic</strong> drug that is used as an <strong>adjunct</strong> in the treatment of corneal ulcers to</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>reduce pain</strong> from <strong>ciliary spasm</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Prevent posterior synechiae</strong> formation that can develop from <strong>secondary iridocyclitis</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Increase blood supply</strong> to the anterior chamber that gets more antibodies into aqueous humor</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Reduce exudation</strong> by decreasing hyperpermeability of the vessels</li>\n</ul>\n<p>Another cycloplegic that can be used as an adjunct is homatropine 2%.</p>\n<p><strong>Topical steroids</strong> such as Dexamethasone(option C) will <strong>increase fungal replication</strong> and <strong>corneal invasion</strong> and hence are <strong>contraindicated</strong> in the treatment of <strong>fungal corneal ulcers.</strong></p>\n<p>Management of fungal corneal ulcer includes</p>\n<p><strong>Definitive</strong> treatment:</p>\n<ul>\n<li><strong>Topical antifungal</strong> eye drops: used for 6-8 weeks&nbsp;</li>\n</ul>\n<ul style=\"list-style-type: circle;\">\n<li><strong>Filamentous</strong> fungi such as <strong><em>Aspergillus</em></strong> and <strong><em>Fusarium</em></strong>- <strong>Drug of choice</strong> (DOC) is <strong>natamycin (5%)</strong>. Others include amphotericin B (0.1-0.3%), fluconazole (0.2%) or voriconazole 10%.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Yeast</strong> such as <strong><em>Candida</em></strong>- <strong>Drug of choice</strong> (DOC) is <strong>Amphotericin B</strong>. Others include Nystatin 3.5%.&nbsp;</li>\n</ul>\n<ul>\n<li><strong>Intracameral</strong> or <strong>intracorneal</strong> administration of Voriconazole in cases with <strong>intraocular extension</strong> or anterior chamber involvement.</li>\n<li><strong>Systemic antifungals</strong> such as tablet fluconazole are given in <strong>severe</strong> cases of <strong>deeper fungal keratitis</strong>.</li>\n<li>Therapeutic <strong>penetrating keratoplasty</strong> for unresponsive cases.</li>\n</ul>\n<p><strong>Adjunct</strong> therapy:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cycloplegics</strong> : Atropine sulphate 1% or homatropine 2%</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Systemic <strong>analgesics</strong> and <strong>anti-inflammatory</strong> drugs such as paracetamol, ibuprofen to <strong>decrease pain</strong> and <strong>edema</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Vitamins</strong> A,B-complex,C- to aid healing of the ulcer.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hot fomentation, dark goggles, rest, good diet.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are ocular manifestations of dengue except ________.",
    "choices": [
      {
        "id": 1,
        "text": "Cataract"
      },
      {
        "id": 2,
        "text": "Subconjunctival hemorrhage"
      },
      {
        "id": 3,
        "text": "Uveitis"
      },
      {
        "id": 4,
        "text": "Retinal hemorrhage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cataract</strong> is <strong>not</strong> an ocular manifestation of <strong>dengue</strong>.</p>\n<p>Dengue has varied manifestations, in different organ systems, mainly of <strong>inflammation</strong> and <strong>bleeding</strong>. The&nbsp;<strong>mechanisms</strong> for ocular manifestations in dengue include a <strong>direct viral effect</strong> on the eye, an immune-mediated <strong>vasculitis</strong>, and a variety of secondary effects related to dengue-induced <strong>vascular leakage</strong> and <strong>hemostatic abnormalities.</strong></p>\n<p>Ocular manifestations of dengue are:</p>\n<ul>\n<li>visual impairment which can be either painless or painful</li>\n<li><strong>Retro orbital pain</strong></li>\n<li>Conjunctival injection and <strong>subconjunctival hemorrhage</strong>(option B)</li>\n<li><strong>Uveitis</strong>(option C)</li>\n<li>Complications such as <strong>retinal hemorrhage</strong>(option D), retinal edema, macular ischemia, macular edema, vitreous hemorrhage, vitritis, and optic neuritis or papillitis.</li>\n</ul>\n<p>Depending on the severity of the disease, gradual improvement in vision occurs, although in rare cases permanent visual impairment may be seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy was brought with the complaints of protrusion of the right eye with no h/o fever. CT Scan showed a well-defined mass in the orbit with an irregular border and adjacent bony destruction. Biopsy showed small, round cells which were positive for Desmin in Immunohistochemistry. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Retinoblastoma"
      },
      {
        "id": 2,
        "text": "Cavernous Hemangioma"
      },
      {
        "id": 3,
        "text": "Orbital Cellulitis"
      },
      {
        "id": 4,
        "text": "Rhabdomyosarcoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario of a patient with complaints of protrusion of eye with well-defined mass in the orbit and adjacent bony destruction on CT scan and biopsy showing small, round cells positive for Desmin favors<strong>&nbsp;rhabdomyosarcoma.&nbsp;</strong></p>\n<p><strong>Cavernous hemangioma</strong>(option B) and <strong>orbital cellulitis</strong>(option C) usually are associated with fever, hence ruled out. <strong>Retinoblastoma</strong>(option A) is associated with Flexner&ndash;Wintersteiner rosettes on microscopy, therefore its not correct.&nbsp;</p>\n<p><strong>Rhabdomyosarcoma</strong> is the most&nbsp;common<strong> soft tissue sarcoma </strong>of childhood usually in the head and neck region, most common<strong> primary orbital </strong>malignancy&nbsp;in children.<strong>&nbsp;</strong>They&nbsp;are malignant tumors arising from<strong> voluntary muscle</strong> and produce a rapidly increasing <strong>proptosis</strong>. It extends in all directions. Diagnosis is done using biopsy in which <strong>cross-striations </strong>in the tumor cells are <strong>pathognomonic</strong>. <strong>Myoglobulin</strong> is a <strong>specific</strong>&nbsp;marker&nbsp;but it can also be positive for <strong>desmin</strong>.</p>\n<p>Subtypes include <strong>embryonal</strong>(majority)<strong>, a</strong><strong>lveolar</strong>, <strong>botryoid </strong>and&nbsp;<strong>pleomorphic.</strong></p>\n<p><strong>Treatment</strong>&nbsp;includes<strong>&nbsp;</strong>combination of chemotherapy and radiotherapy.</p>\n<ul>\n<li>Two injections of <strong>vincristine, cyclophosphamide, and actinomycin D</strong> are given at weekly intervals before radiotherapy.</li>\n<li><strong>Radiotherapy</strong> is given during which vincristine and cyclophosphamide are administered weekly.</li>\n<li>After radiotherapy, a combination of vincristine, cyclophosphamide, and doxorubicin is given for a year or longer in those patients in whom metastases were detected.</li>\n</ul>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Other options:</p>\n<p>Option A: <strong>Retinoblastoma</strong> is the&nbsp;most common&nbsp;<strong>intraocular</strong> malignancy&nbsp;in&nbsp;<strong>children</strong>. It is associated with mutations in the&nbsp;<strong>RB1 gene</strong>&nbsp;at chromosome&nbsp;<strong>13q14.&nbsp;&nbsp;</strong>White pupillary reflex&nbsp;or&nbsp;<strong>leukocoria</strong>&nbsp;is the most common presenting feature, followed by a <strong>squint</strong> which is usually convergent. Histopathology of the tumor shows small round cells with large nuclei. Microscopic features includes&nbsp;<strong>Flexner-Wintersteiner rosettes</strong>(highly specific of retinoblastoma)<strong>, Homer-Wright rosettes, pseudorosettes, and fleurettes formation</strong>. Areas of necrosis and calcification can also be seen.&nbsp;</p>\n<p>Option B:&nbsp;<strong>Cavernous hemangioma </strong>is the most common primary&nbsp;<strong>benign</strong>&nbsp;orbital tumor<strong>&nbsp;</strong>in<strong>&nbsp;</strong>adults. They are composed of <strong>large, </strong>dilated <strong>vascular</strong> channels; are more <strong>infiltrative</strong>; frequently involve <strong>deep</strong> structures; and <strong>do not</strong> spontaneously regress. On <strong>histologic</strong> examination, the mass is sharply delineated but unencapsulated with large, cavernous blood-filled vascular spaces, separated by connective tissue stroma.</p>\n<p>Option C: <strong>Orbital cellulitis</strong>&nbsp;is the&nbsp;<strong>most common </strong>cause of<strong> unilateral proptosis </strong>in children<strong>.</strong>&nbsp;It&nbsp;refers to the acute infection of the contents of the orbit&nbsp;<strong>behind</strong>&nbsp;the orbital septum. Features include&nbsp;pain, lid edema, erythema, chemosis, and&nbsp;<strong>axial proptosis.&nbsp;</strong>Increased pain with movement of eyes and&nbsp;<strong>ophthalmoplegia</strong>(decreased ocular motility) is a classic symptom.&nbsp;With posterior exenteration cavernous sinus thrombosis, subdural empyema, and intracranial abscess develop.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old female patient with a history of chronic arthritis on treatment came with complaints of defective vision in both eyes. On examination, vision in RE = 6/12, LE = 6/18, IOP = 18 mmHg in both eyes, the anterior segment was normal, fundus examination and fundus fluorescein angiography (FFA) findings given in the figure. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Choroiditis"
      },
      {
        "id": 2,
        "text": "Chloroquine toxicity"
      },
      {
        "id": 3,
        "text": "Steroid-induced glaucoma"
      },
      {
        "id": 4,
        "text": "Macular edema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical viginette of <strong>female</strong> patient on treatment for chronic arthritis which is most likely the drug <strong>chloroquine</strong> given for <strong>rheumatoid arthritis</strong>, now presenting with <strong>decreased visual acuity</strong>, fundoscopy with a typical <strong>bull's eye sign</strong> and Fundus fluroscein angiography showing <strong>increased fluroscence</strong> in the macular area is suggestive of <strong>chloroquine toxicity</strong>.</p>\n<p><strong>Chloroquine</strong> and it's derivative <strong>hydroxychloroquine</strong> (HCQ) are <strong>antimalarial</strong> drugs which is also used to treat connective tissue disorders such as <strong>Rheumatoid arthritis</strong>, Systemic Lupus Erythematosus (<strong>SLE)</strong> and Discoid Lupus.</p>\n<div class=\"page\" title=\"Page 880\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The maximum dose allowed for <strong>chloroquine</strong> is <strong>6 mg/kg</strong> in 24 hours while for <strong>hydroxychloroquine</strong> it is <strong>4.5 mg/kg. </strong>Hydroxychloroquine has a lower risk of ocular toxicity and hence is percived to be a safer drug but with weaker anti-inflammatory effect.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Manifestations of <strong>Chloroquine toxicity</strong>:</p>\n<ul>\n<li><strong>Reversible</strong> on stopping the drug:<strong>&nbsp;difficulty in night vision</strong>, blurring of vision, diplopia, <strong>keratopathy</strong></li>\n<li>Central and paracentral <strong>scotomas</strong></li>\n<li><strong>Earliest fundus</strong> findings: <strong>blunting of foveal reflex</strong>, irregularity in the macular pigmentation.</li>\n<li><strong>Advanced</strong> stages: '<strong>Bull's eye maculopathy' </strong>where the<strong>&nbsp;</strong>central irregular pigmentation may become surrounded by a concentric zone of hypopigmentation</li>\n<li><strong>End-stage</strong> appearance includes bullseye maculopathy, <strong>pigmentary degeneration of retina</strong>&nbsp;and bone spicule formation, vascular attenuation, and <strong>optic atropy</strong>.</li>\n</ul>\n<div class=\"page\" title=\"Page 849\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Screening</strong> should include a <strong>baseline examination</strong> for all patients before starting these drugs followed by&nbsp;<strong>annual screening</strong> starting <strong>after 5 years</strong> of use.</p>\n<p><strong>Pre-existing maculopathy</strong> is considered a <strong>contraindication</strong>&nbsp;to treatment with chloroquine and HCQ because underlying abnormalities may mask early toxicity.</p>\n<div class=\"page\" title=\"Page 849\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Screening examinations include visual acuity testing, dilated fundus examination, spectral-domain optical coherence tomography (SD-OCT) testing, and functional assessment with Humphrey test.</p>\n<p>Various causes of <strong>Bull's eye maculopathy</strong> are:</p>\n<ol>\n<li><strong>Chloroquine and HCQ toxicity</strong></li>\n<li><strong>Cone-Rod dystrophy</strong></li>\n<li>Advanced stargardt's disease</li>\n<li>Clofazimine retinopathy</li>\n</ol>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b75678189d82477c85b6bdd95dd46016.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man presents with a history of injury to the eye caused by a leaf 5 days ago, resulting in pain, photophobia, and redness of the eye for 2 days. What would be the most likely pathology?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior uveitis"
      },
      {
        "id": 2,
        "text": "Conjunctivitis"
      },
      {
        "id": 3,
        "text": "Fungal corneal ulcer"
      },
      {
        "id": 4,
        "text": "Corneal laceration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option D: <strong>Corneal laceration: </strong>Partial corneal laceration or <strong>lamellar corneal laceration</strong> occurs from a <strong>blunt trauma</strong> and is treated by patching and antibiotics.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c096c57f84794b37997c2853177dc660x372x302.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/938decda907d40fbb4dc1aefb10d627cx1118x1198.JPEG"
    ]
  },
  {
    "text": "What is the angle subtended by the largest alphabet on the Snellen's chart at 60m distance?",
    "choices": [
      {
        "id": 1,
        "text": "5"
      },
      {
        "id": 2,
        "text": "30"
      },
      {
        "id": 3,
        "text": "50"
      },
      {
        "id": 4,
        "text": "10"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>angle</strong> subtended by the <strong>largest alphabet</strong> on the <strong>Snellens chart</strong> at <strong>60m</strong> distance is <strong>5 minutes</strong>.</p>\n<p>Visual acuity is a measure of the spatial resolution of the eye or an estimation of its ability to discriminate between two points. Snellens chart is used for Visual acuity assesment.</p>\n<p>In snellens chart the alphabets decrease in size as we move from above-downwards and these lines, from <strong>above-downwards</strong> should be <strong>read at 60</strong>, 36, 24, 18, 12, 9, 6, 5 and <strong>4 m respectively</strong>. At <strong>these distances</strong>, the <strong>respective letters</strong> subtend a visual angle of <strong>5 minutes</strong>. Hence, the <strong>largest alphabet</strong> that should be <strong>read at 60 m</strong> subtends a visual angle of <strong>5 minutes</strong> in the eye.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0433a3ad16b0474ea4b7897d3a393efbx900x1200.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/192387686eb2481ca5231f8af8a9f6c6x1280x1482.JPEG"
    ]
  },
  {
    "text": "Identify the marked layer of the retina.",
    "choices": [
      {
        "id": 1,
        "text": "Inner plexiform layer"
      },
      {
        "id": 2,
        "text": "External limiting layer"
      },
      {
        "id": 3,
        "text": "Internal limiting layer"
      },
      {
        "id": 4,
        "text": "Outer plexiform layer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> inner plexiform layer</strong> is the marked layer in the given histological image of retina, identified as the <strong>fourth</strong> layer from the uppermost (innermost) layer.</p>\n<p>The retina consists of <strong>10 layers. </strong>The\u00a0<strong>retinal pigment epithelium </strong>(RPE) is the <strong>outermost layer</strong> - below the Bruch's membrane of the choroid - and the <strong>internal limiting membrane</strong> is the <strong>innermost layer </strong>- separating the retina from the vitreous.</p>\n<p>The retinal pigment epithelium consists of a <strong>single layer</strong> of cells containing <strong>pigment</strong>.<strong>\u00a0</strong>It is separated from the neurosensory retinal layers by the\u00a0potential space between them which is known as interphotoreceptor matrix.\u00a0</p>\n<p>The<strong><span data-preserver-spaces=\"true\"> inner plexiform layer</span></strong><span data-preserver-spaces=\"true\">\u00a0consists of\u00a0</span><strong><span data-preserver-spaces=\"true\">synapsing nerve fibers</span></strong><span data-preserver-spaces=\"true\">. The\u00a0</span>axons\u00a0of\u00a0bipolar\u00a0cells synapse with\u00a0dendrites\u00a0of\u00a0ganglion<span data-preserver-spaces=\"true\">\u00a0cells; and both these\u00a0</span>processes synapse\u00a0with processes of\u00a0amacrine<span data-preserver-spaces=\"true\">\u00a0cells. It also contains some horizontally placed\u00a0</span>internal plexiform cells; and also a few\u00a0ganglion cells.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4bb98bfa6f5c4ee79dcef1ef6868e1f2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15d36c08680e478294529651a92c0b63x1280x866.JPEG"
    ]
  },
  {
    "text": "The spectacles shown in the image are not used for the management of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Presbyopia"
      },
      {
        "id": 2,
        "text": "Aphakia"
      },
      {
        "id": 3,
        "text": "Pediatric pseudophakia"
      },
      {
        "id": 4,
        "text": "Hypermetropia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows spectacles made of\u00a0lenses with <strong>two different </strong>optical power. Thus, it is a pair of bifocal spectacles which is <strong>not </strong>used in <strong>hypermetropia</strong>\u00a0or myopia.</p>\n<p><strong>Bifocal glasses</strong> have different corrective powers in the <strong>upper segment</strong>\u00a0for <strong>distant </strong>vision and <strong>lower segment</strong> for <strong>near </strong>vision.\u00a0Thus, they are useful in conditions where both distance and near vision are affected, like the following:\u00a0</p>\n<p>1. <strong>Presbyopia</strong> (option A): It is a definitive indication. It is used to correct <strong>age-related</strong> near and far vision defects.<br />2. <strong>Aphakia</strong> (option B): It provides both near and far vision correction when intra-ocular lens insertion is contraindicated.<br />3. <strong>Paediatric pseudophakia </strong>(option C): It is used to correct refractive errors or accommodative fluctuations post intra-ocular lens (IOL) insertion.<br />4. Non refractive accomodative esotropia</p>\n<p>In <strong>hypermetropia</strong>\u00a0there is defect in near vision only and hence a <strong>single </strong>vision glasses having <strong>uniform</strong> corrective power throught the entire surface is used instead of bifocal glasses.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5e252530de0541509ac7db95e2f52764.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fb5c9284011e422483903a96543763e1x1280x3323.6671368124116.JPEG"
    ]
  },
  {
    "text": "A 6-year-old girl is admitted for evaluation for recurrent seizures. She has a large port-wine stain on the right side of her face as shown below.  The MRI of the head shows a leptomeningeal angioma. What is the most common ocular manifestation of the underlying condition?",
    "choices": [
      {
        "id": 1,
        "text": "Uveitis"
      },
      {
        "id": 2,
        "text": "Retinitis pigmentosa"
      },
      {
        "id": 3,
        "text": "Keratitis"
      },
      {
        "id": 4,
        "text": "Glaucoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C:<strong>Keratitis&nbsp;</strong>is the <strong>inflammation of cornea</strong> which is characterised by <strong>corneal edema</strong>, <strong>cellular infiltration</strong> and <strong>ciliary congestion. </strong>It&nbsp;can be either <strong>infectious</strong> or <strong>non-infectious</strong> in nature which includes allergic keratitis, neurotrophic keratitis, exposure keratitis and peripheral ulcerative keratopathies such as Rosacea keratitis and Mooren's ulcer.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c9f69f3ab6f14c79b326b981eed5f3d6.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44a8ae7adf6d400fbb3ba041e5461c7ax720x621.PNG"
    ]
  },
  {
    "text": "The child in the picture has large corneas, photophobia, and lacrimation. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital glaucoma"
      },
      {
        "id": 2,
        "text": "Retinoblastoma"
      },
      {
        "id": 3,
        "text": "Congenital hereditary endothelial dystrophy"
      },
      {
        "id": 4,
        "text": "Megalocornea"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 862\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Option C:\u00a0<strong>Congenital hereditary endothelial dystrophy </strong>(CHED) is an inherited corneal dystrophy that manifests since <strong>birth</strong> with <strong>endothelial degeneration</strong>. It appears as diffuse <strong>bilateral corneal edema</strong> in the <strong>absence</strong> of <strong>elevated</strong> IOP. The clinical features of the disease include corneal clouding, visual impairment, and nystagmus.</p>\n<p>Option D:<strong> Megalocornea\u00a0</strong>is a bilateral non-progressive <strong>X-linked</strong> condition that most commonly affects <strong>males</strong>. In this condition, the horizontal <strong>corneal diameter</strong>\u00a0is\u00a0<strong>\u226512mm</strong>(&lt;2 years)\u00a0and\u00a0is <strong>\u226513 mm</strong>(&gt;2 years). It is characterized by a clear\u00a0cornea, normal corneal thickness, and <strong>n</strong><strong>o breaks</strong> in the descemet's membrane. Systemic associations of Megalocornea include Marfan's syndrome, Apert syndrome, Ehlers-Danlos, and Down syndrome.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f1a97152fe6549f19cc21f8e764580a6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cfce3f20b960443dbba4d7a8b4c3bbc8x720x331.PNG"
    ]
  },
  {
    "text": "The following image indicates:",
    "choices": [
      {
        "id": 1,
        "text": "Trochlear nerve palsy"
      },
      {
        "id": 2,
        "text": "Lateral rectus palsy"
      },
      {
        "id": 3,
        "text": "Internuclear ophthalmoplegia"
      },
      {
        "id": 4,
        "text": "Occulomotor palsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C: <strong>Internuclear opthalmoplegia</strong> occurs following an <strong>injury</strong> to the <strong>medial longitudinal fasciculus</strong> (MLF). A <strong>unilateral</strong>&nbsp;<strong>lesion </strong>to the&nbsp;<strong>MLF</strong>&nbsp;leads to the&nbsp;<strong>failure </strong>of <strong>adduction</strong>&nbsp;in the <strong>ipsilateral eye&nbsp;</strong>with a <strong>normal abduction</strong> of the <strong>contralateral eye.</strong></p>\n<p>The below given image depicts the pathogenesis of <strong>Inter nuclear opthalmoplegia</strong> in detail.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a0644c911f474ce18074bef8c18cfdfb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59fd838484a34f2e9a775be56c022eefx1280x3519.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/37cc1b31b60b4af7920a6c9fcb44872ex720x1577.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2e4aadadc52245d3b83e21481c29133ex1280x2906.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da9f9fb70f8b4957adcfcf01dab3f4a1x1280x2152.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9bc6adac7c7249939ee269a41dadabfdx1280x2259.JPEG"
    ]
  },
  {
    "text": "A 26-year-old female patient presents with 6/60 visual acuity in one eye and 6/18 in the other eye. She has recurrent episodes of diminution of vision which recovers on treatment with steroids. She also has a history of transverse myelitis. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hereditary spastic quadriplegia"
      },
      {
        "id": 2,
        "text": "Subacute combined degeneration"
      },
      {
        "id": 3,
        "text": "Neuromyelitis optica"
      },
      {
        "id": 4,
        "text": "Multiple sclerosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of a patient presenting with <strong>decreased visual acuity</strong> and a\u00a0<strong>history of transverse myelitis</strong>\u00a0which is treated with steroids is indicative of <strong>Neuromyelitis optica</strong> (NMO).</p>\n<p>Neuromyelitis optica also known as <strong>Devic's disease</strong> is an <strong>autoimmune\u00a0demyelinating</strong>\u00a0disease in which <strong>antibodies</strong> are formed <strong>against</strong> <strong>Aquaporin 4</strong> present in the cell membranes of <strong>Astrocytes</strong>. It is characterized by the findings of unilateral or bilateral <strong>optic neuritis</strong>\u00a0developing within a few weeks of <strong>transverse myelitis</strong>(demyelination of the spinal cord). The disease may be monophasic or recurrent.</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Diagnostic Criteria for Neuromyelitis Optica Spectrum Disorder (NMOSD):</p>\n<p class=\"p2\"><strong>Diagnostic Criteria for NMOSD associated with AQP4-IgG</strong></p>\n<ol>\n<li class=\"p3\">At least\u00a0<strong>1</strong>\u00a0core clinical characteristic</li>\n<li class=\"p3\">A positive test for\u00a0<strong>AQP4-IgG</strong>\u00a0using the best available detection method (<strong>cell-based assay</strong>)</li>\n<li class=\"p3\">Exclusion of alternative diagnoses</li>\n</ol>\n<p>\u00a0<strong>Core Clinical Characteristics</strong>:</p>\n<ol>\n<li>Optic neuritis is usually bilateral and causes <strong>severe visual loss.</strong></li>\n<li>\u00a0Acute myelitis- may be\u00a0<strong>severe, transverse</strong>\u00a0and typically longitudinally extensive involving three or more contiguous vertebral segments.</li>\n<li>Area postrema syndrome: episodes of otherwise unexplained hiccups or nausea or vomiting</li>\n<li>Acute brainstem syndrome</li>\n<li>Symptomatic\u00a0<strong>narcolepsy</strong>\u00a0 associated with NMOSD-typical diencephalic MRI lesions</li>\n</ol>\n<p>For acute cases of NMO,\u00a0<strong>high-dose glucocorticoids</strong>\u00a0or plasma exchange is used.\u00a0<strong>Mycophenolate mofetil, rituximab,</strong>\u00a0and\u00a0<strong>glucocorticoids with azathioprine</strong>\u00a0are used for prophylaxis against relapses.</p>\n<div class=\"page\" title=\"Page 3590\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 3590\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;The FDA has approved Satralizumab, a humanized IgG2 monoclonal antibody for the treatment of neuromyelitis optica spectrum disorder (NMOSD) in adults with particular antibody patients who are anti-aquaporin-4 or AQP4 antibody-positive. &quot;}\" data-sheets-userformat=\"{&quot;2&quot;:33555327,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:65535},&quot;5&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;6&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;7&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;8&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;9&quot;:0,&quot;11&quot;:4,&quot;12&quot;:0,&quot;28&quot;:1}\">The FDA has approved\u00a0<strong>satralizumab,</strong> a humanized IgG2 monoclonal antibody, for the treatment of NMO spectrum disorder with AQP4 antibody positivity.</span></p>\n<div class=\"page\" title=\"Page 3520\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Eculizumab,</strong>\u00a0a complement inhibitor, and inebilizumab<strong>,</strong>\u00a0a B-cell depletion agent, are two more new drugs that have recently been approved for use in NMO attack prevention.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"row mt-3\">\u00a0A history of transverse myelitis with optic neuritis(decreased visual acuity) rules out<strong> Multiple sclerosis</strong>(option D)<strong>. </strong>It<strong>\u00a0</strong>is an <strong>autoimmune </strong>inflammatory\u00a0and <strong>demyelinating</strong> disease of the <strong>CNS</strong>\u00a0that affects both upper motor neurons (<strong>UMN</strong>) and lower motor neurons (<strong>LMN</strong>) with involvement of sensory system, ocular system and bowel and bladder function.\u00a0<strong>Ocular </strong>manifestations of MS include\u00a0<strong>Optic neuritis</strong>(usually <strong>retrobulbar</strong>)- decreased visual acuity,\u00a0internuclear ophthalmoplegia and\u00a0nystagmus<strong>.</strong></div>\n<div class=\"page\" title=\"Page 759\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the site of lesion in internuclear ophthalmoplegia?",
    "choices": [
      {
        "id": 1,
        "text": "Medial Longitudinal Fasciculus"
      },
      {
        "id": 2,
        "text": "6th Nerve nucleus"
      },
      {
        "id": 3,
        "text": "Pontine paramedian reticular formation"
      },
      {
        "id": 4,
        "text": "A & C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In internuclear ophthalmoplegia (INO) the lesion is at the <strong>medial longitudinal fasciculus </strong>(MLF).</p>\n<p>In INO, there is&nbsp;<strong>impaired adduction</strong>&nbsp;on the&nbsp;<strong>ipsilateral</strong>&nbsp;side of the lesion, and<strong>&nbsp;nystagmus on abduction&nbsp;</strong>on the&nbsp;<strong>contralateral side</strong>. When the gaze is initiated in the motor cortex, the horizontal gaze center or the <strong>paramedian pontine reticular formation</strong>&nbsp;(PPRF) generates the eye movements.</p>\n<p>The PPRF has&nbsp;<strong>two outputs</strong>. The first is to the&nbsp;<strong>ipsilateral 6th cranial nerve nucleus</strong>&nbsp;which causes abduction of the ipsilateral eye. The second output is to the <strong>contralateral</strong> <strong>MLF</strong>&nbsp;which sends an impulse to the&nbsp;<strong>contralateral 3rd cranial nerve nucleus</strong>&nbsp;causing contralateral adduction. These two outputs from PPRF lead to conjugate movement of the eyes to the same side.&nbsp;</p>\n<p>Therefore, a<strong> lesion </strong>in the<strong> right MLF</strong> leads to <strong>failure </strong>of the<strong> right eye adduction</strong>. The <strong>left eye</strong>, however, <strong>abducts normally</strong>. This is called <strong>internuclear ophthalmoplegia</strong>.</p>\n<p>The following image shows the pathway for horizontal eye movements as described above.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ffe506e7bffa4858b3825b7f36d2cfd2x1280x2152.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/836881526ea24eafbaa3a6dc3f6fc92bx1280x2259.JPEG"
    ]
  }
];
        let quizName = '122 Ophthalmology Aiims 2018';
        let hierarchy = ["Marrow", "PYQs", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>