<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instruments Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the ideal site of placement of the instrument shown below when it is being used for feeding purposes?",
    "choices": [
      {
        "id": 1,
        "text": "Prepyloric region"
      },
      {
        "id": 2,
        "text": "Postpyloric region"
      },
      {
        "id": 3,
        "text": "Gastro-esophageal junction"
      },
      {
        "id": 4,
        "text": "Oesophagus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the nasogastric<strong>/Ryle's tube.</strong>&nbsp;The&nbsp;<strong>ideal location</strong>&nbsp;for an NG<strong>&nbsp;feeding tube&nbsp;</strong>is<strong>&nbsp;postpyloric&nbsp;</strong>to<strong>&nbsp;decrease&nbsp;</strong>the risk of<strong>&nbsp;aspiration</strong>.</p>\n<p>The ideal location for an NG tube placed for<strong>&nbsp;suction&nbsp;</strong>is&nbsp;<strong>within the stomach</strong>&nbsp;because placement past the pylorus can cause damage to the duodenum.&nbsp;</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">Nasogastric tubes play a standard role in treating intestinal obstruction and can also be used to provide nutritional support. The commonly used method to determine the length of a nasogastric tube is the&nbsp;<strong>NEX method.</strong></div>\n<div class=\"ng-scope\">&nbsp;</div>\n<div class=\"ng-scope\">NEX method:</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li>The<strong>&nbsp;tip of the nose&nbsp;</strong>to<strong>&nbsp;ear&nbsp;</strong>to<strong>&nbsp;xiphisternum</strong>.</li>\n<li>The tube length should be estimated before insertion.</li>\n<li>Place the exit port of the tube at the&nbsp;<strong>tip of the nose</strong>. Extend tube to the&nbsp;<strong>earlobe</strong>, and then to&nbsp;<strong>xiphisternum</strong>.</li>\n</ul>\n<p>Approximate length<strong>&nbsp;</strong>to be inserted: 55cm</p>\n<p>Ideally, Ryle's tube is inserted in the<strong>&nbsp;sitting position&nbsp;</strong>with the&nbsp;<strong>neck slightly flexed</strong>. Confirmation of the correct position is done by the following:</p>\n<ul>\n<li>Auscultation in the epigastric area while injecting a bolus of air</li>\n<li>An&nbsp;<strong>abdominal X-ray</strong>&nbsp;is the&nbsp;<strong>best</strong>&nbsp;wa<strong>y</strong>&nbsp;to<strong>&nbsp;confirm</strong>&nbsp;the&nbsp;<strong>location</strong>&nbsp;of the tube</li>\n</ul>\n<p>The ideal&nbsp;<strong>location</strong>&nbsp;for an NG tube placed for&nbsp;<strong>suction&nbsp;</strong>is&nbsp;within the&nbsp;<strong>stomach</strong>&nbsp;because placement past the pylorus can cause damage to the duodenum. The&nbsp;ideal<strong>&nbsp;location</strong>&nbsp;for an NG<strong>&nbsp;feeding tube&nbsp;</strong>is<strong>&nbsp;postpyloric&nbsp;</strong>to&nbsp;decrease<strong>&nbsp;</strong>the risk of&nbsp;aspiration.</p>\n<p><strong>Indications</strong>&nbsp;for NG tube:</p>\n<ul>\n<li>Aspiration of gastric fluid</li>\n<li>Gastric decompression in cases of&nbsp;<strong>intestinal obstruction</strong>&nbsp;and&nbsp;<strong>paralytic ileus.</strong></li>\n<li>Zollinger-Ellison syndrome is characterized by hypersecretion of gastrin resulting in acid-induced diarrhoea that is controlled by&nbsp;<strong>nasogastric aspiration of gastric secretions</strong>&nbsp;</li>\n<li>Feeding</li>\n<li>Administration of medication</li>\n<li>Bowel irrigation</li>\n</ul>\n<p><strong>Contraindications</strong>&nbsp;for NG tube:</p>\n<ul>\n<li>Absolute:\n<ul>\n<li>Severe midface trauma</li>\n<li>Recent nasal surgery</li>\n<li>Basilar skull fractures</li>\n</ul>\n</li>\n<li>Relative:\n<ul>\n<li>Coagulation abnormality</li>\n<li><strong>Caustic ingestion</strong></li>\n<li>Esophageal trauma/ obstruction</li>\n<li>Esophageal varices</li>\n<li>Recent banding of oesophagal varices</li>\n<li>Anastomoses in the stomach and oesophagus</li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n<p>Approximate length of the tube: 120-125&nbsp;cm</p>\n<p>Markings&nbsp;indicating traversing of the tube through various parts of the stomach</p>\n<ul>\n<li>40 cm - Traversed cardia of stomach</li>\n<li>50 cm - Traversed body of stomach</li>\n<li>60 cm - Traversed pylorus</li>\n<li>70 cm - Traversed duodenum</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/72b595efefdd43478549534f98938bc2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dabd9a6225d04d6f8c83a236f328f8fex720x540.JPEG"
    ]
  },
  {
    "text": "A surgeon working in a community health centre notices that the following suture material shown in the image is the only suture available in stock for use. In which of the following conditions is this suture material not useful?",
    "choices": [
      {
        "id": 1,
        "text": "Stoma closure"
      },
      {
        "id": 2,
        "text": "Ligation of superficial vessels"
      },
      {
        "id": 3,
        "text": "Hernia repair"
      },
      {
        "id": 4,
        "text": "Suturing of  subcutaneous tissue"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The suture material shown in the image is <strong>plain catgut</strong> which is a yellowish absorbable suture material and cannot be used in procedures like hernia repair that require prolonged support.</p>\n<p><strong>Plain catgut:</strong></p>\n<ul>\n<li>It is made of collagen derived from healthy sheep or cattle.\u00a0</li>\n<li>It is absorbed by\u00a0Phagocytosis and enzymatic degradation within 7\u201310 days.</li>\n<li>It is used to ligate superficial vessels, suture subcutaneous tissues, stomas, and other tissues that heal rapidly. The tensile strength is lost within 7\u201310 days and shows marked patient variability.</li>\n</ul>\n<p><strong>Contraindications</strong>:\u00a0Not for use in tissues that heal slowly and require prolonged support. Synthetic absorbable sutures are superior in this case.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/244034dd65f14d89bcdca4baabf71100.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are an intern observing a surgery where the stones from the bile duct are removed. The instrument given below is used. Name the instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Lane forceps"
      },
      {
        "id": 2,
        "text": "Kocher forceps"
      },
      {
        "id": 3,
        "text": "Desjardins forceps"
      },
      {
        "id": 4,
        "text": "Lister forceps"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The instrument in the given image is<strong> Desjardins choledocholithotomy forceps</strong>. It is used for the&nbsp;<strong>removal of stones </strong>from<strong> </strong>the<strong>&nbsp;</strong><strong>common bile duct.</strong></p>\n<p>This is a long and slender instrument. The shaft is curved and there is a <strong>fenestra</strong> at the <strong>tip</strong>. It does not have a lock hence, accidental damage to CBD mucosa or crushing of the CBD stone is avoided.</p>\n<p>Other options:&nbsp;</p>\n<p>Option A:&nbsp;<strong>Lane tissue-holding forceps </strong>have a stout and thick distal blade, with an <strong>oval fenestra</strong> in each blade. It has a <strong>lock</strong> in the proximal part. It is used to hold <strong>bulky and tough structures</strong>&nbsp;and lymph nodes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0ff9591dfd5d44dda9e351f2ac907669.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65a68547d9674ffb90b97e3bbb470246x1280x1431.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea1901d9fb3f4463859b483a274b3b03x1280x1074.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0fb84b302bc4fff8b6b16a6df12a3d2x1280x948.JPEG"
    ]
  },
  {
    "text": "A 60-year-old male patient who is a chronic alcoholic presented to the emergency room following two episodes of hematemesis and is currently hypotensive. The surgical resident on duty tries to control the bleeding with the instrument shown in the below image. Identify this instrument?",
    "choices": [
      {
        "id": 1,
        "text": "Sengstaken-Blakemore tube"
      },
      {
        "id": 2,
        "text": "Minnesota tube"
      },
      {
        "id": 3,
        "text": "Linton-Nachlas tube"
      },
      {
        "id": 4,
        "text": "Ewald's tube"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows the <strong>Minnesota tube</strong>.</p>\n<p>The given clinical scenario i.e chronic alcoholic with haematemesis is suggestive of&nbsp;<strong>esophageal variceal bleeding,&nbsp;</strong>in which&nbsp;<strong>temporary</strong> hemostasis can be achieved with the help of&nbsp;balloon tamponades.</p>\n<p><strong>Minnesota tube</strong>:This tube allows the aspiration of both gastric and oesophageal contents. It&nbsp;has 4 openings &ndash; 2 suction tubes and 2 inflation tubes - namely,</p>\n<ul>\n<li>Gastric aspiration port</li>\n<li>Oesophageal aspiration port</li>\n<li>Gastric balloon port</li>\n<li>Oesophageal balloon port</li>\n</ul>\n<p>Protocol-based management of esophageal varices is given below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6cfcc35d961d4f46aea7bb4bb625d095.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a9aaf177cdd4aa6b8db8c07b1a841a9x1280x1492.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13bc3b7ffa974f26982ebba824c82b33x720x558.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fbefde365cca49f289147163e4a050adx1279x1216.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7a44474afabf49e0a3cc48f630c8ec79x1279x1617.JPEG"
    ]
  },
  {
    "text": "The following drain is placed after mastectomy. Identify the type of drain.",
    "choices": [
      {
        "id": 1,
        "text": "Open"
      },
      {
        "id": 2,
        "text": "Closed"
      },
      {
        "id": 3,
        "text": "Semi open"
      },
      {
        "id": 4,
        "text": "Semi closed"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>Romo Vac drain</strong>, depicted in the image, is a <strong>closed type</strong> of drain commonly used after <strong>mastectomy</strong>.</p>\n<p><strong>Drains</strong> are placed at surgical sites to freely collect the air or fluids that may accumulate. This <strong>enhances wound healing</strong> by preventing the formation of unnecessary cavities. Drains are prophylactic in elective surgeries and therapeutic in emergency surgeries. Drains can be -</p>\n<ul>\n<li><strong>Open</strong> - They are based on the principle of <strong>gravity&nbsp;</strong></li>\n<li><strong>Semi-open</strong> - Their action is based on <strong>capillary effect</strong></li>\n<li><strong>Closed</strong> - They carry out their actions through <strong>suction</strong></li>\n</ul>\n<p>Suction drains are commonly used in chest, <strong>breast</strong>, abdominal, thyroid, and plastic surgeries. They remove intraperitoneal secretions, anastomotic leaks, and blood from hemorrhage at the surgical site.&nbsp;<strong>Romo Vac drain&nbsp;</strong>is a <strong>negative suction drain closed</strong> drain kept in the subcutaneous tissue. Romo Vac drain is indicated in modified radical mastectomy, subcutaneous swelling excision, and amputations.&nbsp;</p>\n<p>Special types of drains:</p>\n<ul>\n<li><strong>Chest drains</strong> are connected to an underwater seal to aid the exit of air from the pleural cavity. They are used in pneumothorax, pleural effusion, and hemothorax.&nbsp;</li>\n<li>After surgical exploration of the bile duct, the sphincter of Oddi goes into spasm. To facilitate drainage of bile, a <strong>T tube</strong> may be used.&nbsp;</li>\n</ul>\n<p>Drain insertion site care:&nbsp;The site of insertion of the drain is kept clean by drying and patting the drain insertion site with a clean towel after bath. The dressing is changed daily with folded gauze pieces placed below and above the drain site.&nbsp;</p>\n<p>Removal of drains: The catheter at the site is milked for residual collections. It is then clamped and the suture holding the catheter is cut. The tube is then gently pulled out and any clots at the perforation end are removed. The time of removal of drains for various conditions is as given below.&nbsp;</p>\n<ul>\n<li>Drains used in surgeries like <strong>thyroidectomy</strong> are usually removed within <strong>24 hours</strong>. Their main purpose is to cover postoperative bleeding.&nbsp;</li>\n<li>In a <strong>mastectomy</strong>, a drain is placed for <strong>5 days</strong> to collect serous collections.</li>\n<li>Drains used to cover the <strong>colorectal anastomoses</strong> are placed for <strong>5-7 days.</strong></li>\n<li>Common bile duct<strong> T-tube drains</strong> are usually placed for<strong> 10 days.</strong></li>\n<li>Drains for infections are removed when the infection subsides or when the content of the drain is minimal.</li>\n</ul>\n<p>After the drain is removed, a folded gauze is placed over the drain insertion area.&nbsp;The dressing can be removed after 24 hours. The patient may be given an antibiotic ointment to apply over the area for a week.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5f28c703283a4495bf02b228d4e68164.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the brace given below and its use.",
    "choices": [
      {
        "id": 1,
        "text": "Milwaukee brace, Scoliosis"
      },
      {
        "id": 2,
        "text": "Anterior spinal hyperextension brace, Dorso-lumbar injury"
      },
      {
        "id": 3,
        "text": "Taylor brace, Dorso-lumbar injury"
      },
      {
        "id": 4,
        "text": "Sterno-occipital mandibular immobilization brace, cervical spine injury"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows<strong> a sterno-occipital mandibular immobilization</strong> (SOMI) <strong>brace</strong>\u00a0which is used for <strong>cervical spine injuries.</strong></p>\n<p>The SOMI brace contains a <strong>rigid anterior chest piece</strong> connected to rigid shoulder<strong> </strong>supports by straps across the patient\u2019s back. The <strong>mandibular support</strong> can be removed during eating. The brace provides <strong>good restriction</strong> to <strong>flexion</strong>.</p>\n<p>It is indicated in\u00a0relatively stable injuries to the <strong>lower cervical spine</strong>,\u00a0postoperatively for patients with questionable fixation, or in the treatment of <strong>cervicothoracic injuries</strong>.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5bcba00c32e3491f9644619e4678a5dc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9ef2fa45f06844fdae2e8ea71f1c06dex1280x3139.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fcb707c7b60543b4a882f5427d554f24x330x339.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7e4971332d9d445b849075144447c763x1279x1865.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/519420d3dacd4fb4baa4a166bb674c35x1279x1262.JPEG"
    ]
  },
  {
    "text": "A woman who came to the ENT Outpatient department was tested with the instrument given below for impaired hearing. Which of the following tests can be performed with this instrument?",
    "choices": [
      {
        "id": 1,
        "text": "2,3,5"
      },
      {
        "id": 2,
        "text": "3,4,5"
      },
      {
        "id": 3,
        "text": "1,2,4"
      },
      {
        "id": 4,
        "text": "1,2,5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span style=\"font-size: 12pt;\">The instrument given in the image is a\u00a0<strong>t</strong><strong>uning fork. Weber\u2019s test</strong>,\u00a0<strong>Schwabach\u2019s</strong> test, and <strong>Gelle\u2019s</strong> test can be done with a tuning fork.</span></p>\n<p><span style=\"font-size: 12pt;\"><strong>Tuning fork tests</strong> are performed commonly with tuning forks of frequencies such as 128, 256, 512, 1024, etc. The tuning fork of <strong>512 Hz</strong> is considered <strong>ideal</strong> as forks of lower frequencies produce a sense of bone vibration, while those of higher frequencies have a shorter decay time. Some examples of commonly done tuning fork tests are as follows:</span></p>\n<p><span style=\"font-size: 12pt;\"><strong>Weber\u2019s test </strong>is done by placing a vibrating tuning in the middle of the forehead or the vertex, and the patient is asked in which ear the sound is better heard. The inferences are as follows:</span></p>\n<ul>\n<li><span style=\"font-size: 12pt;\">It is reported as normal when the sound is heard equally in both ears</span></li>\n<li><span style=\"font-size: 12pt;\">In <strong>conductive</strong> deafness, it is lateralised to the <strong>worst</strong> ear.</span></li>\n<li><span style=\"font-size: 12pt;\">In <strong>sensorineural</strong> deafness it is lateralized to the <strong>better</strong> ear.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed0e6130ea984d71a27bdac1e7779db8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3fa3f86cc7e74fc3b274886bd12d3332x1279x1605.JPEG"
    ]
  },
  {
    "text": "Identify the following instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Negus knot tier"
      },
      {
        "id": 2,
        "text": "Tonsil dissector"
      },
      {
        "id": 3,
        "text": "Denis Browne forceps"
      },
      {
        "id": 4,
        "text": "Eves\u2019 tonsil snare"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The instrument given in the image is\u00a0<strong>Eves\u2019 tonsil snare.\u00a0</strong></p>\n<p>Eves\u2019 tonsil snare\u00a0is used for <strong>tonsillectomy</strong> and the wire used is <strong>number 25 SWG</strong>. After the tonsil has been dissected to its lower pole, the snare is passed around\u00a0the tonsil to <strong>engage</strong> the <strong>pedicle</strong> and then firmly closed. It <strong>crushes</strong> and <strong>cuts</strong> the pedicle thereby minimizing bleeding.</p>\n<p>Other options:</p>\n<div class=\"page\" title=\"Page 535\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Option A: Negus knot tier is also an instrument that is used in <strong>tonsillectomy. </strong>\u00a0It helps to carry the <strong>ligature knot</strong> till the <strong>tip of the artery</strong> <strong>forceps</strong> which holds the vessel and then tie it.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5a7497a9859f463aa281094b373a0a5b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1546087ab074729bf2a91a05103b514x213x836.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/74300c6bff4d462185bb4c1f1265f7cdx1280x2167.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0da3c0fbf1bb40dd92fc2798a4c5615cx1280x875.JPEG"
    ]
  },
  {
    "text": "A 20-year-old male patient presented with swelling and pain in the right leg, which is worse at night. Pain relieves on NSAIDs. You suspect osteoid osteoma. Which of the following instruments is used to remove the entire nidus of the osteoma?",
    "choices": [
      {
        "id": 1,
        "text": "B"
      },
      {
        "id": 2,
        "text": "A"
      },
      {
        "id": 3,
        "text": "D"
      },
      {
        "id": 4,
        "text": "C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The instrument used to <strong>remove</strong> the entire <strong>nidus </strong>of <strong>osteoid osteoma</strong> is the <strong>curette</strong> shown in <strong>image B</strong>.</p>\n<p>A curette is used for curetting a cavity in bone or removing fibrous tissue from the ends of the fracture. It is used in <strong>enchondroma, giant cell tumors,\u00a0</strong>tubercular cavities of the bone,\u00a0and <strong>osteomyelitis.</strong></p>\n<p>The instruments in the image are:</p>\n<ul>\n<li>Image A: Periosteal elevator</li>\n<li>Image B: Curette</li>\n<li>Image C: Osteotome</li>\n<li>Image D: Bone gouge</li>\n</ul>\n<p>Osteoid osteoma is a <strong>benign</strong> neoplasm most often seen in young men. A typical patient presents with <strong>pain that is worse at night</strong> and is <strong>relieved</strong> by aspirin or <strong>NSAIDs</strong>. Plain radiographs are sufficient to make the diagnosis, but<strong> CT </strong>is the<strong> best</strong> technique to identify the nidus and confirm the diagnosis. Treatment includes medical management with long-term anti-inflammatory medications, percutaneous radiofrequency ablation, and surgical treatment. Surgical treatment involves removal of the entire nidus, this can be accomplished by<strong> curettage or en bloc resection</strong>.</p>\n<p><strong>Image A</strong>\u00a0is the\u00a0<strong>periosteal elevator</strong>. It is used to elevate the periosteum as nerves, and vessels are generally on this plane, and once this has been elevated the surgeon is on a safer plane.</p>\n<p><strong>Image C</strong> represents an\u00a0<strong>osteotome\u00a0</strong>that can be\u00a0used to <strong>cut bone</strong>\u00a0while performing an osteotomy.\u00a0An\u00a0osteotome has <strong>both sides beveled.</strong></p>\n<p><strong>Image D</strong>\u00a0is\u00a0<strong>bone gouge</strong>, a <strong>concave-bladed</strong> chisel used for cutting on round bone surfaces or making round holes in the bone.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a2eef9314a684ca6a4d39214636741f0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Name  the instrument given below is:",
    "choices": [
      {
        "id": 1,
        "text": "Morris Retractor"
      },
      {
        "id": 2,
        "text": "Czerny\u2019s Retractor"
      },
      {
        "id": 3,
        "text": "Double hook Retractor"
      },
      {
        "id": 4,
        "text": "Deaver\u2019s Retractor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows<strong> Czerny's retractor. </strong>Czerny&rsquo;s Retractor is a <strong>double-ended retractor</strong> used to retract wound edges for <strong>intermediate-type procedures</strong>. One end has a blade with a lip which helps to retract without the edge slipping. The other end has two prongs and helps to retract the ends of an incision. <br /> <br /><strong>Option A: Morris Retractor</strong> is a big retractor which is useful for giving a maximum exposure in large incisions such as those used in the abdomen. It can be used to improve visibility on one side of an incision (by pulling firmly in that direction); so is valuable during the initial phase of <strong>a laparotomy</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b084f23dd01c47af8ad2d4aa587ecdb4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7682fed5abc54384865671c9abfd99e1x1280x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1cbb711d983a450ca48f863270c289cfx1280x859.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d873150d9e284a9692f2d81dd9d61269x1280x1022.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b1844335836f4b0caa73358b49e8ccd1x1280x745.JPEG"
    ]
  },
  {
    "text": "All of the following are the uses of the instrument  given in the image except______",
    "choices": [
      {
        "id": 1,
        "text": "To differentiate between chronic inversion and fibroid polyp"
      },
      {
        "id": 2,
        "text": "To diagnose cervical stenosis"
      },
      {
        "id": 3,
        "text": "To recanalize fallopian tube."
      },
      {
        "id": 4,
        "text": "To measure the uterine cavity and the cervical length"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><span class=\"s1\">The instrument shown in the above image is&nbsp;<strong>Simpson&rsquo;s uterine sound.&nbsp;</strong>It is <strong>not used </strong>in the<strong> fallopian tube recanalization </strong>procedure.</span></p>\n<div class=\"page\" title=\"Page 583\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span class=\"s1\">Simpson&rsquo;s u</span>terine sound is a 30 cm-long angulated instrument. It has a <strong>handle</strong> at one end and a <strong>rounded blunt tip</strong> at the other. The <strong>angulation</strong> of the instrument accommodates for<strong> flexion</strong> of the uterus</p>\n</div>\n</div>\n</div>\n<p class=\"p1\"><span class=\"s1\">Uses:</span></p>\n<ul class=\"ul1\">\n<li class=\"li1\"><span class=\"s1\">To measure <strong>uterine cavity</strong> and <strong>cervical length</strong></span></li>\n<li class=\"li1\"><span class=\"s1\">To diagnose <strong>cervical stenosis</strong></span></li>\n<li class=\"li1\"><span class=\"s1\">To sound a <strong>polyp</strong>, <strong>IUCD</strong>, or <strong>uterine septum</strong></span></li>\n<li class=\"li1\"><span class=\"s1\"><span class=\"s1\">To <strong>break</strong> uterine <strong>adhesions&nbsp;</strong></span></span>in Asherman syndrome</li>\n<li class=\"li1\"><span class=\"s1\">To differentiate between chronic <strong>inversion</strong> and fibroid <strong>polyp.</strong></span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/04fabcb857a94a218d6ced03d6f47d2f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the instrument shown in the image and the site at which it is used for taking samples.",
    "choices": [
      {
        "id": 1,
        "text": "Ayre's spatula used at the squamocolumnar junction"
      },
      {
        "id": 2,
        "text": "Ayre's spatula used at the endocervix"
      },
      {
        "id": 3,
        "text": "Cytobrush used at the endocervix"
      },
      {
        "id": 4,
        "text": "Cytobrush used at the squamocolumnar junction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The instrument in the given image is a\u00a0<strong>cytobrush</strong> which is used to take samples from the <strong>endocervix </strong>for<strong>\u00a0</strong>a<strong> Pap smear</strong>.\u00a0<strong>Ayre\u2019s spatula</strong> is used to take samples from\u00a0the <strong>squamocolumnar junction</strong>.</p>\n<p>The instruments used for a pap smear are summarized in the image below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed1551c09eb04e89839305de3dee3e1b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99726eb5aa7043c9bbf1fc7687c260e1x1280x4698.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e86b6ffcf38479392619e6daa03fd1ax1280x4766.JPEG"
    ]
  },
  {
    "text": "Identify the false statement about the instrument given below.",
    "choices": [
      {
        "id": 1,
        "text": "Palmer's point is the preferred entry site in high-risk patients."
      },
      {
        "id": 2,
        "text": "Potential for bowel injury is lesser in the technique using this instrument."
      },
      {
        "id": 3,
        "text": "Used for creating pneumoperitoneum by closed method."
      },
      {
        "id": 4,
        "text": "Preferred in patients with previous abdominal surgeries."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image is that of a <strong>Hasson</strong>&nbsp;<strong>trocar</strong> which is used in the <strong>open method</strong> of creating <strong>pneumoperitoneum</strong>.</p>\n<div class=\"page\" title=\"Page 133\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>There are two methods used for the creation of a pneumoperitoneum:</p>\n<ol>\n<li>Closed method</li>\n<li>Open method</li>\n</ol>\n<p>The <strong>open</strong> method is <strong>preferred</strong> for patients who have undergone<strong> previous abdominal surgeries</strong> as the small bowel may be adherent to the undersurface of the abdominal wound. The use of the <strong>open technique</strong> for creating a pneumoperitoneum <strong>avoids </strong>the<strong> morbidity</strong> related to a blind puncture.</p>\n<p>To achieve this, a 1 cm vertical or transverse <strong>incision</strong> is made at the level of the umbilicus, <strong>stay sutures</strong> are applied, and the fascia is dissected.&nbsp;Free penetration into the abdominal cavity is confirmed by the gentle introduction of a finger.&nbsp;A&nbsp;<strong>Hasson trocar</strong> is inserted and anchored, and a pneumoperitoneum is created.</p>\n<p>The safest site of entry in high-risk patients is the <strong>left upper quadrant</strong>, better known as <strong>Palmer's point</strong>. This site is <strong>3&thinsp;cm below</strong> the <strong>left costal margin</strong> in the midclavicular line. It is rarely affected by adhesions.</p>\n<p>The <strong>closed method</strong>&nbsp;using the <strong>Veress </strong>needle has a small but significant potential for intestinal or vascular injury on the introduction of the needle or trocar.&nbsp;<strong>Proper placement</strong> of the needle can be determined by the <strong>inability to re-aspirate</strong> injected saline. The normal <strong>insufflation</strong> rate is<strong> 4-6 litres/min.</strong></p>\n<p>The image below shows a Veress needle.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1977a9c7ee8a4ceaabc6f941e41ddd70.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/294f1ffa5ff34eca9de8a65bf7ab08dcx1280x964.JPEG"
    ]
  },
  {
    "text": "The instrument shown in the image is used for:",
    "choices": [
      {
        "id": 1,
        "text": "Correcting asynctilism"
      },
      {
        "id": 2,
        "text": "Delivery of occipitotransverse position in platypelloid pelvis"
      },
      {
        "id": 3,
        "text": "Delivery of after coming head in breech delivery"
      },
      {
        "id": 4,
        "text": "Outlet forceps used to provide traction force"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows<strong>\u00a0Wrigley's forceps,</strong> which is an <strong>outlet forceps</strong> used to <strong>provide traction force</strong>.</p>\n<p><strong>\u00a0Wrigley's forceps</strong>\u00a0are used exclusively in outlet forceps operations for the extraction of the head. It is used to provide traction force. The instrument is light and short due to a reduction in the length of the shanks and handles. It has a marked cephalic curve with a slight pelvic curve.\u00a0Outlet forceps are used when:</p>\n<ul>\n<li>The fetal scalp is visible without separating the labia</li>\n<li>The fetal skull has reached the pelvic floor, at or on the perineum</li>\n<li>The sagittal suture is in the anteroposterior diameter or right or left occiput anterior or posterior position (rotation does not exceed 45\u00b0)</li>\n</ul>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Kielland forceps\u00a0</strong>are used in correcting <strong>asynctilism</strong>.</p>\n<p>Option B:\u00a0<strong>Barton forceps\u00a0</strong>are\u00a0used for delivery of <strong>occipitotransverse positions</strong> in a platypelloid pelvis.</p>\n<p>Option C:\u00a0<strong>Piper forceps\u00a0</strong>have a distinct perineal curve and allows for application to the\u00a0<strong>after-coming head </strong>in <strong>breech delivery.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/abb23716627e419497c85ac0f8ea11a8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old man presented to you with complaints of pain over the nose after falling from height. On examination, there is a fracture of the nasal septum. Which of the following instruments would you use during the surgery for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>nasal septum fracture.</strong> The instrument used during surgery for this condition is <strong>Asch forceps</strong> as seen in the <strong>image 2.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5ab0f96082ad4d5f8ffe8c207d51fd41.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd7945010cf14a8e9fb0c3c5cfa8d5e8x600x312.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c1bb8efdb554f7fa522a0961dc8855ex1280x1274.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a05a27ef5d20400fbf8543bc97137344x599x472.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a93d5a10b62941b0818de544ed0c35b3x600x495.JPEG"
    ]
  },
  {
    "text": "Which of the following instruments are used in myomectomy?",
    "choices": [
      {
        "id": 1,
        "text": "1,4"
      },
      {
        "id": 2,
        "text": "1,3"
      },
      {
        "id": 3,
        "text": "2,4"
      },
      {
        "id": 4,
        "text": "2,3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The instruments used in myomectomy are <strong>Bonney's myomectomy clamp</strong> (Image 2) and <strong>Doyen Myoma Screw</strong> (Image 4).</p>\n<p><strong>Bonney's myomectomy</strong> clamp is used in <strong>open myomectomy. </strong>It has two sets of finger grips and a locking ratchet mechanism. It helps in controlling hemorrhage and providing a blood-free environment while performing myomectomy. The clamp is usually applied from the pubic end of the abdominal wound, gripping the round ligaments that contain uterine vessels.</p>\n<p><strong>Doyen Myoma Screw </strong>is also used in <strong>open myomectomy.</strong> The handle present in this can be used to distinguish it from a laparoscopic myoma screw which also has a similar tip. It helps in enucleation.</p>\n<p>Other images:</p>\n<p>Image 1:<strong>\u00a0Sim's curette</strong>\u00a0is a\u00a0<strong>single-ended</strong>\u00a0uterine curette used for\u00a0<strong>dilatation and curettage</strong>. It\u00a0is designed\u00a0to remove tough tissue from the lining of the uterus for biopsy or excision. The curette features a\u00a0<strong>sharp loop tip</strong> to aid in the removal of uterine tissue.</p>\n<p>Image 3:<strong>\u00a0The episiotomy scissor</strong> is bent on the edge. It has a blunt tip that goes inside the vagina. It is used to perform episiotomy during delivery.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aec8413ee80744e28ab59124b7dbcfaa.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient is prepared for a minor procedure in the ophthalmology outpatient department. The following instruments are assembled in the tray. Which of the following glands is involved in the pathology for which this procedure is performed?",
    "choices": [
      {
        "id": 1,
        "text": "Gland of Wolfring"
      },
      {
        "id": 2,
        "text": "Zeis gland"
      },
      {
        "id": 3,
        "text": "Meibomian gland"
      },
      {
        "id": 4,
        "text": "Gland of Krause"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given set of instruments represents the <strong>chalazion set</strong>&nbsp;which is used to perform <strong>incision and curettage</strong> of a chalazion.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2110f356adfc4a75961b6d646be90c3f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1cf8e4b9a364419f885ef5b5dfe996cax1280x2146.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f86dfec85b9d49d891620fe3bea4bff2x600x450.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/755fb1e967ed4a1c9fda4e336943a02ax548x448.PNG"
    ]
  },
  {
    "text": "Which of the following statements is true regarding the intrauterine device shown below?",
    "choices": [
      {
        "id": 1,
        "text": "It has silver added to the copper wire"
      },
      {
        "id": 2,
        "text": "It can be used as an emergency contraceptive"
      },
      {
        "id": 3,
        "text": "It has a lifespan of 10 years"
      },
      {
        "id": 4,
        "text": "It contains levonorgestrel"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the intrauterine contraceptive device,\u00a0<strong>multi-load copper 250. </strong>It can be used for <strong>emergency contraception.</strong></p>\n<p>Mechanism of action:</p>\n<p><span data-preserver-spaces=\"true\">Once placed inside the uterine cavity, the multi-load copper 250 device acts as a</span><strong><span data-preserver-spaces=\"true\">\u00a0foreign body</span></strong><span data-preserver-spaces=\"true\">\u00a0and induces\u00a0</span><strong><span data-preserver-spaces=\"true\">inflammatory changes</span></strong><span data-preserver-spaces=\"true\">\u00a0in the endometrium.\u00a0</span><strong><span data-preserver-spaces=\"true\">Copper released</span></strong><span data-preserver-spaces=\"true\">\u00a0from the device cause\u00a0</span><strong><span data-preserver-spaces=\"true\">enzymatic and metabolic changes</span></strong><span data-preserver-spaces=\"true\">\u00a0in the endometrium. It\u00a0</span><strong><span data-preserver-spaces=\"true\">increases uterine contractility</span></strong><span data-preserver-spaces=\"true\">\u00a0leading to\u00a0</span>the <strong><span data-preserver-spaces=\"true\">expulsion of the fertilized egg</span></strong> from<span data-preserver-spaces=\"true\">\u00a0the fallopian tube into the endometrium before the development of chorionic villi and ultimately, causes\u00a0</span><strong><span data-preserver-spaces=\"true\">failure of implantation</span></strong><span data-preserver-spaces=\"true\">. The fertilized egg is then engulfed by the macrophages recruited due to the inflammatory changes.\u00a0</span>In addition, the device <strong>hinders the migration of the sperm.</strong></p>\n<p>The<strong> lifespan</strong> of multi-load copper 250 is about <strong>3-5 years.</strong></p>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Nova T</strong> has <strong>silver added to the copper</strong> wire which prolongs its lifespan to <strong>5 years.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e61a892e0e0247b9800283e1a14cf3d3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f9a7235d626640cd9258f2de5112f5c7x720x1087.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8040ae35bbfd4583b153d026c3e43ff1x720x540.PNG"
    ]
  },
  {
    "text": "In the ophthalmology practical examination, the external examiner asks you to identify the given object. Choose the correct answer.",
    "choices": [
      {
        "id": 1,
        "text": "Kelman multiflex anterior chamber IOL"
      },
      {
        "id": 2,
        "text": "Modified C loop posterior chamber IOL"
      },
      {
        "id": 3,
        "text": "Singh and Worst's iris claw lens"
      },
      {
        "id": 4,
        "text": "Four-loop posterior chamber IOL"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts <strong>Kelman multiflex </strong>type of anterior chamber intraocular lens (ACIOL). It is the <strong>most commonly</strong> used ACIOL.</p>\n<p><strong>Anterior chamber IOLs </strong>lie entirely in <strong>front</strong> of the<strong> iris</strong> and are supported in the angle of the anterior chamber. These are associated with a higher incidence of <strong>bullous keratopathy</strong>. Thus, they are currently used only for correction of<strong> aphakia</strong> in cases where posterior chamber IOLs cannot be used (eg: rupture of posterior capsule).\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80fa08263af84040988b00bcf8092098.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/126213e740d74e25b859eb717cfdc91bx1280x2276.JPEG"
    ]
  },
  {
    "text": "A 56-year-old male sustained a fracture of the neck of femur and he was planned for replacement surgery. Identify the prosthesis in the given image:",
    "choices": [
      {
        "id": 1,
        "text": "Thompson Prosthesis"
      },
      {
        "id": 2,
        "text": "Austin- Moore Prosthesis"
      },
      {
        "id": 3,
        "text": "Charnley\u2019s Prosthesis"
      },
      {
        "id": 4,
        "text": "Muller\u2019s Prosthesis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the&nbsp;<strong>Austin-Moore prosthesis. </strong>The<strong> Austin-Moore prosthesis&nbsp;</strong>is used for hemiarthroplasty in the neck of femur fracture in elderly individuals.&nbsp;</p>\n<p><strong>The Austin-Moore</strong> prosthesis has a head, neck, and stem. The stem has a hole to which the hook of the extractor can be attached. It helps in removing the prosthesis. There are<strong> two fenestrations</strong> in the stem which are for bone growth and fixing the prosthesis. It can be used <strong>without cement</strong> since its usage makes the removal difficult.&nbsp;</p>\n<p>The below image shows Austin Moore's prosthesis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e9d88a4006654cb8a73861efe37d6461.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5ef79f057fbe42f08f8d0f88c133c91cx800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99bfb4e7baa44a1fa07c0413b007d062x720x564.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02abe002fefc4855ab0a4a6bdaad11cex318x656.PNG"
    ]
  }
];
        let quizName = 'Instruments Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>