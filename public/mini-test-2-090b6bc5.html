<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 2 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2022-23
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A young man develops slurred speech and an unsteady staggering gait after drinking heavily at a party. What could be his blood alcohol level?",
    "choices": [
      {
        "id": 1,
        "text": "30 - 50 mg/100 mL"
      },
      {
        "id": 2,
        "text": "50 - 100 mg/100 mL"
      },
      {
        "id": 3,
        "text": "100 - 150 mg/100 mL"
      },
      {
        "id": 4,
        "text": "150 - 200 mg/100 mL"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The alcohol level in a patient with <strong>slurred speech and staggering gait</strong> would approximately be <strong>150-200 mg/100 mL. </strong></p>\n<p>The behavioral changes with respect to the amount of alcohol in the blood are as follows :</p>\n<ul>\n<li><strong>&gt;30 mg/100 mL</strong> causes impairment of driving skills.</li>\n<li><strong>30 - 50 mg/100 mL</strong> leads to definite deterioration of driving ability.</li>\n<li><strong>50 - 100 mg/100 mL</strong> starts showing objective signs such as loud rambunctious talking and laughing, progressive loss of social inhibitions, and some sensory disturbance.</li>\n<li><strong>100 - 150 mg/100 mL</strong> causes ataxia, impaired memory, sleepiness, and slowed reaction time.</li>\n<li><strong>150 - 200 mg/100 mL</strong> leads to obvious <strong>drunkenness, staggering gait,</strong> and <strong>nausea</strong>.</li>\n<li><strong>200 - 300 mg/100 mL</strong> causes stupor, vomiting, and maybe even lead to coma.</li>\n<li><strong>300 - 350 mg/100 mL</strong> can lead to stupor/ coma with a risk of aspiration of vomit.</li>\n<li><strong>&gt;350 mg/100 mL</strong> can cause respiratory center paralysis leading to death.</li>\n</ul>\n<p>Acute alcohol intoxication can be treated with the evacuation of stomach and bowel contents and gastric lavage with an alkaline solution. 1L of normal saline with 10% glucose, 100 mg thiamine, and 15U insulin may be useful. If the coma progresses deeper, stimulants like strychnine and caffeine can be used. Patients should be started on artificial respiration if there is respiratory depression or difficulty breathing.\u00a0</p>\n<p>Chronic alcohol intoxication can be treated with disulfiram (daily dose of 250 mg OD), conditioned reflex treatment, hypnosis, and psychotherapy.</p>\n<p>The alcohol content in common alcoholic drinks :</p>\n<ul>\n<li>Rum, liquor - 50-60%.</li>\n<li>Whisky, vodka, gin, brandy - 40-45%.</li>\n<li>Port, sherry - 20%.</li>\n<li>Wine, champagne - 10-15%.</li>\n<li>Beer - 4-8%</li>\n</ul>\n<p>According to the <strong>Motor Vehicles (Amendment) Act 2019</strong>, whoever while driving, or attempting to drive, a motor vehicle, has, in his blood, <strong>alcohol exceeding 30 mg/100 mL of blood</strong>, detected in a test by a breath analyzer is <strong>punishable by law.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old woman presented with fatigue and unrelenting severe bone discomfort. She currently resides in an old age home and has minimal exposure to sunlight. Investigations revealed low levels of vitamin D and elevated levels of PTH and ALP. A radiograph of the hip is given. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoporosis"
      },
      {
        "id": 2,
        "text": "Osteomalacia"
      },
      {
        "id": 3,
        "text": "Osteopetrosis"
      },
      {
        "id": 4,
        "text": "Paget's disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the x-ray showing&nbsp;<strong>Looser zones</strong><strong>&nbsp;</strong>are suggestive of<strong>&nbsp;osteomalacia.</strong></p>\n<p>In osteomalacia, the osteoid matrix is secreted at a normal rate but the mineralization is decreased i.e, decreased mineral apposition rate and increased osteoid maturation time. Osteomalacia mainly presents with<strong> extreme fatigue</strong> and <strong>weakness</strong> along with the chance of fractures.</p>\n<p>Lab findings reveal&nbsp;<strong>normal/low calcium</strong>&nbsp;and&nbsp;<strong>elevated alkaline phosphatase</strong>.&nbsp;</p>\n<p><strong>Looser zones&nbsp;</strong>are&nbsp;the <strong>classical lesions</strong> of osteomalacia.&nbsp;These are due to<strong> incomplete stress fractures&nbsp;</strong>which heal with callus-lacking in calcium. They are thin transverse bands of rarefaction especially seen in the pelvis, the shaft of long bones such as the femur neck, and the axillary edge of the scapula.</p>\n<p><strong>Treatment</strong>&nbsp;options include calcium and vitamin D supplements along with phosphate supplements.</p>\n<p>The image below shows<strong> Looser's&nbsp;zone:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b1a1fabb3614603a6b7fa06e069ad5e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f6edd757c6f349068c9bebb5fa1dd72cx720x703.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/871512fe087e4102a679f343b1d4874dx720x1676.PNG"
    ]
  },
  {
    "text": "A 30-year-old woman comes to the hospital after accidentally finding a painless lump in her right breast. The lump is solitary and is located below the areola. She also recalls a blood-stained discharge from her nipple a few days back. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Duct ectasia"
      },
      {
        "id": 2,
        "text": "Fibroadenoma"
      },
      {
        "id": 3,
        "text": "Intraductal papilloma"
      },
      {
        "id": 4,
        "text": "Paget's disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of a solitary<strong> intraductal</strong> <strong>papilloma</strong>.<strong>\u00a0</strong>\u00a0</p>\n<p>Intraductal papilloma<strong>\u00a0</strong>is a\u00a0<strong>benign</strong>, <strong>proliferative breast disorder</strong> without atypia. It can be solitary or multiple (papillomatosis). Most commonly seen in <strong>premenopausal women</strong>.\u00a0It is associated with\u00a0<strong>blood-stained</strong>\u00a0<strong>discharge</strong> and cystic swelling beneath the areola.</p>\n<p>It is important to rule out the possibility of carcinoma with blood tests and cytology. If atypia is present,\u00a0excision is the treatment of choice.</p>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Duct ectasia</strong> is the dilatation of one or more lactiferous ducts and is associated with<strong> periductal mastitis.\u00a0</strong>The dilated ducts get filled with stagnant <strong>brown</strong> or\u00a0<strong>green-coloured secretions </strong>and get discharged from the\u00a0nipple. Later, it can form an indurated mass that resembles a carcinoma and should be carefully ruled out. Fibrosis causes a <strong>slit-like retraction</strong> of the nipple. The definitive treatment is <strong>Hadfield's operation</strong> which involves the excision of all major ducts. Duct ectasia is mainly seen in perimenopausal women (45-55 years of age).</p>\n<p>Option B:\u00a0<strong>Fibroadenoma </strong>is\u00a0a benign breast tumour that is usually firm, rubbery, and mobile. They occur in women in their 20s and 30s, and they are frequently multiple and bilateral. It has no increased risk of developing into malignancy.\u00a0</p>\n<p>Option D:\u00a0<strong>Paget\u2019s disease</strong> is the skin manifestation of underlying breast carcinoma. It is characterised by<strong>\u00a0nipple erythema</strong>\u00a0and irritation. It is associated with\u00a0<strong>pruritus</strong>\u00a0and may progress to crusting and ulceration. The <strong>discharge</strong> is from the <strong>surface of the skin</strong> and <strong>not</strong> from the <strong>nipple</strong>. It can be differentiated from eczema by biopsy. Features that indicate <strong>eczema</strong> include <strong>bilateral</strong> nipple involvement, <strong>younger</strong> females, and signs of eczema in <strong>other parts.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly man is admitted with deep vein thrombosis in his left leg. He is a known case of hypertension and chronic kidney disease (creatinine clearance - 29 mL/min). Which of the following will you prescribe for the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Unfractionated heparin"
      },
      {
        "id": 2,
        "text": "Fondaparinux"
      },
      {
        "id": 3,
        "text": "Low molecular weight heparin"
      },
      {
        "id": 4,
        "text": "Rivaroxaban"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Unfractionated heparin</strong> is to be prescribed to manage this patient's condition. Heparin is <strong>cleared</strong> and degraded primarily by the <strong>reticuloendothelial</strong> <strong>system</strong> and only a tiny amount appears in the urine. Hence, it is <strong>safe</strong> to be used in patients with <strong>renal impairment/ chronic kidney disease.</strong></p>\n<p>Heparin, low molecular weight heparin (LMWH), and fondaparinux have <strong>no intrinsic anticoagulant activity</strong>. These agents <strong>accelerate</strong> the action of\u00a0<strong>anti-thrombin</strong>. Heparin binds to anti-thrombin and brings about a conformational change in anti-thrombin that accelerates the <strong>inhibition of factor Xa</strong> (anti-thrombin inhibits activated coagulation factors, especially thrombin and factor Xa).</p>\n<p>Heparin, LMWH, and fondaparinux - can be used in the initial management of <strong>deep vein thrombosis</strong> and <strong>pulmonary embolism</strong>, <strong>unstable angina,</strong> and in <strong>acute myocardial infarction.</strong></p>\n<p>Heparin and LMWH are used in\u00a0select patients with <strong>disseminated intravascular coagulation\u00a0</strong>and\u00a0<strong>coronary balloon angioplasty</strong> with or without stent placement to prevent thrombosis. <strong>Fondaparinux</strong> is contraindicated due to the risk of <strong>catheter thrombosis.</strong></p>\n<p><strong>Heparin</strong> is the agent of choice for <strong>cardiopulmonary bypass surgeries.</strong></p>\n<p>Heparin, LMWH, and fondaparinux do not cross the placenta and hence are <strong>safe</strong> to<strong> use </strong>in<strong> pregnancy</strong>. The drugs may be discontinued 24 hours before delivery to minimize postpartum hemorrhage.</p>\n<p>Other options :</p>\n<p>Options B &amp; C:\u00a0<strong>Low molecular weight heparin</strong> and <strong>fondaparinux</strong> are both smaller molecules and are cleared almost exclusively by kidneys. These drugs can accumulate in patients with renal impairment and lead to bleeding. Both these drugs are <strong>contraindicated</strong> in patients whose <strong>creatinine clearance is below 30 mL/min.\u00a0</strong></p>\n<p>Option D: <strong>Rivaroxaban toxicity </strong>is increased in patients with<strong> renal impairment </strong>or <strong>severe hepatic dysfunction </strong>and should be avoided in these patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old female patient presents to the ENT outpatient department with decreased hearing in both ears, often associated with a ringing sensation for the past few years. The Rinne test was negative and the Schwartze sign is seen on otoscopy. Which of the following types of curves will be seen on her impedance audiometry?",
    "choices": [
      {
        "id": 1,
        "text": "Type A"
      },
      {
        "id": 2,
        "text": "Type As"
      },
      {
        "id": 3,
        "text": "Type B"
      },
      {
        "id": 4,
        "text": "Type C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario is suggestive of <strong>otosclerosis</strong>. <strong>As type</strong> of curve will be seen on her <strong>impedance audiometry</strong>. Decreased hearing with ringing sensation, a negative Rinne, and the presence of Schwartze sign indicate a diagnosis of otosclerosis.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\"><strong>Impedance audiometry </strong>is an objective test that consists of<strong>&nbsp;tympanometry </strong>and<strong>&nbsp;</strong>assessment of<strong> acoustic reflexes.&nbsp;</strong>&nbsp;</p>\n<p>It is based on the principle that when sound strikes against the tympanic membrane, some of it is absorbed while the rest is reflected. The reflected sound is measured to assess the compliance of the tympanic membrane. The compliance of the membrane is inverse to the intensity of the sound reflected, i.e. lesser the compliance, the more the sound reflected.</p>\n<p>There are 5 types of tympanograms based on the change in pressures applied:</p>\n<ul>\n<li>A- Normal tympanogram. It is seen in normal individuals.&nbsp;</li>\n<li><strong>A<sub>s</sub>- Low compliance in normal pressure. </strong>Seen in conditions where ossicles are fixed like in <strong>otosclerosis</strong> or malleus fixation.</li>\n<li>A<sub>D</sub>- High compliance under normal pressure. Seen in conditions of ossicular discontinuity or thin tympanic membrane.</li>\n<li>B-&nbsp; A flat/ dome-shaped tympanogram indicates that there is no change in compliance with changes in pressure. Seen in thick tympanic membrane or fluid in the middle ear.</li>\n<li>C- Compliance is increased with negative pressure in excess of 100 mmH<sub>2</sub>O. Seen in eustachian tube obstruction and retracted tympanic membrane.</li>\n</ul>\n<p>Uses of impedance audiometry include testing hearing in children and infants.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about T-cells are false?",
    "choices": [
      {
        "id": 1,
        "text": "Kill extracellular bacteria by granzymes and perforin"
      },
      {
        "id": 2,
        "text": "\u03b3\u03b4 TCR recognize peptide antigens presented by MHC molecules"
      },
      {
        "id": 3,
        "text": "Lymphocyte recirculation is seen in T lymphocytes"
      },
      {
        "id": 4,
        "text": "Normally, about 60% of mature T cells are CD4+"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The false statement is that &gamma;&delta; TCR recognizes peptide antigens presented by MHC molecules.&nbsp;</p>\n<p><strong>&gamma;&delta;</strong> <strong>TCR </strong>recognizes different type of antigens <strong>without</strong> the requirement of major histocompatibility complex (<strong>MHC),&nbsp;</strong>whereas the <strong>&alpha;&beta; TCR</strong>&nbsp;recognize peptide antigens that are presented by&nbsp;<strong>MHC&nbsp;</strong>molecules.</p>\n<p>T-lymphocytes develop from the thymus. They constitute around 60&ndash;70% of peripheral blood lymphocytes. T cells contain antigen-specific TCRs by which they recognize specific antigens. Each TCR is linked to six polypeptide chains, which form the CD3 complex, and the &zeta; chain dimer, which is involved in&nbsp;<strong>signal transduction.</strong></p>\n<div class=\"page\" title=\"Page 204\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Apart from CD3 and &zeta; proteins, T cells express several other proteins such as CD4, CD8, CD28, and integrins. Normally, around 60% are CD4+, and about 30% are CD8+ (hence present in a ratio of <strong>2:1</strong>).</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 206\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>T-lymphocytes recirculate</strong> between tissues and home to various sites. Naive T cells circulate to the secondary lymphoid organs containing antigens where immune responses are initiated, and effector lymphocytes migrate to areas of inflammation to eliminate microbes.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The<strong> functions</strong> of<strong>&nbsp;&gamma;\ud835\udeff T-cells</strong>:</p>\n<div class=\"page\" title=\"Page 125\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Provide protection against mycobacteria by <strong>direct killing</strong> of infected macrophages</li>\n<li>Kills extracellular bacteria by<strong> granzymes</strong>&nbsp;and <strong>perforin</strong></li>\n<li>It plays a role in maintaining <strong>self-tolerance</strong></li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man suffered from acute chest pain, sweating, lightheadedness, and nausea 1 day back. Laboratory reports revealed raised cardiac troponin. ECG was suggestive of myocardial infarction. Which of the following isoenzymes of lactate dehydrogenase (LDH) is likely to be raised?",
    "choices": [
      {
        "id": 1,
        "text": "LDH 3"
      },
      {
        "id": 2,
        "text": "LDH 4"
      },
      {
        "id": 3,
        "text": "LDH 2"
      },
      {
        "id": 4,
        "text": "LDH 1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">This patient had an episode of <strong>myocardial infarction</strong> one day back. Therefore, <strong>LDH-1</strong> is likely to be raised in this case of myocardial infarction.</p>\n<div class=\"page\" title=\"Page 321\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Normally <strong>LDH-2 (H3M1)</strong> concentration in blood is<strong> greater</strong> than <strong>LDH-1 (H4)</strong>, but this pattern is <strong>reversed in myocardial infarction</strong>; this is called the <strong>flipped pattern.</strong></p>\n<div class=\"page\" title=\"Page 321\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>LDH enzyme is a tetramer with 4 subunits. But the subunit may be either H (heart) or M (muscle) polypeptide chains.</p>\n<table style=\"border-collapse: collapse; width: 67.8293%; height: 134.39px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 18.272%; height: 22.3984px;\"><strong>Name of Iso-enzyme</strong></td>\n<td style=\"width: 35.9773%; height: 22.3984px;\"><strong>Subunit makeup of iso-enzyme</strong></td>\n<td style=\"width: 45.7507%; height: 22.3984px;\"><strong>Tissue from which iso-enzyme has originated</strong></td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 18.272%; height: 22.3984px;\">LDH 1</td>\n<td style=\"width: 35.9773%; height: 22.3984px;\">H4</td>\n<td style=\"width: 45.7507%; height: 22.3984px;\">Heart muscle</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 18.272%; height: 22.3984px;\">LDH 2</td>\n<td style=\"width: 35.9773%; height: 22.3984px;\">H3M1</td>\n<td style=\"width: 45.7507%; height: 22.3984px;\">RBC</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 18.272%; height: 22.3984px;\">LDH 3</td>\n<td style=\"width: 35.9773%; height: 22.3984px;\">H2M2</td>\n<td style=\"width: 45.7507%; height: 22.3984px;\">Brain</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 18.272%; height: 22.3984px;\">LDH 4</td>\n<td style=\"width: 35.9773%; height: 22.3984px;\">H1M3</td>\n<td style=\"width: 45.7507%; height: 22.3984px;\">Liver</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 18.272%; height: 22.3984px;\">LDH 5</td>\n<td style=\"width: 35.9773%; height: 22.3984px;\">M4</td>\n<td style=\"width: 45.7507%; height: 22.3984px;\">Small intestine</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 321\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>An <strong>increase</strong> in total <strong>LDH level</strong> is seen in<strong> hemolytic anemias</strong>, <strong>hepatocellular damage</strong>, muscular dystrophy, carcinomas, leukemias, and any condition which causes <strong>necrosis of body cells</strong>. Since total LDH is increased in many conditions, the <strong>study of iso-enzymes of LDH </strong>is of <strong>great importance.</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman was brought to the casualty with a high fever and abdominal pain for the past 2 days. She has a history of inflammatory bowel disease. Her abdominal x-ray is shown below. Identify the true statement regarding this condition.",
    "choices": [
      {
        "id": 1,
        "text": "It is defined as the dilatation of the transverse colon, with a diameter of  >6 cm"
      },
      {
        "id": 2,
        "text": "Emergency colectomy is the only treatment  in patients"
      },
      {
        "id": 3,
        "text": "Occurs as a complication of Crohn's disease"
      },
      {
        "id": 4,
        "text": "90% patients will resolve with conservative management"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario and the radiograph are suggestive of<strong>&nbsp;toxic megacolon.&nbsp;</strong>The true statement is that toxic megacolon is defined as <strong>the dilatation of the transverse colon to a diameter of more than 6 cm</strong>.&nbsp;It is usually associated with<strong>&nbsp;severe ulcerative colitis.</strong>&nbsp;It can be triggered by electrolyte imbalance and narcotics as they interfere with gut motility.&nbsp;</p>\n<p>Toxic megacolon may present with fever, abdominal pain, and abdominal distension. Bacterial infection with features of sepsis may also be seen. It can result in <strong>perforation</strong>.&nbsp;</p>\n<p>Abdominal radiography shows transverse or right <strong>colonic dilation</strong> of &gt;6 cm and<strong> l</strong><strong>oss of haustrations.</strong></p>\n<p>It usually resolves with supportive treatment (correcting electrolyte imbalance, fluids, bowel rest) and medical therapy which includes glucocorticoids, anti-inflammatory drugs, and antibiotics. However, an <strong>urgent</strong> <strong>colectomy</strong> is indicated in patients who do not show signs of improvement.</p>\n<p><strong>Ulcerative colitis</strong> is an inflammatory bowel disease resulting in superficial erosions confined to the&nbsp;<strong>mucosa</strong>&nbsp;and&nbsp;<strong>submucosa</strong>&nbsp;of the <strong>colon</strong>. It starts from the rectum and extends proximally in a continuous manner.</p>\n<p>The clinical features include abdominal pain, diarrhea, rectal bleeding, tenesmus, and passage of mucus. Other symptoms include anorexia, nausea, vomiting, fever, and weight loss.</p>\n<p>Investigations show elevated C-reactive protein, platelet count, erythrocyte sedimentation rate,&nbsp;<strong>fecal calprotectin,</strong>&nbsp;and&nbsp;<strong>fecal lactoferrin</strong>. A colonoscopy reveals loss of typical vascular pattern, erythema, friability, and ulcerations.&nbsp;</p>\n<p><strong>Extraintestinal</strong> manifestations associated with IBD include ocular features (episcleritis, and uveitis), dermatological manifestations (erythema nodosum, <strong>pyoderma gangrenosum</strong>), rheumatological (arthropathies, sacroiliitis, ankylosing spondylitis) and <strong>primary sclerosing cholangitis.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/02240a47fe254dab8c1c075aabd8a0f7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A female patient with twin pregnancies underwent an abdominal ultrasound. It showed that the upper part of the body of one fetus was absent and the other fetus was normal. The echo of the normal fetus was suggestive of congestive cardiac failure. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Twin-to-twin transfusion syndrome"
      },
      {
        "id": 2,
        "text": "Twin anemia\u2013polycythemia sequence"
      },
      {
        "id": 3,
        "text": "Twin reversed arterial perfusion"
      },
      {
        "id": 4,
        "text": "Twin oligohydramnios polyhydramnios syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">The diagnosis here is <strong>twin reversed arterial perfusion</strong> (TRAP).</p>\n<p>TRAP is a complication seen in <strong>monochorionic</strong> <strong>multifetal gestation</strong>. It is caused by a large artery-to-artery or vein-to-vein placental shunt. Here, the <strong>recipient twin lacks a cardiac system</strong>, while the donor twin does the work of supplying blood for both twins. Blood from the donor twin reaches the iliac vessels of the recipient twin through the umbilical arteries. Therefore, in the<strong> recipient twin</strong>, <strong>only</strong> the <strong>lower body</strong> is <strong>developed</strong>, while the upper body is poorly developed. The <strong>donor</strong> twin may show signs of <strong>heart failure.</strong></p>\n<p>Developmental abnormality in the recipient twin:</p>\n<ul>\n<li>No identifiable structures - Acardius amorphous</li>\n<li>Failure of head growth - Acardius acephalus</li>\n<li>Partially developed head with identifiable limbs - Acardius myelacephalus</li>\n</ul>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Other options:\u00a0</p>\n<p>Option A-<strong>\u00a0Twin-to-twin transfusion syndrome </strong>(TTTS)\u00a0is a deep\u00a0<strong>arteriovenous</strong> <strong>anastomotic</strong> complication seen in\u00a0<strong>monochorionic</strong>\u00a0twins. Deoxygenated <strong>blood from</strong> the <strong>donor</strong> enters through anastomosis into a shared cotyledon for oxygen exchange. After oxygenation, the blood is<strong> taken</strong> up by the\u00a0recipient twin. The <strong>donor twin</strong> will have <strong>anemia</strong> and appears pale, while the <strong>recipient</strong> twin will have <strong>polycythemia</strong> and features of heart failure.</p>\n<p>Option B-\u00a0<strong>Twin anemia\u2013polycythemia sequence</strong> (TAPS) is similar to TTTS, where the donor twin is pale and anemic, whereas the recipient twin is polycythemic. However, unlike the case with TTTS, the amniotic fluid volumes in TAPS are similar for both fetuses.</p>\n<p>Option D-<strong>\u00a0Twin oligohydramnios polyhydramnios syndrome (TOPS)</strong> is seen in TTTS<strong>.</strong>\u00a0The <strong>donor fetus</strong> becomes <strong>oliguric</strong> due to hypovolemia, and the <strong>recipient fetus</strong> develops<strong> increased urine output</strong> due to hypervolemia. This results in oligohydramnios in the donor and hydramnios in the recipient fetus.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d4e32d215a34830a38756d2de090766x1279x1671.JPEG"
    ]
  },
  {
    "text": "A patient undergoing surgery is being maintained on anesthesia. During the procedure, he suddenly developed hyperthermia and muscle rigidity. The capnography finding is shown below. Which of the following drugs is most likely implicated in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "D-curare"
      },
      {
        "id": 2,
        "text": "Succinylcholine"
      },
      {
        "id": 3,
        "text": "Cis-atracurium"
      },
      {
        "id": 4,
        "text": "Rocuronium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario along with the capnography finding showing a progressive rise of CO<sub>2</sub> is suggestive of <strong>malignant hyperthermia</strong>. The drug most likely implicated in this condition is<strong> succinylcholine</strong>.</p>\n<p><strong>Succinylcholine</strong> is a peripherally acting<strong> depolarizing muscle relaxant,</strong> commonly administered during the induction of anesthesia. It is used to relax muscles of the jaw, neck, and airway and thereby facilitate laryngoscopy and endotracheal intubation.</p>\n<p><strong>Malignant hyperthermia</strong> is a condition in which the patient develops <strong>sustained muscle contraction </strong>and <strong>hyperthermia</strong>. It occurs following the administration of <strong>succinylcholine</strong> and other<strong> inhaled anesthetics </strong>like halothane, isoflurane, sevoflurane, desflurane, etc. It is due to the mutation of the gene for the<strong> ryanodine</strong><strong>&nbsp;receptor </strong>(Ryr 1), located on chromosome 19.</p>\n<p>Normally, Ryr 1 is an ion channel responsible for calcium release from the sarcoplasmic reticulum. The mutated Ryr 1 leads to&nbsp;a sudden release of calcium from the sarcoplasmic reticulum of the skeletal muscle. This<strong> increase</strong> in <strong>intracellular calcium</strong>&nbsp;removes the inhibition of troponin, resulting in uncontrolled muscle contraction, which in turn, leads to an increase in adenosine triphosphatase (ATPase) activity.</p>\n<p>This causes an uncontrolled <strong>hypermetabolic</strong> state with <strong>increased oxygen consumption </strong>and <strong>CO<sub>2</sub> production</strong>, producing severe lactic acidosis and hyperthermia.</p>\n<p><strong>Dantrolene </strong>therapy&nbsp;is the treatment of choice.</p>\n<p>The image given below shows capnography findings seen in malignant hyperthermia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/08984b0077ca47319fbb7f63822d2d40.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ebd2a00d91164a2683c5f8ac3477da78x1279x752.JPEG"
    ]
  },
  {
    "text": "A patient was brought to the emergency room with a suspected opioid overdose. On examination, he had severe respiratory depression. He was intubated and started on mechanical ventilation. What is the drug of choice to be administered to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Naloxone"
      },
      {
        "id": 2,
        "text": "Flumazenil"
      },
      {
        "id": 3,
        "text": "Buprenorphine"
      },
      {
        "id": 4,
        "text": "Naltrexone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Intravenous<strong> naloxone</strong> is the drug of choice in acute opioid overdose.</p>\n<p>Naloxone is a <strong>pure opioid antagonist</strong> that reverses all effects of an opioid overdose except<strong> sedation</strong>. The <strong>first step</strong> is to ensure an <strong>adequate airway</strong>. Intubation and mechanical ventilation may be necessary.</p>\n<p>Clinically, patients with opioid overdose present with <strong>respiratory depression</strong>\u00a0and <strong>pinpoint pupils</strong> (miosis). On examination, there is hypotension, bradycardia, shallow breathing, and hypothermia.</p>\n<p>Intravenous naloxone is administered at a slow rate. <strong>Increased respiratory rate</strong> and <strong>pupillary dilation</strong> should occur promptly, which indicates signs of improvement. If there is no response to the initial dosage, repeat the dose after a few minutes. Repeated administration may be required to prevent the recurrence of opioid toxicity because naloxone has a low duration of action.</p>\n<p>The FDA approved a higher dose of naloxone hydrochloride <strong>nasal spray</strong> to treat opioid overdose. The newly approved product delivers 8 mg of naloxone into the nasal cavity. The FDA had previously approved 2 mg and 4 mg naloxone nasal spray products.</p>\n<p><strong>Note</strong>: Naloxone is contraindicated in infants born to mothers with opiate addiction as it may precipitate acute neonatal withdrawal with <strong>seizures</strong>.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Flumazenil\u00a0</strong>is the inverse agonist of benzodiazepine receptors and is used for the treatment of\u00a0<strong>benzodiazepine</strong>\u00a0overdose.</p>\n<p>Option C: <strong>Buprenorphine</strong> is a partial opioid agonist. It is used as an analgesic for chronic pain conditions like cancer pain and also used for the treatment of opioid dependence as an alternative to methadone.</p>\n<p>Option D: <strong>Naltrexone</strong> is an opioid antagonist that blocks opioid effects, particularly euphoria, and discourages per\u00adsons with opioid dependence from substance-seeking behaviour. It is not the first choice in acute opioid overdose.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most likely diagnosis of the lesion shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic ulcer"
      },
      {
        "id": 2,
        "text": "Neuropathic ulcer"
      },
      {
        "id": 3,
        "text": "Venous ulcer"
      },
      {
        "id": 4,
        "text": "Tuberculous ulcer"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely diagnosis of the lesion is a <strong>neuropathic ulcer</strong>.</p>\n<p>A neuropathic ulcer is one that occurs due to&nbsp;<strong>peripheral neuropathy</strong>. In peripheral neuropathy, lack of sensation over the pressure points leads to cumulative microtrauma, minor wounds, or cuts that go unnoticed eventually developing into ulcers. They are <strong>painless</strong>, <strong>punched out</strong>&nbsp;with regular margins,&nbsp;on the <strong>plantar surface</strong> of the foot, and show the presence of<strong> calluses.</strong><strong>&nbsp;</strong></p>\n<p>Management of neuropathic ulcer: Debridement of all necrotic or hyperkeratotic wound tissue, proper cultures to be done if an infection is suspected for microbiological analysis. Any ulcerations subjected to sustained pressure should be subjected to pressure reduction&nbsp;by mechanical offloading which includes wedge shoes, total contact cast, cast walkers, etc.</p>\n<table style=\"height: 901px; width: 646px; float: left;\">\n<tbody>\n<tr style=\"height: 60px;\">\n<td style=\"width: 120.641px; height: 60px;\"><strong>Type of Ulcer</strong></td>\n<td style=\"width: 170.906px; height: 60px;\"><strong>Ischaemic/ Arterial</strong></td>\n<td style=\"width: 92.5px; height: 60px;\"><strong>Venous</strong></td>\n<td style=\"width: 112.594px; height: 60px;\"><strong>Neuropathic</strong></td>\n<td style=\"width: 115.359px; height: 60px;\"><strong>Tuberculous&nbsp;&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 120.641px; height: 72px;\"><strong>Underlying condition</strong></td>\n<td style=\"width: 170.906px; height: 72px;\">\n<p>Peripheral vascular disease- atherosclerosis, thromboangiitis obliterans, cervical rib, Raynaud's phenomenon</p>\n</td>\n<td style=\"width: 92.5px; height: 72px;\">Varicose veins, previous deep vein thrombosis</td>\n<td style=\"width: 112.594px; height: 72px;\">Diabetes, peripheral neuropathy</td>\n<td style=\"width: 115.359px; height: 72px;\">Tuberculosis lymph nodes, cold abscess from bone and joint tuberculosis</td>\n</tr>\n<tr style=\"height: 79px;\">\n<td style=\"width: 120.641px; height: 79px;\"><strong>Location</strong></td>\n<td style=\"width: 170.906px; height: 79px;\">Toes, feet, legs, or even upper limb digits.</td>\n<td style=\"width: 92.5px; height: 79px;\">The lower limb, commonly on the medial side of the ankle, is never above the middle third of the leg</td>\n<td style=\"width: 112.594px; height: 79px;\">The plantar surface of the foot, toes</td>\n<td style=\"width: 115.359px; height: 79px;\">Neck, axilla, and groin, tip or anterior 2/3rd of the tongue.</td>\n</tr>\n<tr style=\"height: 126.390625px;\">\n<td style=\"width: 120.641px; height: 126.391px;\"><strong>Characteristics</strong></td>\n<td style=\"width: 170.906px; height: 126.391px;\">\n<p>Deep, penetrating the fascia exposes the tendons, muscles, and underlying bone.</p>\n<p>The ulcer is <strong>painful</strong>, with irregular margin tenderness, and hyperesthetic.&nbsp;</p>\n</td>\n<td style=\"width: 92.5px; height: 126.391px;\">Vertically oval, and <strong>painless</strong>, the floor may have pale to no granulation tissue, induration, and tenderness at the base.</td>\n<td style=\"width: 112.594px; height: 126.391px;\"><strong>painless</strong>, punched-out with regular calloused margins.&nbsp;</td>\n<td style=\"width: 115.359px; height: 126.391px;\">\n<div class=\"page\" title=\"Page 74\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Edges are thin, reddish blue, and undermined with pale granulation tissue, scanty discharge on the floor, and slight induration at the base.</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 121px;\">\n<td style=\"width: 120.641px; height: 121px;\"><strong>Other features</strong></td>\n<td style=\"width: 170.906px; height: 121px;\">Features of ischemia in adjacent areas, like pallor, dry skin, brittle nails, loss of hair</td>\n<td style=\"width: 92.5px; height: 121px;\">Inguinal lymph nodes enlarged, usually the vertical group, the ulcer is recurrent, forms again after healing</td>\n<td style=\"width: 112.594px; height: 121px;\">\n<p>Dry, warm foot</p>\n<p>Loss of sensation, vibration, and reflexes.</p>\n<p>Bony deformities may be present.</p>\n</td>\n<td style=\"width: 115.359px; height: 121px;\">Regional lymph nodes are enlarged, non-tender, matted</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/54f061ad470b4cfb822066a3e7eaa99e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/370782681457420a93952f2cc2b6edddx750x563.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5c5c5422e0e4a40974986655549438dx473x612.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6041dbd7a88b4a698c8a86e29e657dd5x900x1200.JPEG"
    ]
  },
  {
    "text": "A patient was brought to the hospital with complaints of blurring of vision. His blood pressure is found to be 210/180 mmHg. Fundoscopic examination of the right and left eye is shown in the following image. What is the grade according to Keith, Wagner, and Barker's grading?",
    "choices": [
      {
        "id": 1,
        "text": "Grade 3 hypertensive retinopathy"
      },
      {
        "id": 2,
        "text": "Grade 4 hypertensive retinopathy"
      },
      {
        "id": 3,
        "text": "Grade 1 hypertensive retinopathy"
      },
      {
        "id": 4,
        "text": "Grade 2 hypertensive retinopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The diagnosis is<strong> grade 4 hypertensive retinopathy&nbsp;</strong>since the fundoscopic examination of the patient shows<strong> bilateral optic disc swelling </strong>and<strong> macular stars</strong><strong>.</strong></p>\n<p>Hypertensive retinopathy refers to <strong>changes</strong> in the <strong>retinal vasculature</strong> due to systemic hypertension.&nbsp;The fundus changes can be classified as benign and malignant retinopathy.</p>\n<p>Patients with <strong>benign retinopathy</strong> are usually <strong>asymptomatic</strong>. The fundoscopic changes include<strong> generalized</strong> or <strong>focal arterial narrowing</strong>, arteriovenous nicking, arteriolar reflex changes, superficial retinal hemorrhages, <strong>cotton wool spots</strong>, and&nbsp;hard exudates.&nbsp;<strong>Malignant hypertensive retinopathy</strong> includes retinopathy, choroidopathy, and optic neuropathies.&nbsp;</p>\n<p><strong>Keith-Wagener-Barker</strong>&nbsp;(KWB) grading of hypertensive retinopathy is commonly used to grade the severity.</p>\n<p><strong>Grade 1 </strong>involves <strong>mild</strong> to moderate <strong>narrowing</strong> of smaller arteries.</p>\n<p><strong>Grade 2</strong> involves <strong>marked</strong> arteriolar <strong>narrowing</strong>. At the site where arteries and veins cross each other, there is a marked deflection of veins. This is known as <strong>Salus' sign</strong>.</p>\n<p><strong>Grade 3 </strong>includes&nbsp;grade 2 changes along with <strong>retinal hemorrhages</strong>, <strong>hard exudates,</strong> and <strong>cotton wool spots</strong>. Apart from this the Bonnet sign, Gunn sign, Salus' sign, and&nbsp;<strong>copper wiring</strong> of arterioles can also be seen.</p>\n<ul>\n<li><strong>Hard exudates</strong>&nbsp;are lipid deposits in the outer plexiform layer of the retina from leaky capillaries. They are yellow waxy spots with sharp margins, which are arranged as <strong>macular-fan or macular-star.</strong></li>\n<li><strong>Cotton wool spots&nbsp;</strong>are the fluffy white lesions on the retina occurring due to ischemia and <strong>infarction.</strong></li>\n<li><strong>Bonnet sign&nbsp;</strong>refers to the banking of veins at the crossing of arteries and veins.</li>\n<li><strong>Gunn sign </strong>refers to the&nbsp;<strong>tapering </strong>of<strong> veins </strong>on both sides of the <strong>crossing.</strong></li>\n<li><strong>Arteriolar reflex changes</strong> indicate the light reflex changes in the retinal vasculature. Normal reflex is when the arteriole appears bright, thin, and linear. <strong>Copper wiring</strong> is when it becomes a <strong>reddish-brown reflex</strong> due to sclerosis of the arterioles. <strong>Siver wiring</strong> is when it becomes an <strong>opaque-white reflex</strong> due to continued sclerosis and is seen in grade 4 retinopathy.</li>\n</ul>\n<p><strong>Grade 4 </strong>includes grade 3 changes along with&nbsp;<strong>optic disc swelling</strong>&nbsp;and&nbsp;<strong>silver wiring</strong>. This is a marker of malignant hypertension.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/970268c2d16a464795b9de3977e41949.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/74c7ce5e7efb4ad59a921b6deddd04b8x1200x2876.JPEG"
    ]
  },
  {
    "text": "A clinical trial is being done for a new drug for the treatment of migraine. The p-value was found to be 0.02. Which of the following is a correct statement?",
    "choices": [
      {
        "id": 1,
        "text": "Trial is statistically insignificant and the null hypothesis is true"
      },
      {
        "id": 2,
        "text": "Trial is statistically insignificant but the null hypothesis is false"
      },
      {
        "id": 3,
        "text": "Trial is statistically significant and the null hypothesis is false"
      },
      {
        "id": 4,
        "text": "Trial is statistically significant and the null hypothesis is true"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct statement is the <strong>trial is statistically significant </strong>and <strong>the null hypothesis is false.\u00a0</strong></p>\n<p>In the given scenario, the p-value is<strong> 0.02</strong> which is <strong>&lt;0.05</strong>. This means that the possibility of an association between the new drug and pain relief purely by chance is only 2%. Hence, the <strong>null hypothesis</strong> is <strong>rejected</strong>.\u00a0</p>\n<p>The possibility of pain relief due to the new drug is 98%. This is the <strong>alternate hypothesis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A farmer developed an ulcer with central black eschar over the forearm after handling a carcass in his field. Microscopy of the specimen received from the eschar showed the following picture. Which of the following statements is correct about the laboratory features of this organism?",
    "choices": [
      {
        "id": 1,
        "text": "Fried egg appearance on culture medium"
      },
      {
        "id": 2,
        "text": "Sunray appearance on microscopy"
      },
      {
        "id": 3,
        "text": "Bamboo stick appearance on microscopy"
      },
      {
        "id": 4,
        "text": "Safety pin appearance on microscopy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical feature of developing an <strong>eschar</strong> and the image showing <strong>gram-positive</strong> bacilli is diagnostic of <strong><em>Bacillus anthracis</em>.</strong> The correct statement regarding the laboratory feature of this organism is the&nbsp;<strong>bamboo stick</strong> appearance on microscopy.</p>\n<p>Important laboratory features of this organism are:</p>\n<ul>\n<li><strong>Microscopy</strong> of the smears shows bacilli arranged end to end in the form of long chains. This is called <strong>bamboo stick appearance.</strong></li>\n<li><strong>M'Fadyean reaction-&nbsp;</strong>when these bacilli are stained with polychrome <strong>methylene blue</strong>, purplish <strong>capsules</strong>&nbsp;can be visualized around the bacilli.</li>\n<li><strong>Medusa head appearance</strong> on agar plates- The colonies appear as locks of matted hair.</li>\n<li><strong>Inverted fir tree appearance</strong> on gelatin stab culture</li>\n<li><strong>Frosted glass appearance</strong> on the agar plate</li>\n</ul>\n<p><em>Bacillus anthracis</em> is a <strong>gram-positive </strong>organism and also a <strong>category A</strong> <strong>Bioterrorism</strong> agent.</p>\n<p>Human anthrax presents in one of three ways:</p>\n<ul>\n<li><strong>Cutaneous anthrax&nbsp;</strong>(Hide porter&rsquo;s disease)-<strong>&nbsp;</strong><strong>Black eschar </strong>at the site of entry.</li>\n<li><strong>Pulmonary anthrax&nbsp;</strong>(Wool sorter&rsquo;s disease)-<strong>&nbsp;</strong>Occurs due to the inhalation of spores from infected wool. It leads to hemorrhagic pneumonia.</li>\n<li><strong>Intestinal anthrax</strong>-&nbsp;Hemorrhagic diarrhea.&nbsp;It occurs mainly in primitive communities that eat the carcasses of animals dying of anthrax.</li>\n</ul>\n<p><strong>Robert Koch</strong> validated the Koch'spostulates after discovering the <strong>anthrax bacillus</strong> as the cause of anthrax. He also discovered the causative agents of tuberculosis and cholera. Hence, he is known as the <strong>Father of Bacteriology</strong>.</p>\n<p>Koch's postulates, which link specific microorganisms to specific diseases, state that the microorganism must be:</p>\n<ol>\n<li>Found in abundance in lesions associated with disease, but not in healthy organisms</li>\n<li><strong>Isolated</strong> from a diseased organism and able to be grown in pure culture</li>\n<li>Able to <strong>cause disease when inoculated</strong> into a healthy organism</li>\n<li>Able to re-isolate the organism from pure cultures obtained from the lesions from experimental animals</li>\n</ol>\n<p>Other options:</p>\n<p>Option A- <strong>Fried egg appearance</strong> is seen in <em><strong>Mycoplasma pneumoniae.</strong></em></p>\n<p>Option B-&nbsp;<strong>Sunray appearance</strong> is seen in microscopy of&nbsp;<em><strong>Actinomyces</strong>.</em></p>\n<p>Option D-&nbsp;<strong>Safety pin appearance</strong> is seen on microscopy of&nbsp;<strong><em>Yersinia</em></strong> species,&nbsp;<strong><em>Burkholderia pseudomallei.</em></strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5309a7e314924c1ab2ff69ec4edf96e0.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young adolescent male with a recurrent history of suppurative otitis media was brought to the hospital with high fever and chills, altered sensorium, and neck rigidity. Which part of the image given below should have been deficient for the patient to develop the current symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>tegmen tympani\u00a0</strong>(Marked as 2 in the image), which forms the<strong> roof</strong> of the middle ear cavity, should have been deficient for the patient to develop meningitis from suppurative otitis media.</p>\n<p>Tegmen tympani\u00a0separates the tympanic cavity from the\u00a0<strong>middle cranial fossa</strong>. It also extends posteriorly to form the roof of the aditus and antrum as<strong>\u00a0tegmen mastoidea</strong>. Any <strong>deficit</strong> in the tegmen tympani can<strong> facilitate</strong> the <strong>spread</strong> of middle ear infection to the middle cranial fossa.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da35562823054ded9cf937e7754916d7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3b7bac049d734538b7f9d58139f29547x1280x1349.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/94240ec6c0c5425190253b82c4954c78x1280x2185.JPEG"
    ]
  },
  {
    "text": "A neonate was born at 42 weeks of gestation by spontaneous vaginal delivery, following signs of severe fetal distress. Greenish amniotic fluid was noted during delivery. Immediately following delivery, the baby was shifted to the NICU and had to be intubated. Her chest x-ray is shown below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Respiratory distress syndrome"
      },
      {
        "id": 2,
        "text": "Transient tachypnea of newborn"
      },
      {
        "id": 3,
        "text": "Congenital diaphragmatic hernia"
      },
      {
        "id": 4,
        "text": "Meconium aspiration syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most probable diagnosis is <strong>meconium&nbsp;aspiration syndrome.</strong>&nbsp;The image shows <strong>patchy infiltrates </strong>and <strong>coarse streaking,</strong>&nbsp;which is a radiograph finding in infants with this condition.</p>\n<p>Meconium aspiration syndrome occurs in some&nbsp;<strong>term</strong> and <strong>post-term</strong> infants. The aspirated meconium may block smaller airways leading to tachypnea, grunting, and cyanosis.&nbsp;The chest radiograph shows <strong>patchy infiltrates</strong>, <strong>coarse streaking</strong> of lung fields, increased anteroposterior diameter and flattening of the diaphragm. It commonly resolves within 72 hours, while a few babies may require assisted ventilation.</p>\n<p>Other options:</p>\n<p>Option A - <strong>Respiratory distress syndrome</strong>&nbsp;is also known as&nbsp;hyaline membrane disease. It occurs&nbsp;due to the decreased<strong>&nbsp;</strong>production and secretion of the<strong>&nbsp;</strong>lung <strong>surfactant</strong>. It is seen mainly in <strong>preterm </strong>babies<strong>. The radiograph</strong>&nbsp;will show the presence of low lung volumes, a diffuse<strong> reticular</strong> granularity of the parenchyma (<strong>ground-glass appearance</strong>), and <strong>air bronchograms.</strong></p>\n<p>Option B - <strong>Transient tachypnea</strong> of<strong> newborn</strong>&nbsp;is a self-limiting disorder occurring due to delayed clearance of lung fluid. Chest radiograph will reveal prominent <strong>perihilar pulmonary vascular markings</strong> and <strong>fluid</strong> in the <strong>intralobar</strong> fissures. It is more common in twin gestation, maternal asthma, precipitous delivery, and cesarean delivery without labor.</p>\n<p>Option C - <strong>Congenital diaphragmatic hernia&nbsp;</strong>occurs due to the defective&nbsp;development of the diaphragm. The majority are <strong>Bochdalek hernia</strong> on the <strong>left</strong> side. Imaging may show pulmonary hypoplasia, mediastinal shift, presence of a&nbsp;<strong>gastric bubble,</strong> or a liver in the <strong>thoracic cavity.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/82bdc9c106c2408bb35f1af5fa07850f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly man presents with fatigue, chest pain, and exertional breathlessness. On auscultation, an ejection systolic murmur that radiates to the carotids was found. The murmur intensified on squatting. Which of the following will be the character of the pulse in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pulsus alternans"
      },
      {
        "id": 2,
        "text": "Pulsus bisferiens"
      },
      {
        "id": 3,
        "text": "Pulsus paradoxus"
      },
      {
        "id": 4,
        "text": "Pulsus parvus et tardus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient's clinical scenario is suggestive of\u00a0<strong>aortic stenosis (AS) </strong>which has the characteristic <strong>pulsus parvus et tardus.</strong></p>\n<p>Aortic stenosis is the <strong>narrowing</strong> of the<strong> aortic valve</strong>. It may be caused due to the <strong>calcification</strong> of the <strong>normal aortic valve</strong> or the <strong>congenital bicuspid</strong> <strong>valve</strong>, and <strong>rheumatic heart disease</strong>. Narrowing of the aortic valve causes a <strong>decreased stroke volume</strong>. This results in a <strong>weak</strong>\u00a0<strong>pulse</strong> (Parvus) which <strong>rises slowly</strong> to a <strong>delayed peak</strong> (tardus), best appreciated in the <strong>carotid arteries</strong>.</p>\n<p>The clinical features of AS are:</p>\n<ul>\n<li><strong>Exertional dyspnea:</strong>\u00a0This occurs due to left ventricular (LV) diastolic dysfunction. Raised end-diastolic LV volume and reduced LV compliance lead to increased LV pressure, leading to elevation of pulmonary capillary wedge pressure.\u00a0</li>\n<li><strong>Angina pectoris</strong>: This occurs due to the\u00a0combination of the increased O<sub><span class=\"s1\">2 </span></sub>needs of hypertrophied myocardium and the reduction of O<sub><span class=\"s1\">2 </span></sub>delivery.</li>\n<li><strong>Syncope</strong>: This occurs due to the combination of decreased cardiac output and systemic arterial dilation which lead to a reduction of cerebral perfusion.</li>\n</ul>\n<p>As <strong>LV systole</strong> gets <strong>prolonged</strong>, the <strong>aortic component</strong> of <strong>S<sub>2</sub> </strong>may become <strong>synchronous</strong> with the <strong>pulmonary component</strong>. There may also be a <strong>paradoxical splitting </strong>of\u00a0<strong>S<sub>2,</sub></strong> where the aortic component follows the pulmonary component.\u00a0The murmur in aortic stenosis is typically an <strong>ejection systolic murmur</strong> best heard at the <strong>right second intercostal space</strong> and transmitted to the carotids.</p>\n<p>The murmur in AS <strong>increases </strong>in <strong>intensity</strong> during <strong>squatting. </strong>This is due to the<strong>\u00a0</strong>increase\u00a0in preload that leads to increased contractility and increased flow across the aortic valve.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Pulsus alternans</strong> is defined as <strong>beat-to-beat variability</strong> in the amplitude of the pulse. It is seen in patients with <strong>severe LV dysfunction</strong>.</p>\n<p>Option B: <strong>Pulsus bisferiens</strong>\u00a0also known as bifid pulse has <strong>two systolic peaks.</strong> It is seen in patients with <strong>hypertrophic obstructive cardiomyopathy</strong>. There is a rapid upstroke to the first peak (percussion wave) and a slower rise to the second peak (tidal wave). It is also rarely appreciated in patients with severe aortic regurgitation.</p>\n<p>Option C: <strong>Pulsus paradoxus</strong> is defined as a <strong>fall </strong>in <strong>systolic pressure &gt; 10mmHg</strong> with <strong>inspiration.</strong> It is seen in patients with pericardial tamponade, severe asthma, massive pulmonary embolism and tension pneumothorax.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man presents with intense pruritus and has painful, red streaks between his fingers and in the groin area. He states that the itchiness is worse at night. Other members of his family also present with similar complaints. A dermoscopy of his skin is shown below. Which of the following can be used for the treatment of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "5 % permethrin cream"
      },
      {
        "id": 2,
        "text": "Oral albendazole"
      },
      {
        "id": 3,
        "text": "5% lindane lotion"
      },
      {
        "id": 4,
        "text": "Topical corticosteroids"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the image showing a magnified view of a <strong>burrowing trail </strong>are suggestive of <strong>scabies</strong>.&nbsp;<strong>5%</strong> <strong>permethrin </strong>cream is used in the management of this patient.</p>\n<p><strong>Scabies</strong> is an <strong>ectoparasitic</strong> <strong>infestation</strong> caused in humans by the <strong><em>Sarcoptes scabiei var. hominis</em>.&nbsp;</strong>The characteristic symptoms of a scabies infection include <strong>intense itching</strong> and <strong>superficial</strong> <strong>burrows</strong>.&nbsp;</p>\n<p><strong>Burrow</strong> is the characteristic lesion of scabies. They&nbsp;present as slightly raised <strong>brownish tortuous</strong> lesions. It is&nbsp;created by the excavation of the <strong>adult</strong> <strong>mite</strong> in the <strong>epidermis</strong>.&nbsp;In most people, the trails of the burrowing mites are <strong>linear</strong>&nbsp;in the skin.</p>\n<p>Typical locations of lesions are the <strong>finger webs, </strong>the <strong>flexor surfaces</strong> of the wrists, the elbows, the axillae, the buttocks and <strong>genitalia</strong>, and the breasts of women.</p>\n<p>The treatment options are the topical application of&nbsp;<strong>5%</strong> <strong>permethrin cream</strong>,&nbsp;<strong>1% lindane lotion</strong>, benzyl benzoate, esdepalletrin (bioallethrin), crotamiton, and precipitated sulfur and oral prescriptions like <strong>ivermectin</strong>.</p>\n<p>All<strong> family</strong> members, even if <strong>asymptomatic</strong> need to be <strong>treated</strong> simultaneously for this condition to <strong>prevent</strong> <strong>reinfection</strong> and the <strong>clothing</strong> needs to be <strong>disinfected</strong> simultaneously.</p>\n<p>Other options:</p>\n<p>Option B:&nbsp;<strong>Oral albendazole</strong> is used in the treatment of <strong>larva currens</strong> and <strong>c</strong><strong>utaneous larva migrans. </strong>They&nbsp;present as&nbsp;pruritic erythematous papules at the site of penetration of the hookworms with an erythematous serpiginous larva track.</p>\n<p>The image below shows <strong>cutaneous larva migrans</strong>:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/76d3329d08c64592a9f0348df3bc7a0f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c80ed4ef43b14c0ca07ac4283d6bf16cx720x633.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2de7648a4da64427b815b68715998fd9x720x473.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9ec1c51295749369a99ad75f9ae745dx720x749.JPEG"
    ]
  },
  {
    "text": "A 40-year-old female patient presents with headaches and high blood pressure. On investigation, increased aldosterone levels are seen and a diagnosis of Conn's syndrome is made. Which of the following is least likely to be found in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Increased plasma Na+"
      },
      {
        "id": 2,
        "text": "Hyperkalemia"
      },
      {
        "id": 3,
        "text": "Muscle weakness"
      },
      {
        "id": 4,
        "text": "Metabolic alkalosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Hyperkalemia is least likely to be found in this patient with <strong>Conn's syndrome.&nbsp;</strong>Patients with Conn's syndrome usually have <strong>hypokalemia</strong>.</p>\n<p>Patients with Conn's syndrome have primary&nbsp;<strong>hyperaldosteronism&nbsp;</strong>which results in a&nbsp;<strong>modest increase</strong> in <strong>plasma sodium</strong>,<strong>&nbsp;</strong>usually less than&nbsp;4-6 mEq/L&nbsp;over the normal range,<strong> hypokalemia </strong>(due to increased K<sup>+</sup>excretion),<strong>&nbsp;hypertension&nbsp;</strong>(due to slight increase in ECF volume),<strong> metabolic alkalosis&nbsp;</strong>because increased hydrogen ions are secreted in the urine.</p>\n<p>Excess secretion of aldosterone causes only a&nbsp;<strong>modest increase</strong> in <strong>plasma sodium</strong><strong>. </strong>When <strong>sodium</strong> gets <strong>reabsorbed</strong>, <strong>water</strong> also <strong>accompanies</strong> it, resulting in plasma sodium remaining fairly normal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/af1a2c2138d5460cb34664121848ee26x772x693.PNG"
    ]
  }
];
        let quizName = 'Mini Test 2';
        const quizFilename = 'mini-test-2-090b6bc5.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2022-23"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>