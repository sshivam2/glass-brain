<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 19 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A preterm baby in the neonatal intensive care unit is being screened for retinopathy of prematurity (ROP). She is found to have stage 2 ROP in zone I with no plus disease.  What is the recommended treatment for this stage of the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Laser ablation"
      },
      {
        "id": 2,
        "text": "Pars plana vitrectomy"
      },
      {
        "id": 3,
        "text": "Careful observation"
      },
      {
        "id": 4,
        "text": "Intravitreal bevacizumab injection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The recommended treatment for ROP stage 2 in zone I (categorized as type I/low-risk ROP) is <strong>careful observation</strong> and follow-up.</p>\n<p>Retinopathy of prematurity occurs in <strong>premature infants</strong> with low birth weight, with a typical history of <strong>exposure to oxygen</strong> in <strong>high concentrations</strong> leading to bilateral proliferative retinopathy.\u00a0</p>\n<p>Stages of Retinopathy of Prematurity:</p>\n<ul>\n<li>Stage 1- demarcation line formation at the edge of vessels, dividing the vascular from the avascular retina.</li>\n<li>Stage 2- intraretinal ridge formation</li>\n<li>Stage 3- ridge with extraretinal fibrovascular proliferation into the vitreous.</li>\n<li>Stage 4-\u00a0subtotal retinal detachment</li>\n<li>Stage 5- total retinal detachment</li>\n<li><strong>'Plus' disease</strong> is characterized by <strong>dilatation</strong> and<strong> tortuosity of blood vessels</strong> in <strong>at least two quadrants</strong> of the <strong>posterior fundus</strong>. It signifies the progression of the disease.</li>\n</ul>\n<p>Location:</p>\n<p>Zone I: Circular area with a radius twice the distance from disc to the fovea, with the disc as the center. (as shown in the image)<br />Zone II: It covers the area beyond zone I circumferentially till nasal ora serrata.<br />Zone III: It consists of residual temporal crescent anterior to zone II.</p>\n<p>These zones are shown in the image below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8460e2377cbf4a1dafcf1d9115d74304x1280x1277.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baed159ca8bf41c0b3faa8193ab04432x510x2089.GIF"
    ]
  },
  {
    "text": "An 18-year-old boy is rushed to the emergency department after having choked on a bone while eating. He is responsive but unable to speak. What is to be done next?",
    "choices": [
      {
        "id": 1,
        "text": "Bag and mask ventilation"
      },
      {
        "id": 2,
        "text": "Endoscopic removal"
      },
      {
        "id": 3,
        "text": "Deliver 5 backslaps and 5 chest compressions"
      },
      {
        "id": 4,
        "text": "Perform Heimlich maneuver"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In a choking <strong>child</strong> (more than 1 year old) or an <strong>adult,</strong> the first step to be done is to perform <strong>Heimlich</strong> maneuver which involves delivering <strong>abdominal thrusts.</strong></p>\n<p>The rescuer should stand or kneel behind the patient and wrap his arms around the patient&rsquo;s waist. A fist is made with one hand and using the other hand, the fist is driven into the patient&rsquo;s abdomen with a rapid, forceful upward thrust so as to dislodge the foreign body. This is continued until the foreign body is expelled or if the patient becomes unresponsive.</p>\n<p>If the patient becomes <strong>unresponsive</strong>, immediately <strong>start</strong> <strong>CPR</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c96e24d3b1f4fafab682fe5a100eebex510x442.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7bbb754ab7d24e128f1d60c28afc9c8ax1280x2905.JPEG"
    ]
  },
  {
    "text": "A  50-year-old male patient presents with sudden onset chest pain. On examination his pulses are weak and his blood pressure is 80/60 mmHg. Contrast-enhanced CT shows a ruptured thoracic aortic aneurysm. Which of the following is not associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Tertiary syphilis"
      },
      {
        "id": 2,
        "text": "Marfan's syndrome"
      },
      {
        "id": 3,
        "text": "Polyarteritis nodosa"
      },
      {
        "id": 4,
        "text": "Ehlers-Danlos syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient's history of <strong>sudden onset chest pain</strong> along with <strong>feeble pulses</strong> and <strong>low blood pressure</strong> is suggestive of a large vessel disorder. This can be confirmed by contrast-enhanced <strong>CT </strong>which shows a <strong>thoracic aortic</strong> <strong>aneurysmal rupture.</strong>\u00a0 Polyarteritis nodosa is not associated with this condition.</p>\n<p>Thoracic aortic aneurysm refers to the dilatation of the thoracic aorta which can occur in any part. It can be a <strong>true aneurysm</strong> involving <strong>all three layers</strong> of the vessel or a <strong>false aneurysm</strong>, involving only the <strong>outer adventitial layer,</strong> with blood escaping through the intima. <strong>Circumferential</strong> involvement is referred to as a <strong>fusiform</strong> aneurysm while it is called a <strong>saccular</strong> aneurysm if only <strong>part</strong> of the circumference is involved.</p>\n<p>The most common cause is atherosclerosis, but this pathology is also <strong>closely associated</strong> with several <strong>connective tissue disorders\u00a0</strong>such as:</p>\n<ul>\n<li>Marfan's syndrome</li>\n<li>Tertiary syphilis (syphilitic aortitis)</li>\n<li>Ehlers-Danlos syndrome</li>\n<li>Osteogenesis imperfecta</li>\n</ul>\n<p>These aneurysms are <strong>often asymptomatic</strong> and discovered incidentally, but <strong>if</strong> they progressively <strong>enlarge,</strong> it can lead to symptoms suggestive of <strong>compression</strong> of the <strong>surrounding tissue (dysphagia, dyspnea, hoarseness of the voice,</strong> etc.). Aneurysm of the <strong>aortic root</strong> can cause <strong>dilatation</strong> of the aortic valve annulus and result in <strong>aortic regurgitation</strong>. Rupture can occur into the pericardium or the left pleural space, producing hypotension and dyspnea.</p>\n<p>The diagnosis can be made with the help of a <strong>contrast-enhanced CT </strong>or<strong> MRI</strong> scan. Indications for surgery include any symptomatic aneurysm, rupture, progressive aortic valve insufficiency, symptomatic Marfan's related aneurysms of 4.5-5 cm, and descending symptomatic aneurysms &gt;6 cm. Surgery can also be considered if the aneurysmal diameter is increasing at &gt;1 cm per year.\u00a0</p>\n<p>Incorrect option- <strong>Polyarteritis nodosa\u00a0</strong>is a type of vasculitis of <strong>small </strong>and<strong> medium-sized vessels</strong> of the kidneys and other viscera. It <strong>does not involve</strong> the pulmonary vasculature or <strong>large vessels </strong>like the<strong> aorta</strong>.</p>\n<p>Contrast-enhanced CT of the thorax with thoracic aortic aneurysmal rupture is shown in the image below. The <strong>white arrow</strong> points to the <strong>blood in the thoracic cavity</strong>, while the <strong>black arrow</strong> is pointing to the <strong>thoracic aorta</strong>:\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50805433ab0c432683fd7e394778a3f0x669x600.PNG"
    ]
  },
  {
    "text": "An 8-year-old boy is brought to the emergency department with sudden onset severe pain in the abdomen. His mother gives a history of several such repeated episodes of pain in the abdomen, bones, and distal ends of the digits in the past 2 years. He suffered an autosplenectomy the previous year during a similar painful episode. Laboratory findings show unconjugated hyperbilirubinemia and significant reticulocytosis. Which of the following is correct regarding his disease?",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant inheritance"
      },
      {
        "id": 2,
        "text": "Caused by a point mutation in the alpha globin gene"
      },
      {
        "id": 3,
        "text": "Heterozygous trait can protect against dengue"
      },
      {
        "id": 4,
        "text": "Howell Jolly bodies seen on peripheral smear"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The child presents with a history of multiple pain crises, splenectomy, and laboratory findings of <strong>unconjugated hyperbilirubinemia</strong> and <strong>normocytic anemia.</strong> These features point to a diagnosis of <strong>sickle cell anemia</strong>. <strong>Howell Jolly bodies </strong>are seen in<strong>\u00a0</strong>the peripheral smear of a patient with sickle cell disease.</p>\n<p>The below image shows Howell-Jolly bodies:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0398b739f73b4011837ec9158f1e5d7bx610x600.PNG"
    ]
  },
  {
    "text": "Which of the following factors related to platelet aggregation is absent in Glanzmann's thrombasthenia?",
    "choices": [
      {
        "id": 1,
        "text": "Gp IIb/IIIa receptor"
      },
      {
        "id": 2,
        "text": "Factor VIII"
      },
      {
        "id": 3,
        "text": "Gp Ib-IX receptor"
      },
      {
        "id": 4,
        "text": "von Willebrand factor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>Gp IIb/IIIa receptor</strong> is <strong>absent</strong>\u00a0in Glanzmann's thrombasthenia.</p>\n<p><strong>Glanzmann's thrombasthenia</strong> is an <strong>autosomal recessive</strong>\u00a0disorder of platelet aggregation in which the Gp IIb/IIIa receptor is absent.</p>\n<p>During <strong>platelet plug formation</strong>, the initial stimulus is <strong>vessel injury</strong>. The site of injury reveals the <strong>von Willebrand factor,</strong> which then <strong>binds </strong>to the <strong>platelets via </strong>the <strong>Gp Ib receptors.</strong> This step <strong>leads to</strong> the <strong>activation of platelets</strong> with the release of substances that promote further platelet aggregation and inhibit anticoagulation. <strong>Gp IIb/IIIa receptors</strong> are the most abundant receptors on the platelet surface, which also <strong>get activated</strong> and help to bring about <strong>platelet-platelet interaction</strong> by <strong>binding</strong> them <strong>with</strong> a molecule of <strong>fibrinogen</strong> as shown in the diagram below.</p>\n<p>Hence, the absence of Gp IIb/IIIa receptors in <strong>Glanzmann's</strong> thrombasthenia will allow only minimal platelet adhesion to the site of vessel injury but <strong>will not allow the platelet plug to form.</strong> This leads to various bleeding manifestations such as gum bleeding, epistaxis, easy bruisability, etc.</p>\n<p>Laboratory findings include <strong>prolonged bleeding time, normal PT/aPTT, normal platelet count,</strong> and <strong>normal platelet morphology</strong>. Specific <strong>platelet aggregation tests</strong> with collagen, ADP, etc. <strong>will fail</strong> to bring about platelet aggregation, but the <strong>ristocetin cofactor assay will be normal.</strong> This is because the ristocetin cofactor assay tests the integrity of the Gp Ib binding to von Willebrand factor. This will be normal in patients with Glanzmann's. So, this test can be <strong>used to differentiate</strong> it <strong>from Bernaner Soulier syndrome</strong> (absence of Gp Ib).</p>\n<p><strong>Treatment</strong> for this disorder depends on the severity of the bleed.<strong> Minor</strong> mucosal bleeds can be managed with <strong>antifibrinolytics</strong> such as\u00a0\u03b5-aminocaproic acid or tranexamic acid. <strong>Desmopressin</strong> is used in <strong>mild bleeds</strong> by releasing von Willebrand factor, factor VIII and by activating platelets further. <strong>Severe bleeds</strong> are usually treated with <strong>platelet transfusions</strong>. Leukodepletion can help to prevent alloimmunization in such patients who may require these transfusions often.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/782ae3af1df243909f30610685a47c0ex1279x1689.JPEG"
    ]
  },
  {
    "text": "The cutaneous lymphoma shown in the image below presents with patches and plaques, most commonly on the back. Histological examination shows the classic Pautrier abscess. This condition commonly progresses to a particular syndrome. Which of the following is not a feature of that syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophilic microabscesses"
      },
      {
        "id": 2,
        "text": "Erythroderma"
      },
      {
        "id": 3,
        "text": "Peripheral lymphadenopathy"
      },
      {
        "id": 4,
        "text": "Atypical circulating mononuclear cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shown above with cutaneous patches and plaques and the characteristic Pautrier microabscesses is suggestive of a <strong>diagnosis</strong> of <strong>mycosis fungoides</strong>. Mycosis fungoides can <strong>progress</strong> to a syndrome called <strong>Sezary syndrome</strong>. Neutrophilic microabscesses are not one of the features of this syndrome.</p>\n<p><strong>Sezary syndrome</strong> is defined by the following <strong>clinical triad</strong>:</p>\n<ul>\n<li>Erythroderma</li>\n<li>Peripheral lymphadenopathy</li>\n<li>Atypical circulating mononuclear cells</li>\n</ul>\n<p>Sezary syndrome is most often seen as a <strong>progression of mycosis fungoides</strong> (MF). MF is a <strong>cutaneous T-cell lymphoma</strong>. It is more common in middle-aged men and people with darker skin. MF may present as dermatitis or eczema for a few years before progressing to the classical presentation of <strong>patches</strong> and <strong>plaques</strong> as shown in the image above. The most common sites involved are the <strong>trunk, limbs, breasts, and buttocks</strong>. The lesions may present with pruritus or be asymptomatic. As it <strong>progresses</strong>, the patient may develop, ulceration and pain or even <strong>widespread erythroderma</strong>. The gradual progression to Sezary syndrome with erythroderma and lymphadenopathy may be accompanied by the typical 'B' symptoms of fever, night sweats, and weight loss.</p>\n<p>Important investigations to consider are cutaneous and lymph node<strong> biopsies (showing</strong> the<strong> Pautrier abscess,</strong> which is a <strong>lymphocytic microabscess</strong>) and blood samples to count the <strong>Sezary cells (atypical mononuclear tumor cells)</strong>. Treatment for both MF and Sezary syndrome depends upon the severity of the disease. Topical steroid therapy, phototherapy, and skin-directed radiotherapy can be tried as a first-line attempt. Advanced disease can be treated with methotrexate, interferons, chemotherapy, etc.</p>\n<p>The classical patches and plaques on the back in mycosis fungoides can be seen in the image below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6e9d7f14f65b49c0875b61a7c2082ebc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/921cc005785d47538ea424b976858a3bx452x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b9026d8e13e444bb9ca6726fdc8aa66x443x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/519775e963344541b1160c004b921247x720x708.JPEG"
    ]
  },
  {
    "text": "A 65-year-old woman presents with dizziness and palpitations since 3 days. On examination, she has an irregularly irregular pulse, with ECG findings as shown below. If she were to undergo surgical ablation to treat this condition, which part of the myocardium should be targeted?",
    "choices": [
      {
        "id": 1,
        "text": "Across the bicuspid annulus, from the left atrium to  free wall of the ventricle"
      },
      {
        "id": 2,
        "text": "From the AV node towards the tricuspid annulus"
      },
      {
        "id": 3,
        "text": "Around the cavotricuspid isthmus"
      },
      {
        "id": 4,
        "text": "Left atrial regions around the pulmonary veins"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given history and the ECG findings of an irregularly irregular rhythm, absent p waves, and narrow QRS complexes are suggestive of <strong>atrial fibrillation</strong>. If she were to undergo surgical ablation to treat this condition, the <strong>left atrial regions around the pulmonary veins</strong> should be targeted.</p>\n<p>The <strong>triggering foci </strong>for <strong>atrial fibrillation</strong>&nbsp;most commonly originate from the <strong>left atrial tissue</strong>, near the <strong>openings of</strong> the <strong>pulmonary veins</strong>. When medical management is unsuccessful or if quicker results are desired, cardiac ablation can be carried out. Targeting this region will produce the best results.</p>\n<p>Atrial fibrillation refers to an <strong>irregular atrial activation</strong>, with the absence of atrial contraction. Ventricular contraction is irregular, depending on the atrioventricular nodal conduction rate.&nbsp;Atrial fibrillation is the most common cardiac arrhythmia, and most patients are above the age of 60 years. Patients present with palpitations, dizziness, syncopal episodes, etc. On examination, they are found to have irregularly irregular pulses and, in severe cases, even cardiovascular collapse and heart failure.</p>\n<p>ECG shows an increased rate and irregular rhythm with the absence of p waves. The&nbsp;CHA<sub>2</sub>DS<sub>2</sub>-VASc score is used to determine a patient's risk of developing stroke, and if the score is &gt;2, the patient is recommended to start oral anticoagulation therapy. Beta-blockers and calcium channel blockers are most commonly used to treat atrial fibrillation, and they help to control the ventricular rate and improve symptoms.&nbsp;</p>\n<p>Obesity, hypertension, alcohol abuse, and sleep apnea are known risk factors and should be controlled in order to reduce the incidence of these episodes.</p>\n<p>Other options:</p>\n<p>Option A: In <strong>Wolff-Parkinson-White</strong>&nbsp;<strong>syndrome,</strong>&nbsp;the most common accessory pathway is found&nbsp;<strong>across the bicuspid annulus</strong>,<strong>&nbsp;</strong>from the<strong> left atrium</strong> to the<strong> free wall </strong>of the <strong>left ventricle</strong>; the other&nbsp;common accessory pathways are the posteroseptal and anteroseptal accessory pathways.</p>\n<p>Option B: <strong>AV nodal re-entrant tachycardia</strong> circuits are most commonly found along the path from the <strong>AV node </strong>to the<strong> tricuspid valve annulus</strong>.</p>\n<p>Option C: <strong>Atrial flutter</strong> most commonly originates <strong>around the cavotricuspid isthmus</strong>, and ablation of this area can resolve the condition in most cases.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0e18f9b1c9d947d699e6ebfb784b1897.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young man falls on an outstretched hand and develops a fracture as shown in the X-ray below.  Which of the following screws is commonly used to treat this fracture?",
    "choices": [
      {
        "id": 1,
        "text": "Cannulated cancellous screw"
      },
      {
        "id": 2,
        "text": "Interference screw"
      },
      {
        "id": 3,
        "text": "Herbert screw"
      },
      {
        "id": 4,
        "text": "Polyaxial pedicle screw"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given X-ray and the history of falls on the outstretched hands suggest the diagnosis of <strong>scaphoid fracture.</strong>\u00a0<strong>Herbert screw</strong> is commonly used to treat this fracture.</p>\n<p>Herbert screw is a <strong>cannulated variable pitch</strong> screw, which is used to fix <strong>unstable or displaced</strong> fractures of small articular bones such as the scaphoid. This screw helps in quick healing by <strong>providing compression</strong> at the fracture site and early return to normal activities. The advantage of cannulated screws is that we <strong>can use </strong>a<strong> guidewire </strong>under videofluoroscopy to assist in the <strong>accurate placement</strong> of the screw during surgery.</p>\n<p>Scaphoid fractures occur most commonly after a <strong>fall</strong> on an <strong>outstretched hand.</strong> The <strong>waist</strong> of the scaphoid is the <strong>most common site</strong> of fracture. Initial x-rays are done in anteroposterior, lateral, and oblique views. Even if the x-rays appear normal, if there is clinical suspicion, a glass holding cast should be applied for 2 weeks followed by repeat imaging.</p>\n<p>Management depends upon the type of fracture. If the scaphoid <strong>tubercle</strong> is fractured, the patient is given a <strong>glass-holding cast</strong> for <strong>4-6 weeks</strong>. In case of <strong>undisplaced waist fractures</strong>, most people will recover with a <strong>cast</strong> in place for <strong>6-8 weeks</strong>. Percutaneous screw fixation with the <strong>Herbert screw</strong> can be offered to those with <strong>displaced or undisplaced</strong> fractures of the waist when the patient does not want to undergo prolonged cast immobilization, or if they wish to return to work/daily activities sooner. Reducing and fixing displaced fractures also <strong>reduces</strong> the <strong>risk </strong>of <strong>non-union</strong>.</p>\n<p>The most common complications include <strong>nonunion,</strong>\u00a0<strong>avascular necrosis (osteonecrosis) </strong>of the <strong>proximal </strong>fracture <strong>segment,\u00a0</strong>and <strong>osteoarthritis.\u00a0</strong></p>\n<p>Herbert screw is shown below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/920cb29375cc46bab8e6bbdb9bcd993c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f984677a257341a88825c039a7cd068ex1280x1223.JPEG"
    ]
  },
  {
    "text": "What is the mechanism of action of the poison obtained from the seeds shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Blocking  peripheral postsynaptic ACh receptors"
      },
      {
        "id": 2,
        "text": "Blocking peripheral and central ACh receptors"
      },
      {
        "id": 3,
        "text": "VAMP cleavage in GABA neurons"
      },
      {
        "id": 4,
        "text": "Blocking glycine receptors in the ventral horn"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The seeds of <strong><em>Strychnos nux vomica</em></strong> are shown in the given image. The poison obtained from these seeds is\u00a0<strong>strychnine.</strong>\u00a0Strychnine acts at the <strong>ventral horn</strong> by <strong>blocking</strong> the postganglionic <strong>glycine receptor</strong> sites in the <strong>spinal cord </strong>and<strong> brainstem.</strong></p>\n<p><strong>Glycine</strong> is an<strong> inhibitory</strong> <strong>neurotransmitter</strong> that acts at the <strong>postsynaptic membranes of ventral horn</strong>\u00a0motor neurons. Hence, the blockade of these receptors by strychnine results in unopposed muscle contraction, resulting in the classical clinical features. These include:</p>\n<ul>\n<li>Tonic-clonic seizures</li>\n<li>Opisthotonus (body arched in hyperextension)</li>\n<li>Risus sardonicus</li>\n<li>Other less common postures that can be seen are emprosthotonus (body bent forward as if bowing) and pleurosthotonus (body bent sideward).\u00a0</li>\n</ul>\n<p>Strychnos nux vomica seeds are<strong>\u00a0toxic</strong>\u00a0only when <strong>chewed/ crushed</strong> prior to swallowing. Intact seeds, if swallowed, will not result in any further symptoms. Treatment involves an initial <strong>stomach wash </strong>and the <strong>use of activated charcoal</strong> to absorb the ingested poison. The patient should be treated with <strong>benzodiazepines </strong>or <strong>barbiturates to control seizures</strong>, and they should be placed in a <strong>dark room </strong>to avoid <strong>triggering further convulsions.</strong></p>\n<p>Other options:\u00a0</p>\n<p>Option (A)- <strong>Blocking peripheral postsynaptic ACh receptors</strong>\u00a0can be seen in<strong> curare poisoning.\u00a0</strong>It can cause progressive flaccid paralysis, ultimately leading to respiratory failure. It was used as an arrow poison during wars in the past.</p>\n<p>Option (B)- <strong>Blocking peripheral and central ACh receptors</strong>\u00a0can be seen in <strong>datura poisoning</strong>. It acts by competitive antagonism. All the parts of the datura plant are poisonous. It shows <strong>predominantly peripheral anticholinergic effects</strong> like flushed face, dry and hot skin, dilated pupils, delirium, urinary retention, etc. with <strong>central</strong> effects like <strong>psychosis</strong> and <strong>delirium</strong>.</p>\n<p>Option (C)- <strong>VAMP</strong> (vesicle-associated membrane protein) <strong>cleavage in GABA</strong> (gamma-aminobutyric acid) <strong>neurons </strong>at the<strong> ventral horn </strong>of the spinal cord<strong>, </strong>is the mechanism of action of toxins in<strong> tetanus infections. </strong>VAMP is normally responsible for the release of GABA, hence VAMP cleavage results in unopposed muscular contractions. The resulting clinical features are very similar to that of strychnine poisoning.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b13cb5acf3ef431db65834054a1189bc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a type of somatic delusion?",
    "choices": [
      {
        "id": 1,
        "text": "Delusional parasitosis"
      },
      {
        "id": 2,
        "text": "Othello syndrome"
      },
      {
        "id": 3,
        "text": "Bromosis"
      },
      {
        "id": 4,
        "text": "Dysmorphic delusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Othello Syndrome</strong>\u00a0is not a type of somatic delusion.</p>\n<p>It is a type of <strong>delusional jealousy</strong>, marked by suspecting a faithful partner of infidelity.</p>\n<p>Somatic delusion is diagnosed when the central themes of the delusional beliefs are of a <strong>hypochondriacal or somatic nature,\u00a0</strong>where the person believes there is something medically, physically or biologically wrong with them.</p>\n<p>It includes the following:</p>\n<ul>\n<li>Concerns about infestation in delusional <strong>parasitosis</strong></li>\n<li>Preoccupation with body features in\u00a0<strong>dysmorphic delusions</strong></li>\n<li>Delusional concerns about body odour, referred to as <strong>bromosis\u00a0 \u00a0 \u00a0</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Administration of O2 has maximum benefit in:",
    "choices": [
      {
        "id": 1,
        "text": "Anemic hypoxia"
      },
      {
        "id": 2,
        "text": "Histotoxic hypoxia"
      },
      {
        "id": 3,
        "text": "Hypoxic hypoxia"
      },
      {
        "id": 4,
        "text": "Stagnant hypoxia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Administration of oxygen has <strong>maximum benefit</strong> in <strong>hypoxic hypoxia</strong>.</p>\n<p><strong>Hypoxic hypoxia</strong> refers to a condition in which there is <strong>low atmospheric Po<sub>2</sub></strong>, leading to low arterial Po<sub>2</sub>.<sub>&nbsp;</sub><span style=\"font-size: 10pt;\">Hence,</span>&nbsp;<strong>supplemental O<sub>2</sub> </strong>can be<strong> very beneficial&nbsp;</strong>when the cause of hypoxia is due to limited oxygen availability.</p>\n<p>Administration of oxygen-rich gas has limited value in anemic, histotoxic, and stagnant hypoxia because:</p>\n<p><strong>Anemic hypoxia</strong>- Oxygen delivery is not beneficial because despite increasing the exogenous oxygen delivery, an anemic person will not have the capacity to carry more oxygen due to the hemoglobin/ red blood cell deficit in anemia.</p>\n<p><strong>Histotoxic hypoxia</strong>- The most common example is cyanide poisoning. Cyanide inhibits important enzymes in the oxidative phosphorylation process, which is essential to the survival of our cells. Additional oxygen supplementation will not be able to overcome this inhibition, and so it will have limited benefit. Hyperbaric oxygen may be helpful to some extent.</p>\n<p><strong>Stagnant hypoxia</strong>- Stagnant hypoxia refers to ischemic hypoxia that results from inadequate circulation due to conditions such as heart failure and hypoxia in the setting of shock. In such conditions, administering intravenous fluids can improve the patient's condition because it is the circulation that is affected. If the shock is prolonged it can result in acute respiratory distress syndrome (ARDS), which can be treated with positive pressure ventilation and not simply by increasing oxygen administration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  young man is brought unconscious to the emergency department after a road traffic accident. On examination,  his left pupil is dilated with a normal right pupil. He also has a positive Babinski's sign in the left foot. Identify the most likely site of brain herniation leading to this presentation.",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario with a <strong>unilateral pupillary dilatation</strong> with signs of <strong>ipsilateral upper motor neuron (UMN) palsy</strong> [Babinski's sign positive], is suggestive of <strong>Kernohan's notch phenomenon</strong>. This is likely due to herniation of the part labeled (3) in the above image i.e. <strong>uncal herniation</strong>.</p>\n<p>Herniation of the uncus (anterior medial temporal gyrus) from the supratentorial to the infratentorial region results in<strong> compression</strong> of the<strong> ipsilateral third cranial nerve</strong>. This results in pupillary dilatation of the same side (parasympathetic fibers are present superficially in the nerve). As the herniation progresses, the contralateral midbrain and thus the <strong>contralateral cerebral peduncle gets compressed</strong> against the tentorial edge on that side. This presents as a <strong>UMN palsy </strong>of the<strong> same side</strong> as the uncal herniation with a positive Babinski's sign. Normally the side opposite the herniation would be expected to show hemiparesis.\u00a0</p>\n<p><strong>Subfalcine herniation (labeled 1)</strong> refers to the herniation of the<strong> cingulate gyrus</strong> <strong>under </strong>the <strong>falx cerebri.</strong> It presents initially with headache. Once it compresses the ipsilateral anterior cerebral artery it can result in contralateral lower limb weakness. This type of herniation does not involve the pupillary functions.</p>\n<p><strong>Central herniation</strong>/central\u00a0transtentorial herniation<strong>(labeled 4)</strong> would present with the <strong>initial signs</strong> of <strong>mitotic pupils </strong>and <strong>drowsiness</strong> due to the downward displacement of the thalamic structures through the tentorial opening, resulting in compression of the upper midbrain. It can later progress to damage the pons and medulla as well.</p>\n<p><strong>Foraminal herniation (labeled 2)</strong> refers to the herniation of the cerebellar tonsils <strong>through the foramen magnum</strong>. This results in <strong>early compression of the medulla,</strong> leading to respiratory arrest and <strong>death.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1356e540059e4aa6808e8bacfa0c287e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/39406accb79d44afa064a7162638e193x1280x1533.JPEG"
    ]
  },
  {
    "text": "A 55-year-old woman comes to the clinic with complaints of episodic flushing. She also complains of diarrhea, which is watery, non-bloody, explosive, and accompanied by abdominal cramping. Further evaluation reveals a tumor in the ileum with the histopathology shown below.  Which of the following is not true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "5- HIAA is used for lab diagnosis"
      },
      {
        "id": 2,
        "text": "Serum chromogranin levels are elevated"
      },
      {
        "id": 3,
        "text": "Anti-tissue transglutaminase antibodies are present"
      },
      {
        "id": 4,
        "text": "Pellagra can develop due to tryptophan deficiency"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette with symptoms of abdominal cramping, explosive diarrhea, and episodic flushing, along with the characteristic histopathological findings (stippled chromatin pattern, without mitotic activity or necrosis) points to the diagnosis of <strong>carcinoid</strong> <strong>syndrome</strong>. The statement- 'anti-tissue transglutaminase antibodies are present' is untrue about this condition.</p>\n<p><strong>Carcinoid syndrome</strong>\u00a0is the result of a carcinoid tumor that secretes <strong>excessive\u00a0</strong>amounts of\u00a0<strong>serotonin</strong>, which is a\u00a0<strong>product of </strong>the<strong> amino acid tryptophan</strong>.\u00a0Serotonin is ultimately metabolized and excreted in urine as 5-HIAA (5-hydroxy indole acetic acid).\u00a0</p>\n<p>The following <strong>tests</strong> can be used in the <strong>diagnosis</strong> of carcinoid tumors:</p>\n<ul>\n<li>Urinary excretion of 5-HIAA and serotonin</li>\n<li>Serum chromogranin concentration</li>\n<li>Blood serotonin concentration</li>\n<li>Plasma 5-HIAA concentration</li>\n<li>Tumor localization with CT, MRI, somatostatin receptor imaging, and endoscopic biopsy</li>\n</ul>\n<p>In carcinoid syndrome, elevated levels of serotonin stimulate <strong>fibroblast growth</strong> and <strong>fibrogenesis,</strong> which leads to the development of <strong>cardiac valvular lesions.</strong> These lesions most often affect the <strong>right side</strong> of the heart\u00a0because the inactivation of humoral substances by the lung protects the left heart. In a few cases, the\u00a0<strong>left side</strong> of the heart may be affected (in patients with <strong>right-to-left shunt</strong>, as in <strong>patent foramen ovale).</strong></p>\n<p>Alterations in tryptophan metabolism are seen in all patients with over <strong>70% of dietary tryptophan converted to serotonin</strong>. Some tumors also produce histamine, kallikrein, prostaglandins, and tachykinins.</p>\n<p>These features of serotonin result in the following symptoms that are found often in carcinoid syndrome-</p>\n<ul>\n<li><strong>Episodic flushing</strong></li>\n<li><strong>Diarrhea</strong> - explosive, non-bloody, and accompanied by abdominal cramping</li>\n<li><strong>Bronchospasm</strong></li>\n<li>Cardiac valvular lesions - commonly involve the right side because the left heart is protected by the humoral inactivation of substances by the lungs</li>\n<li><strong>Pellagra</strong>- because of shunting of most of the dietary tryptophan to serotonin synthesis. (<strong>4 D's: diarrhea, dermatitis, dementia, death</strong>)</li>\n<li>Muscle wasting due to poor protein synthesis</li>\n<li>Mesenteric and retroperitoneal fibrosis</li>\n</ul>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li>Somatostatin analog therapy</li>\n<li>Antidiarrheal therapy</li>\n<li>Surgical excision</li>\n</ul>\n<p>Incorrect option:\u00a0</p>\n<p><strong>Anti-tissue transglutaminase antibodies</strong> are used to diagnose <strong>celiac disease</strong>. Celiac disease is a malabsorptive disorder that can present in <strong>early childhood with diarrhea</strong>. This usually occurs <strong>after introducing cereals</strong> into the child's diet. The symptoms usually disappear over a few years and may or may not re-appear in adulthood. The<strong> diagnosis</strong> is made by testing for autoantibodies (such as\u00a0<strong>anti-tissue transglutaminase</strong>, anti-endomysial, and anti-gliadin)\u00a0and by performing a\u00a0<strong>small\u00a0intestine biopsy</strong>, which can show flattening of the villi.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0a9fd31988df45b3985ab6cd4e070b51.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect in describing the location of the triangle of safety in chest tube insertion?",
    "choices": [
      {
        "id": 1,
        "text": "Below and lateral to the pectoralis major muscle"
      },
      {
        "id": 2,
        "text": "Posterior to the mid-axillary line"
      },
      {
        "id": 3,
        "text": "Above the level of the nipple"
      },
      {
        "id": 4,
        "text": "Anterior to the midaxillary line"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>'Posterior to the mid-axillary line' is incorrect in the description of the triangle of safety in chest tube insertion.</p>\n<p>Chest tube insertion is carried out in the\u00a0<strong>5th intercostal space</strong> anterior to the midaxillary line in the <strong>triangle of safety </strong>(image below).\u00a0It lies-</p>\n<ul>\n<li>anterior to the midaxillary line [yellow line]</li>\n<li>above the level of the nipple [blue line]</li>\n<li>below and lateral to the pectoralis major muscle (lateral to the lateral border of the pectoralis major) [red line]</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/55e8fb1ff4aa41e8821862aea33c64acx600x577.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/31b6640411da47a2bc7c314a5c0675c0x600x1759.JPEG"
    ]
  },
  {
    "text": "Which of the following is a feature of the condition marked as '1' in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Scalp ecchymoses are a common finding"
      },
      {
        "id": 2,
        "text": "Occurs one day after birth"
      },
      {
        "id": 3,
        "text": "20% of the cases result in mortality"
      },
      {
        "id": 4,
        "text": "It leads to neonatal jaundice"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The area marked '1' represents a\u00a0<strong>caput succedaneum.\u00a0Scalp ecchymoses</strong>\u00a0are a <strong>feature</strong> of this condition.</p>\n<p><strong>Caput succedaneum</strong> is an<strong> ill-defined</strong> swelling over the scalp that is caused by <strong>excessive pressure</strong> to the neonatal head by the cervix and pelvic walls during vaginal delivery. It presents as a <strong>diffuse</strong> swelling and is <strong>not limited by suture lines</strong>. It is <strong>present</strong> at the <strong>time of delivery. </strong>It does not require any treatment\u00a0and disappears within 1 week of life.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b30535592f194032b76eb5f9cbd55901.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3417712db30f498780cd3e1a4d88fac0x1280x1035.2011291460833.JPEG"
    ]
  },
  {
    "text": "A 20-year-old man with chickenpox calls his family doctor and asks how long he should isolate to prevent the infection from spreading to his family. What should the physician tell him?",
    "choices": [
      {
        "id": 1,
        "text": "Until fever and malaise subside"
      },
      {
        "id": 2,
        "text": "Until all the lesions disappear"
      },
      {
        "id": 3,
        "text": "Until he finishes a course of acyclovir"
      },
      {
        "id": 4,
        "text": "Until all the lesions are crusted"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The physician should tell the man that he <strong>must isolate</strong> himself from his family <strong>until all</strong> of his skin <strong>lesions</strong> are <strong>crusted.</strong> This will help <strong>to prevent the transmission</strong> of the virus to his family members. Isolation is an important method to prevent the further spread of chickenpox as the <strong>secondary attack rates</strong> in household contacts are <strong>very high (up to 90%).\u00a0</strong>The individual remains <strong>infective </strong>from approximately <strong>48 hours</strong> <strong>before</strong> the appearance of the <strong>rash</strong>, during the time of vesicle formation (4-5 days), and<strong> till</strong> the point where <strong>all the lesions have crusted over</strong>.\u00a0</p>\n<p>Chickenpox is a highly contagious disease\u00a0caused by the <strong>varicella-zoster virus (VZV)</strong>. It spreads via <strong>droplet infection</strong>\u00a0during <strong>personal contact</strong> and enters through the respiratory system or the conjunctiva. The course of chickenpox can be divided into<strong> 2 stages</strong>-</p>\n<ul>\n<li><strong>Pre-eruptive</strong>\u00a0The pre-eruptive stage includes the fever and viral prodrome, which lasts for 2-3 days until the rash begins to appear</li>\n<li><strong>The eruptive stage\u00a0</strong>begins with the appearance of the <strong>rash.</strong> It usually <strong>appears first </strong>on the <strong>trunk,</strong> followed by the limbs and face. The rash quickly goes through the <strong>various stages</strong>\u00a0(<strong>pleomorphism)</strong>-<strong>macule, papule, vesicle</strong>, and finally <strong>scab</strong>. The <strong>vesicle stage</strong> has classically been said to have a <strong>\"dew-drop\" appearance.</strong> <strong>Complications</strong> such as cerebellar ataxia, pneumonia, and encephalitis are <strong>uncommon</strong> but can be seen in some adults and immunocompromised patients.\u00a0</li>\n</ul>\n<p>The usual <strong>control</strong> methods include <strong>notifying</strong> regarding a new case, <strong>isolation,</strong> and <strong>disinfection. </strong>Antiviral therapy like acyclovir can prevent systemic disease, especially in immunosuppressed patients.<strong> Exposed</strong> patients who are<strong> immunocompromised</strong> may receive the varicella-zoster immunoglobulin <strong>(VZIG),\u00a0</strong>within<strong> 72 hours </strong>of<strong> exposure</strong> to a chickenpox patient. The immunoglobulin must be administered immediately as it has no effect once the disease is established.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: Fever and malaise may subside during the eruptive (vesicle formation) stage, but the patient remains contagious at this point.</p>\n<p>Option B: It is unnecessary to isolate until all the lesions have disappeared because the patient is not at risk of transmitting the virus once the lesions have crusted.</p>\n<p>Option C: Acyclovir is recommended in adults and children if started within 24 hours of disease onset. However, in some patients with mild illness, conservative management is sufficient.\u00a0 Regardless of the treatment taken, patients are recommended to follow the same isolation guidelines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old girl presents with frequent episodes of staring spells in school. She is diagnosed with absence seizures. Which of the following is the mechanism of action for ethosuximide, a drug commonly used for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium and calcium channel blockade"
      },
      {
        "id": 2,
        "text": "Inhibits GABA metabolism"
      },
      {
        "id": 3,
        "text": "GABA potentiation"
      },
      {
        "id": 4,
        "text": "Inhibition of the T-type calcium channels"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ethosuximide </strong>is commonly used in children suffering from<strong> absence seizures</strong>. Its mechanism of action is the <strong>inhibition </strong>of<strong> T-type calcium channels</strong>.</p>\n<p>Absence seizures<strong> originate </strong>in the <strong>thalamus</strong> and produce the pathognomonic <strong>3 Hz spike and wave</strong> pattern on <strong>EEG</strong>. This pattern is produced due to the intrinsic properties of the low threshold T-type calcium channels of the thalamus. These channels are activated at a much lower threshold and produce larger currents as compared to most other calcium channels in the brain. Hence, inhibition of these T-type calcium currents in the neurons of the thalamus by ethosuximide is effective for the management of absence seizures.</p>\n<p>Other options:</p>\n<p><strong>Option A: Valproate</strong> acts by <strong>blocking both calcium </strong>and<strong> sodium channels. </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">It is effective in the treatment of <strong>absence, myoclonic, focal, and tonic-clonic seizures.</strong></span></p>\n<p><strong>Option B: Vigabatrin</strong> <strong>inhibits GABA transaminase</strong> and thus increases GABA concentration in the brain. It is the <strong>drug of choice</strong> for <strong>infantile spasms</strong>&nbsp;seen in tuberous sclerosis.</p>\n<p><strong>Option C: Benzodiazepines</strong> <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">enhance GABA-mediated synaptic inhibition. B</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">enzodiazepines act at<strong> GABA<sub>A</sub> receptors </strong>and<strong> increase the frequency</strong>, but not duration, of openings at GABA-activated Cl&minus; channels</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  26-year-old male patient presents with painful ulcers on his penis with the classical \"kissing ulcer\" appearance. He also has tender inguinal lymphadenopathy.  Which of the following will be found on microscopy of the smear from these lesions?",
    "choices": [
      {
        "id": 1,
        "text": "School of fish appearance"
      },
      {
        "id": 2,
        "text": "Spirochetes  on dark field microscopy"
      },
      {
        "id": 3,
        "text": "Donovan bodies"
      },
      {
        "id": 4,
        "text": "Multinucleated  giant cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient with tender genital ulcers with the \"kissing ulcer\" appearance and tender inguinal lymphadenopathy most likely has a diagnosis of <strong>chancroid.</strong>\u00a0The classical \"<strong>school of fish\"/\"railroad track\"</strong> appearance will be found on microscopy of the smear from these lesions, as shown below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f69a8e23b07f46acbe73d405987cc5a4x1280x1319.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/866c8710896d4b0aaf0b5d4d82b2de97x800x600.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5fe86e3d50984d7fb2bcad097f4ca776x720x473.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/39e5bdbc8c2b48ef923aa52b8cfabf6cx394x261.PNG"
    ]
  },
  {
    "text": "A 17-year-old girl presents with small bumps on the cheeks and nasolabial folds as shown in the image below. She is a known case of seizure disorder on medication. On examination, there is a hypopigmented oval patch on the lower back. What is the inheritance pattern of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "X-linked recessive"
      },
      {
        "id": 2,
        "text": "Autosomal recessive"
      },
      {
        "id": 3,
        "text": "Autosomal dominant"
      },
      {
        "id": 4,
        "text": "X-linked dominant"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario of<strong> facial angiofibromas</strong>, <strong>seizures</strong>, and<strong>\u00a0</strong>a<strong> hypomelanotic</strong>\u00a0oval patch\u00a0on the back suggests <strong>tuberous sclerosis</strong> (TS). It has an <strong>autosomal dominant </strong>pattern of inheritance.</p>\n<p>Tuberous sclerosis is a <strong>multisystem disorder</strong> with an autosomal dominant inheritance mode. The mutations involve the <strong>TSC1</strong>\u00a0<strong>gene</strong> that encodes <strong>hamartin </strong>on <strong>chromosome 9</strong>\u00a0and the\u00a0<strong>TSC2 gene\u00a0</strong>that\u00a0encodes a protein\u00a0<strong>tuberin</strong>\u00a0on\u00a0<strong>chromosome 16.</strong></p>\n<p>Tuberous sclerosis is diagnosed when at least <strong>two major</strong> or <strong>one major plus two minor</strong> features are present.</p>\n<ul>\n<li>Major features:\u00a0\n<ul>\n<li>Cortical dysplasias (including tubers and cerebral white matter migration lines)</li>\n<li>Subependymal nodules</li>\n<li>Subependymal giant cell astrocytoma</li>\n<li><strong>Facial angiofibromas</strong> (\u22653) or forehead plaque</li>\n<li>Ungual fibromas (\u22652)</li>\n<li><strong>Hypomelanotic macules</strong> (\u22653, \u22655 mm in diameter)</li>\n<li>Shagreen patch</li>\n<li>Multiple retinal nodular hamartomas</li>\n<li>Cardiac rhabdomyoma</li>\n<li>Renal angiomyolipoma</li>\n<li>Pulmonary lymphangioleiomyomatosis</li>\n</ul>\n</li>\n<li>Minor features:\u00a0\n<ul>\n<li>Dental enamel pits (&gt;3)</li>\n<li>Intraoral fibromas (\u22652)</li>\n<li>Retinal achromic patch</li>\n<li>Confetti skin lesions</li>\n<li>Nonrenal hamartomas</li>\n<li>Multiple renal cysts</li>\n</ul>\n</li>\n</ul>\n<p>The CT image given below shows <strong>subependymal nodules</strong> seen in TS.</p>\n<p>Note: When these lesions are calcified, they project into the ventricular cavity having a <strong>candle-drip appearance.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1e7ba9d4291349c4a7b73bdaeeb32bbf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b71a50ee581049bfa186f29c8d9c3071x1280x1395.JPEG"
    ]
  },
  {
    "text": "A 34-year-old male patient presents with a fever and right-sided swelling behind the angle of jaw. He also complains of odynophagia and difficulty moving his jaw.  He underwent a molar tooth extraction about three days ago. On examination, the ipsilateral faucial tonsil is displaced medially with mild collapse of the tonsillar fossa. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Parapharyngeal abscess"
      },
      {
        "id": 2,
        "text": "Retropharyngeal abscess"
      },
      {
        "id": 3,
        "text": "Peritonsillar abscess"
      },
      {
        "id": 4,
        "text": "Lemierre's syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical vignette is strongly suggestive of a <strong>parapharyngeal abscess (anterior compartment type)</strong>, an infection of the parapharyngeal space.</p>\n<p>This space can get infected following infections of the tonsils, adenoids, and parotid glands. It can also occur following <strong>dental extractions</strong> and penetrating trauma.\u00a0</p>\n<p>Clinically, patients may present with the following features-</p>\n<ul>\n<li>Fever</li>\n<li><strong>Odynophagia</strong> or dysphagia</li>\n<li><strong>Trismus</strong> due to irritation of the medial pterygoid muscle</li>\n<li><strong>The collapse of the tonsillar fossa and tonsil</strong></li>\n<li>Swelling- <strong>Behind the angle of the mandible</strong> (in anterior compartment infection), parotid region or area behind the posterior pillar (in posterior compartment infection)</li>\n<li>Paralysis of IX, X, XI, and XII cranial nerves is commonly seen in infections of the posterior compartment.</li>\n<li>Features of\u00a0internal jugular vein thrombosis and carotid artery thrombosis.</li>\n</ul>\n<p>Diagnosis can be established using a<strong> CECT.</strong></p>\n<p>Patients require <strong>intravenous antibiotic therapy </strong>with<strong> amoxicillin-clavulanic acid</strong>, <strong>carbapenem</strong> antibiotics plus drugs that target anaerobic organisms, such as <strong>clindamycin</strong> or metronidazole.\u00a0A parapharyngeal abscess is drained by an <strong>external\u00a0horizontal incision</strong> made on the skin a few centimeters below the angle of the mandible, followed by blunt dissection.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: Retropharyngeal abscess presents predominantly with features of dysphagia and <strong>difficulty breathing</strong>. Patients may also develop stridor and croupy cough. It is seen as a <strong>bulge on the posterior pharyngeal wall</strong>, most typically, on one side of the midline, unlike parapharyngeal abscesses.\u00a0</p>\n<p>Option C: Peritonsillar abscess or quinsy presents with severe pain in the throat, fever (up to 104 \u00b0F), chills and rigors, and a\u00a0<strong>\u201chot potato voice\"</strong>. On examination, a <strong>bulging of the soft palate</strong> and anterior pillar above the tonsil can be seen.\u00a0Uvula can be pushed to the opposite side.</p>\n<p>Option D: Lemierre\u2019s syndrome is<strong> thrombophlebitis</strong> of the<strong> internal jugular vein</strong> and devastating anaerobic bacteremia that follows oropharyngeal infection. It typically presents in children and young healthy adults as<strong> severe lateral neck pain</strong> and sepsis following prolonged pharyngitis.</p>\n<p>The image attached below shows the compartments and components of the parapharyngeal space.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/975e604426ef4552b8f8cbfeb9ffb07cx1280x1473.1734837799718.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 19';
        const quizFilename = 'mini-test-19-9e8b7f91.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>