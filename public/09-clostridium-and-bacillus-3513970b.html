<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>09 Clostridium And Bacillus - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following organisms is capsulated?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium tetani"
      },
      {
        "id": 2,
        "text": "Clostridium difficile"
      },
      {
        "id": 3,
        "text": "Clostridium perfringens"
      },
      {
        "id": 4,
        "text": "Clostridium botulinum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong><em>Clostridium perfringens</em></strong> is the <strong>capsulated</strong> organism among the given options.</p>\n<p>Most of the clostridial species are non-capsulated except <em>C.perfringens</em> and <em>C.butyricum.</em></p>\n<p>All <strong>clostridia</strong> are <strong>motile,</strong> with a <strong>peritrichate flagella</strong>,<strong>&nbsp;</strong>with the <strong>exception</strong> of:</p>\n<ul>\n<li><em>C. perfringens</em></li>\n<li><em>C. tetani</em> type VI.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man presented with complaints of severe abdominal pain and watery diarrhoea eight hours after consuming meat at a restaurant.  A stool sample was sent for culture and the isolated organism showed this appearance on litmus milk fermentation. Which of the following is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Bacillus anthracis"
      },
      {
        "id": 2,
        "text": "Clostridium tetani"
      },
      {
        "id": 3,
        "text": "Clostridium perfringens"
      },
      {
        "id": 4,
        "text": "Clostridium botulinum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical history and the image showing&nbsp;<strong>stormy fermentation of lactose</strong> in litmus milk is suggestive of gastroenteritis caused by<em><strong>&nbsp;Clostridium perfingens&nbsp;</strong><strong>type A</strong></em>.</p>\n<p>The<strong> fermentation</strong> of lactose by this organism leads to<strong>&nbsp;</strong>the <strong>formation of acid</strong> which<strong>&nbsp;coagulates</strong> the <strong>casein </strong>in litmus milk<strong>. </strong>The clotted milk is disrupted due to<strong> vigorous gas production </strong>and this characteristic finding is obtained that is called <strong>stormy fermentation.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b608ec83c84a45c481b6d5b1a81b5749.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following reactions are positive for Clostridium perfringens?",
    "choices": [
      {
        "id": 1,
        "text": "M'fadyean reaction, CAMP test"
      },
      {
        "id": 2,
        "text": "M'fadyean reaction, Reverse CAMP test,"
      },
      {
        "id": 3,
        "text": "Target hemolysis, Reverse CAMP test"
      },
      {
        "id": 4,
        "text": "Stormy fermentation, Elek's test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Target hemolysis</strong> and <strong>reverse CAMP</strong> test are positive for&nbsp;<strong><em>Clostridium perfringens.</em></strong></p>\n<p>A narrow zone of <strong>complete hemolysis</strong> due to <strong>&theta;-toxin</strong> and a wider zone of <strong>incomplete hemolysis</strong> due to<strong> &alpha;-toxin</strong> results in development of&nbsp;<strong>target hemolysis</strong> on blood agar by<em> C. perfringens</em>.</p>\n<p>In the <strong>reverse CAMP test</strong>, <em>C.perfringens</em> is streaked&nbsp;over the centre of the plate and&nbsp;<strong><em>Streptococcus agalactiae</em></strong>&nbsp;is <strong>streaked at right angles</strong> to it. A positive reverse&nbsp;CAMP test shows the presence of an <strong>arrow-shaped&nbsp;zone</strong> of enhanced <strong>hemolysis </strong>pointing<strong> towards&nbsp;</strong><em><strong>C.perfringens</strong>.</em>&nbsp;&alpha;-toxin produced by <em>C.perfringens</em> interacts with the&nbsp;CAMP factor and produce <strong>synergistic hemolysis</strong>.&nbsp;</p>\n<p style=\"text-align: left;\"><strong>M'fadyean reaction</strong> is positive&nbsp;<em>Bacillus</em> <em>anthracis.</em></p>\n<p style=\"text-align: left;\">The <strong>CAMP test</strong> is positive for <em>Streptococcus agalactiae</em> where it is inoculated on a plate streaked with <em>Staphylococcus aureus</em>.</p>\n<p style=\"text-align: left;\"><strong>Elek's test</strong> is positive for&nbsp;<em>Corynebacterium diptheriae.</em></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged diabetic man presented to the ER with severe abdominal pain, diarrhea and vomiting following consumption of pork and sweet potato curry. Following admission, the patient developed intra-abdominal sepsis and was taken into emergency surgery. Histopathology of the resected intestine showed mucosal necrosis. Which of the following toxins is likely implicated in his condition?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b1-toxin"
      },
      {
        "id": 2,
        "text": "\u03b2-toxin"
      },
      {
        "id": 3,
        "text": "\u03b8-toxin"
      },
      {
        "id": 4,
        "text": "\u03b5-toxin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The condition described here is <strong>necrotising enteritis(pigbel)</strong> that is caused by&nbsp;<strong>&beta;-</strong><strong>toxin</strong> of&nbsp;<strong><em>Clostridium perfringens</em> type-C.</strong></p>\n<p>This is a severe and <strong>often fatal</strong> enteritis caused by <em>C.perfringens</em> type C strains with <strong>heat-resistant spores</strong> that germinate in the intestine producing beta toxin, causing <strong>mucosal necrosis</strong>. The evocative name 'pigbel' is New Guinea pidgin for <strong>abdominal pain and diarrhea</strong> following unaccustomed feasting on <strong>pig&nbsp;</strong><strong>meat</strong> along <strong>with trypsin inhibitors</strong> like sweet potatoes.</p>\n<p><strong>Immunisation</strong> with the <strong>type C toxoid</strong> has been shown to protect against this condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the toxins produced by clostridium species is the basis of Nagler's reaction?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b1-toxin"
      },
      {
        "id": 2,
        "text": "\u03b2-toxin"
      },
      {
        "id": 3,
        "text": "\u03b5-toxin"
      },
      {
        "id": 4,
        "text": "\u03b8-toxin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>&alpha;-</strong><strong>toxin</strong> produced by <strong><em>Clostridium</em> <em>perfringens</em></strong> forms the basis of <strong>Nagler's reaction</strong>.</p>\n<p>The&nbsp;&alpha;-toxin of <em>C.perfringens</em> has <strong>lecithinase</strong> activity. When <em>C.perfringens</em> is grown on a media<strong>&nbsp;</strong>containing egg yolk&nbsp;with the <strong>&alpha;-antitoxin</strong> spread <strong>on one half</strong> of the plate, colonies on the other <strong>half without the antitoxin</strong> will be surrounded by a <strong>zone of opacity</strong>. There will be <strong>no opacity</strong> around the colonies on the half of the plate <strong>with the antitoxin</strong> due to the specific <strong>neutralization</strong> of &alpha;-toxin. This is known as Nagler's reaction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/f7d8a9153fc64aaeb672179a9d225442x607x392.JPEG"
    ]
  },
  {
    "text": "A patient presents with a laceration over his leg following trauma with an unclean sharp metal rod 3 days ago. He also complains of difficulty in opening his mouth and abdominal cramps. Microscopy of the wound discharge revealed rod-shaped bacilli with terminal spherical spores. Which of the following is the organism most likely implicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium perfringens"
      },
      {
        "id": 2,
        "text": "Clostridium botulinum"
      },
      {
        "id": 3,
        "text": "Clostridium tertium"
      },
      {
        "id": 4,
        "text": "Clostridium tetani"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical vignette is strongly suggestive of <strong>tetanus</strong> caused by <em><strong>Clostridium tetani</strong>.</em>&nbsp;It is a <strong>gram-positive</strong>, slender bacillus that&nbsp;has a spherical and terminal spore, giving it a characteristic <strong>drumstick appearance</strong>.</p>\n<p>The genus clostridium consists of gram-positive, anaerobic, spore-forming bacilli.</p>\n<p><strong>Classification of Clostridium</strong> based on shape and position of <strong>spores</strong>:</p>\n<ul>\n<li><strong>Central</strong> or equatorial:&nbsp;&nbsp;<em>Clostridium bifermentans</em></li>\n<li><strong>Subterminal</strong>:&nbsp;<strong><em>Clostridium</em>&nbsp;</strong><em><strong>perfringens</strong>,</em>&nbsp;<em>Clostridium</em>&nbsp;<em>novyi,</em> and&nbsp;<strong><em>Clostridium</em>&nbsp;<em>botulinum</em></strong></li>\n<li><strong>Oval and terminal</strong> (tennis racket shaped ):&nbsp;<strong><em>Clostridium</em>&nbsp;<em>tertium</em></strong> and&nbsp;<em>Clostridium</em>&nbsp;<em>difficile</em></li>\n<li><strong>Spherical and terminal</strong> (drumstick appearance):&nbsp;<em>Clostridium tetani</em></li>\n</ul>\n<p>The below image shows the characteristic drumstick appearance of<em> C. tetani.</em></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/facdee8d464343a9956914c863bf9393x700x469.JPEG"
    ]
  },
  {
    "text": "Which of the following is the first sign of generalized tetanus?",
    "choices": [
      {
        "id": 1,
        "text": "Fever"
      },
      {
        "id": 2,
        "text": "Increased respiratory and GI secretions"
      },
      {
        "id": 3,
        "text": "Trismus"
      },
      {
        "id": 4,
        "text": "Autonomic disturbance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>first sign&nbsp;</strong>of generalized tetanus is <strong>increased tone of the masseter</strong> muscle, which results in&nbsp;<strong>trismus </strong>or<strong> lock-jaw.</strong></p>\n<p><strong>Tetanus</strong>:</p>\n<ul>\n<li>Route of entry of organism- injury, unhygienic surgery, abortion/delivery, otitis media</li>\n<li>The <strong>incubation</strong> period is <strong>6-10 days</strong>.</li>\n<li>First clinical sign- increased masseter tone (trismus/lock-jaw) followed by descending tetanus</li>\n<li>Deep tendon reflex is exaggerated.</li>\n<li>In neonates, difficulty in feeding is the usual presentation.</li>\n<li><strong>Diagnosis</strong> is <strong>always clinical</strong>, microscopy is unreliable.</li>\n<li><strong>Treatment</strong> includes&nbsp;<strong>cleaning</strong>&nbsp;the entry <strong>wound</strong> first in order to remove anaerobic foci of infection and prevent further toxin production. <strong>Metronidazole</strong> is preferred for antibiotic therapy.&nbsp;<strong>Antitoxin</strong> should be given early in an attempt to deactivate any circulating tetanus toxin.&nbsp;Spasms are controlled by <strong>heavy sedation</strong> with <strong>benzodiazepines.&nbsp;</strong>Symptomatic treatment is given for respiratory and cardiovascular derangements.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Strychnine toxin acts by blocking the action of glycine at the post-synaptic receptors in the motor neurons of the anterior horn of the spinal cord. Which of the following has a similar mechanism of action but acts presynaptically?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b1-toxin of C. perfringens"
      },
      {
        "id": 2,
        "text": "Botulinum toxin"
      },
      {
        "id": 3,
        "text": "Tetanus toxin"
      },
      {
        "id": 4,
        "text": "Toxin A of C. difficile"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tetanus toxin</strong> has similar mechanisms of action as strychnine but <strong>acts pre-synaptically.</strong></p>\n<p><strong>Strychnine prevents</strong> the<strong> uptake</strong> of glycine at inhibitory synapses<strong> post-synaptically,&nbsp;</strong>while <strong>t</strong><strong>etanospasmin blocks</strong> <strong>release</strong> of inhibitory neurotransmitters like glycine and gamma-aminobutyric acid (GABA) <strong>pre-synaptically.</strong>&nbsp;This leads to <strong>increased</strong> release of <strong>acetylcholine</strong>, thereby leading to the development of&nbsp;<strong>spastic paralysis.</strong></p>\n<p>The image below depicts the mechanism of action of tetanus toxin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6df75cbc9ba8405e9bc6dde9a3e04990x1280x2027.JPEG"
    ]
  },
  {
    "text": "An 18-year-old girl presents with a contaminated wound sustained 4 hours ago. She had received complete immunization against tetanus 7 years ago. Which of the following injections should be given to her?",
    "choices": [
      {
        "id": 1,
        "text": "Full course tetanus toxoid"
      },
      {
        "id": 2,
        "text": "Single dose tetanus toxoid"
      },
      {
        "id": 3,
        "text": "Human tetanus immunoglobulin"
      },
      {
        "id": 4,
        "text": "Human tetanus immunoglobulin and single dose of toxoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>As she has received <strong>complete immunization</strong> against tetanus <strong>7 years back</strong>, she should be given a<strong> single dose of tetanus toxoid&nbsp;</strong>for her contaminated wound.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly diabetic man presented to the ER with a contaminated wound with necrotic material. As a first-year surgical resident, which of the following would be your first step in treating the conditon?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-gas gangrene serum"
      },
      {
        "id": 2,
        "text": "Debridement"
      },
      {
        "id": 3,
        "text": "Antibiotics"
      },
      {
        "id": 4,
        "text": "Tetanus toxoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Initial treatment</strong> for contaminated wounds with necrotic material is <strong>debridement.</strong></p>\n<p>A contaminated wound with necrotic material is suggestive of a <strong>higher risk</strong> of\u00a0<strong>clostridial infection</strong>\u00a0that may lead to\u00a0<strong>gas gangrene</strong>. Emergent\u00a0<strong>surgical exploration</strong>\u00a0and thorough\u00a0<strong>debridement</strong>\u00a0are extremely important in the management of gas gangrene. <strong>Antibiotics</strong> (penicillin G plus clindamycin) and <strong>anti-gas gangrene serum</strong> have to be initiated after debridement.\u00a0<strong>Hyperbaric oxygen</strong> therapy may also be considered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old man presented with sudden onset descending paralysis and blurred vision  3 days after the intake of canned food. On examination, the patient has quadriparesis with areflexia. Both the pupils are nonreactive. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Poliomyelitis"
      },
      {
        "id": 2,
        "text": "Botulism"
      },
      {
        "id": 3,
        "text": "Gullian Barre Syndrome"
      },
      {
        "id": 4,
        "text": "Tetanus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette of <strong>acute</strong> onset <strong>descending flaccid paralysis</strong>&nbsp;with a history of consumption of <strong>canned food</strong> is suggestive of <strong>botulism</strong>.</p>\n<p>The <strong>incubation period</strong> from ingestion of contaminated food to the onset of symptoms in food-borne botulism is usually <strong>8&ndash;36 h</strong> but can be as long as 10 days and is <strong>dose-dependent</strong>.&nbsp;The clinical syndrome of botulism consists of <strong>bilateral cranial-nerve palsies</strong> that may progress to respiratory compromise, a bilateral descending flaccid paralysis of voluntary muscles, and even death.</p>\n<p>Cranial nerve deficits may manifest as some of the following:</p>\n<ul>\n<li>diplopia</li>\n<li>dysarthria</li>\n<li>dysphonia</li>\n<li>ptosis</li>\n<li>ophthalmoplegia</li>\n<li>facial paralysis and impaired gag reflex</li>\n</ul>\n<p>The absence of cranial nerve palsies makes botulism highly unlikely, as does a lack of cranial nerve deficits at the onset of illness. <strong>Pupillary reflexes</strong> may be <strong>depressed</strong>&nbsp;and fixed or dilated pupils are sometimes noted.</p>\n<p>The cornerstones of <strong>treatment</strong> for botulism are meticulous <strong>intensive care</strong> and administration of <strong>botulinum antitoxin.</strong></p>\n<p>Option A: In poliomyelitis, weakness is generally asymmetric, more proximal than distal, and may involve the legs (most commonly), the arms, or the abdominal, thoracic, or bulbar muscles.</p>\n<p>Option C: Guillain&ndash;Barre&nbsp;syndrome is usually associated with ascending flaccid paralysis.</p>\n<p>Option D: Tetanus causes spastic paralysis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms is predominantly proteolytic in Robertson cooked meat medium?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium perfringens"
      },
      {
        "id": 2,
        "text": "Clostridium botulinum A"
      },
      {
        "id": 3,
        "text": "Clostridium difficile"
      },
      {
        "id": 4,
        "text": "Clostridium septicum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong><em>Clostridium botulinum</em> A </strong>is<strong>\u00a0</strong>predominantly <strong>proteolytic</strong> in Robertson cooked meat medium.</p>\n<p>In <strong>Robertson cooked meat media</strong>, the<strong> saccharolytic</strong> species like\u00a0<em>C.perfringens,</em>\u00a0<em>C.difficile,</em>\u00a0and <em>C.septicum</em> turn the meat <strong>pink</strong>, while the\u00a0<strong>proteolytic</strong> species such as\u00a0<em>C.botulinum</em> A\u00a0turn the meat<strong>\u00a0black</strong>.</p>\n<p>Examples of <strong>predominantly proteolytic</strong> clostridia:</p>\n<ul>\n<li><em>C.bifermentans</em></li>\n<li><em>C.botulinum A, B, F</em></li>\n<li><em>C.histolyticum</em></li>\n</ul>\n<p><strong><em>C. tetani</em></strong> is slightly <strong>proteolytic</strong> but <strong>not saccharolytic</strong>.</p>\n<p>Examples of <strong>predominantly saccharolytic</strong> clostridia:</p>\n<ul>\n<li><em>C.perfringens</em></li>\n<li><em>C.septicum</em></li>\n<li><em>C.novyi</em></li>\n<li><em>C.difficile</em></li>\n</ul>\n<p><em>C.botulinum</em> C, D and E are saccharolytic but not proteolytic.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms form the citron bodies?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium septicum"
      },
      {
        "id": 2,
        "text": "Clostridium histolyticum"
      },
      {
        "id": 3,
        "text": "Clostridium tetani"
      },
      {
        "id": 4,
        "text": "Clostridium perfringens"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Citron bodies</strong> are <strong>boat or leaf-shaped</strong> pleomorphic bacteria, usually associated with <strong><em>Clostridium septicum.</em></strong>&nbsp;</p>\n<p>It is a gram-positive, spore-forming, obligate anaerobic bacterium.</p>\n<p>Gram stain morphology of&nbsp;<em>Clostridium septicum</em>&nbsp;from CSF (a) and blood culture (b) in 1000&times; magnification with spore formation(arrow) is shown below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3c3553e7adb451384e41512f9cc6b9bx472x220.JPEG"
    ]
  },
  {
    "text": "An elderly diabetic lady was brought to the hospital with complaints of diarrhoea and abdominal pain. She had recently been treated with intravenous clindamycin for cellulitis. She was febrile at the time of examination and the blood reports revealed a Hb level of 12g/dl; WBC count of 18000/mm3; and C-reactive protein 160mg/l. What is the most sensitive test to detect the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Glutamate dehydrogenase immunoassay"
      },
      {
        "id": 2,
        "text": "PCR to detect toxin gene"
      },
      {
        "id": 3,
        "text": "Toxigenic culture"
      },
      {
        "id": 4,
        "text": "ELISA to detect toxin antigen"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of a patient having diarrhea following antibiotic administration is suggestive of <strong>pseudomembranous colitis</strong>&nbsp;due to&nbsp;<strong><em>Clostridium difficile.&nbsp;</em></strong><strong>Toxigenic culture</strong> is the<strong> most sensitive method</strong>&nbsp;for the detection of <em>Clostridium difficle</em> infection.&nbsp;</p>\n<p>The methods for diagnosis of <em>Clostridium difficle</em> infection are:</p>\n<ul>\n<li><strong>Toxigenic culture-</strong>&nbsp;<strong>Anaerobic incubation</strong> of the sample in cycloserine-cefoxitin-fructose agar (<strong>CCFA</strong>) or its variant&nbsp;for several days. This is followed by identification of the organism in the growth and tests to confirm toxin production. This method has a <strong>sensitivity</strong> of <strong>100%</strong>.</li>\n<li><strong>Cell cytotoxicity neutralization assay (CCNA)-</strong>&nbsp; A stool filtrate is prepared and applied onto a monolayer of an appropriate cell line. The cells are observed for <strong>toxin-induced cytopathic effect</strong> (CPE). This is <strong>followed by</strong> a <strong>neutralization assay</strong> to confirm that the CPE is attributable to <em>C.difficile</em> toxins. <strong>Sensitivity</strong> is around <strong>75-85%</strong> when compared to toxigenic culture (reference standard)</li>\n<li><strong>Nucleic acid amplification tests (e.g.PCR)-</strong>&nbsp;More <strong>sensitive</strong> (<strong>93.3%</strong>) for <em>C.difficile</em> detection than toxin immunoassays&nbsp;but less sensitive than toxigenic culture.&nbsp;</li>\n<li><strong>Toxin immunoassays-</strong>&nbsp;Enzyme immunoassays using monoclonal or polyclonal antibodies against <em>C.difficile</em> toxins. Sensitivity is lower than other tests.&nbsp;</li>\n<li><strong>Glutamate dehydrogenase immunoassays-</strong>&nbsp;Detects glutamate dehydrogenase, a metabolic enzyme produced by all isolates of <em>C.difficile</em> (toxigenic and nontoxigenic). The test is <strong>highly sensitive</strong> but has <strong>low specificity</strong>.&nbsp;</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td><strong>Test</strong></td>\n<td><strong>Substance detected</strong></td>\n<td><strong>Sensitivity</strong></td>\n<td><strong>Specificity</strong></td>\n</tr>\n<tr>\n<td>Toxigenic culture</td>\n<td><em>C.difficile</em> vegetative cells or spores</td>\n<td>High&nbsp;</td>\n<td>Low*</td>\n</tr>\n<tr>\n<td>Nucleic acid amplification tests&nbsp;</td>\n<td><em>C.difficile</em> nucleic acid for toxin genes&nbsp;</td>\n<td>High&nbsp;</td>\n<td>Low/moderate</td>\n</tr>\n<tr>\n<td>Glutamate dehydrogenase</td>\n<td><em>C.difficile</em> common antigen&nbsp;</td>\n<td>High</td>\n<td>Low*</td>\n</tr>\n<tr>\n<td>CCNA</td>\n<td>Free toxins</td>\n<td>High</td>\n<td>High</td>\n</tr>\n<tr>\n<td>Toxin A and B immunoassays</td>\n<td>Free toxins</td>\n<td>Low</td>\n<td>Moderate</td>\n</tr>\n<tr>\n<td colspan=\"4\">&nbsp;*Must be combined with a toxin test to increase specificity</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A veterinarian developed an ulcer with central black eschar over the forearm as shown in the image. Which of the following is the most probable causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 2,
        "text": "Yersinia pestis"
      },
      {
        "id": 3,
        "text": "Bacillus anthracis"
      },
      {
        "id": 4,
        "text": "Francisella tularensis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>cutaneous anthrax</strong> which is caused by\u00a0<strong><em>Bacillus anthracis.</em></strong></p>\n<p>Human anthrax presents in one of three ways:</p>\n<ul>\n<li><strong>Cutaneous Anthrax</strong>(hide porter\u2019s disease)-<strong>\u00a0</strong><strong>Black eschar </strong>at the base, with a very prominent <strong>inflammatory ring</strong> around the eschar, is referred to as a<strong> malignant pustule.</strong></li>\n<li><strong>Pulmonary Anthrax</strong>(Wool sorter\u2019s disease)-<strong>\u00a0</strong>Hemorrhagic pneumonia.</li>\n<li><strong>Intestinal Anthrax</strong>-\u00a0Hemorrhagic diarrhoea.\u00a0It occurs mainly in primitive communities that eat the carcasses of animals dying of anthrax.</li>\n</ul>\n<p><strong>Robert Koch</strong> validated the germ theory of disease after discovering the <strong>anthrax bacillus</strong> as the cause of anthrax. He also discovered the causative agents of tuberculosis and cholera. Hence, he is known as the <strong>Father of Bacteriology</strong>.</p>\n<p>Koch's postulates, which link specific microorganisms to specific diseases, state that the microorganism must be:</p>\n<ol>\n<li>Found in abundance in <strong>diseased organisms</strong>, but not in healthy organisms.</li>\n<li><strong>Isolated</strong> from a diseased organism and grown in pure culture</li>\n<li>Able to <strong>cause disease when inoculated</strong> into a healthy organism</li>\n<li><strong>Re-isolated</strong> from the diseased experimental host and identical to the original specific causative agent</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ded9f768161f44f3986d3acefbab8d2e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following bacilli characteristically shows the M\u2019Fadyean\u2019s reaction?",
    "choices": [
      {
        "id": 1,
        "text": "Bacillus cereus"
      },
      {
        "id": 2,
        "text": "Clostridium"
      },
      {
        "id": 3,
        "text": "Bacillus anthracis"
      },
      {
        "id": 4,
        "text": "Corynebacterium diphthteriae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>M'Fadyean&rsquo;s reaction is shown by&nbsp;<em><strong>Bacillus anthracis.</strong></em></p>\n<p>When a blood film containing <strong>anthrax bacilli</strong>&nbsp;is stained with <strong>polychrome methylene blue</strong> for a few seconds and examined under the microscope, <strong>amorphous purplish material</strong> is noticed around the bacilli.&nbsp;This represents the <strong>capsular material</strong> and&nbsp;is called <strong>M'Fadyean&rsquo;s reaction.</strong></p>\n<p>The following micrograph shows M'Fadyean's reaction:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/c4abc3179db0416cb7a9c51e3c09f1c5x422x281.JPEG"
    ]
  },
  {
    "text": "A dairy farmer presented to the dermatology OPD with an ulcer with central black eschar over the forearm. Which of the following media can be used as a selective medium for the growth of the likely etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "PLET medium"
      },
      {
        "id": 2,
        "text": "Buffered  charcoal yeast extract medium"
      },
      {
        "id": 3,
        "text": "Cetrimide Agar"
      },
      {
        "id": 4,
        "text": "MYPA agar"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Based on his profession and clinical description of the lesion, the diagnosis is most likely to be\u00a0<strong>cutaneous anthrax</strong> (most common form of anthrax) caused by <strong><em>Bacillus anthracis</em></strong>. The <strong>selective medium</strong> for this organism is <strong>PLET\u00a0</strong>(polymyxin-lysozyme-EDTA-thallous acetate) medium.</p>\n<p>Other options:</p>\n<p>Option B: Buffered charcoal yeast extract medium is used for<strong> Legionella.</strong></p>\n<p>Option C: Cetrimide agar is a selective medium for <strong><em>Pseudomonas aeruginosa</em>.</strong></p>\n<p>Option D: Mannitol, Egg Yolk, Phenol red, Polymyxin Agar (MYPA) medium is a selective medium for <strong><em>Bacillus cereus</em></strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A swab was taken from an ulcer and sent to the laboratory for culture. The following image depicts a blood agar culture plate on which gamma phage suspension has been applied. Which of the following is the most likely organism implicated?",
    "choices": [
      {
        "id": 1,
        "text": "Erysipelothrix rhusiopathiae"
      },
      {
        "id": 2,
        "text": "Clostridium butyricum"
      },
      {
        "id": 3,
        "text": "Bacillus anthracis"
      },
      {
        "id": 4,
        "text": "Bacillus cereus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image with a circular spot of diminished growth in the culture plate from a swab from an ulcer depicts the <strong>gamma phage lysis assay.</strong> The most likely organism implicated is <strong>Bacillus Anthracis</strong>.</p>\n<p>This test is performed by inoculating Bacillus Anthracis in sheep blood agar followed by the application of gamma phage suspension over one area of the culture plate. The gamma phage suspension <strong>inhibits the growth</strong> of Bacillus anthracis colonies resulting in an an area of <strong>diminished growth</strong> called a plaque.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6ce8e7aa686545e4bfa42bff096398a2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following tests is used for the diagnosis of anthrax?",
    "choices": [
      {
        "id": 1,
        "text": "Paul- Bunnell test"
      },
      {
        "id": 2,
        "text": "Kahn test"
      },
      {
        "id": 3,
        "text": "Ascoli's thermoprecipitation test"
      },
      {
        "id": 4,
        "text": "Rose-Waaler test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ascoli's thermoprecipitation</strong> test is used for the diagnosis of<strong> anthrax</strong> caused by&nbsp;<strong><em>Bacillus anthracis.</em></strong> It is an example of<strong>&nbsp;</strong>a <strong>ring precipitation test</strong>.</p>\n<p>Option A: Paul-Bunnell test is used to diagnose<strong> infectious mononucleosis</strong>.</p>\n<p>Option B: Kahn test is used to diagnose <strong>syphilis</strong>.</p>\n<p>Option D: Rose-Waaler test is used to diagnose <strong>rheumatoid arthritis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young patient presented to the medicine OPD with complaints of nausea and vomiting. He gave a history of having fried rice from a local Chinese restaurant a few hours ago. What is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium perfringens"
      },
      {
        "id": 2,
        "text": "Bacillus cereus"
      },
      {
        "id": 3,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 4,
        "text": "Bacillus anthracis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Based on the symptoms and a history of consuming <strong>fried rice 6 hours ago</strong>, we can diagnose this to be a case of <strong>food poisoning</strong> due to<em><strong> Bacillus cereus</strong></em>.</p>\n<p>Food poisoning cause by <em>B. cereus</em> is of <strong>two types</strong>:</p>\n<table style=\"height: 242px;\" width=\"437\">\n<tbody>\n<tr>\n<td style=\"width: 138.34375px;\"><em>Bacillus cereus</em></td>\n<td style=\"width: 138.34375px;\">Diarrheal type</td>\n<td style=\"width: 138.34375px;\">Emetic type</td>\n</tr>\n<tr>\n<td style=\"width: 138.34375px;\">Incubation period</td>\n<td style=\"width: 138.34375px;\">8-16 hours</td>\n<td style=\"width: 138.34375px;\">1-5 hours</td>\n</tr>\n<tr>\n<td style=\"width: 138.34375px;\">Toxin</td>\n<td style=\"width: 138.34375px;\">Secreted in intestine</td>\n<td style=\"width: 138.34375px;\">Preformed</td>\n</tr>\n<tr>\n<td style=\"width: 138.34375px;\">Heat</td>\n<td style=\"width: 138.34375px;\">Heat labile</td>\n<td style=\"width: 138.34375px;\">Heat stable</td>\n</tr>\n<tr>\n<td style=\"width: 138.34375px;\">Food items</td>\n<td style=\"width: 138.34375px;\">Meat</td>\n<td style=\"width: 138.34375px;\">Rice</td>\n</tr>\n<tr>\n<td style=\"width: 138.34375px;\">Clinical feature</td>\n<td style=\"width: 138.34375px;\">Diarrhea, abdominal cramps</td>\n<td style=\"width: 138.34375px;\">Vomiting, abdominal cramps</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can grow in an acidic pH?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio"
      },
      {
        "id": 2,
        "text": "Lactobacilli"
      },
      {
        "id": 3,
        "text": "Salmonella"
      },
      {
        "id": 4,
        "text": "Shigella"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span class=\"topic-highlight\">Among the given options,<strong> lactobacilli</strong>\u00a0is the one that can grow in an <strong>acidic pH.</strong></span></p>\n<p><span class=\"topic-highlight\">It\u00a0</span>is a gram-positive<strong>, </strong>facultatively anaerobic, non-motile, non\u2013spore-forming bacterium. <span class=\"topic-highlight\">Lactobacillus</span>\u00a0derives <strong>lactic acid</strong> from <strong>glucose</strong>, creating an acidic environment, and can grow in an acidic medium. It is found in the <strong>vagina</strong> as part of its <strong>normal microbiota.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '09 Clostridium And Bacillus';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>