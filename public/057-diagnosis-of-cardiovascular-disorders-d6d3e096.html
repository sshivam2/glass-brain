<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>057 Diagnosis Of Cardiovascular Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "'a' wave in JVP corresponds to?",
    "choices": [
      {
        "id": 1,
        "text": "Right atrial contraction"
      },
      {
        "id": 2,
        "text": "Closure of tricuspid valve"
      },
      {
        "id": 3,
        "text": "Onset of ventricular systole"
      },
      {
        "id": 4,
        "text": "Maximal atrial filling"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong>&nbsp;\"a\" wave</strong> in jugular venous pressure (JVP) is a positive wave, which corresponds to<strong>&nbsp;right atrial contraction.</strong></p>\n<p>The waveforms seen in a normal JVP are:</p>\n<ul>\n<li>a wave corresponds to atrial contraction and occurs just after the P wave (on ECG) and just before the first heart sound.</li>\n<li>c wave represents the bulging of the tricuspid valve into the right atrium during ventricular systole.</li>\n<li>x descent corresponds to the atrial relaxation during atrial diastole.</li>\n<li>v wave represents atrial filling during ventricular systole and peaks at the second heart sound.</li>\n<li>y descent represents passive emptying of the right atrium into the right ventricle after tricuspid valve opening.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29c964e05da6489d9d243a1f25e8a032x1280x1005.JPEG"
    ]
  },
  {
    "text": "The c wave seen in a normal JVP waveform represents?",
    "choices": [
      {
        "id": 1,
        "text": "Bulging of tricuspid valve into the right atrium"
      },
      {
        "id": 2,
        "text": "Atrial relaxation during atrial diastole"
      },
      {
        "id": 3,
        "text": "Venous filling of the right atrium"
      },
      {
        "id": 4,
        "text": "Emptying of the right atrium into the right ventricle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The c-wave in a JVP waveform represents the bulging of the tricuspid valve into the right atrium during ventricular systole.</p>\n<p><strong>JVP</strong> measured in the internal jugular vein is a reflection of the&nbsp;<strong>right atrial pressure</strong>.</p>\n<p>The waveforms seen in a normal JVP are:</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li>a wave corresponds to atrial contraction and occurs just after the P wave (on ECG) and just before the first heart sound.</li>\n<li>c wave represents the bulging of the tricuspid valve into the right atrium during ventricular systole.</li>\n<li>x descent corresponds to the atrial relaxation during atrial diastole.</li>\n<li>v wave represents atrial filling during ventricular systole and peaks at the second heart sound.</li>\n<li>y descent represents passive emptying of the right atrium into the right ventricle after tricuspid valve opening.</li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eddc167e55494ad8a3d429b278359fa0x1280x1005.JPEG"
    ]
  },
  {
    "text": "The following abnormality on a JVP waveform can be seen in which of the given conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 3,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 4,
        "text": "Atrial fibrillation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given waveform shows a <strong>c</strong><strong>annon &lsquo;a&rsquo; wave</strong> seen in <strong>ventricular tachycardia</strong>. It occurs since atria contract against a closed tricuspid valve in ventricular tachycardia.</p>\n<p>JVP measured in the internal jugular vein is a reflection of the <strong>right atrial pressure.</strong></p>\n<p>Note: Giant/prominent a-waves occur during every beat while cannon a-waves&nbsp;result from arrhythmias, therefore, are usually intermittent. The ECG is helpful to look for rhythm disturbances that are associated with cannon a-waves whereas echocardiography can be used to assess structural defects (of right atrium) that are associated with giant a-waves.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/05e9bad274c2480d9bff0f19ccb7452e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71da9a7e43614b29ab0d3c9000cdd94bx1280x958.JPEG"
    ]
  },
  {
    "text": "A 37-year-old male patient comes to the clinic with complaints of weakness, restlessness, and chest pain. On examination, his blood pressure is found to be 90/60 mmHg, his heart sounds are muffled, and his neck veins are distended. What is the typical JVP finding in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Absent a wave"
      },
      {
        "id": 2,
        "text": "Prominent a wave"
      },
      {
        "id": 3,
        "text": "Rapid y descent"
      },
      {
        "id": 4,
        "text": "Absent y descent"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hypotension</strong>, <strong>soft</strong> or absent<strong> heart sounds,</strong> and <strong>jugular venous distention</strong>&nbsp;(<strong>Beck&rsquo;s triad)&nbsp;</strong>are the three principal features of <strong>cardiac tamponade. </strong>The typical JVP finding here is&nbsp;<strong>absent y-descent</strong>.</p>\n<p>JVP shows a <strong>prominent x </strong>(early systolic) descent and an <strong>absent y </strong>(early diastolic) descent because of the ventricle's limited or<strong> absent early diastolic filling</strong>.&nbsp;JVP is almost always elevated in cardiac tamponade and may be associated with venous distention in the forehead and scalp.</p>\n<p>There may be reductions in the amplitude of the QRS complexes, and electrical alternans of the P, QRS, or T waves in cardiac tamponade.</p>\n<p>Note: Alternation of QRS complexes, usually in a 2:1 ratio, on ECG is called electrical alternans. It is caused by the movement of the heart in the pericardial space. Electrical alternans is also seen in patients with myocardial ischemia, acute pulmonary embolism, and tachyarrhythmias.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d6e618c142f40fbb8bd49d311bac2a5x1280x1518.JPEG"
    ]
  },
  {
    "text": "Deep y descent in JVP is seen in all except:",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Restrictive cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Constrictive pericarditis"
      },
      {
        "id": 4,
        "text": "Tricuspid regurgitation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>y-descent </strong>in jugular venous pulse (JVP) corresponds to the <strong>fall in right atrial pressure</strong> after the tricuspid valve opening in the early diastolic phase of the right ventricle. <strong>Y-descent</strong> is attenuated or<strong> absent </strong>in<strong> cardiac tamponade</strong> because of resistance to ventricular filling in the early diastole.</p>\n<p>Other options:</p>\n<p>Options B and C: <strong>Restrictive cardiomyopathy</strong> and <strong>constrictive pericarditis</strong> can have <strong>deep y descent</strong> due to rapid filling of the right ventricle during early diastole.</p>\n<p>Option D: In patients with <strong>tricuspid regurgitation</strong>, increased blood flow to the right atria through the incompetent tricuspid valve during ventricular systole results in a <strong>prominent v wave</strong>. When the tricuspid valve opens during ventricular diastole, this increased blood in the right atria enters rapidly into the right ventricle during early diastole resulting in <strong>deep y-descent</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following four patients were examined on a tilt table for postural hypotension. The blood pressures before and immediately after performing head-up tilt are given below. Choose the correct option regarding the patients who suffer from orthostatic hypotension.",
    "choices": [
      {
        "id": 1,
        "text": "2, 3"
      },
      {
        "id": 2,
        "text": "1, 2, 4"
      },
      {
        "id": 3,
        "text": "1, 4"
      },
      {
        "id": 4,
        "text": "2, 3, 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span class=\"s1\">Orthostatic hypotension is defined as a reduction in&nbsp;<strong>systolic blood pressure</strong>&nbsp;of at least&nbsp;<strong>20 mmHg</strong>&nbsp;or&nbsp;<strong>diastolic blood pressure</strong>&nbsp;of at least&nbsp;<strong>10 mmHg</strong>&nbsp;within<strong> 3 min of standing</strong>&nbsp;or head-up tilt on a tilt table. </span></p>\n<p><span class=\"s1\">On standing, blood is displaced to the lower extremities, causing a drop in the venous return to the heart. This drop leads to a decrease in cardiac output and stimulation of compensatory mechanisms which trigger a reflex increase in sympathetic (vasoconstrictor) outflow. Orthostatic hypotension&nbsp;is a manifestation of <strong>sympathetic (autonomic) failure</strong>.&nbsp;</span></p>\n<p><span class=\"s1\">Symptoms include light-headedness, dizziness, and presyncope (near-faintness) in response to sudden postural change.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pulsus paradoxus is seen in all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "COPD"
      },
      {
        "id": 2,
        "text": "Tension pneumothorax"
      },
      {
        "id": 3,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Cardiac tamponade"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Pulsus bisferiens</strong> is seen in <strong>hypertrophic cardiomyopathy</strong>, not pulsus paradoxus.</p>\n<p><strong>Pulsus paradoxus</strong> refers to the <strong>fall in systolic pressure by &gt; 10 mmHg</strong> with inspiration. It is an exaggeration of the normal response. It is seen in the following conditions:</p>\n<ul>\n<li>Cardiac tamponade</li>\n<li>Massive pulmonary embolism</li>\n<li>Hemorrhagic shock</li>\n<li>Obstructive lung disease</li>\n<li>Tension pneumothorax</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pulsus bisferiens is seen in all of the following conditions except:",
    "choices": [
      {
        "id": 1,
        "text": "Advanced aortic regurgitation"
      },
      {
        "id": 2,
        "text": "AS with AR"
      },
      {
        "id": 3,
        "text": "Left ventricular dysfunction"
      },
      {
        "id": 4,
        "text": "Hypertrophic cardiomyopathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Pulsus alternans </strong>(characterized by<strong>&nbsp;</strong>alternating strong and weak beats) is seen in<strong> left ventricular dysfunction.</strong>&nbsp;</p>\n<p><strong>Pulsus bisferiens</strong> is a bifid pulse with <strong>two systolic peaks.&nbsp;</strong>It is seen in the following conditions:</p>\n<ul>\n<li>Advanced aortic regurgitation (AR)</li>\n<li>Aortic stenosis (AS) with AR</li>\n<li>Hypertrophic cardiomyopathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d2cd58f4c7674dae813b871e0d41baa1x1280x1617.JPEG"
    ]
  },
  {
    "text": "Water hammer pulse is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic stenosis"
      },
      {
        "id": 2,
        "text": "Aortic regurgitation"
      },
      {
        "id": 3,
        "text": "Aortic stenosis and aortic regurgitation"
      },
      {
        "id": 4,
        "text": "Mitral regurgitation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Severe AS</strong> (Option A) would show<strong> pulsus parvus et tardus,</strong> characterized by the carotid pulse rising slowly to a delayed peak.&nbsp;</p>\n<p><strong>Chronic mitral regurgitation</strong> (Option D) shows a sharp, low volume upstroke due to reduced cardiac output and acute mitral regurgitation demonstrates narrow pulse pressure.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58e1f5a9c9e94cf8bce33fa1de43073ex1002x942.PNG"
    ]
  },
  {
    "text": "A loud S1 is associated with?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatic mitral stenosis"
      },
      {
        "id": 2,
        "text": "Calcified mitral stenosis"
      },
      {
        "id": 3,
        "text": "Aortic regurgitation"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Rheumatic mitral stenosis is associated with loud S1.</p>\n<p>The greater the distance the valve travels to close, the louder is the sound. Increased left atrial pressures in <strong>rheumatic mitral stenosis</strong> force the mobile portion of the mitral valve leaflets far apart such that they are forced closed from a relatively<strong> far distance</strong>, resulting in a <strong>loud</strong> S1. In <strong>calcific</strong> mitral stenosis, leaflet <strong>mobility</strong> is<strong> poor</strong>, and they are not separated by a large distance, resulting in a <strong>soft</strong> S1.</p>\n<p>Loud S1 is heard in the following:</p>\n<ul>\n<li>Short PR intervals</li>\n<li>Early stages of mitral stenosis as long as the valves are pliable</li>\n<li>Atrial myxoma</li>\n<li>High output states</li>\n<li>Tachycardia</li>\n</ul>\n<p>Soft S1 is heard in the following:</p>\n<ul>\n<li>Mitral regurgitation</li>\n<li>Aortic regurgitation</li>\n<li>Long PR intervals</li>\n<li>Calcified Mitral stenosis</li>\n<li>Left ventricular contractile dysfunction</li>\n<li>Beta-receptor blockers</li>\n<li>Pericardial effusion, obesity, COPD- due to decreased conduction through the chest wall</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A hypertensive patient presented with chest pain and was found to have dilated cardiomyopathy on an echocardiogram. On auscultation, a reversed splitting of second heart sound was heard. Which of the following could most likely be responsible for the same?",
    "choices": [
      {
        "id": 1,
        "text": "RBBB"
      },
      {
        "id": 2,
        "text": "ASD"
      },
      {
        "id": 3,
        "text": "LBBB"
      },
      {
        "id": 4,
        "text": "VSD"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Reversed (or paradoxical) splitting refers to the situation when P2 is heard before A2. This is seen in the following:</p>\n<ul>\n<li>LBBB</li>\n<li>HOCM</li>\n<li>Right ventricular pacing</li>\n<li>Severe AS</li>\n<li>Acute myocardial ischemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Disappearance of loud S1 in mitral stenosis occurs in all except:",
    "choices": [
      {
        "id": 1,
        "text": "First degree heart block"
      },
      {
        "id": 2,
        "text": "AR"
      },
      {
        "id": 3,
        "text": "Calcified valve"
      },
      {
        "id": 4,
        "text": "Mild MS"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Loud S1</strong> is heard in <strong>mild mitral stenosis</strong> (MS).</p>\n<p>The <strong>intensity of S1</strong> depends on the <strong>distance</strong> over which the <strong>anterior leaflet </strong>of the mitral valve <strong>moves</strong>, <strong>leaflet mobility</strong>, <strong>LV contractility</strong>, and <strong>PR interval</strong>. It is independent of the severity of MS.</p>\n<p>Loud S1 is seen in early rheumatic MS, short PR interval, and hyperdynamic circulatory states.</p>\n<p>S1 becomes soft in case of calcified leaflets, long PR interval, associated aortic regurgitation and LV dysfunction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While examining a patient, you hear a widely split S2 on auscultation. Which of the following is not a possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial septal defect"
      },
      {
        "id": 2,
        "text": "Mitral regurgitation"
      },
      {
        "id": 3,
        "text": "Pulmonary stenosis"
      },
      {
        "id": 4,
        "text": "Left bundle branch block"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A wide split of S2 is not seen in the left bundle branch block (<strong>LBBB</strong>), however <strong>paradoxical splitting</strong> is seen.</p>\n<p><strong>S2</strong> is normally heard as <strong>A2-P2</strong>. This split is<strong> exaggerated</strong> in conditions that cause early aortic valve closure or delayed pulmonary valve closure.</p>\n<p>Option A: In atrial septal defect (ASD), left ventricle (LV) ejection time decreases due to the shunting of the blood from the left atrium (LA) to the right atrium leading to <strong>early aortic valve closure</strong>.</p>\n<p>Option B: In mitral regurgitation (MR), due to the regurgitation of blood from the LV to the LA, the LV ejection time decreases leading to <strong>early aortic valve closure</strong>.</p>\n<p>Option C: In pulmonary stenosis (PS), the <strong>delayed closure </strong>of<strong> pulmonary valves</strong> leads to the splitting of S2.</p>\n<p>Wide splitting of S2 is also heard in RBBB and LV&nbsp;pacing.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is associated with a fixed wide splitting of S2?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral regurgitation"
      },
      {
        "id": 2,
        "text": "RBBB"
      },
      {
        "id": 3,
        "text": "Atrial septal defect"
      },
      {
        "id": 4,
        "text": "LV pacing"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Fixed wide splitting </strong>of <strong>S2</strong> is seen in atrial septal defect (<strong>ASD</strong>).</p>\n<p>The ASD creates a <strong>left to right shunt</strong> that increases the blood flow to the right side of the heart. This causes the <strong>pulmonary valve to close later</strong> than the aortic valve independent of inspiration/expiration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true?",
    "choices": [
      {
        "id": 1,
        "text": "S3 and S4 are high pitched systolic sounds"
      },
      {
        "id": 2,
        "text": "S3 is always pathological"
      },
      {
        "id": 3,
        "text": "S4 is heard during the ventricular-filling phase"
      },
      {
        "id": 4,
        "text": "S3 occurs due to rapid filling of the ventricles during atrial systole"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>S4 is heard during the ventricular-filling phase.</p>\n<p>S3 and S4 are <strong>diastolic sounds</strong> that are&nbsp;<strong>low pitched, </strong>and best heard with the bell of the stethoscope at the cardiac apex in the left lateral decubitus position.</p>\n<table style=\"height: 271px; width: 493px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 241.222px; height: 18px; text-align: center;\"><strong>&nbsp;S3 - Ventricular gallop</strong></td>\n<td style=\"width: 249.778px; height: 18px; text-align: center;\">&nbsp;<strong>S4 - Atrial gallop</strong></td>\n</tr>\n<tr style=\"height: 62px;\">\n<td style=\"text-align: center;\">\n<p><br />&nbsp;Occurs during early ventricular diastole</p>\n</td>\n<td style=\"text-align: center;\">\n<p>Occurs near the end of ventricular diastole</p>\n</td>\n</tr>\n<tr style=\"height: 62px;\">\n<td style=\"text-align: center;\">\n<p>During the first rapid ventricular filling</p>\n</td>\n<td style=\"text-align: center;\">&nbsp;During active ventricular filling&nbsp; &nbsp; &nbsp; &nbsp;(filling by atrial contraction)</td>\n</tr>\n<tr style=\"height: 37px;\">\n<td style=\"text-align: center;\">\n<p>Due to a sudden rush of blood entering a volume-depleted ventricle (<strong>n</strong><strong>ormal ventricular compliance</strong>)</p>\n</td>\n<td style=\"text-align: center;\">\n<p>Due to<strong>&nbsp;</strong>vibration of the ventricular wall during atrial contraction because of&nbsp;increased stiffness of ventricular walls (<strong>d</strong><strong>ecreased ventricular compliance</strong>)</p>\n</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"text-align: center;\">It <strong>can be physiological</strong> in children and young adults.</td>\n<td style=\"text-align: center;\"><strong>Always pathological</strong></td>\n</tr>\n<tr style=\"height: 45px;\">\n<td style=\"text-align: center;\">In older patients, it indicates systolic heart failure</td>\n<td style=\"text-align: center;\">Indicates diastolic heart failure</td>\n</tr>\n</tbody>\n</table>\n<p class=\"p1\">The presence of an S<span class=\"s1\">3 </span>and S<span class=\"s1\">4 </span>heart sound is called a summation gallop and sounds like a galloping horse.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An ECG of a patient who underwent pulmonary artery catheterization showed a right bundle branch block. On auscultation, a widely split S1 was observed. Which of the following is true regarding this auscultatory finding?",
    "choices": [
      {
        "id": 1,
        "text": "The split increases with inspiration"
      },
      {
        "id": 2,
        "text": "The split increases with expiration"
      },
      {
        "id": 3,
        "text": "The split remains constant with inspiration and expiration"
      },
      {
        "id": 4,
        "text": "The change in split depends on the degree of bundle branch block"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a patient with a right bundle branch block (<strong>RBBB</strong>), there's a widely<strong> split S1 </strong>which<strong> increases with inspiration</strong>.</p>\n<p>S1 is normally heard as a single sound. Any delay in the closure of the tricuspid valve or early closure of the mitral valve produces a split in S1. During <strong>inspiration</strong>, <strong>venous return </strong>to the right atrium<strong> increases</strong>. Therefore, the atria take a longer time to empty into the ventricles&nbsp;<strong>delaying the closure of the tricuspid valve</strong>. This increases the split in S1 during inspiration.&nbsp;In a patient with an RBBB, the tricuspid valve closure is further delayed leading to a wide split in S1.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old woman presents with a history of occasional palpitations. She has no history of chest pain or dyspnea. On examination, blood pressure is 110/70 mmHg, the pulse is 82/min and regular. Joint hypermobility and thoracolumbar scoliosis are present. Gorlin's sign is positive. On auscultation, a click is heard after S1, followed by a late systolic murmur.  What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ehlers-Danlos syndrome"
      },
      {
        "id": 2,
        "text": "Marfan's syndrome"
      },
      {
        "id": 3,
        "text": "Loeys-Dietz syndrome"
      },
      {
        "id": 4,
        "text": "Osteogenesis imperfecta"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The probable diagnosis of the above scenario is <strong>Ehlers-Danlos syndrome</strong> (EDS).</p>\n<p class=\"p1\"><span class=\"s1\">EDS is a group of clinically and genetically heterogeneous connective tissue disorders. Typical presenting features include <strong>joint hypermobility</strong>, <strong>skin hyperextensibility</strong>, and tissue fragility. EDS type 6 is also characterized by <strong>scoliosis</strong>.&nbsp;<strong>Gorlin&rsquo;s sign&nbsp;</strong>refers to&nbsp;the ability of patients of&nbsp;Ehlers-Danlos syndrome&nbsp;to touch the tip of the nose with the tip of their tongue.</span></p>\n<p class=\"p1\"><span class=\"s1\">Mitral valve prolapse&nbsp;(MVP)&nbsp;is a frequent finding in patients with EDS. An early <strong>systolic click</strong> which may be followed by a <strong>late systolic murmur</strong> is the auscultatory finding heard in MVP.&nbsp;</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a diastolic sound?",
    "choices": [
      {
        "id": 1,
        "text": "S3"
      },
      {
        "id": 2,
        "text": "S4"
      },
      {
        "id": 3,
        "text": "Opening snap"
      },
      {
        "id": 4,
        "text": "Ejection click"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ejection click is a <strong>systolic sound</strong>.&nbsp;</p>\n<p><strong>Ejection clicks</strong>&nbsp;are high-pitched sounds that occur at the moment of the&nbsp;<strong>maximal opening</strong> of the <strong>aortic </strong>or<strong> pulmonary valves</strong>. They are heard just after the first heart sound.</p>\n<p>Ejection clicks occur in:</p>\n<ul>\n<li>Non-calcific aortic or pulmonary stenosis</li>\n<li>Aortic or pulmonary root dilatation&nbsp;</li>\n<li>Congenital bicuspid aortic or pulmonary valves</li>\n</ul>\n<p><strong>Nonejection clicks</strong>, which occur after the onset of the carotid upstroke, are related to the <strong>m</strong><strong>itral valve prolapse</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On auscultation of a patient, you hear a murmur between S1 and S2. Which of the following conditions is not likely to be associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 3,
        "text": "Ventricular septal defect"
      },
      {
        "id": 4,
        "text": "Pulmonary regurgitation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A murmur occurring <strong>between S1 and S2</strong> is a <strong>systolic murmur.</strong> Pulmonary regurgitation produces a diastolic murmur.</p>\n<p>The causes of <strong>systolic</strong> murmurs are as follows:</p>\n<ul>\n<li>Mid-systolic- aortic stenosis, pulmonic stenosis, ASD, HOCM.</li>\n<li>Holosystolic/pansystolic- mitral regurgitation, tricuspid regurgitation, VSD.</li>\n<li>Late systolic- mitral valve prolapse.</li>\n</ul>\n<p>The causes of <strong>diastolic</strong> murmurs are as follows:</p>\n<ul>\n<li>Early diastolic- aortic regurgitation, pulmonic regurgitation.</li>\n<li>Mid/late diastolic- mitral stenosis, tricuspid stenosis,&nbsp;Austin-Flint.</li>\n</ul>\n<p>The causes of <strong>continuous</strong> murmurs are as follows:</p>\n<ul>\n<li>Patent ductus arteriosus (machinery or Gibson's murmur).</li>\n<li>Venous hum</li>\n<li>AV fistula</li>\n<li>Ruptured sinus of Valsalva aneurysm</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While examining a patient, you hear a mid-diastolic murmur with presystolic accentuation on auscultation of the precordium. Which of the following condition is associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral regurgitation"
      },
      {
        "id": 2,
        "text": "MVP"
      },
      {
        "id": 3,
        "text": "Aortic stenosis"
      },
      {
        "id": 4,
        "text": "Mitral stenosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A<strong> mid-diastolic murmur</strong> with <strong>presystolic accentuation&nbsp;</strong>and an opening snap is typically seen in <strong>mitral stenosis.</strong></p>\n<p>The presystolic accentuation is due to the <strong>atrial contraction</strong> forcing blood through the stenosed mitral valve. The presystolic accentuation <strong>disappears in atrial fibrillation</strong>.</p>\n<p>Option A: Mitral regurgitation&nbsp;presents with a holosystolic murmur, best heard at the apex with radiation to the left axilla.</p>\n<p>Option B: Mitral valve prolapse&nbsp;presents with an early systolic click followed by a late systolic murmur is heard.</p>\n<p>Option C: Aortic stenosis presents with&nbsp;a harsh crescendo-decrescendo ejection systolic murmur heard best at the right upper sternal border, with radiation of the murmur to the carotid arteries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a part of a health camp conducting check-ups for cardiovascular ailments. On auscultation of a patient's precordial area, you hear a systolic murmur. On asking the patient to perform the following maneuver, the intensity of the murmur increased. Which of the following conditions is associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "MR"
      },
      {
        "id": 2,
        "text": "TR"
      },
      {
        "id": 3,
        "text": "AS"
      },
      {
        "id": 4,
        "text": "HCM"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image shows the <strong>Valsalva maneuver</strong>. The murmur of hypertrophic cardiomyopathy (<strong>HCM</strong>) <strong>increases</strong> in intensity while performing the Valsalva maneuver.</p>\n<p>The murmurs produced by<strong> TR</strong> (tricuspid regurgitation), <strong>AS</strong> (aortic stenosis), and<strong> MR</strong> (mitral regurgitation) <strong>decrease</strong> in intensity while performing the Valsalva maneuver.</p>\n<p>Note:&nbsp;Valsalva maneuver decreases the intensity of all murmurs except&nbsp;<strong>MVP</strong>&nbsp;(mitral valve prolapse)<strong>&nbsp;</strong>and<strong> HCM.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80a715e52b5f4dd3b7185306538bdf90.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "While auscultating a patient's precordium, a murmur was heard that decreased in intensity on performing the following sustained maneuver. Which of the given condition is associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral regurgitation"
      },
      {
        "id": 2,
        "text": "Ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Aortic regurgitation"
      },
      {
        "id": 4,
        "text": "Aortic stenosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image shows a sustained handgrip maneuver. The murmur of <strong>aortic stenosis</strong> decreases in intensity during<strong> sustained handgrip</strong>.</p>\n<p>Maneuvers like sustained handgrip, simultaneous inflation of blood pressure cuffs above the systolic in both upper limbs, and infusion of vasopressors <strong>increase the systemic vascular resistance&nbsp;</strong>(afterload).&nbsp;Since increasing afterload will prevent blood from flowing in a normal forward path, it will increase any murmurs that are due to backward flowing blood and decresase the ones due to forward blood flow.</p>\n<p>Murmurs that <strong>increase</strong> in intensity on sustained handgrip:</p>\n<ul>\n<li>Mitral regurgitation</li>\n<li>Ventricular septal defect</li>\n<li>Aortic regurgitation</li>\n</ul>\n<p>Murmurs that <strong>decrease</strong> in intensity on sustained handgrip:</p>\n<ul>\n<li>Aortic stenosis</li>\n<li>Hypertrophic cardiomyopathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/56062e05fec34e4bb4c6c74925931c67.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following murmur increases on standing?",
    "choices": [
      {
        "id": 1,
        "text": "HOCM"
      },
      {
        "id": 2,
        "text": "MR"
      },
      {
        "id": 3,
        "text": "MS"
      },
      {
        "id": 4,
        "text": "VSD"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The murmur of hypertrophic cardiomyopathy (HOCM) <strong>increases with standing</strong>, as there is a reduction in preload. In conditions of reduced preload, there is lesser end diastolic volume in the left ventricle, leading to a narrower outflow tract, and a louder murmur is heard.</p>\n<p>The <strong>murmur</strong> heard in <strong>HOCM</strong> is a <strong>mid-systolic&nbsp;murmur</strong>, which is <strong>loudest</strong> along the <strong>left sternal border</strong>. It <strong>increases</strong> in conditions of <strong>decreased preload and afterload</strong> (standing, valsalva, vagal maneuvers) or conditions of <strong>increased contractility</strong> (inotropic stimulation) and <strong>decreases</strong> when <strong>preload and afterload</strong> are <strong>increased</strong> (squatting, vasopressors).</p>\n<p>Most murmurs decrease in intensity with reduced preload and afterload except HOCM and mitral valve prolapse (MVP). </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child was being evaluated for an underlying cardiac defect. On auscultation, a murmur was heard which began in systole, enveloped the second heart sound, and continued through some portion of the diastole. Which of the following condition is not associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular septal defect with aortic regurgitation"
      },
      {
        "id": 2,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 3,
        "text": "Coronary arteriovenous fistula"
      },
      {
        "id": 4,
        "text": "Venous hum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The murmur described above is a <strong>continuous murmur</strong>.\u00a0</p>\n<p>A continuous murmur is produced when there is a pressure gradient between the cardiac chambers or the blood vessels throughout the systole and diastole. Continous murmurs are characterised by the flow of blood in the <strong>same direction</strong> and through the <strong>same channel</strong> during systole and diastole. These murmurs begin in systole, envelope the second heart sound (S2), and continue through some portion of diastole.</p>\n<p>Conditions producing a continuous murmur:</p>\n<ul>\n<li>Patent ductus arteriosus</li>\n<li>Venous hum</li>\n<li>AV fistula</li>\n<li>Ruptured sinus of Valsalva aneurysm</li>\n</ul>\n<p>Ventricular septal defect with aortic regurgitation does not produce a continuous murmur. It produces a systolic-diastolic murmur as the blood flows through different channels during systole and diastole. These murmurs do not envelope S2.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about Gallavardin effect?",
    "choices": [
      {
        "id": 1,
        "text": "It is associated with a diastolic murmur"
      },
      {
        "id": 2,
        "text": "It is seen in aortic stenosis"
      },
      {
        "id": 3,
        "text": "It refers to the radiation of murmur to the carotids"
      },
      {
        "id": 4,
        "text": "The transmission makes the murmur low pitched"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Gallavardin effect refers to the phenomenon of the&nbsp;<strong>transmission</strong> of the mid-systolic murmur of <strong>aortic stenosis</strong> to the <strong>apex</strong> where it becomes higher pitched.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with easy fatiguability and shortness of breath on moderate physical activity. On auscultation, a holosystolic murmur is heard over the lower left sternal border and radiating to the epigastrium. Which of the following condition is most likely to be associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral regurgitation"
      },
      {
        "id": 2,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 3,
        "text": "Ventricular septal defect"
      },
      {
        "id": 4,
        "text": "Atrial septal defect"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>holosystolic</strong> murmur that is best heard over the lower <strong>left sternal border</strong> and radiating to the <strong>epigastrium</strong> most likely arises from&nbsp;<strong>tricuspid regurgitation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about Still\u2019s murmur?",
    "choices": [
      {
        "id": 1,
        "text": "It is heard in mitral regurgitation"
      },
      {
        "id": 2,
        "text": "It is best heard in left lateral decubitus position"
      },
      {
        "id": 3,
        "text": "It is a mid-systolic murmur"
      },
      {
        "id": 4,
        "text": "It is of grade 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Still&rsquo;s murmur</strong> refers to the <strong>benign grade 2 mid-systolic</strong> murmur heard at mid or lower left sternal border in <strong>normal</strong> <strong>children and adolescents</strong>. Louder in hyperdynamic states(fever, anxiety).</p>\n<p>The anatomic basis for the murmur has not been definitively determined. It is best heard in a&nbsp;<strong>supine position</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Graham Steell murmur is heard in?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic regurgitation"
      },
      {
        "id": 2,
        "text": "Pulmonary regurgitation"
      },
      {
        "id": 3,
        "text": "Mitral regurgitation"
      },
      {
        "id": 4,
        "text": "Tricuspid regurgitation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Graham Steell murmur is the <strong>early to mid-diastolic murmur</strong> heard in <strong>pulmonary regurgitation</strong>.</p>\n<p>It is best heard in 2<sup>nd</sup> left intercostal space and radiates along left sternal border. It can increase with inspiration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Carey Coombs murmur is heard in?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral valvulitis"
      },
      {
        "id": 2,
        "text": "Mitral regurgitation"
      },
      {
        "id": 3,
        "text": "Tricuspid stenosis"
      },
      {
        "id": 4,
        "text": "Tricuspid regurgitation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Carey Coombs murmur is heard in mitral valvulitis.</p>\n<p>It is a <strong>mid-diastolic murmur</strong> heard during an episode of <strong>acute rheumatic fever</strong> causing <strong>mitral valvulitis</strong>.</p>\n<p>It is produced due to the flow of blood through an edematous mitral valve and dissipates with the resolution of the acute attack.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Austin-Flint murmur is associated with which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic AR"
      },
      {
        "id": 2,
        "text": "Severe MS"
      },
      {
        "id": 3,
        "text": "Pulmonary hypertension"
      },
      {
        "id": 4,
        "text": "Severe MR"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Austin-Flint</strong> murmur is a low-pitched mid to late<strong> diastolic murmur</strong> of chronic<strong> severe AR</strong>.</p>\n<p>It results from the <strong>turbulence</strong> a<strong>t </strong>the<strong> mitral inflow </strong>area from the mixture of regurgitant and forward blood flow. It is best heard at the apex.</p>\n<p>Austin-Flint murmur is often confused with the murmur of mitral stenosis. This can be differentiated based on the following:</p>\n<table style=\"height: 194px;\" width=\"637\">\n<tbody>\n<tr style=\"height: 17px;\">\n<td style=\"width: 204.984px; height: 17px;\">Features</td>\n<td style=\"width: 204.984px; height: 17px;\">Chronic AR</td>\n<td style=\"width: 205.031px; height: 17px;\">MS</td>\n</tr>\n<tr style=\"height: 28px;\">\n<td style=\"width: 204.984px; height: 28px;\">Opening snap</td>\n<td style=\"width: 204.984px; height: 28px;\">Absent</td>\n<td style=\"width: 205.031px; height: 28px;\">Present</td>\n</tr>\n<tr style=\"height: 43px;\">\n<td style=\"width: 204.984px; height: 43px;\">\n<p>Effect of vasodilator administration</p>\n</td>\n<td style=\"width: 204.984px; height: 43px;\">\n<p>Murmur becomes shorter and softer.</p>\n<p>Mechanism- Fall in the diastolic pressure gradient between the aorta and left ventricle.</p>\n</td>\n<td style=\"width: 205.031px; height: 43px;\">\n<p>Murmur remains constant or increases in intensity.</p>\n<p>Mechanism- Reflex increase in cardiac output and mitral valve flow.</p>\n<p>&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presented with an episode of acute onset dizziness and loss of consciousness which lasted for a few seconds followed by a regain of full consciousness. There were no similar episodes in the past. Which of the following is a true statement regarding this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "ECG to rule out atrial fibrillation"
      },
      {
        "id": 2,
        "text": "If ECG is normal, CT scan should be done"
      },
      {
        "id": 3,
        "text": "Tilt-table testing"
      },
      {
        "id": 4,
        "text": "Vestibular neuritis is a possible condition that can cause these symptoms"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of <strong>transient loss of consciousness </strong>in this patient is suggestive of <strong>syncope</strong>. Hence, an <strong>ECG </strong>must be done to rule out <strong>cardiac causes</strong> for syncope like - arrhythmias (atrial fibrillation, sinus node dysfunction, supra ventricular tachycardias) or a structural cardiac abnormality.</p>\n<p><strong>A CT</strong> would only be required if a <strong>seizure or transient ischemic attack (TIA) </strong>is suspected. However, in this case - the episode only lasted for a <strong>few seconds</strong>, the patient has <strong>no history</strong> of similar episodes in the past and there are <strong>no lasting neurological deficits</strong> after the episode. Therefore, <strong>option B is incorrect.</strong> &nbsp;</p>\n<p><strong>Syncope</strong> is a transient loss of consciousness caused by global cerebral hypoperfusion. It can be due to multiple causes, but is broadly divided into - <strong>neurally mediated syncope</strong>, <strong>orthostatic hypotension</strong> and<strong> cardiac syncope</strong>.&nbsp;</p>\n<p>The<strong> initial workup</strong> for a case of syncope includes:&nbsp;</p>\n<ol>\n<li>Detailed history of the episode and past history of similar episodes&nbsp;</li>\n<li>Physical examination mainly to check BP in standing and supine positions to</li>\n<li>rule out orthostatic hypotension.</li>\n<li>A resting ECG to look for cardiac arrhythmia</li>\n<li><strong>Option B: </strong>If the ECG is normal, no further tests are needed. If the ECG is suggestive of<strong> cardiac arrhythmia, </strong>then further tests including <strong>continuous ECG monitoring </strong>and <strong>electrophysiological studies </strong>may be done.</li>\n</ol>\n<p><strong>Option C:</strong> Tilt-table testing is done in patients with <strong>recurrent syncopal attacks</strong> who are suspected to have <strong>vasovagal syncope</strong>. Psychiatric evaluation is done in patients with recurrent unexplained syncopal attacks.</p>\n<p><strong>Option D</strong>: Vestibular neuritis is <strong>associated with vertigo</strong>, where the patients typically complain of dizziness and a sense of spinning of the head.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '057 Diagnosis Of Cardiovascular Disorders';
        const quizFilename = '057-diagnosis-of-cardiovascular-disorders-d6d3e096.html';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>