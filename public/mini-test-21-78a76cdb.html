<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 21 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which among the given muscles converge and interlace in the perineal body?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, and 4"
      },
      {
        "id": 2,
        "text": "1, 3, and 5"
      },
      {
        "id": 3,
        "text": "2, 3, and 4"
      },
      {
        "id": 4,
        "text": "1, 2, and 3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bulbospongiosus</strong>,<strong> Deep transverse perenei,</strong> and<strong> Levator ani</strong> are the muscles that converge and interlace in the <strong>perineal body</strong>.</p>\n<p>The <strong>ten muscles</strong> of the perineum that converge and interlace in the perineal body are:</p>\n<ul>\n<li>Two unpaired&nbsp;\n<ul>\n<li>External anal sphincter</li>\n<li>Longitudinal muscle coat of anal canal</li>\n</ul>\n</li>\n<li>Four paired\n<ul>\n<li><strong>Bulbospongiosus</strong></li>\n<li>Superficial transverse perenei</li>\n<li><strong>Deep transverse perenei</strong></li>\n<li><strong>Levator ani</strong></li>\n</ul>\n</li>\n</ul>\n<p>The perineal body is the central fibrous skeleton of the perineum. It is situated in the medial plane about 1.25 cm in front of the anal margin and close to the bulb of the penis. In <strong>females</strong>, the <strong>sphincter urethro-vaginalis</strong> is <strong>also attached to the perineal body</strong>. The perineal body has a <strong>pyramidal shape</strong> in <strong>males</strong> and a <strong>wedge shape</strong> in <strong>females</strong>.</p>\n<p>The perineal body is innervated by the <strong>perineal nerve</strong>, the larger and inferior terminal branch of the perineal <strong>pudendal nerve</strong>. It is directed forward under the internal pudendal artery.&nbsp;</p>\n<p>The perineal body supports the pelvic organs in females and it may get damaged during parturition or childbirth. This may result in prolapse of :</p>\n<ul>\n<li>Urinary bladder</li>\n<li>Uterus</li>\n<li>Ovaries</li>\n<li>Rectum</li>\n</ul>\n<p>The image below shows the muscles of the perineum:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea03cf1f5fdd45ae9ceef4faa5aba781x800x493.JPEG"
    ]
  },
  {
    "text": "You are a medical student examining a slide of nerve tissue. You find neurons with the structure shown in the image given below. In which of the sites are such neurons most likely to be found?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal root ganglia"
      },
      {
        "id": 2,
        "text": "Motor horn of spinal cord"
      },
      {
        "id": 3,
        "text": "Cerebellar cortex"
      },
      {
        "id": 4,
        "text": "Scarpa's ganglion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a <strong>single process</strong> of axons from the cell body<strong> that splits into two,</strong> of which,\u00a0<strong>both function as axons</strong>. This structure is suggestive of a\u00a0<strong>pseudo-unipolar neuron</strong>, which is seen in\u00a0the<strong> dorsal root ganglia.</strong></p>\n<p>In <strong>pseudounipolar neurons, </strong>out of the two axons, one goes to the skin or muscles and another to the spinal cord.</p>\n<p>Other options:</p>\n<p>Options B and C - Motor horn of the spinal cord has m<strong>otor neurons</strong>\u00a0and the <strong>cerebellar cortex </strong>predominantly has<strong> Purkinje cells. Both these types of neurons</strong>\u00a0are examples of <strong>multipolar neurons/cells</strong>. They have one axon and many dendrites.</p>\n<p>Cerebellar Purkinje cells have an extensive dendritic tree in a single plane. The image below shows Purkinje cells of the cerebellum:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d37d65090b3e46749f63eeabb9da084a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/835ab9f73c764308a110f03bb1830e2ex668x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a62f4546d93b45dab5580c73653b4a21x1280x721.JPEG"
    ]
  },
  {
    "text": "Match the following with their rate-limiting enzymes:",
    "choices": [
      {
        "id": 1,
        "text": "1-e, 2-a, 3-b, 4-c"
      },
      {
        "id": 2,
        "text": "1-c, 2-a, 3-b, 4-e"
      },
      {
        "id": 3,
        "text": "1-c, 2-e, 3-a, 4-b"
      },
      {
        "id": 4,
        "text": "1-d, 2-b, 3-a, 4-e"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Correct option is 1-c, 2-a, 3-b, 4-e.</p>\n<table style=\"height: 88px;\" width=\"603\">\n<tbody>\n<tr>\n<td style=\"width: 293.5px;\">Heme synthesis</td>\n<td style=\"width: 293.5px;\">ALA synthase</td>\n</tr>\n<tr>\n<td style=\"width: 293.5px;\">Cholesterol synthesis</td>\n<td style=\"width: 293.5px;\">HMG CoA reductase</td>\n</tr>\n<tr>\n<td style=\"width: 293.5px;\">Glycolysis</td>\n<td style=\"width: 293.5px;\">Phosphofructokinase</td>\n</tr>\n<tr>\n<td style=\"width: 293.5px;\">Niacin syntheses</td>\n<td style=\"width: 293.5px;\">Quinolinate phosphoribosyl transferase</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Heme</strong> is synthesized in the normoblasts except matures erythrocytes. Heme synthesis is partly mitochondrial and partly cytoplasmic. It starts with the condensation of succinyl CoA and glycine by <strong>ALA synthase</strong> in the presence of <strong>pyridoxal phosphate</strong> to form <strong>delta-aminolevulinic acid</strong> (ALA). ALA synthase is the <strong>rate-limiting enzyme</strong> and is located in <strong>mitochondria</strong>.\u00a0</p>\n<p>All nucleated cells including the arterial wall can <strong>synthesize cholestero</strong>l and the liver, adrenal cortex, testis, ovaries, and intestines are the major sites of cholesterol synthesis. It occurs partly in the endoplasmic reticulum and cytoplasm. it starts with the condensation of two molecules of acetyl CoA to form acetoacetyl CoA synthase.\u00a0</p>\n<p>The reduction of HMG CoA to mevalonate catalyzed by <strong>HMG CoA reductase</strong> is the <strong>rate-limiting step</strong>. it is the<strong> rate-limiting enzyme</strong> and is located in the <strong>endoplasmic reticulum</strong>.\u00a0</p>\n<p><strong>Statin</strong> group of drugs like lovastatin are <strong>competitive inhibitors of HMG CoA reductase</strong> and can be used in clinical practice to reduce cholesterol levels in the blood.\u00a0</p>\n<p><strong>Glycolysis</strong> converts glucose to pyruvate (aerobic condition) or lactate (anaerobic condition) with the production of a small quantity of energy. It takes place in all cells of the body.\u00a0<strong>Phosphofructokinase</strong> is the <strong>rate-limiting enzyme</strong> that converts fructose-6-phosphate to fructose-1-6-bisphosphate.</p>\n<p>The rate-limiting enzyme of synthesis of <strong>niacin from tryptophan</strong> is <strong>quinolinate phosphoribosyltransferase</strong>. It converts niacin or nicotinic acid to nicotinate mononucelotide.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the correctly matched incisions?",
    "choices": [
      {
        "id": 1,
        "text": "6-a, 7-b, 1-c, 3-d"
      },
      {
        "id": 2,
        "text": "2-a, 9-b, 1-c, 4-d"
      },
      {
        "id": 3,
        "text": "8-a, 9-b, 1-c, 5-d"
      },
      {
        "id": 4,
        "text": "3-a, 7-b, 1-c, 6-d"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Abdominal incisions illustrated above are:</p>\n<ul>\n<li style=\"font-weight: 400;\">1 is <strong>Kocher incision</strong> - A subcostal incision used to gain access for gall bladder and/or biliary tree pathology.</li>\n<li style=\"font-weight: 400;\">2 is <strong>midline incision</strong> - The most common incision for laparotomy, a vertical incision that follows the linea alba which is particularly favored in diagnostic laparotomy, as they allow wide access to most of the abdominal cavity.</li>\n<li style=\"font-weight: 400;\">3 is <strong>McBurney's incision,\u00a0</strong>(also called <strong>gridiron</strong> incision) is an oblique incision (superolateral to infero-medial) passing along McBurney's point. It is popularly used for open appendicectomy.</li>\n<li style=\"font-weight: 400;\">4 is<strong>\u00a0Battle incision\u00a0</strong>a lower right paramedian incision but placed more laterally than the standard paramedian incision. It is suitable for cases with acute appendicitis and pathologies in the right lower quadrant of the abdomen.</li>\n<li style=\"font-weight: 400;\">5 is <strong>Lanz incision,</strong>\u00a0a transverse or skin crease incision for appendicitis, 2 cm below the umbilicus, centered on the midclavicular\u2013mid-inguinal line.\u00a0</li>\n<li style=\"font-weight: 400;\">6 is <strong>paramedian incision</strong> - this incision is used to access much of the lateral viscera, such as the kidneys, spleen, and adrenal glands.</li>\n<li style=\"font-weight: 400;\">7 is <strong>transverse incision</strong> - A supraumbilical transverse incision is a straight transverse skin incision slightly higher than Pfannenstiel (5-6 cm|) from the upper border of the pubic symphysis.\u00a0</li>\n<li style=\"font-weight: 400;\">8 is <strong>Rutherford Morrison's incision</strong>, an oblique muscle cutting incision. It is useful if the appendix is para- or retrocausal and fixed. It is essentially an oblique muscle-cutting incision with its lower end over McBurney\u2019s point and extending obliquely upwards and laterally as necessary</li>\n<li style=\"font-weight: 400;\">9 is <strong>Pfannenstiel incision</strong> - A transverse incision in the lower abdomen, often used for urological,\u00a0 gynecological, and obstetric procedures.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f1ab1df51cf442a287194cededead30c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old boy was brought with multiple ring-shaped lesions in the scalp with patchy hair loss and pruritis for a few weeks. He was started on an oral antifungal drug acting on point A in the following diagram. This drug is most likely to be:",
    "choices": [
      {
        "id": 1,
        "text": "Amphotericin B"
      },
      {
        "id": 2,
        "text": "Itraconazole"
      },
      {
        "id": 3,
        "text": "Terbinafine"
      },
      {
        "id": 4,
        "text": "Griseofulvin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario of&nbsp;multiple <strong>ring-shaped</strong> lesions in the scalp with <strong>patchy hair loss</strong> and <strong>pruritis</strong> is suggestive of <strong>tinea capitis</strong><em>. </em>The drug acting on point A in the above diagram is <strong>griseofulvin</strong>.&nbsp;</p>\n<p><strong>Griseofulvin</strong> is a fungistatic antifungal agent. Griseofulvin disrupts the fungal cell division by inhibiting <strong>microtubule function</strong> and thereby disrupts the <strong>assembly</strong> of the <strong>mitotic spindle</strong>.&nbsp;</p>\n<p>It is administered orally and its absorption is improved when taken with a <strong>fatty meal.</strong> It gets deposited in the keratin precursor cells and binds tightly to keratin. Thereby, it provides prolonged resistance to fungal invasion.&nbsp;</p>\n<p>They are only effective against dermatophytes<em> Microsporum, Epidermophyton, </em>and<em> Trichophyton</em>. It is the drug of choice for <strong>tinea capitis&nbsp;</strong>and tenia pedis.</p>\n<p>Griseofulvin <strong>induces</strong> hepatic CYPs and thereby increases the rate of metabolism of warfarin and low-estrogen oral contraceptive agents. Side effects of griseofulvin include headache, gastrointestinal disturbance, and hepatotoxicity.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Amphotericin B</strong>&nbsp;binds to <strong>ergostero</strong>l in the fungal membrane and forms <strong>pores or channels</strong> (point C) in the<strong> fungal cell membrane</strong> and allows the leakage of cytosolic molecules and ions, leading to loss of membrane integrity.</p>\n<p>It is a broad-spectrum antifungal that can be used against<em> Candida, Cryptococcus neoformans, Blastomyces dermatitidis, Histoplasma capsulatum, Sporothrix schenckii,&nbsp;</em><em>Coccidioides, Paracoccidioides braziliensis, Aspergillus, Penicillium marneffei, Fusarium, </em>and<em> Mucorales</em>.</p>\n<p>Option B: <strong>Itraconazole</strong> is triazole that <strong>inhibits 14-alpha-sterol demethylase</strong> (point D) and impairs the biosynthesis of ergosterol which leads to accumulation of the toxic product 14 alpha-methyl-3,6-diol resulting in growth arrest.&nbsp;</p>\n<p>Itraconazole is the drug of choice for nonmeningeal infections due to <em>B. dermatitidis, H. capsulatum, P. brasiliensis, </em>and<em> Coccidioides immitis</em>. The drug also is useful in the therapy of invasive aspergillosis particularly after the infection has been treated with amphotericin B.</p>\n<p>Option C: <strong>Terbinafine</strong> <strong>inhibits fungal squalene epoxidase</strong> (point B) and reduces ergosterol biosynthesis. They are more effective against nail onychomycosis than itraconazole.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/249a664f6e5247b7890f6985066b287c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 12- year-old boy was brought to the casualty with fever and colicky abdominal pain. Stool examination revealed the following worms. Which of the following are incorrect about this organism",
    "choices": [
      {
        "id": 1,
        "text": "2, and 4"
      },
      {
        "id": 2,
        "text": "1, and 3"
      },
      {
        "id": 3,
        "text": "1 only"
      },
      {
        "id": 4,
        "text": "2 only"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario and image are suggestive of ascariasis due to\u00a0\u00a0<strong><em>Ascaris lumbricoides</em></strong><em>\u00a0</em>(roundworm). 2 is incorrect.\u00a0</p>\n<p><em>Ascaris lumbricoides</em> are the most common of human helminths which are distributed worldwide and they are\u00a0the largest nematode parasite in the human intestine. Adult worms live in the small intestine.\u00a0</p>\n<p>The adult worms are large<strong> cylindrical </strong>worms, with<strong> tapering ends</strong>, the anterior end being more pointed than the posterior. Adult male worms are little smaller than female worms.\u00a0</p>\n<p><strong>Man</strong> is the only\u00a0<strong>natural host</strong>. There is <strong>no intermediate host.</strong></p>\n<p>Infection\u00a0occurs through food or water contaminated with nightsoil or human feces having eggs of <em>Ascaris</em> that contain the <strong>infective\u00a0rhabditiform larva</strong>.\u00a0</p>\n<p>Initial exposure to larvae creates a very heavy larval load and is usually asymptomatic but, reinfection causes an intense cellular reaction to the migrating larvae in the lungs and infiltration of eosinophils and present as\u00a0<em>Ascaris</em> pneumonia characterized by low-grade fever, dry cough, and asthmatic wheezing.\u00a0</p>\n<p>They often have blood-tinged sputum that contains Charcot-Leyden crystals and larvae occasionally. This condition is termed <strong>Loeffler's syndrome</strong>.</p>\n<p>In children, they interfere with proper digestion and absorption of food and result in protein-energy malnutrition and <strong>vitamin A deficiency</strong>.</p>\n<p>Masses of the worms cause luminal occlusion and may stimulate reflex peristalsis causing recurrent and <strong>severe colicky abdominal pain</strong>. The mass formed by the clumping of worms in the intestine fills the lumen and causes volvulus, intussusception, intestinal obstruction, or perforation.\u00a0</p>\n<p><strong>Adult worms</strong> can be occasionally detected in the\u00a0stool or sputum of the patient. A <strong>definitive diagnosis</strong> is made by <strong>demonstration of eggs in feces</strong>. Fertilized eggs are <strong>always bile stained</strong>.\u00a0</p>\n<p>Effective and safe drugs for the treatment of ascariasis include:</p>\n<ul>\n<li>Pyrantel pamoate 11mg/kg once and is safe in pregnancy</li>\n<li>Albendazole 400 mg once</li>\n<li>Mebendazole 100 mg twice daily for 3 days</li>\n<li>Ivermectin 150-200 mcg/kg once</li>\n</ul>\n<p>Nasogastric suction, intervenous fluid administration, and installation of piperazine through the nasogastric tube can be used for partial intestinal obstruction. Immediate surgical intervention is required in cases of complete obstruction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d0241f2dd1764d6ab143cae72f18312f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc01fe7ca06849f8a4bc4bd2c30e99f9x965x886.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man had severe hypothyroidism.  His arterial blood gas (ABG) analysis shows very low pO2 and high pCO2 levels.  Which of the following types of respiratory failure is likely to be present in him?",
    "choices": [
      {
        "id": 1,
        "text": "Type 4"
      },
      {
        "id": 2,
        "text": "Type 3"
      },
      {
        "id": 3,
        "text": "Type 2"
      },
      {
        "id": 4,
        "text": "Type 1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario of severe hypothyroidism with hypoxemia and hypercapnia is suggestive of <strong>type 2 respiratory failure</strong>.\u00a0</p>\n<p>Type II respiratory failure occurs as a consequence of <strong>alveolar hypoventilation</strong> and results from the <strong>inability</strong> to eliminate <strong>carbon dioxide</strong> effectively. The mechanism of type II respiratory failure in <strong>severe hypothyroidism</strong> can be due to poor response of the central nervous system to hypoxia and hypercapnia, as well as reduced strength of the respiratory muscles.</p>\n<p>Other causes for diminished CNS drive to breathe:</p>\n<ul>\n<li>Drug overdose</li>\n<li>Brainstem injury</li>\n<li>Sleep-disordered breathing\u00a0</li>\n</ul>\n<p>Reduced strength for respiration can be due to</p>\n<ul>\n<li>Impaired neuromuscular transmission (e.g., myasthenia gravis, Guillain-Barr\u00e9 syndrome, amyotrophic lateral sclerosis)</li>\n<li>Respiratory muscle weakness (e.g., myopathy, electrolyte derangements, fatigue)</li>\n</ul>\n<p>The overall load on the respiratory system that can facilitate type 2 respiratory failure can be classified as follows:</p>\n<ul>\n<li>Resistive loads, as in<strong> bronchospasm</strong></li>\n<li>Loads due to reduced lung compliance as in alveolar oedema, atelectasis, intrinsic positive end-expiratory pressure</li>\n<li>Loads due to reduced chest wall compliance as in pneumothorax, pleural effusion, abdominal distention</li>\n<li>Loads due to increased minute ventilation requirements as in pulmonary embolus with increased dead-space fraction, sepsis</li>\n</ul>\n<p>Treatment:</p>\n<p>Reversing the underlying causes of ventilatory failure remains the mainstay treatment for type 2 respiratory failure. <strong>Non-invasive positive-pressure ventilation</strong> with a tight-fitting facial or nasal mask and avoiding endotracheal intubation often stabilise patients with type 2 respiratory failure. This approach is beneficial in treating patients with exacerbations of chronic obstructive pulmonary disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 46-year-old female patient presents to the outpatient department with complaints of recurrent headaches for the past few months. A characteristic sign was noted on the MRI, as seen in the image below, and a provisional diagnosis of meningioma was made. Which of the following are the other conditions showing this sign on the MRI?",
    "choices": [
      {
        "id": 1,
        "text": "1,3 and 4"
      },
      {
        "id": 2,
        "text": "1,2 and 3"
      },
      {
        "id": 3,
        "text": "3,4 and 5"
      },
      {
        "id": 4,
        "text": "2,4 and 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The MRI shows a\u00a0<strong>dural tail sign,</strong>\u00a0which is commonly seen in\u00a0<strong>meningioma</strong>. However, it may also be seen in the following\u00a0<strong>nonmeningiomatous lesions:</strong></p>\n<ol>\n<li>Schwannoma</li>\n<li>Metastases</li>\n<li>Sarcoidosis</li>\n<li>Primary CNS lymphomas</li>\n<li>Chloroma</li>\n</ol>\n<p>The<strong>\u00a0dural tail sign</strong>\u00a0refers to a linear, contrast-enhancing tail-like extension from the tumor, along the dura matter. It is\u00a0<strong>most commonly seen</strong>\u00a0in\u00a0<strong>meningioma\u00a0</strong>(present in about 60% of the cases)</p>\n<p><strong>Three criteria\u00a0</strong>should be met for a\u00a0<strong>positive dural tail sign:</strong></p>\n<ul>\n<li>The tail should be seen on two successive images arising from the tumor.</li>\n<li>The tail should taper away from the tumor.</li>\n<li>The tail must enhance more than the tumor.\u00a0</li>\n</ul>\n<p>The image shows\u00a0Axial (A) and sagittal (B) contrast-enhanced MRI images of the brain. The arrows point towards the thickening and enhancements of the dura, tapering away from the mass, resembling a tail - hence, called the\u00a0<strong>dural tail sign.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6bd033fe076b4767a313cdb909691457.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c1c4b515a8b54cb1b63131c7b564f82fx720x404.JPEG"
    ]
  },
  {
    "text": "An orthopedic surgeon is taking a class on various tendon repair surgeries, by using cadaveric specimens. While demonstrating a procedure on the muscle marked X, he points to a nerve that is in close proximity to this muscle. He emphasizes that damage to this nerve would result in poor function of the marked muscle and would affect the eversion of the sub-talar joint. Which nerve is the surgeon talking about?",
    "choices": [
      {
        "id": 1,
        "text": "Deep peroneal nerve"
      },
      {
        "id": 2,
        "text": "Superficial peroneal nerve"
      },
      {
        "id": 3,
        "text": "Tibial nerve"
      },
      {
        "id": 4,
        "text": "Femoral nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked structure is the<strong>\u00a0peroneus longus</strong>\u00a0(principle evertor of the foot) since it lies in the lateral compartment. It is innervated by the\u00a0<strong>superficial peroneal nerve</strong>.<strong>\u00a0Damage</strong> to the <strong>superficial peroneal nerve</strong>, the nerve in close proximity to this muscle, would result in <strong>loss of eversion</strong> at the <strong>sub-talar joint</strong>.</p>\n<p>The\u00a0<strong>anterior compartment</strong>\u00a0of the leg is supplied by the\u00a0<strong>deep peroneal nerve</strong>.</p>\n<p>Contents:\u00a0</p>\n<ul>\n<li>Tibialis anterior</li>\n<li>Extensor hallucis longus</li>\n<li>Extensor digitorum longus</li>\n<li>Peroneus tertius\u00a0</li>\n</ul>\n<p>The\u00a0<strong>lateral compartment</strong>\u00a0of the leg is supplied by the\u00a0<strong>superficial peroneal nerve</strong>. It consists of peroneus longus and peroneus brevis.</p>\n<p>The\u00a0<strong>posterior compartment</strong>\u00a0of the leg is\u00a0supplied by the\u00a0<strong>tibial nerve.\u00a0</strong></p>\n<p>Contents:</p>\n<ul>\n<li>Gastrocnemius</li>\n<li>Soleus</li>\n<li>Plantaris</li>\n<li>Popliteus</li>\n<li>Flexor hallucis longus</li>\n<li>Flexor digitorum longus</li>\n<li>Tibialis posterior</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d6186a88b3fd4ffe9f1d8beb5b41b5d0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75c11ef4fae8467eb5758dcc51994677x1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eeccbe72b2564959b3639d9f08207ef9x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a988314f7854388a5d8732b6f4410bcx1280x2400.JPEG"
    ]
  },
  {
    "text": "A child was brought for routine follow-up of his anthropometric surveillance. On obtaining upper body segment and lower body segment measurements, you find the U/L ratio to be 1. What could be the likely age of this child, provided that he has normal development?",
    "choices": [
      {
        "id": 1,
        "text": "1 year"
      },
      {
        "id": 2,
        "text": "3 years"
      },
      {
        "id": 3,
        "text": "5 years"
      },
      {
        "id": 4,
        "text": "8 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The upper segment to lower segment (U/L) ratio in this child is 1. In normal development, the U/L ratio is<strong> 1</strong> in children <strong>more than 7 years</strong>.</p>\n<p>The <strong>lower segment(L)</strong> is defined as the length from the symphysis pubis to the floor. The <strong>upper segment(U)</strong> is measured by subtracting the lower segment from the height.</p>\n<p>The U/L ratio is</p>\n<ul>\n<li>1.7 at birth</li>\n<li>1.3 at 3 years</li>\n<li><strong>1 after 7 years</strong></li>\n<li>0.9 in adults</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f9b70949246483c9a76a5bc7a9b9a47x1280x1001.JPEG"
    ]
  },
  {
    "text": "A 5-year-old child is crying uncontrollably and is complaining of ear pain. He has a high-grade fever, cold, and nose block. The otoscopic examination showed the following finding. Which of the following organisms is the most common cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Moraxella catarrhalis"
      },
      {
        "id": 2,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 3,
        "text": "Haemophilus influenzae"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features of <strong>severe ear pain, fever, and cold</strong> with the otoscopic image showing <strong>red and bulging tympanic membrane</strong>\u00a0are likely to be <strong>acute suppurative otitis media</strong>. <em><strong>Streptococcus pneumoniae</strong></em> is the\u00a0most common cause of this condition. Other organisms that can cause these are:</p>\n<ul>\n<li><em><strong> Haemophilus influenzae</strong></em></li>\n<li><em><strong> Moraxella catarrhalis</strong></em></li>\n<li><em>Streptococcus pyogenes</em></li>\n<li><strong><em>Staphylococcus aureus</em></strong></li>\n<li><em>Pseudomonas aeruginosa</em></li>\n</ul>\n<p>Clinical features: The child may present with a cold, fever, and earache. If the tympanic membrane ruptures, ear discharge might also be there.</p>\n<p>In the stage of presuppuration, there might be a leash of blood vessels that appear along with the handle of the malleus and at the periphery of the tympanic membrane giving it a <strong>cart-wheel appearance</strong>. Later, the entire tympanic membrane becomes red.</p>\n<p>Management:</p>\n<p>Since the most common organism responsible are<em>\u00a0<strong>Streptococcus pneumonia\u00a0</strong></em>and\u00a0<em>Haemophilus influenza</em>, antibiotics should be started. The effective drugs in acute otitis media are <strong>ampicillin</strong> (50 mg/kg/day in four divided doses) and <strong>amoxicillin</strong> (40 mg/kg/day in three divided doses).</p>\n<p><strong>Decongestant nasal drops</strong>- ephedrine, oxymetazoline, and xylometazoline nasal drops can be used to decrease the edema of the eustachian tube, and promote middle ear ventilation.</p>\n<p><strong>Oral nasal decongestants</strong> like pseudoephedrine in combination with an antihistamine are effective in treating nasal blockade.</p>\n<p><strong>Analgesics and antipyretics</strong> are used to relieve pain and fever</p>\n<p>If there is ear discharge, it has to be mopped with sterile cotton buds. An antibiotic wick may also be inserted.</p>\n<p><strong>Myringotomy:</strong>\u00a0It is incising the eardrum to evacuate pus and is indicated when the drum is bulging and there is acute pain, incomplete resolution despite antibiotics, persistent conductive hearing loss, and persistent effusion beyond 12 weeks.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe537394c2744585acb91a66369ac282.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young patient is brought to the emergency following a road traffic accident. He is intoxicated and his blood alcohol level is high.  Examination revealed a fractured femur. He is posted for surgery. When compared to that in a person who is not intoxicated with alcohol, the minimum alveolar concentration (MAC) of sevoflurane in this patient is expected to be __________ .",
    "choices": [
      {
        "id": 1,
        "text": "Greater"
      },
      {
        "id": 2,
        "text": "Lower"
      },
      {
        "id": 3,
        "text": "Similar"
      },
      {
        "id": 4,
        "text": "Unpredictable"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario describes <strong>acute alcohol intoxication&nbsp;</strong>in which&nbsp;the <strong>minimum alveolar concentration</strong> (<strong>MAC</strong>) of sevoflurane will be <strong>reduced&nbsp;</strong>when compared to a patient who is not intoxicated with alcohol.</p>\n<p>The MAC of an inhaled anesthetic is the minimum alveolar concentration that <strong>prevents patient movement</strong> in <strong>50% of patients</strong> in response to a standardized stimulus like a surgical incision.</p>\n<p>Factors that affect MAC are:</p>\n<table style=\"height: 249px; width: 533px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 241px; height: 18px;\"><strong>Conditions increasing MAC</strong></td>\n<td style=\"width: 276px; height: 18px;\"><strong>Conditions decreasing MAC</strong></td>\n</tr>\n<tr style=\"height: 20px;\">\n<td style=\"width: 241px; height: 20px;\">Body temperature &gt; 42&nbsp;<sup>o</sup>C</td>\n<td style=\"width: 276px; height: 20px;\">Elderly</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 241px; height: 18px;\">Chronic alcohol abuse</td>\n<td style=\"width: 276px; height: 18px;\">Hypothermia, Hyperthermia with body temperature &lt;42<sup>o</sup>C</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 241px; height: 18px;\">Hypernatremia</td>\n<td style=\"width: 276px; height: 18px;\">Acute alcohol intoxication</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 241px; height: 18px;\">Cocaine</td>\n<td style=\"width: 276px; height: 18px;\">Hypercalcemia, hyponatremia</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 241px; height: 18px;\">Ephedrine</td>\n<td style=\"width: 276px; height: 18px;\">Pregnancy</td>\n</tr>\n<tr style=\"height: 23.5469px;\">\n<td style=\"width: 241px; height: 23.5469px;\">Acute amphetamine poisoning</td>\n<td style=\"width: 276px; height: 23.5469px;\">Anesthetics</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 241px; height: 34px;\">&nbsp;</td>\n<td style=\"width: 276px; height: 34px;\">Sympatholytics like methyldopa, clonidine, dexmedetomidine</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 241px; height: 34px;\">&nbsp;</td>\n<td style=\"width: 276px; height: 34px;\">\n<table>\n<tbody>\n<tr>\n<td>Younger age (maximum at 6 months of age)&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old male patient comes to the clinic for evaluation of a chronic cough and weight loss. He has a 30-pack-years smoking history. Bronchoscopy and biopsy show the findings below. Which of the following is false about this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "CD56 is expressed by these tumour cells"
      },
      {
        "id": 2,
        "text": "Smokers are strongly predisposed to this condition"
      },
      {
        "id": 3,
        "text": "Hypercalcemia may be associated with this condition"
      },
      {
        "id": 4,
        "text": "Keratinization and squamous pearls can be seen in this condition"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical history and the histopathological findings showing<strong> keratin pearls</strong> are suggestive of\u00a0</span><strong><span data-preserver-spaces=\"true\">squamous cell carcinoma of the lung</span></strong><span data-preserver-spaces=\"true\">.\u00a0CD56\u00a0is not expressed by squamous cell carcinoma, it is a marker for\u00a0<strong>small cell carcinoma</strong>\u00a0of the lung.\u00a0</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Squamous cell carcinoma\u00a0</span></strong><span data-preserver-spaces=\"true\">is most commonly found in men and is <strong>strongly associated</strong> with <strong>smoking</strong>.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Squamous cell carcinoma predominantly arises in the <strong>central segmental </strong>or <strong>subsegmental bronchi</strong>.\u00a0</span><span data-preserver-spaces=\"true\">The tumor may grow\u00a0into the bronchial lumen and produce an intraluminal mass. In certain cases, the bronchial obstruction may lead to atelectasis or infection. The tumor may penetrate the wall of the bronchus and infiltrate the peribronchial tissue into the carina or the mediastinum.\u00a0</span></p>\n<p>This tumor may be associated with <strong>paraneoplastic syndromes</strong>, the most common is <strong>hypercalcemia.\u00a0</strong>The symptoms could include\u00a0anorexia, nausea, vomiting, constipation, lethargy, polyuria, polydipsia, and dehydration.</p>\n<p><span data-preserver-spaces=\"true\">Squamous metaplasia and dysplasia often precede frank squamous cell carcinoma.\u00a0Carcinoma in-situ persists for many years and this may often be recognized on cytologic smears or in BAL fluid or brushings.</span></p>\n<p><span data-preserver-spaces=\"true\">Gross appearance: The tissue is grey-white, firm, with areas of necrosis and hemorrhages. Red or yellow-white mottling and softening may be seen. The necrotic foci may cavitate.\u00a0</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Histopathology:</span></strong><span data-preserver-spaces=\"true\">\u00a0It is characterized by the presence of keratinization and intercellular bridges. Keratinization can be seen as <strong>squamous pearls</strong> or individual cells with dense <strong>eosinophilic cytoplasm</strong>.\u00a0</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed7d23204c734e6fa16c29879b4b385a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy drives a car after getting drunk at a party and injures a child walking on the pedestrian lane. The child dies on spot. The post-mortem report indicates Waddell's triad. Which of the following constitute the injuries forming Waddell's triad?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "1, 4, 5"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "2, 4, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>From the given scenario, injuries included in the <strong>Waddell's triad</strong> include&nbsp;</p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Intertrochantric fracture of femur</span></li>\n<li><span data-preserver-spaces=\"true\">Hood injury to the abdomen resulting in blunt trauma and liver laceration</span></li>\n<li><span data-preserver-spaces=\"true\">Contralateral head trauma resulting in massive extradural hemorrhage</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Waddell's Triad&nbsp;</span></strong><span data-preserver-spaces=\"true\">is a classic pattern of transportation injury seen in a pedestrian child due to motor vehicle.&nbsp;</span><span data-preserver-spaces=\"true\">It comprises of:</span></p>\n<ol>\n<li><span data-preserver-spaces=\"true\"><strong>Limb fractures</strong> of femur or pelvis (never tibia or patella): This is due to initial impact due to bumper injury.</span></li>\n<li><span data-preserver-spaces=\"true\"><strong>Intra-abdominal</strong> or <strong>intra-thoracic</strong> injuries (secondary injury by the grill, hood, or fender)</span></li>\n<li><span data-preserver-spaces=\"true\">Contra-lateral <strong>head injury</strong>: This is caused as the child is thrown to the opposite side.</span></li>\n</ol>\n<p>Note:&nbsp;Bumper fracture is different from injury.&nbsp;Bumper fracture is a comminuted fracture of the lateral condyle of the tibia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old lady comes for a routine check-up at 34 weeks of gestation when her blood pressure is found to be 170/118 mmHg. Her urine analysis shows proteinuria 3+. Which of the following statements are true about the management of this situation?",
    "choices": [
      {
        "id": 1,
        "text": "3 and 4 only"
      },
      {
        "id": 2,
        "text": "3 and 5 only"
      },
      {
        "id": 3,
        "text": "1, 2 and 5"
      },
      {
        "id": 4,
        "text": "1, 2, 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of severe&nbsp;<strong>pre-eclampsia</strong>&nbsp;with&nbsp;<strong>hypertensive crisis&nbsp;</strong>(BP&gt;160/110 mmHg)<strong>. Intravenous Labetalol&nbsp;</strong>is the drug of choice for controlling blood pressure in<strong> severe pre-eclampsia </strong>and the<strong> maximum dose</strong> that can be given is<strong> 300 mg</strong>. Therefore, options 3 and 4 are correct.&nbsp;</p>\n<p>Drugs used in the management of hypertensive crisis.</p>\n<table style=\"height: 239px; width: 680px;\">\n<tbody>\n<tr>\n<td style=\"width: 84px; text-align: center;\"><strong>Drug</strong></td>\n<td style=\"width: 69px; text-align: center;\"><strong>Onset of Action&nbsp;</strong></td>\n<td style=\"width: 161px; text-align: center;\"><strong>Dose schedule&nbsp;</strong></td>\n<td style=\"width: 178.608px; text-align: center;\"><strong>Maximum dose&nbsp;</strong></td>\n<td style=\"width: 35.3923px; text-align: center;\"><strong>Maintainance Dose&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 84px; text-align: center;\"><strong>Labetalol</strong></td>\n<td style=\"width: 69px;\">5 mins</td>\n<td style=\"width: 161px;\">10-20 mg IV every 10 mins&nbsp;</td>\n<td style=\"width: 178.608px;\">300 mg IV</td>\n<td style=\"width: 35.3923px;\">40 mg/hr</td>\n</tr>\n<tr>\n<td style=\"width: 84px; text-align: center;\"><strong>Hydralazine</strong></td>\n<td style=\"width: 69px;\">10 mins</td>\n<td style=\"width: 161px;\">5 mg IV every 30 mins&nbsp;</td>\n<td style=\"width: 178.608px;\">30 mg IV</td>\n<td style=\"width: 35.3923px;\">10 mg/hr</td>\n</tr>\n<tr>\n<td style=\"width: 84px; text-align: center;\"><strong>Nifedipine</strong></td>\n<td style=\"width: 69px;\">10 mins&nbsp;</td>\n<td style=\"width: 161px;\">10-20 mg oral, can be repeated in 30 mins&nbsp;</td>\n<td style=\"width: 178.608px;\">240 mg/24 hours&nbsp;</td>\n<td style=\"width: 35.3923px;\">4-6 hour intervals&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 84px; text-align: center;\"><strong>Nitroglycerin</strong></td>\n<td style=\"width: 69px;\">0.5-5mins&nbsp;</td>\n<td style=\"width: 161px;\">5 mcg/min IV</td>\n<td style=\"width: 178.608px;\">Short-term therapy when other drugs failed</td>\n<td style=\"width: 35.3923px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 84px; text-align: center;\"><strong>Sodium Nitroprusside&nbsp;</strong></td>\n<td style=\"width: 69px;\">0.5-5mins&nbsp;</td>\n<td style=\"width: 161px;\">0.25-5 mcg/kg/min IV</td>\n<td style=\"width: 178.608px;\">Short-term therapy <strong>when other drugs failed</strong></td>\n<td style=\"width: 35.3923px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p class=\"p1\">&nbsp;</p>\n<p class=\"p1\">Captopril is an ACE inhibitor and is hence contraindicated in pregnancy.</p>\n<p class=\"p1\">Labetalol is avoided in women having asthma or cardiac failure.</p>\n<p class=\"p1\">Sodium nitroprusside is only given after treatment with other drugs has failed.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male patient came with complaints of headache, impaired memory, and visual disturbances. He has a history of genital ulcers from many years ago for which he did not seek appropriate treatment. Further evaluation reveals CSF analysis positive for VDRL screening. Which of the following findings is observed in the pupils in response to light?",
    "choices": [
      {
        "id": 1,
        "text": "Pupils react but do not accommodate."
      },
      {
        "id": 2,
        "text": "Pupils accommodate but do not react."
      },
      {
        "id": 3,
        "text": "Pupils neither react not accommodate."
      },
      {
        "id": 4,
        "text": "Pupils react and accommodate slowly."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pupils accommodate but do not react to light.</strong></p>\n<p>The clinical features of the patient are suggestive of <strong>neurosyphilis</strong>. The type of pupillary response seen in reaction to light is known as the\u00a0<strong>Argyll Robertson pupil.</strong></p>\n<p><strong>Argyll Robertson pupil (ARP) </strong>is a feature of neurosyphilis that includes general paresis and tabes dorsalis.\u00a0Argyll Robertson pupil (ARP) results from damage to the relay paths in the tectum between the afferent and efferent tracts that interrupt pupillary light reflex. But the ventral pathway of the pupillary near reflex is spared, resulting in an intact accommodation reflex.\u00a0</p>\n<p>Clinical features in the eyes include an intact accommodation reflex, i.e eyes converge and constrict on seeing a near object. Light reflexes are absent, which means they d<span class=\"st\">o not constrict when exposed to bright light (i.e., they do not\u00a0react\u00a0to light).\u00a0</span>This is also known as\u00a0light-near dissociation. These patients also have bilateral\u00a0small irregular pupils. Optic atrophy is another common feature of tabes.\u00a0</p>\n<p>Treatment of neurosyphilis is with aqueous <strong>crystalline penicillin G</strong>\u00a0for 10\u201314 days or aqueous <strong>procaine penicillin G</strong> plus oral<strong> probenecid</strong>, both for 10\u201314 days. Patients who have penicillin allergy are desensitised and then treated with penicillin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An anxious mother brought her son to the doctor. She says that her son complains that he does not like the school environment and scores poor grades. On further history taking, it was found that the boy attends a sports club after school and excels in sports. What is the defense mechanism seen in this boy?",
    "choices": [
      {
        "id": 1,
        "text": "Compensation"
      },
      {
        "id": 2,
        "text": "Splitting"
      },
      {
        "id": 3,
        "text": "Suppression"
      },
      {
        "id": 4,
        "text": "Rationalisation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this scenario, the boy compensates for the dislike and poor performance in school by excelling in sports, the defense mechanism involved here is <strong>compensation. </strong>In this type, the person unconsciously deals with <strong>fear or conflict</strong> by putting extreme <strong>effort </strong>into\u00a0some other area of his life.</p>\n<p>Other examples of compensation defense mechanism include excessive bodybuilding to prevent the feeling of inferiority, a patient with dementia noting down excessive details in his diary, etc.</p>\n<p><strong>Other options:</strong></p>\n<p>Option B- In <strong>splitting,</strong> the person unconsciously <strong>categorizes</strong> self or others as either <strong>good or bad</strong>, without actually considering the whole range of qualities.\u00a0</p>\n<p>Option C- In <strong>suppression,</strong> the person voluntarily <strong>stops focussing</strong> on the<strong> though</strong>t, conflict. Eg. A person stops focussing on the quarrel in-home while he is working in the office.</p>\n<p>Option D- In <strong>rationalization,</strong> the person provides a <strong>logical explanation</strong> for irrational behavior. It is motivated by unacceptable, unconscious wishes. Eg. A student blames his teacher for getting low marks in the exam.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female presents with hip pain after a fall. X-ray reveals a fracture of the neck of her femur. Which of the following instruments is best suited for cutting bone while performing McMurray's osteotomy for her condition?",
    "choices": [
      {
        "id": 1,
        "text": "C"
      },
      {
        "id": 2,
        "text": "A"
      },
      {
        "id": 3,
        "text": "D"
      },
      {
        "id": 4,
        "text": "B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Among the instruments given, image C represents an <strong>osteotome</strong> that can be<strong> used to cut bone</strong>\u00a0while performing an osteotomy.</p>\n<p><span style=\"text-decoration: underline;\"><strong>Osteotome-</strong></span></p>\n<p>An\u00a0osteotome has both sides beveled.\u00a0It is used for <strong>cutting bone</strong>.</p>\n<p>Ex:</p>\n<ul>\n<li><strong>McMurray's osteotomy</strong> for <strong>fracture of neck of femur.</strong>\u00a0</li>\n<li>Corrective osteotomy for genu varum and genu valgum.\u00a0</li>\n</ul>\n<p>Other options:</p>\n<p><strong>Image A</strong> is the\u00a0<strong>periosteal elevator</strong>. It is used to elevate the periosteum as nerves, and vessels are generally on this plane, and once this has been elevated the surgeon is on a safer plane.</p>\n<p><strong>Image B</strong> is a <strong>curette</strong> used for curetting a cavity in bone or removing fibrous tissue from ends of fracture; used in <strong>enchondroma, GCT, osteomyelitis.</strong></p>\n<p><strong>Image D</strong> is <strong>bone gouge</strong>, a concave-bladed chisel used for cutting on round bone surfaces or making round holes in bone.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5412d6b247f84c19834445c535b1bc9e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Given below are four main strategies involved in moderating the role of socio-cultural contact in health. These are strategies of ?",
    "choices": [
      {
        "id": 1,
        "text": "Mores"
      },
      {
        "id": 2,
        "text": "Roles"
      },
      {
        "id": 3,
        "text": "Customs"
      },
      {
        "id": 4,
        "text": "Cultural contact"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows the various strategies of <strong>cultural contact</strong>.&nbsp;<span data-preserver-spaces=\"true\">This is also known as acculturation.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Acculturation&nbsp;</span></strong><span data-preserver-spaces=\"true\">is the process by which there is the diffusion of&nbsp;</span><strong><span data-preserver-spaces=\"true\">cultures between two culturally different groups of people. </span></strong><span data-preserver-spaces=\"true\">This phenomenon is also known as culture contact.&nbsp;</span><span data-preserver-spaces=\"true\">This can happen in the following ways:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Trade and commerce</span></li>\n<li><span data-preserver-spaces=\"true\">Industrialization</span></li>\n<li><span data-preserver-spaces=\"true\">Religious propagation</span></li>\n<li><span data-preserver-spaces=\"true\">Education</span></li>\n<li><span data-preserver-spaces=\"true\">Conquest</span></li>\n</ul>\n<p>The <strong><span data-preserver-spaces=\"true\">strategies </span></strong>of <strong><span data-preserver-spaces=\"true\">acculturation:</span></strong></p>\n<ul>\n<li><strong><span data-preserver-spaces=\"true\">Assimilation</span></strong><span data-preserver-spaces=\"true\">&nbsp;is a specific type of acculturation strategy characterized by the acquisition of host culture alongside the loss of heritage culture.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Separation&nbsp;</span></strong><span data-preserver-spaces=\"true\">refers to splitting.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Integration&nbsp;</span></strong><span data-preserver-spaces=\"true\">is integrating others' cultures.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Marginalization </span></strong>is&nbsp;<span data-preserver-spaces=\"true\">the internalization of the host culture.</span><span data-preserver-spaces=\"true\">&nbsp;</span></li>\n</ul>\n<p>Other options:</p>\n<p>Options A and C:<strong><span data-preserver-spaces=\"true\">&nbsp;Customs</span></strong><span data-preserver-spaces=\"true\">&nbsp;are the&nbsp;</span><strong><span data-preserver-spaces=\"true\">traditionally accepted ways of behaving</span></strong><span data-preserver-spaces=\"true\">&nbsp;that are specific to a society. They can be&nbsp;</span><strong><span data-preserver-spaces=\"true\">folkways,</span></strong><span data-preserver-spaces=\"true\">&nbsp;which are referred to as the right ways of doing things in less vital areas of human conduct.</span><strong><span data-preserver-spaces=\"true\">&nbsp;Mores</span></strong><span data-preserver-spaces=\"true\">&nbsp;are stringent customs followed by society.</span></p>\n<p>Option B:&nbsp;<strong><span data-preserver-spaces=\"true\">The role</span></strong><span data-preserver-spaces=\"true\">&nbsp;is the&nbsp;</span><strong><span data-preserver-spaces=\"true\">function or duties assumed&nbsp;</span></strong><span data-preserver-spaces=\"true\">by a person of a particular society.</span></p>\n<p>Note:&nbsp;Socialization&nbsp;is defined as a&nbsp;process by which man acquires beliefs, customs, traditions, and prejudices&nbsp;of society due to his everyday interaction with people of the society.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/88ddda56cd9f443aa623d07b685ae647.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Sequentially arrange the following phases of the hair cycle starting with the phase corresponding to hair growth:",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 4"
      },
      {
        "id": 2,
        "text": "2, 4, 1, 3"
      },
      {
        "id": 3,
        "text": "2, 1, 3, 4"
      },
      {
        "id": 4,
        "text": "3, 4, 1, 2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct sequence of hair growth is <strong>Anagen</strong>,<strong> Catagen</strong>,<strong> Telogen</strong>,<strong> </strong>and<strong> Kenogen</strong>.\u00a0</p>\n<p>The hair cycle is a repetitive sequence of growing and resting phases of hair follicles. <strong>Anagen</strong> is the <strong>active period</strong> of hair growth. The duration of this phase determines the final length of the hair.</p>\n<p>Epithelial cell division declines and ceases at the end of the anagen phase and hair follicles enter into an involutiontary phase called <strong>catagen</strong>. The proximal end of the hair shaft keratinizes to form a club-shaped structure and the lower part of the follicle is involuted by apoptosis during this phase.</p>\n<p>The <strong>telogen</strong> phase is the time gap between the completion of follicular regression and the onset of the next anagen phase.</p>\n<p>The <strong>shedding</strong> of club hair occurs through an active process termed <strong>exogen</strong>.</p>\n<p>In the human scalp, <strong>kenogen</strong> indicates the interval in which the hair follicle remains empty after the telogen hair has been shed and before a new anagen hair emerges.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8323450070494118ad42624ac1c93995x1280x1222.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 21';
        const quizFilename = 'mini-test-21-78a76cdb.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>