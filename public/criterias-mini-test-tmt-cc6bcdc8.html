<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criterias Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following are not included among the minor criteria of the modified Duke criteria for the diagnosis of infective endocarditis?",
    "choices": [
      {
        "id": 1,
        "text": "Predisposing heart condition"
      },
      {
        "id": 2,
        "text": "Osler's nodes or Roth spots"
      },
      {
        "id": 3,
        "text": "Fever of >38.0\u00b0C (>100.4\u00b0F)"
      },
      {
        "id": 4,
        "text": "Single positive blood culture for Coxiella burnetii"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 1548\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Single positive blood culture for Coxiella burnetii </strong>is one of the <strong>major</strong> criteria of <strong>modified Duke criteria</strong> for the diagnosis of<strong> infective endocarditis</strong>. All other options are minor criteria.</p>\n<p><strong>Infective endocarditis</strong> is associated with bacterial or fungal infection of the valvular or endocardial surface of the heart. The definitive diagnosis can only be established by histological and microbiological examinations of the vegetation.</p>\n<p>However, a diagnostic schema called, <strong>modified Duke criteria,</strong> is usually used for diagnosis. The criteria are based on clinical, laboratory, and echocardiographic findings commonly encountered in patients with endocarditis, as described below.</p>\n<p>The diagnosis is made based on the presence of</p>\n<ul>\n<li>Two major criteria, or</li>\n<li>One major and three minor criteria, or</li>\n<li>Five minor criteria.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The Rosemont criteria for the diagnosis of chronic pancreatitis is based on:",
    "choices": [
      {
        "id": 1,
        "text": "CT scan findings"
      },
      {
        "id": 2,
        "text": "ERCP findings"
      },
      {
        "id": 3,
        "text": "MRCP findings"
      },
      {
        "id": 4,
        "text": "EUS findings"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Rosemont&rsquo;s criteria</strong> for the diagnosis of<strong> chronic pancreatitis</strong> is based on endoscopic ultrasonographic (<strong>EUS</strong>)<strong> findings.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a criteria for severe acute malnutrition?",
    "choices": [
      {
        "id": 1,
        "text": "Weight for height less than -3 SD"
      },
      {
        "id": 2,
        "text": "MUAC < 115mm"
      },
      {
        "id": 3,
        "text": "B/L Pedal Edema"
      },
      {
        "id": 4,
        "text": "Weight for age less than -3 SD"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Severe acute malnutrition</strong> (SAM) according to the WHO criteria is the&nbsp;<strong>w</strong><strong>eight for height (not age) less than minus -3 SD.</strong></p>\n<p><strong>Severe acute malnutrition</strong> (SAM) in children of ages <strong>6 to 59 months</strong> is defined by the WHO as any of the following:</p>\n<ul>\n<li><strong>Weight-for-length</strong> (or height) <strong>below &minus;3 SD</strong> of the WHO child growth standards</li>\n<li>Presence of <strong>bipedal edema</strong></li>\n<li>Mid-upper arm circumference&nbsp;<strong>(</strong><strong>MUAC)</strong>&nbsp;<strong>&lt;11.5 cm</strong>.<strong>&nbsp;</strong></li>\n</ul>\n<p>Management of SAM is given below:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00d582a91da04e21a88a06688cfccbf1x720x799.JPEG"
    ]
  },
  {
    "text": "A diabetic patient with foci of infection was diagnosed with systemic inflammatory response syndrome (SIRS). Which of the following is not included under the diagnostic criteria for SIRS?",
    "choices": [
      {
        "id": 1,
        "text": "Bradycardia"
      },
      {
        "id": 2,
        "text": "Tachypnea"
      },
      {
        "id": 3,
        "text": "Hypothermia"
      },
      {
        "id": 4,
        "text": ">10% band forms on peripheral smear"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bradycardia</strong> is not a part of SIRS criteria.&nbsp;</p>\n<p class=\"p2\">SIRS is diagnosed when <strong>two</strong> of the following are present:</p>\n<ul>\n<li class=\"p2\">Hyperthermia (temperature &gt;38&deg;C) or hypothermia (temperature &lt;36&deg;C)</li>\n<li class=\"p2\">Tachypnea (&gt;20 breaths/min) or arterial carbon dioxide tension (PaCO<sub>2</sub>) of less than 32 mm Hg</li>\n<li class=\"p2\"><strong>Tachycardia</strong> (&gt;90 beats/min)&nbsp;</li>\n<li class=\"p2\">White cell count &gt;12 x 10<sup>9</sup>/L or &lt;4 x 10<sup>9</sup>/L or &gt;10% Band forms</li>\n</ul>\n<p class=\"p2\">Sepsis is SIRS with a documented infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presented with nausea, vomiting, and acute onset epigastric pain radiating to the back. Investigations revealed elevated levels of serum amylase and lipase. An abdominal X-ray showed the colon-cut off sign.  Which of the following criteria uses CT to stage the severity of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Modified Glasgow score"
      },
      {
        "id": 2,
        "text": "Balthazar score"
      },
      {
        "id": 3,
        "text": "APACHE II score"
      },
      {
        "id": 4,
        "text": "Ranson criteria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features and the abdominal radiograph showing the<strong> colon cut-off sign</strong> are suggestive of <strong>acute pancreatitis.</strong>&nbsp;<strong class=\"ng-binding\">Balthazar Scoring</strong><strong class=\"ng-binding\">&nbsp;</strong>is used for <strong>staging</strong> the <strong>severity</strong> of acute pancreatitis <strong>based</strong> on <strong>CT</strong>&nbsp;findings.</p>\n<p>The most<strong> common causes </strong>of acute pancreatitis are - gallstones, alcoholism, post-ERCP (endoscopic retrograde cholangiopancreatography), drugs (steroids, thiazides, azathioprine, etc.), hypercalcemia,&nbsp;etc.&nbsp;</p>\n<p>The<strong> classical presentation </strong>includes acute severe&nbsp;<strong>epigastric pain&nbsp;</strong>radiating&nbsp;to the<strong> back </strong>and<strong>&nbsp;relieved </strong>by<strong> leaning forward. </strong>Nausea and vomiting can also be present<strong>. Clinical signs</strong> such as&nbsp;hypotension, tachycardia, <strong>Grey Turner sign</strong>&nbsp;(bluish discoloration of the&nbsp;flanks), and&nbsp;<strong>Cullen&rsquo;s sign</strong> (bluish discoloration around the&nbsp;umbilicus) can be present.</p>\n<p>The Grey Turner sign is shown below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ecb5ce91caa456bac24e7597b68e9d9x602x316.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b488bfe58c294d47b2e7108f26ec94d5x561x364.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c33888769af41d2af4dc648830fbac6x1024x1020.JPEG"
    ]
  },
  {
    "text": "During your ICU posting, your senior resident advises you to extubate the patients, who are on mechanical ventilation and are found to be improving. In order to plan for weaning, the rapid shallow breathing index of the patient should be:",
    "choices": [
      {
        "id": 1,
        "text": "More than 100"
      },
      {
        "id": 2,
        "text": "Less than 100"
      },
      {
        "id": 3,
        "text": "Less than 120"
      },
      {
        "id": 4,
        "text": "More than 120"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\"><strong>Rapid</strong> <strong>shallow breathing index (RSBI)</strong> should be <strong>less than&nbsp;100.</strong></span></p>\n<p><span data-preserver-spaces=\"true\">Patients with an<strong> RSBI &lt;100</strong> are eligible candidates for <strong>successful</strong> extubation. But, those with an <strong>RSBI &gt;120</strong> will need some degree of mechanical <strong>ventilator support</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\">A patient on mechanical ventilation should be tried to wean off when the <strong>patient no longer requires the ventilator</strong>. This condition usually met when the patient can</span><strong><span data-preserver-spaces=\"true\">&nbsp;breathe spontaneously</span></strong><span data-preserver-spaces=\"true\">,</span><span data-preserver-spaces=\"true\">&nbsp;is hemodynamically stable with adequate arterial oxygen saturation, and when he has a pH &gt;7.25.</span></p>\n<p><span data-preserver-spaces=\"true\">Additional <strong>criteria</strong> include,</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Inspiratory pressure: -20-30cm H2O</span></li>\n<li><span data-preserver-spaces=\"true\">Tidal volume: 4-6ml/kg</span></li>\n<li>Vital capacity: &gt;10 mL/kg</li>\n<li>Minute ventilation: &lt;10 L/min</li>\n<li>Rapid shallow breathing index(RSBI): &lt;100</li>\n</ul>\n<div class=\"page\" title=\"Page 2291\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Patients are weaned off from the ventilator with the help of <strong>techniques</strong> such as pressure support, synchronized intermittent mandatory ventilation<strong>&nbsp;</strong>(SIMV), and periods of spontaneous breathing (either on a &Tau;-piece or on a low setting of CPAP).</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following options is incorrect regarding ROME IV criteria?",
    "choices": [
      {
        "id": 1,
        "text": "Recurrent abdominal pain, on average should be present for at least 1 day per week in the last 3 months"
      },
      {
        "id": 2,
        "text": "Associated with a change in stool form"
      },
      {
        "id": 3,
        "text": "Associated with a change in stool frequency"
      },
      {
        "id": 4,
        "text": "Abdominal pain for the last 3 weeks with symptom onset at least 6 months before diagnosis."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The\u00a0<strong class=\"ng-binding\">ROME IV Diagnostic criteria for IBS\u00a0</strong>\u00a0must be fulfilled for the last\u00a0<strong>3 months</strong> with symptom\u00a0<strong>onset</strong>\u00a0at least\u00a0<strong>6 months</strong>\u00a0before diagnosis.</p>\n<p>The\u00a0<strong>onset</strong>\u00a0of symptoms during a period of\u00a0<strong>stress\u00a0</strong>or emotional upset is a feature that supports a diagnosis of irritable bowel syndrome (IBS).</p>\n<p>Based on bowel movement patterns, IBS is classified as:</p>\n<ul>\n<li><strong>IBS-C</strong>: Irritable bowel syndrome-constipation predominant</li>\n<li><strong>IBS-D</strong>: Irritable bowel syndrome-diarrhea predominant</li>\n<li><strong>IBS-M</strong>: Irritable bowel syndrome-mixed</li>\n</ul>\n<p>Alteration in bowel habits\u00a0(constipation/diarrhea) is the most consistent clinical feature in IBS. This means that a majority of people suffering from IBS have an alteration in bowel habits. The most common pattern is constipation alternating with diarrhea, usually with one of these symptoms predominating.</p>\n<p>IBS is a\u00a0<strong>clinical diagnosis</strong>\u00a0that can be made without performing many tests if the patient presents with typical symptoms. However, it is recommended to perform the following tests in most patients to\u00a0<strong>rule out</strong>\u00a0other conditions:</p>\n<ul>\n<li>Complete blood count</li>\n<li>Sigmoidoscopic examination</li>\n<li>Stool examination for ova and parasites</li>\n<li>3-week lactose-free diet</li>\n<li>Fecal calprotectin\u00a0levels help distinguish inflammatory bowel disease (IBD) from IBS</li>\n</ul>\n<p>In patients\u00a0<strong>&gt;40 years</strong>, air-contrast\u00a0<strong>barium enema</strong>\u00a0or\u00a0<strong>colonoscopy</strong>\u00a0should also be performed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "According to NADA's criteria, which of these findings would not be sufficient to consider the diagnosis of congenital heart disease in an infant?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of abnormal ECG alone"
      },
      {
        "id": 2,
        "text": "Presence of cyanosis alone"
      },
      {
        "id": 3,
        "text": "Presence of abnormal S2 and abnormal chest -X-ray"
      },
      {
        "id": 4,
        "text": "Presence of grade 3 systolic murmur alone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>According to <strong>NADA's criteria</strong>, the presence&nbsp;of <strong>abnormal ECG alone</strong> is <strong>not sufficient</strong> by itself to indicate congenital heart disease in an infant as it is a <strong>minor criteria</strong>.&nbsp;NADA&rsquo;s criteria is used to diagnose<strong> congenital heart disease</strong> in children. The presence of <strong>1 major or 2 minor criteria</strong> indicates congenital heart disease.</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Major criteria&nbsp;</strong></td>\n<td><strong>Minor criteria</strong></td>\n</tr>\n<tr>\n<td>Systolic murmur grade 3 or more</td>\n<td>Systolic murmur &lt; grade 3</td>\n</tr>\n<tr>\n<td>Any diastolic murmur</td>\n<td>Abnormal second sound (S2)</td>\n</tr>\n<tr>\n<td>Cyanosis</td>\n<td>Abnormal ECG</td>\n</tr>\n<tr>\n<td>Congestive cardiac failure</td>\n<td>\n<p>Abnormal chest X-ray findings</p>\n</td>\n</tr>\n<tr>\n<td>&nbsp;</td>\n<td>\n<p>Abnormal BP</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child with Wilson's disease is being considered for liver transplantation. Which of the following is not a parameter in the selection criteria for transplantation?",
    "choices": [
      {
        "id": 1,
        "text": "Age <10years"
      },
      {
        "id": 2,
        "text": "PT >100 s"
      },
      {
        "id": 3,
        "text": "Bilirubin >300 \u03bcmol/L"
      },
      {
        "id": 4,
        "text": "Jaundice less than 7 days before development of encephalopathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A 5-year-old child with Wilson's disease is a case of <strong>non-paracetamol-induced acute liver failure</strong> and jaundice&nbsp;for <strong>more than 7 days</strong> before the development of encephalopathy is one of the parameters in the&nbsp;<strong>King's College criteria for liver transplantation.</strong></p>\n<p>It includes the following parameters:</p>\n<p><strong>Non-paracetamol-induced acute liver failure</strong>:</p>\n<div class=\"page\" title=\"Page 1177\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>PT &gt;100 s (INR &gt;6.5)</li>\n</ul>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; or/and</p>\n<ul>\n<li><strong>Any three</strong> of the following:\n<ul>\n<li>Age &lt;10 years or &gt;40 years</li>\n<li>Etiology non-A, non-B hepatitis, or idiosyncratic drug reaction</li>\n<li><strong>Jaundice more than 7 days before the development of encephalopathy</strong> i.e., not hyperacute</li>\n<li>PT &gt;50 s (INR &gt; 3.5)</li>\n<li>Bilirubin &gt; 18 mg/dl (300 &mu;mol/L)</li>\n</ul>\n</li>\n</ul>\n<p><strong>Paracetamol-induced acute liver failure:</strong></p>\n<div class=\"page\" title=\"Page 1177\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>pH &lt;7.30 (irrespective of the grade of encephalopathy)&nbsp;</li>\n</ul>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; or/and</p>\n<ul>\n<li><strong>All three</strong> of the following:\n<ul>\n<li>Prothrombin time &gt;100 s (INR &gt;6.5)</li>\n<li>Serum creatinine &gt;3.4 mg/dl (300 &mu;mol/L)</li>\n<li>Grade 3 or 4 hepatic encephalopathy</li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who is a known case of cirrhosis presents with lethargy and disorientation to time. On examination, flapping tremors are noted. What is the most likely grading of hepatic encephalopathy in this patient according to West Haven criteria?",
    "choices": [
      {
        "id": 1,
        "text": "Grade 4"
      },
      {
        "id": 2,
        "text": "Grade 3"
      },
      {
        "id": 3,
        "text": "Grade 2"
      },
      {
        "id": 4,
        "text": "Grade 1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Disorientation to time</strong>, and <strong>lethargy</strong>, in a known case of cirrhosis, suggest <strong>grade 2&nbsp;</strong>hepatic encephalopathy according to <strong>West Haven criteria</strong>.</p>\n<p><strong>Hepatic encephalopathy</strong> is the alteration of mental status and cognitive function occurring in liver failure. This occurs due to the<strong> failure of removal</strong> of gut-derived neurotoxins like <strong>ammonia by liver.</strong> These neurotoxins enter the brain leading to the development of symptoms.</p>\n<div class=\"page\" title=\"Page 2459\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>In patients with cirrhosis, encephalopathy is often found as a result of certain precipitating events such as hypokalemia, infection, an increased dietary protein load, or electrolyte disturbances.</p>\n<p><strong>Treatment of hepatic encephalopathy</strong>&nbsp;includes:</p>\n<ul>\n<li>Correction of precipitating factors</li>\n<li><strong>Lactulose</strong>&nbsp;- Lactulose is a laxative that acts by getting converted to short chain fatty acid in the colon. These fatty acids result in decrease in pH of intestinal juice. At this low pH, ammonia becomes ionized and thus cannot be absorbed.</li>\n<li><strong>Rifaximin</strong>&nbsp;- It is a<strong>&nbsp;</strong>synthetic<strong>&nbsp;</strong>rifamycin that is&nbsp;poorly absorbed from the GIT&nbsp;and is indicated in the management of hepatic encephalopathy as it lowers the blood ammonia levels</li>\n<li><strong>Zinc&nbsp;</strong>- It serves as a co-factor for the urea cycle and thus stimulates it and lowers ammonia levels.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As per the Milan criteria for liver transplantation in patients with cirrhosis and hepatocellular carcinoma, which of the following would disqualify a patient for liver transplantation?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of a single tumor with diameter 4.2 cm"
      },
      {
        "id": 2,
        "text": "Presence of three tumors with diameters 2.5 cm, 2.2 cm, and 1.5 cm"
      },
      {
        "id": 3,
        "text": "Presence of macrovascular invasion"
      },
      {
        "id": 4,
        "text": "Presence of two tumors with diameter 2.2 cm and 1.5 cm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presence of <strong>major vessel involvement&nbsp;</strong>would <strong>disqualify a patient for liver transplantation</strong>, as per the <strong>Milan criteria.</strong></p>\n<p>The Milan criteria are used to assess the suitability of patients with cirrhosis and hepatocellular carcinoma for liver transplantation. In order to be suitable for liver transplantation, the patient should have</p>\n<ul>\n<li>a single tumor with a diameter of &le;5 cm</li>\n<li>up to 3 tumors, each with a diameter &le;3 cm</li>\n<li>no extra-hepatic involvement</li>\n<li>no macrovascular invasion</li>\n</ul>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a part of WHO's major criteria for the diagnosis of polycythemia vera?",
    "choices": [
      {
        "id": 1,
        "text": "Subnormal serum erythropoietin level"
      },
      {
        "id": 2,
        "text": "Hematocrit >49% in men"
      },
      {
        "id": 3,
        "text": "Presence of JAK2 mutation"
      },
      {
        "id": 4,
        "text": "Bone marrow biopsy showing hypercellularity with panmyelosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">Subnormal serum erythropoietin level is<strong>&nbsp;a minor criterion&nbsp;</strong>for the diagnosis of polycythemia vera. The other three options are included as major criteria for the diagnosis of polycythemia vera.</p>\n<p class=\"p1\"><strong>Polycythemia vera (PCV)</strong>&nbsp;is a <strong>hematopoietic stem cell disorder</strong> in which there is an accumulation of phenotypically normal red cells, granulocytes, and platelets in the absence of a recognizable physiologic stimulus. It is the&nbsp;most common&nbsp;myeloproliferative neoplasm. The increase in the red cells is predominantly responsible for the clinical symptoms in this condition.</p>\n<p>In 15% to 20% of patients after an average period of 10 years, there is increased myelofibrosis and extensive extramedullary hematopoiesis. PCV transforms into AML in 2% of patients.</p>\n<p>The&nbsp;<strong>most common</strong>&nbsp;cytogenetic abnormality in polycythemia vera is the&nbsp;<strong><em>JAK2</em> mutation</strong>.&nbsp;</p>\n<p>Clinical features of PCV:</p>\n<ul>\n<li><strong>Splenomegaly</strong></li>\n<li><strong>Thrombocytosis&nbsp;</strong>- leads to venous arterial thrombosis, hepatic venous thrombosis. Erythromelalgia is the erythema, burning, and pain in the extremities. It also occurs due to thrombocytosis.</li>\n<li><strong>Erythrocytosis&nbsp;</strong>- leads to hyperviscosity, leading to neurologic symptoms such as vertigo, tinnitus, headache, visual disturbances,&nbsp;transient ischemic attacks (TIA), and systolic hypertension.&nbsp;</li>\n<li><strong>Aquagenic pruritis</strong></li>\n<li><strong>Hyperuricemia and gout&nbsp;</strong>- It may occur due to the large turnover of the hematopoietic stem cells</li>\n</ul>\n<p>Diagnosis: Criteria for diagnosis is given below:</p>\n<p>Major criteria:</p>\n<ol>\n<li><strong>Hb</strong>&nbsp;more than&nbsp;<strong>16.5g/dL</strong>&nbsp;in males and&nbsp;<strong>16g/dL</strong>&nbsp;in females or hematocrit of&nbsp;<strong>&gt;49%</strong>&nbsp;in men and &gt;<strong>48%</strong>&nbsp;in women</li>\n<li>Bone marrow biopsy&nbsp;showing&nbsp;<strong>hypercellularity</strong>&nbsp;with&nbsp;<strong>trilineage growth</strong>&nbsp;(panmyelosis) including prominent erythroid, granulocytic, and megakaryocytic proliferation.</li>\n<li>Presence of<strong>&nbsp;<em>JAK-2</em></strong>&nbsp;mutation</li>\n</ol>\n<p>Minor criteria:</p>\n<ul>\n<li><strong>Subnormal</strong>&nbsp;erythropoietin levels.</li>\n</ul>\n<p>Diagnosis requires all&nbsp;<strong>three major criteria</strong>&nbsp;or the first&nbsp;<strong>2 major and 1 minor criterion.</strong></p>\n<p>Management:</p>\n<ul>\n<li>Target Hb levels are <strong>&lt; 14g/dL in males and &lt; 12g/dL in females.</strong></li>\n<li>Periodic <strong>phlebotomy</strong> can be done to reduce hyperviscosity and to maintain the red cell mass. It is usually done at 3-month intervals.</li>\n<li>Anticoagulants are given when there is thrombosis.</li>\n<li>Allopurinol can be given to control hyperuricemia.</li>\n<li><strong>Ruxolitinib which is a nonspecific JAK2 inhibitor</strong>, pegylated IFN-&alpha;, or PUVA therapy can be used for intractable pruritis.</li>\n<li>Ruxolitinib or&nbsp;pegylated IFN-&alpha; can be used to manage symptomatic splenomegaly.</li>\n<li><strong>Anagrelide</strong> which is a phosphodiesterase inhibitor is used to reduce platelet count in these patients.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The ACR-EULAR classification criteria is used in the classification of ____",
    "choices": [
      {
        "id": 1,
        "text": "Gout"
      },
      {
        "id": 2,
        "text": "Osteoarthritis"
      },
      {
        "id": 3,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 4,
        "text": "Psoriasis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>ACR-EULAR</strong> classification <strong>criteria</strong> are used in the classification of <strong>rheumatoid arthritis.</strong></p>\n<p>&nbsp;A score of <strong>&ge;6</strong> fulfills the requirements for <strong>definite RA</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  male patient presented with a fracture of the shaft of the femur following a road traffic accident. After 2 days he developed dyspnea, petechiae involving the whole body, and a fall in oxygen saturation. Fat embolism is suspected. Based on which criteria would he be diagnosed?",
    "choices": [
      {
        "id": 1,
        "text": "Gurd's criteria"
      },
      {
        "id": 2,
        "text": "Garden's criteria"
      },
      {
        "id": 3,
        "text": "Modified Wells criteria"
      },
      {
        "id": 4,
        "text": "CURB-65 criteria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Fat embolism syndrome</strong> is diagnosed based on <strong>Gurd's criteria.</strong></p>\n<p>Fat embolism is caused by the fat globules originating from the <strong>bone marrow</strong>&nbsp;following<strong> the fracture </strong>of <strong>long bones.</strong>&nbsp;Clinical features of fat embolism are usually seen <strong>within 72 hours</strong>. They include&nbsp;<strong>tachycardia, fever, breathlessness</strong>, <strong>petechiae,</strong><strong>&nbsp;confusion,</strong> and<strong> restlessness.</strong></p>\n<p>There is no specific test for diagnosis. However, <strong>sputum</strong> and&nbsp;<strong>urine analysis</strong> to look for fat globules and monitoring of blood pO2 are done. Management of fat embolism is mostly supportive, with <strong>oxygen therapy</strong>.&nbsp;</p>\n<p>Other options:</p>\n<p>Option B:&nbsp;<strong>Garden classification </strong>is used for <strong>fracture neck</strong> of the <strong>femur</strong>.<strong>&nbsp;</strong>It is based on the degree of displacement of the fracture.</p>\n<p>Option C:<strong> Modified Wells Criteria</strong> is used to predict the likelihood of <strong>pulmonary embolism.</strong></p>\n<p>Option D: <strong>CURB-65 scoring</strong> is used to assess the<strong>&nbsp;severity </strong>of<strong>&nbsp;</strong>illness in a case of pneumonia, especially<strong>&nbsp;community-acquired pneumonia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "WHO criteria for blindness is visual acuity less than",
    "choices": [
      {
        "id": 1,
        "text": "1/60"
      },
      {
        "id": 2,
        "text": "6/60"
      },
      {
        "id": 3,
        "text": "3/60"
      },
      {
        "id": 4,
        "text": "6/18"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the<strong> WHO</strong>,<strong> blindness</strong>\u00a0is\u00a0<strong>defined</strong>\u00a0as presenting\u00a0<strong>visual acuity of less than 3/60</strong>, or a corresponding <strong>visual field loss to less than 10\u00b0\u00a0</strong>in the <strong>better eye.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "UK refinement of Hanifin and Rajka criteria is used in the diagnosis of which of the following disorders?",
    "choices": [
      {
        "id": 1,
        "text": "Atopic dermatitis"
      },
      {
        "id": 2,
        "text": "Nummular eczema"
      },
      {
        "id": 3,
        "text": "Eczema herpeticum"
      },
      {
        "id": 4,
        "text": "Contact dermatitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>UK refinement of Hanifin and Rajka criteria</strong> is used in the diagnosis of <strong>atopic dermatitis</strong>.</p>\n<p>The <strong>original Hanifin and Rajka criteria</strong> require that patients have at least 3 of the 4 major criteria and 3 of the 23 minor criteria. Consequently, <strong>Williams et al.</strong> coordinated a <strong>UK working party</strong> to attempt to refine the criteria of Hanifin and Rajka into a repeatable and validated set of diagnostic criteria for atopic eczema.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a part of the obstetric criteria for diagnosis of antiphospholipid antibody syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "\u2265 1 unexplained deaths of a morphologically normal fetus \u226510 weeks"
      },
      {
        "id": 2,
        "text": "Severe preeclampsia or placental insufficiency requiring delivery <37 weeks"
      },
      {
        "id": 3,
        "text": "Severe preeclampsia or placental insufficiency requiring delivery <34 weeks"
      },
      {
        "id": 4,
        "text": "\u2265 3 unexplained consecutive spontaneous abortions <10 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Severe preeclampsia or placental insufficiency requiring delivery before 34 weeks(not &lt;37 weeks) is an obstetric criterion for diagnosis of antiphospholipid antibody (APLA) syndrome.\u00a0</p>\n<p><strong>Antiphospholipid antibody syndrome</strong> is an autoimmune disorder that is commonly associated with <strong>fetal death, preterm delivery</strong>, early-onset <strong>preeclampsia</strong>, and fetal growth restriction due to placental insufficiency and thromboses. Pregnancy loss usually occurs <strong>before ten weeks</strong>.</p>\n<p>Diagnosis of APLA requires <strong>at least one clinical</strong> criterion and <strong>one laboratory</strong> criterion:</p>\n<ul>\n<li><strong>Clinical</strong>\n<ul>\n<li><strong>Obstetric criteria</strong> -\u00a0\n<ul>\n<li><strong>One or more unexplained deaths</strong> of a morphologically normal fetus <strong>at or beyond ten weeks</strong>, or</li>\n<li><strong>Severe preeclampsia</strong> or placental insufficiency requiring delivery <strong>before 34 weeks</strong>\u00a0or</li>\n<li><strong>Three</strong> or <strong>more </strong>unexplained <strong>consecutive spontaneous abortions before ten weeks</strong></li>\n</ul>\n</li>\n<li><strong>Vascular</strong> - One or more episodes of arterial-venous or small vessel thrombosis in any organ or tissue</li>\n</ul>\n</li>\n<li>Laboratory criteria(2 positive tests at least 12 weeks apart) -\u00a0\n<ul>\n<li>Presence of lupus anticoagulant, or</li>\n<li><strong>Anticardiolipin antibodies</strong>, or</li>\n<li>Anti-\u03b22 glycoprotein antibody</li>\n</ul>\n</li>\n</ul>\n<div class=\"page\" title=\"Page 1131\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Specific therapy</strong>\u00a0in pregnancy:\u00a0<strong>Aspirin</strong>\u00a0plus\u00a0<strong>heparin</strong> therapy is the most effective regimen. Women are treated with low-dose aspirin and heparin for up to <strong>34 weeks</strong>. Unfractionated heparin and low molecular weight heparin (LMWH) are equally effective and safe.\u00a0<strong>Corticosteroids</strong>\u00a0are used only in\u00a0<strong>secondary</strong>\u00a0<strong>APLA</strong>\u00a0syndrome (associated with SLE) and not in primary APLA syndrome.\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1158\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Prophylaxis:</p>\n<ul>\n<li>Women with\u00a0<strong>prior thromboembolic events -\u00a0</strong>prophylactic anticoagulation\u00a0<strong>throughout pregnancy</strong>\u00a0and\u00a0<strong>six weeks postpartum</strong>\u00a0with either\u00a0<strong>heparin</strong>\u00a0are recommended.\u00a0<strong>Serial sonographic assessment</strong>\u00a0of fetal growth and antepartum testing should be done in the\u00a0<strong>third trimester</strong>\u00a0due to the risk of fetal growth abnormalities and stillbirths.</li>\n<li>For women\u00a0<strong>without prior thromboembolic events</strong>, acceptable regimes include -\u00a0\n<ul>\n<li>Close antepartum maternal observation with or without prophylactic heparin along with postpartum anticoagulation for 4 to 6 weeks or</li>\n<li>Surveillance alone, or</li>\n<li>Prophylactic heparin + low dose aspirin (if a prior history of recurrent abortion or stillbirth)</li>\n</ul>\n</li>\n</ul>\n<p>Note: The new<strong> 2023 ACR/EULAR criteria</strong>\u00a0is an update from the revised Sapporo criteria with the clinical criteria, which includes an <strong>entry criterion</strong> of at least <strong>one positive antiphospholipid antibody </strong>within three years of identification of a clinical criterion, followed by scoring with weighted criteria divided into <strong>six clinical domains</strong> (macrovascular venous thromboembolism, macrovascular arterial thrombosis, microvascular, obstetric, cardiac valve, and hematologic) and <strong>two laboratory domains</strong> (lupus anticoagulant, \u00a0IgG/IgM anticardiolipin ELISA and/or IgG/IgM anti-\u03b22 -glycoprotein I antibodies) This has increased the <strong>specificity </strong>in diagnosing APS.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a cardinal finding in patients who are declared brain dead according to Harvard criteria for brain death?",
    "choices": [
      {
        "id": 1,
        "text": "No pupillary changes in response to light"
      },
      {
        "id": 2,
        "text": "Cough response to bronchial suction"
      },
      {
        "id": 3,
        "text": "Absent oculocephalic reflex"
      },
      {
        "id": 4,
        "text": "Absent eye movements in response to caloric testing"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Cough response to bronchial suction is indicative of <strong>normal cough reflex</strong> and is, therefore <strong>not</strong> a cardinal <strong>finding</strong> in <strong>brain death.</strong>&nbsp;</p>\n<p>The 3 <strong>cardinal features</strong> of brain death include:</p>\n<ol>\n<li><strong>Unresponsiveness</strong>&nbsp;or <strong>coma-</strong> demonstrated by an <strong>absent motor response</strong> to <strong>pain</strong> in all extremities.</li>\n<li><strong>Apnea</strong>- impaired brainstem activity indicates damage to the medullary cardio-respiratory centers. This manifests as a&nbsp;<strong>loss</strong> of <strong>centrally controlled breathing.</strong></li>\n<li><strong>Absence</strong> of<strong> brainstem reflexes</strong> -\n<ul>\n<li>Cranial nerve II, III (optic and oculomotor)- <strong>absent</strong> direct and consensual <strong>light reflex</strong>. This is associated with <strong>dilated pupils</strong> measuring about 9 mm.&nbsp;</li>\n<li>Cranial nerve VIII (vestibulocochlear)- <strong>absent</strong> oculocephalic (<em><strong>Doll's eye phenomenon</strong></em>) and <strong>oculovestibular</strong> (unresponsive to caloric testing) reflexes.</li>\n<li>Cranial nerve V, VII (trigeminal and facial)- absent corneal and jaw reflexes.</li>\n<li>Cranial nerve IX, X (glossopharyngeal and vagus)- <strong>absent cough</strong> and gag <strong>reflexes.</strong></li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old man underwent an orthopedic procedure following which he was taking multiple antibiotics. He later developed fever, diarrhoea and abdominal pain. Blood investigations reveal leukocytosis. Pseudomembranous colitis is suspected. The criteria for the diagnosis of the suspected condition includes all except?",
    "choices": [
      {
        "id": 1,
        "text": "Detection of toxin A or B in stool"
      },
      {
        "id": 2,
        "text": "Stool wet mount microscopy to visualise the organism"
      },
      {
        "id": 3,
        "text": "Diarrhea (\u22653 unformed stools per 24 h for \u22652 days)"
      },
      {
        "id": 4,
        "text": "Pseudomembranes on colonoscopy or sigmoidoscopy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Stool wet mount microscopy</strong> to visualize the organism is <strong>not part of the criteria</strong> for the diagnosis of <strong>pseudomembranous colitis</strong></p>\n<p>Pathologically, the organism produces two toxins;&nbsp;<strong>Toxin A(Enterotoxin)</strong> causing large-volume diarrhea, and <strong>Toxin B(Cytotoxin)</strong>&nbsp;causing epithelial injury and bloody stools.</p>\n<p>The endoscopic image below shows&nbsp;<strong>pseudomembranous colitis</strong>&nbsp;caused by&nbsp;<strong>Clostridium difficile infection (CDI)</strong>.&nbsp;It is most commonly associated with the use of antimicrobials like cephalosporin, ampicillin, fluoroquinolones, clindamycin, etc.</p>\n<p>The diagnosis is based on a combination of 2 <strong>criteria</strong>:<br />1.&nbsp;Diarrhea (&ge;3 unformed stools per 24 h for &ge;2 days)<br />2. Detection of toxins A &amp; B in stools, detection of toxin-producing C. difficile by NAAT/Culture, Visualisation of the pseudomembrane in the colon.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de5546f0f39944d1ac821b14b4200664x720x627.JPEG"
    ]
  },
  {
    "text": "According to Truelove\u2013Witts criteria, which of the following is not a criterion to diagnose acute severe colitis?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of jaundice and pruritus"
      },
      {
        "id": 2,
        "text": "\u2265 6 bloody stools in 24 hrs"
      },
      {
        "id": 3,
        "text": "Raised inflammatory markers"
      },
      {
        "id": 4,
        "text": "Presence of anemia or fever"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The presence of <strong>jaundice</strong> and <strong>pruritus</strong> is not a part of&nbsp;<strong>Truelove&ndash;Witts criteria</strong> which are used to define <strong>acute severe ulcerative colitis</strong>.&nbsp;</p>\n<p><strong>Truelove&ndash;Witts criteria</strong> define <strong>acute severe colitis</strong> as the presence of:</p>\n<ol>\n<li><strong>&ge; 6 bloody stools/24 hrs</strong></li>\n<li>Plus, one or more of the following features:\n<ul style=\"list-style-type: disc;\">\n<li><strong>Anemia</strong> (Hemoglobin &lt;10 g/dL).</li>\n<li>Mild <strong>fever</strong> (&gt;100.04&deg;F)<strong>.</strong></li>\n<li>Tachycardia (Pulse &ge;90 beats/min).</li>\n<li><strong>High inflammatory markers</strong> (ESR &gt; 30 mm/hr <strong>or</strong>&nbsp;CRP &gt;30 mg/L).</li>\n</ul>\n</li>\n</ol>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Criterias Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>