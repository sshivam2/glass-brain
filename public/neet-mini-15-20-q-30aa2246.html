<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet Mini - 15 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 25-year-old female patient, 4 months postnatal, presents with a painless swelling in front of the neck. She also complains of fatigue, body aches, dry skin, and hair loss for the past 1 week. She tests positive for thyroid peroxidase (TPO) antibodies. Which of the following is the likely thyroid function test pattern observed during the course of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "\u2193TSH  and \u2193T3,T4 \u2192 \u2191TSH and \u2191T3,T4 \u2192 Euthyroid"
      },
      {
        "id": 2,
        "text": "\u2193TSH and \u2191T3,T4 \u2192 \u2191TSH and \u2193T3,T4 \u2192 Euthyroid"
      },
      {
        "id": 3,
        "text": "\u2191TSH and \u2193T3,T4 \u2192 \u2193TSH and \u2191T3,T4 \u2192 Euthyroid"
      },
      {
        "id": 4,
        "text": "\u2191TSH and \u2191T3,T4 \u2192 \u2193TSH and \u2193T3,T4 \u2192 Euthyroid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette showing a painless thyroid swelling 4 months after childbirth with positive TPO antibody titre is suggestive of <strong>Postpartum thyroiditis</strong> which is characterized by an initial thyrotoxic episode, followed by a hypothyroid state and eventually assuming euthyroid levels after. The corresponding thyroid function test levels are seen in the following sequence:</p>\n<ul>\n<li>\u2193TSH\u00a0and \u2191T3,T4 (thyrotoxic episode)</li>\n<li>\u2191TSH\u00a0and \u2193T3,T4\u00a0 (hypothyroid state)</li>\n<li>Euthyroid state</li>\n</ul>\n<p>Thyroid function test consistes of 3 entities -\u00a0</p>\n<ol>\n<li>\n<p>TSH - Thyroid stimulating hormone</p>\n</li>\n<li>\n<p>T4 - Thyroxine</p>\n</li>\n<li>\n<p>T3 - Triiodothyronine</p>\n</li>\n</ol>\n<p>TSH is released from the anterior pituitary which acts on thyroid follicles to stimulate the release of T3 and T4. High circulating levels of T4 and T3 decrease the levels of TSH via a negative feedback mechanism. Abnormality in the circulating levels of any of these markers help in identifying the underlying pathology.</p>\n<p>It is called \"silent thyroiditis\", as it is <strong>painless</strong>. When it occurs 3-6 months after pregnancy, it is termed <strong>postpartum thyroiditis</strong>. The condition is observed in up to 5% of women and it is 3 times more common in women with Type 1 diabetes mellitus.</p>\n<p>Typically, patients experience a <strong>brief phase of thyrotoxicosis</strong> lasting 2-4 weeks, <strong>followed by hypothyroidism</strong> for 4-12 weeks, and then clinical resolution. Often,<strong> only one phase is apparent</strong>.</p>\n<p>In addition to painless goiter, silent thyroiditis can be distinguished from subacute thyroiditis by a <strong>normal ESR value</strong> and the <strong>presence of thyroid peroxidase (TPO) antibodies</strong>.</p>\n<p>Severe thyrotoxic symptoms can be managed with a brief course of propranolol, a 20\u201340 mg dose administered three or four times daily. Thyroxine replacement may be needed for treating the hypothyroid phase but should be withdrawn after 6\u20139 months, to enable patient recovery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect regarding postnatal changes in circulation?",
    "choices": [
      {
        "id": 1,
        "text": "Septum primum and secundum fuse, closing the ductus arteriosus"
      },
      {
        "id": 2,
        "text": "Loss of placental circulation closes the ductus venosus"
      },
      {
        "id": 3,
        "text": "Following cord clamping, the systemic vascular resistance rises"
      },
      {
        "id": 4,
        "text": "Higher pressure in the left atrium than the right atrium closes the foramen ovale"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Septum primum and septum secundum fuse and close the<strong> foramen ovale</strong>.</p>\n<p>The termination of placental blood flow decreases the volume of blood returning to the right atrium. <strong>Left atrial pressure</strong> becomes <strong>higher</strong> than the right atrial pressure, and the foramen ovale gets closed functionally, usually hours after birth. Anatomical closure occurs within a few months to years when the septum primum and secundum become adherent to each other.</p>\n<div class=\"page\" title=\"Page 1\">Expansion of lungs after the first few breaths causes a <strong>drop in pulmonary vascular resistance</strong> and an increased flow into the pulmonary vessels. Loss of placental circulation following umbilical clamping causes a sudden <strong>increase in systemic vascular resistance</strong>.&nbsp;</div>\n<div class=\"page\" title=\"Page 1\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The output from the right ventricle now flows entirely into the pulmonary circulation, and because pulmonary vascular resistance is lower than systemic vascular resistance. The shunt through the ductus arteriosus reverses and becomes left to right. The <strong>high arterial oxygen saturation constricts and closes the ductus arteriosus,</strong> which eventually becomes the <strong>ligamentum arteriosum</strong>.</p>\n<p>Removal of the placenta from the circulation also results in the closure of the <strong>ductus venosus</strong>.</p>\n</div>\n</div>\n</div>\n<p>The main differences between fetal and postnatal circulation are:</p>\n<ul>\n<li>Placental circulation provides the gas exchange for the fetus, while lungs remain collapsed.</li>\n<li>Reduced flow of blood to the lungs and thus little pulmonary venous return to the left atrium.</li>\n<li>Presence of a ductus venosus, which joins the portal vein with the inferior vena cava. It&nbsp;provides a low resistance bypass from the umbilical vein to the inferior vena cava</li>\n<li>Foramen ovale enables oxygenated blood (through umbilical veins) to reach the left atrium and ventricle for distribution to the coronaries and the brain</li>\n<li>The ductus arteriosus allows right ventricular blood to reach the descending aorta since lungs are non-functioning.</li>\n</ul>\n<p>&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Over the last 3 months,  an adult man has experienced difficulty swallowing with a feeling of food getting stuck below his throat during meals, postprandial vomiting, and a burning sensation in his chest. His symptoms do not improve on taking proton pump inhibitors (PPIs). A histopathological sample from his upper GI endoscopy is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Eosinophilic esophagitis"
      },
      {
        "id": 2,
        "text": "Crohn's disease of the esophagus"
      },
      {
        "id": 3,
        "text": "Reflux esophagitis"
      },
      {
        "id": 4,
        "text": "Infectious esophagitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of <strong>dysphagia</strong>,\u00a0<strong>food impaction</strong>, non-responsiveness to PPI therapy,\u00a0along with histopathology showing<strong> eosinophilic infiltrates,</strong> is suggestive of<strong>\u00a0eosinophilic esophagitis.</strong></p>\n<p><strong>Adult</strong> patients with eosinophilic esophagitis present with<strong> impaction of food, dysphagia, vomiting, </strong>and <strong>symptoms of reflux</strong>. Eosinophilic esophagitis should be suspected in patients with heartburn that does not improve with PPIs.\u00a0<strong>Children</strong> with this condition present with nausea, vomiting,<strong>\u00a0chest/abdominal pain</strong>, and intolerance/<strong>aversion to food.</strong></p>\n<p>These patients are usually<strong> atopic</strong> and\u00a0may have associated conditions like atopic dermatitis, allergic rhinitis, asthma, or moderate peripheral eosinophilia.</p>\n<p>The cardinal histological feature is\u00a0<strong>large numbers of intraepithelial eosinophils</strong>. Abnormal squamous maturation is also apparent. Other features include eosinophilic microabscesses, eosinophils in superficial layers of squamous mucosa, and lamina propria fibrosis. The histopathological appearance is helpful in differentiating eosinophilic esophagitis from GERD, Crohn's, and other causes of esophagitis.</p>\n<p>The <strong>\u201cfeline\u201d esophagus</strong> which resembles the appearance of stacked circular rings, strictures, and linear furrows on esophageal endoscopy is typical of eosinophilic esophagitis and is shown below-</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/72dd36f74be8411081ca2821c4883abb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a5b8cb4503dd473b84139d72ad0f6e5dx526x545.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f13924e4abb744efaa56193c47951a62x720x1046.JPEG"
    ]
  },
  {
    "text": "A salesman met with an unfortunate accident that led to him eventually losing his left foot. He has been unable to walk after this incident and so been rendered unemployed. Match the following examples with the corresponding events explaining the concept of disability.",
    "choices": [
      {
        "id": 1,
        "text": "1-B, 2-C, 3-D, 4-A"
      },
      {
        "id": 2,
        "text": "1-D, 2-A, 3-B, 4-C"
      },
      {
        "id": 3,
        "text": "1-A, 2-B, 3-C, 4-D"
      },
      {
        "id": 4,
        "text": "1-C, 2-D, 3-A, 4-B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correctly matched events relating to the given example are as follows:</p>\n<table>\n<tbody>\n<tr>\n<td>Event</td>\n<td>Example</td>\n</tr>\n<tr>\n<td>Disease/Disorder</td>\n<td>Accident</td>\n</tr>\n<tr>\n<td>Impairment</td>\n<td>Loss of foot</td>\n</tr>\n<tr>\n<td>Disability</td>\n<td>Cannot Walk</td>\n</tr>\n<tr>\n<td>Handicap</td>\n<td>Unemployed</td>\n</tr>\n</tbody>\n</table>\n<p>The WHO definition of <strong>impairment</strong> is \"any <strong>loss</strong> <strong>or abnormality</strong> <strong>of</strong> psychological, physiological or anatomical <strong>structure or function</strong>\". E.g., loss of a foot. An initial impairment may cause a secondary impairment as well.</p>\n<p>The WHO defines <strong>disability</strong> as ''any<strong> restriction</strong> or lack of ability to perform an <strong>activity</strong> in the manner or within the range considered normal for a human being\".&nbsp;Because of impairment, the affected person may be unable to carry out certain activities and hence the person is considered disabled.</p>\n<p>According to the WHO, a <strong>handicap</strong> is \"a <strong>disadvantage</strong> for a given individual, resulting from an impairment or a disability, that <strong>limits</strong> or prevents the <strong>fulfilment of a role</strong> that is normal (depending on age, sex, and social and cultural factors) for that individual\". The disadvantages experienced by a person as a result of disability makes them handicapped.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a medical practitioner in a remote rural area. You remove a Guinea worm from a patient by rolling it over a stick as shown below. The intermediate host of this parasite is also implicated in which of the following organisms?",
    "choices": [
      {
        "id": 1,
        "text": "Hymenolepis nana"
      },
      {
        "id": 2,
        "text": "Diphyllobothrium latum"
      },
      {
        "id": 3,
        "text": "Taenia multiceps"
      },
      {
        "id": 4,
        "text": "Schistosoma haematobium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the way<strong>\u00a0Guinea worm (Dracunculiasis)</strong>\u00a0is removed by rolling them out over a small stick. It is transmitted by the <strong>cyclops</strong> which also serves as the intermediate host for\u00a0<strong>Diphyllobothrium latum/fish tapeworm.</strong></p>\n<p>Dracunculiasis/Guinea worm disease is a vector-borne<strong>\u00a0parasitic</strong>\u00a0disease caused by\u00a0<strong>Dracunculus medinensis.\u00a0</strong>Transmission occurs by consumption of water containing<strong>\u00a0cyclops</strong>\u00a0harbouring infective stages of the parasite. This disease is totally a water-based disease and has no alternate way of transmission.</p>\n<p>Life cycle of\u00a0Dracunculus medinensis/Gunea worm :</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6d3bfc755d5b43fb9abc177c2157c3f0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/236feb61bab64aa6bc7a14ffb9bf46c1x750x579.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1aa59d08877948b1b8fecee42c5eec74x1280x996.JPEG"
    ]
  },
  {
    "text": "Which of the following is the least likely to be associated with formication?",
    "choices": [
      {
        "id": 1,
        "text": "Cocaine abuse"
      },
      {
        "id": 2,
        "text": "Cannabis"
      },
      {
        "id": 3,
        "text": "Methamphetamines"
      },
      {
        "id": 4,
        "text": "Delirium tremens"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Formication</strong> is a tactile hallucination in which the patient experiences a feeling of insects crawling under the skin, and is not likely to be associated with cannabis.</p>\n<p>Formication is known to be associated with :</p>\n<ul>\n<li>Cocaine use</li>\n<li>Methamphetamine use</li>\n<li>Delirium tremens</li>\n<li>Restless leg syndrome</li>\n<li>Stimulant associated psychotic disorder</li>\n</ul>\n<p>When associated with a substance-induced <strong>obsessive-compulsive disorder</strong>, it can lead to <strong>compulsive skin picking</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old lady presented with pain and swelling in her knee. Histopathology of the lesion showed a large number of osteoclast-like giant cells seen scattered amidst round or spindle-shaped mononuclear cells. The stroma appeared well vascularized, with bands of fibrous tissue with areas of hemorrhage and collections of foamy macrophages interspersed in between. Which of the following x-rays belongs to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical stem and characteristic histopathology findings are suggestive of a giant cell tumor (GCT), or osteoclastoma. The x-ray findings of GCT are seen in&nbsp;<strong>Image 2,</strong>&nbsp;which shows an&nbsp;<strong>expansile, eccentric, sub-articular lesion,</strong> with a <strong>soap-bubble</strong> appearance.</p>\n<p>A GCT is typically seen on x-ray as an<strong>&nbsp;eccentric, lobulated, lytic lesion</strong> with non-sclerotic borders, giving a <strong>soap-bubble appearance</strong>. GCTs usually have little or no matrix calcification, new bone formation, or periosteal reaction. Tumors that extend into the soft tissues are seen as soft-tissue masses, which may be covered by a thin layer of sclerosis. They are usually located in the <strong>epiphysis</strong>&nbsp;of the long bone, but may also extend to<strong>&nbsp;</strong>the metaphysis. If malignant, the tumor appears as a lytic lesion with a sclerosing destructive tumor adjacent to it.</p>\n<div class=\"page\" title=\"Page 223\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>CT imaging estimates cortical bone involvement, and MRI shows an isointense or hypointense lesion on T1-weighted images.</p>\n<div class=\"page\" title=\"Page 223\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>GCTs are benign but locally aggressive tumors of the bone and are characterized by a proliferation of mononuclear cells, with scattered macrophages. They are most commonly seen at 20&ndash;45 years of age.&nbsp;GCTs may occasionally be associated with Paget&rsquo;s disease of bone and focal dermal hypoplasia (Goltz syndrome).</p>\n<p>They are seen in the <strong>epiphysis</strong> of long bones, more commonly the distal femur, proximal tibia, distal radius, and proximal humerus. Patients present with pain and a mass.&nbsp;</p>\n<div class=\"page\" title=\"Page 224\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Histologically, GCTs consist of a large number of <strong>osteoclast-like giant cells,</strong> with scattered, round, or spindle-shaped mononuclear cells. The tumor stroma is well-vascularized, with bands of cellular or collagenous fibrous tissue. Interposed areas of hemorrhage, hemosiderin, and foamy macrophages are seen.</p>\n<p>The image below shows the histopathology of osteoclastoma.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0731c5d378c44c16b082e34130b406bb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8618336d048a4e1f9293f60122ddabaex1280x1184.JPEG"
    ]
  },
  {
    "text": "You are going for inspection and surveillance to a foster home of kids with speech and hearing impairments. You see a young child whose picture is attached below. Which of the following types of hearing loss would you expect in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Unilateral/Bilateral sensori-neural hearing loss"
      },
      {
        "id": 2,
        "text": "Unilateral conductive hearing loss"
      },
      {
        "id": 3,
        "text": "Bilateral conductive hearing loss"
      },
      {
        "id": 4,
        "text": "Unilateral/ Bilateral mixed hearing loss"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a young child with\u00a0<strong>heterochromia </strong>of the <strong>iris</strong>\u00a0with a\u00a0<strong>white forelock\u00a0</strong>of hair suggestive of\u00a0<strong>Waardenburg syndrome\u00a0</strong>and characteristically we might see\u00a0<strong>unilateral/bilateral sensori-neural hearing loss.</strong></p>\n<p><strong>Waardenburg syndrome </strong>is an <strong>autosomal dominant</strong> disorder that has features of <strong>piebaldism</strong> and <strong>sensorineural deafness.\u00a0</strong>It is characterized by the white forelock, hypopigmented patches, <strong>heterochromia iridis</strong>, and sensorineural deafness.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/30ed9cc495ba414b8e3cd7f078291a1b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You notice the following finding in a child during the ophthalmology postings of your internship. The child complains of severe pain in the right eye and is crying incessantly.  The basic ophthalmic examination reveals orthophoria and normal ocular movement. The fundus examination in this child reveals fusiform focal arteriolar dilatations and telangiectasias.  Mild sub-retinal exudation is also noticed. Which of the following will be an indication of enucleation in the child?",
    "choices": [
      {
        "id": 1,
        "text": "Cataract"
      },
      {
        "id": 2,
        "text": "Tumor more than half of retina"
      },
      {
        "id": 3,
        "text": "Neovascular glaucoma"
      },
      {
        "id": 4,
        "text": "Optic nerve involvement"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette with <strong>leukocoria\u00a0</strong>(whitish reflex of the eye) and\u00a0<strong>retinal telangiectasia\u00a0</strong>with\u00a0<strong>sub-retinal exudation\u00a0</strong>is suggestive of\u00a0<strong>Coat's disease\u00a0</strong>and the indication for enucleation in Coat's disease is <strong>neovascular glaucoma</strong> associated with the painful eye.</p>\n<p>One of the close differential diagnoses is\u00a0<strong>retinoblastoma\u00a0</strong>where enucleation is also performed. You may also see retinal detachment and collection of sub-retinal fluid, but most characteristically we will see\u00a0<strong>cottage cheese calcifications\u00a0</strong>and either an\u00a0<strong>exophytic\u00a0</strong>or\u00a0<strong>endophytic growth\u00a0</strong>with some element of\u00a0<strong>proptosis. </strong>Two more important points to remember regarding the diagnosis include:</p>\n<ul>\n<li><span data-token-index=\"0\" data-reactroot=\"\">Retinal telangiectasia and subretinal exudation are characteristic of Coats disease</span></li>\n<li><span data-token-index=\"0\" data-reactroot=\"\">Coats disease has no positive family history while RB has a strong propensity for inheritance in families.\u00a0</span></li>\n</ul>\n<p><strong>Coat's disease:</strong></p>\n<p>Coats disease is<strong> idiopathic retinal telangiectasia</strong> that is generally of onset in <strong>early childhood</strong>. It is associated with<strong> intraretinal and subretinal exudation.</strong></p>\n<p><strong>Symptoms:</strong></p>\n<ul>\n<li>Unilateral visual loss</li>\n<li>Leukocoria (because of exudative retinal detachment)</li>\n<li>Strabismus</li>\n<li><strong>Fundus:\u00a0</strong>fusiform focal arteriolar dilatations and telangiectasia with mild sub-retinal exudation\u00a0</li>\n</ul>\n<p><strong>Investigations:</strong></p>\n<ul>\n<li>FFA -\u00a0FA in mild cases shows early hyper fluorescence of telangiectases and aneurysmal dilatations</li>\n<li>OCT - assessment of the macula in cooperative older children.</li>\n</ul>\n<p><strong>Treatment:<br /></strong></p>\n<ul>\n<li>Observation in patients with mild disease</li>\n<li>Laser ablation of points of leakage to prevent progressive exudation</li>\n<li>Intravitreal triamcinolone</li>\n<li>Cryotherapy</li>\n<li>Anti-VEGF therapy</li>\n<li>Vitre-retinal surgery: For retinal detachment</li>\n<li>Enucleation:\u00a0<strong>neovascular glaucoma associated with the painful eye</strong></li>\n</ul>\n<p>The given image shows complications of Coat's disease like conjunctival hyperaemia, cataract, corneal oedema due to glaucoma.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1877cb1851564a799543e6abc6c3c2a5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a97ee3bbfbb448f92857f9a34e1c016x1032x899.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/373c7017b66a47e680da523f8e5e95a5x720x331.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/597d5680be3d4a4cafd145c418b42185x975x900.JPEG"
    ]
  },
  {
    "text": "A 65-year-old man presents with chronic pain and stiffness in his hands, knees, and hips. On examination of the hands, Heberden's and Bouchard's nodes are visible. His knee x-ray is given below. Which of the following joints is likely to be spared in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Wrist joint"
      },
      {
        "id": 2,
        "text": "1st metatarsophalangeal joint"
      },
      {
        "id": 3,
        "text": "Distal interphalangeal joint"
      },
      {
        "id": 4,
        "text": "Intervertebral joints in the lumbar region"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical history along with&nbsp;<strong>Heberden&rsquo;s</strong>&nbsp;and&nbsp;<strong>Bouchard&rsquo;s&nbsp;</strong><strong>nodes </strong>on examination and <strong>reduced joint space</strong> on x-ray is suggestive of <strong>osteoarthritis</strong>.&nbsp;The <strong>wrist joint</strong> is likely to be spared in this condition.</p>\n<p>Other joints that are usually <strong>spared</strong> in osteoarthritis are the&nbsp;<strong>elbow</strong>&nbsp;and <strong>ankle</strong> joints.&nbsp;</p>\n<p>Osteoarthritis is the <strong>most common cause</strong> of <strong>chronic knee pain</strong> in individuals of age&nbsp;<strong>&gt;45 years</strong>. In the early phases, there is episodic joint pain following overactive use of the diseased joint. As the disease progresses, there is <strong>continuous pain</strong> and may be associated with <strong>stiffness</strong> of the affected joint. Morning stiffness if present, is usually brief for around 30 minutes.</p>\n<p>The <strong>joints involved</strong> in osteoarthritis are:&nbsp;</p>\n<ul>\n<li>Distal and proximal interphalangeal joints (DIP, PIP)</li>\n<li>First carpometacarpal joint (base of the thumb)</li>\n<li>Hip and knee joints</li>\n<li>First metatarsophalangeal joint (MTP)</li>\n<li>Cervical and lumbosacral spine</li>\n</ul>\n<p>Clinical signs:&nbsp;</p>\n<div class=\"page\" title=\"Page 2674\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Tenderness and inflammation of the joint</li>\n<li>Crepitus when the joint is moved</li>\n<li>Bony swelling</li>\n<li>Decreased and painful range of movement&nbsp;</li>\n<li>Deformity and instability in severe cases</li>\n<li><strong>Heberden&rsquo;s</strong>&nbsp;and&nbsp;<strong>Bouchard&rsquo;s&nbsp;</strong><strong>nodes </strong>-&nbsp;palpable nodules in the<strong> DIP</strong> and <strong>PIP</strong> joints, respectively (as shown in the image below).</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/583e9a01f5f04c21bf8aab6076a9c7b2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c4ce65e67924b4dad621155ea2feddfx1280x1085.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba1f5a2a582347afb38ed8caed29f128x1080x832.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0d84e0926304b85af097344a1440da7x963x1197.JPEG"
    ]
  },
  {
    "text": "A surgical team plans for liver transplantation in a child. As a part of the evaluation, you are asked to calculate the Child-Turcotte-Pugh score. Which of the following parameters would you not consider for the evaluation of this score?",
    "choices": [
      {
        "id": 1,
        "text": "Albumin"
      },
      {
        "id": 2,
        "text": "Bilirubin"
      },
      {
        "id": 3,
        "text": "Encephalopathy"
      },
      {
        "id": 4,
        "text": "Creatinine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Creatinine is not included </strong>in the<strong> Child&ndash;Turcotte&ndash;Pugh Score or Child-Pugh scoring system.</strong>&nbsp;Creatinine is used in the MELD score calculation.</p>\n<p>The variables taken into account for the calculation of the Child-Turcotte-Pugh score include <strong>serum bilirubin, albumin</strong>, <strong>prothrombin time</strong>, <strong>International Normalized ratio</strong>, and clinical signs suggestive of the presence of <strong>ascites</strong> and <strong>encephalopathy</strong>.&nbsp;</p>\n<p>The Child-Pugh score is a predictor of operative mortality in patients with cirrhosis and esophageal bleeding. It is now used to estimate a patient&rsquo;s overall prognosis.&nbsp;</p>\n<p>Alternative scores include the Model for End-Stage Liver Disease&nbsp;<strong>(MELD)&nbsp;</strong>and Pediatric End-Stage Liver Disease&nbsp;<strong>(PELD)</strong>&nbsp;models for all patients with chronic liver disease.&nbsp;The MELD score is calculated using serum sodium, serum creatinine, serum total bilirubin, and INR level.</p>\n<p>The PELD model for children&nbsp;<strong>under 12 years</strong>&nbsp;of age, includes both clinical and biochemical factors. It is predictive of disease severity and waiting list mortality in pediatric patients. The PELD score is calculated using the following variables:</p>\n<ul>\n<li>Albumin (g/dL)</li>\n<li>Bilirubin (mg/dL)</li>\n<li>INR</li>\n<li>Growth failure (based on gender, height, and weight)</li>\n<li>Age at listing</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a molecular biochemist working on genetic elements and the organization of human recombinant chimeric DNA (cDNA). In a sample of extracted DNA element, you determine the percentage of thymine residues to be 22%. What would be the expected percentage of cytosine?",
    "choices": [
      {
        "id": 1,
        "text": "28"
      },
      {
        "id": 2,
        "text": "22"
      },
      {
        "id": 3,
        "text": "36"
      },
      {
        "id": 4,
        "text": "44"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The percentage of cytosine in DNA will be&nbsp;<strong>28%.</strong></p>\n<p>According to <strong>Chargaff's rule</strong> in cellular<strong> DNA regardless </strong>of<strong> species,</strong></p>\n<p><strong>Purines = Pyrimidines</strong></p>\n<p>Sum of purine = Sum of pyrimidines i.e <strong>A+G=C+T. </strong></p>\n<p>In the question it is given that thymine is 22%, therefore adenine is also 22%.</p>\n<p>Hence adenine + thymine = 44% and&nbsp;Guanine + cytosine = 56%.&nbsp;</p>\n<p>No of Guanine = No of Cytosine, so the percentage of cytosine = 56/2 = 28%.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male patient presented with a cognitive deficit, involuntary hand and finger movements, and muscle incoordination. He was diagnosed with Huntington's chorea. Which brain structure marked in the given image shrinks rapidly in his condition?",
    "choices": [
      {
        "id": 1,
        "text": "B"
      },
      {
        "id": 2,
        "text": "A"
      },
      {
        "id": 3,
        "text": "D"
      },
      {
        "id": 4,
        "text": "C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features are suggestive of <strong>Huntington's disease.&nbsp;</strong>The<strong> caudate nucleus</strong>,<strong>&nbsp;</strong>which is marked<strong> \"A</strong>,<strong>\"&nbsp;</strong>shrinks dramatically in Huntington's disease and, if affected, is also a major cause of chorea movements.</p>\n<p>Huntington's disease (HD) is a degenerative disease of the caudate and putamen (&ldquo;striate neurons&rdquo;)&nbsp;caused by&nbsp;an autosomal dominant&nbsp;inheritance of a&nbsp;trinucleotide repeat (CAG)&nbsp;in the&nbsp;Huntington gene (chromosome 4),&nbsp;which results in&nbsp;chorea and dementia&nbsp;and which&nbsp;demonstrates anticipation. The caudate&nbsp;nucleus is dramatically atrophied, with accompanying atrophy of the putamen, cortex, and hydrocephalus ex vacuo of the 3<sup>rd</sup>&nbsp;ventricle. Commonly seen in the&nbsp;4<sup>th</sup>&nbsp;and 5<sup>th</sup>&nbsp;decade of life; motor problems (the characteristic chorea) precede dementia.</p>\n<p>Markings:</p>\n<p>A - Caudate nucleus</p>\n<p>B - Thalamus</p>\n<p>C - Globus pallidus</p>\n<p>D - Putamen</p>\n<p>The above image shows the coronal section of the brain with different parts of the basal ganglia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/76dcc155d9284ece93d6299a4795a93b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b8ce5c5e2f2b4212ba0353b3ba13bbd6x800x600.JPEG"
    ]
  },
  {
    "text": "A patient presented with a classical finding of pulsus parvus et tardus. Which of the following pressure-volume loops will be associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "D"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "B"
      },
      {
        "id": 4,
        "text": "A"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Pulsus parvus et tardus\u00a0</strong>(i.e. a weak and late pulse) is classically associated with <strong>aortic stenosis. </strong>Amongst the given pressure-volume loops, the one that corresponds to aortic stenosis is <strong>A. \u00a0</strong></p>\n<p>In aortic stenosis, as there is <strong>high outflow resistance</strong>, the <strong>pressure gradient</strong> across the aortic valve is <strong>increased.</strong> The <strong>stroke volume</strong> is also severely <strong>decreased </strong>as the ventricles are not completely emptied.</p>\n<p>The image given below shows pressure-volume loops in various valvular heart disorders.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8b088e42822b49e78a8653d89ef6a354.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/66e017e6fba04ed2b9c6d64ab9d508e6x1280x1407.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02b7cf5c0e4447d7b721da51ec2e9f22x1280x1668.JPEG"
    ]
  },
  {
    "text": "A 32-year-old lady with 30 weeks of pregnancy having an obstetric index of G2P1L1 presents to the emergency department with labor pain. A senior resident started the patient on the drug ritodrine to prevent preterm labor. This drug prevents labor by acting as _________",
    "choices": [
      {
        "id": 1,
        "text": "Oxytocin receptor antagonist"
      },
      {
        "id": 2,
        "text": "Beta-2 receptors agonist"
      },
      {
        "id": 3,
        "text": "Calcium channel blocker"
      },
      {
        "id": 4,
        "text": "Prostaglandin antagonist"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 830\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ritodrine is a selective <strong>beta-2 receptor agonist</strong>, which is used as a uterine relaxant to prevent preterm labour.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Specific tocolytic agents are:</p>\n<ul>\n<li>Beta 2 agonists\u00a0\n<ul>\n<li><strong>Ritodrine</strong></li>\n<li>Isoxsuprine</li>\n<li>Terbutaline</li>\n</ul>\n</li>\n<li>Calcium channel blockers: Eg.<strong> Nifedipine</strong></li>\n<li>Magnesium sulfate</li>\n<li><strong>Atosiban (oxytocin receptor antagonist)</strong></li>\n<li>Indomethacin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was brought in with a history of consumption of acid after overnight fasting. Which of the following images indicate the most likely area of injury to the gastric mucosa (red color indicates the area of injury)?",
    "choices": [
      {
        "id": 1,
        "text": "D"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "B"
      },
      {
        "id": 4,
        "text": "A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>As the patient in this scenario consumed acid (corrosive) after <strong>overnight fasting </strong>(i.e. on an empty stomach),\u00a0the maximum injury occurs to the<strong> lower half to two-thirds of the body</strong>, with sparing of the fundus.\u00a0</p>\n<p>In case of a <strong>food-filled stomach</strong>, the pathway that fluids (acid, alkali, water) take is known as\u00a0<strong>Magenstrasse.\u00a0</strong>It is present <strong>along the lesser curvature</strong> of the stomach, and this is where the greatest damage to gastric mucosa takes place, in corrosive injury.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7642da2234254b4bb034b6557bb96400.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/78aebb67c9e84db6a6a9e1fdd6a8e262x239x236.JPEG"
    ]
  },
  {
    "text": "Which among the following statements is true regarding the instrument shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Used for delivery in a platypelloid pelvis"
      },
      {
        "id": 2,
        "text": "Most commonly used for rotational delivery"
      },
      {
        "id": 3,
        "text": "Most commonly used forceps in outlet delivery"
      },
      {
        "id": 4,
        "text": "It is used in the delivery of aftercoming head in breech"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows <strong>Piper's forceps</strong>, identified by its <strong>distinct perineal curve</strong>. It is\u00a0used to assist the <strong>delivery of the after-coming head</strong> of breech.</p>\n<p>It has a cephalic curve, reverse pelvic curve, long parallel shanks that permit the baby\u2019s body to rest against it during head delivery.</p>\n<p>It maybe applied electively or when the Mauriceau manoeuvre cannot be accomplished easily.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a9c6410b55a649b9871a12e1d808d77c.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old female patient needs to undergo cataract surgery. Before initiating the surgery, the following procedure is performed. What is the most common complication seen in the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Proptosis"
      },
      {
        "id": 2,
        "text": "Subconjunctival hemorrhage"
      },
      {
        "id": 3,
        "text": "Optic nerve damage"
      },
      {
        "id": 4,
        "text": "Retrobulbar hemorrhage"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The most common complication seen in the procedure of retrobulbar block is <strong>retrobulbar haemorrhage</strong>.</p>\n<p style=\"text-align: justify;\">The image shown above depicts the&nbsp;technique of <strong>retrobulbar block </strong>which is a regional anaesthesia technique used in ophthalmic surgery. It involves the injection of a local anaesthetic into the extraocular muscle cone. The <strong>needle penetrates</strong> the <strong>lower lid</strong> at the junction of the<strong> middle </strong>and<strong> lateral one-third </strong>of the orbit.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5eb4eeb027f8404bbbb71475c1295991.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 49-year-old male patient who had a myocardial infarction has a characteristic finding of Beau's line. Which of the following images accurately depict that finding?",
    "choices": [
      {
        "id": 1,
        "text": "Image D"
      },
      {
        "id": 2,
        "text": "Image C"
      },
      {
        "id": 3,
        "text": "Image B"
      },
      {
        "id": 4,
        "text": "Image A"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Image B shows&nbsp;<strong>Beau&rsquo;s line, </strong>which are transverse grooves that are present on the nail and may be full or partial thickness through the nail. Transverse grooves may occur due to trauma, inflammation or neurological event, reflecting an acute systemic event (like MI, measles, mumps or pneumonia)</p>\n<p>Other options :</p>\n<ul>\n<li>Image A - Terry's Nails</li>\n<li>Image C - Mees Lines</li>\n<li>Image D - Lindsay's Nails</li>\n</ul>\n<p>&nbsp;</p>\n<p><strong>Terry's nails</strong> are a type of apparent leukonychia of nearly the entire nail, obliteration of the lunula, and a narrow band of normal, pink nail bed at the distal border.</p>\n<p>Leukonychia striata also called as <strong>Mees lines</strong> or <strong>Aldrich&ndash;Mees lines </strong>which appear after an episode of poisoning with <strong>arsenic</strong>, <strong>thallium,</strong> or other heavy metals, and can also appear if the subject is suffering from <strong>renal failure</strong>.</p>\n<p><strong>Lindsay's nails</strong>, also known as Half and half nails show the proximal portion of the nail white and the distal half red, pink, or brown, with a sharp line of demarcation between the two halves. It is a rare but special clinical finding seen in chronic renal failure with a prevalence of 15-50%. It can also be seen in yellow nail syndrome, Crohn's disease, Kawasaki's disease, Behcet's disease, cirrhosis, hyperthyroidism, zinc deficiency, citrullinemia, pellagra, HIV infection, and even in healthy persons.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/26fab22d82994025b15af43932781a00.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Centor criteria/score is used for the diagnosis of which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Streptococcal pharyngitis"
      },
      {
        "id": 2,
        "text": "Staphylococcal pharyngitis"
      },
      {
        "id": 3,
        "text": "Gonococcal pharyngitis"
      },
      {
        "id": 4,
        "text": "Viral pharyngitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Centor criteria are used to identify the likelihood of <strong>Group A Streptococcal (GAS) pharyngitis</strong>.</p>\n<p>They include the following:</p>\n<ul>\n<li>Absence of cough (1 point)</li>\n<li>Tonsillar exudate (1 point)</li>\n<li>Anterior cervical lymphadenopathy (1 point)</li>\n<li>Fever (1 point)</li>\n</ul>\n<p>A score of</p>\n<ul>\n<li>0-1 - GAS infection unlikely</li>\n<li>4 - likely</li>\n</ul>\n<p>In adults, the positive predictive value of these criteria is <strong>around 40% if 3 criteria</strong> are met and about <strong>50% if 4 criteria are met</strong>.</p>\n<p><strong>Mnemonic</strong></p>\n<p>C- Cough not present</p>\n<p>E- Exudates</p>\n<p>N- Nodes</p>\n<p>T- Temperature</p>\n<p>(OR)</p>\n<p>Other diagnostic Methods</p>\n<ul>\n<li>Group A beta-hemolytic streptococcal<strong> rapid antigen detection test</strong> (preferred diagnostic method in emergency settings)</li>\n<li><strong>Throat culture </strong>(criterion standard for diagnosis of GAS infection [90-99% sensitive]).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Neet Mini - 15 (20 Q)';
        const quizFilename = 'neet-mini-15-20-q-30aa2246.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>