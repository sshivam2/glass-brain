<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>22 Disorders Of Visual Pathway And Pupillary Reflexes - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following forms the third-order neurons in the visual pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Bipolar cells"
      },
      {
        "id": 2,
        "text": "From the lateral geniculate body"
      },
      {
        "id": 3,
        "text": "Ganglion cells"
      },
      {
        "id": 4,
        "text": "Optic tract"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Third-order neurons</strong> in the visual pathway are the <strong>ganglion cells.</strong></p>\n<p>The afferent neuronal impulses are carried in the following manner:</p>\n<p>Photoreceptors (I) &rArr; Bipolar cells (II) &rArr; <strong>Ganglion cells (III)</strong> &rArr; Lateral geniculate body (IV).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 41-year-old woman with a known pituitary microadenoma presented with sudden-onset visual disturbances, headache, and hypotension during the second trimester of pregnancy. What is the visual field defect this patient is most likely to experience?",
    "choices": [
      {
        "id": 1,
        "text": "Superio-temporal quadrantanopia"
      },
      {
        "id": 2,
        "text": "Ipsilateral homonymous hemianopia"
      },
      {
        "id": 3,
        "text": "Contralateral homonymous hemianopia"
      },
      {
        "id": 4,
        "text": "Heteronymous hemianopia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>pituitary apoplexy</strong> in pregnancy\u00a0This acute onset event is almost always associated with compression at the <strong>level of optic chiasma</strong> causing <strong>heteronymous hemianopia (bitemporal hemianopia).</strong></p>\n<p>Pituitary apoplexy results from <strong>hemorrhagic infarction</strong> of a <strong>pre-existing pituitary adenoma</strong> or within a physiologically enlarged gland, which is well documented in pregnancy.</p>\n<p>The nasal fibers of each retina cross through the chiasma. <strong>Slow-growing microadenomas</strong> compress lower nasal optic fibers causing <strong>superior temporal quadrantanopia</strong> initially, before progressing to bitemporal hemianopia. <strong>However,</strong> an <strong>abrupt infarction or hemorrhage</strong> of a pre-existing pituitary adenoma will lead to <strong>rapid progression</strong> of the visual defect.</p>\n<p>Heteronymous hemianopia is the loss of half of the visual field on different sides in both eyes. It is separated into two categories:</p>\n<ul>\n<li>Binasal hemianopia \u2013 the loss of the fields surrounding the nose</li>\n<li>Bitemporal hemianopia \u2013 the loss of the fields closest to the temples.</li>\n</ul>\n<p>Common causes of bitemporal hemianopia<strong> </strong>due to<strong> </strong><strong>central chiasmal lesions</strong> are as follows:</p>\n<ul>\n<li>Suprasellar aneurysms</li>\n<li><strong>Tumors of the\u00a0pituitary gland</strong></li>\n<li>Craniopharyngioma</li>\n<li>Suprasellar meningioma</li>\n<li>Glioma of the third ventricle</li>\n</ul>\n<p>Other visual defects according to the site of the lesion are as follows:</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82fff55164f84c7fbe1d9e7ddf4371e1x1280x2202.PNG"
    ]
  },
  {
    "text": "Which of the following cannot be tested with monocular visual field testing using a pin with a red pinhead?",
    "choices": [
      {
        "id": 1,
        "text": "Central scotoma"
      },
      {
        "id": 2,
        "text": "Paracentral scotoma"
      },
      {
        "id": 3,
        "text": "Temporal field defects"
      },
      {
        "id": 4,
        "text": "Peripheral field defects"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Central scotoma, paracentral scotoma</strong> and <strong>temporal field defects</strong> can be tested by monocular visual field testing with a red-headed neurological pin.</p>\n<p>A patient who has central scotoma will either not see the pinhead in the centre of the field or perceive it black. This can be defined by moving the pin outwards in four different directions until the patient sees the pinhead as being red.</p>\n<p>Placing the pin in each of the quadrants close to the centre and checking if the patient sees the red pinhead can detect a paracentral scotoma. This can also detect temporal field defects.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lesion in which of the following structures is most likely to result in congruous homonymous hemianopia?",
    "choices": [
      {
        "id": 1,
        "text": "Optic nerve"
      },
      {
        "id": 2,
        "text": "Optic chiasma"
      },
      {
        "id": 3,
        "text": "Optic tract"
      },
      {
        "id": 4,
        "text": "Occipital cortex"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Congruous homonymous hemianopia is most suggestive of a lesion in the occipital cortex.</p>\n<p><strong>Homonymous</strong> <strong>hemianopia</strong>&nbsp;involves vision loss on the <strong>same side of the visual field in both eyes</strong>. This type of visual field loss is suggestive of a lesion posterior to the optic chiasma in the visual pathway.</p>\n<p>Complete homonymous hemianopia involves the complete visual hemifields of both eyes and can occur with any large enough lesion posterior to the optic chiasma. Visual field examination alone cannot further localize the lesion in such cases.</p>\n<p><strong>Incomplete</strong> <strong>homonymous</strong> <strong>hemianopia</strong> is due to smaller lesions in the visual pathway posterior to the optic chiasm. They are further divided into congruous and incongruous depending on the extent to which the defects in the two half fields match each other exactly.</p>\n<p>Because of a&nbsp;relative <strong>disorder</strong> <strong>among axon bundles</strong> in the immediate post-chiasmal region, diseases in this location produce rather <strong>incongruent</strong> lesions.</p>\n<p>More posteriorly, the axon bundles of the corresponding areas of the two hemifields are more closely aligned and hence, lesions of the <strong>occipital cortex</strong> produce&nbsp;<strong>congruous homonymous hemianopia</strong> while <strong>incongruous homonymous hemianopia</strong> is more likely seen with <strong>optic tract lesions</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman presented with a persistent headache for the past few months. On evaluation, her vision on Snellen's chart was 6/6 in both eyes. The fundus also appears to be normal. Visual field charting shows a bitemporal visual field defect. Site of the lesion is _________",
    "choices": [
      {
        "id": 1,
        "text": "Prelaminar optic nerve"
      },
      {
        "id": 2,
        "text": "Optic nerve juxta lamina cribrosa"
      },
      {
        "id": 3,
        "text": "Optic chiasma"
      },
      {
        "id": 4,
        "text": "Optic tract"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The site of the lesion is<strong> optic chiasma.&nbsp;</strong>Lesions at the chiasma&nbsp;characteristically produce&nbsp;<strong>bitemporal field defects</strong> due to the decussation of <strong>nasal</strong> fibres.</p>\n<p>In <strong>retrochiasmal</strong> lesions, <strong>homonymous hemianopia</strong> is seen. Further, in cortical lesions,&nbsp;<strong>macular (central) vision</strong> is spared.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young patient with visual disturbances was found to have a brain tumour. He was referred to ophthalmology for a complete visual field assessment before planning his resection. Humprey analyzer revealed the following plot. What is the most likely site of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Optic tract"
      },
      {
        "id": 2,
        "text": "Lateral geniculate body"
      },
      {
        "id": 3,
        "text": "Parietal lobe"
      },
      {
        "id": 4,
        "text": "Temporal lobe"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The visual field defect shown is the typical&nbsp;<strong>\"pie in the sky\"</strong> defect or <strong>superior&nbsp;quadrantic hemianopia.&nbsp;</strong>They are produced when the <strong>inferior fibers</strong> of the optic radiations in the <strong>temporal </strong>lobe (<strong>Meyer's loop)</strong> are involved.</p>\n<p><strong>\"Pie in the floor\"</strong> defects refer to <strong>inferior</strong> <strong>quadrantic hemianopia.</strong> It is seen in the involvement of the <strong>superior fibers</strong> of optic radiations in the&nbsp;<strong>parietal</strong> lobe (<strong>Baum's</strong>&nbsp;<strong>loop</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/73e45e019afa44639fa7ddb229ee3587.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The primary visual cortex is located in the _______________.",
    "choices": [
      {
        "id": 1,
        "text": "Superior temporal sulcus"
      },
      {
        "id": 2,
        "text": "Parieto-occipital sulcus"
      },
      {
        "id": 3,
        "text": "Posterior part of calcarine sulcus"
      },
      {
        "id": 4,
        "text": "Central sulcus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> primary visual cortex</strong>( Brodmann <strong>area 17</strong>) is located in the <strong>posterior part of the calcarine sulcus in the occiptal lobe.</strong></p>\n<p>Accessory visual areas are area 18 (secondary) and area 19 (tertiary).</p>\n<p>&nbsp;</p>\n<p>Image: Brodman areas</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/525dd2dde4ff4911be076bdcdb2cbc6ex1280x1037.JPEG"
    ]
  },
  {
    "text": "A 72-year-old lady was brought by her son with bilateral loss of vision for 3 days, associated with slurred speech. It was preceded by an occipital headache. Despite her obvious blindness, illustrated by her walking into objects, the patient denied visual loss. MRI revealed bilateral occipital infarcts. Which of the following statement is true regarding the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Direct and consensual reflexes are absent in both eyes."
      },
      {
        "id": 2,
        "text": "Direct and consensual reflexes are present in both eyes."
      },
      {
        "id": 3,
        "text": "Direct reflex is present but consensual reflex is absent."
      },
      {
        "id": 4,
        "text": "Consensual reflex is present but direct reflex is absent."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>cortical blindness</strong> with visual anosognosia (<strong>Anton syndrome</strong>). Since <strong>anterior visual pathways are not affected</strong> in cortical blindness, <strong>direct and consensual light reflexes</strong> are<strong> preserved.</strong></p>\n<p>Cortical blindness is usually associated with bilateral <strong>occipital infarcts</strong> where it is supplied by the posterior cerebral arteries and these infarcts usually involve both the primary visual cortex and visual association area. It is secondary to <strong>damage to the visual pathways posterior to the lateral geniculate nuclei</strong>; anterior visual pathways are intact. Visual field defects can vary depending on the extent and location of the infarct.</p>\n<p>Direct and consensual reflexes are present in both eyes in cortical blindness as pupillary light reflex fibers&nbsp;exit the visual pathway at the level of the superior colliculus. They exit the optic tract before the lateral geniculate body (LGB) to reach the center&nbsp;for pupillary light reflex- <strong>p</strong><strong>retectal nucleus</strong>&nbsp;at the midbrain.</p>\n<p>Note:&nbsp;<strong>Anton syndrome</strong> is visual anosognosia (denial of loss of vision) associated with confabulation (defined as the emergence of memories of events and experiences which never took place) in the setting of obvious visual loss and cortical blindness.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A neurology resident is demonstrating spinal reflexes in a comatose patient. When he pinches the skin over the side of the patient's neck, there is a rapid dilatation of the ipsilateral pupil. Which of the following forms the efferent limb of this reflex?",
    "choices": [
      {
        "id": 1,
        "text": "Cholinergic fibres of oculomotor nerve"
      },
      {
        "id": 2,
        "text": "Adrenergic fibres of oculomotor nerve"
      },
      {
        "id": 3,
        "text": "Sympathetic fibres of cervical ganglion"
      },
      {
        "id": 4,
        "text": "Motor fibres of trigeminal nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario describes <strong>cilio-spinal reflex.&nbsp;Sympathetic fibers of cervical ganglion </strong>form the efferent limb of this reflex.</p>\n<p>Cilio-spinal reflex:</p>\n<ul>\n<li><strong>Afferent</strong> inputs of this reflex are carried by the <strong>trigeminal</strong> nerve or cervical pain fibers (lateral spinothalamic tract).</li>\n<li>It <strong>synapses</strong> at the <strong>ciliospinal center of Budge</strong>, located at C8 to T2 in the intermediolateral (IML) horn of the gray matter of the spinal cord.</li>\n<li>The <strong>efferent</strong> branch of the reflex consists of:\n<ul>\n<li><strong>Preganglionic</strong>&nbsp;<strong>sympathetic</strong> <strong>fibers</strong> from the upper thoracic and lower cervical spinal cord which&nbsp;goes to the cervical sympathetic chain and its three ganglia.</li>\n<li aria-level=\"1\">The <strong>postganglionic sympathetic fibers</strong> pass on the surface of the internal carotid artery and join the ophthalmic nerve at the cavernous sinus. Here, it passes through the nasociliary nerve to reach the ciliary body and innervates the <strong>dilator pupillae</strong> muscles, causing dilatation of the pupil.</li>\n</ul>\n</li>\n</ul>\n<p>This reflex is absent in Horner's syndrome and in lesions involving the cervical sympathetic fibers and it is enhanced in patients with cluster headache and barbiturate-induced coma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not part of the pupillary light reflex pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Edinger-Westphal nucleus"
      },
      {
        "id": 2,
        "text": "Lateral geniculate body"
      },
      {
        "id": 3,
        "text": "Pretectal nucleus"
      },
      {
        "id": 4,
        "text": "Ganglion cells in retina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The lateral geniculate body is <strong>not</strong> a part of the pupillary reflex pathway. It is part of the accommodation reflex and the visual pathway.</p>\n<p><strong>Pupillary light reflex pathway:</strong></p>\n<ul>\n<li><strong>First</strong>&nbsp;<strong>neurons</strong>&nbsp;(sensory) connects each retina with both <strong>pretectal nuclei</strong> in the <strong>midbrain</strong> at the level of the <strong>superior colliculi</strong>.</li>\n<li><strong>Second neurons</strong> (internuncial) connects each pretectal nucleus to both <strong>Edinger&ndash;Westphal nuclei.</strong></li>\n<li><strong>Third</strong>&nbsp;<strong>neurons</strong>&nbsp;(preganglionic motor) connects the Edinger&ndash;Westphal nucleus to the <strong>ciliary ganglion.</strong></li>\n<li><strong>Fourth neurons</strong> (postganglionic motor) leaves the ciliary ganglion and passes in the <strong>short ciliary nerves</strong> to innervate the <strong>sphincter pupillae</strong>.</li>\n</ul>\n<p><strong>Image</strong>: Pupillary reflex pathways</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/19ca744ed1e648de8dc46618eb34c6e4x1280x1813.JPEG"
    ]
  },
  {
    "text": "A patient presented with diplopia to the casualty. On examination, the left pupil was dilated. Both direct and consensual light reflexes were lost in the affected eye. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "II nerve palsy"
      },
      {
        "id": 2,
        "text": "III nerve palsy"
      },
      {
        "id": 3,
        "text": "V nerve palsy"
      },
      {
        "id": 4,
        "text": "VII nerve palsy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical situation suggests that the patient has <strong>III&nbsp;nerve</strong>&nbsp;(<strong>oculomotor nerve</strong>) palsy.</p>\n<p>Absence of contraction of the pupil in both direct and consensual reflex suggests a <strong>lesion in the efferent pathway</strong> of the affected eye. This is <strong>III&nbsp;nerve/oculomotor palsy</strong>.</p>\n<p>Light reflex consists of direct and consensual reflexes.<strong><br /></strong></p>\n<p>When light is shone in an eye,</p>\n<ul>\n<li>Constriction of the pupil of the same eye is called <strong>direct reflex.</strong></li>\n<li>Constriction of the contralateral pupil is called <strong>consensual reflex/indirect reflex</strong></li>\n</ul>\n<p>For the light reflex,</p>\n<ul>\n<li>Afferent nerve fiber is the II&nbsp;cranial nerve (optic nerve).</li>\n<li>Efferent nerve fiber is the III&nbsp;cranial nerve (oculomotor nerve)-Bilaterally</li>\n</ul>\n<p>In II nerve palsy, there will be a loss of direct reflex in the affected eye and loss of consensual light reflex in the opposite eye.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient came with a history of unprotected sexual intercourse around 20 years ago. Now, he complains of neurological symptoms and visual disturbances. Which of the following will be seen on exposure of his pupils to light?",
    "choices": [
      {
        "id": 1,
        "text": "Pupils react but do not accommodate."
      },
      {
        "id": 2,
        "text": "Pupils accommodate but do not react."
      },
      {
        "id": 3,
        "text": "Pupils neither react not accommodate."
      },
      {
        "id": 4,
        "text": "Pupils react and accommodate."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient most likely has acquired syphilis due to unprotected sex and has developed&nbsp;neurological and visual disturbances secondarily as a complication of <strong>neurosyphilis</strong>. <strong>Argyll-Robertson</strong> pupils(ARP)<strong>&nbsp;</strong>are seen associated with neurosyphilis&nbsp;where the <strong>pupils accommodate but do not react to light</strong>.</p>\n<p><strong>Argyll Robertson pupil</strong> is attributed to a dorsal midbrain lesion of neurosyphilis that affects the pupillary light pathway but spares the more ventrally placed pupillary near reflex pathway(Accomdation pathway), thereby causing a <strong>light-near dissociation</strong>.</p>\n<p>Features of<strong> Argyll Robertson pupil (ARP)&nbsp;</strong>include:</p>\n<ul>\n<li>Bilateral<strong> small, irregular pupils&nbsp;</strong>in dim light</li>\n<li><strong>A</strong>ccommodation&nbsp;<strong>R</strong>eflex&nbsp;<strong>P</strong>resent (ARP)- The eye accomdates by constricting the pupil for a near target.</li>\n<li><strong>Light Reflex absent</strong>: pupils do<span class=\"st\">&nbsp;not constrict when exposed to bright light.</span></li>\n<li><strong>Cocaine</strong> eye drops(mydriatics) induced <strong>mydriasis</strong>.</li>\n</ul>\n<p>Other clinical features in neurosyphilis:</p>\n<ul>\n<li style=\"text-align: left;\">Fleeting and repetitive lancinating pains, primarily in the legs</li>\n<li style=\"text-align: left;\">acute abdominal pain with vomiting(visceral crisis)</li>\n<li style=\"text-align: left;\">Tabes dorsalis with Ataxia and gait disturbances due to loss of position sense</li>\n<li style=\"text-align: left;\">Loss of reflexes in the legs</li>\n<li style=\"text-align: left;\">Paresthesias, bladder disturbances</li>\n</ul>\n<p>Other causes of <strong>light-near dissociation</strong> are:</p>\n<p>In <strong>unilateral</strong> eye</p>\n<div class=\"page\" title=\"Page 787\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ol>\n<li><strong>Adie pupil</strong></li>\n<li>Herpes zoster ophthalmicus</li>\n<li>Aberrant regeneration of the third cranial nerve</li>\n</ol>\n<p>In <strong>bilateral</strong> eyes</p>\n<ol>\n<li>Neurosyphilis</li>\n<li>Type 1 diabetes mellitus</li>\n<li>Myotonic dystrophy</li>\n</ol>\n<p>Note: <strong>Adie's pupil</strong> more commonly manifests in <strong>young women</strong> with <strong>unilateral</strong> <strong>large</strong> regular pupil(Anisocoria) with <strong>absent light reflex</strong> and <strong>sluggish&nbsp;</strong>and <strong>tonic</strong>&nbsp;<strong>accomdation reflex</strong>.</p>\n<p>It is caused by post-ganglionic <strong>parasympathetic</strong> pupillary supply <strong>damage</strong> and is usually associated with <strong>absent knee jerk</strong>.</p>\n<p>Adie's pupil <strong>constricts</strong> with <strong>weak pilocarpine</strong> (0.1%) drops, while normal pupil and <strong>Argyll robertson pupil</strong> does <strong>not</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following would you suspect in a patient who presents with small pupils?",
    "choices": [
      {
        "id": 1,
        "text": "Carbon monoxide poisoning"
      },
      {
        "id": 2,
        "text": "Ethylene glycol poisoning"
      },
      {
        "id": 3,
        "text": "Holmes\u2013Adie pupil"
      },
      {
        "id": 4,
        "text": "Pontine hemorrhage"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Pontine hemorrhage</strong> is associated with small pupils.&nbsp;The remaining options, namely, carbon monoxide poisoning, ethylene glycol poisoning, and Holmes&ndash;Adie pupil, cause dilation of the pupils.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 67-year-old woman finally decides to get glasses, about thirty years after she actually needed them, and goes to an optometrist for an eyeglass prescription. Her eye examination reveals some unexpected findings. The pupils were small. When a pen-light is shone on to her eyes, neither pupil contracts. However, when the optometrist brings his fingers towards her face, both pupils constrict dramatically. What is the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anisocoria"
      },
      {
        "id": 2,
        "text": "Adie's pupil"
      },
      {
        "id": 3,
        "text": "Internal ophthalmoplegia"
      },
      {
        "id": 4,
        "text": "Argyll-Robertson pupil"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical situation of bilateral small irregular pupils with light-near dissociation suggests a diagnosis of&nbsp;<strong>Argyll Robertson pupil</strong>.</p>\n<p><strong>Features of Argyll Robertson pupil (ARP):</strong></p>\n<ul>\n<li><strong>A</strong>ccommodation <strong>R</strong>eflex <strong>P</strong>resent (ARP)</li>\n<li>Light Reflex absent</li>\n<li>Constricted pupil</li>\n<li>An example of&nbsp;<strong>light near dissocation.</strong></li>\n<li>Seen in neurosyphilis</li>\n</ul>\n<p><strong>Option A</strong>:&nbsp;<strong>Anisocoria</strong> is when the pupils are <strong>not of the same size</strong>.</p>\n<p><strong>Option B:&nbsp;</strong><strong>Adie's tonic pupil</strong></p>\n<ul>\n<li>Light reflex absent or sluggish.</li>\n<li>Near reflex:&nbsp;<strong>Slow and tonic</strong></li>\n<li>Pupil is larger</li>\n<li>Constricts with weak pilocarpine.</li>\n</ul>\n<p><strong>Option C:&nbsp;</strong><strong>Ophthalmoplegia interna</strong></p>\n<ul>\n<li>Dilated paralyzed pupil</li>\n<li>Does <strong>not respond to light or accommodation</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Wernicke's hemianopic pupil is due to a lesion in the _______.",
    "choices": [
      {
        "id": 1,
        "text": "Optic radiation"
      },
      {
        "id": 2,
        "text": "Optic tract"
      },
      {
        "id": 3,
        "text": "Optic chiasma"
      },
      {
        "id": 4,
        "text": "Lateral geniculate body"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Wernicke's</strong> <strong>hemianopic pupil</strong> is due to a&nbsp;lesion in the<strong> optic tract.</strong></p>\n<p>The <strong>optic tracts</strong> contain both<strong> visual and pupillomotor fibers</strong>.</p>\n<p>The <strong>visual fibers</strong> terminate in the <strong>lateral geniculate body,</strong> but the <strong>pupillary fibers</strong> leave the optic tract anterior to the lateral geniculate body, projecting through the brachium of the superior colliculus to<strong> terminate in the pretectal nuclei</strong>.</p>\n<p>An optic tract lesion may,&nbsp;therefore, give rise to an <strong>afferent pupillary conduction defect</strong>.</p>\n<p>Characteristically, the<strong> pupillary light reflex will be normal</strong> when the<strong> unaffected hemiretina</strong> is stimulated and <strong>absent,</strong> when the involved<strong> hemiretina is stimulated</strong> (i.e., light is shone from the hemianopic side).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following pupillary abnormalities is most likely to be observed in a patient with primary open-angle glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Marcus Gunn pupil"
      },
      {
        "id": 2,
        "text": "Adie\u2019s tonic pupil"
      },
      {
        "id": 3,
        "text": "Argyll-Robertson pupil"
      },
      {
        "id": 4,
        "text": "Hutchinson's pupil"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Primary open-angle glaucoma</strong>&nbsp;commonly causes bilateral and <strong>asymmetric </strong>optic nerve damage.<strong>&nbsp;</strong>Marcus Gunn pupil also known as&nbsp;<strong>relative afferent pupillary defect </strong>(RAPD) is&nbsp;the&nbsp;<strong>earliest sign</strong>&nbsp;of&nbsp;<strong>optic nerve disease&nbsp;</strong>as seen in <strong>optic nerve neuritis</strong> or <strong>primary open-angle glaucoma</strong>(POAG).</p>\n<p>RAPD is caused due to a <strong>defect </strong>in the<strong> afferent pathway</strong>&nbsp;(optic nerve) of the pupillary<strong> light reflex </strong>in <strong>one eye.</strong></p>\n<p>It is diagnosed by the <strong>swinging flashlight test</strong>&nbsp;where the flashlight is swung to and fro, and the pupillary response is observed.&nbsp;<strong>Normally,</strong> <strong>both</strong> pupils <strong>constrict</strong>&nbsp;when any one eye is stimulated (due to direct and consensual light reflex).<strong>&nbsp;</strong>In the presence of <strong>RAPD</strong>,&nbsp;<strong>both pupils&nbsp;</strong>will&nbsp;abnormally&nbsp;<strong>dilate</strong>&nbsp;when the&nbsp;<strong>affected eye</strong>&nbsp;is&nbsp;<strong>stimulated</strong>. This paradoxical response of the pupil to light is called <strong>Marcus Gunn pupil.&nbsp;</strong></p>\n<p><strong>Causes of RAPD:</strong></p>\n<ul>\n<li>Optic nerve lesions (e.g.All types of <strong>optic neuritis</strong>,&nbsp;<strong>glaucoma</strong>)</li>\n<li>Optic tract lesions (e.g., infarction)</li>\n<li>Severe retinal disease (e.g., <strong>central retinal artery occlusion</strong>, extensive retinal detachment)</li>\n<li>Maculopathy (macular degeneration )</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: <strong>Adie tonic pupil </strong>is a <strong>unilateral</strong> dilated pupil with&nbsp;<strong>light-near dissociation</strong> due to postganglionic parasympathetic pupillomotor nerve supply damage. In these patients the <strong>light reflex</strong> is <strong>absent</strong> and the <strong>accomdation</strong> (near) <strong>reflex</strong> is <strong>sluggish</strong>. It is commonly seen in <strong>young females</strong> and is associated with <strong>absent knee jerk</strong>.</p>\n<p>Option C: <strong>Argyll Robertson pupils</strong>&nbsp;are <strong>bilateral</strong> small pupils with <strong>light-near dissociation</strong>. It is commonly seen in patients with <strong>neurosyphilis.</strong>&nbsp;In these patients the <strong>p</strong>upillary <strong>r</strong>eflex is <strong>a</strong>bsent&nbsp;but the <strong>a</strong>ccommodation <strong>r</strong>eflex is <strong>p</strong>resent (<strong>ARP</strong>).</p>\n<p>Option D: <strong>Hutchinson's pupil&nbsp;</strong>is a clinical sign where&nbsp;the <strong>pupil</strong> on the <strong>side</strong> of an <strong>intracranial mass</strong> lesion is <strong>dilated</strong> and <strong>unreactive to light</strong>, due to compression of the <strong>oculomotor nerve</strong> on that side.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The casualty intern noticed that a patient had unequal pupils. The anisocoria was greater under light. Which of the following drugs would be helpful in quickly differentiating between the potential causes?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 4 and 5"
      },
      {
        "id": 2,
        "text": "2 and 3 only"
      },
      {
        "id": 3,
        "text": "1 , 4 and 5"
      },
      {
        "id": 4,
        "text": "1, 3 and 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Anisocoria greater in the light</strong> indicates the large pupil to be abnormal due to poor pupillary contraction from a parasympathetic abnormality. Among the given options, <strong>1% pilocarpine</strong> and <strong>0.1% pilocarpine</strong> can be used to differentiate fixed dilated pupil.&nbsp;</p>\n<p>Mydriasis due to neurologic origin <strong>(3rd nerve palsy)</strong> responds readily to <strong>1%</strong>&nbsp;pilocarpine, whereas there will be no response if the dilation is due to <strong>anticholinergic causes</strong>. Pupillary constriction to&nbsp;<strong>0.1%</strong> pilocarpine diagnoses <strong>Adie's pupil</strong> (due to denervation hypersensitivity). Application of 0.1% pilocarpine shows no response in other conditions or in the normal eye.</p>\n<p>Example: A person presenting with dilated pupil following accidental application or inadvertent rubbing of atropine or antimuscarinic alkaloids from wild plants into the eye will not constrict in response to topical application of&nbsp;1% Pilocarpine. But the patient showing dilation due to 3rd nerve palsy shows pupillary constriction in response to pupillary instillation of 1% pilocarpine.</p>\n<p><strong>Note</strong>: Cocaine and phenylephrine are used in <strong>anisocoria that is greater in the dark</strong>&nbsp;to diagnose Horner&rsquo;s syndrome. In these patients, the small <strong>pupil fails to dilate</strong>&nbsp;even after the instillation of cocaine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old lady with advanced spondylosis underwent cervical vertebral fusion surgery.  In the post-operative room, the resident noted that her pupils were unequal.  Which of the following features would rule out the possibility of Horner's syndrome in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Enophthalmos"
      },
      {
        "id": 2,
        "text": "Dilatation lag"
      },
      {
        "id": 3,
        "text": "Mydriasis"
      },
      {
        "id": 4,
        "text": "Reverse ptosis of lower lid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Horner's syndrome</strong> causes all the following <strong>except mydriasis</strong>. It <strong>causes miosis</strong>.</p>\n<p><strong>Horner's syndrome (oculosympathetic palsy)</strong></p>\n<p>The <strong>majority</strong> of the cases are <strong>unilateral</strong>.</p>\n<p><strong>Causes</strong> of <strong>bilateral</strong> involvement include <strong>cervical spine injuries</strong> and <strong>autonomic diabetic neuropathy</strong>.</p>\n<p><strong>Painful</strong> Horner syndrome, especially of <strong>acute onset</strong>, should raise the possibility of <strong>carotid dissection</strong>.</p>\n<p><strong>Clinical features</strong></p>\n<ul>\n<li>Mild <strong>ptosis</strong> (usually 1&ndash;2 mm) as a result of weakness of M&uuml;ller muscle</li>\n<li>Anisocoria is accentuated in dim light</li>\n<li>Pupillary constriction to light and near stimuli is normal.</li>\n<li><strong>Hypochromic</strong> <strong>heterochromia</strong> (lighter color iris on affected side); in congenital cases.</li>\n<li>Mild ptosis (Mullers muscle is affected)</li>\n<li><strong>Reduced</strong> ipsilateral <strong>sweating&nbsp;</strong>(only if the lesion is <strong>below</strong> the <strong>superior cervical ganglion</strong>)</li>\n</ul>\n<p><strong>Pharmacological tests</strong></p>\n<ul>\n<li><strong>Hydroxyamphetamine</strong> and <strong>adrenaline</strong> may be used to differentiate a preganglionic&nbsp;from a postganglionic lesion.</li>\n<li><strong>Phenylepherine</strong>&nbsp;(1%)&nbsp;\n<ul>\n<li>Result: In an <strong>established (10 days) postganglionic lesion</strong>, the <strong>Horner pupil will dilate</strong> and ptosis may be temporarily relieved. A central or preganglionic Horner pupil and a normal pupil will not dilate or will dilate minimally.</li>\n<li>Explanation: In postganglionic Horner's syndrome, the dilator pupillae muscle develops denervation hypersensitivity to adrenergic neurotransmitters due to its dysfunctional local motor nerve.</li>\n</ul>\n</li>\n<li><strong>Apraclonidine</strong>&nbsp;(0.5% or 1.0%)\n<ul>\n<li>Result: A Horner pupil will dilate, but a normal pupil is essentially unaffected.</li>\n<li>Explanation: Alpha-1 receptors are upregulated in the denervated dilator pupillae.</li>\n</ul>\n</li>\n<li><strong>Cocaine</strong>&nbsp;(4%) is instilled into both eyes\n<ul>\n<li>Result: The normal pupil will dilate, but the Horner pupil will not.</li>\n<li>Explanation: Cocaine <strong>blocks the re-uptake of noradrenaline</strong> secreted at the postganglionic nerve ending, which accumulates and <strong>causes dilatation</strong> of a normal pupil. <strong>In Horner's syndrome</strong>, there is <strong>no noradrenaline</strong> being secreted, so cocaine has no effect.</li>\n</ul>\n</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where is the cell body of the second-order neuron in the sympathetic pathway for the pupil?",
    "choices": [
      {
        "id": 1,
        "text": "Middle cervical ganglion"
      },
      {
        "id": 2,
        "text": "Superior cervical ganglion"
      },
      {
        "id": 3,
        "text": "Ciliospinal center of Budge"
      },
      {
        "id": 4,
        "text": "Ciliary ganglion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The cell body of the second-order neuron in the sympathetic pathway for the pupil lies at the ciliospinal center of Budge (C8&ndash;T1).</p>\n<p>The sympathetic pathway to the iris muscles consists of a chain of three neurons:</p>\n<ul>\n<li>The first neuron arises from the <strong>hypothalamus</strong> along the brain stem to synapse in the&nbsp;intermediolateral column of the spinal cord&mdash;the <strong>ciliospinal center of Budge (C8-T1)</strong>.</li>\n<li>From here (C8-T1), the second-order neuron arises. This joins the cervical sympathetic chain and synapses at the superior cervical ganglion.</li>\n<li>The third-order neuron arises from the <strong>superior cervical ganglion </strong>and travels through the cavernous sinus along with the internal carotid artery.</li>\n<li>Sympathetic fibers join the ophthalmic division of the trigeminal nerve and pass through the ciliary ganglion to the nasociliary and short ciliary nerves.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/518c4c15167349adab428ec71dbb6183x1280x2087.JPEG"
    ]
  },
  {
    "text": "A simultaneous lesion in both sympathetic and parasympathetic supply of the eye leads to which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Mydriatic pupil that reacts to light"
      },
      {
        "id": 2,
        "text": "Constricted pupil that reacts to light"
      },
      {
        "id": 3,
        "text": "Mid-sized pupil that doesn\u2019t react to light"
      },
      {
        "id": 4,
        "text": "Mid-sized pupil that reacts to light"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Simultaneous lesion in both sympathetic and parasympathetic supply of the eye leads to mid-sized pupil that doesn&rsquo;t react to light.</p>\n<p>Pupillary <strong>dilation</strong> is achieved by <strong>sympathetic</strong> innervation of dilator pupillae. Therefore, any lesion of the sympathetic supply of the pupil leads to constricted pupil.</p>\n<p>Pupillary <strong>constriction</strong> is a <strong>parasympathetic</strong> function. Lesions in this pathway leads to dilated pupil and failure to constrict.</p>\n<div class=\"page\" title=\"Page 334\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>A mid-sized unreactive pupil due to a lesion of both parasympathetic and sympathetic supplies is seen in aneurysms of the internal carotid artery within the cavernous sinus.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During the neurological examination of a patient, on shining light in his left eye, the left pupil does not constrict but the right pupil does. On shining light in his right eye, the right pupil constricts and left doesn\u2019t. The defect is in:",
    "choices": [
      {
        "id": 1,
        "text": "Right eye afferent"
      },
      {
        "id": 2,
        "text": "Right eye efferent"
      },
      {
        "id": 3,
        "text": "Left eye efferent"
      },
      {
        "id": 4,
        "text": "Left eye afferent"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario is suggestive of <strong>left eye efferent (oculomotor nerve) defect.</strong></p>\n<p>The loss of pupillary light reflex (both direct and consensual) in the left eye associated with a preserved direct pupillary response in the right eye is characteristic of an efferent pupillary defect.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common feature of third nerve palsy, in a case of long-standing, uncontrolled diabetes?",
    "choices": [
      {
        "id": 1,
        "text": "Proptosis"
      },
      {
        "id": 2,
        "text": "Pseudoptosis"
      },
      {
        "id": 3,
        "text": "Ptosis"
      },
      {
        "id": 4,
        "text": "Pupillary dysfunction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most common feature seen in diabetic oculomotor palsy among the given options is <strong>ptosis.</strong></p>\n<p>In the&nbsp;<strong>anatomical arrangement</strong>&nbsp;of the nerve fibers of the 3<sup>rd</sup>&nbsp;cranial nerve, the <strong>fibers</strong> controlling the <strong>pupillary reflex</strong> are present <strong>superficially</strong> and are thus <strong>spared</strong> from diabetic ischemia-induced injury which starts from the central nerve fibres. Thus, <strong>pupil sparing</strong> is commonly seen in diabetic patients.</p>\n<p>The etiology of diabetic neuropathy is <strong>hyperglycemia-induced</strong> <strong>damage</strong> to nerve cells and&nbsp;<strong>neuronal ischemic</strong> change due to <strong>microvascular angiopathy</strong>.</p>\n<div class=\"page\" title=\"Page 3166\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Involvement of the <strong>third cranial nerve</strong> is most common and it often presents with early features of <strong>ptosis</strong> and <strong>diplopia&nbsp;</strong>with <strong>pupil</strong>&nbsp;<strong>sparing.</strong></p>\n<p>The involvement of <strong>levator palpebrae superioris</strong> muscle of the eyelid manifests as <strong>ptosis</strong> and the involvement of extraocular muscles such as <strong>medial rectus</strong>,<strong>inferior rectus</strong> and <strong>inferior oblique</strong> presents as <strong>opthalmoplegia</strong> with <strong>diplopia</strong>. All the muscles mentioned above are supplied by the Occulomotor nerve.</p>\n<p>Note: <strong>Aneurysm</strong> of the posterior communicating artery is an important cause of isolated third nerve palsy with <strong>involvement of the pupil.&nbsp;</strong>This is because the aneurysm impinges on the superficial pupil nerve fibres of the 3rd cranial nerve.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man was brought to the OPD by his daughter with complaints of drooping of his left eyelid and double vision. The pupillary examination was normal. What is the likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Aneurysmal rupture"
      },
      {
        "id": 2,
        "text": "Trauma"
      },
      {
        "id": 3,
        "text": "Diabetes"
      },
      {
        "id": 4,
        "text": "Raised ICT"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Ptosis and double vision with no other features suggest an acquired, isolated <strong>3<sup>rd</sup> nerve palsy with pupillary sparing</strong>. This is seen in ischemic conditions such as <strong>diabetes</strong>.</p>\n<p>The vasoneurium supplies the nerve from outside to inside. As the somatic fibres are located in the inner part of the nerve, these fibres are affected more in the setting of <strong>ischemia</strong>. The parasympathetic pupillary fibres which run on the outside can remain unaffected (resulting in pupillary sparing). In <strong>compressive</strong> lesions, the parasympathetic fibres are affected before any disruption of the motor fibres. So pupillary sparing is not seen.</p>\n<p><strong>Isolated 3<sup>rd</sup> nerve palsy</strong></p>\n<p><strong>Causes&nbsp;</strong></p>\n<ul>\n<li><strong>Microvascular disease</strong> associated with systemic risk factors such as hypertension and diabetes is the most common cause of third nerve palsy.</li>\n<li><strong>Aneurysm</strong> of the <strong>posterior communicating artery</strong> at its junction with the internal carotid, both direct and secondary to subdural hematoma with uncal herniation.</li>\n<li><strong>Episodic-</strong>&nbsp;migraine, compression, ischemia,&nbsp;and alterations in intracranial pressure</li>\n<li><strong>Miscellaneous-</strong>&nbsp;tumour<strong>&nbsp;</strong>and&nbsp;inflammatory diseases such as <strong>syphilis</strong>, <strong>Lyme</strong> <strong>disease,</strong> and <strong>sarcoidosis;</strong>&nbsp;giant cell arteritis; and <strong>vasculitis</strong> associated with collagen vascular disorders.</li>\n</ul>\n<p><strong>Signs</strong></p>\n<ul>\n<li><strong>Profound ptosis</strong> due to the&nbsp;weakness of the levator muscle</li>\n<li>Abduction and depression in the primary position (\"<strong>down and out\")</strong></li>\n<li><strong>Normal abduction</strong> as the lateral rectus is intact</li>\n<li>Limited adduction due to medial rectus weakness</li>\n<li>Limited elevation due to the&nbsp;weakness of the superior rectus and inferior oblique</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The patient presented with the following appearance when asked to look straight. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "3rd nerve palsy"
      },
      {
        "id": 2,
        "text": "Horizontal gaze palsy"
      },
      {
        "id": 3,
        "text": "6th nerve palsy"
      },
      {
        "id": 4,
        "text": "Internuclear ophthalmoplegia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows adduction of the right eye due to&nbsp;paralysis of the right lateral rectus, indicating right&nbsp;<strong>abducens (6<sup>th</sup>) nerve palsy</strong>.</p>\n<p>The <strong>nucleus</strong> of the sixth (abducens or abducent) nerve lies at the <strong>mid-level of the pons.</strong></p>\n<p><strong>Nuclear lesion:&nbsp;</strong>A nuclear sixth nerve lesion also causes the failure of horizontal gaze towards the side of the damage due to the&nbsp;involvement of the adjacent horizontal gaze center (paramedian pontine reticular formation).</p>\n<p><strong>Foville (inferior medial pontine) syndrome</strong> is most frequently caused by <strong>vascular disease</strong> or <strong>tumors</strong> involving the <strong>dorsal</strong> <strong>pons</strong>. It is characterized by the following:</p>\n<ul>\n<li><strong> Ipsilateral involvement of the fifth to eighth cranial nerves</strong></li>\n<li>Central sympathetic fibers<strong> (Horner syndrome) </strong></li>\n<li><strong>Horizontal gaze palsy</strong></li>\n</ul>\n<p><strong>Millard&ndash;Gubler (ventral pontine) syndrome</strong> involves the <strong>fasciculus</strong> as it passes through the <strong>pyramidal</strong> <strong>tract.&nbsp;</strong>As well as <strong>ipsilateral sixth nerve palsy</strong>, there is <strong>contralateral hemiplegia</strong> and often an <strong>ipsilateral lower motor neuron (LMN) facial nerve palsy.</strong></p>\n<p>Clinical features:</p>\n<ul>\n<li><strong>Esotropia</strong> in the primary position due to relatively unopposed action of the medial rectus</li>\n<li><strong>Limitation of abduction</strong> on the side of the lesion</li>\n<li><strong>Normal adduction</strong> of the affected eye</li>\n<li>A <strong>compensatory face turn</strong> is towards the side of the paralyzed muscle in unilateral palsy&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e3bdac4afc6d4b56940737548a74c366.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '22 Disorders Of Visual Pathway And Pupillary Reflexes';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>