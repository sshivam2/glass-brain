<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>01 Anatomy Of Female Pelvic Organs - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not a part of the vulva?",
    "choices": [
      {
        "id": 1,
        "text": "Labia majora"
      },
      {
        "id": 2,
        "text": "Vestibule"
      },
      {
        "id": 3,
        "text": "Greater vestibular glands"
      },
      {
        "id": 4,
        "text": "Cervix"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Cervix</strong> is not a part of the vulva.&nbsp;</p>\n<p>The <strong>vulva</strong> <strong>includes:</strong></p>\n<ul>\n<li>Mons veneris</li>\n<li>Labia majora</li>\n<li>Labia minora</li>\n<li>Clitoris</li>\n<li>Vestibule</li>\n<li>Vestibular bulb</li>\n<li>Greater vestibular glands.</li>\n</ul>\n<p>The vulva is <strong>posteriorly</strong> related to the <strong>perineum</strong>.&nbsp;</p>\n<p>The triangular space bounded by clitoris, labia minora and fourchette is the <strong>vestibule.&nbsp;</strong>It is present between the <strong>labia minora anteriorly</strong> and<strong>&nbsp;the introitus posteriorly</strong>. The posterior part of the vestibule <strong>between</strong> the <strong>fourchette</strong> and the <strong>vaginal introitus</strong> is called <strong>fossa navicularis.&nbsp;</strong>The vestibule has 4 openings:</p>\n<ul>\n<li>Urethral opening</li>\n<li>Vaginal orifice opening</li>\n<li>Bartholin&rsquo;s duct on either side</li>\n<li>Ducts of paraurethral glands</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/755707c1e3454f4e9124ab88af1912cdx600x942.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding labia majora?",
    "choices": [
      {
        "id": 1,
        "text": "They join posteriorly to form the posterior commissure"
      },
      {
        "id": 2,
        "text": "It is homologous to scrotum in male"
      },
      {
        "id": 3,
        "text": "The round ligament terminates at its posterior end"
      },
      {
        "id": 4,
        "text": "It contains sebaceous glands and apocrine glands"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>round ligament</strong> terminates at the<strong>&nbsp;anterior end&nbsp;</strong>of the <strong>labia majora</strong>.</p>\n<p>The labia majora lie on either side of the vulva and <strong>join posteriorly</strong> to form the <strong>posterior commissure</strong>. The inner side is hairless. Labia majora are<strong> homologous</strong> to the <strong>scrotum</strong> in males. The labia majora and the mons veneris contain:</p>\n<ul>\n<li>Hair follicles</li>\n<li><strong>Sebaceous glands</strong></li>\n<li>Modified sweat glands, known as <strong>apocrine glands</strong></li>\n</ul>\n<p>The labia minora are two cutaneous folds between the labia major. Anteriorly they enclose the clitoris and unite with each other in front and behind the clitoris to form prepuce and frenulum respectively. The<strong> labia minora</strong> are&nbsp;<strong>homo</strong><strong>logous </strong>to the <strong>ventral aspect</strong> of the <strong>penis.</strong></p>\n<p>The clitoris&nbsp;is a small erectile body lying in the anterior-most part of the vulva. The <strong>clitoris</strong> is <strong>homologous</strong> to<strong> glans penis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eef3911f36d145b7b2628361e6b0c831x600x942.JPEG"
    ]
  },
  {
    "text": "A patient presented to the gynecology OPD with the following finding. Which structure in men is homologous to the affected structure?",
    "choices": [
      {
        "id": 1,
        "text": "Prostate gland"
      },
      {
        "id": 2,
        "text": "Cowper\u2019s gland"
      },
      {
        "id": 3,
        "text": "Glands of Littre"
      },
      {
        "id": 4,
        "text": "Meibomian glands"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a <strong>Bartholin's cyst</strong>, which involves the<strong> Bartholin's glands.</strong>&nbsp;These glands are <strong>homologous</strong> to the male bulbourethral or <strong>Cowper glands</strong>.</p>\n<div class=\"page\" title=\"Page 847\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The ducts of Bartholin's glands open in the groove between the hymen and the labia minora at approximately 5 and 7 o&rsquo;clock positions. They are <strong>stimulated by sexual arousal</strong>. The glands contain columnar cells that <strong>secrete mucus with lubricant</strong> properties. Contraction of the bulbospongiosus muscle expresses gland secretions.</p>\n<p><strong>Bartholin's cyst</strong> occurs due to obstruction of the ducts of the&nbsp;Bartholin's glands by proteinaceous material, or due to infection. Symptomatic or recurrent cysts may require<strong> marsupialization</strong> or gland excision. An <strong>infected</strong>&nbsp;Bartholin's cyst can lead to an <strong>Bartholin's abscess</strong>. This requires <strong>surgical drainage</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d45099ff6da34dd6aa0f4ffdefa95e54.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b1cdb7f0da40499e8a2a564ede7d396ax600x719.JPEG"
    ]
  },
  {
    "text": "What is the pH of the vagina before puberty?",
    "choices": [
      {
        "id": 1,
        "text": "7"
      },
      {
        "id": 2,
        "text": "4.5"
      },
      {
        "id": 3,
        "text": "6"
      },
      {
        "id": 4,
        "text": "4.2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>pH</strong> of the vagina <strong>before puberty</strong> is<strong> 7</strong>. In <strong>adult</strong> females, the <strong>pH</strong> is <strong>acidic.\u00a0</strong></p>\n<p><strong>Doderlein's bacilli</strong> (<em>Lactobacillus </em>sp.) are part of the normal vaginal flora. They <strong>produce lactic acid</strong>\u00a0from glycogen in the vaginal epithelium and make the <strong>vaginal pH acidic.</strong>\u00a0They are present in newborns and disappear in 10-14 days. They reappear at puberty and disappear after menopause. Vaginal flora also includes microbes such as <em>Clostridium welchii.</em></p>\n<p><strong>Vaginal defence</strong> mechanisms are influenced by <strong>estrogen</strong>. In newborns, maternal estrogens maintain the defence mechanisms for 10-14 days. After that, the levels wane. During puberty, the circulating estrogen maintains the defence mechanism.\u00a0</p>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Period</strong></td>\n<td style=\"text-align: center;\"><strong>Vaginal pH</strong></td>\n<td style=\"text-align: center;\"><strong>Doderlein bacteria</strong></td>\n<td style=\"text-align: center;\"><strong>Types of cells</strong></td>\n</tr>\n<tr>\n<td>Birth-2 weeks</td>\n<td>4-5</td>\n<td>+</td>\n<td>-</td>\n</tr>\n<tr>\n<td>2weeks-puberty</td>\n<td>&gt;7</td>\n<td>-</td>\n<td>Parabasal cells</td>\n</tr>\n<tr>\n<td>Puberty</td>\n<td>4-4.5</td>\n<td>sparse</td>\n<td>Superficial &amp; intermediate</td>\n</tr>\n<tr>\n<td>Reproductive</td>\n<td>4-5</td>\n<td>plenty</td>\n<td>Superficial &amp; intermediate</td>\n</tr>\n<tr>\n<td>Pregnancy</td>\n<td>3.8-4.1</td>\n<td>plenty</td>\n<td>Intermediate\u00a0</td>\n</tr>\n<tr>\n<td>Postmenopause</td>\n<td>&gt;7</td>\n<td>-</td>\n<td>Parabasal</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>Note:\u00a0The pH is higher in the upper part of the vagina due to mixing with alkaline cervical mucus.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect about relations of the vagina?",
    "choices": [
      {
        "id": 1,
        "text": "Bladder - anterior"
      },
      {
        "id": 2,
        "text": "Bartholin\u2019s gland - posterior"
      },
      {
        "id": 3,
        "text": "Levator ani - lateral"
      },
      {
        "id": 4,
        "text": "Pouch of Douglas -  posterior"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bartholin&rsquo;s gland</strong> is present&nbsp;<strong>lateral&nbsp;</strong>to the vagina.&nbsp;</p>\n<p>The vagina is related to the following structures:</p>\n<ul>\n<li>Anteriorly:\n<ul>\n<li>Bladder (upper 1/3<sup>rd</sup>)</li>\n<li>Urethra (lower 2/3<sup>rd</sup>)</li>\n</ul>\n</li>\n<li>Posteriorly&nbsp;\n<ul>\n<li>Pouch of Douglas&nbsp;</li>\n<li>Ampulla of the rectum</li>\n<li>Perineal body</li>\n</ul>\n</li>\n<li>Laterally\n<ul>\n<li>Mackenrodt's ligament</li>\n<li>Levator ani</li>\n<li>Bartholin's glands&nbsp;</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2fe72c5005434608b66d52c2b5520de6x1280x1286.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17a539c5e1e942a0a74d91d4abe7926cx1280x1128.JPEG"
    ]
  },
  {
    "text": "Identify the type of hymen.",
    "choices": [
      {
        "id": 1,
        "text": "Cribriform hymen"
      },
      {
        "id": 2,
        "text": "Parous hymen"
      },
      {
        "id": 3,
        "text": "Fimbriated hymen"
      },
      {
        "id": 4,
        "text": "Septate hymen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>cribriform hymen</strong> because it has multiple small openings.</p>\n<p>Based on the shape of its opening, the hymen may be classified as:</p>\n<table style=\"width: 515px;\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 104.854px;\"><strong>Hymen</strong></td>\n<td style=\"text-align: center; width: 393.146px;\"><strong>Description</strong></td>\n</tr>\n<tr>\n<td style=\"width: 104.854px;\">Annular</td>\n<td style=\"width: 393.146px;\">Oval central opening</td>\n</tr>\n<tr>\n<td style=\"width: 104.854px;\">Crescentic</td>\n<td style=\"width: 393.146px;\">Semilunar central opening</td>\n</tr>\n<tr>\n<td style=\"width: 104.854px;\">Vertical</td>\n<td style=\"width: 393.146px;\">Vertical slit-like opening</td>\n</tr>\n<tr>\n<td style=\"width: 104.854px;\">Septate</td>\n<td style=\"width: 393.146px;\">2 lateral openings partitioned by a bridge of hymenal tissue</td>\n</tr>\n<tr>\n<td style=\"width: 104.854px;\">Cribriform</td>\n<td style=\"width: 393.146px;\">Multiple small openings</td>\n</tr>\n</tbody>\n</table>\n<p>Other variants of the hymen:</p>\n<table style=\"width: 686.854px;\">\n<tbody>\n<tr>\n<td style=\"width: 131px; text-align: center;\"><strong>Variants</strong></td>\n<td style=\"width: 538.854px; text-align: center;\"><strong>Description</strong></td>\n</tr>\n<tr>\n<td style=\"width: 131px;\">Absence of hymen</td>\n<td style=\"width: 538.854px;\">Congenital deformity.</td>\n</tr>\n<tr>\n<td style=\"width: 131px;\">Infantile</td>\n<td style=\"width: 538.854px;\">Small central linear opening.</td>\n</tr>\n<tr>\n<td style=\"width: 131px;\">Imperforate</td>\n<td style=\"width: 538.854px;\">No opening</td>\n</tr>\n<tr>\n<td style=\"width: 131px;\">Fimbriated</td>\n<td style=\"width: 538.854px;\">\n<p>Free margin has symmetrical indentations anteriorly</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 131px;\">Ring or fringe-like&nbsp;</td>\n<td style=\"width: 538.854px;\">\n<p>A narrow ring of thick membrane is present all around the vaginal orifice</p>\n<p>It can easily distend during sexual intercourse without rupturing the hymen</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>The hymen is lined by stratified squamous epithelium on both sides. The hymen is most commonly <strong>torn posterolaterally</strong> or<strong> posteriorly</strong>.&nbsp;It is replaced by tags <strong>after childbirth</strong>&nbsp;which are called as <strong>carunculae myrtiformes</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/11c081fb01dd4ea5a8843e4be2c9efe1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f38fba7383a142df881e33c6104cde0cx1280x3106.JPEG"
    ]
  },
  {
    "text": "A patient with uterine prolapse and urethrocele has weakness in the superficial and deep perineal muscles. What level of support is lost here?",
    "choices": [
      {
        "id": 1,
        "text": "Level 1"
      },
      {
        "id": 2,
        "text": "Level 2"
      },
      {
        "id": 3,
        "text": "Level 3"
      },
      {
        "id": 4,
        "text": "Level 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given case scenario<strong>, level 3</strong> supports including the <strong>superficial and deep perineal muscles</strong> are lost.<strong>&nbsp;</strong>This causes <strong>urethrocele.</strong></p>\n<p><strong>DeLancey's levels</strong> of support are used to describe the supports of the genital organs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Anteflexion of the uterus is at the level of ___.",
    "choices": [
      {
        "id": 1,
        "text": "External os"
      },
      {
        "id": 2,
        "text": "Internal os"
      },
      {
        "id": 3,
        "text": "Upper part of vagina"
      },
      {
        "id": 4,
        "text": "Lower part of vagina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Anteflexion</strong> of the uterus is seen <strong>at</strong> the level of the&nbsp;<strong>internal os</strong>.&nbsp;</p>\n<table style=\"width: 535px;\">\n<tbody>\n<tr>\n<td style=\"width: 255.172px; text-align: center;\"><strong>Angle of Anteversion</strong></td>\n<td style=\"width: 265.828px; text-align: center;\"><strong>Angle of Anteflexion</strong></td>\n</tr>\n<tr>\n<td style=\"width: 255.171875px;\">The angle between the <strong>cervix and vagina</strong></td>\n<td style=\"width: 265.828125px;\">The angle between <strong>cervix and uterus</strong></td>\n</tr>\n<tr>\n<td style=\"width: 255.171875px;\"><strong>90<sup>o</sup></strong></td>\n<td style=\"width: 265.828125px;\"><strong><strong>120</strong></strong><strong><sup>o</sup></strong></td>\n</tr>\n</tbody>\n</table>\n<p>(Mnemonic -&nbsp;V for <strong>v</strong>ersion, V for <strong>v</strong>agina)</p>\n<p>The uterus <strong>normally</strong> lies in a position of <strong>anteversion</strong> and <strong>anteflexion</strong>.</p>\n<p>In the&nbsp;<strong>anteverted&nbsp;</strong>position, the external os is directed downward and backwards. On vaginal examination, the fingers come in contact with the<strong> anterior lip&nbsp;of the cervix </strong>as it is&nbsp;the <strong>lowest part.</strong></p>\n<p>When the uterus is <strong>retroverted</strong>, the cervix is directed downward and forwards. The<strong> lowest part </strong>of the<strong> cervix</strong>&nbsp;becomes either <strong>the external os </strong>or its <strong>posterior lip</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3b0ee47e50b4189a7af88bd5a30dd6bx600x656.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d56361ed50b439cbbebf2194041940bx1280x2637.JPEG"
    ]
  },
  {
    "text": "A G3P2L2 woman presents in her third trimester with vaginal leaking. On PV examination, the anterior lip of the cervix can be palpated. What is the position of her uterus and the ligament that maintains this position?",
    "choices": [
      {
        "id": 1,
        "text": "Anteverted uterus - Round ligament"
      },
      {
        "id": 2,
        "text": "Anteflexed uterus - Round ligament"
      },
      {
        "id": 3,
        "text": "Anteverted uterus - Uterosacral ligament"
      },
      {
        "id": 4,
        "text": "Anteflexed uterus - Broad ligament"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given clinical scenario, the uterus is <strong>anteverted</strong> as the anterior lip of the cervix was palpable.\u00a0The <strong>round ligament</strong> helps maintain the <strong>anteversion</strong> of the uterus <strong>during pregnancy.\u00a0</strong></p>\n<p>However, the <strong>anteversion</strong> in the <strong>non-pregnant uterus</strong> is maintained by <strong>both</strong> the <strong>uterosacral</strong> ligament and <strong>round</strong> ligament.</p>\n<table style=\"width: 535px;\">\n<tbody>\n<tr>\n<td style=\"width: 255.172px; text-align: center;\"><strong>Angle of anteversion</strong></td>\n<td style=\"width: 265.828px; text-align: center;\"><strong>Angle of anteflexion</strong></td>\n</tr>\n<tr>\n<td style=\"width: 255.171875px;\">Angle between the <strong>cervix and vagina</strong></td>\n<td style=\"width: 265.828125px;\">Angle between <strong>cervix and uterus</strong></td>\n</tr>\n<tr>\n<td style=\"width: 255.171875px;\"><strong>90<sup>o</sup></strong></td>\n<td style=\"width: 265.828125px;\"><strong>120<sup>o</sup></strong></td>\n</tr>\n</tbody>\n</table>\n<p>(Mnemonic -\u00a0V for <strong>v</strong>ersion, V for <strong>v</strong>agina)</p>\n<p>The uterus<strong> normally</strong> lies in a position of <strong>anteversion</strong> and <strong>anteflexion</strong>.</p>\n<p>In the\u00a0<strong>anteverted\u00a0</strong>position, the external os is directed downward and backwards. On vaginal examination, the fingers come in contact with the<strong>\u00a0anterior lip\u00a0of the cervix\u00a0</strong>as it is\u00a0the\u00a0<strong>lowest part.</strong></p>\n<p>When the uterus is\u00a0<strong>retroverted</strong>, the cervix is directed downward and forwards. The<strong>\u00a0lowest part\u00a0</strong>of the<strong>\u00a0cervix</strong>\u00a0becomes either\u00a0<strong>the external os\u00a0</strong>or its\u00a0<strong>posterior lip</strong>.</p>\n<p>Anteflexion is seen at the level of the internal os.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3496d516cab2478d8dd2078efe928615x600x656.JPEG"
    ]
  },
  {
    "text": "A multiparous woman presented with a urethrocele, due to weakness of the urogenital diaphragm. What is this structure also known as?",
    "choices": [
      {
        "id": 1,
        "text": "Rectangular ligament"
      },
      {
        "id": 2,
        "text": "Triangular ligament"
      },
      {
        "id": 3,
        "text": "Pyramidal ligament"
      },
      {
        "id": 4,
        "text": "Pear shaped ligament"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>urogenital diaphragm</strong> is also known as the<strong> triangular ligament.&nbsp;</strong></p>\n<p>The urogenital diaphragm extends from the <strong>pubic arch anteriorly</strong> to the central point of the <strong>perineum posteriorly</strong> and consists of two layers of fascia through which pass the vagina and the urethra. The central point of the female perineum lies between the vagina and the rectum.</p>\n<p><strong>Urogenital triangle:</strong></p>\n<ul>\n<li>Present between 2 ischiopubic rami</li>\n<li>Stretching transversely across the rami there are 3 membranes.</li>\n<li>From above downwards the membranes are as follows:\n<ul>\n<li>Superior fascia of urogenital diaphragm</li>\n<li>Inferior fascia of urogenital diaphragm</li>\n<li>Membranous layer of superficial perineal fascia</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9590e7aa0ad34effb190f0d36bb29ec4x1280x1398.JPEG"
    ]
  },
  {
    "text": "What is the cavity of the uterus lined by?",
    "choices": [
      {
        "id": 1,
        "text": "Single layer of ciliated columnar epithelium"
      },
      {
        "id": 2,
        "text": "Double layer of ciliated columnar epithelium"
      },
      {
        "id": 3,
        "text": "Single layer of ciliated cuboidal epithelium"
      },
      {
        "id": 4,
        "text": "Double layer of ciliated cuboidal epithelium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> uterine cavity</strong>&nbsp;is lined by a&nbsp;<strong>single layer</strong> of<strong> ciliated columnar epithelium</strong>.</p>\n<p>The wall of the <strong>uterus</strong> consists of <strong>3 layers</strong>:</p>\n<ul>\n<li><strong>Perimetrium&nbsp;</strong>is the serous coat adherent to the underlying muscle.</li>\n<li><strong>Myometrium</strong> -&nbsp;it<strong>&nbsp;</strong>consists of thick bundles of muscles that form 3 distinct layers during pregnancy:\n<ul>\n<li>Outer longitudinal</li>\n<li>Inner circular</li>\n<li>Middle interlacing called living ligature</li>\n</ul>\n</li>\n<li><strong>Endometrium -&nbsp;</strong>It is the mucous lining of the cavity.&nbsp;It consists of lamina propria and surface epithelium which is a&nbsp;single layer of ciliated columnar epithelium.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman with regular menstrual cycles is undergoing an ultrasound on the 14th day of her cycle. What will the endometrial thickness be?",
    "choices": [
      {
        "id": 1,
        "text": "0.5 mm"
      },
      {
        "id": 2,
        "text": "4 mm"
      },
      {
        "id": 3,
        "text": "11 mm"
      },
      {
        "id": 4,
        "text": "14 mm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>During <strong>ovulation</strong>, the thickness of the endometrium is around<strong> 11 mm</strong>.</p>\n<table style=\"width: 332px;\">\n<tbody>\n<tr>\n<td style=\"width: 227px; text-align: center;\"><strong>Phase</strong></td>\n<td style=\"width: 93px; text-align: center;\"><strong>Endometrial thickness</strong></td>\n</tr>\n<tr>\n<td style=\"width: 227px;\">Immediately after menstruation</td>\n<td style=\"width: 93px;\">1-2 mm</td>\n</tr>\n<tr>\n<td style=\"width: 227px;\">Early proliferative phase</td>\n<td style=\"width: 93px;\">5-7 mm</td>\n</tr>\n<tr>\n<td style=\"width: 227px;\">Secretory phase</td>\n<td style=\"width: 93px;\">7-16 mm</td>\n</tr>\n<tr>\n<td style=\"width: 227px;\">Preovulatory phase&nbsp;</td>\n<td style=\"width: 93px;\">up to <strong>11 mm</strong></td>\n</tr>\n<tr>\n<td style=\"width: 227px;\">Postmenopausal</td>\n<td style=\"width: 93px;\">&lt;4 mm</td>\n</tr>\n<tr>\n<td style=\"width: 227px;\">Postmenopausal - abnormal, requires biopsy</td>\n<td style=\"width: 93px;\"><strong>&gt;4 mm</strong>&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding uterine anatomy?",
    "choices": [
      {
        "id": 1,
        "text": "Round ligaments receive their blood supply from Sampson's artery"
      },
      {
        "id": 2,
        "text": "Transverse cervical ligaments are also called cardinal ligaments"
      },
      {
        "id": 3,
        "text": "Uterine innervation is by the pudendal nerve plexus"
      },
      {
        "id": 4,
        "text": "Lymphatic drainage is primarily to the obturator, internal and external iliac nodes."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The uterus is innervated by the fibers of\u00a0the <strong>uterovaginal plexus, </strong>also known as the\u00a0<strong>Frankenhauser ganglion.</strong></p>\n<p>Option A: Round ligaments receive their blood supply from <strong>Sampson's artery</strong>\u00a0which\u00a0represents the <strong>anastomosis</strong> of the <strong>uterine artery</strong> and <strong>ovarian artery</strong>.</p>\n<p>Option B: The cardinal ligaments are also called transverse cervical ligaments or <strong>Mackenrodt ligaments</strong>. They consist primarily of <strong>perivascular connective tissue</strong>. They attach to the posterolateral pelvic walls near the origin of the internal iliac artery and surround the vessels supplying the uterus and vagina.</p>\n<p>Option D: Lymphatic drainage of the uterus is primarily to the <strong>obturator</strong> and<strong> internal and external iliac nodes</strong>. One theory of endometriosis, states lymphatic spread as cause for seeding in the pelvis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A gynecologist is performing a hysterectomy. She accidentally nicks the ureter in the ureteric canal as it pierces the Mackenrodt's ligaments. Which vessels are likely to be damaged here?",
    "choices": [
      {
        "id": 1,
        "text": "Uterine artery above and the uterine plexus of veins below"
      },
      {
        "id": 2,
        "text": "Uterine plexus of veins above and the uterine artery below"
      },
      {
        "id": 3,
        "text": "Ovarian artery above and the uterine artery below"
      },
      {
        "id": 4,
        "text": "Uterine artery above and the ovarian artery below"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> uterine artery above</strong> and<strong> uterine venous plexus below</strong> are likely to be damaged here, as the ureter is present between these vessels.&nbsp;</p>\n<p>The<strong> ureter</strong> <strong>pierces</strong> the<strong> Mackenrodt's ligament</strong>, forming the <strong>ureteric canal.&nbsp;</strong>In this canal, the ureter is&nbsp;crossed by the uterine artery above and the uterine plexus of veins below, thus being present in <strong>between</strong> the<strong> uterine vessels</strong>.</p>\n<p>The ureteric canal&nbsp;<strong>provides</strong> the necessary <strong>room for normal peristalsis</strong>, without pressure from the surrounding structures. After leaving the ureteric canal, the ureter passes forwards and medially to reach the bladder. It is 1-2 cm away from&nbsp;the cervix.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f2b4d9e8fc0402e8dbccc96ab485c7dx1280x1298.JPEG"
    ]
  },
  {
    "text": "You take a culture swab from the portio vaginalis of a woman having foul smelling vaginal discharge. What is this region also known as?",
    "choices": [
      {
        "id": 1,
        "text": "Supra vaginal part of cervix"
      },
      {
        "id": 2,
        "text": "Vaginal part of cervix"
      },
      {
        "id": 3,
        "text": "Fornix of the vagina"
      },
      {
        "id": 4,
        "text": "Introitus of the vagina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Portio vaginalis</strong> or <strong>exocervix</strong> is the other name for the <strong>vaginal part</strong> of the <strong>cervix</strong>.</p>\n<p><strong>Cervix</strong>&nbsp;is the lowermost part of the uterus extending from the histological<strong> internal os</strong> to the<strong> external os.&nbsp;</strong>It is cylindrical in shape measuring 2.5 cm in length and diameter.</p>\n<p>Cervix is made up of 10% muscle and the rest is collagen, elastin, and proteoglycan. The lining of the cervix has the following parts:</p>\n<ul>\n<li>Exocervix - also known as portio vaginalis. It is lined by<strong> non keratinized stratified squamous epithelium</strong>.</li>\n<li>Endocervix - it is lined by high <strong>columnar, ciliated epithelium</strong>.&nbsp;</li>\n<li>Endocervical glands - secrete<strong> alkaline mucus</strong>. When enlarged, they form swellings called <strong>Nabothian follicles/cysts.</strong>&nbsp;</li>\n<li>Transformation zone - the epithelium gradually changes from <strong>columnar to squamous</strong> in this region.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the cervix: corpus ratio before puberty?",
    "choices": [
      {
        "id": 1,
        "text": "1:2"
      },
      {
        "id": 2,
        "text": "2:1"
      },
      {
        "id": 3,
        "text": "1:3"
      },
      {
        "id": 4,
        "text": "3:1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The cervix:corpus ratio <strong>before puberty</strong> is <strong>2:1.</strong></p>\n<p>The relationship between the length of the cervix and that of the body of the uterus varies with age.</p>\n<table style=\"width: 385px;\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 155.972px;\"><strong>Age</strong></td>\n<td style=\"text-align: center; width: 214.028px;\"><strong>Cervix/Corpus ratio</strong></td>\n</tr>\n<tr>\n<td style=\"width: 155.972px;\">Before puberty</td>\n<td style=\"width: 214.028px;\">\n<p>2:1</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 155.972px;\">At puberty</td>\n<td style=\"width: 214.028px;\">\n<p>1:2</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 155.972px;\">Reproductive age</td>\n<td style=\"width: 214.028px;\">1:3 or 1:4</td>\n</tr>\n<tr>\n<td style=\"width: 155.972px;\">After menopause</td>\n<td style=\"width: 214.028px;\">2:1 - however, the uterus and cervix are both atrophied</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The remnants of Wolffian ducts in females are located in________.",
    "choices": [
      {
        "id": 1,
        "text": "Pouch of Douglas"
      },
      {
        "id": 2,
        "text": "Leaves of broad ligament"
      },
      {
        "id": 3,
        "text": "Uterovesical pouch"
      },
      {
        "id": 4,
        "text": "Iliac fossa"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> Gartner's duct</strong> is a&nbsp;<strong>remnant </strong>of the <strong>Wolffian ducts&nbsp;</strong>in women. These are located in the <strong>broad ligament&nbsp;</strong>and the vagina.</p>\n<p>The Gartner's duct is an embryological remnant of the <strong>mesonephric duct/Wolffian duct</strong> formed during the development of the urinary and reproductive organs. It runs parallel to, but below, the fallopian tube in the mesosalpinx. The duct passes downwards by the side of the uterus to the level of the internal os where it passes into the tissues of the cervix. It then runs forwards to reach the anterolateral aspect of the vaginal wall and may reach as far down as the hymen.</p>\n<p>The duct can sometimes form a cyst&nbsp;in the broad ligament or in the vagina. It is called <strong>Gartner&rsquo;s cyst.&nbsp;</strong>It is a benign condition and can be <strong>treated</strong> with <strong>marsupialization</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b6398184ce704faa8efa742268738715x1280x2423.JPEG"
    ]
  },
  {
    "text": "Which of the following is false about the contents of the broad ligament?",
    "choices": [
      {
        "id": 1,
        "text": "Ovarian vessels in its infundibulopelvic part"
      },
      {
        "id": 2,
        "text": "It contains the uterine arteries"
      },
      {
        "id": 3,
        "text": "Ureter is present the lower portion"
      },
      {
        "id": 4,
        "text": "Ovarian ligament in its anterior fold"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> ovarian ligaments</strong> are contained in the <strong>posterior fold</strong> of the <strong>broad ligament.</strong></p>\n<p>The <strong>broad ligament</strong> contains the following <strong>parts</strong>:</p>\n<ul>\n<li><strong>Mesosalpinx</strong> - it lies between the fallopian tube and ovarian ligament. It contains the pelvic vessels - anastomoses between uterine and ovarian arteries. The ovary is attached via ovarian ligament through the posterior folds to the mesovarium.&nbsp;</li>\n<li><strong>Mesometrium</strong> - it contains the ovarian vessels within the infundibulopelvic ligament.</li>\n</ul>\n<div class=\"page\" title=\"Page 1728\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The <strong>ureter</strong> is present in the<strong> inferomedial part</strong> of the broad ligament. It is related to the uterine artery here and may be damaged during hysterectomy.</p>\n<p>Note: Broad ligament is not a support of the uterus.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where are Peg cells seen?",
    "choices": [
      {
        "id": 1,
        "text": "Vagina"
      },
      {
        "id": 2,
        "text": "Vulva"
      },
      {
        "id": 3,
        "text": "Ovary"
      },
      {
        "id": 4,
        "text": "Fallopian tubes"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Peg cells</strong> are seen in the&nbsp;<strong>fallopian tubes</strong>.</p>\n<p>A&nbsp;peg cell&nbsp;is a<strong> non-ciliated&nbsp;epithelial</strong>&nbsp;<strong>cell</strong>&nbsp;within the&nbsp;fallopian tube. These cells are also known as intercalated or intercalary cells whose function is not yet known.</p>\n<p>The image below shows pale ciliated cells (arrows) and narrow, dark, non-ciliated peg cells (arrowheads).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9d6d8da9e0644797864b986cfd1a5a94x291x261.JPEG"
    ]
  },
  {
    "text": "What is the longest part of the fallopian tube?",
    "choices": [
      {
        "id": 1,
        "text": "Interstitium"
      },
      {
        "id": 2,
        "text": "Isthmus"
      },
      {
        "id": 3,
        "text": "Ampulla"
      },
      {
        "id": 4,
        "text": "Infundibulum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong>&nbsp;longest</strong> and<strong> widest </strong>part of the fallopian tube is the<strong> ampulla&nbsp;</strong>(5 cm).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where is the tunica albuginea of the adult ovary derived from?",
    "choices": [
      {
        "id": 1,
        "text": "The surface epithelium"
      },
      {
        "id": 2,
        "text": "The sub epithelial connective tissue layer"
      },
      {
        "id": 3,
        "text": "The parenchymatous zone"
      },
      {
        "id": 4,
        "text": "Zona vasculosa"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tunica albuginea</strong> of the adult <strong>ovary</strong> is derived from the <strong>sub-epithelial connective tissue</strong> layer.</p>\n<p>Structure of the ovary:</p>\n<ul>\n<li>Surface epithelium - a single layer of <strong>cuboidal cells</strong> is present, which later gives rise to the <strong>surface epithelium</strong> of the adult ovary. It is morphologically continuous with the mesothelium of the peritoneum.</li>\n<li>The subepithelial connective tissue layer - gives <strong>rise to</strong> the <strong>tunica albuginea</strong> of the adult ovary and the <strong>basement membrane</strong> beneath the surface epithelium.</li>\n<li>The parenchymatous zone - becomes the\u00a0<strong>cortex</strong>\u00a0and contains the <strong>egg nests</strong>\u00a0and <strong>ovarian follicles.\u00a0</strong></li>\n<li>Zona vasculosa\u00a0- becomes the <strong>medulla</strong>\u00a0and contains the <strong>blood vessels. </strong>Hilar cells present here are homologous to interstitial cells of testes. They can rarely produce hilar cell tumors of the ovary.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/362553fc54c44d75b0e36f1d2aeaa9a8x1280x1396.JPEG"
    ]
  },
  {
    "text": "During the histopathological examination of an ovarian mass,  Call-Exner bodies are seen. In which of the following layers are these structures seen?",
    "choices": [
      {
        "id": 1,
        "text": "Granulosa cell layer"
      },
      {
        "id": 2,
        "text": "Theca interna"
      },
      {
        "id": 3,
        "text": "Discus proligerus"
      },
      {
        "id": 4,
        "text": "Cumulus oophorus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Graafian follicle:</strong></p>\n<p>The mature Graafian follicle is spheroidal or ovoid in shape. It contains pent-up secretion known as the liquor folliculi. The lining consists of:</p>\n<ul>\n<li>Theca externa</li>\n<li>Theca interna - contain the theca cells&nbsp;</li>\n<li>Granulosa cell layer</li>\n<li>Cumulus oophorus - projection of granulosa cells into the cavity of the Graafian follicle. It is also called the discus proligerus.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29f63a2e1e8f45419915b2921f8e7858x800x423.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eaf2436020134078bea42d9d59a0e751x1280x1351.JPEG"
    ]
  },
  {
    "text": "Where is the sympathetic nerve supply of ovary derived from?",
    "choices": [
      {
        "id": 1,
        "text": "T10-T11"
      },
      {
        "id": 2,
        "text": "T9-T10"
      },
      {
        "id": 3,
        "text": "S2-S4"
      },
      {
        "id": 4,
        "text": "L4-L5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The efferent<strong> preganglionic sympathetic fibres</strong> to the ovary are derived from the <strong>T10-T11</strong> spinal levels.</p>\n<p>These fibres travel to the <strong>prevertebral ganglia,</strong> where they synapse. The <strong>postganglionic sympathetic fibres </strong>arising from these ganglia contribute to the <strong>ovarian plexus</strong>, which innervates the ovary.</p>\n<div class=\"page\" title=\"Page 1799\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 74\">The ovarian plexus is a network of nerves comprising:</div>\n<ul>\n<li class=\"page\" title=\"Page 74\">Postganglionic sympathetic fibres</li>\n<li class=\"page\" title=\"Page 74\">Preganglionic parasympathetic fibres from the sacral outflow (S2-S4)</li>\n<li class=\"page\" title=\"Page 74\">Visceral afferent fibres (responsible for transmitting sensory signals)</li>\n</ul>\n<p>The ovarian plexus has two parts based on its connections:</p>\n<ul>\n<li>Upper part: Derived from branches of the renal plexus and aortic plexus</li>\n<li>Lower part: Derived from the superior and inferior hypogastric plexuses.</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Bleeding during normal menstruation occurs due to rupture of ____",
    "choices": [
      {
        "id": 1,
        "text": "Basilar artery"
      },
      {
        "id": 2,
        "text": "Spiral artery"
      },
      {
        "id": 3,
        "text": "Arcuate artery"
      },
      {
        "id": 4,
        "text": "Radial artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Rupture of the<strong> spiral arteries</strong> causes bleeding during normal menstruation. This is a branch of the uterine artery.&nbsp;</p>\n<p>The&nbsp;<strong>blood supply</strong>&nbsp;of the uterus is as follows:</p>\n<p>Uterine artery&rarr;Arcuate artery&rarr;Radial artery&rarr;Basal artery&rarr;Spiral artery</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/95fbe22e23994267b61ce69e26120362x1280x1709.JPEG"
    ]
  },
  {
    "text": "A uterine artery embolization is being planned for a patient with uterine fibroids. Blood flow in which of the following arteries will not be affected by this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Spiral artery"
      },
      {
        "id": 2,
        "text": "Sampson's artery"
      },
      {
        "id": 3,
        "text": "Vaginal artery"
      },
      {
        "id": 4,
        "text": "Arcuate artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given case scenario, blood flow in the&nbsp;<strong>vaginal artery</strong> will not be affected, as it is not a branch of the uterine artery.&nbsp;The vaginal artery&nbsp;is a branch of the <strong>anterior division</strong> of the<strong> internal iliac artery.</strong>&nbsp;</p>\n<p>It is homologous to the inferior vesical artery in males. It <strong>supplies</strong> the <strong>vagina</strong> and the base of the <strong>bladder</strong> in women. It should not be confused with vaginal branches of the uterine artery.</p>\n<p><strong>Branches of the uterine artery</strong>:</p>\n<ul>\n<li>Ureteric branch</li>\n<li>Vaginal branches (descending) - these unite to form the anterior and posterior azygos arteries of the vagina</li>\n<li>Circular cervical branch</li>\n<li><strong>Sampson's</strong> artery - it runs in under the round ligament. It&nbsp;represents the anastomosis of the uterine&nbsp;artery&nbsp;and ovarian&nbsp;artery.</li>\n<li><strong>Arcuate</strong>--&gt; Radial--&gt; Basal--&gt; <strong>Spiral</strong> and straight arterioles of the functional layer of the endometrium</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e88287d5382a4a84b93c05221b6b7b11x1280x1450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f05ab2f5ae5d49be96c63c44b9e2b454x1280x1709.JPEG"
    ]
  },
  {
    "text": "A patient with stress incontinence required surgical management. While performing a Burch colposuspension, the surgeon approached the space of Retzius. What is this space also known as?",
    "choices": [
      {
        "id": 1,
        "text": "Prevesical or presacral space"
      },
      {
        "id": 2,
        "text": "Presacral or prerectal space"
      },
      {
        "id": 3,
        "text": "Presacral or retropubic space"
      },
      {
        "id": 4,
        "text": "Prevesical or retropubic space"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>space of Retzius</strong> is the other name for <strong>pre</strong><strong>vesical</strong>&nbsp;or <strong>r</strong><strong>etropubic space</strong>.</p>\n<p>Burch colposuspension is a procedure done to relieve stress urinary incontinence. If an extraperitoneal approach is selected, the retropubic space is&nbsp;<strong>entered by perforating the transversalis fascia</strong> layer of the anterior abdominal wall.</p>\n<p>Once the retropubic space is dissected, the bladder neck and the vaginal fascia underneath are identified. The bladder is mobilized to the opposite side. At each side of the bladder neck, two to four, preferably non\u2010absorbable sutures are placed in the space of Retzius.</p>\n<p>Note:The <strong>presacral space</strong> is a <strong>retroperitoneal</strong> space that lies between the peritoneum of the posterior abdominal wall and the sacrum. It <strong>contains</strong> the <strong>superior and inferior hypogastric plexuses.</strong> The sacral sympathetic trunk lies against the&nbsp;sacrum&rsquo;s ventral surface.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db321c7ca33e461f9ef875aac2235a50x1280x1543.JPEG"
    ]
  }
];
        let quizName = '01 Anatomy Of Female Pelvic Organs';
        const quizFilename = '01-anatomy-of-female-pelvic-organs-6105efc9.html';
        let hierarchy = ["Marrow", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>