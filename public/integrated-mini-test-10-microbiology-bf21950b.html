<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 10 - Microbiology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 20-year-old man from West Bengal presents with recurrent fever with chills for the past 3 months with progressive weakness and abdominal discomfort. On examination, he has hepatosplenomegaly. Bone marrow aspiration finding is shown in the image below. Which of the following skin tests can be used to know the prior exposure to this parasite?",
    "choices": [
      {
        "id": 1,
        "text": "Frenkel's test"
      },
      {
        "id": 2,
        "text": "Montenegro test"
      },
      {
        "id": 3,
        "text": "Fairley's test"
      },
      {
        "id": 4,
        "text": "Bachman intradermal test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a 20-year-old man presenting with fever with chills, progressive weakness, and abdominal discomfort for the past 3 months and the bone marrow aspirate showing <strong>Leishman<span class=\"s1\">-</span><span class=\"s2\">Dono</span><span class=\"s3\">van</span>\u00a0<span class=\"s2\">bodi</span></strong><span class=\"s3\"><strong>es</strong>\u00a0</span>are suggestive of <strong>visceral leishmaniasis.</strong>\u00a0A positive <strong>Montenegro skin test</strong>\u00a0i<span class=\"s1\">n</span><span class=\"s2\">d</span><span class=\"s1\">i</span>cates pr<span class=\"s3\">i</span>or exposure to the leishmanial paras<span class=\"s3\">it</span>e.</p>\n<p><strong>Leishmaniasis\u00a0</strong>is a slowly progressing indigenous disease caused by a protozoan parasite of the genus\u00a0<em>Leishmania</em>. It is transmitted by the bite of an infected\u00a0<strong>female Phlebotomus sandfly, </strong>which inoculates the flagellated promastigotes into the skin of the host in developing countries.<strong>\u00a0</strong>In India, it is endemic to\u00a0<strong>Bihar</strong>, West Bengal, Jharkhand, and Uttar Pradesh.</p>\n<p>Causative organisms include:</p>\n<ul>\n<li>Old world leishmaniasis:\u00a0<em>Leishmania donovani, Leishmania major,\u00a0</em>and<em>\u00a0Leishmania tropica</em></li>\n<li>New world leishmaniasis:\u00a0<em>Leishmania mexicana\u00a0</em>complex and<em>\u00a0Leishmania braziliensis\u00a0</em>complex</li>\n</ul>\n<p>The image given below shows a phlebotomus sandfly.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf71a06e8cbe47c8ac1f6352746f86a4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/30ea1e1ffcee41568b3ff3cb13803332x1280x864.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e3b2ab248ce4f41a8db8785d85445c3x650x650.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/97485e47f8b642ba9ff5a6dadbd2b024x600x611.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da583dd3e1f14d4dae215f44a00ceb1fx619x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f02dc7d88bc466baafa6360654af533x720x539.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d39a47d2d8ac47a293c26cb97318d865x720x531.PNG"
    ]
  },
  {
    "text": "Method of choice to sterilize the given instrument is:",
    "choices": [
      {
        "id": 1,
        "text": "Autoclave"
      },
      {
        "id": 2,
        "text": "Microwave oven"
      },
      {
        "id": 3,
        "text": "Isopropyl alcohol"
      },
      {
        "id": 4,
        "text": "Ethylene oxide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Isopropyl alcohol</strong> is the method of choice to sterilize<strong> clinical thermometer.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6d66c82b12cb44d08b34b5ea0c2cfc6e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child was brought to your clinic with an erythematous rash on the cheek, which later spread downwards to involve his trunk and limbs. He has also had a low-grade fever, and mild upper respiratory tract infection for the past few days. The suspected organism contains:",
    "choices": [
      {
        "id": 1,
        "text": "Single stranded RNA"
      },
      {
        "id": 2,
        "text": "Single stranded DNA"
      },
      {
        "id": 3,
        "text": "Double stranded DNA"
      },
      {
        "id": 4,
        "text": "Double stranded RNA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical scenario and image are strongly suggestive of <strong>erythema infectiosum</strong>. The image is showing the classical <strong>slapped cheek appearance</strong>. It is caused\u00a0by\u00a0<strong>Parvoviruses.\u00a0</strong></span><span data-preserver-spaces=\"true\"><strong>Parvovirus B19</strong> is a non-enveloped <strong>single-stranded DNA</strong> virus.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Clinically, parvovirus B-19 infection may have several presentations:</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Erythema infectiosum</strong>- Also known as the<strong> fifth disease.</strong> The incubation period after infection is typically around 1-2 weeks.\u00a0</span>The hallmark of erythema infectiosum is the\u00a0characteristic rash, which appears initially as\u00a0erythematous facial flushing, often described as a\u00a0\u201c<strong>slapped cheek</strong>\u201d appearance. Later, the rash spreads rapidly or concurrently to the trunk and proximal extremities as diffuse macular erythema. The child may be febrile.\u00a0</p>\n<p><strong>Transient aplastic crisis</strong>- It may be seen in patients with underlying\u00a0<strong>chronic hemolytic anaemia</strong> like sickle-cell disease, thalassemia, hereditary spherocytosis, and RBC enzyme deficiencies like pyruvate kinase deficiency. Patients with aplastic crisis appear ill with fever, malaise, and paleness with tachycardia and tachypnea due to profound anaemia. The rash may or may not be present.\u00a0</p>\n<p><strong>Pure red cell aplasia</strong>- Persistent Parvovirus B19 infection in immunocompromised patients can cause chronic suppression of bone marrow and chronic anaemia, leading to pure red cell aplasia.</p>\n<p>Maternal infection is associated with<strong> non-immune fetal hydrops</strong> and intrauterine fetal demise.</p>\n<p>The diagnosis of erythema infectiosum is made clinically and does not require investigations routinely. Detection of viral DNA in the blood by PCR or nucleic acid hybridisation may be done for immunocompromised cases or prenatal diagnosis of infection.</p>\n<p>It is self-limited and resolves on its own. IVIG may be given to immunocompromised children.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1178cb43830e4615b80a411d80703b50.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following agglutination patterns in the Weil-Felix Reaction will be seen in a patient diagnosed with scrub typhus?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>OX K</strong>\u00a0agglutination in a\u00a0<strong>Weil-Felix Reaction </strong>will be seen in a case of<strong> scrub typhus.</strong></p>\n<p><strong><span data-preserver-spaces=\"true\">Scrub typhus\u00a0</span></strong><span data-preserver-spaces=\"true\">is also known as chigger-borne typhus, which is caused by <em><strong>O. tsutsugamushi</strong></em>. The vector is <strong>trombiculid mite.</strong> Humans are infected when they are bitten by the mite larvae known as\u00a0</span><strong><span data-preserver-spaces=\"true\">chiggers.\u00a0</span></strong></p>\n<p><span data-preserver-spaces=\"true\">The incubation period is 1\u20133 weeks. The patient typically develops a characteristic<strong>\u00a0eschar</strong>\u00a0at the site of the mite bite, with\u00a0</span><strong><span data-preserver-spaces=\"true\">regional lymphadenopathy</span></strong><span data-preserver-spaces=\"true\">\u00a0and\u00a0<strong>maculopapular rash</strong>.</span></p>\n<p>Weil-Felix reaction is a\u00a0<strong>heterophile agglutination reaction</strong>, wherein the sera are tested for agglutinins to the O antigens of certain <em>Proteus</em> strains\u2014<strong><em>Proteus vulgaris</em></strong> -\u00a0<strong>OX 19 and OX 2 and <em>Proteus mirabilis</em> OX K.\u00a0</strong>The basis of the test is sharing an alkali-stable carbohydrate antigen by some <em>Rickettsiae</em> and by some strains of <em>Proteus</em>.\u00a0<strong>OX K</strong>\u00a0is agglutinated\u00a0<strong>only\u00a0</strong>in scrub typhus.</p>\n<p>Inference of Agglutination Pattern in Weil-Felix Reaction:</p>\n<table style=\"width: 352.625px;\">\n<tbody>\n<tr>\n<td style=\"width: 154px;\">\n<p><strong>DISEASE\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</strong></p>\n</td>\n<td style=\"width: 65px;\">\n<p><strong>OX 19</strong></p>\n</td>\n<td style=\"width: 49px;\">\n<p><strong>OX 2</strong></p>\n</td>\n<td style=\"width: 53.625px;\">\n<p><strong>OX K</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Epidemic typhus</p>\n</td>\n<td style=\"width: 65px;\">\n<p>+++</p>\n</td>\n<td style=\"width: 49px;\">\n<p>+</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>Endemic typhus</p>\n</td>\n<td style=\"width: 65px;\">\n<p>+++</p>\n</td>\n<td style=\"width: 49px;\">\n<p>+/-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p>RMSF</p>\n</td>\n<td style=\"width: 65px;\">\n<p>++</p>\n</td>\n<td style=\"width: 49px;\">\n<p>++</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p>-</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 154px;\">\n<p><strong>Scrub typhus</strong></p>\n</td>\n<td style=\"width: 65px;\">\n<p>-</p>\n</td>\n<td style=\"width: 49px;\">\n<p>-</p>\n</td>\n<td style=\"width: 53.625px;\">\n<p><strong>+++</strong></p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old boy is brought to the OPD with fever, earache, and stiffness on opening the mouth. On examination, the parotid gland is enlarged, as shown below, and tender. Choose the correct strain used to prepare a vaccine for this disease.",
    "choices": [
      {
        "id": 1,
        "text": "Edmonston-Zagreb"
      },
      {
        "id": 2,
        "text": "17D"
      },
      {
        "id": 3,
        "text": "Oka"
      },
      {
        "id": 4,
        "text": "Jeryl Lynn"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical diagnosis in this case, based on clinical features and image, is most likely <strong>Mumps</strong>. The strain used to prepare the Mumps vaccine is <strong>Jeryl Lynn</strong>. It\u00a0is a <strong>live attenuated</strong> vaccine.</p>\n<p>Mumps is an infectious disease caused by an <strong>RNA virus</strong> from the <strong>paramyxoviridae family</strong>.\u00a0Infection is caused by air droplets through the respiratory route and also through the conjunctiva.</p>\n<p>The incubation period is <strong>12-25 days</strong>. Then parotid swelling appears first. It is unilateral, to begin with, but may become bilateral. Some patients may have a prodrome of fever and malaise before the swelling appears.</p>\n<p>Major<strong>\u00a0complications </strong>of Mumps include <strong>epididymal orchitis</strong> and <strong>meningoencephalitis</strong>.</p>\n<p>Mumps vaccine is given only<strong> after one year of age</strong> because, before that, maternal antibodies may interfere with its action. It can be given separately or as a part of <strong>Measles, Mumps, Rubella (MMR)</strong> vaccine.</p>\n<p>Other options:</p>\n<p>Option A: Edmonston-Zagreb strain is used for the <strong>Measles</strong> vaccine.</p>\n<p>Option B: The 17D strain is used for the <strong>Yellow fever</strong> vaccine.</p>\n<p>Option C: The Oka strain is used for the <strong>Varicella</strong> vaccine.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5badcb621a594025a72ebd7d6403f11d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young male patient presents with a high-grade fever, headache, and weakness for 4 days. The microscopic examination of the thin blood smear is given below. Which of the following is the definitive host of the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Phlebotomus sandfly"
      },
      {
        "id": 2,
        "text": "Ixodid tick"
      },
      {
        "id": 3,
        "text": "Anopheles"
      },
      {
        "id": 4,
        "text": "Mites"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario, along with the thin blood smear showing a <strong>maltese cross appearance,</strong> is suggestive of\u00a0<strong><em>Babesia microti</em></strong> infection. The <strong>definitive</strong> host for <em>Babesia</em> is <strong>ixodid ticks,</strong> whereas humans are the incidental, dead-end hosts.</p>\n<p><strong><em>Babesia microti</em></strong> causes babesiosis. It is a zoonotic infection that resembles malaria and is transmitted by a bite of <strong>ixodid ticks</strong>.\u00a0Patients present with <strong>febrile illness, headache,</strong> and <strong>weakness.</strong> Lab investigations show <strong>hemolysis</strong> and hemoglobinuria.</p>\n<p>On microscopic examination by Giemsa stain, <em>Babesia</em> trophozoites appear as intraerythrocytic round or pyriform or ring form. The <strong>ring form</strong> is the <strong>most common,</strong> and it lacks the central hemozoin deposit, which differentiates it from <em>P. falciparum</em>. Other distinguishing features are the <strong>absence of schizonts</strong> and<strong> gametocytes</strong> and the presence of <strong>tetrads/ maltese crosses,</strong>\u00a0which are pathognomic of <em>B. microti</em> or <em>B. duncani.</em></p>\n<p>The image given below shows the maltese cross appearance seen in infection with <em>Babesia microti</em>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5014e0e031346498ba4185855d92879.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5899a3ee0e31452183b021f50fbde296x1279x1448.JPEG"
    ]
  },
  {
    "text": "Community weed removal from ponds for the control of a disease was documented in Shertallai, Kerala, India.  Which of the following water-related diseases can be controlled by this approach?",
    "choices": [
      {
        "id": 1,
        "text": "Weil's disease"
      },
      {
        "id": 2,
        "text": "Filariasis"
      },
      {
        "id": 3,
        "text": "Cholera"
      },
      {
        "id": 4,
        "text": "Giardiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 304\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 305\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Filariasis\u00a0</strong>(caused by\u00a0<em>B.malayi\u00a0</em>), a water-related disease, can be controlled by the removal of weeds from ponds. It is transmitted by the <em><strong>Mansonia</strong></em>\u00a0species of mosquito that\u00a0<strong>breeds</strong> in <strong>water</strong>\u00a0bodies containing<strong>\u00a0</strong>aquatic vegetation<strong>\u00a0</strong>and<strong>\u00a0</strong>can also be controlled by the use of\u00a0<strong>herbicides\u00a0</strong>that destroy aquatic vegetation.</p>\n<div title=\"Page 304\">\n<div title=\"Page 305\">\n<div title=\"Page 304\">\n<div title=\"Page 305\">\n<p>Adult\u00a0<strong><em>Mansonia</em>\u00a0mosquitos</strong>\u00a0are big, black or brown mosquitoes with speckling on their wings and legs. They\u00a0breed in ponds\u00a0and lakes<strong>\u00a0</strong>containing\u00a0certain\u00a0aquatic plants, especially the floating types like\u00a0<strong>Pistia stratiotes</strong>\u00a0and water hyacinth. Their breeding is not possible in absence of these plants. Thus,\u00a0<strong>removing</strong> the<strong> aquatic vegetation\u00a0</strong>and destroying the vegetation using\u00a0<strong>herbicides </strong>can be done to\u00a0<strong>control\u00a0</strong><strong>filariasis</strong>.\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n<div title=\"Page 308\">\n<div>\n<div>\n<p>The image below shows a picture of a Mansonia mosquito:\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1ef8600cdd0646799d2330f3995724e8x1200x830.JPEG"
    ]
  },
  {
    "text": "You notice that an elderly patient in the neurology ward has fever for 3 days. He was admitted for a stroke 2 weeks ago. The blood culture shows no growth while the urine culture shows growth on the MacConkey agar as seen in the image below. Urease test is positive. What is the likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Klebsiella"
      },
      {
        "id": 2,
        "text": "Escherichia coli"
      },
      {
        "id": 3,
        "text": "Proteus"
      },
      {
        "id": 4,
        "text": "Pseudomonas"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The urine culture shows <strong>mucoid colonies</strong> on MacConkey agar, indicating that the organism is a <strong>lactose fermenter</strong>. Also, the <strong>urease</strong> test was <strong>positive</strong>. This suggests that a urinary tract infection occurred in a hospitalised patient, likely caused by <strong>Klebsiella</strong>.\u00a0</p>\n<p>Klebsiella is the most common cause of catheter-associated <strong>urinary tract infections</strong>. It has the cultural characteristics of large mucoid colonies on MacConkey agar. Urease is positive only for Klebsiella, proteus and morganella in Enterobacteriaceae.\u00a0</p>\n<p>Enterobacteriaceae family is classified based on their action on lactose present in MacConkey's medium:</p>\n<ul>\n<li>Lactose fermenters - Escherichia, <strong>Klebsiella</strong></li>\n<li>Late lactose fermenters - Shigella sonnei (More than 12-24 hours)</li>\n<li>Non-lactose fermenters- Salmonella species, Shigella species</li>\n</ul>\n<p>Other options\u00a0</p>\n<p>Option B: <strong>Escherichia coli</strong> is <strong>urease</strong>-<strong>negative</strong> and forms smooth, bright pink colonies on MacConkey agar</p>\n<p>Options C and D: <strong>Proteus</strong> and <strong>pseudomonas</strong> are <strong>non lactose</strong> fermenters thus form <strong>pale colourless colonies</strong> on MacConkey agar.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c459210e4a4a4806b629151b20d730f5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old male patient presented with low-grade fever, loss of weight, and dry nocturnal cough for the past 6 months. Physical examination wheezing and crepitations on chest auscultation and mild hepatosplenomegaly. Eosinophil count- 10000/mm3. Serology revealed high levels of IgE and positive for filarial antibodies. Which of the following is not true regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is directly due to lymphatic involvement"
      },
      {
        "id": 2,
        "text": "It is also known as Meyers Kouwenaar syndrome"
      },
      {
        "id": 3,
        "text": "Microfilaria cannot be demonstrated in blood"
      },
      {
        "id": 4,
        "text": "Diethylcarmazine is the treatment of choice"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a young adult with pulmonary symptoms, pronounced blood eosinophilia, elevated serum IgE, and anti-filarial antibodies are suggestive of Occult Filariasis, in this case, <strong>Tropical Pulmonary Eosinophilia.\u00a0</strong>It occurs as a result of a <strong>hypersensitivity reaction to micro-filarial antigens,</strong> not directly due to lymphatic involvement.</p>\n<div><strong>Tropical pulmonary eosinophilia (TPE)</strong> is a hyperresponsive pulmonary syndrome\u00a0in response to trapped microfilariae within the lung tissue.\u00a0</div>\n<p>It\u00a0is a manifestation of <strong>occult filariasis</strong> (also known as <strong>Meyer's-Kouwenaar syndrome</strong>).\u00a0It occurs as a result of\u00a0<strong>type 1\u00a0hypersensitivity reaction to micro-filarial antigens,</strong> not directly due to lymphatic involvement.</p>\n<p>More common in <strong>children and young adults</strong> in <strong>filarial endemic zones.</strong></p>\n<p>Clinical manifestations:</p>\n<ul>\n<li>Nocturnal paroxysmal wheeze and cough</li>\n<li>Weight loss, low-grade fever, lymphadenopathy</li>\n<li>Hepatosplenomegaly</li>\n<li><strong>Eosinophilia &gt; 3000/\u03bcL, </strong>leucocytosis</li>\n<li><strong>X-ray chest</strong>: Mottled opacities similar to miliary TB, increased broncho-vascular markings</li>\n<li>PFT: <strong>Restrictive changes in most cases </strong>and obstructive defects in half</li>\n<li>Elevated levels of<strong> IgE</strong> and <strong>Antifilarial antibody titers</strong></li>\n<li>Microfilaria are sequestrated in the lungs and hence <strong>not found in blood</strong></li>\n</ul>\n<p>Treatment: <strong>Diethylcarbamazine(DEC)</strong></p>\n<p><strong>Differntial Diagnosis:</strong></p>\n<ul>\n<li>Loffler syndrome</li>\n<li>Allergic bronchopulmonary aspergillosis</li>\n<li>Churg strauss syndrome</li>\n<li>\n<div>Chronic eosinophilic pneumonia</div>\n</li>\n<li>\n<div>Hypereosinophilic syndromes</div>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female patient presents to the physician with sudden-onset fever, rash, conjunctivitis, muscle and joint pain, malaise, and headache. On further evaluation, she tested positive for the Zika virus. She has an increased risk of developing which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Guillain-Barre syndrome"
      },
      {
        "id": 2,
        "text": "Glomerulonephritis"
      },
      {
        "id": 3,
        "text": "Subacute sclerosing panencephalitis"
      },
      {
        "id": 4,
        "text": "Thyroiditis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient who tested positive for the Zika virus has an increased risk of developing\u00a0<strong>Guillan-Barre syndrome.</strong></p>\n<p><span data-preserver-spaces=\"true\">Zika virus is a flavivirus acquired mainly through the <strong>bite of an infected female\u00a0</strong><em><strong>Aedes aegypti </strong></em><strong>mosquito</strong><em>.\u00a0</em>However, transmission can also occur <strong>perinatally through sexual contact</strong> with an infected individual, <strong>breastfeeding</strong>, and<strong> blood transfusion</strong>.\u00a0</span></p>\n<p>Congenital transmission of the Zika virus leads to <strong>fetal microcephaly</strong>.\u00a0<span data-preserver-spaces=\"true\">Zika virus infection during pregnancy may also lead to\u00a0</span><span data-preserver-spaces=\"true\">other malformations, including limb contractures, high muscle tone, eye abnormalities, and hearing loss, known as <strong>congenital Zika syndrome</strong>.</span></p>\n<p>Zika virus infection is characterized by influenza-like clinical signs, including fever, headache, and malaise. An itchy, <strong>maculopapular rash</strong>, conjunctivitis, myalgia, and arthralgia usually accompany or follow those manifestations.</p>\n<p>The <strong>complications</strong> of the Zika virus infection include <strong>Guillan-Barre syndrome</strong>, encephalitis, meningoencephalitis, peripheral neuropathies, and neurological birth defects.\u00a0Other complications of pregnancy include\u00a0<strong>preterm birth\u00a0</strong>and\u00a0<strong>miscarriage.</strong></p>\n<p>Other Options:</p>\n<p>Option B: <strong>Glomerulonephritis</strong> is seen 1-4 weeks after the acute infection of Streptococcus pyogenes.\u00a0</p>\n<p>Option C:<strong> Subacute sclerosing panencephalitis</strong> (SSPE) is a rare delayed sequel to infection with the measles virus. It is seen in young adolescents and is characterized by progressive deterioration of mental and motor functions.</p>\n<p>Option D: <strong>Thyroiditis</strong> is not a known complication of Zika virus infection. Some viruses like mumps and influenza can cause subacute thyroiditis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a PHC officer, you conduct a session on viral diseases that are more likely to affect the rice farmers in your area. You focus on a disease which follows a bird-arthropod-human transmission route where man is an incidental dead-end host. Identify the disease.",
    "choices": [
      {
        "id": 1,
        "text": "Ebola virus"
      },
      {
        "id": 2,
        "text": "Nipah virus"
      },
      {
        "id": 3,
        "text": "Japanese encephalitis"
      },
      {
        "id": 4,
        "text": "Zika virus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The viral disease discussed in the above scenario is <strong>Japanese encephalitis, </strong>which follows\u00a0<strong>bird-arthropod-human</strong> transmission, where <strong>man</strong> is an incidental <strong>dead-end host.\u00a0</strong></p>\n<p>Japanese encephalitis (JE) is a <strong>mosquito-borne encephalitis</strong> caused by a group B arbovirus <strong>(Flavivirus) </strong>and transmitted by the bite of <strong>Culex</strong> mosquitoes, specifically\u00a0Culex tritaeniorhynchus\u00a0and\u00a0Culex vishnui (common in India), which typically breed in <strong>irrigated rice fields</strong>. Therefore, <strong>rice farmers </strong>are more likely to be affected.</p>\n<p>The image below shows the life cycle of the Japanese B encephalitis virus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/cd225f15e65f491ba2d32d1e12ae9258.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d37b0ead09c243da81b3beb53938c5d8x720x449.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a1283ae8d794dfab9ab1f1508cdf977x720x1440.JPEG"
    ]
  },
  {
    "text": "A 10-year-old boy returned from a birthday party and began vomiting 4-5 hours later, followed by a few episodes of loose stools, but had no fever. Other children who had attended the party reported a similar illness. Food samples were collected and sent for toxin detection by a test based on the following principle. This test is known as:",
    "choices": [
      {
        "id": 1,
        "text": "Cassette ELISA"
      },
      {
        "id": 2,
        "text": "Sandwich ELISA"
      },
      {
        "id": 3,
        "text": "Competitive ELISA"
      },
      {
        "id": 4,
        "text": "Indirect ELISA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows <strong>Sandwich<span id=\"Reverse_ELISA\" class=\"mw-headline\">\u00a0ELISA</span></strong><span id=\"Reverse_ELISA\" class=\"mw-headline\">.\u00a0</span>The above clinical scenario is suggestive of <strong>food poisoning</strong> caused by <em><strong>Staphylococcus aureus</strong></em>.</p>\n<p>The symptoms of\u00a0food poisoning caused by <em>S\u00a0aureus</em> appear within 1-8 hours. Multiple people are exposed to the pathogen from a common source and present with vomiting, loose stools but no fever. Foods from outbreaks of food poisoning is examined for the presence of <strong>staphylococcal enterotoxin A (SEA)</strong> by a <strong>sandwich ELISA</strong>.</p>\n<p><strong><span id=\"Reverse_ELISA\" class=\"mw-headline\">ELISA</span></strong>\u00a0<span id=\"Reverse_ELISA\" class=\"mw-headline\">(</span><span id=\"Reverse_ELISA\" class=\"mw-headline\">Enzyme-linked immunosorbent assay)\u00a0</span>involves the use of an <strong>immunosorbent</strong>, which is an absorbing material that is specific for one of the components of the reaction, either the <strong>antigen or antibody</strong>. This may be a <strong>particulate</strong> phase (cellulose or agarose), or a <strong>solid</strong> phase (polystyrene, polyvinyl, or polycarbonate tubes or microwells). ELISA is done using <strong>96-well microtitre plates</strong> suitable for automation.</p>\n<p><strong>Sandwich ELISA</strong> is used for antigen detection in the patient samples. The <strong>antigen is sandwiched between two layers of antibodies</strong> - capture and detection antibodies.</p>\n<p><span class=\"mw-headline\">The following <strong>steps</strong> are followed in <strong>Sandwich ELISA</strong>:</span></p>\n<div class=\"page\" title=\"Page 149\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ol>\n<li>The<strong> capture</strong>\u00a0<strong>antibody</strong> is immobilized on a microtiter well.</li>\n<li>A sample containing <strong>antigen</strong> is added and allowed to react with the immobilized antibody.</li>\n<li>After the well is washed, a second <strong>enzyme-linked antibody</strong> (Detecting antibody) specific to the antigen is added and allowed to react with the bound antigen.</li>\n<li>After any free second antibody is removed by washing, the\u00a0<strong>substrate</strong> is added. This substrate is converted by the enzyme to detectable colored form and the <strong>colored reaction product</strong> is measured.</li>\n</ol>\n</div>\n</div>\n</div>\n</div>\n<p>Other options:</p>\n<p><strong>Option A: </strong><strong>Cassette ELISA</strong>: Here, each specimen is tested in a separate disposable cassette and gives rapid results (10-15 minutes). There is no need for microplate washers or readers and the result can be read visually. Example: Dot Blot Assay used for the detection of HIV type 1 and 2 antibodies.</p>\n<p><strong>Option C: </strong><strong>Competitive ELISA</strong>: Both the unknown antigen (sample) and the known antigen (standard) compete with each other for a fixed amount of antibody.</p>\n<p><strong>Option D: </strong><strong>Indirect ELISA</strong>: Antibody in the sample can be detected or quantitatively measured using this method.\u00a0Serum or some other sample containing primary antibody (Ab1) is added to an antigen-coated microtiter well and allowed to react. Enzyme-conjugated secondary anti-isotype antibody (Ab2) is added which binds to the primary antibody.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6d39dddcbc414ce9b074ceb7eb2b5210.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57b1a572d7fe4fca99c30005e0b633d1x1280x2225.JPEG"
    ]
  },
  {
    "text": "A woman from rural South America presents with shortness of breath and palpitations. Examination of the eye is shown in the image given below. Echocardiography reveals biventricular dilatation with massive cardiac enlargement. Which vector is most likely responsible for transmitting this patient's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Dermacentor tick"
      },
      {
        "id": 2,
        "text": "Soft tick"
      },
      {
        "id": 3,
        "text": "Reduviid bug"
      },
      {
        "id": 4,
        "text": "Tsetse fly"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario, along with an image showing <span data-preserver-spaces=\"true\"><strong>Romana\u2019s sign</strong></span> and echo findings of <strong>dilated cardiomyopathy,</strong> are suggestive of <strong>Chagas disease</strong>.\u00a0It is caused by <em><strong>Trypanosoma cruzi</strong></em>, transmitted by the <strong>reduviid bug.</strong></p>\n<p><strong>Chagas disease</strong> is a zoonotic disease caused by the protozoa <em><strong>Trypanosoma cruzi</strong></em>. It is endemic to <strong>n</strong><strong>orth, central, </strong>and <strong>south America. </strong>It is transmitted by the bite of a<strong> reduviid bug</strong>/ kissing bug<strong>.</strong></p>\n<p><em>Trypanosoma cruzi</em> exists in three forms:</p>\n<ul>\n<li><strong>Epimastigotes</strong>- in the reduviid bug</li>\n<li><strong>Trypomastigotes-</strong> in the bloodstream</li>\n<li><strong>Amastigotes-\u00a0</strong>intracellular replicating form</li>\n</ul>\n<p>Clinically, the infection course of Chagas disease is divided into acute and chronic phases.</p>\n<p>In the acute phase, the majority of the patients will be asymptomatic.\u00a0Fever, regional lymphadenitis, <strong>chagoma</strong> (localised subcutaneous nodule at the bite site), and the <strong>Roma\u00f1a's sign</strong> (unilateral swelling of the eyelids) may be seen in the acute phase.\u00a0</p>\n<p>The chronic phase is characterised by the following findings:</p>\n<ul>\n<li><strong>Chagasic dilated cardiomyopathy</strong> with\u00a0marked <strong>bilateral ventricular enlargement.</strong> This leads to leading to congestive heart failure, presenting as <strong>shortness of breath.</strong> Endomyocardial biopsy shows fibrosis and the presence of intracellular parasites.</li>\n<li><strong>Megaesophagus</strong> and <strong>megacolon</strong>.\u00a0</li>\n</ul>\n<div class=\"page\" title=\"Page 728\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is confirmed by demonstrating trypomastigotes on microscopy of blood smears or polymerase chain reactions during the acute phase. In the chronic phase, detection of <em>anti-T. cruzi </em>IgG or endomyocardial biopsy is helpful.</p>\n</div>\n<div class=\"column\">\n<p>Treatment<span data-preserver-spaces=\"true\">\u00a0of Chagas disease is most effective when administered\u00a0</span><strong><span data-preserver-spaces=\"true\">early</span></strong><span data-preserver-spaces=\"true\">\u00a0in the course of infection</span><span data-preserver-spaces=\"true\">\u00a0and has a lesser efficacy in chronic Chagas.\u00a0</span><strong>Benznidazole</strong> and<strong>\u00a0nifurtimox</strong> can be used for the treatment.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The image given below shows a reduviid bug.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c2c67379b29641b19bcc3b6f32bd2035.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5ea8930a1605410294bf509bdbfcf7fbx600x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d342af277a324a33b0b3042b2baf21c9x800x450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21155649b31c4c3fbc660c7cc860de0cx564x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/41202a7328ba48d6b616ec99482a88c1x720x480.JPEG"
    ]
  },
  {
    "text": "A 4-year-old child with excoriation of anal skin was brought by his mother to the pediatric OPD. She states her son scratches his anal area frequently during nighttime. The life cycle of the causative organism is given below. Which of the following is not a feature of the egg of this organism?",
    "choices": [
      {
        "id": 1,
        "text": "Bile stained"
      },
      {
        "id": 2,
        "text": "Floats in saturated salt solution"
      },
      {
        "id": 3,
        "text": "Plano convex shape"
      },
      {
        "id": 4,
        "text": "Contains a tadpole-shaped coiled embryo"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong>\u00a0</strong>given clinical scenario of frequent <strong>anal</strong> area <strong>scratching</strong> during nighttime,\u00a0<strong>excoriation </strong>of the skin<strong> around the anus</strong>, and the given life cycle of humans acquiring infection by ingestion of embryonated eggs, which are released by the gravid female over the perianal skin are suggestive of <strong>pinworm</strong> or <em><strong>E</strong><strong>nterobius vermicularis</strong></em>\u00a0infection. The <strong>eggs</strong> of pinworms are\u00a0<strong>not bile-stained.</strong></p>\n<p>The pinworm<strong> eggs</strong> have a characteristic <strong>plano-convex shape</strong>. They are <strong>colorless</strong> and <strong>not bile-stained</strong>. They have a <strong>thick</strong>, <strong>double-layered</strong>,<strong> transparent eggshell</strong>. The eggs also <strong>float in</strong> a <strong>saturated salt solution</strong>. Inside lies a <strong>tadpole-shaped coiled embryo</strong>. The eggs are <strong>highly infectious,</strong> and reinfection should be prevented by regular washing of bed linens, towels, and clothing in hot water.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d26e24206046404c83b01ad524ae9a97.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/478b874205594cdd921c4e82bad2898cx720x480.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b56e96444d34cb08faad1983497a5c6x600x936.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/449cb5b8e393492fb36af5857924043dx1279x1309.JPEG"
    ]
  },
  {
    "text": "A patient from North America presented with acute pulmonary edema after an episode of fever, myalgia, and headache. He was found to be infected with the Sin Nombre virus. What type of virus is this?",
    "choices": [
      {
        "id": 1,
        "text": "Nipah virus"
      },
      {
        "id": 2,
        "text": "Hantavirus"
      },
      {
        "id": 3,
        "text": "Ebola virus"
      },
      {
        "id": 4,
        "text": "Marburg virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sin Nombre virus</strong> is a type of <strong>Hantavirus.\u00a0</strong>The given clinical feature is suggestive of <strong>Hantavirus pulmonary syndrome.\u00a0</strong></p>\n<p>Hantaviruses are classified under Bunyaviridae. They are rodent-borne viruses that are transmitted by\u00a0<strong>inhalation</strong>\u00a0of the virus contained in dried\u00a0<strong>excreta</strong>\u00a0of\u00a0<strong>rodents.</strong>\u00a0They are the natural pathogens of rodents like mice, rats, and voles. <strong>No human-to-human</strong> <strong>transmission</strong> is reported.</p>\n<p>Clinical features:\u00a0</p>\n<ul>\n<li>Hemorrhagic fever with renal syndrome (HFRS) -\u00a0 Presents with\u00a0<strong>acute kidney injury, hemorrhages, fever</strong>, and circulatory collapse</li>\n<li>Hantavirus pulmonary syndrome (HPS) -\u00a0Characterized by the acute onset of severe<strong> pulmonary edema</strong> after 3\u20134 days of a prodromal illness of fever, malaise, myalgia, and gastrointestinal symptoms</li>\n</ul>\n<p>Laboratory diagnosis depends on viral nucleic acid detection by\u00a0<strong>RT-PCR.</strong></p>\n<p>Hantaviruses are emerging pathogens that could be engineered for mass dissemination in the future because of\u00a0availability,\u00a0ease of production, dissemination, the potential for high morbidity and mortality rates, and major health impact. It is a <strong>category C bioterrorism</strong> agent.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male is diagnosed with viral hemorrhagic fever. You suspect the Zaire strain of the virus to be responsible for the infection. The virus involved is highly virulent and morphologically appears as long filamentous threads. After further evaluation, you start him on Inmazeb. What family does the virus implicated in this condition belong to?",
    "choices": [
      {
        "id": 1,
        "text": "Flaviviridae"
      },
      {
        "id": 2,
        "text": "Arenaviridae"
      },
      {
        "id": 3,
        "text": "Filoviridae"
      },
      {
        "id": 4,
        "text": "Bunyaviridae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the above clinical scenario, the presence of viral hemorrhagic fever caused by <strong>Zaire strain</strong> of a <strong>highly virulent</strong> virus which, morphologically appears as <strong>long filamentous threads</strong> is highly suggestive of <strong>Ebola Virus</strong> which belongs to t<span data-preserver-spaces=\"true\">he\u00a0</span><strong><span data-preserver-spaces=\"true\">Filoviridae</span></strong><span data-preserver-spaces=\"true\">\u00a0family.</span></p>\n<p>This diagnosis is confirmed by the drug used to treat this patient, <strong>Inmazeb (atoltivimab, maftivimab, and odesivimab)</strong>, a mixture of three\u00a0<strong>monoclonal antibodies</strong>, which is the first Food and Drug Administration(FDA) approved treatment for <strong>Zaire ebolavirus</strong>\u00a0infection in adult and pediatric patients.</p>\n<p><strong><span data-preserver-spaces=\"true\">Ebola virus\u00a0</span></strong><span data-preserver-spaces=\"true\">is the cause of an emerging disease called Ebola virus disease and is widespread in Africa. They are <strong>filamentous</strong>\u00a0viruses with\u00a0<strong>nonsegmented single-stranded RNA</strong>\u00a0as genetic material.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/70dcca97c44b4454996fd636e75cb8dcx1280x1178.JPEG",
      "https://cdn1.dailyrounds.org/uploads/8782b895f3854d408f16df2ce9a7a278.JPEG"
    ]
  },
  {
    "text": "A 9-year-old boy complained of burning micturition and flank pain. The following day he started passing blood in the urine. The condition was diagnosed as acute hemorrhagic cystitis. In children, this can be caused by  _______",
    "choices": [
      {
        "id": 1,
        "text": "Adenovirus"
      },
      {
        "id": 2,
        "text": "Norovirus"
      },
      {
        "id": 3,
        "text": "Enterovirus"
      },
      {
        "id": 4,
        "text": "Rotavirus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Adenoviruses </strong>types 11 and 21 can cause<strong> acute hemorrhagic cystitis </strong>in children. They are a viral cause of urinary tract infections that\u00a0can lead to cystitis and gross hematuria.</p>\n<p>\u00a0Urinary tract infections in children are most commonly caused by the following:</p>\n<ul>\n<li>Escherichia coli <strong>(Most common)</strong></li>\n<li>Klebsiella species</li>\n<li>Proteus species</li>\n<li>Staphylococcus saprophyticus</li>\n<li>Enterococcus</li>\n<li><strong>Adenovirus</strong> and other viral infections (cause cystitis and gross hematuria)</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: <strong>Norovirus</strong> or Norwalk virus can cause diarrhoea, vomiting, and gastroenteritis epidemics among children.</p>\n<p>Option C: <strong>Enteroviruses</strong> comprise many viruses that can cause a variety of diseases, such as poliomyelitis, myocarditis, conjunctivitis, and pleurodynia.</p>\n<p>Option D: <strong>Rotavirus</strong> is the most common cause of diarrhoea among infants and young children.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old male patient who is on ART for AIDS presented with difficulty in vision. Fundoscopic examination revealed the following finding as shown in the image below. Which of the following subfamilies of the Herpesviridae family encompasses the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Alpha viruses"
      },
      {
        "id": 2,
        "text": "Beta viruses"
      },
      {
        "id": 3,
        "text": "Gamma viruses"
      },
      {
        "id": 4,
        "text": "Delta viruses"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pizza pie appearance</strong> on fundoscopy in an <strong>immunocompromised</strong> <strong>person</strong> is characteristic of <strong>cytomegalovirus</strong> (<strong>CMV</strong>)\u00a0<strong>retinitis</strong>. It\u00a0belongs to <strong>beta viruses subfamily</strong> of the\u00a0<em>Herpesviridae</em> family.</p>\n<p><em>Herpesviridae</em> family is divided into 3 subfamilies:</p>\n<ul>\n<li>Alpha herpesviruses (e.g. HSV 1 and 2, varicella-zoster virus)</li>\n<li><strong>Beta herpes viruses (e.g. CMV)</strong></li>\n<li>Gamma herpesviruses (e.g. EBV)</li>\n</ul>\n<table style=\"width: 382px; height: 392px;\">\n<tbody>\n<tr>\n<td style=\"width: 110.344px;\">\n<p><strong>Alpha </strong><strong>viruses</strong></p>\n</td>\n<td style=\"width: 109.055px;\"><strong>Beta viruses</strong></td>\n<td style=\"width: 120.211px;\"><strong>Gamma viruses</strong></td>\n</tr>\n<tr>\n<td style=\"width: 110.344px;\">Short replicative cycle \u2013 12-18 hours</td>\n<td style=\"width: 109.055px;\">Replicative cycle - &gt;24 hours</td>\n<td style=\"width: 120.211px;\">variable</td>\n</tr>\n<tr>\n<td style=\"width: 110.344px;\">Latency \u2013 sensory ganglia</td>\n<td style=\"width: 109.055px;\">Latency \u2013 salivary glands and other organs</td>\n<td style=\"width: 120.211px;\">Lymphocyte specific</td>\n</tr>\n<tr>\n<td style=\"width: 110.344px;\">Ex: HSV 1 and 2, varicella-zoster virus</td>\n<td style=\"width: 109.055px;\">\n<p>Ex: CMV</p>\n<p>HHV6</p>\n<p>HHV7</p>\n</td>\n<td style=\"width: 120.211px;\">\n<p>Ex: EBV</p>\n<p>HHV8</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ef42f999e04c411fa2929e8897173805.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a property of the cell wall of the organism that stains as shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of lipopolysaccharides"
      },
      {
        "id": 2,
        "text": "Thick peptidoglycan layer"
      },
      {
        "id": 3,
        "text": "Presence of teichoic acid"
      },
      {
        "id": 4,
        "text": "Absence of aromatic and sulphur containing amino acids"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>Gram-negative bacilli</strong>, the cell walls of which contain<strong>\u00a0lipopolysaccharides.</strong></p>\n<p>The table below gives a comparison of the cell walls of gram-positive and gram-negative bacteria.</p>\n<table style=\"height: 345px; width: 341.797px;\">\n<tbody>\n<tr>\n<td style=\"width: 141px;\">\u00a0</td>\n<td style=\"width: 76px;\"><strong>Gram-positive</strong></td>\n<td style=\"width: 101.797px;\"><strong>Gram-negative</strong></td>\n</tr>\n<tr>\n<td style=\"width: 141px;\"><strong>Teichoic acid, lipoteichoic acid</strong></td>\n<td style=\"width: 76px;\">Present</td>\n<td style=\"width: 101.797px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"width: 141px;\"><strong>Thickness (Peptidoglycan)</strong></td>\n<td style=\"width: 76px;\">Thicker</td>\n<td style=\"width: 101.797px;\">Thinner</td>\n</tr>\n<tr>\n<td style=\"width: 141px;\"><strong>Variety of amino acids</strong></td>\n<td style=\"width: 76px;\">Few</td>\n<td style=\"width: 101.797px;\">Several</td>\n</tr>\n<tr>\n<td style=\"width: 141px;\"><strong>Aromatic and sulphur-containing amino acids</strong></td>\n<td style=\"width: 76px;\">Absent</td>\n<td style=\"width: 101.797px;\">Present</td>\n</tr>\n<tr>\n<td style=\"width: 141px;\"><strong>Lipopolysaccharides and outer membrane</strong></td>\n<td style=\"width: 76px;\">Absent</td>\n<td style=\"width: 101.797px;\">Present</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Lipopolysaccharides</strong> present on the cell walls of gram-negative bacteria account for the endotoxic activity and O antigen specificity. The outermost layer of the gram-negative bacterial cell wall is called the <strong>outer membrane</strong>\u00a0and contains several proteins called outer membrane proteins.\u00a0</p>\n<p>Gram-positive bacteria contain <strong>teichoic acid,</strong> which is a major surface antigen containing ribitol or glycerol polymers.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4a4ac28782e4eedb459abe9a6dc58ff.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy presents with myoclonic jerks, seizures, and a rapid decline in cognitive functions. Medical records revealed fever with a rash at 1 year of age. The mother said the rash had started behind the ears, progressed to involve the whole body, and resolved on its own. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Subacute sclerosing panencephalitis"
      },
      {
        "id": 2,
        "text": "Multiple sclerosis"
      },
      {
        "id": 3,
        "text": "Meningitis"
      },
      {
        "id": 4,
        "text": "Guillian-Barre syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case scenario with a classic history of exanthematous fever is suggestive of measles. Seizures, myoclonic jerks, and cognitive dysfunction indicate <strong>s</strong><strong>ubacute sclerosing panencephalitis </strong>(SSPE).</p>\n<p><strong>SSPE</strong> is a chronic, progressive demyelinating disease that develops <strong>years after measles</strong> infection, most often in patients between <strong>5 and 15 years</strong> of age. Patients have a <strong>history of measles</strong> infection at <strong>&lt;2 years</strong> of age. CSF shows elevated measles antibody levels, and MRI shows increased T2 intensity in white matter. No definitive treatment is available.\u00a0</p>\n<p>Other <strong>complications of measles:</strong></p>\n<ul>\n<li><strong>Meningoencephalitis</strong></li>\n<li><strong>Giant-cell pneumonitis</strong></li>\n<li>Pneumonia</li>\n<li><strong>Croup</strong></li>\n<li>Secondary infections - otitis media</li>\n<li>Protracted diarrhoea</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Integrated Mini Test 10 - Microbiology';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>