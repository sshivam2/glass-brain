<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Disorders Of Optic Nerve And Gaze Palsies - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The longest part of the optic nerve measures _____.",
    "choices": [
      {
        "id": 1,
        "text": "30 mm"
      },
      {
        "id": 2,
        "text": "40 mm"
      },
      {
        "id": 3,
        "text": "50 mm"
      },
      {
        "id": 4,
        "text": "20 mm"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Intraorbital part</strong> is the longest part of the optic nerve.</p>\n<p>It measures from <strong>25 mm to 30 mm.</strong></p>\n<p>Length of the optic nerve ranges from 3.5 cm to 5.5 cm.</p>\n<p>80% of the fibers originate from the macular region.</p>\n<p><strong>Parts of optic nerve:</strong></p>\n<table border=\"1\">\n<tbody>\n<tr>\n<td>\n<p><strong>Parts</strong></p>\n</td>\n<td>\n<p><strong>Length</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Intraocular part</p>\n</td>\n<td>\n<p><strong>1 mm</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Intraorbital part</p>\n</td>\n<td>\n<p><strong>25&ndash;30 mm</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Intracanalicular part</p>\n</td>\n<td>\n<p>5<strong>&ndash;</strong>9mm</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Intracranial part</p>\n</td>\n<td>\n<p>10<strong>&ndash;</strong>16 mm</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of papilledema?",
    "choices": [
      {
        "id": 1,
        "text": "Extracellular edema"
      },
      {
        "id": 2,
        "text": "Axonal swelling"
      },
      {
        "id": 3,
        "text": "Stasis of axoplasmic flow"
      },
      {
        "id": 4,
        "text": "Disruption of neurofilament"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Disruption</strong> <strong>of neurofilaments is not a feature</strong> <strong>of papilledema.</strong></p>\n<p>Papilledema is the\u00a0<strong>swelling of the optic nerve head</strong> secondary to <strong>raised intracranial pressure (ICP). </strong></p>\n<p>\"Disc swelling\" and \"disc edema\" are non-specific terms that include papilledema but also indicate a disc swollen from other causes.</p>\n<p>All patients with papilledema should be <strong>suspected</strong> of harboring an<strong> intracranial mass.</strong></p>\n<p><strong>Features of papilledema:</strong></p>\n<ul>\n<li>Raised ICP</li>\n<li><strong>Edema </strong>of the\u00a0optic nerve head\n<ul>\n<li>Blockage of axoplasmic flow</li>\n<li>Axonal swelling</li>\n<li>Collection of extracellular fluid</li>\n</ul>\n</li>\n<li><strong>Painless progressive</strong> loss of vision</li>\n<li><strong>Enlargement </strong>of<strong>\u00a0</strong>the <strong>blind\u00a0spot</strong></li>\n<li>Color vision, visual acuity, and pupillary reaction are\u00a0<strong>n</strong><strong>ormal</strong>, until optic atrophy sets in.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A resident notes the following fundus picture in a patient referred to the ophthalmology OPD with visual complaints. What does it suggest?",
    "choices": [
      {
        "id": 1,
        "text": "Retinal detachment"
      },
      {
        "id": 2,
        "text": "Papilledema"
      },
      {
        "id": 3,
        "text": "Primary optic atrophy"
      },
      {
        "id": 4,
        "text": "Secondary optic atrophy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The fundoscopic image shows <strong>dilated veins</strong> with a&nbsp;<strong>blurred disc margin</strong>&nbsp;which is suggestive of <strong>papilledema</strong>.</p>\n<p><strong>Ophthalmoscopic features of papilledema</strong>:</p>\n<ul>\n<li><strong>Early-stage:</strong>\n<ul>\n<li><strong>Obscuration</strong> of the disc margins <strong>(</strong><strong>nasal margins first) </strong></li>\n<li><strong>Absence</strong> of <strong>spontaneous venous pulsation</strong> at the disc</li>\n<li><strong>Mild hyperemia</strong> of the disc</li>\n<li>The blurring of the&nbsp;peripapillary nerve fiber layer</li>\n</ul>\n</li>\n<li><strong>Established papilledema:</strong>\n<ul>\n<li>The disc appears to be enlarged and elevated (<strong>mushroom</strong> or <strong>dome-shaped)</strong></li>\n<li><strong>Macular fan </strong>appears</li>\n<li><strong>Paton&rsquo;s lines-</strong>&nbsp;circumferential <strong>greyish white folds</strong> may develop due to the&nbsp;separation of nerve fibers</li>\n<li>Visual fields show <strong>enlargement of the blind spot</strong></li>\n<li>Veins become <strong>tortuous</strong> and engorged</li>\n<li>Multiple <strong>cotton-wool spots</strong> and superficial hemorrhages</li>\n</ul>\n</li>\n<li><strong>Chronic or long-standing (vintage) papilledema:</strong>\n<ul>\n<li>The optic disc gives the&nbsp;appearance of the <strong>dome of a champagne cork</strong></li>\n<li>Small drusen-like crystalline deposits (<strong>corpora amylacea</strong>) may appear on the disc surface</li>\n</ul>\n</li>\n<li><strong>Atrophic stage:</strong>\n<ul>\n<li><strong>Secondary</strong> optic atrophy</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/56401db6a71c4b93909f7439a51f7d5b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions show ipsilateral optic atrophy and contralateral papilledema?",
    "choices": [
      {
        "id": 1,
        "text": "Weber syndrome"
      },
      {
        "id": 2,
        "text": "Foster-Kennedy syndrome"
      },
      {
        "id": 3,
        "text": "Millard-Gubler syndrome"
      },
      {
        "id": 4,
        "text": "Benedikt syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ipsilateral optic atrophy</strong> and <strong>contralateral papilledema</strong>&nbsp;are seen in&nbsp;<strong>Foster&ndash;Kennedy syndrome</strong>.</p>\n<p><strong>Weber</strong>&nbsp;syndrome (<strong>superior alternating hemiplegia</strong>) is a form of stroke characterized by the presence of an <strong>ipsilateral oculomotor</strong> nerve palsy and <strong>contralateral hemiparesis</strong> or hemiplegia.</p>\n<p><strong>Millard&ndash;Gubler syndrome</strong> is a lesion of the <strong>pons</strong>. It is also called <strong>ventral pontine syndrome</strong>.</p>\n<p><strong>Benedikt syndrome,</strong> also known as&nbsp;<strong>paramedian midbrain syndrome</strong>, involves the fasciculus of oculomotor nerve as it passes through the red nucleus and is characterized by ipsilateral third nerve palsy and contralateral extrapyramidal signs such as hemitremor.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presents to the casualty with a sudden loss of vision and painful ocular movements. On examination, the eye is white and there are no obvious signs on ophthalmoscopy. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Optic nerve glioma"
      },
      {
        "id": 2,
        "text": "Retrobulbar neuritis"
      },
      {
        "id": 3,
        "text": "Eale\u2019s disease"
      },
      {
        "id": 4,
        "text": "Neuroretinitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;</p>\n<p>The image below shows <strong>macular star </strong>appearance in <strong>neuroretinitis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29391d1eb10348b0a7fd4b78579fe69cx512x389.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bbee13f5cbb4361921cf13758fe28b9x606x603.PNG"
    ]
  },
  {
    "text": "A 33-year-old patient has come to the ophthalmology OPD with complaints that her vision becomes temporarily blurry after a hot bath in the evening. This resolves by itself after a few hours. She has a past history of an episode of painful unilateral optic neuritis, 3 months back which resolved with steroids. What is being described here?",
    "choices": [
      {
        "id": 1,
        "text": "Pulfrich phenomenon"
      },
      {
        "id": 2,
        "text": "Uhthoff phenomenon"
      },
      {
        "id": 3,
        "text": "Lhermitte\u2019s sign"
      },
      {
        "id": 4,
        "text": "Riddoch phenomenon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Episodic, transient obscuration of vision on exertion or on exposure to <strong>heat</strong>, which recovers on resting or moving away from the heat in an isolated optic neuritis patient is called&nbsp;<strong>Uhthoff phenomenon. </strong>It is commonly associated with multiple sclerosis (MS).</p>\n<p>Option A:<strong> Pulfrich&rsquo;s phenomenon </strong>is an&nbsp;illusion<strong>&nbsp;</strong>of <strong>depth perception. </strong>It is seen in MS.&nbsp;</p>\n<p>Option C: <strong>Lhermitte&rsquo;s sign&nbsp;</strong>refers to passive&nbsp;<strong>neck flexion </strong>causing an <strong>electric shock-like sensation radiating to the spine and shoulders</strong>. This is a result of the increased sensitivity of the myelin to stretch or traction; it is also seen in MS.</p>\n<p>Option D:<strong> Riddoch phenomenon </strong>refers to ability to perceive <strong>kinetic</strong> but <strong>not static</strong> targets. It is seen in <strong>cortical blindness.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with multiple sclerosis, which of the following visual field defects is most likely?",
    "choices": [
      {
        "id": 1,
        "text": "Bitemporal hemianopia"
      },
      {
        "id": 2,
        "text": "Central scotoma"
      },
      {
        "id": 3,
        "text": "Enlarged blind spot"
      },
      {
        "id": 4,
        "text": "Tunnel vision"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Central scotoma</strong> is more likely to occur with <strong>multiple sclerosis. </strong>It is also seen with retrobulbar neuritis and macular pathology.</p>\n<p>Option A: Optic chiasma compression causes bitemporal hemianopia</p>\n<p>Option C: Enlarged blind spot occurs with papilloedema</p>\n<p>Option D: Tunnel vision occurs in glaucoma, retinitis pigmentosa and&nbsp;Retinal pan photocoagulation</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Optic neuritis is a common presentation in which of the following diseases?",
    "choices": [
      {
        "id": 1,
        "text": "Myasthenia gravis"
      },
      {
        "id": 2,
        "text": "Guillain-Barr\u00e9 syndrome"
      },
      {
        "id": 3,
        "text": "Multiple sclerosis"
      },
      {
        "id": 4,
        "text": "Amyotrophic lateral sclerosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>One of the common presentations of MS is <strong>optic neuritis</strong>.&nbsp;Multiple sclerosis (MS) results from demyelinating plaques in the central nervous system.&nbsp;</p>\n<p>Option A: <strong>Myasthenia gravis</strong> is the&nbsp;<strong>autoimmune</strong> destruction of the <strong>acetylcholine receptors</strong> at the neuromuscular junction.</p>\n<p>Option B: <strong>Guillain&ndash;Barr&eacute; syndrome</strong> is the postinfectious autoimmune-induced destruction of peripheral nerves, resulting in an <strong>ascending paralysis</strong>.</p>\n<p>Option D: <strong>Amyotrophic lateral sclerosis (ALS)</strong> is a disease of the <strong>motor nerve fibers</strong> of the lateral columns and anterior horns of the spinal cord that results in <strong>progressive muscular atrophy</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old female patient presents with 6/60 visual acuity in one eye and 6/18 in the other eye. She has recurrent episodes of diminution of vision which recovers on treatment with steroids. She also has a history of transverse myelitis. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hereditary spastic quadriplegia"
      },
      {
        "id": 2,
        "text": "Subacute combined degeneration"
      },
      {
        "id": 3,
        "text": "Neuromyelitis optica"
      },
      {
        "id": 4,
        "text": "Multiple sclerosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of a patient presenting with <strong>decreased visual acuity</strong> and a\u00a0<strong>history of transverse myelitis</strong>\u00a0which is treated with steroids is indicative of <strong>Neuromyelitis optica</strong> (NMO).</p>\n<p>Neuromyelitis optica also known as <strong>Devic's disease</strong> is an <strong>autoimmune\u00a0demyelinating</strong>\u00a0disease in which <strong>antibodies</strong> are formed <strong>against</strong> <strong>Aquaporin 4</strong> present in the cell membranes of <strong>Astrocytes</strong>. It is characterized by the findings of unilateral or bilateral <strong>optic neuritis</strong>\u00a0developing within a few weeks of <strong>transverse myelitis</strong>(demyelination of the spinal cord). The disease may be monophasic or recurrent.</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Diagnostic Criteria for Neuromyelitis Optica Spectrum Disorder (NMOSD):</p>\n<p class=\"p2\"><strong>Diagnostic Criteria for NMOSD associated with AQP4-IgG</strong></p>\n<ol>\n<li class=\"p3\">At least\u00a0<strong>1</strong>\u00a0core clinical characteristic</li>\n<li class=\"p3\">A positive test for\u00a0<strong>AQP4-IgG</strong>\u00a0using the best available detection method (<strong>cell-based assay</strong>)</li>\n<li class=\"p3\">Exclusion of alternative diagnoses</li>\n</ol>\n<p>\u00a0<strong>Core Clinical Characteristics</strong>:</p>\n<ol>\n<li>Optic neuritis is usually bilateral and causes <strong>severe visual loss.</strong></li>\n<li>\u00a0Acute myelitis- may be\u00a0<strong>severe, transverse</strong>\u00a0and typically longitudinally extensive involving three or more contiguous vertebral segments.</li>\n<li>Area postrema syndrome: episodes of otherwise unexplained hiccups or nausea or vomiting</li>\n<li>Acute brainstem syndrome</li>\n<li>Symptomatic\u00a0<strong>narcolepsy</strong>\u00a0 associated with NMOSD-typical diencephalic MRI lesions</li>\n</ol>\n<p>For acute cases of NMO,\u00a0<strong>high-dose glucocorticoids</strong>\u00a0or plasma exchange is used.\u00a0<strong>Mycophenolate mofetil, rituximab,</strong>\u00a0and\u00a0<strong>glucocorticoids with azathioprine</strong>\u00a0are used for prophylaxis against relapses.</p>\n<div class=\"page\" title=\"Page 3590\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 3590\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;The FDA has approved Satralizumab, a humanized IgG2 monoclonal antibody for the treatment of neuromyelitis optica spectrum disorder (NMOSD) in adults with particular antibody patients who are anti-aquaporin-4 or AQP4 antibody-positive. &quot;}\" data-sheets-userformat=\"{&quot;2&quot;:33555327,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:65535},&quot;5&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;6&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;7&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;8&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;9&quot;:0,&quot;11&quot;:4,&quot;12&quot;:0,&quot;28&quot;:1}\">The FDA has approved\u00a0<strong>satralizumab,</strong> a humanized IgG2 monoclonal antibody, for the treatment of NMO spectrum disorder with AQP4 antibody positivity.</span></p>\n<div class=\"page\" title=\"Page 3520\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Eculizumab,</strong>\u00a0a complement inhibitor, and inebilizumab<strong>,</strong>\u00a0a B-cell depletion agent, are two more new drugs that have recently been approved for use in NMO attack prevention.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"row mt-3\">\u00a0A history of transverse myelitis with optic neuritis(decreased visual acuity) rules out<strong> Multiple sclerosis</strong>(option D)<strong>. </strong>It<strong>\u00a0</strong>is an <strong>autoimmune </strong>inflammatory\u00a0and <strong>demyelinating</strong> disease of the <strong>CNS</strong>\u00a0that affects both upper motor neurons (<strong>UMN</strong>) and lower motor neurons (<strong>LMN</strong>) with involvement of sensory system, ocular system and bowel and bladder function.\u00a0<strong>Ocular </strong>manifestations of MS include\u00a0<strong>Optic neuritis</strong>(usually <strong>retrobulbar</strong>)- decreased visual acuity,\u00a0internuclear ophthalmoplegia and\u00a0nystagmus<strong>.</strong></div>\n<div class=\"page\" title=\"Page 759\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man with suspected optic neuropathy is being evaluated for visual field defects. Goldman perimetry reveals bilateral centrocecal scotomas. Which of the following is most likely to be the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Tobacco"
      },
      {
        "id": 2,
        "text": "Ethanol"
      },
      {
        "id": 3,
        "text": "Methanol"
      },
      {
        "id": 4,
        "text": "Chloroquine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Centrocecal scotoma is most commonly seen in <strong>tobacco-induced amblyopia</strong>. It is also seen in <strong>vitamin B12</strong> deficiency.</p>\n<p><strong>Tobacco amblyopia </strong>is caused by excessive smoking and chewing of tobacco.<strong>&nbsp;</strong>The toxic agent involved is <strong>cyanide</strong> found in tobacco. It is characterized by bilateral and gradually progressive impairment of <strong>central</strong> vision. The classic visual field defect is a <strong>centrocecal scotoma</strong>, often involving both the&nbsp;<strong>blind spot</strong> and the&nbsp;<strong>macula.</strong></p>\n<p>Option B: Ethanol amblyopia is similar to tobacco amblyopia but often presents with peripheral neuritis and a \"central scotoma\".</p>\n<p>Option C: Methanol amblyopia often results in complete blindness.</p>\n<p>Option D: Quinine amblyopia results in near-complete blindness with associated deafness and tinnitus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An anxious, young man came to the ER with complaints of having sudden trouble seeing with his left eye and a recent history of tripping over things. There was no associated pain or difficulty moving the eyes. An ophthalmology consultation was requested. On perimetry, the following visual field defect was picked up. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Methanol intoxication"
      },
      {
        "id": 2,
        "text": "Anterior ischemic optic neuropathy (AION)"
      },
      {
        "id": 3,
        "text": "Suprasellar tumor"
      },
      {
        "id": 4,
        "text": "Lesions to occipital cortex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The perimetry result depicts <strong>altitudinal hemianopia,&nbsp;</strong>which is <strong>most commonly seen</strong> in anterior ischemic optic neuropathy (<strong>AION</strong>).</p>\n<p>Altitudinal hemianopia can also be seen in <strong>suprasellar tumors</strong> and <strong>occipital lobe lesions,</strong> but the <strong>frequency is very low</strong> compared to that of&nbsp;<strong>AION</strong>. Hence, AION is the single best answer.</p>\n<p>The two types of AION are as follows:</p>\n<ul>\n<li><strong>Arteritic AION-</strong>&nbsp;caused by <strong>g</strong><strong>iant-cell arteritis</strong></li>\n<li><strong>Non-arteritic AION</strong> (NAAION)-&nbsp;<strong>more common</strong></li>\n</ul>\n<p>Clinical features:</p>\n<table style=\"height: 296px;\" width=\"622\">\n<tbody>\n<tr>\n<td style=\"width: 200px;\"><strong>Features</strong></td>\n<td style=\"width: 200px;\"><strong>AAION</strong></td>\n<td style=\"width: 200px;\">\n<p><strong>NAAION</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>Age</strong></td>\n<td style=\"width: 200px;\">&gt;70 years</td>\n<td style=\"width: 200px;\">\n<p>&lt;70 years</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>Sex</strong></td>\n<td style=\"width: 200px;\">F &gt; M</td>\n<td style=\"width: 200px;\">\n<p>F = M</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p><strong>Headache</strong></p>\n<p><strong>Jaw claudication</strong></p>\n</td>\n<td style=\"width: 200px;\">Present</td>\n<td style=\"width: 200px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>Visual loss</strong></td>\n<td style=\"width: 200px;\">Marked</td>\n<td style=\"width: 200px;\">\n<p>Less marked</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>Optic disc</strong></td>\n<td style=\"width: 200px;\">Pale disc edema</td>\n<td style=\"width: 200px;\">\n<p>Hyperemic disc edema</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>C reactive protein</strong></td>\n<td style=\"width: 200px;\">Raised</td>\n<td style=\"width: 200px;\">\n<p>Normal&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>ESR</strong></td>\n<td style=\"width: 200px;\">Highly raised</td>\n<td style=\"width: 200px;\">\n<p>Raised</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>FFA</strong></td>\n<td style=\"width: 200px;\">\n<p>Disc delay and choroidal delay</p>\n</td>\n<td style=\"width: 200px;\">\n<p>Only disc delay</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\"><strong>Treatment</strong></td>\n<td style=\"width: 200px;\">Corticosteroids</td>\n<td style=\"width: 200px;\">Levodopa&ndash;carbidopa combination for 3 weeks and then double dose for 1 month</td>\n</tr>\n</tbody>\n</table>\n<p>Note: Corticosteroids are not proven to be effective in NAAION.</p>\n<p><br />The image given below shows pale disc edema of <strong>Arteritic AION.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0bf2b97fe06c431bb8cd2dc2a25df0ea.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f53f3f8209b4186a93e1059ebac32e3x616x421.PNG"
    ]
  },
  {
    "text": "What does the given fundoscopic picture suggest?",
    "choices": [
      {
        "id": 1,
        "text": "Primary optic atrophy"
      },
      {
        "id": 2,
        "text": "Secondary optic atrophy"
      },
      {
        "id": 3,
        "text": "Glaucomatous optic atrophy"
      },
      {
        "id": 4,
        "text": "Consecutive optic atrophy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given fundoscopic image clearly depicts <strong>cupping</strong>, <strong>thinning of the neuroretinal rim,</strong> and <strong>nasal shifting of vessels</strong>. This are characteristic of <strong>glaucomatous optic atrophy</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4f616f44177043fab970b6ff5ccd6ae8.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is not associated with optic atrophy?",
    "choices": [
      {
        "id": 1,
        "text": "Retinitis pigmentosa"
      },
      {
        "id": 2,
        "text": "Leprosy"
      },
      {
        "id": 3,
        "text": "Pituitary tumor"
      },
      {
        "id": 4,
        "text": "Methanol intake"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Leprosy</strong> is <strong>not </strong>associated with&nbsp;optic atrophy.</p>\n<p>All the other given conditions can cause optic atrophy.</p>\n<p><strong>Causes of optic atrophy:</strong></p>\n<ul>\n<li><strong>Primary</strong> optic atrophy\n<ul>\n<li>Optic neuritis</li>\n<li>Compression by tumors and aneurysms</li>\n<li>Hereditary optic neuropathies</li>\n<li>Toxic and nutritional optic neuropathies</li>\n<li>Trauma</li>\n</ul>\n</li>\n<li><strong>Secondary</strong> optic atrophy\n<ul>\n<li>Chronic papilledema</li>\n<li>Anterior ischemic optic neuropathy</li>\n<li>Papillitis</li>\n</ul>\n</li>\n<li><strong>Consecutive</strong> optic atrophy\n<ul>\n<li>Extensive retinal photocoagulation</li>\n<li>Retinitis pigmentosa</li>\n<li>Prior central retinal artery occlusion</li>\n</ul>\n</li>\n<li><strong>Glaucomatous</strong> optic atrophy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old man with a history of pernicious anemia was referred to ophthalmology for complaints of gradually progressing visual disturbances. On perimetry, which of the following defects is most likely to be seen in him?",
    "choices": [
      {
        "id": 1,
        "text": "Enlarged blindspot"
      },
      {
        "id": 2,
        "text": "Bitemporal hemianopia"
      },
      {
        "id": 3,
        "text": "Heteronymous hemianopia"
      },
      {
        "id": 4,
        "text": "Centrocecal scotoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario of pernicious anemia with gradually progressive visual disturbances is suggestive of <strong>vitamin B12 deficiency. </strong></p>\n<p>B12 deficiency is&nbsp;known to cause&nbsp;<strong>centrocecal scotoma&nbsp;</strong>and it is an important cause of<strong> nutritional optic atrophy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 15-year-old boy has bilateral optic atrophy with diabetes mellitus and diabetes insipidus. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Kjer optic neuropathy"
      },
      {
        "id": 2,
        "text": "Behr syndrome"
      },
      {
        "id": 3,
        "text": "Wolfram syndrome"
      },
      {
        "id": 4,
        "text": "Leber's congenital amaurosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario suggests&nbsp;<strong>Wolfram syndrome</strong>. It is due to<strong> WFS1</strong> gene mutation.&nbsp;</p>\n<p>The presentation is usually between the ages of<strong> 5 </strong>and<strong> 21 years</strong>;<strong> diabetes mellitus</strong> is typically the <strong>first manifestation</strong>, followed by visual problems. It has a poor prognosis.&nbsp;</p>\n<p><strong>Clinical features&nbsp;</strong>are:&nbsp;(<strong>DIDMOAD</strong>)&nbsp;</p>\n<ul>\n<li>Diabetes insipidus</li>\n<li>Diabetes mellitus</li>\n<li>Optic atrophy</li>\n<li>Deafness (sensorineural type)<strong>&nbsp;</strong></li>\n</ul>\n<p>Option A: Kjer's optic neuropathy is an autosomal dominant condition. It presents with vision loss in early childhood and no significant systemic features.</p>\n<p>Option B: Behr syndrome is an autosomal recessive condition. Clinical features include optic atrophy, pyramidal tract signs, ataxia, intellectual disability, urinary incontinence, and pes cavus</p>\n<p>Option D: Leber's congenital amaurosis is an autosomal recessive condition. It usually presents with significant vision loss in infancy and nystagmus.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of amaurosis fugax ?",
    "choices": [
      {
        "id": 1,
        "text": "Sudden onset"
      },
      {
        "id": 2,
        "text": "Transient nature"
      },
      {
        "id": 3,
        "text": "Monocular blindness"
      },
      {
        "id": 4,
        "text": "Irreversible nature"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Amaurosis fugax</strong> is a <strong>sudden</strong> and <strong>transient monocular</strong> blindness, which is <strong>reversible</strong>.<strong>&nbsp;</strong></p>\n<p>It is a marker of <strong>advanced</strong> carotid artery <strong>atherosclerosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Champagne cork disc is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Papilledema"
      },
      {
        "id": 2,
        "text": "Papillitis"
      },
      {
        "id": 3,
        "text": "Pseudopapillitis"
      },
      {
        "id": 4,
        "text": "Anterior ischemic optic neuropathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Champagne cork</strong> disc is seen in <strong>chronic&nbsp;papilledema</strong>.</p>\n<p>The optic disc gives the appearance of the <strong>dome of a champagne cork</strong>. Small drusen-like crystalline deposits (<strong>corpora amylacea</strong>) may appear on the disc surface.</p>\n<p>The most reliable sign to differentiate between papillitis and papilledema is <strong>pupillary reaction</strong>. Pupillary light reflex is&nbsp;<strong>normal in papilledema</strong>&nbsp;whereas it is&nbsp;<strong>sluggish in papillitis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following defects is implicated in Leber\u2019s hereditary optic neuropathy?",
    "choices": [
      {
        "id": 1,
        "text": "Post-translational defect"
      },
      {
        "id": 2,
        "text": "Sporadic point mutation"
      },
      {
        "id": 3,
        "text": "Mitochondrial DNA defect"
      },
      {
        "id": 4,
        "text": "Chromosomal translocation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>Leber&rsquo;s hereditary optic neuropathy</strong> (LHON), the&nbsp;defect is a&nbsp;mutation of<strong> maternal mitochondrial DNA. </strong>Therefore&nbsp;the condition has a<strong> maternal inheritance.&nbsp;</strong></p>\n<p>LHON causes bilateral, <strong>subacute painless loss</strong> of vision. The characteristic visual field defect is a centrocaecal scotoma. Pupillary light reflex is relatively preserved until the late stage of the disease.&nbsp;<strong>Optic neuritis</strong>&nbsp;and <strong>o</strong><strong>ptic atrophy</strong> start in one eye and goes on to involve the other eye subsequently.&nbsp;It typically affects <strong>males</strong> between the ages of <strong>15 and 35 years.&nbsp;</strong>The diagnosis of LHON should be considered in any patient with <strong>bilateral optic neuropathy</strong>, irrespective of age.</p>\n<p><strong>Prognosis is poor</strong>, although some visual recovery may occur in a minority of cases even years later.&nbsp;</p>\n<p>Note: <strong>LHON plus</strong> refers to rare variants with additional manifestations such as<strong> neuromuscular dysfunction</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old man developed a painless diminution of vision in his right eye 6 months ago but did not seek medical attention. Two weeks ago, he started to notice mild blurring in his left eye and has now come for evaluation. According to him, his elder brother and maternal uncle also had similar vision problems. Which fundus finding would point towards Leber\u2019s hereditary optic neuropathy in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Sectoral optic atrophy"
      },
      {
        "id": 2,
        "text": "Disc leakage on fluorescein angiography"
      },
      {
        "id": 3,
        "text": "Hyperemic optic disc with telangiectatic capillaries"
      },
      {
        "id": 4,
        "text": "Papilledema and macular star"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hyperemic optic disc with telangiectatic capillaries</strong> would be suggestive of LHON. \u00a0</p>\n<p>LHON is related to a mitochondrial DNA mutation. This results in impaired mitochondrial adenosine triphosphate production, which affects the highly energy-dependent optic nerve. \u00a0</p>\n<p>In the acute phase, the optic disc is <strong>hyperemic</strong> and swollen with <strong>telangiectatic </strong>capillaries. However, the optic disc <strong>does not leak</strong> on fluorescein angiography. Later stages may show primary optic atrophy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In order to diagnose a case as idiopathic intracranial hypertension, which of the following features is not necessary?",
    "choices": [
      {
        "id": 1,
        "text": "Normal cerebrospinal fluid composition"
      },
      {
        "id": 2,
        "text": "Elevated opening pressure on lumbar puncture"
      },
      {
        "id": 3,
        "text": "Bilateral papilledema"
      },
      {
        "id": 4,
        "text": "Normal neuroimaging studies"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Papilledema <strong>is not a</strong>&nbsp;mandatory criterion for the diagnosis of <strong>idiopathic intracranial hypertension (IIH).</strong></p>\n<p>Idiopathic intracranial hypertension (pseudotumor cerebri) is a diagnosis of exclusion. Obstructive, compressive, and infiltrative CNS lesions must be excluded by neuroimaging studies. Papilledema, although present in 90% of the patients, is not necessary for diagnosis. Elevated CSF opening pressure on lumbar puncture is the hallmark of IIH.</p>\n<p>Risk factors of IIH include:</p>\n<ul>\n<li>Female sex</li>\n<li>Obesity</li>\n<li>Nalidixic acid</li>\n<li>Tetracycline</li>\n<li>Vitamin A</li>\n<li>Oral contraceptives</li>\n<li>Use of or withdrawal from corticosteroids</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most reliable sign to clinically differentiate between a case of papillitis and papilledema?",
    "choices": [
      {
        "id": 1,
        "text": "Amount of disc elevation"
      },
      {
        "id": 2,
        "text": "Degree of venous congestion"
      },
      {
        "id": 3,
        "text": "Pupillary reaction"
      },
      {
        "id": 4,
        "text": "Disc hyperemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most reliable sign to differentiate between papillitis and papilledema is <strong>pupillary reaction. &nbsp;</strong></p>\n<p>Pupillary light reflex is <strong>normal in papilledema</strong> whereas it is <strong>sluggish in papillitis</strong>.&nbsp;Visual acuity and colour <strong>vision</strong> are also relatively more <strong>preserved in papilledema</strong> compared to papillitis.</p>\n<p>The other three disc signs seen on ophthalmoscopy are present in both papillitis and papilledema.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient evaluated for dizziness and visual disturbances was found to have down-beating nystagmus. A brain lesion was suspected and the patient was referred for an MRI. What is the most likely site of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Parasellar region and optic chiasm"
      },
      {
        "id": 2,
        "text": "Pineal region and the dorsal midbrain"
      },
      {
        "id": 3,
        "text": "Cervico-medullary junction"
      },
      {
        "id": 4,
        "text": "Posterior cerebral hemisphere"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Down-beat</strong> nystagmus is usually due to a lesion at the <strong>cervico-medullary junction</strong> (e.g. Arnold-Chiari malformation, syringobulbia) or as a manifestation of <strong>cerebellar</strong> degeneration.</p>\n<p>Other causes of down-beat nystagmus:</p>\n<ul>\n<li>Drugs (phenytoin, lithium, barbiturates, carbamazepine)</li>\n<li>Wernicke's encephalopathy</li>\n<li>Demyelinating disorders</li>\n</ul>\n<p>Acquired nystagmus can be attributed to disturbances of the three mechanisms that normally ensure steady gaze&mdash;visual fixation, the vestibulo-ocular reflex, and the mechanism that makes it possible to hold the eyes at an eccentric eye position (e.g. far-right gaze).</p>\n<p>Other types of nystagmus:</p>\n<table style=\"height: 254px; width: 702px;\">\n<tbody>\n<tr>\n<td style=\"width: 264.667px;\"><strong>Type of Nystagmus</strong></td>\n<td style=\"width: 421.333px;\"><strong>Etiology</strong></td>\n</tr>\n<tr>\n<td style=\"width: 264.667px;\">Slow-horizontal&nbsp;</td>\n<td style=\"width: 421.333px;\">Large <strong>posterior cerebral</strong> lesions (e.g. stroke)</td>\n</tr>\n<tr>\n<td style=\"width: 264.667px;\">Mixed horizontal (Torsional)</td>\n<td style=\"width: 421.333px;\">Usually associated with vertigo and seen in&nbsp;<strong>vestibular system&nbsp;</strong>lesions</td>\n</tr>\n<tr>\n<td style=\"width: 264.667px;\">Up-beat</td>\n<td style=\"width: 421.333px;\"><strong>Medulla,</strong>&nbsp;the ventral tegmentum and the anterior vermis of the cerebellum</td>\n</tr>\n<tr>\n<td style=\"width: 264.667px;\">Periodic alternating</td>\n<td style=\"width: 421.333px;\"><strong>Cerebellar disease</strong> (In PAN, the horizontal jerk nystagmus spontaneously reverses the direction of the quick phase every few seconds)</td>\n</tr>\n<tr>\n<td style=\"width: 264.667px;\">See-saw</td>\n<td style=\"width: 421.333px;\">Lesion involving <strong>parasellar region and optic chiasm</strong> (e.g. pituitary tumours, third ventricle)&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 264.667px;\">Gaze-evoked</td>\n<td style=\"width: 421.333px;\">Side-effect of <strong>drugs</strong>, including sedatives, anticonvulsants and alcohol, as well as <strong>cerebellar</strong> <strong>disease</strong></td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An RTA patient with severe head trauma is admitted to the surgical ICU for observation. On examination, nystagmus was noted. His CT scan reveals a transverse fracture of his left temporal bone. Which of the following statements is true regarding the nystagmus?",
    "choices": [
      {
        "id": 1,
        "text": "Slow phase is towards the left and fast phase towards the right"
      },
      {
        "id": 2,
        "text": "Slow phase is towards the right and fast phase towards the left"
      },
      {
        "id": 3,
        "text": "It is an up-beating type of nystagmus"
      },
      {
        "id": 4,
        "text": "It is a down-beating type of nystagmus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Fracture of the temporal bone causes vestibular injury resulting in a horizontal nystagmus with <strong>slow phase towards the affected side</strong> and <strong>fast phase towards the opposite side.</strong></p>\n<p>Peripheral vestibular nystagmus occurs in lesions of the labyrinth or vestibular nerve. Normally, there is tonic input to the brainstem vestibular nuclei from the periphery. Loss of the tonic input from the left vestibular nerve leads to deviation of the eyes <strong>towards the left side,</strong> which is the <strong>slow phase</strong> of the nystagmus. The cortical correction brings the eyes back to the centre in the primary gaze which is the <strong>fast-phase</strong> directed <strong>towards the right side</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the site of lesion in internuclear ophthalmoplegia?",
    "choices": [
      {
        "id": 1,
        "text": "Medial Longitudinal Fasciculus"
      },
      {
        "id": 2,
        "text": "6th Nerve nucleus"
      },
      {
        "id": 3,
        "text": "Pontine paramedian reticular formation"
      },
      {
        "id": 4,
        "text": "A & C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In internuclear ophthalmoplegia (INO) the lesion is at the <strong>medial longitudinal fasciculus </strong>(MLF).</p>\n<p>In INO, there is&nbsp;<strong>impaired adduction</strong>&nbsp;on the&nbsp;<strong>ipsilateral</strong>&nbsp;side of the lesion, and<strong>&nbsp;nystagmus on abduction&nbsp;</strong>on the&nbsp;<strong>contralateral side</strong>. When the gaze is initiated in the motor cortex, the horizontal gaze center or the <strong>paramedian pontine reticular formation</strong>&nbsp;(PPRF) generates the eye movements.</p>\n<p>The PPRF has&nbsp;<strong>two outputs</strong>. The first is to the&nbsp;<strong>ipsilateral 6th cranial nerve nucleus</strong>&nbsp;which causes abduction of the ipsilateral eye. The second output is to the <strong>contralateral</strong> <strong>MLF</strong>&nbsp;which sends an impulse to the&nbsp;<strong>contralateral 3rd cranial nerve nucleus</strong>&nbsp;causing contralateral adduction. These two outputs from PPRF lead to conjugate movement of the eyes to the same side.&nbsp;</p>\n<p>Therefore, a<strong> lesion </strong>in the<strong> right MLF</strong> leads to <strong>failure </strong>of the<strong> right eye adduction</strong>. The <strong>left eye</strong>, however, <strong>abducts normally</strong>. This is called <strong>internuclear ophthalmoplegia</strong>.</p>\n<p>The following image shows the pathway for horizontal eye movements as described above.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ffe506e7bffa4858b3825b7f36d2cfd2x1280x2152.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/836881526ea24eafbaa3a6dc3f6fc92bx1280x2259.JPEG"
    ]
  },
  {
    "text": "You are evaluating an elderly patient in the stroke ICU, who was admitted three days back with a history of sudden onset nausea, vomiting, and gait abnormalities. The visual examination showed conjugate horizontal left gaze palsy. He could maintain gaze near mid-position but could not cross the midline to the left side. His MRI is likely to show involvement of which of the following brain areas?",
    "choices": [
      {
        "id": 1,
        "text": "Parapontine reticular formation"
      },
      {
        "id": 2,
        "text": "Pretectal nucleus"
      },
      {
        "id": 3,
        "text": "Medial longitudinal fasciculus"
      },
      {
        "id": 4,
        "text": "Occipital lobe"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Vertical gaze palsy</strong></p>\n<p><strong>Center</strong> is located in the <strong>rostral interstitial nucleus of the dorsal midbrain (riMLF)</strong>.</p>\n<p>The important types of vertical gaze palsy are as follows:</p>\n<ul>\n<li><strong>Parinaud's syndrome:</strong>&nbsp;<strong>Upgaze</strong> palsy</li>\n<li><strong>Steel&ndash;Richardsons syndrome:</strong>&nbsp;<strong>Downgaze</strong> palsy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b51e3811490456c98064908037e4757x1280x2259.JPEG"
    ]
  },
  {
    "text": "A patient has normal vertical saccades. On attempted left gaze as shown in the image below, the patient develops left jerk nystagmus.  Where is the most likely location of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Left paramedian pontine reticular formation"
      },
      {
        "id": 2,
        "text": "Right third nerve nucleus"
      },
      {
        "id": 3,
        "text": "Left medial longitudinal fasciculus"
      },
      {
        "id": 4,
        "text": "Right medial longitudinal fasciculus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most likely location</strong> of the lesion according to the given clinical scenario and the image is the&nbsp;<strong>right medial longitudinal fasciculus.</strong></p>\n<p>The image depicts an attempted left gaze and concludes that there is an adduction deficit in the right eye. This causes jerk nystagmus in the abducting left eye.&nbsp;</p>\n<p>This is most likely due to <strong>a lesion of the medial longitudinal fasciculus (MLF) ipsilateral to the side of the adduction deficit.</strong> Hence, this is a <strong>case of a right MLF lesion or Right Internuclear Ophthalmoplegia (INO).</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/285db156b7a148aabceb3696bed30fd4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Ophthalmoplegic migraine clinically presents as ___________.",
    "choices": [
      {
        "id": 1,
        "text": "Headache with irreversible loss of optic nerve function"
      },
      {
        "id": 2,
        "text": "Headache associated with recurrent third nerve palsy"
      },
      {
        "id": 3,
        "text": "Headache associated with third, fourth, and sixth nerve palsy"
      },
      {
        "id": 4,
        "text": "Headache associated with optic neuritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ophthalmoplegic migraine</strong> refers to headache associated with <strong>third</strong>, <strong>fourth,</strong> and <strong>sixth</strong> nerve palsy.</p>\n<p>Ophthalmoplegic migraine almost always involves the third nerve. Rare cases of sixth nerve&nbsp;involvement, and even rarer cases that involve the fourth nerve, have also been reported.</p>\n<p>Clinical criteria for the diagnosis of ophthalmoplegic migraine include:</p>\n<ul>\n<li>A <strong>prior history</strong> of typical common or <strong>classic migraine</strong> headaches</li>\n<li>Ophthalmoplegia that occurs during (or, rarely, just before) an established migraine attack</li>\n<li>Exclusion of other reasonable causes by clinical and radiological studies</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '23 Disorders Of Optic Nerve And Gaze Palsies';
        const quizFilename = '23-disorders-of-optic-nerve-and-gaze-palsies-46556ce3.html';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>