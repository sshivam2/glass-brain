<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge  Mini Test - 1 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2021
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">15</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is used in first line management of postmenopausal osteoporosis:",
    "choices": [
      {
        "id": 1,
        "text": "Progesterone"
      },
      {
        "id": 2,
        "text": "Bisphosphonates"
      },
      {
        "id": 3,
        "text": "Tamoxifen"
      },
      {
        "id": 4,
        "text": "Combined oral contraceptives"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bisphosphonates</strong> are used&nbsp;in the first-line management of <strong>postmenopausal osteoporosis.</strong></p>\n<p><strong>Mechanism of action :-</strong></p>\n<ul>\n<li>Bisphosphonates are structurally similar to pyrophosphates and are incorporated into the bone matrix.</li>\n<li>They decrease bone resorption by impairing osteoclast function.</li>\n<li>Bisphosphonates concentrate at sites of active remodeling. They remain in the matrix until the bone is remodeled. Then, they are released in the acid environment of the resorption lacunae and induce apoptosis in osteoclasts.</li>\n<li>Osteoclasts internalize bisphosphonates as they are released along with calcium from the bone surface and then reduces osteoclast activity by\n<ul>\n<li>Promoting apoptosis of osteoclasts</li>\n<li>Disrupting the cytoskeleton and ruffled border of osteoclasts</li>\n<li>Inhibiting the differentiation of osteoclasts</li>\n</ul>\n</li>\n<li>The bisphosphonates approved for the treatment of osteoporosis are&nbsp;<strong>alendronate, risedronate, ibandronate, and zoledronate</strong></li>\n</ul>\n<p>Alendronate and risedronate can be administered daily or weekly with different dosages. Ibandronate can be administered daily, weekly or quarterly and&nbsp;<strong>Zoledronate</strong>&nbsp;is administered&nbsp;<strong>annually.</strong></p>\n<p><strong>Indications</strong> for bisphosphonates :-</p>\n<ul>\n<li>Osteoporosis</li>\n<li>Paget&rsquo;s disease</li>\n<li>Hypercalcemia of malignancy</li>\n<li>Osteolytic bone metastasis</li>\n</ul>\n<p><strong>Administration</strong> :-</p>\n<p>Bisphosphonates are<strong>&nbsp;not recommended</strong>&nbsp;to be&nbsp;<strong>administered</strong>&nbsp;<strong>with&nbsp;food</strong>&nbsp;to minimise esophageal irritation.</p>\n<p>Oral bisphosphonates have&nbsp;<strong>very limited bioavailability (&lt;1-10%). Bisphosphonates are recommended</strong>&nbsp;to be administered after an overnight fast with a full glass of water&nbsp;<strong>at least 30 minutes before breakfast</strong>. Remaining<strong>&nbsp;upright for 30 minutes</strong>&nbsp;after dosing and&nbsp;<strong>proton pump inhibitors</strong>&nbsp;at<strong>&nbsp;bedtime</strong>&nbsp;can decrease the symptoms</p>\n<p><strong>Adverse Effects</strong>:</p>\n<ul>\n<li><strong>Osteonecrosis of the jaw</strong>&nbsp;is associated with the use of<strong>&nbsp;bisphosphonates&nbsp;</strong></li>\n<li><strong>Atypical femur fracture -&nbsp;</strong>occurs in the subtrochanteric femoral region or along the shaft distal to the lesser trochanter.&nbsp;</li>\n</ul>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<div class=\"panel-body ng-scope\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of peptic ulcer underwent upper GI endoscopic biopsy of the stomach. The biopsy is stained with a special stain and shown in the image. What is the special stain used?",
    "choices": [
      {
        "id": 1,
        "text": "Gomori's methanamine silver stain"
      },
      {
        "id": 2,
        "text": "Warthin starry silver stain"
      },
      {
        "id": 3,
        "text": "Congo Red stain"
      },
      {
        "id": 4,
        "text": "Acid Fast stain"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The given slide shows the GI mucosa, which has been stained with&nbsp;<strong>Warthin-Starry silver stain</strong>, demonstrating the bacilli (Helicobacter pylori) causing type B gastritis<em><strong>.</strong></em></p>\n<p class=\"p1\"><span class=\"s1\">On antral biopsy, H. pylori organisms are seen abundantly within the surface mucus layer, but they are difficult to visualize with routine hematoxylin (H&amp;E) stains.&nbsp;</span>Organisms are most easily demonstrated with <strong>special stains</strong> like <strong>Warthin starry silver stain</strong> or <strong>Giemsa stain.</strong></p>\n<p><strong>Type B gastritis&nbsp;</strong></p>\n<ul>\n<li>Type B gastritis is associated with&nbsp;<em>H. pylori.</em></li>\n<li>It commonly affects the antrum.</li>\n<li>Intestinal metaplasia is associated with chronic pan-gastritis with atrophy.</li>\n<li>Intestinal metaplasia with dysplasia has&nbsp;<strong>malignant potential.</strong></li>\n</ul>\n<p><em>H. pylori</em>&nbsp;infection is also a risk factor for the following:</p>\n<ul>\n<li>Peptic ulcer disease (duodenal &gt; gastric)</li>\n<li>Gastric adenocarcinoma</li>\n<li>Gastric lymphoma</li>\n</ul>\n<div class=\"page\" title=\"Page 770\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span class=\"s1\"><strong>Image:&nbsp;Warthin-Starry silver stain </strong>showing Helicobacter pylori&nbsp;colonized on the surface of the regenerative epithelium.</span></p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c2909c74625d492dbe36d3e5bf08865d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b3e67860a1f42f9a6ee89d6c6b4a92ax600x400.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c816716cf7645eb9f76358bbb85f4f5x800x533.JPEG"
    ]
  },
  {
    "text": "Which of the following parasites may cause deficiency of vitamin B12?",
    "choices": [
      {
        "id": 1,
        "text": "Echinococcus granulosis"
      },
      {
        "id": 2,
        "text": "Diphyllobothrium latum"
      },
      {
        "id": 3,
        "text": "Ascaris lumbricoides"
      },
      {
        "id": 4,
        "text": "Taenia saginata"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diphyllobothrium latum</strong> causes deficiency of vitamin B12</p>\n<p>The anemia develops because the tapeworm absorbs a large quantity of Vitamin B12 and interferes with its ileal absorption leading to Vitamin B12 deficiency. In severe cases, patients may exhibit neurologic sequelae of vitamin B12 deficiency.</p>\n<p>Diphyllobothrium latum is also known as&nbsp;<strong>Fish tapeworm</strong>&nbsp;or&nbsp;<strong>Broad tapeworm</strong>.</p>\n<ul>\n<li>The first intermediate host is freshwater crustacean, while the second intermediate host is freshwater fish.</li>\n<li>The <strong>definitive</strong> hosts are <strong>man, dog, and cat.</strong></li>\n</ul>\n<p>The infective form to humans is the third stage plerocercoid larvae. It possesses a rudimentary scolex.&nbsp;The adult worm lives inside the small intestine and lays operculated eggs. These freshly passed eggs contain an immature embryo surrounded by yolk granules. This hexacanth embryo with 6 hooklets inside the egg is called&nbsp;<strong>Oncosphere</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e78f541f6f684ea5acf865db81ce60d0x1024x700.jpeg"
    ]
  },
  {
    "text": "A 19-year-old man presented with progressive swelling of the lower end of the femur. X-ray of this patient shows a Codman triangle. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Aneurysmal bone cyst"
      },
      {
        "id": 2,
        "text": "Ewing\u2019s sarcoma"
      },
      {
        "id": 3,
        "text": "Osteosarcoma"
      },
      {
        "id": 4,
        "text": "Osteoid osteoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a<strong> young patient</strong> with a tumour in the <strong>distal femur </strong>with a <strong>Codmnan's triangle</strong> on X-ray suggests a probable diagnosis of <strong>osteosarcoma</strong>.\u00a0</p>\n<p>Osteosarcoma is the most common non-hematologic primary malignancy of bone. It occurs most commonly in the\u00a0<strong>second decade of life.</strong>\u00a0It is\u00a0<strong>typically metaphyseal.</strong>\u00a0The\u00a0<strong>distal femur</strong>,\u00a0<strong>proximal tibia,</strong>\u00a0and\u00a0<strong>proximal humerus</strong>\u00a0are <strong>common sites.</strong></p>\n<p>In osteosarcoma, the tumour lifts the periosteum and incites an intense periosteal reaction. The periosteal reaction is irregular and it may take the form of a\u00a0Codman's triangle\u00a0or it may have a\u00a0<strong>sunburst (sunray) appearance</strong>\u00a0on<strong>\u00a0x-ray.</strong></p>\n<p>The x-ray would show the following features.</p>\n<ul>\n<li><strong>Irregular destruction</strong> in the <strong>metaphysis</strong> is overshadowed by the <strong>formation of new bone</strong></li>\n<li>Lifting of the periosteum due to the formation of new bone inciting\u00a0a<strong> periosteal reaction</strong></li>\n<li><strong>Bone formation along the blood vessels</strong> within the tumour centrifugally gives rise to a\u00a0<strong>sunburst (sunray) appearance</strong>\u00a0on the radiograph.</li>\n</ul>\n<p>Treatment: Osteosarcoma is treated by\u00a0<strong>neoadjuvant chemotherapy, wide excision or radical surgery followed by adjuvant chemotherapy</strong>. Since here safe margins are difficult to achieve\u00a0<strong>limb ablation</strong>\u00a0is done.\u00a0</p>\n<p>The goal of neoadjuvant and adjuvant chemotherapy is to\u00a0treat<strong> micrometastasis.</strong></p>\n<p><strong>T-10 protocol</strong>\u00a0of chemotherapy is used in the management of osteosarcoma. It involves:</p>\n<ul>\n<li>High-dose methotrexate and Citrovorum factor rescue</li>\n<li>Adriamycin</li>\n<li>BCD (bleomycin, cyclophosphamide, dactinomycin/doxorubicin)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e8b0622e70345e68234e9178bdcad08x570x570.PNG",
      "https://cdn1.dailyrounds.org/uploads/c5b22fec7ab241c2bbf07d0f7259495a.JPEG",
      "https://cdn1.dailyrounds.org/uploads/1b9c7489d898490bb71f0b84741343b7.JPEG",
      "https://cdn1.dailyrounds.org/uploads/8f3b7f4475fc4a0d9d3d4b9b1db0ede5.JPEG"
    ]
  },
  {
    "text": "Which of the following diseases is an example of point mutation?",
    "choices": [
      {
        "id": 1,
        "text": "Hemoglobin Lepore"
      },
      {
        "id": 2,
        "text": "\u03b2-Thalassemia type III"
      },
      {
        "id": 3,
        "text": "Hereditary Spherocytosis"
      },
      {
        "id": 4,
        "text": "Sickle cell disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>The <strong>classic example</strong><strong>&nbsp;of point mutation is</strong> <strong>sickle-cell disease</strong>.</li>\n<li>This is a <strong>T-to-A</strong> DNA substitution, which in turn results in an A-to-U change in the mRNA corresponding to the <strong>sixth codon</strong> of the <strong>&beta;-globin gene&nbsp;</strong>(Glutamic acid being replaced by valine).</li>\n<li>Defective production of &beta;-globin results in a variety of diseases and is due to many different lesions in and around the &beta;-globin gene.</li>\n</ul>\n<p>A&nbsp;<strong>point mutation</strong>&nbsp;is a change in which a single base is substituted with a different base. These are of two types:</p>\n<ol>\n<li><strong>Missense mutations</strong></li>\n<li><strong>Non-sense mutations</strong></li>\n</ol>\n<p><strong>1. Missense mutations:&nbsp;</strong>These mutations may involve&nbsp;<strong>alteration of a single base in a triplet of bases</strong>&nbsp;and lead to the&nbsp;<strong>replacement of one amino acid by another in the gene product.</strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Based on the substituted amino acid coded, the missense mutations are again of two types:</p>\n<p>a)&nbsp;<strong>Conservative missense mutation:&nbsp;</strong>The substituted amino acid is biochemically similar to the original. It typically causes little change.</p>\n<p>b)&nbsp;<strong>Non-conservative missense mutation:&nbsp;</strong>This type of mutation replaces the normal amino acid with a biochemically different one. An example of this type of mutation is&nbsp;<strong>sickle-cell anemia.</strong></p>\n<p><strong>2. Nonsense mutations:&nbsp;</strong>It is a point mutation in a sequence of DNA that results in a premature stop codon. For example,&nbsp;<strong>&beta;<sup>0</sup>&nbsp;t</strong><strong>halassemia.</strong></p>\n<p>Other options:</p>\n<p><strong>Hereditary spherocytosis (HS)</strong>&nbsp;is an inherited disorder caused by intrinsic defects in the red cell membrane skeleton that render red cells spheroid less deformable and vulnerable to splenic sequestration and destruction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old lady comes with abnormal uterine bleeding. Hysterectomy was performed and the following specimen was  retrieved. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Leiomyoma"
      },
      {
        "id": 2,
        "text": "Endometrial carcinoma"
      },
      {
        "id": 3,
        "text": "Endometrioma"
      },
      {
        "id": 4,
        "text": "Adenomyosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The specimen is of a Leiomyoma.</p>\n<p>The uterine body / corpus is enlarged and deformed. The cut surface shows <strong>multiple nodules, well-circumscribed, firm</strong>, white-greyish with a whorled appearance formed by the intersecting bundles of brown muscle fibers and white fibrous tissue. Leiomyomas can also present <strong>bleeding areas, cystic degeneration and calcifications</strong>. The <strong>uterine cavity is compressed</strong>.</p>\n<p><strong>Menstrual symptoms of fibroid includes:</strong></p>\n<ul>\n<li>Menorrhagia, polymenorrhoea, metrorrhagia, continuous or postmenopausal bleeding</li>\n<li>Dysmenorrhea</li>\n<li>Infertility, recurrent abortions</li>\n<li>Pain</li>\n<li>Pressure symptoms</li>\n<li>Abdominal lump</li>\n<li>Vaginal discharge</li>\n</ul>\n<p><strong>Drugs to reduce the size of the fibroid:</strong></p>\n<ul>\n<li>Antiprogesterone &ndash; Mifepristone/RU-486</li>\n<li>Danazol (Usually not used due to androgenic side effects)</li>\n<li><strong>GnRH</strong>&nbsp;\n<ul>\n<li><strong>Agonists</strong> &ndash; goserelin, leuprorelin, nafarelin, busereli</li>\n<li><strong>Antagonists</strong> &ndash; cetrorelix, ganirelix</li>\n</ul>\n</li>\n<li>Selective progesterone receptor modulator (SPRM&rsquo;s) &ndash;&nbsp;Ulipristal, Asoprisnil</li>\n</ul>\n<p><strong>Other medical methods to treat fibroids include:</strong></p>\n<ul>\n<li>Levonorgestrel IUD- controls bleeding effectively</li>\n<li>Combined oral contraceptives</li>\n<li>DMPA</li>\n<li>Tranexamic acid</li>\n<li>Iron therapy for anemia</li>\n<li>Selective estrogen-receptor modulators (SERMs) like tibolone and raloxifene are used as add-back therapy along with GnRH treatment. They reduce associated vasomotor symptoms and bone loss.</li>\n</ul>\n<p><strong>Radiological interventions for fibroids:</strong></p>\n<ul>\n<li>Uterine artery Embolization - Angiographic interventional procedure where polyvinyl alcohol microspheres are introduced into both uterine arteries, producing ischemia and necrosis of the fibroid.</li>\n<li>Magnetic Resonance guided Focused Ultrasound - Ultrasound energy is focused to cause coagulative necrosis in selected fibroids.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4bfb8009f52c4fca889e4c3a69e0c229.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Most common site of origin for nasopharyngeal carcinoma is",
    "choices": [
      {
        "id": 1,
        "text": "Nasal septum"
      },
      {
        "id": 2,
        "text": "Medial wall of nose"
      },
      {
        "id": 3,
        "text": "Fossa of Rosenmuller"
      },
      {
        "id": 4,
        "text": "Sphenopalatine foramen"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Commonest site of origin for nasopharyngeal carcinoma is the<strong> fossa of Rosenm&uuml;ller</strong>.</p>\n<ul>\n<li><strong>Epstein&ndash;Barr Virus (EBV)</strong>&nbsp;is closely associated with nasopharyngeal cancer.</li>\n<li>EB virus has two important antigens:&nbsp;<strong>Viral capsid antigen</strong>&nbsp;(<strong>VCA</strong>) and&nbsp;<strong>Early antigen</strong>&nbsp;(<strong>EA</strong>).</li>\n<li><strong>IgA antibodies against both EA and VCA should be done for screening of patients for nasopharyngeal cancer</strong>.</li>\n</ul>\n<p><strong>Presenting symptoms and signs</strong> of nasopharyngeal cancer in order of frequency are:</p>\n<ul>\n<li><strong>Cervical lymphadenopathy (most common) (60&ndash;90%)</strong></li>\n<li>Hearing loss</li>\n<li>Nasal obstruction</li>\n<li>Epistaxis</li>\n<li>Cranial nerve palsies -Cranial nerves V and VI are the most commonly involved among all the cranial nerves.&nbsp;</li>\n<li>Headache</li>\n<li>Earache</li>\n<li>Neck pain</li>\n<li>Weight loss</li>\n</ul>\n<p><strong>Trotter&rsquo;s Triad:</strong></p>\n<ol>\n<li>Conductive hearing loss</li>\n<li>Immobility of homolateral soft palate</li>\n<li>Trigeminal neuralgia</li>\n</ol>\n<p><strong>Pathology:</strong></p>\n<p>&nbsp;Gross image would either be ulcerative or proliferative or infiltrative,&nbsp;<strong>cystic presentation is not seen</strong>. Microscopy would reveal squamous cell carcinoma or anaplastic variety and ectodermal features are seen.&nbsp;</p>\n<p><strong>Radiotherapy is the treatment of choice for nasopharyngeal cancer.</strong></p>\n<ul>\n<li>Stage I and II are treated by radiotherapy alone.</li>\n<li>Stage III and IV require concomitant radiation and chemotherapy or radiation followed by chemotherapy</li>\n<li>Radical neck dissection can be done in case of recurrent or residual disease.</li>\n</ul>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with the complaints of chest pain. Which among the following is the best investigation to diagnose MI within 2-4 hours?",
    "choices": [
      {
        "id": 1,
        "text": "LDH"
      },
      {
        "id": 2,
        "text": "CK"
      },
      {
        "id": 3,
        "text": "Troponin-T"
      },
      {
        "id": 4,
        "text": "Myoglobin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>\u00a0Measurement of Troponin\u00a0is the best investigation to diagnose MI within 2-4 hours.</p>\n<p><strong>Troponin T and Troponin I</strong></p>\n<ul>\n<li>These are the proteins that mediate calcium-mediated contraction of the cardiac and the skeletal muscles.</li>\n<li>They are<strong>\u00a0highly specific\u00a0</strong>for MI.</li>\n<li>Troponins will remain elevated longer than creatine kinase (CK), for\u00a0<strong>up to 14 days.</strong></li>\n</ul>\n<p><strong>Creatine phosphokinase (CK)</strong>:\u00a0</p>\n<ul>\n<li>\n<div class=\"page\" title=\"Page 1921\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>CK</strong> rises within 4\u20138 h and generally returns to normal by 48\u201372 h. However, CK is non-specific, as\u00a0it may be elevated with skeletal muscle disease or trauma, including intramuscular injection.\u00a0The MB isoenzyme of CK (CK-MB) is not significantly found in the extracardiac tissue, and is more specific.</p>\n</div>\n</div>\n</div>\n</li>\n</ul>\n<p><strong>Lactate dehydrogenase (LDH)</strong></p>\n<ul>\n<li>Normally, serum levels of LDH2 is greater than those of LDH1; but, in MI, LDH1 is more than LDH2. This is called\u00a0<strong>flipping of the LDH ratio</strong>.</li>\n<li>Current recommendations suggest that LDH <strong>no longer has a role</strong> in the diagnosis of MI.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c48026a9bd94a24bd2257447ed40363x1280x1230.JPEG"
    ]
  },
  {
    "text": "Which of the following is an important sign of antemortem drowning:",
    "choices": [
      {
        "id": 1,
        "text": "Petechial hemorrhages in the eyes"
      },
      {
        "id": 2,
        "text": "Edema aquosum"
      },
      {
        "id": 3,
        "text": "Cadaveric spasm"
      },
      {
        "id": 4,
        "text": "Washer woman\u2019s hand"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An important sign of <strong>antemortem drowning</strong> is <strong>cadaveric spasm</strong> which manifests as weed, grass ,sticks etc. floating in the water being firmly grasped in the hands. When present, it is an important sign suggesting that the victim <strong>struggled for existence while in water</strong>.</p>\n<p>&nbsp;Features like&nbsp;<strong>emphysema aquosum</strong>,&nbsp;froth in the air passages, hemorrhage into the middle ears, and subpleural hemorrhages are seen in cases of<strong>&nbsp;drowning.&nbsp;</strong>Overinflation of the lungs in drowning is known as&nbsp;<strong>emphysema aquosum</strong>. The edema fluid in the bronchi blocks the passive collapse that normally occurs at death, holding the lungs in the inspiratory position. In drowning this may be&nbsp;<strong>sufficient to mark the lateral surfaces of the lungs with the impression of the ribs</strong>, leaving visible and palpable grooves after removal of the organs from the thorax.&nbsp;This is a valuable positive sign of drowning to be gained at autopsy.</p>\n<p>Autopsy findings in drowning:</p>\n<ul>\n<li><strong>Froth in the air passages</strong>&nbsp;- The most useful autopsy sign in drowning. It consists of a proteinaceous exudate and surfactant mixed with the water of the drowning medium.</li>\n<li><strong>Waterlogging of the lung</strong>&nbsp;- Frothy fluid will exude from the bronchi when the lung is squeezed and from the cut surfaces when they are sectioned with a knife. But,&nbsp;absence of waterlogging by no means excludes true drowning (e.g. dry drowning).</li>\n<li><strong>Emphysema aqueosum</strong>&nbsp;- Overinflation of the lungs.</li>\n<li><strong>Paltauf&rsquo;s spots</strong>&nbsp;- Subpleural haemorrhages that probably reflect haemolysis within intra-alveolar haemorrhages, and have been described in 50&ndash;60% of drownings.</li>\n<li>Dilation of right heart and great veins - This is a very subjective and non-specific finding.</li>\n<li><strong>Foreign material in stomach</strong>&nbsp;-&nbsp;The stomach may contain watery fluid or even foreign material from the water, such as silt, weed or sand. This is also not a finding which can diagnose drowning.</li>\n<li><strong>Haemorrhage into the middle ears</strong>&nbsp;and into the&nbsp;<strong>temporal bone</strong>&nbsp;- This has been postulated as a positive sign of drowning, it is a non-specific finding.</li>\n<li>Presence of&nbsp;<strong>fluid in the middle ear</strong>&nbsp;or paranasal sinuses - Also not a reliable diagnostic sign of drowning.</li>\n</ul>\n<p>Note - Thus, the autopsy findings in drowning are mostly nonspecific and none give conclusive evidence of drowning. The most useful one is&nbsp;<strong>froth in the air passages.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/7c49cd2c216b4a43bf964b1c6fd7877dx286x283.PNG"
    ]
  },
  {
    "text": "A 7-year-old child presented with complaints of bed-wetting almost twice a week for the past 1 year. A detailed investigation was done to rule out the organic cause. What should be the treatment plan for this child?",
    "choices": [
      {
        "id": 1,
        "text": "Pharmacotherapy with imipramine"
      },
      {
        "id": 2,
        "text": "Psychodynamic psychotherapy"
      },
      {
        "id": 3,
        "text": "Bladder training (with reward for delaying micturition during daytime)"
      },
      {
        "id": 4,
        "text": "Bell and pad based classical conditioning"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical features are suggestive of nocturnal enuresis.&nbsp;<strong>Bell and pad based classical conditioning</strong> is the most effective treatment.</p>\n<p><strong>Nocturnal enuresis</strong> refers to the&nbsp;occurrence of involuntary urination at night after 5 years of age. It may be a normal phenomenon in children up to 5 years of age.</p>\n<p>Treatment for nocturnal enuresis may include either behavioural therapy, pharmacotherapy, or psychotherapy.</p>\n<p><strong>Behavioural therapy:</strong></p>\n<ul>\n<li>Classic conditioning with the <strong>bell</strong> (or buzzer) and <strong>pad</strong> (alarm) apparatus is the <strong>most effective</strong> treatment for enuresis.</li>\n<li>Dryness is achieved in 50% of the cases.</li>\n<li><strong>Bladder training</strong> with encouragement or reward for delaying micturition for increasing times during waking hours is useful but considered as an <strong>inferior</strong>&nbsp;to bell and pad.</li>\n</ul>\n<p><strong>Pharmacotherapy:</strong></p>\n<ul>\n<li>Medications should be considered<strong> if behavioural therapy has failed,</strong> and if enuresis is causing impairment in social, family, and school function.</li>\n<li>Desmopressin (an antidiuretic) and&nbsp;Reboxetine (norepinephrine reuptake inhibitor) are commonly used drugs. Reboxetine is considered as a <strong>safer alternative to imipramine.</strong></li>\n</ul>\n<p><strong>Psychotherapy:</strong></p>\n<ul>\n<li>It is indicated in cases with chronic enuresis, to deal with any coexisting psy&shy;chiatric problems and the emotional and family difficulties.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year child is brought to the pediatrician for the evaluation of the lateral neck mass. On examination, a painless, soft, fluctuating mass is found in the lateral side of the neck as shown in the image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystic hygroma"
      },
      {
        "id": 2,
        "text": "Thyroglossal cyst"
      },
      {
        "id": 3,
        "text": "Ranula"
      },
      {
        "id": 4,
        "text": "Cervical lymphadenopathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A soft, painless, fluctuating mass found in the posterior part of the neck in a child, is most likely to be a cystic hygroma.</p>\n<p>Cystic hygroma is a lymph filled sac that results from the obstruction of the lymph vessels during their development. It is most commonly present in the <strong>posterior triangle of the neck</strong>. The mass may be apparent at birth or may appear in early childhood due to the increased accumulation of lymph. Since the sac is filled with lymph, it is soft, fluctuating, and <strong>brilliantly transilluminant.</strong></p>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li>Lymphangiomas are treated by<strong>\u00a0surgical excision</strong>\u00a0and<strong>\u00a0image-guided\u00a0sclerotherapy.</strong></li>\n<li>Initially, surgical excision\u00a0is done to safely remove the lymphatic malformation without causing any\u00a0damage to the adjacent vital tissues such as\u00a0blood vessels,\u00a0nerves, or muscles.</li>\n<li>For large tumors\u00a0and the tumors that extend to the\u00a0base of the tongue\u00a0or floor of the mouth,\u00a0<strong>combined sclerotherapy</strong>\u00a0and\u00a0<strong>surgical\u00a0resection</strong>\u00a0are done.</li>\n<li>If there is any residual lymphatic malformation after the treatment, then a conservative excision or unroofing of the cyst is done. It may be combined with sclerosing therapy or repeated partial excisions.</li>\n</ul>\n<p>Note: The terms lymphangioma and cystic hygromas are older terms. They are now called lymphatic malformations.</p>\n<p>Option B: A <strong>thyroglossal duct cyst</strong> is a congenital <strong>midline</strong> neck swelling that typically presents during childhood often noticed after an upper respiratory infection. Classically the cyst moves upwards on swallowing and on tongue protrusion. This indicates attachment to the hyoid bone and the swelling is smooth, soft, fluctuant (cystic), non-tender, mobile, and shows transillumination.</p>\n<p>Option C : <strong>Ranula</strong> is a transilluminant mucocele. It is also known as \"frog's belly\", as it resembles the vocal sacs of a frog. It occurs due to an obstruction in the sublingual salivary gland. A ranula usually presents as a large, tense, bluish swelling on the floor of the mouth to one side on the midline. If the obstruction happens in the ducts of minor salivary glands such as labial or buccal, it is termed mucocele.</p>\n<p>Option D: <strong>Cervical lymphadenopathy</strong> is seen in children with infections of the parotid and upper respiratory tract infections. On palpation, they are firm and non-fluctuant.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dc231d7f9e9d4e29b81fa21152a7ed77.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old patient with history of hepatitis and behavioral changes is known to have an inborn error of metabolism. Ocular examination of this patient shows the following finding. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypercholesterolemia"
      },
      {
        "id": 2,
        "text": "Galactosemia"
      },
      {
        "id": 3,
        "text": "Wilson\u2019s disease"
      },
      {
        "id": 4,
        "text": "Homocystinuria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows <strong>Kayser&ndash;</strong><strong>Fleisher ring</strong>, which is&nbsp;seen in <strong>Wilson&rsquo;s disease.&nbsp;</strong>&nbsp;</p>\n<p><strong><span data-preserver-spaces=\"true\">Kayser-Fleischer ring (</span></strong><span data-preserver-spaces=\"true\">KF) Ring:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">KF ring is a golden-brown ring formed due to the&nbsp;</span><strong><span data-preserver-spaces=\"true\">deposition of copper in Descemet&rsquo;s membrane of the cornea</span></strong></li>\n<li><span data-preserver-spaces=\"true\">Characteristically observed in Wilson's disease but is not pathognomonic</span></li>\n<li><span data-preserver-spaces=\"true\">Does not interfere with vision</span></li>\n<li><span data-preserver-spaces=\"true\">Present in almost all patients of Wilson's disease with neurological/psychiatric symptoms</span></li>\n<li><span data-preserver-spaces=\"true\">Present only in 30&ndash;50% of patients diagnosed in the hepatic or presymptomatic state, therefore the absence of KF rings does not exclude the diagnosis of Wilson's disease.</span></li>\n</ul>\n<p><strong>Wilsons disease:</strong></p>\n<p>The&nbsp;<strong><span data-preserver-spaces=\"true\">autosomal-recessive</span></strong><span data-preserver-spaces=\"true\">&nbsp;disease is caused by mutations in the&nbsp;</span><strong><em><span data-preserver-spaces=\"true\">ATP7B&nbsp;</span></em><span data-preserver-spaces=\"true\">gene</span></strong><span data-preserver-spaces=\"true\">, which encodes a membrane-bound, copper-transporting ATPase.</span></p>\n<p><span data-preserver-spaces=\"true\">Clinical symptoms:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Hepatitis and cirrhosis</span></li>\n<li><span data-preserver-spaces=\"true\">Behavioral disturbances</span></li>\n<li>Wing beating tremor</li>\n<li><strong>Ophthalmic characteristics:</strong></li>\n<ul>\n<li class=\"ql-indent-1\">Deposition of copper in the posterior capsule of the lens resulting in<strong>&nbsp;sunflower cataract</strong></li>\n<li class=\"ql-indent-1\"><strong>KF ring&nbsp;</strong></li>\n</ul>\n</ul>\n<p><span data-preserver-spaces=\"true\">Diagnosis:</span></p>\n<ul>\n<ul>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Presence of KF rings</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Decreased serum ceruloplasmin (copper-containing enzyme/ferroxidase) levels</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Measured hepatic copper levels in liver biopsy</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Increased 24-hour urine copper excretion</span></li>\n</ul>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">The gold standard</span></strong><span data-preserver-spaces=\"true\">&nbsp;for diagnosis:&nbsp;</span><strong><span data-preserver-spaces=\"true\">Liver biopsy</span></strong><span data-preserver-spaces=\"true\">&nbsp;with quantitative copper assays</span></p>\n<p><span data-preserver-spaces=\"true\">Treatment:</span><strong><span data-preserver-spaces=\"true\">&nbsp;Trientine and Zinc</span></strong><span data-preserver-spaces=\"true\">&nbsp;is the first choice of a drug regimen to be used for treating mild hepatic decompensation in Wilson&rsquo;s disease.</span></p>\n<p><strong>Recommended drugs in Wilsons disease:</strong></p>\n<table style=\"height: 363px; width: 497.25px;\" border=\"all\">\n<tbody>\n<tr>\n<td style=\"width: 167px;\"><strong>Disease Status</strong></td>\n<td style=\"width: 150px;\"><strong>First Choice</strong></td>\n<td style=\"width: 158px;\"><strong>Second Choice</strong></td>\n</tr>\n<tr>\n<td style=\"width: 167px;\"><strong>Initial</strong></td>\n<td style=\"width: 150px;\">&nbsp;</td>\n<td style=\"width: 158px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">\n<p>Hepatitis or Cirrhosis without decompensation</p>\n</td>\n<td style=\"width: 150px;\">Zinc</td>\n<td style=\"width: 158px;\">Trientine</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\"><strong>Hepatic decompensation</strong></td>\n<td style=\"width: 150px;\">&nbsp;</td>\n<td style=\"width: 158px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">Mild</td>\n<td style=\"width: 150px;\">Trientine and Zinc</td>\n<td style=\"width: 158px;\">Penicillamine and Zinc</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">Moderate</td>\n<td style=\"width: 150px;\">Trientine and Zinc</td>\n<td style=\"width: 158px;\">Hepatic transplantation</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">Severe</td>\n<td style=\"width: 150px;\">Hepatic Transplantation</td>\n<td style=\"width: 158px;\">Trientine and Zinc</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">Initial neurological/Psychiatric</td>\n<td style=\"width: 150px;\">Tetrathiomolybdate and Zinc</td>\n<td style=\"width: 158px;\">Zinc</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">Maintenance</td>\n<td style=\"width: 150px;\">Zinc</td>\n<td style=\"width: 158px;\">Trientine</td>\n</tr>\n<tr>\n<td style=\"width: 167px;\">Presymptomatic</td>\n<td style=\"width: 150px;\">Zinc</td>\n<td style=\"width: 158px;\">Trientine</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b19d6461ae924e73b2b2ba3928e2baea.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Foot drop along with loss of eversion is caused by damage to:",
    "choices": [
      {
        "id": 1,
        "text": "Common peroneal nerve"
      },
      {
        "id": 2,
        "text": "Deep Peroneal nerve"
      },
      {
        "id": 3,
        "text": "Tibial nerve"
      },
      {
        "id": 4,
        "text": "Femoral Nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Foot drop with loss of eversion is caused by damage to the <strong>common peroneal nerve</strong>.</p>\n<p>The common peroneal nerve is a <strong>component of the sciatic nerve</strong>. In the posterior thigh, it supplies the <strong>short head of biceps femoris</strong>. It curves around the neck of fibula deep to peroneus longus and divides into superficial and deep peroneal nerves.</p>\n<ul>\n<li>The <strong>superficial peroneal</strong> nerve innervates peroneus longus and peroneus brevis which are the <strong>evertors</strong> of foot and to the skin over dorsal area of foot except the first webspace and lateral side of little toe.</li>\n<li>The <strong>deep peroneal</strong> nerve innervates all muscles of <strong>anterior compartment</strong> which are the <strong>dorsiflexors</strong> of foot, extensor digitorum brevis, first two dorsal interossei muscles and skin between great and second toes.</li>\n</ul>\n<p>Common peroneal nerve is closely related to<strong>&nbsp;neck of the fibula</strong> and hence the nerve is commonly injured in fracture involving this area.</p>\n<p>Injury to common peroneal nerve will lead to:</p>\n<ul>\n<li>Weakness of dorsiflexion of foot or&nbsp;<strong>foot drop</strong></li>\n<li><strong>Loss of eversion</strong></li>\n<li>Loss of extension of toes</li>\n<li>Sensory loss along the anterior and lateral side of the leg, dorsum of foot including the medial side of great toe.</li>\n</ul>\n<p>Note: Injury to the deep peroneal nerve will cause foot drop with intact eversion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3d52bcf03ec442bfa7909cf6ba2a7033x1280x2400.JPEG"
    ]
  },
  {
    "text": "A 75-year-old male with chronic kidney disease comes for a routine follow-up. His chest X-ray is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic Regurgitation"
      },
      {
        "id": 2,
        "text": "Mitral annular calcifications"
      },
      {
        "id": 3,
        "text": "Atrial Myxoma"
      },
      {
        "id": 4,
        "text": "Calcified atrial thrombus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The image shows a\u00a0</span><strong><span data-preserver-spaces=\"true\">mitral annular calcification.</span></strong><span data-preserver-spaces=\"true\">\u00a0It is a\u00a0</span><strong><span data-preserver-spaces=\"true\">chronic degenerative process</span></strong><span data-preserver-spaces=\"true\">\u00a0affecting the\u00a0</span><strong><span data-preserver-spaces=\"true\">mitral valve ring</span></strong><span data-preserver-spaces=\"true\">\u00a0and can be a\u00a0</span><strong><span data-preserver-spaces=\"true\">rheumatic</span></strong><span data-preserver-spaces=\"true\">\u00a0sequela.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">The clinical vignette gives clues towards the\u00a0</span><strong><span data-preserver-spaces=\"true\">multiple co-morbidities and complications\u00a0</span></strong><span data-preserver-spaces=\"true\">that may be associated with MAC.\u00a0</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Stroke</span></li>\n<li><span data-preserver-spaces=\"true\">Atherosclerosis</span></li>\n<li><span data-preserver-spaces=\"true\">Chronic Kidney Disease\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Mitral Regurgitation\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Mitral Stenosis\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Arrhythmias, atrial fibrillation\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Endocarditis\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Aortic Stenosis\u00a0</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Surgical treatment</span></strong><span data-preserver-spaces=\"true\">\u00a0is indicated only if\u00a0</span><strong><span data-preserver-spaces=\"true\">concomitant stenosis</span></strong><span data-preserver-spaces=\"true\">\u00a0or\u00a0</span><strong><span data-preserver-spaces=\"true\">regurgitation</span></strong><span data-preserver-spaces=\"true\">\u00a0is to be\u00a0</span><strong><span data-preserver-spaces=\"true\">corrected.</span></strong><span data-preserver-spaces=\"true\">\u00a0Severe MAC makes the surgery difficult. Isolated MAC does not require endocarditis prophylaxis.\u00a0</span><strong><span data-preserver-spaces=\"true\">Anti-coagulation</span></strong><span data-preserver-spaces=\"true\">\u00a0and\u00a0</span><strong><span data-preserver-spaces=\"true\">anti-platelet</span></strong><span data-preserver-spaces=\"true\">\u00a0medications are\u00a0</span><strong><span data-preserver-spaces=\"true\">recommended</span></strong><span data-preserver-spaces=\"true\">\u00a0within the guidelines of treatment of the\u00a0</span><strong><span data-preserver-spaces=\"true\">comorbid</span></strong><span data-preserver-spaces=\"true\">\u00a0conditions.\u00a0</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/67995ff3a7704c2b89740580006b16de.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e16fa792b821404787972ec8cc7089d0x957x798.PNG"
    ]
  },
  {
    "text": "A healthy child is brought to the pediatrician for a routine check-up. The child comes in with a toy in her hand and readily shares it with the doctor. She is able to say her name. Her mother says she does most of her activities with her right hand now. If she is given a paper and pen, which of the following will she be able to do?",
    "choices": [
      {
        "id": 1,
        "text": "Copy a circle"
      },
      {
        "id": 2,
        "text": "Writes numbers"
      },
      {
        "id": 3,
        "text": "Copy a square"
      },
      {
        "id": 4,
        "text": "Copy a triangle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This child who is able to say her name, shares toys, and has developed handedness is around three years of age and she will be able to copy a circle.</p>\n<p>Developmental milestones at the age of three:</p>\n<p><strong>Social and Emotional:</strong></p>\n<p>These children usually copy adults and friends, engage in cooperative play, show affection for friends and concern for crying friends without prompts, understand the concept of ownership but are able to share toys, show a wide range of emotions, and may get upset with changes in routine easily.</p>\n<p><strong>Language and Communication:</strong></p>\n<p>Follow instructions with two/three steps, can name most things around them, understand prepositions, use pronouns, name friends and make a simple conversation with two sentences.</p>\n<p><strong>Cognitive:</strong></p>\n<p>Copy a circle with a crayon, turn book pages one at a time, build towers with six or more blocks, screw and unscrew jars/lids and can do puzzles with four or fewer pieces</p>\n<p><strong>Motor:</strong></p>\n<p>Climb well, run easily, pedal a tricycle and walk up and down stairs with one foot on each step</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge  Mini Test - 1';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2021"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>