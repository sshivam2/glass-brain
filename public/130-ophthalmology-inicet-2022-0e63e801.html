<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>130 Ophthalmology Inicet 2022 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the action of the superior oblique muscle?",
    "choices": [
      {
        "id": 1,
        "text": "Intorsion, abduction, depression"
      },
      {
        "id": 2,
        "text": "Intorsion, adduction, elevation"
      },
      {
        "id": 3,
        "text": "Extorsion, abduction, depression"
      },
      {
        "id": 4,
        "text": "Extorsion, adduction, elevation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;</p>\n<p>Unilateral movements (<strong>ductions</strong>) are :</p>\n<p>1.<strong>Adduction</strong>: It is the movement towards the nasal side around the vertical axis.</p>\n<p>2.<strong>Abduction</strong>: It is the movement towards the temporal side around the vertical axis.</p>\n<p>3.Supraduction (<strong>elevation</strong>): It is upward movement around the horizontal axis.</p>\n<p>4.Infraduction (<strong>depression</strong>): It is downward movement around the horizontal axis.</p>\n<p>5.<strong>Intorsion</strong> (medial rotation): Rotatory movement along the anteroposterior axis where the superior pole of cornea moves medially.</p>\n<p>6.<strong>Extorsion</strong> (lateral rotation): Rotatory movement along the anteroposterior axis where the superior pole of cornea moves laterally.</p>\n<p>Binocular movements can be of two types - <strong>versions</strong> and <strong>vergences</strong>.</p>\n<p>The <strong>oculomotor</strong> nerve supplies <strong>all</strong> the extraocular muscles <strong>except</strong> the superior oblique and lateral rectus. The <strong>superior oblique muscle</strong> is supplied by the <strong>trochlear nerve</strong> and <strong>lateral rectus muscle</strong> by the <strong>abducent nerve</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/191127edb47045fd8bab35cb52a40d79x1280x788.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f41eaff69ff84d0e8ed9a97729705456x1280x1178.JPEG"
    ]
  },
  {
    "text": "Which of the following triad is seen after an acute attack of angle-closure glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Vogt's triad"
      },
      {
        "id": 2,
        "text": "Virchow triad"
      },
      {
        "id": 3,
        "text": "Hutchinson's triad"
      },
      {
        "id": 4,
        "text": "Gaucher triad"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Vogt's triad</strong> is seen <strong>after</strong> an acute attack of primary angle-closure. It includes <strong>glaukomflecken</strong>, <strong>patches </strong>of<strong> iris atrophy</strong>, and a <strong>slightly dilated nonreactive pupil</strong>. Glaukomflecken is used to describe an anterior subcapsular <strong>lenticular opacity</strong>. The slightly dilated pupil is attributed to <strong>sphincter atrophy</strong>.</p>\n<p><strong>Glaucoma</strong> is used to describe a group of conditions where there is progressive optic neuropathy with irreversible visual field defects associated with<strong> raised intraocular pressure</strong>. It can be classified into congenital/developmental glaucomas, primary adult glaucomas, and secondary adult glaucomas. Primary adult glaucomas are of three types:</p>\n<ul>\n<li>Primary open-angle glaucoma (POAG)</li>\n<li>Primary angle-closure glaucoma (PACG)</li>\n<li>Primary mixed mechanism glaucoma.&nbsp;</li>\n</ul>\n<p>In <strong>primary angle-closure disease</strong>, there is <strong>apposition</strong> of the <strong>peripheral iris</strong> with the <strong>trabecular</strong> <strong>meshwork</strong>. This interferes with the drainage of aqueous humor. It is seen more commonly in <strong>elderly females</strong>. Anatomical risk factors include<strong> hypermetropic eyes</strong>, anteriorly placed iris-lens diaphragm, and a narrow-angle of the anterior chamber. The international society of geographical and epidemiological opthalmology (<strong>ISGEO</strong>) has classified primary angle-closure disease into three types.</p>\n<ul>\n<li>Primary angle-closure suspect (<strong>PACS</strong>)</li>\n<li>Primary angle-closure (<strong>PAC</strong>)</li>\n<li>Primary angle-closure glaucoma (<strong>PACG</strong>).&nbsp;</li>\n</ul>\n<p>PACS and PAC are seen before the development of PACG. Vogt triad is seen after an acute attack of PAC.</p>\n<p>PAC includes irido-trabecular contact on gonioscopy and elevated intraocular pressure (IOP) and/or peripheral anterior synechiae. The optic disc and visual fields are usually normal. Due to any reason, there can be an acute rise of IOP in patients with PAC. It is a <strong>vision-threatening emergency</strong> and the sequelae of which can be ciliary body shut down, Vogt's triad, and rarely spontaneous angle reopening.</p>\n<p>Other options:</p>\n<p>Option B -<strong> Virchow triad</strong> is used to describe the abnormalities that result in<strong> thrombosis</strong>. These include endothelial injury, abnormal blood flow, and hypercoagulability of the blood.</p>\n<p>Option C - <strong>Hutchinson triad</strong> is used to describe manifestations of congenital syphilis. It includes interstitial keratitis, Hutchinson teeth, and eighth nerve deafness. Hutchinson teeth are screw-driver or peg shaped small incisors.</p>\n<p>Option D - Gaucher's triad is not a named triad.<strong> Hypertonia</strong>, <strong>strabismus</strong>, and <strong>stridor</strong> usually point to a diagnosis of type 2 Gaucher's disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions do you see punched-out lesions of the retina?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior staphyloma"
      },
      {
        "id": 2,
        "text": "Fundal coloboma"
      },
      {
        "id": 3,
        "text": "Congenital rubella"
      },
      {
        "id": 4,
        "text": "Toxoplasmosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Other options:</p>\n<p>Option A - <strong>Posterior staphyloma</strong> is used to describe a bulge in the <strong>sclera </strong>with the <strong>choroid</strong> behind the equator. On ophthalmoscopy, there is an <strong>excavated area</strong> with r<strong>etinal vessels</strong> dipping in it.&nbsp;</p>\n<p>Option B - <strong>Fundal coloboma</strong> occurs due to a defect in the closure of the embryonic cleft. It appears as a <strong>comet-shaped</strong> defect with the apex towards the disc which may or may not be involved. A few choroidal or retinal vessels may also be seen on the surface.&nbsp;</p>\n<p>Option C - <strong>Congenital rubella</strong> typically produces a <strong>salt and pepper</strong> appearance of the fundus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96b3261505f24644ad2ef07e66c2d03dx662x661.PNG"
    ]
  },
  {
    "text": "Which of the following has familial inheritance?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 4"
      },
      {
        "id": 2,
        "text": "1, 2, 3"
      },
      {
        "id": 3,
        "text": "1, 3"
      },
      {
        "id": 4,
        "text": "3, 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>All</strong> the above <strong>conditions</strong>\u00a0(1, 2, 3, 4) have a familial inheritance.\u00a0</p>\n<p><strong>Retinoblastoma</strong> is a malignancy arising from the retina more commonly seen in <strong>children</strong>. 10% of the cases are familial. These cases have an<strong> autosomal dominant</strong> mode of inheritance. The remaining 90% occurs sporadically. The clinical presentation includes <strong>leucocoria</strong>, <strong>strabismus</strong>, and painful red eye.\u00a0</p>\n<p><strong>Retinitis pigmentosa</strong> is a <strong>pigmental retinal dystrophy</strong> where the photoreceptors, especially <strong>rods</strong> are affected. Around 50 - 60% of the cases have a familial inheritance. It has <strong>multiple</strong> modes of <strong>inheritance,</strong> autosomal dominant, autosomal recessive and X-linked recessive. <strong>Night blindness</strong> is a characteristic feature. <strong>Tubular vision</strong>\u00a0is seen in advanced cases.</p>\n<p><strong>Myopia\u00a0</strong>(shortsightedness) is a refractive error in which the light rays from infinity are focused in <strong>front</strong> of the retina. It is proven to have familial inheritance. Features include defective vision, <strong>impaired night vision</strong>,\u00a0and <strong>muscae volitantes</strong>.\u00a0</p>\n<p><strong>Primary open-angle glaucoma</strong> has a <strong>normal anterior chamber angle.\u00a0</strong>Family history is a risk factor implicated in the condition. Symptoms include headache, <strong>scotoma</strong>, and <strong>delayed dark adaptation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presented with lagophthalmos, orbicularis oculi palsy, and loss of corneal sensation. Which of the following is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Acanthamoeba castellanii"
      },
      {
        "id": 2,
        "text": "Mycobacterium leprae"
      },
      {
        "id": 3,
        "text": "Onchocerca volvulus"
      },
      {
        "id": 4,
        "text": "Chlamydia A to C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><em><strong>Mycobacterium leprae</strong></em> is the most likely causative organism based on the clinical features given which points to <strong>ocular manifestations</strong> of <strong>leprosy</strong>. These include <strong>corneal anesthesia</strong>, <strong>lagophthalmos</strong>, <strong>corneal ulceration</strong>, episcleritis, and iris atrophy. Patients can also present with cataract, glaucoma, and <strong>madarosis</strong>.</p>\n<p>Lagophthalmos is the inability to close the eyelids. This can be due to the involvement of the zygomatic branch of the <strong>facial nerve</strong> (as in leprosy). Other causes of lagophthalmos include extreme <strong>proptosis</strong> and <strong>symblepharon</strong>. The decreased corneal sensation seen is due to the involvement of the ophthalmic branch of the <strong>trigeminal nerve</strong> which innervates the cornea.&nbsp;</p>\n<p>Other options:</p>\n<p>Option A - <strong>Acanthamoeba castellanii</strong> can lead to acanthamoeba keratitis which presents with<strong> pain</strong>, lacrimation, <strong>photophobia</strong>, and foreign body sensation. It results from direct corneal contact with infected material. <strong>Contact lens users</strong> are at an increased risk. <strong>Radial keratoneuritis</strong> is pathognomonic.&nbsp;</p>\n<p>Option C -<strong> Onchocerca volvulus</strong> causes onchocerciasis commonly seen in <strong>African</strong> countries. Symptoms include <strong>sclerosing keratitis</strong>, <strong>uveitis</strong>, chorioretinitis, and optic neuritis. Ultimately it can lead to <strong>optic atrophy</strong>.&nbsp;</p>\n<p>Option D - <strong>Chlamydia trachomatis</strong> serovars <strong>A</strong>, <strong>B</strong>, <strong>Ba</strong>, and <strong>C</strong> are responsible hyperendemic (<strong>blinding</strong>) <strong>trachoma</strong>. The source of infection is infected conjunctival discharge. If there is <strong>no</strong> secondary bacterial infection, symptoms include <strong>lacrimation</strong>, scanty mucoid discharge&nbsp;and <strong>foreign body sensation</strong>. <strong>Conjunctival</strong> congestion and follicles, <strong>papillary hyperplasia</strong>, <strong>Herbert follicles</strong> (seen in the limbal area), and<strong> progressive pannus</strong> are the characteristic features. Serovars D to K causes neonatal and adult <strong>inclusion conjunctivitis</strong>. Neonates present with conjunctival discharge, chemosis and swollen lids. Adult inclusion conjunctivitis more commonly seen in <strong>sexually active adults</strong> present with foreign body sensation, mild photophobia, and mucopurulent discharge.&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old female patient presents with sudden diminishing vision associated with relative afferent pupillary defect in the right eye. On examination, the left eye is normal. Which of the following investigations would you do next?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, and 3"
      },
      {
        "id": 2,
        "text": "1 and 2"
      },
      {
        "id": 3,
        "text": "2 and 3"
      },
      {
        "id": 4,
        "text": "3 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette is suggestive of <strong>optic neuritis</strong>. <strong>Sudden</strong>, progressive, and profound visual loss associated with relative afferent pupillary defect (<strong>RAPD</strong>) is characteristic of optic neuritis. MRI brain &amp; orbit, screening for circulating myelin oligodendrocyte glycoprotein (MOG) &amp; neuromyelitis optica (NMO) antibodies, and blood sugar levels are the next best investigations for optic neuritis.</p>\n<p>A <strong>brain MRI</strong> is recommended in every patient after the <strong>first attack</strong> of optic neuritis. The 15-year cumulative probability of developing <strong>multiple sclerosis</strong> after an attack of optic neuritis is about 50%. It may remain an isolated event in some patients.</p>\n<p><strong>Neuromyelitis optica</strong> (NMO) is a severe type of optic neuritis which may occur bilaterally and is associated with myelitis. Detection of antibodies like MOG &amp; NMO (also known as aquaporin-4 antibody) is <strong>diagnostic</strong> of the condition.</p>\n<p>Optic neuritis is primarily <strong>treated with steroids</strong>. The blood sugar levels must be checked as steroids can worsen the glycemic control in individuals with DM which may precipitate hyperglycemia.&nbsp;</p>\n<p>Optic neuritis comprises inflammatory and demyelinating disorders of the optic nerve. It can be idiopathic, hereditary (<strong>Leber's disease</strong>), or due to demyelinating disorders such as <strong>multiple sclerosis</strong> or neuromyelitis optica (<strong>Devic's disease</strong>). Anatomically, it can be papillitis, neuroretinitis, or retrobulbar neuritis. It is more common in women.&nbsp;</p>\n<p>Other symptoms include lowered dark adaptation and visual obscuration in bright light. Transient obscuration of vision on exposure to light (<strong>Uhthoff's symptom</strong>) and impaired depth perception (<strong>Pulfrich's phenomenon</strong>) may also be seen.</p>\n<p><strong>Marcus Gunn</strong> pupil which points to RAPD&nbsp;is a characteristic sign. It is elicited by the swinging flashlight test. One eye is illuminated with the flashlight and the response is noted. The same is done for the other eye. This is repeated multiple times (swinging). The normal response is constriction in both eyes. If there is RAPD in one eye, it will <strong>dilate</strong> when light is shone on it.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3626103842864a77be9fa1a48ea26e8ex720x837.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a feature of the optic disc in glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Roenne's nasal step"
      },
      {
        "id": 2,
        "text": "Bayonetting"
      },
      {
        "id": 3,
        "text": "Increased cup-disc ratio"
      },
      {
        "id": 4,
        "text": "Baring of nasal arteries"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Roenne's nasal step is not a feature of the <strong>optic disc</strong> in glaucoma.</p>\n<p>Roenne's nasal step is a <strong>visual field defect.</strong>\u00a0It is the result of two <strong>arcuate scotomas</strong> running in different arcs and meeting at the horizontal meridian. This forms a right-angled defect in the nasal side of the visual field.\u00a0</p>\n<p>Early glaucomatous changes of the optic disc include an increase in <strong>cup-disc ratio</strong> (C/D ratio) to\u00a0<strong>more than 0.4</strong>, <strong>splinter hemorrhages</strong> near the optic disc margin, and atrophy of the retinal nerve fiber layer.</p>\n<p>Advanced glaucomatous changes of the optic disc include a\u00a0<strong>marked increase in C/D ratio</strong> (0.7 or more), thinning of the neuroretinal rim, <strong>nasal shifting of the retinal vessels or bayonetting</strong>, and pulsations of retinal arterioles at the disc margin.</p>\n<p>If the damage progresses, <strong>all neural tissue is destroyed</strong> and the optic nerve appears white and deeply excavated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A farmer presents with pain and discharge in his left eye. He says that he sustained an injury caused by a leaf a few days back. What is the finding seen in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Hyphema"
      },
      {
        "id": 2,
        "text": "Aqueous flare"
      },
      {
        "id": 3,
        "text": "Arlt line"
      },
      {
        "id": 4,
        "text": "Hypopyon"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Other options:</p>\n<p>Option A:\u00a0<strong>Hyphema</strong> is a <strong>hemorrhage</strong> in the anterior chamber. It commonly occurs after a\u00a0<strong>blunt ocular injury</strong>. The bleeding is from the <strong>iris root</strong> or <strong>ciliary body face</strong>. The blood settles inferiorly forming a fluid level.</p>\n<div class=\"page\" title=\"Page 898\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Option B: <strong>Aqueous flare</strong>\u00a0refers to<strong>\u00a0the haziness</strong> of the normally clear fluid in the anterior chamber. It reflects the presence of <strong>protein</strong> due to the breakdown of the blood-aqueous barrier. The presence of flare indicates <strong>active inflammation</strong>.\u00a0</p>\n<div class=\"page\" title=\"Page 427\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Option C:\u00a0<strong>Arlt line</strong> is the<strong> scarring</strong> on the <strong>conjunctiva</strong>\u00a0in the area of sulcus subtarsalis. It can be a single line, irregularly shaped, or star-shaped. Common causes are <strong>trachoma</strong>, healed traumatic wounds, or surgical scars.</p>\n<p>\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ecae3d15348a4e71b45cbdd390c8a473.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of moderate-severe visual impairment according to the National Blindness and Visual Impairment Survey 2015-19?",
    "choices": [
      {
        "id": 1,
        "text": "Refractive error"
      },
      {
        "id": 2,
        "text": "Untreated cataract"
      },
      {
        "id": 3,
        "text": "Glaucoma"
      },
      {
        "id": 4,
        "text": "Diabetic retinopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the National Blindness and Visual Impairment Survey 2015-19, the <strong>most common cause of moderate-severe visual impairment</strong> (MSVI) is<strong> untreated cataract</strong>.&nbsp;</p>\n<p>MSVI is defined as presenting visual acuity of&nbsp;<strong>&lt;6/18 to 3/60</strong> in the better eye with available correction.</p>\n<p>Most commonly, cases of visual impairment and blindness are more prevalent in patients aged 50 years and above.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Refractive errors</strong> are the leading cause of MSVI in patients <strong>aged 49 years and below</strong>.</p>\n<p>Options C and D: <strong>Glaucoma</strong> and <strong>diabetic retinopath</strong>y account for a very low number of visual impairment cases in patients aged 50 years and above.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about optic neuritis?",
    "choices": [
      {
        "id": 1,
        "text": "Relative afferent pupillary defect is seen."
      },
      {
        "id": 2,
        "text": "There is no pain on ocular movement."
      },
      {
        "id": 3,
        "text": "Multiple myeloma is a common cause."
      },
      {
        "id": 4,
        "text": "Oral corticosteroids are the mainstay of treatment."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In optic neuritis, <strong>relative afferent pupillary defect</strong> (RAPD) or Marcus Gunn pupil is seen. It is elicited by the <strong>swinging</strong> <strong>flashlight test</strong>. Normally, both pupils remain constricted. In the presence of RAPD, both pupils dilate on moving the flashlight from the normal to the abnormal eye. This paradoxical response of the pupil to light is called Marcus Gunn pupil.</p>\n<p>Other options:&nbsp;</p>\n<p>Option B: <strong>Pain</strong> is <strong>aggravated</strong> by ocular movement, especially in the upward or downward direction due to attachment of the superior rectus fibers to the dura mater.</p>\n<p>Option C: <strong>Multiple sclerosis</strong>, and <strong>not multiple myeloma</strong>, is a known demyelinating cause of optic neuritis.</p>\n<p>Option D:&nbsp;<strong>Oral corticosteroid therapy alone </strong>is <strong>contraindicated</strong> because it does not improve the outcome and is associated with an increased risk of new attacks of optic neuritis. Intravenous methylprednisolone can be used if the patient shows radiological evidence of multiple sclerosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common ocular manifestation of COVID-19 is _______.",
    "choices": [
      {
        "id": 1,
        "text": "Uveitis"
      },
      {
        "id": 2,
        "text": "Mucormycosis"
      },
      {
        "id": 3,
        "text": "Follicular conjunctivitis"
      },
      {
        "id": 4,
        "text": "Papillary conjunctivitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most common ocular manifestation of COVID-19 is <strong>follicular conjunctivitis</strong>.</p>\n<p>Hemorrhagic conjunctivitis, dry eye disease, episcleritis,&nbsp;chemosis, and photophobia&nbsp;may also occur, but less frequently.&nbsp;</p>\n<p>The most prevalent ocular symptoms are&nbsp;<strong>dry eye</strong> or <strong>foreign body sensation,</strong> redness, tearing, itching, eye pain, and discharge.</p>\n<p>Intraocular complications include retinal artery occlusions and hemorrhages, in addition to cotton-wool spots caused by complement-mediated thrombotic angiopathy.</p>\n<p>The <strong>ACE-2 receptors</strong>&nbsp;present in the&nbsp;<strong>cornea</strong> and <strong>conjunctiva</strong>&nbsp;make the ocular surface<strong>&nbsp;</strong>a&nbsp;potential target tissue for SARS-CoV-2.</p>\n<p>Sometimes, conjunctivitis may appear as the only sign and symptom of COVID-19. Patients should, therefore, undergo a nasopharyngeal RT-PCR test.&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condition given in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Symblepharon"
      },
      {
        "id": 2,
        "text": "Ankyloblepharon"
      },
      {
        "id": 3,
        "text": "Congenital blepharophimosis"
      },
      {
        "id": 4,
        "text": "Congenital ptosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option C:&nbsp;<strong>Congenital blepharophimosis</strong> is a condition in which&nbsp;the <strong>extent</strong> of the <strong>palpebral fissure</strong> is <strong>decreased</strong>. It can be congenital or acquired and is due to a vertical skin fold at the lateral canthus. <strong>No treatment</strong> is required. In some cases, canthoplasty is done.</p>\n<p>Option D: <strong>Congenital ptosis</strong> is associated with developmental defect and&nbsp;<strong>weakness</strong> of the <strong>levator palpebrae superioris </strong>(LPS)<strong> muscle</strong>. <strong>Drooping</strong> of one or both of the upper eyelids is seen since birth.<strong> Lid lag</strong> on downward gaze is present. Treatment involves <strong>surgical</strong> correction.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ddd304e8f8b34187b287619fdc560dc4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd987f90cc184588ab1f655f350b11f9x328x256.PNG"
    ]
  },
  {
    "text": "Match the following:",
    "choices": [
      {
        "id": 1,
        "text": "1-d, 2-b, 3-a, 4-c"
      },
      {
        "id": 2,
        "text": "1-a, 2-c, 3-d, 4-b"
      },
      {
        "id": 3,
        "text": "1-b, 2-a, 3-d, 4-c"
      },
      {
        "id": 4,
        "text": "1-d, 2-c, 3-a, 4-b"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>&nbsp;</p>\n<p><strong>Perimetry</strong>&nbsp;is the procedure of&nbsp;<strong>estimating&nbsp;</strong>the<strong>&nbsp;extent</strong>&nbsp;of the&nbsp;<strong>visual fields</strong>. There are<strong>&nbsp;2 types</strong>&nbsp;of perimetry:&nbsp;<strong>kinetic&nbsp;</strong>and&nbsp;<strong>static perimetry.&nbsp;</strong></p>\n<p>In kinetic perimetry, a target of given luminance is moved from a non-seeing area in the periphery towards the center, where it is perceived. In the static method, the location of a stimulus remains fixed, with the intensity increased until it is seen by the subject (threshold is reached) or decreased until it is no longer detected.</p>\n<p>The <strong>tangent screen perimetry</strong> evaluates the <strong>central</strong> 30 degrees field at 1 m, thereby testing the central vision.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7921fca10cb648e6a323f29126de866ex800x800.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc6f480d20034476ba505bc278ac2f6fx720x557.PNG"
    ]
  },
  {
    "text": "In which of the following is atropine contraindicated?",
    "choices": [
      {
        "id": 1,
        "text": "Acute congestive glaucoma"
      },
      {
        "id": 2,
        "text": "Acute anterior uveitis"
      },
      {
        "id": 3,
        "text": "Malignant glaucoma"
      },
      {
        "id": 4,
        "text": "Corneal ulcer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Atropine</strong> is<strong> contraindicated</strong> in <strong>acute congestive glaucoma.</strong></p>\n<p><span style=\"font-size: 12pt;\">Acute congestive or angle closure glaucoma is caused by the opposition of the <strong>peripheral iris</strong> against the <strong>trabecular meshwork</strong>. This <strong>obstructs the aqueous outflow</strong> by closing an already narrow-angle of the anterior chamber leading to an acute increase in intraocular pressure(IOP). It can be precipitated by<strong> dim light</strong>, <strong>mydriatics</strong> like<strong> atropine.</strong></span></p>\n<p>It presents as sudden onset of severe unilateral eye pain or a <strong>headache</strong> associated with <strong>blurred vision</strong>, rainbow-colored <strong>halos</strong> around bright lights, <strong>nausea</strong>, and <strong>vomiting</strong>. The physical exam will reveal a <strong>fixed midpoint pupil</strong> and a hazy or <strong>cloudy cornea</strong> with marked <strong>conjunctival injection</strong>.</p>\n<p>Management of acute condition includes rapid lowering of IOP by\u00a0<strong>mannitol or glycerol, acetazolamide,</strong>\u00a0and <strong>topical antiglaucoma drugs.\u00a0</strong>Definitive management is done by <strong>laser peripheral iridotomy</strong> or <strong>filtration surgery</strong>.</p>\n<p><strong>Atropine </strong>is<strong> indicated</strong> as cycloplegic to reduce pain and prevent synechiae in <strong>corneal ulcers</strong> and <strong>acute anterior uveitis</strong>. It is the initial management in <strong>malignant glaucoma.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the mechanism of action when the retina is exposed to light?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperpolarization, increase in neurotransmitter release"
      },
      {
        "id": 2,
        "text": "Hyperpolarization, decrease in neurotransmitter release"
      },
      {
        "id": 3,
        "text": "Depolarization, decrease in neurotransmitter release"
      },
      {
        "id": 4,
        "text": "Depolarization, increase in neurotransmitter release"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 21\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The exposure of the retina to light causes <strong>hyperpolarization</strong> and a <strong>decreased release of neurotransmitters</strong> in rods and cones.</p>\n<p>When photoreceptors are exposed to light, a series of biochemical reactions result in the generation of electrical charge. This phenomenon of conversion of light energy into electrical impulse is known as <strong>phototransduction</strong>.</p>\n<p>In dark, cyclic GMP (cGMP) gated channels are open leading to a steady release of neurotransmitters (glutamate). When light falls on the retina,11-cis-retinal is converted to all-trans-retinal. This activates <strong>transducin</strong> which is a g protein-coupled receptor with <strong>phosphodiesterase activity&nbsp;</strong>breaking down cGMP. With a <strong>decrease</strong> in&nbsp;<strong>cGMP&nbsp;</strong>levels <strong>sodium channels close</strong> causing hyperpolarization. Hyperpolarization reduces glutamate release, which leads to the formation of the action potential.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea2bd870bfb3409693a0865da7cef4fex1280x2260.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef7dd5a0f82446c7bc5ff1a8f132cccdx1279x1373.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a feature of keratoconus?",
    "choices": [
      {
        "id": 1,
        "text": "Haab's striae"
      },
      {
        "id": 2,
        "text": "Munson's sign"
      },
      {
        "id": 3,
        "text": "Irregular astigmatism"
      },
      {
        "id": 4,
        "text": "Scissoring reflex"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"color: #252525;\">The severity of the condition is graded based on <strong style=\"color: #252525;\">keratometry</strong>. <strong style=\"color: #252525;\">Corneal topography</strong> is a diagnostic modality with the highest sensitivity for early cases.</p>\n<p style=\"color: #252525;\">Intacs or <strong style=\"color: #252525;\">intracorneal ring segments</strong>&nbsp;are useful in <strong style=\"color: #252525;\">moderate</strong> cases due to their flattening effect. Rigid gas-permeable <strong style=\"color: #252525;\">contact lenses</strong>, <strong style=\"color: #252525;\">corneal collagen cross-linking</strong> with riboflavin, and <strong style=\"color: #252525;\">keratoplasty</strong> are the other treatment modalities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b54369577ed34b5185bd5ec1afca596fx395x356.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b659fa33bae54cc2a41c28c8cc2ccaa4x720x531.JPEG"
    ]
  },
  {
    "text": "A patient has presented for a routine eye evaluation. You have checked his visual acuity using Snellen's chart and found it to be 6/6. What is the minimum angle of resolution?",
    "choices": [
      {
        "id": 1,
        "text": "15 minutes of arc"
      },
      {
        "id": 2,
        "text": "5 minutes of arc"
      },
      {
        "id": 3,
        "text": "10 minutes of arc"
      },
      {
        "id": 4,
        "text": "20 minute of arc"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The angle subtended for a patient with <strong>6/6</strong> vision is <strong>5 minutes of arc.</strong></p>\n<p>Visual acuity is a measure of the spatial resolution of the eye or an estimation of its ability to discriminate between two points.</p>\n<p>Snellen's chart consists of a series of letters arranged in lines, each diminishing in size. Each&nbsp;whole letter will subtend an<br />the angle of <strong>5</strong> <strong>minutes</strong> at the <strong>nodal</strong> <strong>point</strong> of the eye at the given distance.</p>\n<p>In the Snellen chart, the largest letter will subtend an angle of 5 minutes at the nodal point if it is 60 m from the eye. Those in the subsequent lines will subtend an angle of 5 minutes if they are 36, 24, 18, 12, 9, and 6 m from the eye.</p>\n<p>The patient is placed at 6 m and asked to read the visual acuity chart from the largest letters downwards to the smallest that can be visualized with each eye separately.&nbsp;A person with <strong>normal 6/6 vision</strong> sitting at a distance of 6 m from the types should&nbsp;be able to read every letter from the top to the end of the 6 m line. So the angle subtended by the 6 m line at the eye a distance of 6 meters will be <strong>5 minutes of arc</strong>.</p>\n<p>If a patient can only read up to the 12m line, his distant vision is defective. His visual acuity will be recorded as 6/12. The numerator denotes the distance at which the patient is able to read the particular line and the denominator denotes the distance at which a person with normal visual acuity will be able to read the given line.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/192387686eb2481ca5231f8af8a9f6c6x1280x1482.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a feature of pterygium?",
    "choices": [
      {
        "id": 1,
        "text": "Rate of recurrence is 95%"
      },
      {
        "id": 2,
        "text": "It is a fibrovascular growth"
      },
      {
        "id": 3,
        "text": "The parts of a pterygium are head, neck and body"
      },
      {
        "id": 4,
        "text": "Has progressive and regressive types"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>recurrence rate of 95%</strong> is <strong>not</strong> a feature of <strong>pterygium.</strong> The recurrence rate of pterygium is around <strong>80%</strong> after<strong> simple surgical excision.</strong></p>\n<p>Pterygium is a<strong>&nbsp;wing-shaped,</strong>&nbsp;triangular<strong>&nbsp;fibrovascular ingrowth </strong>(Option B) of degenerative conjunctival tissue that can <strong>encroach</strong> onto the <strong>cornea</strong>. It is a response to prolonged exposure to ultraviolet rays, dry heat, etc. It has <strong>3 parts </strong>mainly, a head (apical part on the cornea), a body (the region between the limbus and canthus), and a cap(semilunar white infiltrate in front of the head)(Option C).. Some authors mention the<strong> neck</strong> as the constricted part near the limbal area.</p>\n<p>Patients may complain of itching and grittiness due to Dellen (localized drying effect). If the pterygium encroaches onto the pupillary area, it may interfere with vision and also induce <strong>astigmatism</strong>.&nbsp;<strong>Stocker's line</strong>&nbsp;may be associated with a&nbsp;<strong>pterygium</strong>. It is a linear&nbsp;<strong>deposition</strong>&nbsp;of&nbsp;<strong>iron</strong>&nbsp;seen in the corneal epithelium, anterior to the head of a pterygium. Pterygium is of 2 types (Option D):</p>\n<ul>\n<li><strong>Progressive</strong> which is thick, fleshy, and vascular.</li>\n<li><strong>Regressive</strong> which is thin, atrophic, and attenuated.</li>\n</ul>\n<p>This condition can be treated symptomatically with tear substitutes for dry eye symptoms and patients are advised to avoid ultraviolet rays.&nbsp;<strong>Surgical excision </strong>with<strong> free conjunctival limbal autograft</strong>&nbsp;is the preferred treatment to avoid recurrence.&nbsp;</p>\n<p>The recurrence rate of pterygium is around 80% after simple surgical excision. Excision together with adjunctive therapies such as mitomycin C or 5-fluorouracil can reduce the risk of recurrence to approximately 10%</p>\n<p>The image below shows a pterygium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36566b2b02544e6ca5b9358ff45112a8x360x272.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a feature of complicated cataracts?",
    "choices": [
      {
        "id": 1,
        "text": "Krukenberg spindle"
      },
      {
        "id": 2,
        "text": "Polychromatic lusture"
      },
      {
        "id": 3,
        "text": "Occurs after uveitis"
      },
      {
        "id": 4,
        "text": "Breadcrumb appearance"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Krukenberg spindle</strong> is not a feature of complicated cataracts. The slit lamp examination in <strong>pigmentary glaucoma&nbsp;</strong>shows a pattern of&nbsp;<strong>pigment deposition</strong>&nbsp;on the back of the cornea-endothelium called&nbsp;Krukenberg spindles.&nbsp;</p>\n<p><strong>Complicated or secondary cataracts</strong>&nbsp;develop secondary to i<strong>nflammatory/degenerative conditions</strong> of the lens or other parts of the eye like iridocyclitis and ciliary body tumors which lead to disturbances in the nutrition of the lens. These cataracts present with a&nbsp;<strong>breadcrumb appearance</strong> and<strong> p</strong><strong>olychromatic luster.&nbsp;</strong></p>\n<p>Even in the early stages, vision is impaired.&nbsp;Inflammation of the posterior segment leads to the characteristic&nbsp;<strong>posterior subcapsular cataract</strong>&nbsp;while the anterior segment inflammation causes opacification throughout the cortex.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Oculocephalic reflex assesses the integrity of which of the following cranial nerves?",
    "choices": [
      {
        "id": 1,
        "text": "A and C"
      },
      {
        "id": 2,
        "text": "A and E"
      },
      {
        "id": 3,
        "text": "A and D"
      },
      {
        "id": 4,
        "text": "A, C, and D"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>oculocephalic reflex or doll's eye reflex</strong> is used to assess the integrity of the <strong>cranial nerves</strong>\u00a0<strong>III, VI, </strong>and<strong> VIII.</strong></p>\n<p>It is a <strong>brainstem reflex</strong> examined by observing the the motion of eyes during the sudden rotation of the head of the patient by the examiner. It is done in both directions laterally, followed by flexion and extension. In a normal positive reflex, the eyes <strong>move conjugately </strong>in the <strong>opposite direction</strong> of the movement of the head to maintain their position in space.</p>\n<p>The reflex has afferents in the vestibular nerve (VIII) that relay to the brainstem nuclei and bring about conjugate eye movements through the oculomotor nerve (III) and abducens nerve (VI). </p>\n<p>A <strong>negative reflex</strong> occurs in any of the above cranial nerve palsies or brainstem injuries, where the eyes show no movement or movement in the same direction as head movement. This is used to assess brainstem reflexes in a\u00a0<strong>comatose patient</strong> as a criterion of brain death.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman presents with fever, retroorbital pain, headache, pulsatile proptosis of the right eye, and tinnitus. BP and fundus were normal. Which of the following structures are involved?",
    "choices": [
      {
        "id": 1,
        "text": "A,B,C"
      },
      {
        "id": 2,
        "text": "B,C,D"
      },
      {
        "id": 3,
        "text": "A,C,D"
      },
      {
        "id": 4,
        "text": "A,B,C,D"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structures affected in this patient are <strong>A, B, C and D.</strong></p>\n<p>Cavernous sinus thrombosis (CST) is a septic thrombus formed in the cavernous sinus. It spreads from infection of<span style=\"font-size: 14px;\">&nbsp;the sinuses, teeth, ears, nose, and skin of the face.&nbsp;</span></p>\n<p>It presents as <strong>fever, severe headache</strong>,&nbsp;supraorbital pain, seizures, and edema in the mastoid region. Eye signs include <strong>proptosis</strong>, chemosis, and <strong>diplopia</strong> due to <strong>ophthalmoplegia</strong> from the involvement of <strong>oculomotor (CN-III), trochlear (CN-IV), and abducens nerve (CN-VI)</strong>. Absence of corneal sensation due to the involvement of the ophthalmic division of trigeminal nerve (CN-Va).&nbsp;Ipsilateral ptosis, dilated pupil, and absence of direct and consensual pupillary right reflex due to oculomotor nerve palsy.<strong> Pulsatile proptosis&nbsp;</strong>occurs with the involvement of<strong>&nbsp;</strong>the<strong> internal carotid artery.</strong></p>\n<p>Investigation using brain magnetic resonance imaging&nbsp;or magnetic resonance&nbsp;venography should be done urgently. Following early diagnosis, management of cavernous sinus thrombosis typically includes intravenous&nbsp;broad-spectrum antibiotics, analgesics, anti-inflammatory drugs, and anticoagulants.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c25595eb48fe41ccae200b63c2aa735ex600x657.JPEG"
    ]
  }
];
        let quizName = '130 Ophthalmology Inicet 2022';
        let hierarchy = ["Marrow", "PYQs", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>