<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>076 Pathology Aiims 2017 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">34</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the function of Acetone free Methanol in Leishman stain?",
    "choices": [
      {
        "id": 1,
        "text": "Causes metabolic and enzymatic activity to stop"
      },
      {
        "id": 2,
        "text": "Prevents the cells from sticking to the slide surface"
      },
      {
        "id": 3,
        "text": "Colours the red cells"
      },
      {
        "id": 4,
        "text": "Fixes cells to slide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<table style=\"height: 188px; width: 444px;\">\n<tbody>\n<tr>\n<td style=\"width: 215px;\"><strong>Technique/Tissue</strong></td>\n<td style=\"width: 217px;\"><strong>Fixative</strong></td>\n</tr>\n<tr>\n<td style=\"width: 215px;\">Electron microscopy</td>\n<td style=\"width: 217px;\">Glutaral dehyde</td>\n</tr>\n<tr>\n<td style=\"width: 215px;\">Trephine biopsy-bone marrow</td>\n<td style=\"width: 217px;\">Zenker's fluid (AZF fixative)</td>\n</tr>\n<tr>\n<td style=\"width: 215px;\">GI biopsies</td>\n<td style=\"width: 217px;\">Bouin's fixative</td>\n</tr>\n<tr>\n<td style=\"width: 215px;\">Brain</td>\n<td style=\"width: 217px;\">Formalin ammonium chloride</td>\n</tr>\n<tr>\n<td style=\"width: 215px;\">Adrenal biopsy</td>\n<td style=\"width: 217px;\">Orth's fluid</td>\n</tr>\n<tr>\n<td style=\"width: 215px;\">PAP smear</td>\n<td style=\"width: 217px;\">Ethanol</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman presented with painful blisters on the skin and oral mucosa. Direct immunofluorescence is given below. Which of the following is false regarding the same?",
    "choices": [
      {
        "id": 1,
        "text": "Antibodies against desmoglein 3"
      },
      {
        "id": 2,
        "text": "Antibodies against desmoglein 1"
      },
      {
        "id": 3,
        "text": "Suprabasal acantholytic blister is a characteristic feature"
      },
      {
        "id": 4,
        "text": "Antibodies against hemidesmosomes"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>\u00a0</p>\n<p><strong>Direct\u00a0immunofluorescence microscopy </strong>(DIF) is the<strong>\u00a0most accurate\u00a0test.</strong></p>\n<p><strong>Antibodies</strong> against<strong> hemidesmosomes</strong> that link basal keratinocytes to the underlying basement membrane are seen in<strong> bullous pemphigoid</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/be74e1e3739a4e9f8cc6d15b36ac1669.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77fef3632cfa41efaadc89d60ac098bdx510x481.GIF"
    ]
  },
  {
    "text": "The stain done on a section of liver shown below is:",
    "choices": [
      {
        "id": 1,
        "text": "Warthin starry stain"
      },
      {
        "id": 2,
        "text": "Steiner silver stain"
      },
      {
        "id": 3,
        "text": "Sweet's reticulin stain"
      },
      {
        "id": 4,
        "text": "Grimelius silver stain"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above stain demonstrates <strong>reticular fibers of the liver</strong> and hence has to be <strong>reticulin stain</strong>.</p>\n<p><strong>Reticulin stain</strong></p>\n<ul>\n<li>Stained by 2 procedures, Gordon and Sweet&rsquo;s reticulin stain (most common) and Gomori reticulin stain.</li>\n<li>They demonstrate reticulin fibers and basement membrane.</li>\n<li>Reticulin fibers: thin, type 3 collagen, widespread in connective tissue</li>\n<li>Basement membrane: type 4 collagen fibers and laminin.</li>\n</ul>\n<p>Reticulin stain is used to<strong> shows the normal architecture of the liver</strong> and thereby help <strong>detect disrupted architecture</strong> in hepatocellular carcinoma and hepatocellular proliferation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/36f867ee97c9419db304dc67d6e3c1b8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "ALK positivity is seen in which of the following neoplasms:",
    "choices": [
      {
        "id": 1,
        "text": "Fibromatosis"
      },
      {
        "id": 2,
        "text": "Synovial sarcoma"
      },
      {
        "id": 3,
        "text": "Ewing sarcoma"
      },
      {
        "id": 4,
        "text": "Inflammatory myofibroblastic tumour"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>ALK (anaplastic lymphoma kinase) positivity (translocation) is seen in Inflammatory myofibroblastic tumor of lung.</p>\n<p>ALK positivity means the<strong> rearrangements in the ALK gene on chromosome 2p23.</strong></p>\n<p>These rearrangements break the ALK locus leads to the formation of chimeric genes encoding signalling pathways.</p>\n<p>ALK rearrangements carry a very good prognosis as they show good response to treatment with ALK kinase inhibitors. The tumours lacking ALK rearrangements have a substantially worse prognosis.&nbsp;</p>\n<p>ALK positivity is seen in:</p>\n<ul>\n<li><strong>Adenocarcinoma of Lung</strong></li>\n<li><strong>Neuroblastoma</strong></li>\n<li><strong>Inflammatory myofibroblastic tumor of Lung</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true regarding the internal iron homeostasis in iron-deficiency anaemia?",
    "choices": [
      {
        "id": 1,
        "text": "Ferritin mRNA concentration iron-responsive element increases and ferritin synthesis decreases"
      },
      {
        "id": 2,
        "text": "Transferrin receptor 1 iron-responsive elements increases transferrin receptor mRNA concentration and synthesis"
      },
      {
        "id": 3,
        "text": "Transferrin receptor 1 iron responsive elements decreases transferrin receptor mRNA concentration and synthesis"
      },
      {
        "id": 4,
        "text": "Ferritin mRNA concentration iron responsive element decreases and ferritin synthesis increases"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>iron deficiency anaemia</strong>, there is an <strong>increase</strong> in <strong>transferrin</strong> <strong>receptor</strong> mRNA concentration and synthesis.</p>\n<p>Iron absorbed through diet or which is released from circulation is bound to <strong>transferrin</strong> (iron transfer protein). When erythropoiesis is stimulated, iron-transferrin complexes act as <strong>transferrin receptors</strong> on the surface of <strong>bone marrow erythroid cells</strong>. Through receptor-mediated endocytosis, this complex is internalised.\u00a0</p>\n<p>This\u00a0<strong>iron</strong> is then made available for <strong>heme synthesis</strong> while the <strong>transferrin-receptor complex</strong> is <strong>recycled</strong> to the surface of the cell, from where the transferrin is released back into circulation and the transferrin receptor re-anchors into the cell membrane. The <strong>excess iron</strong> after hemoglobin synthesis binds to <strong>apoferritin</strong> (storage protein), forming <strong>ferritin</strong>.\u00a0</p>\n<p><strong>Senescent RBCs</strong> undergo <strong>phagocytosis</strong> in the cells of the <strong>reticuloendothelial system</strong>. The hemoglobin is broken down, the globin and other proteins are returned to the amino acid pool, and the <strong>iron</strong> is shuttled back to the surface of the reticuloendothelial cell, where it is <strong>taken up</strong> by <strong>transferrin</strong> via <strong>ferroportin</strong> (iron export channel).</p>\n<p>There is no regulated excretory pathway for iron, and the only mechanisms by which iron is lost are <strong>blood loss</strong> (via gastrointestinal bleeding, menstruation, or other forms of bleeding) and the <strong>loss of epithelial cells</strong> from the skin, gut, and genitourinary tract. The normal daily <strong>iron loss</strong> from the body is <strong>1-2 mg</strong>.</p>\n<table style=\"width: 391px; height: 252px;\">\n<tbody>\n<tr style=\"height: 31px;\">\n<td style=\"width: 151.077px; height: 31px;\"><strong>Variables</strong></td>\n<td style=\"width: 119.923px; height: 31px;\"><strong>Iron-deficient state\u00a0</strong></td>\n<td style=\"width: 105px; height: 31px;\"><strong>Iron-excess state</strong></td>\n</tr>\n<tr style=\"height: 29px;\">\n<td style=\"width: 151.077px; height: 29px;\">Iron uptake</td>\n<td style=\"width: 119.923px; text-align: justify; height: 29px;\">\u2191</td>\n<td style=\"width: 105px; height: 29px;\">\u2193</td>\n</tr>\n<tr style=\"height: 31px;\">\n<td style=\"width: 151.077px; height: 31px;\">Transferrin receptor synthesis</td>\n<td style=\"width: 119.923px; height: 31px;\">\u2191</td>\n<td style=\"width: 105px; height: 31px;\">\u2193</td>\n</tr>\n<tr style=\"height: 39px;\">\n<td style=\"width: 151.077px; height: 39px;\">Transferrin receptor mRNA concentration</td>\n<td style=\"width: 119.923px; height: 39px;\">\u2191</td>\n<td style=\"width: 105px; height: 39px;\">\u2193</td>\n</tr>\n<tr style=\"height: 21px;\">\n<td style=\"width: 151.077px; height: 21px;\">Iron storage</td>\n<td style=\"width: 119.923px; height: 21px;\">\u2193</td>\n<td style=\"width: 105px; height: 21px;\">\u2191</td>\n</tr>\n<tr style=\"height: 21px;\">\n<td style=\"width: 151.077px; height: 21px;\">Ferritin synthesis</td>\n<td style=\"width: 119.923px; height: 21px;\">\u2193</td>\n<td style=\"width: 105px; height: 21px;\">\u2191</td>\n</tr>\n<tr style=\"height: 21px;\">\n<td style=\"width: 151.077px; height: 21px;\">Ferritin mRNA concentration</td>\n<td style=\"width: 119.923px; height: 21px;\">No change</td>\n<td style=\"width: 105px; height: 21px;\">No change</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old patient presents with bilateral proptosis. The biopsy from the region shows this pattern. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Leiomyoma"
      },
      {
        "id": 2,
        "text": "Schwannoma"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Fibromatosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical history and biopsy picture is characteristic of <strong>schwannoma</strong>.</p>\n<p>The biopsy specimen in schwannoma shows <strong>hypocellular (Antoni B)</strong> and <strong>hypercellular areas (Antoni A).\u00a0</strong><strong>Antoni A area</strong>\u00a0has the<strong>\u00a0nuclei</strong> of <strong>tumor cells</strong> aligned in <strong>palisading rows. </strong>The<strong> nuclear-free zones</strong>\u00a0that lie between nuclear palisading<strong>\u00a0</strong>are known as<strong>\u00a0Verocay bodies.</strong></p>\n<p>The histological section of a schwannoma showing Antoni A, Antoni B and Verocay bodies is given below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/89c128c9d636422f886f58ebb4b58332.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/571f13ffb01c465aaf47e7426edc3498x1279x662.JPEG"
    ]
  },
  {
    "text": "Endoscopic and barium swallow images of a lesion in the oesophagus of a patient are as shown below. What is the expected histopathological finding?",
    "choices": [
      {
        "id": 1,
        "text": "Image 2"
      },
      {
        "id": 2,
        "text": "Image 1"
      },
      {
        "id": 3,
        "text": "Image 4"
      },
      {
        "id": 4,
        "text": "Image 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given&nbsp;images showing an <strong>esophageal exophytic growth</strong>&nbsp;on endoscopy and&nbsp;<strong>apple core appearance</strong>&nbsp;in the<strong> middle 1/3</strong>&nbsp;of the esophagus on barium swallow are suggestive of <strong>squamous cell carcinoma.</strong>&nbsp;The characteristic histopathological finding in this condition are <strong>nests</strong> of stratified malignant cells and&nbsp;<strong>keratin</strong> <strong>pearls</strong>, which are noted in&nbsp;image&nbsp;4.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/143903d49673443abde235721a409426.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35dae415b8e24e1c8f65d099f6fd8238x1280x1049.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/773e24b7b9e24ef881bed2b58f99d218x1279x1048.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f03350b97f8d455da3e53b9124e9d83ax1279x1048.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b943f25f3358433583d6924c14ba9801x1279x1049.JPEG"
    ]
  },
  {
    "text": "A patient has a HbA2 of 3% and HbF of 97%. A peripheral blood smear is taken. Which of the following blood pictures will be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 3"
      },
      {
        "id": 2,
        "text": "1 and 2"
      },
      {
        "id": 3,
        "text": "2 and 3"
      },
      {
        "id": 4,
        "text": "1 and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The presence of <strong>HbA2 3% </strong>and<strong> HbF 97% </strong>indicates that it is a case of <strong>thalassemia major</strong>. In thalassemia major, hematological findings in image 1 showing <strong>poikilocytes</strong> and image 3 showing<strong> target cells</strong> are seen. Image 2 showing Howell Jolly bodies are seen in <strong>post-splenectomy</strong> thalassemia patients and not in this case.</p>\n<p><strong>Hematological findings</strong> in <strong>thalassemia major</strong> include the following:</p>\n<ul>\n<li>Anisopoikilocytosis</li>\n<li>Target cells (codocytes)</li>\n<li>Nucleated RBC\u2019s</li>\n<li>Dacrocytes</li>\n<li>Basophilic stippling</li>\n<li>Polychromatophilic cells</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/09914ebca8144a6386f65ddd0243551a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/418a6034a31647d8829d5b06f1c67d05x1280x1157.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e9ac978c6984f2bb20c51348e10e8bdx1280x1280.JPEG",
      "https://cdn1.dailyrounds.org/uploads/465c8ab170be4eed833399e831eaeaf8x345x235.PNG"
    ]
  },
  {
    "text": "In breast cancer, FISH for gene amplification will be done based on which of the following IHC staining for Her-2/neu?",
    "choices": [
      {
        "id": 1,
        "text": "1+"
      },
      {
        "id": 2,
        "text": "2+"
      },
      {
        "id": 3,
        "text": "3+"
      },
      {
        "id": 4,
        "text": "Gene Amplification is done irrespective of Her 2 Neu status"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Fluorescence in situ hybridization (FISH)&nbsp;</strong>should be performed in <strong>all cases of breast tumors</strong>&nbsp;with&nbsp;immunohistochemistry (<strong>IHC</strong>)<strong> score of 2+.</strong></li>\n<li><strong>Her-2/neu IHC interpretation:</strong>&nbsp;\n<ul>\n<li>1+ = Negative</li>\n<li>2+ = Equivocal-&gt; <strong>FISH is done</strong> to differentiate whether the tumor cells are positive or negative for Her-2 Neu expression.</li>\n<li>3+ = +ve Her 2 Neu. (Circumferential complete membrane staining in &gt;10% of tumor cells)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male patient presents with severe dyspnoea. Mitral stenosis with left atrial hypertrophy is seen. Vegetations present on the mitral valve were excised. What is the most likely diagnosis based on the given HPE image?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatic valvular disease"
      },
      {
        "id": 2,
        "text": "Infective endocarditis"
      },
      {
        "id": 3,
        "text": "Myxoma"
      },
      {
        "id": 4,
        "text": "Sarcoidosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image depicts <strong>Aschoff's body</strong>, which is<strong>&nbsp;</strong>suggestive of <strong>rheumatic valvular disease</strong>.</p>\n<p>Aschoff's bodies have the following components:</p>\n<ul>\n<li><strong>Anitschkow cells&nbsp;</strong>or plump macrophages&nbsp;\n<ul>\n<li>Abundant cytoplasm</li>\n<li><strong>Caterpillar cells</strong> - refer to centrally condensed chromatin&nbsp;into slender, wavy ribbons</li>\n</ul>\n</li>\n<li>Foci of fibrinoid necrosis&nbsp;</li>\n<li><strong>Aschoff's giant cells</strong> - multinucleated larger macrophages&nbsp;</li>\n<li>T-cells</li>\n<li>Plasma cells</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/097708998fa24d3b887a849e5238ed8d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d4707ed42c54592a733cd019c6a7a88x1280x1111.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87d6262ce84d41789a0ab1a04c427dd6x1280x1111.JPEG"
    ]
  },
  {
    "text": "A child presents with bilateral proptosis. Which investigation will help you in arriving at a diagnosis of chloroma?",
    "choices": [
      {
        "id": 1,
        "text": "Peripheral smear"
      },
      {
        "id": 2,
        "text": "Platelets"
      },
      {
        "id": 3,
        "text": "Hb concentration"
      },
      {
        "id": 4,
        "text": "Leucocytic count"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Chloroma is an <strong>extramedullary manifestation</strong> of acute myeloid leukemia (AML). It is a <strong>solid collection of leukemic cells</strong> occurring outside of the bone marrow.</li>\n<li>The best investigation among the given options would be a&nbsp;<strong>peripheral blood smear.</strong></li>\n<li>But the <strong>Investigation of Choice </strong>for AML is <strong>Flow Cytometry</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are reduced in Iron Deficiency Anaemia except",
    "choices": [
      {
        "id": 1,
        "text": "Ferritin"
      },
      {
        "id": 2,
        "text": "TIBC"
      },
      {
        "id": 3,
        "text": "Iron"
      },
      {
        "id": 4,
        "text": "Transferrin saturation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In Iron deficiency Anaemia, <strong>Total Iron Binding Capacity(TIBC) is increased</strong> in order to compensate to the deficient state.</p>\n<ul>\n<li>Diagnostic criteria include of Iron deficiency anaemia include :\n<ul>\n<li>Hypochromic and microcytic red cell indices</li>\n<li>Low serum ferritin(&lt;15mg/dl) and iron levels(&lt;30mg/dl)</li>\n<li>Low transferrin saturation(&lt;15%)</li>\n<li><strong>Increased total iron-binding capacity</strong></li>\n<li>The platelet count often is elevated</li>\n<li>Erythropoietin levels are elevated, but the marrow response is blunted by the iron&nbsp; deficiency; thus, marrow cellularity usually is only slightly increased.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old depressed man came with complaints of sudden onset breathlessness, with desaturation. Chest x-ray showed bilateral diffuse infiltrates with predominant involvement of right middle and lower lobes. The patient could not be revived despite treatment. On autopsy, the lungs appeared grossly normal. The histopathology image of the lung is as shown below. Which among the following is the appropriate cause?",
    "choices": [
      {
        "id": 1,
        "text": "Necrotizing TB granuloma"
      },
      {
        "id": 2,
        "text": "Vegetative matter aspiration pneumonia"
      },
      {
        "id": 3,
        "text": "Sarcoid granuloma"
      },
      {
        "id": 4,
        "text": "Severe fungal pneumonia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given histopathological image clearly shows a <strong>granuloma </strong>with <strong>refractile granules </strong>indicative of\u00a0a<strong> foreign body.\u00a0</strong>It is seen in\u00a0<strong>aspiration pneumonia </strong>due to\u00a0<strong>vegetative matter\u00a0</strong>(such as food).</p>\n<p>In this condition, the chest x-ray shows bilateral diffuse infiltrates especially in the right middle and lower lobes. Patients with altered sensorium are at high risk (stroke, medications).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/96a51d14cadb4ddebf50dc5645dea5da.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d49ae051d0f44513b5b0a8113fd16825x1279x1189.JPEG"
    ]
  },
  {
    "text": "Which of the following can be used to store blood for up to 35 days?",
    "choices": [
      {
        "id": 1,
        "text": "Acid Citrate dextrose"
      },
      {
        "id": 2,
        "text": "Citrate phosphate dextrose"
      },
      {
        "id": 3,
        "text": "Citrate phosphate 2 dextrose"
      },
      {
        "id": 4,
        "text": "Citrate phosphate dextrose adenine - 1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Citrate dextrose phosphate adenine-1 (<strong>CDPA-1</strong>) can be used to store blood for up to <strong>35 days</strong>. It helps in <strong>improving ATP synthesis</strong> during storage. Hence, it increases the shelf life.</p>\n<p>The <strong>disadvantage</strong> of using CDPA-1 is that it increases <strong>uric acid stone</strong> formation.</p>\n<p>The shelf life of storage with other components are:</p>\n<ul>\n<li>Acid Citrate dextrose &ndash; 21 days</li>\n<li>Citrate-phosphate dextrose &ndash; 21 days</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the correct sequence:",
    "choices": [
      {
        "id": 1,
        "text": "Bedside blood collection, label the samples, fill the laboratory requisition forms, Identify the patient"
      },
      {
        "id": 2,
        "text": "Fill the laboratory requisition forms, Identify the Patient, Bedside blood collection, label the samples"
      },
      {
        "id": 3,
        "text": "Label the sample tubes, Bedside blood collection, fill the laboratory requisition forms, Identify the patient"
      },
      {
        "id": 4,
        "text": "Identify the Patient, Fill the laboratory requisition forms, Bedside blood collection, label the samples"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>After making a provisional diagnosis by the physician, some laboratory tests are requested. <strong>Requisition forms are filled</strong> accordingly. Later the <strong>patient is identified</strong> and <strong>samples are collected by laboratory personnel/ health care staff and labeled appropriately.</strong></p>\n<p><strong>The WHO guidelines for taking a blood sample is as illustrated below</strong>:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61d6ac0815b14fc4bb6b4b12105380cdx710x3391.JPEG"
    ]
  },
  {
    "text": "Which anticoagulant is used for electrolyte estimation?",
    "choices": [
      {
        "id": 1,
        "text": "EDTA"
      },
      {
        "id": 2,
        "text": "Citrate"
      },
      {
        "id": 3,
        "text": "Sodium Fluoride"
      },
      {
        "id": 4,
        "text": "Lithium Heparin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lithium heparin </strong>is used for Electrolyte estimation.</p>\n<p><strong>Heparin</strong></p>\n<ul>\n<li>It is the&nbsp;<strong>anticoagulant</strong>&nbsp;causing the <strong>least interference</strong> with the test.</li>\n<li>It is the best anticoagulant to use when <strong>minimal hemolysis is desired</strong> e.g. for sodium and potassium.</li>\n<li>Heparin accelerates the action of antithrombin&nbsp;III which neutralizes thrombin and thus prevents the formation of fibrin from fibrinogen.</li>\n<li>Heparin is added (0.2 mg /mL of blood) or a drop of heparin is drawn into the syringe.</li>\n<li>Usually found as <strong>g</strong><span style=\"color: #000000;\"><strong>reen top</strong></span> tubes</li>\n<li><strong>Drawbacks</strong>\n<ul>\n<li style=\"padding-left: 30px;\">It inhibits the acid phosphatase activity.</li>\n<li style=\"padding-left: 30px;\">It gives a blue background for Wright&rsquo;s stain smears so not good for peripheral blood smear interpretation.</li>\n<li style=\"padding-left: 30px;\">It also affects the binding of triiodothyronine and thyroxine to their carrier protein and produces a higher free concentration of these hormones.</li>\n<li style=\"padding-left: 30px;\">It interferes with binding of calcium to&nbsp;EDTA.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "When you add calcium and thromboplastin to platelet poor plasma which pathway is assessed?",
    "choices": [
      {
        "id": 1,
        "text": "Extrinsic"
      },
      {
        "id": 2,
        "text": "Intrinsic"
      },
      {
        "id": 3,
        "text": "Fibrinolysis"
      },
      {
        "id": 4,
        "text": "Common"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Platelet poor plasma is used in assessing Coagulation pathway.</li>\n<li><strong>Thromboplastin (Factor III)</strong> binds with <strong>Factor VII</strong>. When calcium is added, it gears up the coagulation process via <strong>Extrinsic pathway</strong>.</li>\n<li>&nbsp;Coagulation Parameters used to assess :\n<ul>\n<li>Extrinsic Pathway - Prothrombin time (<strong>PT</strong>)</li>\n<li>Intrinsic Pathway - Activated Partial Thromboplastin time (<strong>aPTT</strong>)</li>\n<li>Common Pathway - Both <strong>PT</strong> and <strong>aPTT</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0937e92d5fe74c1286f2c2b9582046e6x1280x1017.JPEG"
    ]
  },
  {
    "text": "Origin of B cell in CLL/SLL is:",
    "choices": [
      {
        "id": 1,
        "text": "Centrocytes"
      },
      {
        "id": 2,
        "text": "Extranodal mature Peripheral B cells"
      },
      {
        "id": 3,
        "text": "Naive B cells in Interfollicular zones"
      },
      {
        "id": 4,
        "text": "Bone Marrow Progenitors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In CLL/SLL, B cells originate from<strong> naive B cell or&nbsp;Pre/Post Germinal Centre memory B cell</strong>. CLL arises in the lymph node.&nbsp;</p>\n<div class=\"page\" title=\"Page 601\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>DNA sequencing has revealed that the Ig genes of some CLL/SLL are somatically hypermutated, whereas others are not, suggesting that the cell of origin may be either a postgerminal center memory B cell or a naive B cell. For unclear reasons, tumors with unmutated Ig segments (those putatively of naive B-cell origin) pursue a more aggressive course.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Centrocytes are present in Germinal Centre. They are not the origin of CLL.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young boy from high altitude came with fever and weakness and had the following reports - Hemoglobin 17 g%, TLC is 21,000 with neutrophils 25, lymphocytes 30, eosinophils 5, myelocytes and metamyelocytes 40 in peripheral smear. Next step in the investigation should be:",
    "choices": [
      {
        "id": 1,
        "text": "Philadelphia chromosome"
      },
      {
        "id": 2,
        "text": "JAK mutation"
      },
      {
        "id": 3,
        "text": "Erythropoietin levels"
      },
      {
        "id": 4,
        "text": "Bone Marrow biopsy with reticulin stain"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>polycythemia</strong> (Hb&gt;16 g/dL). Hence, <strong>erythropoietin levels</strong> (EPO)&nbsp;are estimated next, to differentiate between <strong>primary</strong> or <strong>secondary</strong> polycythemia. Based on EPO levels:</p>\n<ul>\n<li>Primary polycythemia -&nbsp;normal/ decreased</li>\n<li>Secondary polycythemia&nbsp;- increased</li>\n</ul>\n<p>Options A and B: JAK 2 mutation and Philadelphia chromosome analysis is only done as a last resort.</p>\n<p>Option D: Bone marrow estimation with reticulin is done for myelofibrosis&nbsp;which can be seen in the spent/ late stage of the disease. However, peripheral smear findings are not suggestive of primary myelofibrosis. Leukoerythroblastic reaction with dacrocytes is seen in myelofibrosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presents with complaints of facial puffiness and frothy urine. Given below is the histological image of the condition. What do you think is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Membranous nephropathy"
      },
      {
        "id": 2,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 3,
        "text": "Membranoproliferative nephritis"
      },
      {
        "id": 4,
        "text": "Dense deposit disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image is characteristic of <strong>membranous nephropathy</strong>. The given hematoxylin and eosin (H&amp;E)-stained image shows uniform, diffuse thickening of the glomerular capillary wall. (intense pink color)</p>\n<p><strong>Membranous nephropathy</strong> is one of the most common causes of nephrotic syndrome in older adults, with a peak incidence in 30&ndash;50 years and a male:female ratio of 2:1.</p>\n<p>It is a form of chronic <strong>immune-complex-mediated</strong> disease.</p>\n<p>It can be <strong>primary</strong> (75% of cases) or <strong>secondary</strong> (associated with systemic diseases/identifiable etiologic agents).</p>\n<p><strong>Microscopy:</strong></p>\n<ul>\n<li>Light microscopy: diffuse thickening of the glomerular capillary wall without cellular proliferation.&nbsp;<strong>Irregular spikes</strong> projecting from the basement membrane are best seen with silver stains.</li>\n<li><strong>Immunofluorescence microscopy</strong>:&nbsp;<strong>granular deposits</strong> containing Ig and complement along the glomerular basement membrane</li>\n<li><strong>Electron micrograph</strong>:&nbsp;electron-dense <strong>subepithelial deposits</strong> (<strong>epimembranous spikes</strong>) and effacement of foot processes of podocytes</li>\n</ul>\n<div class=\"page\" title=\"Page 920\">&nbsp;</div>\n<div class=\"page\" title=\"Page 920\"><strong>Image:&nbsp;</strong>The silver stain of the glomerulus highlights the proteinaceous basement membranes in black. There are characteristic \"<strong>spikes\" of basement membrane between the immune deposits of membranous nephropathy.</strong>&nbsp;The black basement membrane material shown here appears as&nbsp;<strong>projections&nbsp;</strong>in the capillary loops.&nbsp;</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c10d8378ffe24c1f8be4f082309d9d39.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/14de4faa32f6428793277d7d8e12fbcax800x533.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man presented with the blurring of vision. Urine examination showed proteinuria. Fundus examination showed dot and blot hemorrhages, microaneurysms, and cotton wool spots. Histopathology of the kidney was as shown below. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Renal amyloidosis"
      },
      {
        "id": 2,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 3,
        "text": "Kimmelstiel-Wilson disease"
      },
      {
        "id": 4,
        "text": "Lupus nephritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Histopathological image shows acellular periodic acid Schiff (PAS)-positive nodules suggestive of&nbsp;<strong>nodular glomerulosclerosis/intercapillary glomerulosclerosis/Kimmelstiel&ndash;Wilson disease,</strong> which occurs in patients with<strong>&nbsp;d</strong><strong>iabetic nephropathy.</strong></p>\n<p>These lesions appear as ovoid or spherical, often laminated, <strong>PAS-positive</strong>&nbsp;<strong>nodules </strong>within the mesangial core of the glomerular lobules.</p>\n<div class=\"page\" title=\"Page 1122\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>These nodular lesions are frequently accompanied by prominent accumulations of hyaline material in capillary loops (&ldquo;<strong>fibrin caps</strong>&rdquo;) or adherent to Bowman capsules (&ldquo;<strong>capsular drops&rdquo;</strong>).</p>\n</div>\n</div>\n</div>\n</div>\n<p>Renal failure is the <strong>second common cause of death in diabetes mellitus</strong>, the first being myocardial infarction.</p>\n<p>Three renal lesions are encountered in diabetic nephropathy:</p>\n<p><strong>1. Glomerular lesions:</strong></p>\n<ol>\n<li>Capillary basement membrane thickening</li>\n<li>Diffuse mesangial sclerosis</li>\n<li>Nodular glomerulosclerosis/<strong>Kimmelstiel&ndash;Wilson disease</strong></li>\n</ol>\n<p>2. <strong>Renal vascular lesions,</strong> principally hyaline arteriolosclerosis</p>\n<p>3. <strong>Pyelonephritis</strong>, including necrotizing papillitis</p>\n<p>Renal histopathology in</p>\n<ul>\n<li><strong>Amyloidosis:</strong>&nbsp;Glomerular deposits appearing as thickenings of the mesangial matrix, forming interlacing broad ribbons of amyloid</li>\n<li><strong>Lupus nephritis:</strong>&nbsp;Immune complex deposits in the mesangium or along the entire basement membrane (wire loop lesions), with mesangial cell proliferation</li>\n<li><strong>Focal segmental glomerulosclerosis:</strong>&nbsp;Focal and segmental hyalinosis and sclerosis of the capillary wall; lipid droplets in the sclerosed area.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aaa16d8be1dc4387865571e02a148f12.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "If the RB gene is hypophosphorylated, which of the following will happen?",
    "choices": [
      {
        "id": 1,
        "text": "Cell cycle will stop at G2"
      },
      {
        "id": 2,
        "text": "Cell cycle will stop at G1"
      },
      {
        "id": 3,
        "text": "There will be no effect on cell cycle as RB gene phosphorylation is not needed"
      },
      {
        "id": 4,
        "text": "The cell cycle progresses and cell divides"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>If the retinoblastoma (<strong>RB</strong>) gene is <strong>hypophosphorylated</strong>, it is <strong>active</strong> and the cell cycle will<strong> stop </strong>at<strong> G1</strong>.</p>\n<p>RB is a<strong> cell-cycle regulator</strong> because it binds to and inactivates a transcription factor (<strong>E2F</strong>). This is necessary for the transcription of certain genes necessary for the progression from the G1 to S phase.<strong>&nbsp;</strong>The<strong> phosphorylation </strong>of<strong> RB</strong>&nbsp;results in the&nbsp;release of E2F. This activates gene transcription and cell-cycle<strong> progression </strong>occurs.</p>\n<p>The image given below shows the cell cycle regulation by RB gene.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/167150cafdc746c092057263a6861018x1280x837.JPEG"
    ]
  },
  {
    "text": "A 35-year-old patient presented with heartburn and increased salivation. Upper gastrointestinal endoscopy was done, and the biopsy result is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Esophagitis"
      },
      {
        "id": 2,
        "text": "Squamous cell carcinoma"
      },
      {
        "id": 3,
        "text": "Adenocarcinoma"
      },
      {
        "id": 4,
        "text": "Barrett\u2019s esophagus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This image indicates the diagnostic features of<strong> Barrett&rsquo;s esophagus.</strong></p>\n<p>The histological image above shows the transition between <strong>normal squamous</strong> epithelium and the <strong>mucin-filled</strong> glands, indicating intestinal-type metaplasia with plenty of <strong>goblet cells</strong>.</p>\n<p><strong>Barrett&rsquo;s esophagus&nbsp;</strong>is a complication of chronic gastroesophageal reflux disease (GERD) characterized by<strong> intestinal metaplasia </strong>within the esophageal squamous mucosa. It is a premalignant condition that confers an increased risk of<strong>&nbsp;esophageal adenocarcinoma.</strong></p>\n<p>Hence, patients diagnosed with Barrett&rsquo;s Esophagus must be subjected to a regular <strong>surveillance</strong> <strong>endoscopy</strong> annually or with 2-year intervals, provided no dysplasias have been detected. The presence of <strong>dysplasia</strong> is associated with prolonged symptoms, longer segment length, increased patient age, and Caucasian race.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/870bcd91f0fb47b1ac32237ad057e110.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male presented with a history of intractable diarrhea. Based on the histological image shown below which of the following is the most appropriate diagnosis:",
    "choices": [
      {
        "id": 1,
        "text": "Lymphoma"
      },
      {
        "id": 2,
        "text": "Leishmaniasis"
      },
      {
        "id": 3,
        "text": "Urate nephropathy"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario points to the diagnosis of<strong>\u00a0multiple myeloma</strong>.\u00a0</p>\n<p>The image shows<strong> Russell bodies</strong>\u00a0which are eosinophilic, large, homogeneous immunoglobulin-containing inclusions usually found in a plasma cell undergoing excessive synthesis of immunoglobulins. Russell bodies are distended endoplasmic reticulum.</p>\n<p><strong>Globular inclusions </strong>are<strong> Russell bodies </strong>(if cytoplasmic) and<strong> Dutcher bodies </strong>(if nuclear).\u00a0</p>\n<p>The below image shows Russell bodies:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/62bf0b4c0f354aec96124f0f77319754.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d2b8cf60e5b488783d68294f57b1b18x720x545.JPEG"
    ]
  },
  {
    "text": "A 10-year-old boy with fever, weight loss came to the hospital. On examination, he was pale and had significant lymphadenopathy. The bone marrow histology of the person is as given below. Your diagnosis is?",
    "choices": [
      {
        "id": 1,
        "text": "Acute monocytic leukemia"
      },
      {
        "id": 2,
        "text": "Acute myelomonocytic leukemia"
      },
      {
        "id": 3,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 4,
        "text": "Juvenile myelomonocytic leukemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario with bone marrow histology showing&nbsp;<strong>lymphoblasts</strong>&nbsp;(condensed nuclear chromatin, small nucleoli, scanty agranular cytoplasm)&nbsp;is suggestive of <strong>acute lymphoblastic leukemia</strong>.&nbsp;</p>\n<p>ALL is more common in childhood.&nbsp;Clinical features of ALL include:</p>\n<ul>\n<li>Bone marrow failure - a<span class=\"TextRun SCXW161209537\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"SpellingError SCXW161209537\">nemia</span></span><span class=\"TextRun SCXW161209537\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW161209537\">, fever, infections,&nbsp;</span></span><span class=\"TextRun SCXW161209537\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW161209537\">bleeding</span></span></li>\n<li>Mass effects due to\u202fneoplastic infiltration - bone pain, generalized lymphadenopathy, splenomegaly, hepatomegaly, and testicular enlargement</li>\n<li><span class=\"TextRun SCXW96263860\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW96263860\">CNS&nbsp;</span></span><span class=\"TextRun SCXW96263860\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW96263860\">manifestations - headache, vomiting,&nbsp;</span></span><span class=\"TextRun SCXW96263860\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW96263860\">and nerve pa</span></span><span class=\"TextRun SCXW96263860\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW96263860\">lsi</span></span><span class=\"TextRun SCXW96263860\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW96263860\">es</span></span><span class=\"EOP SCXW96263860\" data-ccp-props=\"{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}\">&nbsp;</span></li>\n<li>B-ALL - Pancytopenia due to marrow involvement</li>\n<li>T-ALL - Mediastinal mass, compression of \u202flarge vessels and airways in the mediastinum, lymphadenopathy, splenomegaly</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/48db83732e6c412a99f4ee8d48d6e38f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32 year old female with history of back ache and polyarthralgia was investigated and found to have nucleolar pattern in IF. Which of the following is the best fit in her case?",
    "choices": [
      {
        "id": 1,
        "text": "Raynaud phenomenon and sclerodactyly"
      },
      {
        "id": 2,
        "text": "Genital and oral painful ulcers"
      },
      {
        "id": 3,
        "text": "Glomerulonephritis and heart failure"
      },
      {
        "id": 4,
        "text": "Joint pains with nodules on skin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Some sclerodactyly patients develop a combination called the<strong> CREST syndrome:</strong></p>\n<ul>\n<li><strong>C</strong>alcinosis</li>\n<li><strong>R</strong>aynaud phenomenon</li>\n<li><strong>E</strong>sophageal dysmotility</li>\n<li><strong>S</strong>clerodactyly</li>\n<li><strong>T</strong>elangiectasia</li>\n</ul>\n<p>Patients with this syndrome have relatively<strong> limited</strong> involvement of <strong>skin</strong>, often confined to fingers, forearms, and face, and calcification of the subcutaneous tissues. Involvement of the <strong>viscera</strong> may <strong>not occur</strong> at all or occur late. In general, these patients <strong>live longer</strong> than those with systemic sclerosis with diffuse visceral involvement at the outset.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ed2eccb0c5b46dfb2a22f60fc9b2c8dx1280x1380.JPEG"
    ]
  },
  {
    "text": "A young male presented with cervical lymphadenopathy. The biopsy of the lymph node showed RS cells with vague nodule formation and a background of reactive T-lymphocytes. The cells were positive for CD20, LCA, EMA and negative for CD 15 and CD30. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Nodular Sclerosis - Hodgkin Lymphoma"
      },
      {
        "id": 2,
        "text": "CLL"
      },
      {
        "id": 3,
        "text": "T cell rich B cell lymphoma"
      },
      {
        "id": 4,
        "text": "Nodular Lymphocyte predominant Hodgkin Lymphoma (NLPHL)"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>nodular lymphocyte-predominant </strong><strong>Hodgkin's lymphoma (NLPHL). </strong></p>\n<p>Axial group&nbsp;(cervical) lymphadenopathy and along with the <strong>L&amp;H variant</strong> of<strong> Reed-Sternberg cells</strong>&nbsp;is characteristic.</p>\n<p>RS cells are neoplastic giant cells. In NLPHL, the cells have vague nodular formation. Immunophenotyping is positive for CD20 (B cell-associated), LCA (CD45), EMA (epithelial marker), and negative for CD15 (monocyte or macrophage-associated) and CD30 (activation marker).</p>\n<p>The image given below shows the L&amp;H variant of RS cells seen in NLPHL.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4029104fcd37403f94cc29ecf85dd356x530x397.PNG"
    ]
  },
  {
    "text": "Which of  the following is a tool used in gene editing:",
    "choices": [
      {
        "id": 1,
        "text": "CRISPR"
      },
      {
        "id": 2,
        "text": "Big data"
      },
      {
        "id": 3,
        "text": "Gene Xpert"
      },
      {
        "id": 4,
        "text": "GWAS"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Guide RNAs called CRISPRs help to selectively alter or correct DNA sequences.</p>\n<p><strong>CRISPR</strong> is <strong>C</strong>lustered <strong>R</strong>egularly<strong> I</strong>nterspaced <strong>S</strong>hort<strong> P</strong>alindromic <strong>R</strong>epeats</p>\n<ul>\n<li><strong>CRISPR-Cas9</strong> is a <strong>genome editing tool</strong> and this system enables select bacteria to respond to and eliminate invading genetic material.</li>\n<li>CRISPRs are transcribed into an RNA sequence that directs the Cas9 to a sequence leading to its cleavage.</li>\n<li>Gene editing uses an artificial guide RNA that binds Cas9 and is complementary to a DNA sequence of interest and Cas9 induces the break of double-stranded DNA.</li>\n</ul>\n<p>One of the first successful diseases used on experimental basis is <strong>Sickle Cell Anemia.</strong></p>\n<p><strong>Other gene editing tools</strong> are:</p>\n<ul>\n<li>Zinc-finger nucleases (ZNFs)</li>\n<li>Transcription-Activator Like Effector Nucleases (TALEN)</li>\n<li>Meganucleases</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 37-year-old presented with fever. On examination,\u200b he had enlarged and ulcerated tonsils. His peripheral blood smear showed lymphocytosis. Monospot test was negative. Tonsillectomy was done and it showed large cells mixed with lymphocytes. The cells were positive for CD20, EBV LMP1, MUM1, CD 79a. Background cells were positive for CD3. The cells are negative for CD15. Your most probable diagnosis is",
    "choices": [
      {
        "id": 1,
        "text": "Hodgkin lymphoma"
      },
      {
        "id": 2,
        "text": "EBV positive \u2013 DLBCL, NOS"
      },
      {
        "id": 3,
        "text": "Infectious mononucleosis"
      },
      {
        "id": 4,
        "text": "EBV positive mucocutaneous ulcer"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario suggests a likely diagnosis of&nbsp;<strong>EBV positive DLBCL, NOS (Epstein Barr virus-positive Diffuse Large B cell Lymphoma, Not otherwise specified).</strong></p>\n<p>The given slide shows sheets of large lymphoid cells with irregular vesicular nuclei and prominent nucleoli typical of DLBCL.</p>\n<p><strong>Approach to the question:</strong></p>\n<ul>\n<li>In the given case, Monospot test negative<strong> rules out Infectious Mononucleosis</strong> and the identification of Reed-Sternberg cell and their variant is essential for the diagnosis of <strong>Hodgkin Lymphoma, which can also be ruled out</strong>.</li>\n<li><strong>EBV-positive mucocutaneous ulcer</strong> is a localized lymphoproliferative disorder in immunocompromised patients. It is a self-limiting ulcer which reverts on treatment in Immunocompromised people. Histologically characterized by atypical large B cells with RS cell-like morphology. Hence, this is <strong>also ruled out. </strong></li>\n<li><strong>EBV positive DLBL(Diffuse Large B cell Lymphoma)</strong> occurs in patients more than 50 years of age and without a previous history of lymphoma. DLBCL typically presents as a rapidly<strong> enlarging mass at a nodal or extranodal site.</strong></li>\n<li>Immunohistochemical studies indicate that<strong> EBV+&nbsp;DLBCL, NOS </strong>is molecularly heterogeneous with a prominent background of T lymphocytes. The cells are positive for CD 20, CD 79a, IRF4/MUM1. <strong>EBV LMP-1(Latent membrane protein-1)</strong> is positive in about 2/3rdof cases, while <strong>EBNA-2 (Epstein-Barr nuclear antigen)</strong> is positive&nbsp;in the remaining 1/3rd of cases. It is <strong>negative for CD10 and BCL6.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/14ee8d3c7d5c4b2d8d59e0e402178967.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The scraping of a painless genital ulcer, when stained with Gram stain and viewed under the microscope, shows a gram-negative coccobacillus surrounded by neutrophils. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chlamydia trachomatis"
      },
      {
        "id": 2,
        "text": "Hemophilus ducreyi"
      },
      {
        "id": 3,
        "text": "Klebsiella granulomatis"
      },
      {
        "id": 4,
        "text": "Neisseria gonorrhoea"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above description of a gram stain showing<strong>\u00a0</strong>Gram-negative Coccobacillus surrounded by neutrophils is suggestive of <strong>Klebsiella granulomatis.\u00a0</strong></p>\n<p>Granuloma inguinale, or donovanosis, is a<strong> sexually transmitted chronic inflammatory disease caused</strong> by Klebsiella granulomatis, a minute, encapsulated, Coccobacillus. It can exhibit a characteristic safety pin appearance on microscopy.\u00a0</p>\n<p>Klebsiella granulomatis is <strong>difficult to culture</strong> and diagnosis needs visualization of dark-staining Donovan bodies on tissue crush preparation or biopsy. The\u2003organisms\u2003are\u2003demonstrable in Giemsa-stained smears of the exudate as a minute, encapsulated Coccobacilli (Donovan bodies) in macrophages.\u2003</p>\n<p>Options 1, 4: Gram-negative Diplococci</p>\n<p>Option 2: School of fish appearance</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "When papain acts on a molecule of immunoglobulin, which of the following are the end products?",
    "choices": [
      {
        "id": 1,
        "text": "2 FC and 1 FAB fragments"
      },
      {
        "id": 2,
        "text": "1 Variable chain and 1 constant chain"
      },
      {
        "id": 3,
        "text": "1 Fc and 2 Fab fragments"
      },
      {
        "id": 4,
        "text": "2 Fc and 2Fab fragments"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Cleavage of the <strong>antibody</strong> molecule with<strong> pepsin</strong> generates one large fragment called<strong> F(ab&acute;)2</strong> and a<strong> digested Fc</strong> fragment.</p>\n<p>The image given below shows the cleavage of immunoglobulin by pepsin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f36e339272c84f6fa33f6fd7a3d76d91x1280x1222.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1eaeb2a09a59439da02873943fb7634ex1280x1222.JPEG"
    ]
  },
  {
    "text": "Which of the following Immunohistochemistry marker is used in Cyclin D1 negative Mantle cell lymphoma?",
    "choices": [
      {
        "id": 1,
        "text": "SOX11"
      },
      {
        "id": 2,
        "text": "ITRA 1"
      },
      {
        "id": 3,
        "text": "MYD88"
      },
      {
        "id": 4,
        "text": "Annexin V"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>SOX11 is used in Cyclin D1 negative Mantle cell lymphoma. Mutation of SOX11 is associated with worse prognosis in mantle cell lymphoma.</p>\n<p>Other options are not associated with mantle cell lymphoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During development, thymic cells recognizing self-antigens are removed to prevent autoimmunity. Which gene among the following is involved in the process?",
    "choices": [
      {
        "id": 1,
        "text": "NOTCH1"
      },
      {
        "id": 2,
        "text": "RB gene"
      },
      {
        "id": 3,
        "text": "CPK gene"
      },
      {
        "id": 4,
        "text": "AIRE"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above process is called <strong>central tolerance</strong> and the&nbsp;<strong>AIRE </strong>(AutoImmune REgulator) protein is necessary for this process.</p>\n<p><strong>Immature</strong> self-reactive <strong>T </strong>and<strong> B lymphocyte</strong> clones recognize self-antigens during their <strong>maturation</strong> in the central lymphoid organs (thymus for T cells, bone marrow for B cells). They are <strong>killed</strong> or <strong>rendered harmless</strong>.</p>\n<p>The removal of self reacting <strong>T lymphocytes</strong> in the thymus is called <strong>negative selection/ deletion</strong>. For this process, <strong><em>AIRE</em></strong> protein is needed. Mutations in the <em>AIRE</em> gene results in <strong>autoimmune disorders</strong> (autoimmune polyendocrinopathy).</p>\n<p><strong>B cells</strong> undergo a process called <strong>receptor editing</strong>. When developing B cells encounter an antigen, it formulates a change in the receptor that makes the antigen unrecognizable. Self-reacting B cells can also undergo <strong>apoptosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Among the following, which cells have MHC class II?",
    "choices": [
      {
        "id": 1,
        "text": "NK cells"
      },
      {
        "id": 2,
        "text": "All nucleated cells"
      },
      {
        "id": 3,
        "text": "B cells, dendritic cells, mononuclear phagocytes"
      },
      {
        "id": 4,
        "text": "Platelets"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Class II</strong> major histocompatibility\u00a0complex <strong>(MHC)</strong> molecules are mainly expressed on\u00a0<strong>macrophages</strong>, <strong>B lymphocytes</strong>, and<strong> dendritic cells</strong>. These cells present ingested antigens to T-cells.</p>\n<p>The function of MHC molecules is to <strong>display</strong>\u00a0peptide fragments of<strong> protein antigens</strong> for recognition by <strong>antigen-specific T cells</strong>.\u00a0In humans, the MHC molecules are called <strong>human leukocyte antigens (HLA)\u00a0</strong>because they were initially detected on leukocytes by the binding of antibodies. The combination of HLA alleles in each individual is called the HLA haplotype.</p>\n<p>The genes encoding HLA molecules are clustered on the short arm of<strong> chromosome 6</strong>.\u00a0</p>\n<p><strong>Uses</strong>\u00a0of MHC/\u00a0<strong>HLA typing</strong>\u00a0include:</p>\n<ul>\n<li>Anthropology</li>\n<li>Transfusion</li>\n<li><strong>Paternity testing</strong></li>\n<li>Forensic science</li>\n<li><strong>Transplantation</strong></li>\n<li><strong>Disease correlation</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '076 Pathology Aiims 2017';
        let hierarchy = ["Marrow", "PYQs", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>