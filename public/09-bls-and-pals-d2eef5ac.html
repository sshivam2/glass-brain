<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>09 Bls And Pals - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the correct sequence?",
    "choices": [
      {
        "id": 1,
        "text": "Assess the patient\u2019s response, Activate ERS, check carotid pulse, Start CPR"
      },
      {
        "id": 2,
        "text": "Check carotid pulse, Start CPR, Call for help and activate ERS, Defibrillate"
      },
      {
        "id": 3,
        "text": "Defibrillate, Assess response, Check carotid pulse, Maintain airway"
      },
      {
        "id": 4,
        "text": "Start CPR, Activate ERS, Defibrillate, Check pulse"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>BLS sequence:</strong></p>\n<p><strong>First step </strong>&ndash; Assess safety of the surroundings.</p>\n<p><strong>Second step&nbsp;</strong>- Assess for responsiveness</p>\n<p><strong>Third step </strong>&ndash; Proceed if the patient is unresponsive. Shout for help.</p>\n<p>If the patient is unresponsive assess for breathing and carotid pulse simultaneously for no more than 10 seconds.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On your morning walk in the park, you notice an unconscious man lying on the ground. Which of the following options would be the next best step?",
    "choices": [
      {
        "id": 1,
        "text": "Check carotid pulse, start CPR, and call for help; Defibrillate if no pulse."
      },
      {
        "id": 2,
        "text": "Call for help, check pulse, do CPR, defibrillate if no pulse"
      },
      {
        "id": 3,
        "text": "Observe"
      },
      {
        "id": 4,
        "text": "Ignore and continue to walk"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The next best step is to&nbsp;Call for help, check pulse, do CPR, defibrillate If no pulse.</p>\n<p>Steps in basic life support:</p>\n<p>First step &ndash; Assess safety of the surroundings.</p>\n<p>Second step&nbsp;- Assess for responsiveness</p>\n<p>Third step &ndash; Proceed if the patient is unresponsive. Shout for help.</p>\n<p>If the patient is unresponsive, assess for breathing and carotid pulse simultaneously for no more than 10 seconds.</p>\n<p>In the given scenario, it is already mentioned that you are in a park (scene safety has been assessed), and that the person is unconscious (responsiveness has been assessed). So, the immediate next step is to call for help, and start CPR.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On witnessing a cardiac arrest, what is the first thing you would do?",
    "choices": [
      {
        "id": 1,
        "text": "Check for victim\u2019s responsiveness"
      },
      {
        "id": 2,
        "text": "Check for a pulse"
      },
      {
        "id": 3,
        "text": "Check for breathing"
      },
      {
        "id": 4,
        "text": "Check for scene safety"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The first thing that needs to be done on witnessing a cardiac arrest is to<strong> verify </strong>the<strong> scene safety.</strong></p>\n<p>On ensuring that the scene is safe, the victim is<strong> checked for responsiveness</strong>. If unresponsive, call for help and then check for breathing and pulse simultaneously taking <strong>not more than 10 seconds.</strong></p>\n<p>If there is no breathing and no pulse, immediate <strong>chest compression</strong> and <strong>rescue breaths</strong> are started at a ratio of<strong> 30:2</strong>.</p>\n<p>If there is a pulse, but no breathing, give one rescue breath every 5-6 seconds or about 10-12 breaths/min.</p>\n<p>When an <strong>automated external defibrillator</strong> arrives, the rhythm is checked; if shockable, one shock is administered and CPR is resumed immediately.</p>\n<p>If not shockable, then CPR is resumed immediately.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What does the cardiopulmonary resuscitation sequence start with?",
    "choices": [
      {
        "id": 1,
        "text": "Airway"
      },
      {
        "id": 2,
        "text": "Breathing"
      },
      {
        "id": 3,
        "text": "Circulation"
      },
      {
        "id": 4,
        "text": "Drugs"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The sequence of cardiopulmonary resuscitation starts with&nbsp;<strong>circulation</strong>, <strong>airway and then breathing</strong>.</p>\n<p>Maintaining circulation involves chest compressions which lead to ejection of blood from the heart as a result of actual compression of the heart between the sternum and vertebral column.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man presented to the ER with complaints of chest pain. He suddenly collapsed and became unresponsive. His pulse was not recordable so you started chest compressions. Which of the following steps would you not perform according to the BLS algorithm?",
    "choices": [
      {
        "id": 1,
        "text": "Defibrillation using Automated external defibrillator"
      },
      {
        "id": 2,
        "text": "Intubation using Laryngeal mask airway"
      },
      {
        "id": 3,
        "text": "Performing Head tilt \u2013 chin lift"
      },
      {
        "id": 4,
        "text": "Bag and mask ventilation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Laryngeal mask airway </strong>and other supraglottic airway devices are part of advanced airway management, which is included in advanced cardiac life support <strong>(ACLS).</strong></p>\n<p>Basic life support refers to the emergency management of sudden cardiac arrest, heart attack, stroke, and foreign body airway obstruction, usually without the use of equipment other than automated external defibrillators.</p>\n<p>The CPR sequence is as follows - circulation (chest compression), airway, and then breathing:</p>\n<ul>\n<li><strong>Circulation:</strong>\n<ul>\n<li>Chest compressions lead to ejection of blood from the heart, as a result of actual compression of the heart between the sternum and vertebral column.</li>\n</ul>\n</li>\n<li><strong>Airway:</strong>\n<ul>\n<li>Head tilt, chin lift, and jaw thrust maneuvers are used to open the airway.</li>\n</ul>\n</li>\n<li><strong>Breathing:</strong>\n<ul>\n<li>If there is no adequate breathing even after opening the airway, the rescuer should initiate assisted ventilation by giving rescue breaths to the patient using mouth-to-mouth, mouth-to-nose, mouth-to-stoma, mouth-to-barrier device, mouth-to-face shield, or mouth-to-mask rescue breathing or by using a bag-mask device.</li>\n</ul>\n</li>\n<li><strong>Defibrillation:</strong>\n<ul>\n<li>Using automated external defibrillators (AED)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You witness a 40-year-old man suddenly collapse near the ER. He is unresponsive and you start chest compressions as his pulse is also not recordable. For maximum effectiveness, what should be the depth of your compressions?",
    "choices": [
      {
        "id": 1,
        "text": "1 cm"
      },
      {
        "id": 2,
        "text": "2 cm"
      },
      {
        "id": 3,
        "text": "3 cm"
      },
      {
        "id": 4,
        "text": "5 cm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>High-quality cardiopulmonary resuscitation involves adequate <strong>chest compressions </strong>to a <strong>depth</strong> of at least <strong>5 cm in adults.</strong></p>\n<p>If a feedback device is used, then the compression depth can be increased to 6 cm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In order to provide high-quality CPR, what should the rate of chest compressions per minute be?",
    "choices": [
      {
        "id": 1,
        "text": "60-80"
      },
      {
        "id": 2,
        "text": "80-100"
      },
      {
        "id": 3,
        "text": "100-120"
      },
      {
        "id": 4,
        "text": "120-140"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Chest compressions should be performed at a rate of <strong>100-120/ minute</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "When providing CPR to an adult, what ratio of chest compressions to rescue breaths would you provide if there were 2 rescuers?",
    "choices": [
      {
        "id": 1,
        "text": "15:1"
      },
      {
        "id": 2,
        "text": "15:2"
      },
      {
        "id": 3,
        "text": "30:1"
      },
      {
        "id": 4,
        "text": "30:2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>During cardiopulmonary resuscitation of<strong> adults, </strong>the ratio of chest compression to rescue breaths is <strong>30:2 irrespective </strong>of the <strong>number of rescuers.</strong></p>\n<p>In infants and children, the ratio is 30:2 for a single-rescuer and 15:2 if 2 or more rescuers are present.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For effective chest compression during CPR, where should the hands of the healthcare provider ideally be placed?",
    "choices": [
      {
        "id": 1,
        "text": "Upper half of sternum"
      },
      {
        "id": 2,
        "text": "Middle third of sternum"
      },
      {
        "id": 3,
        "text": "Lower half of sternum"
      },
      {
        "id": 4,
        "text": "Upper third of sternum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>children and adults</strong>, chest compressions are performed by locating the xiphoid process and placing the heel of the hand over the <strong>lower</strong> <strong>half</strong> of the <strong>sternum</strong>. The other hand is placed over the hand on the sternum with the fingers either interlaced or extended and the elbow extended&nbsp;so that the weight of the upper body is used for compression.</p>\n<p>In <strong>infants</strong>, if there is a <strong>single</strong> <strong>rescuer</strong>, compressions are effected by placing <strong>2 fingers </strong>in the <strong>center of the chest</strong>, just below the nipple line.&nbsp;If there are <strong>2 or more rescuers</strong>, then <strong>2 thumb technique</strong>&nbsp;is used.</p>\n<p>In infants and children, the depth of compression should be at least one-third of the anteroposterior diameter of the chest,&nbsp;which is about 5 cm in children and 4 cm in infants.</p>\n<p>For pediatric patients, the ratio of chest compression to rescue breaths is 30:2 for a single rescuer and 15:2 if 2 or more rescuers are present.&nbsp;In adults, the ratio is 30:2 irrespective of the number of rescuers.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can be considered as effective CPR?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, and 4"
      },
      {
        "id": 2,
        "text": "1, 2, and 4"
      },
      {
        "id": 3,
        "text": "2, 3, and 4"
      },
      {
        "id": 4,
        "text": "1 and 2 only"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ideal rescue breath rate for adults is 10 breaths/min, while in infants and children up to puberty it is 20-30 breaths/min. As the person's age group is not specified in the question, assuming an adult, statement 1 is incorrect, while 2, 3, and 4 are correct.</p>\n<p>Effective chest compression in <strong>adults</strong>:</p>\n<ul>\n<li>Provide <strong>100-120 compressions per minute</strong> (30 compressions for every 15-18 sec).</li>\n<li>Place your arms, one over the other in the midline, on the lower 1/3rd of the patient's sternum, and lock your arms.</li>\n<li>Use both arms to press the chest to a depth of<strong> 5-6 cm</strong>&nbsp;(2 - 2.4 inches) or more.</li>\n<li>Press hard and fast</li>\n<li>Allow for <strong>full chest recoil</strong> after every compression.&nbsp;</li>\n</ul>\n<p>Effective chest compressions in a<strong> child older than 1 year and up to puberty:</strong></p>\n<ul>\n<li>The compression rate is 100 - 120/min&nbsp; (30 compressions for every 15-18 sec).</li>\n<li><strong>One or both palms</strong> are placed in the midline.</li>\n<li>The depth of compression is <strong>2 inches.</strong></li>\n<li>Press hard and fast</li>\n<li>Allow for full chest recoil after every compression.</li>\n</ul>\n<p>Effective chest compressions in<strong> infants (&lt;1 year):</strong></p>\n<ul>\n<li>100 to 120 compressions per minute (30 compressions for every 15-18 sec).</li>\n<li><strong>One provider: Place two fingers</strong>, one between the nipple line and the other 1 cm below.</li>\n<li><strong>Two providers:</strong> <strong>Encircle</strong> the infant's <strong>torso</strong> with both hands with<strong> both thumbs</strong> pointing cephalic positioned 1cm below the nipples over the sternum.&nbsp;</li>\n<li>Depth of compressions should be&nbsp;at least <strong>1.5 inches or 1/3 the depth</strong> of the infant&rsquo;s chest.</li>\n<li>Press hard and fast</li>\n<li>Allow for full chest recoil after every compression.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not included in high-quality CPR?",
    "choices": [
      {
        "id": 1,
        "text": "Compression depth of at least 5 cm"
      },
      {
        "id": 2,
        "text": "Rotate chest compressor every 3 mins"
      },
      {
        "id": 3,
        "text": "Avoid excessive ventilation"
      },
      {
        "id": 4,
        "text": "Compression \u2013 ventilation ratio of 30:2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Rotation of chest compressor is done <strong>every 2 minutes or earlier</strong> if the compressor is <strong>fatigued</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old child is brought to the casualty with a history of choking over a peanut. The child suddenly becomes unresponsive. What would you do as the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "Give 5 back slaps"
      },
      {
        "id": 2,
        "text": "Give abdominal thrusts"
      },
      {
        "id": 3,
        "text": "Endotracheal intubation"
      },
      {
        "id": 4,
        "text": "Chest compressions"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\">If a choking victim becomes <strong>unresponsive</strong>, call for help and immediately start <strong>CPR,</strong> beginning with chest compressions.</p>\n<p style=\"text-align: left;\">For pediatric CPR, if a single rescuer is present, then chest compression to ventilation is performed in a ratio of 30:2. If there are 2 or more rescuers, then the ratio is 15:2.</p>\n<p style=\"text-align: left;\">While giving rescue breaths, the airway is checked for a foreign body. If it is accessible, then the object can be removed. If not, then CPR is continued. <strong>Blind finger sweeping</strong> may be <strong>hazardous</strong> as it can push the object further down the airway.</p>\n<p style=\"text-align: left;\">If the <strong>child </strong>is<strong> responsive</strong>, then&nbsp;<strong>abdominal thrusts</strong> are performed to help relieve airway obstruction.</p>\n<p style=\"text-align: left;\"><span style=\"text-align: justify;\">In a </span><strong style=\"text-align: justify;\">choking infant </strong><span style=\"text-align: justify;\">who is </span><strong style=\"text-align: justify;\">responsive</strong><span style=\"text-align: justify;\">, </span><strong style=\"text-align: justify;\">5 back slaps</strong><span style=\"text-align: justify;\"> between the shoulder blades and&nbsp;</span><strong style=\"text-align: justify;\">5 downward thrusts on the&nbsp;</strong><strong style=\"text-align: justify;\">chest</strong><span style=\"text-align: justify;\">&nbsp;are given in order to dislodge the foreign body.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8854b85ea9134071803e1768faf1bb37x510x441.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6dcac0ddf84f454f80cf9836c2c91ee5x510x437.GIF"
    ]
  },
  {
    "text": "Identify the device shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Automated External Desynchonizer"
      },
      {
        "id": 2,
        "text": "Automated External Defibrillator"
      },
      {
        "id": 3,
        "text": "Automated Electronic Defibrillator"
      },
      {
        "id": 4,
        "text": "Automated External decompressor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The device is an&nbsp;<strong>Automated External Defibrillator (AED).</strong></p>\n<p>This is a special medical device that is commonly used for recognizing the absence/presence of <strong>rapid ventricular tachycardia or ventricular fibrillation.</strong> With no need for intervention by an operator, it determines whether an electrical shock right to the heart must be performed (defibrillation).</p>\n<p>An automated external defibrillator can be used on those victims, who are unconscious and aren&rsquo;t breathing in a normal way. As a rule, it is used together with CPR in cases of sudden cardiac arrest. It is forbidden to use it on patients who are less than eight years old or those weighing less than 25 kgs.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a882d8d959804b8da3895e3893fae64b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In a cardiac arrest patient, if intravenous access cannot be obtained, what is the next best way to administer epinephrine?",
    "choices": [
      {
        "id": 1,
        "text": "Endotracheal route"
      },
      {
        "id": 2,
        "text": "Intramuscular"
      },
      {
        "id": 3,
        "text": "Intraosseus"
      },
      {
        "id": 4,
        "text": "Wait till intravenous access is made"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>American Heart Association recommends the <strong>intraosseous</strong>&nbsp;<strong>(IO)</strong> <strong>route</strong> as an alternative to an intravenous route in order to deliver drugs and fluids, especially in children.</p>\n<p>This is because<strong> intraosseous access </strong>can easily be made in<strong> 30-60 seconds </strong>and thus provide <strong>emergency vascular access</strong>. It involves placing a catheter into the marrow venous plexus and administering, crystalloids, colloids, drugs, and blood which leads to rapid and reliable absorption into the systemic circulation.</p>\n<p>Sites of choice: proximal tibia, distal femur, the distal end of radius, or ulna.</p>\n<p>The fluids are administered under pressure because of the resistance to fluid flow from the IO catheter into the IO space.&nbsp;The <strong>disadvantage</strong> with this route is the risk of <strong>osteomyelitis, compartment syndrome,</strong> bone marrow or <strong>fat embolism.</strong></p>\n<p>IO access is superior to the endotracheal route. The American Heart Association does not recommend an intramuscular route for cardiac resuscitation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An unconscious 4-year-old child is brought to the ER. On examination, she is gasping but her pulse is not recordable. You start chest compressions and rescue breaths. As the child is not responding you want to start IV epinephrine, but you cannot obtain IV access.  Which of the following sites is preferred for intraosseous access in this situation?",
    "choices": [
      {
        "id": 1,
        "text": "Proximal Tibia"
      },
      {
        "id": 2,
        "text": "Sternum"
      },
      {
        "id": 3,
        "text": "Iliac crest"
      },
      {
        "id": 4,
        "text": "Proximal femur"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The site preferred for intraosseous access among the given options is&nbsp;<strong>proximal tibia. </strong></p>\n<p><strong>Other</strong> sites of choice are <strong>distal femur, distal end of radius, or ulna</strong>.</p>\n<p>Intraosseous access involves placing a catheter into the marrow venous plexus and administering, crystalloids, colloids, drugs, and blood which leads to rapid and reliable absorption into the systemic circulation.&nbsp;</p>\n<p>The fluids are administered under pressure because of the resistance to fluid flow from the IO catheter into the IO space.&nbsp;The disadvantage with this route is the risk of osteomyelitis, compartment syndrome, bone marrow or fat embolism.</p>\n<p>American Heart Association recommends the&nbsp;intraosseous&nbsp;route as an alternative to an intravenous route in order to deliver drugs and fluids, especially in children.&nbsp;This is because intraosseous access can easily be made in 30-60 seconds and thus provide <strong>emergency</strong> <strong>vascular</strong> <strong>access</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "According to the AHA 2020 guidelines for the Pediatric Basic and Advanced Life Support, which of the following statements is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Administer the initial dose of epinephrine within 5 minutes from the start of chest compressions"
      },
      {
        "id": 2,
        "text": "Cuffed endotracheal tubes are preferred for intubating infants and children"
      },
      {
        "id": 3,
        "text": "Routine use of cricoid pressure is recommended during endotracheal intubation"
      },
      {
        "id": 4,
        "text": "In infants the respiratory rate should be 20-30 breaths/minute"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the AHA 2020 guidelines, <strong>routine use of cricoid pressure</strong> is <strong>not recommended</strong> during the endotracheal intubation of <strong>pediatric</strong> patients.</p>\n<p>Option A: For pediatric patients in any setting, it is reasonable to administer the initial dose of <strong>epinephrine</strong> <strong>within 5 minutes</strong> from the start of chest compressions.</p>\n<p>Option B: It is reasonable to <strong>prefer cuffed ETTs</strong> over uncuffed ETTs for intubating infants and children to reduce air leak.</p>\n<p>Option D: For infants and children with a pulse but an absent or inadequate respiratory effort, 1 breath can be given every 2 to 3 seconds (<strong>20-30 breaths/min</strong>).</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old girl is admitted to the pediatric ward for severe pneumonia. She suddenly becomes unresponsive. On examination, her pulse is not detectable. You immediately start cardiopulmonary resuscitation. What is the ratio of chest compressions to ventilation to be provided if there are 2 rescuers?",
    "choices": [
      {
        "id": 1,
        "text": "15:1"
      },
      {
        "id": 2,
        "text": "15:2"
      },
      {
        "id": 3,
        "text": "30:1"
      },
      {
        "id": 4,
        "text": "30:2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>During cardiopulmonary resuscitation of<strong> infants and children, </strong>the ratio of chest compression to rescue breaths is 30:2 for a single rescuer and<strong> 15:2 </strong>if<strong> 2 or more rescuers </strong>are present.</p>\n<p>In adults, the ratio is 30:2 irrespective of the number of rescuers.</p>\n<p>In infants and children, the depth of compression should be at least one-third of the anteroposterior diameter of the chest which is about 5 cm in children and 4 cm in infants.</p>\n<p>The compression rate should be 100-120/minute.</p>\n<p>Allow complete chest recoil after each compression and minimize interruptions in compressions (10 seconds or less).&nbsp;Rotate between compressors every 2 minutes or earlier if fatigued.</p>\n<p>Excessive ventilation is to be avoided.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An unresponsive child is brought to the ER. His BP is not recordable, pulse rate is 40 per minute. CPR is initiated but his SpO2 is 70% despite proper oxygenation and ventilation, and pulse rate is not improving. What is the next best step of management?",
    "choices": [
      {
        "id": 1,
        "text": "IV atropine"
      },
      {
        "id": 2,
        "text": "IV epinephrine"
      },
      {
        "id": 3,
        "text": "IV dopamine"
      },
      {
        "id": 4,
        "text": "IV adenosine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Epinephrine</strong> is the<strong> drug of choice </strong>for treating <strong>bradycardia in infants and children.</strong> The recommended dose is <strong>0.01 mg/ kg of a 1:10,000 solution</strong>. It can be given intravenously or via the intraosseous route. It can be repeated every 3-5 minutes.</p>\n<p>If intravenous or intraosseous access cannot be obtained, then it can be administered via the endotracheal route at a dose of 0.1 mg/kg of a 1:1,000 solution.</p>\n<p>If epinephrine is not effective in increasing the heart rate, then atropine can be used with a dose of 0.02 mg/kg and repeated.</p>\n<p><strong>For adults, treatment is initiated with 1 mg atropine iv</strong> which may be repeated at 3-5 minute intervals to a <strong>maximum</strong> dose of <strong>3 mg</strong>. Along with atropine, transcutaneous pacing is to be done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child is brought to the casualty after having suddenly collapsed while playing. Pulse is not recordable and CPR is started. After 2 minutes of CPR, the monitor shows ventricular fibrillation rhythm. What is the energy to be set for defibrillation?",
    "choices": [
      {
        "id": 1,
        "text": "1 J/kg"
      },
      {
        "id": 2,
        "text": "2 J/kg"
      },
      {
        "id": 3,
        "text": "4 J/kg"
      },
      {
        "id": 4,
        "text": "6J /kg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a <strong>pediatric cardiac arrest</strong>, the initial energy for defibrillation is set at <strong>2 J/kg</strong> for both\u00a0monophasic and biphasic waveforms.<strong>\u00a0</strong>It\u00a0is increased to 4 J/kg if a second shock is required<strong>.</strong></p>\n<p>If a pediatric defibrillator is not available, then an adult defibrillator can be used.</p>\n<p>In children the <strong>most common cause of cardiac arrest is asphyxia. </strong>However, a sudden witnessed collapse in a child is usually due to ventricular fibrillation.</p>\n<p>For adult defibrillation, the energy that must be applied is</p>\n<ul>\n<li>Monophasic defibrillator\u2013 360 J</li>\n<li>Biphasic defibrillator- 120-200 J (manufacturer recommended)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are providing basic resuscitative care to a newborn. After the initial management of airway, oxygenation, and IV access, you perform a 12 lead ECG as the heart rate is 190/minute. What is the cut-off value to determine increased QRS duration according to the AHA 2020 Guidelines for Pediatric Management of tachycardia with a pulse?",
    "choices": [
      {
        "id": 1,
        "text": ">0.11 sec"
      },
      {
        "id": 2,
        "text": ">0.10 sec"
      },
      {
        "id": 3,
        "text": ">0.09 sec"
      },
      {
        "id": 4,
        "text": ">0.12 sec"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The cut off value for increased QRS duration according to the AHA 2020 guidelines for pediatric management of tachycardia with a pulse is&nbsp;<strong>&gt;0.09 second</strong>.<strong>&nbsp;</strong><strong>Wide QRS duration</strong> of&nbsp;<strong>&gt;0.09 </strong>second is suggestive of possible<strong> ventricular tachycardia</strong>.</p>\n<p>When a pediatric patient is in tachycardia, a <strong>12-lead ECG</strong> is done to evaluate the <strong>rhythm</strong> and <strong>QRS complex duration</strong>. In addition,&nbsp;<strong>cardiopulmonary</strong>&nbsp;<strong>compromise</strong> is also assessed by checking for acutely altered mental status, signs of shock, and hypotension.&nbsp;</p>\n<p>Based on the QRS complex duration on the ECG, it can be:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Narrow</strong> (&le;0.09 seconds) indicating a probable supraventricular tachycardia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Wide</strong> (&gt;0.09 seconds) indicating a possible ventricular tachycardia</li>\n</ul>\n<p>Treatment of patient with <strong>probable supraventricular tachycardia</strong>:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Presence of cardiopulmonary compromise - adenosine</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Absence of cardiopulmonary compromise - vagal maneuvers</li>\n</ul>\n<p>Treatment of patient with <strong>possible ventricular tachycardia</strong>:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Presence of cardiopulmonary compromise - synchronized cardioversion</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Absence of cardiopulmonary compromise - adenosine, if the the rhythm is regular and QRS is monomorphic</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '09 Bls And Pals';
        let hierarchy = ["Marrow", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>