<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14 Vibrio And Campylobacterales - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A child presents with profuse, painless diarrhea. Stool microscopy shows the following finding. What is this characteristic appearance called?",
    "choices": [
      {
        "id": 1,
        "text": "School of fish appearance"
      },
      {
        "id": 2,
        "text": "Railroad appearance"
      },
      {
        "id": 3,
        "text": "Fish in stream appearance"
      },
      {
        "id": 4,
        "text": "Drumstick appearance."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette is suggestive of <strong>cholera</strong>\u00a0caused by\u00a0<strong><em>Vibrio cholerae</em>.</strong>\u00a0 The image shows\u00a0the characteristic<strong> fish in stream appearance</strong> of<em> Vibrio</em>.</p>\n<p>Other options:</p>\n<p>Options A and B:<strong>\u00a0School</strong> of <strong>fish</strong> appearance and <strong>railroad</strong> appearance\u00a0are shown by <em><strong>Haemophilus ducreyi</strong></em>.</p>\n<p>Option D: <strong>Drumstick</strong> appearance is shown by <em><strong>Clostridium tetani</strong></em> due to its spherical and terminal spores.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c8238090cee64035baa38b5353dee611.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "While studying the microscopic features of Vibrio cholerae, you observe the following finding.  What type of motility can you see here?",
    "choices": [
      {
        "id": 1,
        "text": "Lashing motility"
      },
      {
        "id": 2,
        "text": "Swarming motility"
      },
      {
        "id": 3,
        "text": "Darting motility"
      },
      {
        "id": 4,
        "text": "Twitching motility"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given microscopic finding shows the&nbsp;<strong>darting</strong> motility characteristic of&nbsp;<strong><em>Vibrio cholerae</em></strong>.</p>\n<p><em>Vibrio cholerae</em> is <strong>actively motile</strong> with a <strong>polar flagellum</strong>. The actively motile vibrios appear like a 'swarm of gnats'.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6236799142af4a33bf34d7911b519138.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "On the basis of which antigen is Vibrio cholerae classified under the Sakazaki typing scheme?",
    "choices": [
      {
        "id": 1,
        "text": "O antigen"
      },
      {
        "id": 2,
        "text": "K antigen"
      },
      {
        "id": 3,
        "text": "H antigen"
      },
      {
        "id": 4,
        "text": "O and H antigen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><em><strong>Vibrio cholerae</strong></em>&nbsp;are classified based on <strong>O</strong><strong>&nbsp;</strong><strong>antigen,&nbsp;</strong>under&nbsp;<strong>Sakazaki typing</strong> scheme.</p>\n<p>Based on the presence or absence of O antigen,&nbsp;<em>V. cholerae</em> is classified as <strong>O1</strong>&nbsp;which agglutinate with antisera to O1 group (<strong>agglutinable vibrios</strong>) and <strong>non-O1</strong>, which do not agglutinate with antisera to O1 group (<strong>non-agglutinable vibrios</strong>).&nbsp;</p>\n<p>As per the&nbsp;<strong>Gardner and Venkatraman classification</strong>,<em> Vibrios</em> are classified into Group A (V. cholerae) and Group B (others) based on <strong>H antigen&nbsp;</strong>or flagellar antigen.</p>\n<p>Gardner and Venkatraman classification:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e7e7eeb07664f749a562551e7dc8be0x1280x1389.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding non-agglutinable vibrios?",
    "choices": [
      {
        "id": 1,
        "text": "They belong to serogroup O2 \u2013 O200"
      },
      {
        "id": 2,
        "text": "They are mostly pathogenic"
      },
      {
        "id": 3,
        "text": "They are not agglutinated by O-1 antiserum"
      },
      {
        "id": 4,
        "text": "These are similar to V. cholera in most cultural and biochemical reactions"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Non-agglutinable vibrios</strong> are <strong>non</strong>-<strong>pathogenic </strong>(except O139) and hence, they are called\u00a0<strong>n</strong><strong>on-cholera vibrios</strong>.\u00a0</p>\n<p>The vibrios which are<strong> not agglutinated</strong> by <strong>O-1 antiserum</strong> are called non-agglutinable (NAG) vibrios.\u00a0They belong to the serogroups O2\u2013O200 of which only<strong>\u00a0serogroup O-139\u00a0</strong>is known to cause<strong> epidemics</strong> of cholera<strong>.\u00a0</strong>They are similar to <em>Vibrio cholerae</em> in most biochemical reactions and culture characteristics, except that they are <strong>hemolytic</strong> to sheep erythrocytes and give a <strong>positive Voges-Proskauer reaction. </strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A microbiologist studying Vibrio cholera added sulphuric acid to a 24-hour peptone culture of the organism and a reddish-pink color developed. Which of the following is true about the test he performed?",
    "choices": [
      {
        "id": 1,
        "text": "It is known as methyl red test"
      },
      {
        "id": 2,
        "text": "A nitrosoindole compound is formed giving it the red colour"
      },
      {
        "id": 3,
        "text": "The red colour is obtained due to pigment production by the bacteria"
      },
      {
        "id": 4,
        "text": "The red colour is obtained due to acid & gas production by Vibrio"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A:\u00a0The <strong>methyl red (MR) test</strong> is used to detect the production of sufficient acid during the <strong>fermentation of glucose</strong> by bacteria. It is used to <strong>classify Enterobacteriacae.</strong></p>\n<p>Option C: <em>Vibrio cholera</em> does not produce any colored pigment.</p>\n<p>Option D:\u00a0<strong><em>Vibrio</em></strong> ferments carbohydrates leading to\u00a0<strong>production of acid</strong>\u00a0but <strong>no gas</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/678b1aa5455c44fab7eea4696e89b8fcx1280x1706.JPEG"
    ]
  },
  {
    "text": "A 20-year-old woman presents with complaints of passing profuse loose stools which looked like rice water for the past 3 days. There's a history of similar symptoms in the family. Stool samples were sent to the lab for analysis and the test given in the image is performed. Identify this test.",
    "choices": [
      {
        "id": 1,
        "text": "Loop test"
      },
      {
        "id": 2,
        "text": "String test"
      },
      {
        "id": 3,
        "text": "Wire test"
      },
      {
        "id": 4,
        "text": "Duodenal string test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given case scenario of passing profuse rice-water stools with similar complaints in the family suggests a probable diagnosis of <strong>cholera.</strong>\u00a0The test shown in the above image is the <strong>s</strong><strong>tring</strong> <strong>test</strong>\u00a0and it is performed to identify\u00a0<strong><em>Vibrio cholerae</em>.</strong></p>\n<p>To perform the string test, a\u00a0loopful of the bacterial culture is mixed with a drop of <strong>0.5% sodium deoxycholate</strong> in saline on a slide. The bacterial cells of <em><strong>Vibrio cholerae</strong></em> are <strong>lysed</strong> by sodium deoxycholate, causing the suspension to <strong>lose its turbidity\u00a0</strong>and become <strong>mucoid</strong>. A <strong>string is formed</strong> when the loop is drawn away from the suspension.</p>\n<p>Note: The duodenal string test refers to the Entero test performed for the diagnosis of giardiasis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/16e9ec1f7353457a917e64dcbbd27f12.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following bacteria is not microaerophilic?",
    "choices": [
      {
        "id": 1,
        "text": "Helicobacter  pylori"
      },
      {
        "id": 2,
        "text": "Campylobacter jejuni"
      },
      {
        "id": 3,
        "text": "Mycobacterium bovis"
      },
      {
        "id": 4,
        "text": "Vibrio cholera"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong><em>Vibrio cholera</em></strong> is a <strong>facultative anaerobe</strong> and is not microaerophilic.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The disruption of which of the following is responsible for watery diarrhea in cholera caused by Vibrio?",
    "choices": [
      {
        "id": 1,
        "text": "Intercalated discs"
      },
      {
        "id": 2,
        "text": "Macula densa"
      },
      {
        "id": 3,
        "text": "Zonula occludens"
      },
      {
        "id": 4,
        "text": "Hemidesmosomes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> disruption of zonula occludens</strong> is responsible for watery diarrhea in cholera caused by <strong><em>Vibrio cholerae</em></strong>.</p>\n<p><strong>Zonula occludens toxin</strong> (Zot) is an enterotoxin elaborated by <em>Vibrio cholerae</em> that increases intestinal permeability by interacting with a mammalian cell receptor with subsequent activation of intracellular signaling leading to the <strong>disassembly of the intercellular tight junctions</strong>.</p>\n<p>Mechanism of action of cholera toxin:</p>\n<div class=\"page\" title=\"Page 323\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>The cholera toxin molecule&nbsp;consists of 1 A and 5 B subunits. The <strong>B (binding) units</strong>&nbsp;attach to the <strong>GM1 ganglioside receptors</strong> on the surface&nbsp;of jejunal epithelial cells. The A (active) subunit, on&nbsp;being transported into the enterocyte, dissociates into A1 and A2. A2 fragment only links biologically active A<span class=\"s5\">1 </span>to the B subunit.</li>\n<li>A1&nbsp;causes prolonged <strong>activation of cellular adenylate cyclase</strong> and accumulation of <strong>cAMP</strong>, leading to outpouring into the small intestinal lumen, of large quantities of water and electrolytes. This leads to&nbsp;<strong>watery diarrhea</strong>&nbsp;which is&nbsp;isotonic with plasma but contains much more potassium and bicarbonate.</li>\n<li>The toxin also <strong>inhibits the intestinal absorption</strong> of sodium and chloride.</li>\n<li>All clinical manifestations and complications in cholera result from the <strong>massive water</strong> <strong>and electrolyte depletion</strong> thus caused.</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ea04de118f64753a4f1880a6ca9b4ecx1280x1516.JPEG"
    ]
  },
  {
    "text": "A young child was brought to the ER with a history of loose stools. On examination, she is tachycardic, appears lethargic and skin goes back slowly after the skin pinch test. She was admitted and started on IV fluids and input-output charting was done. The given image shows stool output from the patient. Which of the following is the mechanism of action of the toxin responsible for the same?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibit elongation factor -2"
      },
      {
        "id": 2,
        "text": "Toxin causes Increased guanyl cyclase activity"
      },
      {
        "id": 3,
        "text": "The toxin causes continued activation of adenylate cyclase"
      },
      {
        "id": 4,
        "text": "Inhibit 60S  ribosomal subunit"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of dehydration, profuse diarrhea, and rice water stools is suggestive of <strong>cholera.</strong> Cholera<strong> toxin</strong> causes continued <strong>activation of</strong> <strong>adenylate cyclase</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 323\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 323\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>&nbsp;Mechanism of action of cholera toxin:</strong></p>\n<div class=\"page\" title=\"Page 323\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>The cholera toxin molecule&nbsp;consists of 1 A and 5 B subunits. The B (binding) units&nbsp;attach to the GM1 ganglioside receptors on the surface&nbsp;of jejunal epithelial cells. The A (active) subunit, on&nbsp;being transported into the enterocyte, dissociates into A1 and A2. A2 fragment only links biologically active A<span class=\"s5\">1&nbsp;</span>to the B subunit.</li>\n<li>A1&nbsp;causes prolonged&nbsp;<strong>activation of cellular adenylate cyclase</strong>&nbsp;and accumulation of&nbsp;<strong>cAMP</strong>, leading to&nbsp;<strong>outpouring</strong>&nbsp;into the small intestinal lumen, of large quantities of water and electrolytes and the consequent watery diarrhea, that is&nbsp;isotonic with plasma but contains much more of potassium and bicarbonate.</li>\n<li>The toxin also&nbsp;<strong>inhibits the intestinal absorption</strong>&nbsp;of sodium and chloride.</li>\n<li>All clinical manifestations and complications in cholera result from the massive water and electrolyte depletion thus caused.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0640be8624ae48c595d0e6cb41031277.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/497dd499a8254fcb851a7da430376ff9x1280x1516.JPEG"
    ]
  },
  {
    "text": "Which of the following does not play a role in the virulence of Vibrio cholerae?",
    "choices": [
      {
        "id": 1,
        "text": "Lipopolysaccharide"
      },
      {
        "id": 2,
        "text": "Flagella"
      },
      {
        "id": 3,
        "text": "Pilum"
      },
      {
        "id": 4,
        "text": "Cholera toxin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><em>Vibrio cholerae</em>\u00a0possesses\u00a0<strong>lipopolysaccharide\u00a0</strong>(LPS)<strong> O antigen</strong>\u00a0but it plays <strong>no role</strong> in the <strong>pathogenesis</strong> of cholera. It is responsible for the <strong>immunity</strong> induced by <strong>killed vaccines.</strong></p>\n<p>Factors involved in <strong>virulence of <em>Vibrio cholerae</em></strong>: \u00a0</p>\n<div class=\"page\" title=\"Page 322\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>In the small intestine, vibrios can cross the protective layer of mucus and reach the epithelial cells by\u00a0using <strong>mucinase</strong> and other <strong>proteolytic enzymes</strong>.</li>\n<li><strong>Toxin co-regulated pilus</strong>(TCP),\u00a0is essential for the <strong>adhesion</strong> to the epithelial surface and <strong>colonization</strong> of the bacteria in small intestine.</li>\n<li><strong>Cholera toxin</strong> (also known as choleragen and\u00a0cholera enterotoxin) causes\u00a0<strong>watery</strong> <strong>diarrhea</strong> through <strong>cAMP-</strong>mediated pathway.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An El Tor vibrio was identified to be the causative agent of a diarrhea epidemic. Which of the following is not a characteristic feature of this organism?",
    "choices": [
      {
        "id": 1,
        "text": "Resistant to El Tor phage V"
      },
      {
        "id": 2,
        "text": "Intrinsic resistance to polymyxin B"
      },
      {
        "id": 3,
        "text": "Voges-Proskauer test is positive"
      },
      {
        "id": 4,
        "text": "Not susceptible to group IV phage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>El Tor vibrios are <strong>susceptible</strong> to<strong> El Tor phage V</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a medical officer at a district hospital and receive 13 patients with rice-water diarrhea and dehydration. You suspect cholera and want to send the stool samples to the hospital lab. Which of the following media will you not use?",
    "choices": [
      {
        "id": 1,
        "text": "Venkatraman-Ramakrishnan medium"
      },
      {
        "id": 2,
        "text": "Cary-Blair medium"
      },
      {
        "id": 3,
        "text": "Monsur's GTTA medium"
      },
      {
        "id": 4,
        "text": "Nutrient agar"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Nutrient agar</strong> is not used to transport <em>Vibrio cholerae.</em>&nbsp;It is a simple media used to grow <strong>non-fastidious organisms,&nbsp;</strong>but not to transport them.</p>\n<p><strong>Transport</strong> media for <strong><em>Vibrio cholerae</em></strong>:&nbsp;</p>\n<ul>\n<li><strong>Venkatraman-Ramakrishnan</strong> (VR) medium</li>\n<li><strong>Cary-Blair</strong> medium</li>\n</ul>\n<div class=\"page\" title=\"Page 324\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>If the specimen can reach the laboratory in a <strong>few hours</strong>, it may also be<strong> transported in enrichment media.</strong>&nbsp;Examples include:</p>\n<ul>\n<li><strong>Alkaline peptone water</strong></li>\n<li><strong>Monsur's&nbsp;</strong>medium.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>If transport media are not available, <strong>strips of blotting paper</strong> may be soaked in the watery stool and sent to the laboratory <strong>packed in plastic</strong> envelopes.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following bacteria shows Kanagawa phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio cholerae"
      },
      {
        "id": 2,
        "text": "Vibrio parahaemolyticus"
      },
      {
        "id": 3,
        "text": "Vibrio vulnificus"
      },
      {
        "id": 4,
        "text": "Vibrio alginolyticus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Kanagawa phenomenon</strong>&nbsp;is&nbsp;shown by&nbsp;<em><strong>Vibrio parahaemolyticus</strong>.&nbsp;</em>It refers to&nbsp;<strong>hemolysis</strong>&nbsp;occuring when the bacteria are inoculated on <strong>Wagatsuma agar.</strong></p>\n<p><strong>Pathogenic</strong> strains of<em> V. parahaemolyticus</em> are <strong>hemolytic</strong>, while <strong>non-pathogenic</strong> strains are <strong>non-hemolytic.</strong>&nbsp;This phenomenon occurs due to a heat-stable hemolysin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An outbreak of food poisoning in a coastal city is determined to be due to contaminated seafood. The causative bacteria formed the following colonies on TCBS agar and showed hemolysis on Wagatsuma agar. Which of the following statements regarding the organism implicated here is false?",
    "choices": [
      {
        "id": 1,
        "text": "It is non-capsulated"
      },
      {
        "id": 2,
        "text": "It shows bipolar staining"
      },
      {
        "id": 3,
        "text": "It produces peritrichous flagella on solid medium"
      },
      {
        "id": 4,
        "text": "It gives a positive string test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case scenario of an organism that caused food poisoning due to contaminated seafood in addition to the cultural characteristics is suggestive of food contamination by <strong><em>Vibrio parahaemolyticus. </em></strong>It\u00a0is a\u00a0<strong>capsulated</strong>\u00a0organism.</p>\n<p><em>V. parahaemolyticus</em> is an enteropathogenic halophilic vibrio that is an important cause of <strong>food poisoning</strong> throughout the world.\u00a0It inhabits the <strong>coastal</strong> seas, where it is found in shrimps, crabs, and oysters.</p>\n<p>It forms <strong>opaque green colonies</strong> with a raised centre and flat translucent periphery on <strong>TCBS agar</strong> unlike <em>V. cholera</em> which forms yellow colonies. Pathogenic strains show hemolysis on Wagatsuma agar which is known as <strong>Kanagawa phenomenon</strong>. This can be used as a test for pathogenecity.</p>\n<p>Other options:</p>\n<p>Option B: It shows <strong>bipolar staining</strong> and has a tendency for pleomorphism, especially when grown on 3% salt agar.</p>\n<p>Option C: Unlike other vibrios, it produces peritrichous flagella when grown on solid media. Polar flagella are formed in liquid cultures.</p>\n<p>Option D: String test is positive like with V. cholera.\u00a0\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4ed7710f25924ebebdfff5a2a388dc7c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following vibrios has the highest salt tolerance?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio mimicus"
      },
      {
        "id": 2,
        "text": "Vibrio  parahaemolyticus"
      },
      {
        "id": 3,
        "text": "Vibrio  vulnificus"
      },
      {
        "id": 4,
        "text": "Vibrio alginolyticus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Vibrio with the <strong>highest salt tolerance</strong> of up to 10% NaCl is&nbsp;<strong><em>Vibrio alginolyticus</em></strong>.</p>\n<p>The salt tolerances of vibrio species are as follows:</p>\n<ul>\n<li><strong><em>V. cholerae</em></strong> optimally grows at 0.5&ndash;1% NaCl concentration. Its growth is <strong>inhibited</strong> by high concentration of <strong>&gt;6% NaCl</strong>.</li>\n<li><em><strong>V. mimicus</strong> </em>grows best at low salt concentrations of 0.5-1% <strong>like <em>V. cholerae</em></strong>.</li>\n<li><strong><em>V. parahaemolyticus</em></strong>&nbsp;grows optimally salt concentration of 2-4 %. It has&nbsp;a salt tolerance up to<strong> 8%</strong>.</li>\n<li><strong><em>V. vulnificus</em></strong> has a salt tolerance <strong>similar</strong> to <strong><em>V. parahaemolyticus</em>.</strong></li>\n<li><strong><em>V. alginolyticus</em></strong> has the highest salt tolerance of up to<strong>&nbsp;10% NaCl</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A fisherman presented to the ER with a wound on his left leg. He tells you he had got a small cut a week back that got worse after his recent fishing trip. On examination, you note vesicles and bullae around the wound. Specimen taken from the bullae revealed lactose-fermenting colonies. What is the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio cholerae"
      },
      {
        "id": 2,
        "text": "Vibrio parahaemolyticus"
      },
      {
        "id": 3,
        "text": "Vibrio vulnificus"
      },
      {
        "id": 4,
        "text": "Vibrio alginolyticus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given case scenario of contact with\u00a0<strong>seawater</strong> of an existing wound leading to <strong>cellulitis</strong> by a <strong>lactose-fermenting</strong> bacteria suggests infection with <em><strong>Vibrio vulnificus</strong></em>.</p>\n<p><em>V. vulnificus</em> <strong>ferments lactose</strong> but not sucrose.\u00a0It has a <strong>salt tolerance</strong> of<strong>\u00a0</strong>up to <strong>8%.</strong>\u00a0</p>\n<p>Infection with<em> V. vulnificus</em> can manifest in 2 ways:</p>\n<ul>\n<li><strong>Soft-tissue infections</strong> can occur after contact with seawater and progress to cellulitis.</li>\n<li><strong>Primary septicemia</strong> can occur in patients, typically with underlying liver disease, who have acquired the organism through the gastrointestinal tract after recent consumption of raw shellfish.</li>\n</ul>\n<p>\u00a0Note:<em> V. cholerae, V. parahaemolyticus</em>, and<em> V. alginolyticus</em> do not ferment lactose although lactose may be split very slowly by\u00a0<em>V. cholerae</em>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are correctly matched except:",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio parahaemolyticus - Food poisoning"
      },
      {
        "id": 2,
        "text": "Vibrio alginolyticus - Infections of the eyes, ears and wounds"
      },
      {
        "id": 3,
        "text": "Vibrio vulnificus - Dysentery"
      },
      {
        "id": 4,
        "text": "Vibrio cholerae - Watery diarrhea"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong><em>Vibrio vulnificus</em></strong> causes\u00a0<strong>wound infection</strong> following\u00a0contact of open wounds with sea water.\u00a0</p>\n<p>In <strong>immunocompromised</strong> hosts, and particularly those\u00a0with <strong>liver disease</strong>, it penetrates the gut mucosa following ingestion. It may not cause any gastrointestinal manifestations and directly enters the bloodstream, leading to the rapid development of\u00a0<strong>septicemia</strong> with high\u00a0mortality.</p>\n<p>Other options:</p>\n<p>Option A: <em>V. parahaemolyticus</em>\u00a0causes <strong>food poisoning</strong> associated with marine food. It also causes <strong>acute diarrhea</strong>, unassociated with food poisoning.</p>\n<p>Option B: <em>V. alginolyticus</em>\u00a0has been associated with <strong>infections</strong> of the eyes, ears, and wounds in human beings <strong>exposed</strong> to <strong>seawater</strong>.</p>\n<p>Option D: Cholera is caused by <em>V. cholerae</em> via its toxin but it does not cause dysentery which is characterized by bloody diarrhea. It is mainly associated with watery diarrhea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 17-year-old presents to you with complaints of passing loose stools. Given below are the findings of his stool microscopy. Infection with which of the following bacteria would you consider in your differential diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Shigella dysenteriae"
      },
      {
        "id": 2,
        "text": "Campylobacter jejuni"
      },
      {
        "id": 3,
        "text": "Escherichia coli"
      },
      {
        "id": 4,
        "text": "Bacillus cereus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clip shows <strong>darting motility</strong> which is seen in <em>Vibrio cholerae</em> and <strong><em>Campylobacter jejuni</em></strong>. Thus, among the given options, infection with <em>C. jejuni</em> should be considered as a differential diagnosis in this case.</p>\n<p><em>Campylobacter jejuni</em> possesses a single polar flagellum, hence it exhibits\u00a0darting motility.</p>\n<p><em>Shigella dysenteriae</em> is a non-motile organism.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e0d1b772f13c4e4aad165baad91deb5b.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A young man presented with complaints of a tingling sensation in his hands and feet. He also complains of weakness in his legs that is slowly spreading to his upper body. He had an episode of bloody diarrhea 10 days ago.  Which of the following organisms is the likely cause of this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio cholerae"
      },
      {
        "id": 2,
        "text": "Campylobacter jejuni"
      },
      {
        "id": 3,
        "text": "Leptospira interrogans"
      },
      {
        "id": 4,
        "text": "Helicobacter pylori"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Guillain-Barre syndrome is an acute, <strong>fulminant polyradiculoneuropathy</strong> that is autoimmune in nature. In C. jejuni infection, <strong>bacterial lipopolysaccharide</strong> triggers an autoimmune response against axons via molecular mimicry, hence causing GBS. Other organisms associated with GBS include cytomegalovirus, M. pneumonia, and Epstein-Barr virus.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bfe21334648f49aea2e74fc220c6683fx720x490.JPEG"
    ]
  },
  {
    "text": "A young man presented with bloody diarrhoea, abdominal pain, and fever. Lab investigations showed leucocytosis and stool microscopy revealed RBCs and leucocytes. Darkfield microscopy showed a bacteria having darting motility. Which of the following is a selective culture medium for this organism?",
    "choices": [
      {
        "id": 1,
        "text": "Skirrow\u2019s media"
      },
      {
        "id": 2,
        "text": "PLET medium"
      },
      {
        "id": 3,
        "text": "BSK medium"
      },
      {
        "id": 4,
        "text": "BCYE medium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of fever, <strong>bloody diarrhea</strong>, abdominal pain and\u00a0<strong>leucocytosis</strong> alongwith microscopy findings of RBCs and WBCs in fecal smear, and organism having <strong>darting motility</strong> are suggestive of infection with <strong><em>Campylobacter jejuni</em></strong>.\u00a0The<strong> selective</strong>\u00a0<strong>culture medium</strong> used for <em>Campylobacter</em> is\u00a0<strong>Skirrow\u2019s</strong> media.</p>\n<p>Other <strong>selective</strong> media for <em>Campylobacter</em> include:</p>\n<ul>\n<li><strong>Butzler's</strong>\u00a0medium</li>\n<li><strong>Campy-BAP </strong>media</li>\n</ul>\n<p>The <strong>transport</strong> medium used for <em>Campylobacter</em> is\u00a0the<strong> Cary-Blair</strong> medium.\u00a0<strong><br /></strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the organism & the stain seen in the image given below.",
    "choices": [
      {
        "id": 1,
        "text": "Campylobacter jejuni; Gimenez stain"
      },
      {
        "id": 2,
        "text": "Helicobacter pylori; modified Giemsa stain"
      },
      {
        "id": 3,
        "text": "Treponema pallidum; Levaditi stain"
      },
      {
        "id": 4,
        "text": "Helicobacter pylori; Warthin-Starry stain"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows<em> <strong>Helicobacter pylori</strong></em>&nbsp;stained using&nbsp;<strong>Warthin-Starry stain.</strong></p>\n<div class=\"page\" title=\"Page 2\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><em>H.pylori</em> is a Gram-negative&nbsp;spiral rod that is motile by a unipolar tuft of<strong> lophotrichous&nbsp;flagella</strong>.&nbsp;The bacteria are <strong>present</strong> only in the<strong>&nbsp;mucus overlying the gastric mucosa</strong>&nbsp;and&nbsp;do not actually invade into the mucosa.</p>\n<p>The given image shows <em>Helicobacter pylori </em>on gastric mucosa stained with Warthin-Starry silver stain.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a94c5863467c4872aabb5408d3813726.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cead9762ea846d78bdd623d995529b8x1280x1156.JPEG"
    ]
  },
  {
    "text": "Which of the following organisms produce urease?",
    "choices": [
      {
        "id": 1,
        "text": "Helicobacter  pylori"
      },
      {
        "id": 2,
        "text": "Salmonella"
      },
      {
        "id": 3,
        "text": "Escherichia coli"
      },
      {
        "id": 4,
        "text": "Shigella"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><em>Helicobacter pylori</em></strong>\u00a0produces urease.</p>\n<p><strong>Urease-producing organisms:</strong>\u00a0(Mnemonic-PUNCH)</p>\n<ul>\n<li><em><strong>P</strong>roteus</em></li>\n<li><em><strong>U</strong>reaplasma urealyticum</em></li>\n<li><em><strong>N</strong>ocardia</em></li>\n<li><em><strong>C</strong>ryptococcus,\u00a0<strong>C</strong>orynebacterium urealyticum</em></li>\n<li><em><strong>H</strong>. pylori</em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a surgery resident evaluating a 45-year-old female patient with complaints of burning abdominal pain for the past 2 months that is relieved on taking food. You determine the disease to have a bacterial etiology. Which of the following is the most sensitive test to detect the causative organism here?",
    "choices": [
      {
        "id": 1,
        "text": "Culture"
      },
      {
        "id": 2,
        "text": "Serology"
      },
      {
        "id": 3,
        "text": "Urea breath test"
      },
      {
        "id": 4,
        "text": "Histology"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given case scenario is suggestive of a duodenal ulcer caused by&nbsp;<em><strong>Helicobacter pylori.&nbsp;</strong></em>The<strong>&nbsp;urea breath test</strong>&nbsp;is the<strong> most sensitive</strong> <strong>test</strong> for the diagnosis of <em>Helicobacter pylori </em>infection.</p>\n<p>To perform this test, the patient drinks a <strong>urea solution</strong>&nbsp;labelled with <strong>radioactive carbon-14</strong>. The patient then blows into a tube. If <em>H. pylori</em> <strong>urease</strong> is <strong>present,</strong> the urea is hydrolyzed, and <strong>labelled carbon dioxide</strong> is detected in<strong> breath samples</strong>. The <strong>sensitivity</strong> of the urea breath test is <strong>&gt;90%</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '14 Vibrio And Campylobacterales';
        const quizFilename = '14-vibrio-and-campylobacterales-2fc8d5e6.html';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>