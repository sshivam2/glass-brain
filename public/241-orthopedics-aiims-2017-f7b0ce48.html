<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>241 Orthopedics Aiims 2017 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Orthopedics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 5 year old boy fell on his outstretched hand. X-ray is shown below. Which of the following vessel is most commonly affected?",
    "choices": [
      {
        "id": 1,
        "text": "Radial artery"
      },
      {
        "id": 2,
        "text": "Brachial  artery"
      },
      {
        "id": 3,
        "text": "Ulnar artery"
      },
      {
        "id": 4,
        "text": "Cubital vein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other delayed complications:</p>\n<ul>\n<li>Malunion - <strong>Cubitus varus / Gunstock deformity</strong></li>\n<li>Volkmann&rsquo;s ischaemic contracture</li>\n<li>Myositis ossificans</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/73f90b093f974518b0a0824993bae5fb.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/ed4c2e49e9a04e6ca856dd26b04dad91x339x208.JPEG"
    ]
  },
  {
    "text": "True regarding Galeazzi fracture-dislocation:",
    "choices": [
      {
        "id": 1,
        "text": "Radial collateral ligament tear with interosseous membrane tear with radial shaft fracture"
      },
      {
        "id": 2,
        "text": "Interosseous membrane tear with ulnar shaft fracture"
      },
      {
        "id": 3,
        "text": "Interosseous membrane tear with triangular fibrocartilage complex (TFCC) tear and radial shaft fracture"
      },
      {
        "id": 4,
        "text": "Interosseous membrane tear with triangular fibrocartilage complex (TFCC) tear and ulnar shaft fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Galeazzi fractures</strong> consist of a<strong> fracture of the radial shaft (lower one-third) with dislocation of the distal radioulnar joint (DRUJ).</strong></p>\n<p><strong>Triangular Fibrocartilage Complex (TFCC)</strong> <br />The TFCC serves as the medial continuation of the distal articular surface of the radius as well as a <strong>static stabilizer of the DRUJ</strong>. <br />It consists of:</p>\n<ul>\n<li>Articular disc</li>\n<li>Dorsal radioulnar ligament - <strong>primary stabilizer</strong></li>\n<li>Palmar radioulnar ligament - <strong>primary stabilizer</strong></li>\n<li>The meniscus homologue</li>\n<li>The ulnar collateral ligament</li>\n<li>The sheath of the extensor carpi ulnaris</li>\n</ul>\n<p>Other options:&nbsp;</p>\n<p><br />Option A: Mentions radial collateral ligament but<strong> TFCC consists of the ulnar collateral ligament</strong>.<br />Options<strong>&nbsp;B</strong>&nbsp;and <strong>D:</strong>&nbsp;Mention ulnar shaft fracture when Galeazzi fracture is a radial shaft fracture.</p>\n<p>Note: Galeazzi # are more common than Monteggia # and may be associated with ulnar nerve damage.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old male presented to the emergency department with pain and swelling of the right knee. The radiograph showed the following finding. What is the best treatment for the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Tension band wiring with K-wires"
      },
      {
        "id": 2,
        "text": "Tension band wiring with cancellous screws"
      },
      {
        "id": 3,
        "text": "Cylinder cast"
      },
      {
        "id": 4,
        "text": "Patellectomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Treatment options for patellar fracture are:</p>\n<ul>\n<li><strong>Undisplaced</strong> patellar fractures&nbsp;with minimal joint incongruity and intact extensor retinaculum -&nbsp;<strong>cylinder cast</strong></li>\n<li><strong>Displaced </strong>patellar fractures&nbsp;-&nbsp;<strong>tension band wiring</strong></li>\n<li><strong>Severely comminuted </strong>fractures&nbsp;with difficulty in reducing fragments -&nbsp;<strong>patellectomy</strong></li>\n</ul>\n<p>Note: Tension band wiring with cancellous screw is done when compressive forces are also needed along with tensile forces to resist the displacement of fractures e.g., olecranon fractures.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/989c0c027acd463cb8619aa438fc12d5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/56c8c439541147aaa3398ecc2c689b07x512x353.PNG"
    ]
  },
  {
    "text": "Which of the following movements is being tested in the picture given below?",
    "choices": [
      {
        "id": 1,
        "text": "Internal rotation of hip"
      },
      {
        "id": 2,
        "text": "Abduction"
      },
      {
        "id": 3,
        "text": "Flexion"
      },
      {
        "id": 4,
        "text": "External rotation of hip"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>External rotation</strong> of <strong>hip</strong> is being tested in the given image.</p>\n<p><strong>Rotatory movements</strong> of the hip joint can be <strong>measured</strong> with the knee flexed or extended. However, more precise measurements are obtained when the rotation is tested with the flexed knee. The procedure involves the following steps.</p>\n<ul>\n<li>The patient is made to lie supine.</li>\n<li>The examiner holds the knee with one hand and ankle with the other hand.</li>\n<li>The <strong>knee</strong> and <strong>hip</strong> are flexed to <strong>90 degrees</strong>.</li>\n<li>Rotation movement is produced at the hip joint by stabilising the knee and moving the leg as the lever.</li>\n<li>If the hip is rotated such that the <strong>leg</strong>&nbsp;<strong>moves</strong> <strong>medially</strong>,&nbsp;<strong>external</strong> <strong>rotation</strong> of the hip occurs.</li>\n<li>If the hip is rotated such that the <strong>leg moves laterally, internal rotation</strong> of the hip occurs.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c038ce4d03d47cd90a6a8060326b9df.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9ccb51070ca5422d89b944d0b7c7e439x1280x1396.JPEG"
    ]
  },
  {
    "text": "Which is the classification system used for the fracture shown in the x-ray given below?",
    "choices": [
      {
        "id": 1,
        "text": "Schatzker classification"
      },
      {
        "id": 2,
        "text": "Ideberg classification"
      },
      {
        "id": 3,
        "text": "Neer classification"
      },
      {
        "id": 4,
        "text": "Gartland classification"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Other options</p>\n<p>Option A: The <strong>Schatzker classification</strong> is a method of classifying<strong> tibial plateau fractures</strong>.</p>\n<p>Option B: The<strong> Ideberg classification</strong> is a method of classification of <strong>intra-articular glenoid fossa fractures</strong>.</p>\n<p>Option D:&nbsp;The <strong>Gartland classification</strong> is a method of classification of <strong>supracondylar fractures </strong>of the&nbsp;<strong>humerus</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1160d702a77f4942b1f466619bf6d3cc.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/90f7be2afab54949998c499fe44c4637x315x480.PNG"
    ]
  },
  {
    "text": "An elderly male presented with a history of fall on outstretched hand following which he developed swelling of the wrist. His X-ray is shown below. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Fracture scaphoid"
      },
      {
        "id": 2,
        "text": "Fracture scaphoid with perilunate dislocation"
      },
      {
        "id": 3,
        "text": "Fracture hamate"
      },
      {
        "id": 4,
        "text": "Fracture capitate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above X-ray shows <strong>fracture scaphoid.</strong></p>\n<p>Scaphoid fractures account for almost 75 percent of all carpal fractures although they are rare in the elderly and in children.</p>\n<p><strong>Mechanism of injury-</strong>&nbsp;The combination of forced carpal movement and compression, as in a <strong>fall on the dorsiflexed hand.</strong></p>\n<p><strong>Diagnostic sign-&nbsp;</strong>precisely localized <strong>tenderness in the anatomical snuff box.&nbsp;</strong></p>\n<p><strong>X-ray-</strong></p>\n<ul>\n<li>Anteroposterior, lateral and oblique views are all essential</li>\n<li>often a recent fracture shows only in the oblique view.</li>\n<li>Usually, the fracture line is transverse, and through the narrowest part of the bone (waist), but it may be more proximally situated (proximal pole fracture).<br />Old, un-united fractures have hard borders, making it seem as if there is an extra carpal bone.</li>\n<li>Relative sclerosis of the proximal fragment is pathognomonic of avascular necrosis.</li>\n</ul>\n<p>NOTE:&nbsp;The distal fragment, unrestrained by the scapholunate ligament, flexes and the proximal fragment tilt dorsally with the lunate (a DISI deformity). The hump-backed deformity of the scaphoid is permanent.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/def3f4a21f2d48f5a5422a23f5fde44f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Gustillo anderson classification type IIIb is?",
    "choices": [
      {
        "id": 1,
        "text": "Open fracture, wound more than 1 cm , less than 10 cm in length without extensive soft tissue damage, flaps, avulsions"
      },
      {
        "id": 2,
        "text": "Open fracture, wound less than 1 cm in length without extensive soft tissue damage, flaps, avulsions"
      },
      {
        "id": 3,
        "text": "Open fracture, wound more than 10 cm in length with extensive soft tissue loss and periosteal stripping and bone damage"
      },
      {
        "id": 4,
        "text": "Open facture, wound more than 10 cm in length associated with an arterial injury"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An open fracture with a wound with extensive soft tissue loss and <strong>periosteal stripping and bone damage belongs to classification IIIB.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An overweight man (90 kg) presented with complaints of not being able to squat and rest pain of left hip for 6 months duration. He had a past history of steroid and creatine use. His X-ray revealed destruction of the articular surface of femoral head with the presence of subchondral cysts and positive crescent sign. His MRI is suggestive of marrow edema. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculosis of hip"
      },
      {
        "id": 2,
        "text": "Fracture neck of femur"
      },
      {
        "id": 3,
        "text": "Osteochondroma of femur"
      },
      {
        "id": 4,
        "text": "Osteonecrosis of femoral head"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C: <strong>Osteochondromas</strong>&nbsp;are common<strong>&nbsp;benign</strong>&nbsp;bone tumors commonly present in adolescents. The lesions consist of a&nbsp;<strong>bony mass</strong>, often in the form of a&nbsp;<strong>stalk,</strong>&nbsp;produced by endochondral ossification of a growing&nbsp;<strong>cartilaginous cap</strong>.&nbsp;They are usually&nbsp;<strong>painless.&nbsp;</strong>The common sites of involvement are the distal femur, proximal tibia, and proximal humerus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/37c402a14c13441ba538e63b1315447cx1279x1354.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/09439c340ba64f2a8ccad9fe29829eaax720x1067.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6440c253a4c14c718b7bbc5eb7e6b042x1280x1010.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33b504f740dd43569bd070531a67a3dfx720x1299.JPEG"
    ]
  },
  {
    "text": "All of the following are associated with Sprengel shoulder except?",
    "choices": [
      {
        "id": 1,
        "text": "Diastematomyelia"
      },
      {
        "id": 2,
        "text": "Klippelfeil syndrome"
      },
      {
        "id": 3,
        "text": "Dextrocardia"
      },
      {
        "id": 4,
        "text": "Congenital scoliosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Dextrocardia is not associated with Sprengel deformity.</p>\n<p>Sprengel deformity is the <strong>congenital elevation of the scapula. </strong>It is the<strong> most common congenital shoulder abnormality.</strong></p>\n<p>The scapula is abnormally small and too high. Sometimes the clavicle is affected as well. Shoulder movements may be restricted and on abduction or elevation, the scapula moves very little or not at all.</p>\n<p>Sprengel&rsquo;s deformity may be associated with other defects of the cervical spine (e.g. <strong>Klippel&ndash;Feil syndrome</strong>), and high thoracic kyphosis or <strong>scoliosis</strong> is quite common.</p>\n<p>The high scapula may still be attached to the spine by a tough \ufb01brous band or a cartilaginous bar (the omovertebral bar). Associated vertebral or rib anomalies are quite common.</p>\n<p>An unappreciated association between Sprengel anomaly and <strong>diastematomyelia</strong> (congenital splitting of spinal cord)<strong>&nbsp;</strong>of the lumbar spine also raises questions about the embryologic origin of the scapula.</p>\n<p><strong>Associations of Sprengel deformity of Shoulder</strong></p>\n<ul>\n<li>Klippel-Feil Syndrome</li>\n<li>Spina Bifida and Diastematomyelia</li>\n<li>Kyphosis or Scoliosis</li>\n<li>Torticollis</li>\n<li>Underdevelopment of clavicle or humerus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man with a POP cast for forearm fracture is prescribed analgesics. The earliest way to check for compartment syndrome is to look for:",
    "choices": [
      {
        "id": 1,
        "text": "Disappearance of pulse by displacing the cast"
      },
      {
        "id": 2,
        "text": "Discolouration of fingers"
      },
      {
        "id": 3,
        "text": "Decreased response to analgesics"
      },
      {
        "id": 4,
        "text": "Odour and discharge"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Decreased response to analgesia&nbsp;&rarr;</strong>&nbsp;suspect <strong>compartment syndrome</strong>.</p>\n<p>Pain is the most <strong>common initial</strong> <strong>symptom</strong> in case of compartment syndrome. Red flags&nbsp;for compartment syndrome&nbsp;are&nbsp;<strong>pain out of proportion with the injury</strong>, and&nbsp;<strong>pain on passive stretch of&nbsp;</strong><strong>the&nbsp;digits</strong>.</p>\n<p>Later signs include <strong>pallor, paresthesia, paralysis, and pulselessness. </strong></p>\n<p>As the<strong>&nbsp;ischemia occurs at capillary level </strong>in compartment syndrome, pulses may still be felt and skin may not appear pale.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about the posterior cruciate ligament:",
    "choices": [
      {
        "id": 1,
        "text": "Extra synovial"
      },
      {
        "id": 2,
        "text": "Prevent the posterior displacement of tibia"
      },
      {
        "id": 3,
        "text": "Primary action is to prevent the internal rotation of knee joint"
      },
      {
        "id": 4,
        "text": "Attached to anterolateral aspect of medial condyle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>lateral</strong> collateral ligament, not\u00a0the posterior, is responsible for preventing the internal rotation of the knee joint</p>\n<p>The <strong>posterior cruciate ligament (PCL</strong>) is an intra-articular but <strong>extra-synovial structure </strong>because of the presence of a synovial sheath that lines the ligament. It is the only <strong>primary restraint</strong> to <strong>posterior translation </strong>throughout the entire <strong>knee range of motion. </strong>It prevents the internal rotation of the tibia on the femur when there is varus stress on the knee.</p>\n<p>It acts as a <strong>secondary restraint</strong> to valgus/varus, e<strong>xternal rotation.</strong></p>\n<table style=\"width: 368px;\">\n<tbody>\n<tr>\n<td style=\"width: 184px;\"><strong>Anterior cruciate ligament</strong></td>\n<td style=\"width: 178px;\"><strong>Posterior cruciate ligament</strong></td>\n</tr>\n<tr>\n<td style=\"width: 184px;\">Attached to anterior part of the intercondylar area of tibia</td>\n<td style=\"width: 178px;\">Posterior part of intercondylar area of tibia</td>\n</tr>\n<tr>\n<td style=\"width: 184px;\">Direction \u2013 Upwards, backwards &amp; laterally &amp; attached to posterior aspect of medial surface of lateral condyle.</td>\n<td style=\"width: 178px;\">Upwards, forwards &amp; medially &amp; attached to the anterior aspect of the lateral surface of the medial condyle.</td>\n</tr>\n<tr>\n<td style=\"width: 184px;\">Prevents posterior dislocation of femur on tibia and forwards dislocation of tibia on femur.</td>\n<td style=\"width: 178px;\">Prevents anterior dislocation of femur on tibia and posterior dislocation of tibia on femur</td>\n</tr>\n<tr>\n<td style=\"width: 184px;\">Limits hyperextension of knee joint(taut during extension)</td>\n<td style=\"width: 178px;\">Limits hyperflexion of knee joint. (taut during flexion)</td>\n</tr>\n<tr>\n<td style=\"width: 184px;\">Weaker</td>\n<td style=\"width: 178px;\">Stronger</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/b7ed049bf77b484fa8e6839e1c23d896x383x282.PNG"
    ]
  },
  {
    "text": "A patient presented with lower limb weakness. The examiner places one hand under the patient's heel and the patient is then asked to raise his other leg against downward resistance. What is the test being performed?",
    "choices": [
      {
        "id": 1,
        "text": "Hoover\u2019s Test"
      },
      {
        "id": 2,
        "text": "Mc Bride Test"
      },
      {
        "id": 3,
        "text": "Waddell\u2019s Test"
      },
      {
        "id": 4,
        "text": "O\u2019Donoghue\u2019s Test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>The McBride's test, Waddell\u2019s test, </strong>and<strong> O\u2019Donoghue\u2019s test</strong> are other examination techniques that help in distinguishing between organic and non-organic causes of lower back pain.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7fb81ae6b5954f41b3ec1d053c519212x1280x2162.JPEG"
    ]
  },
  {
    "text": "March fracture is seen in the ____ of second metatarsal bone.",
    "choices": [
      {
        "id": 1,
        "text": "Head"
      },
      {
        "id": 2,
        "text": "Neck"
      },
      {
        "id": 3,
        "text": "Shaft"
      },
      {
        "id": 4,
        "text": "Base"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Note: According to Campbell orthopedics (14th edition) in March fractures, patients often note the gradual onset of pain directly over the <strong>second metatarsal neck</strong> region. In\u00a0Uptodate, it is mentioned that many of the stress fractures occur in the <strong>second metatarsal shaft</strong>, <strong>especially </strong>at the <strong>neck</strong>. Hence, neck is considered a more correct answer than shaft.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87918f598bbf4580aee811db44be93dbx720x1499.JPEG"
    ]
  },
  {
    "text": "Identify the  name of the instrument given below:",
    "choices": [
      {
        "id": 1,
        "text": "Bent Hohmann retractor"
      },
      {
        "id": 2,
        "text": "Bone holding forceps"
      },
      {
        "id": 3,
        "text": "Bone distractor"
      },
      {
        "id": 4,
        "text": "Bone curette"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows a bone holding forceps.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4cc1d921faa485085acc7e461f2eb1b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient came to the casualty after a RTA with fracture of femur. On 3rd day of admission, he developed sudden breathlessness. Which of the following is the most common cause?",
    "choices": [
      {
        "id": 1,
        "text": "Hypovolemic shock"
      },
      {
        "id": 2,
        "text": "Pulmonary hypertension"
      },
      {
        "id": 3,
        "text": "Post trauma MI"
      },
      {
        "id": 4,
        "text": "Fat embolism"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>History of <strong>sudden onset breathlessness</strong> on the<strong> 3rd day</strong> of admission after femur fracture should raise suspicion of<strong> fat embolism.</strong></p>\n<p>Fat embolism is the presence of fat globules in vital organs and peripheral circulation after a fracture of the long bone or other major trauma. Its pathogenesis can be related to 2 factors: the <strong>release of free fatty acids</strong> by the action of lipases on the neutral fats and the&nbsp;<strong>actual obstruction</strong> of small pulmonary vessels by fat globules.</p>\n<p class=\"p1\"><strong>Clinical features:</strong></p>\n<ul class=\"ul1\">\n<li class=\"li1\"><strong>Early signs</strong> are&nbsp;<strong>fever </strong>and<strong> tachycardia</strong></li>\n<li class=\"li1\">Presenting features are of 2 types -\n<ul>\n<li class=\"li1\"><strong>Cerebral</strong> type<strong> -</strong>&nbsp;drowsiness, restlessness, disorientation</li>\n<li class=\"li1\"><strong>Pulmonary</strong> type<strong> -</strong>&nbsp;tachypnoea, tachycardia</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Classical<strong> triad&nbsp;</strong>-\n<ul>\n<li>&nbsp;<strong>Respiratory distress</strong></li>\n<li>&nbsp;<strong>Neurological</strong>&nbsp;abnormalities<strong>&nbsp;</strong></li>\n<li><strong>&nbsp;Petechial</strong> hemorrhages</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Pathognomonic signs</strong> are <strong>petechiae on the trunk, </strong>axillae, conjunctival folds, and retina.</li>\n</ul>\n<p><strong>Treatment </strong>of fat embolism is mainly supportive as given below:</p>\n<ul>\n<li>Respiratory support with oxygen</li>\n<li>Heparinization increases lipoprotein lipase activity</li>\n<li>Intravenous low molecular weight dextran</li>\n<li>Corticosteroids to avoid pneumonitis</li>\n<li>Prompt stabilization of long-bone fractures&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hand, knee gait in polio paralysis is due to weakness of the _________.",
    "choices": [
      {
        "id": 1,
        "text": "Popliteus"
      },
      {
        "id": 2,
        "text": "Quadriceps"
      },
      {
        "id": 3,
        "text": "Gastro-soleus"
      },
      {
        "id": 4,
        "text": "Gluteus maximus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Polio <strong>commonly affects the quadriceps.</strong>&nbsp;The weakness of the quadriceps <strong>leads to the buckling (bending) of the knee</strong> while walking or bearing weight on the leg. So, in order to walk, the person has to prevent the buckling of the knee by <strong>supporting with the hand, producing a hand-knee gait</strong>.</p>\n<p>Few important examination findings in paralytic polio:</p>\n<ul>\n<li><strong>Asymmetric</strong>: involvement of affected muscles is haphazard.</li>\n<li><strong>Most common muscle</strong> affected: Quadriceps, often partially paralyzed.</li>\n<li>Most common muscle to undergo<strong>&nbsp;complete paralysis</strong>: Tibialis anterior</li>\n<li>Most common muscle <strong>in hand</strong>: Opponens pollicis</li>\n<li>Motor paralysis is <strong>not associated with sensory loss</strong>.</li>\n<li>In the knee,&nbsp;<strong>triple deformity</strong> in severe cases<strong>: flexion, posterior subluxation, and external rotation</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common sequela of traumatic dislocation of the shoulder in young adults is_____.",
    "choices": [
      {
        "id": 1,
        "text": "Subscapular tendinitis"
      },
      {
        "id": 2,
        "text": "Rotator cuff injury"
      },
      {
        "id": 3,
        "text": "Recurrent dislocation of shoulder"
      },
      {
        "id": 4,
        "text": "Frozen shoulder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>most common sequela</strong> of traumatic shoulder dislocation in young adults is <strong>recurrent dislocations</strong> of the shoulder joint.</p>\n<p><strong>Traumatic shoulder</strong> <strong>dislocation</strong> is associated with<strong> tear</strong> of the<strong> glenoid labrum</strong> (Bankart lesion). This&nbsp;results in <strong>loss of attachment</strong>&nbsp;of the <strong>inferior glenohumeral ligament</strong>, which is the primary static stabilizer of the shoulder.</p>\n<p>In addition, there is a&nbsp;loss of&nbsp;concavity&nbsp;due to damage to the labrum. Therefore, the <strong>shoulder joint</strong> becomes <strong>unstable</strong>. This predisposes the person to repeated shoulder dislocations. Shoulder instability/recurrent dislocation is an indication for surgical intervention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "After a fracture, the growth of callus will be increased by which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Strict immobilization"
      },
      {
        "id": 2,
        "text": "Repeated tiny movements at the fracture site"
      },
      {
        "id": 3,
        "text": "Intermedullary nail"
      },
      {
        "id": 4,
        "text": "K wire fixation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Micro-movements</strong> at the fracture site <strong>stimulate callus formation</strong>.</p>\n<p>Other options:</p>\n<p>Option A: It is not necessary to immobilize all fractures (e.g., fracture ribs, scapula, etc) as they heal anyway. Some other fractures need strict immobilization (e.g., fracture of the neck of the femur) and may still not heal.</p>\n<p>Options C, D: Kirschner wires (K-wire) and intra-medullary nails are used when a fracture is so unstable that it is difficult to maintain it in an acceptable position by nonoperative means. They are used in order to secure rigid immobilization. They do not affect the growth of the callus directly.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Haglund deformity is seen around which of the following joints?",
    "choices": [
      {
        "id": 1,
        "text": "Knee"
      },
      {
        "id": 2,
        "text": "Ankle"
      },
      {
        "id": 3,
        "text": "Wrist"
      },
      {
        "id": 4,
        "text": "Elbow"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Haglund deformity</strong>, pump bump, or Mulholland deformity is seen around the <strong>ankle joint.&nbsp;</strong>It refers to retrocalcaneal exostosis formed at<strong>&nbsp;</strong>the posterosuperior aspect of the<strong> calcaneum</strong>.</p>\n<p><strong>retrocalcaneal bursa</strong>&nbsp;usually protects the Achilles tendon from the calcaneal tuberosity. But in Haglund deformity, there is chronic inflammation of this retrocalcaneal bursa due to increased or repetitive chafing between the tuberosity and Achilles tendon. Due to prolonged inflammation, degenerative changes occur and osteophytes form within the tendon leading to calcification at the site of the tendon insertion.&nbsp; This leads to deformity and pain symptoms.</p>\n<p>Management is usually conservative, using a heel lift,&nbsp;<strong>silicone pads</strong>&nbsp;in closed shoes, ice application, anti-inflammatory drugs, and stretching exercises of the calf.</p>\n<p>The image below shows the Haglund deformity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/90c7813950b647ee980129f2105252bax512x371.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b31c66c394a0475d9a36c4c2264d1dbcx1280x1358.JPEG"
    ]
  },
  {
    "text": "An elderly patient slipped in the bathroom and sustained injury over the left hip. The radiograph is shown below. His attitude of the leg will be:",
    "choices": [
      {
        "id": 1,
        "text": "Shortened and abducted"
      },
      {
        "id": 2,
        "text": "Lengthened and internally rotated"
      },
      {
        "id": 3,
        "text": "Shortened and externally rotated"
      },
      {
        "id": 4,
        "text": "Flexed, adducted and internally rotated"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The history of fall and hip injury in an elderly patient along with the radiological findings of a broken Shenton's line is suggestive of a<strong>&nbsp;neck of femur fracture.&nbsp;</strong>In this condition, the attitude of the leg will be <strong>shortened </strong>and<strong> externally rotated </strong>and movements of the hip joint will be painful.</p>\n<p><strong>A plain</strong>&nbsp;<strong>radiograph</strong> may show the following features:</p>\n<ul>\n<li>Fracture line in the neck of femur</li>\n<li>External rotation of the femur with the lesser trochanter appearing more prominent</li>\n<li>Displacement of the greater trochanter</li>\n<li>Break in the trabecular stream</li>\n<li>Break in Shenton's line</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49f2c42b7d6d4a24b655b430415fe243.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53e9673a803e46d7aaea91bcdbbb267fx1280x1010.JPEG"
    ]
  }
];
        let quizName = '241 Orthopedics Aiims 2017';
        let hierarchy = ["Marrow", "PYQs", "Orthopedics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>