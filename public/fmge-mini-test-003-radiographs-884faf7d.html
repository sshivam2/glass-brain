<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 003 (Radiographs) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 24-year-old man presents to the emergency department after being punched in the right side of his face. His plain radiograph is shown below. Which of the following bones maximally contributes to the region fractured?",
    "choices": [
      {
        "id": 1,
        "text": "Maxilla"
      },
      {
        "id": 2,
        "text": "Sphenoid bone"
      },
      {
        "id": 3,
        "text": "Palatine bone"
      },
      {
        "id": 4,
        "text": "Zygomatic bone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The plain radiograph shows a <strong>fracture</strong> of the <strong>floor of the orbit</strong>. The maximum contribution to the floor of the orbit is by the\u00a0<strong>maxilla</strong>.</p>\n<p><strong>Boundaries</strong> of the bony orbit:</p>\n<ul>\n<li><strong>Roof:\u00a0</strong>\n<ul>\n<li>The orbital plate of the\u00a0<strong>frontal</strong> bone\u00a0</li>\n<li>Sphenoid bone (small part)</li>\n</ul>\n</li>\n<li><strong>Floor:\u00a0</strong>Thin plate of bone that also forms the roof of the maxillary sinus\n<ul>\n<li>T<strong>he orbital plate of the\u00a0maxilla</strong></li>\n<li>Zygomatic bone (anterolateral)</li>\n<li>Orbital process of palatine bone (posteromedial)</li>\n</ul>\n</li>\n<li><strong>Medial</strong> wall:\n<ul>\n<li><strong>Maxilla</strong></li>\n<li>Lacrimal bone</li>\n<li>Ethmoid bone</li>\n<li>Sphenoid bone</li>\n</ul>\n</li>\n<li><strong>Lateral</strong> wall:\u00a0\n<ul>\n<li><strong>Zygomatic</strong> bone (anterior)</li>\n<li>Greater wing of <strong>sphenoid</strong> (posterior)</li>\n<li>Sphenozygomatic suture.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/23ff18ad3bcd4a11baa09c353b1e1537.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ab75acfa3d524efeb86a9c3c09e55768x1280x1270.JPEG"
    ]
  },
  {
    "text": "Which of the following is not included in the signs and symptoms of the condition represented below?",
    "choices": [
      {
        "id": 1,
        "text": "Mouth breathing"
      },
      {
        "id": 2,
        "text": "Failure to thrive"
      },
      {
        "id": 3,
        "text": "Sleep apnoea"
      },
      {
        "id": 4,
        "text": "Prominent nasolabial fold"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given x-ray shows <strong>enlarged adenoids</strong> and suggests the diagnosis of <strong>adenoid hypertrophy</strong>. Patients show an <strong>absent nasolabial fold</strong>.</p>\n<p>Clinical features:</p>\n<ul>\n<li><strong>Nasal obstruction</strong> is the most common symptom. This leads to <strong>mouth breathing</strong>. Nasal obstruction also interferes with feeding or suckling in a child. As respiration and feeding cannot take place simultaneously, a child with adenoid enlargement <strong>fails to thrive</strong>.</li>\n<li>Nasal discharge, sinusitis, and epistaxis.</li>\n<li>Bilateral conductive hearing loss and <strong>serous otitis media</strong> due to eustachian tube obstruction.</li>\n<li><strong>Rhinolalia clausa</strong> - hyponasal voice.</li>\n<li><strong>Adenoid facies</strong> - elongated face with a dull expression, pinched up nose, <strong>absent nasolabial crease</strong>, open mouth, prominent and crowded upper teeth.</li>\n<li><strong>Sleep apnoea</strong> - chronic cases lead to hypoxemia and pulmonary vasoconstriction. This consequently leads to pulmonary hypertension and cor pulmonale.</li>\n<li><strong>Aprosexia</strong> - lack of concentration.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ee3ea487ffbf42b791ff02a7d5bc3262.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/5ff524698c534cee99df0c96654e9743x503x451.PNG",
      "https://cdn1.dailyrounds.org/uploads/76d9a8e4d298497dacc46010d9e7769cx498x429.JPEG"
    ]
  },
  {
    "text": "An X-ray skull of a patient with marked hypercalcemia is shown below. Which of the following laboratory parameters is consistent with his diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "High alkaline phosphatase and normal ESR"
      },
      {
        "id": 2,
        "text": "High alkaline phosphatase and elevated ESR"
      },
      {
        "id": 3,
        "text": "Normal alkaline phosphatase and normal ESR"
      },
      {
        "id": 4,
        "text": "Normal alkaline phosphatase and elevated ESR"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the above clinical scenario, hypercalcemia along with the skull demonstrating typical '<strong>punched out</strong>' <strong>lesions</strong>&nbsp;is characteristic of multiple myeloma. <strong>Normal</strong> <strong>alkaline phosphatase </strong>and&nbsp;<strong>elevated ESR</strong> are consistent with <strong>multiple myeloma.</strong></p>\n<p>The lesions are <strong>purely osteolytic</strong>&nbsp;with little or no osteoblastic activity. Hence alkaline phosphatase&nbsp;(ALP) is normal.</p>\n<p>The most common site of lytic lesion in multiple myeloma is the vertebral column.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4da808310fde40848df4ac5321b2ded8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The CT finding of a patient is shown below. What is the most common cause for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Rupture of berry aneurysm"
      },
      {
        "id": 2,
        "text": "Injury to bridging dural veins"
      },
      {
        "id": 3,
        "text": "Rupture of cerebral AV malformation"
      },
      {
        "id": 4,
        "text": "Injury to middle meningeal artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image is suggestive of a <strong>subdural hematoma</strong> and it most commonly results from <strong>injury</strong> to the <strong>bridging dural veins</strong>.&nbsp;</p>\n<p>Subdural hematoma refers to the haemorrhage <strong>between</strong> the <strong>dura and arachnoid&nbsp;mater</strong>.&nbsp;The image of the CT scan reveals a hyperdense <strong>crescentic lesion</strong>. Mass effect with midline displacement can also be seen.</p>\n<p>Causes of SDH are:</p>\n<ul>\n<li>Trauma</li>\n<li>Anticoagulants</li>\n<li>Antiplatelets</li>\n<li>Alcohol abuse</li>\n<li>Shaken baby syndrome.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/60c0a23939b74aa191db03b74bac02d0.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 53-year-old man was admitted with a history of a cerebrovascular accident 2 days ago. The patient is drowsy with minimal response. CT finding is shown in the image below. What will be your next line of management?",
    "choices": [
      {
        "id": 1,
        "text": "Aspirin and clopidogrel"
      },
      {
        "id": 2,
        "text": "Mannitol"
      },
      {
        "id": 3,
        "text": "Decompressive surgery"
      },
      {
        "id": 4,
        "text": "Mechanical thrombectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient is having a low GCS with CT showing <strong>significant edema</strong> in the middle cerebral artery (<strong>MCA</strong>)<strong>&nbsp;</strong>territory (at least &gt;50%) along with a <strong>midline shift.</strong> In such cases, due to the risk of brain herniation, the patient needs to be referred for <strong>decompressive neurosurgery</strong>.</p>\n<p>Guidelines for urgent decompression&nbsp;(STATE acronym):</p>\n<ul>\n<li>Score - NIH Stroke scale <strong>(NIHSS) score &gt; 15</strong></li>\n<li>Time&nbsp;<strong>&lt;48h&nbsp;</strong></li>\n<li>Age&nbsp;<strong>18-60 yrs</strong></li>\n<li>Territory infarct&nbsp;&gt;145 cm<sup>3</sup> or <strong>&gt;50% MCA territory</strong></li>\n<li>Expectations - Informed consent that surgery improves survival but the patient may have significant disability.</li>\n</ul>\n<p><strong>Medical management</strong> of brain edema and increased intracranial pressure (ICP)<strong> may not be successful</strong> when significant swelling occurs in the cerebral or cerebellar hemisphere.</p>\n<p>Therefore, a <strong>decompressive craniectomy</strong> should be considered to <strong>relieve the mass effect</strong> of the swollen cerebral or cerebellar hemisphere on the thalamus, brainstem, and network projections to the cortex, which is manifested predominantly by decreased levels of arousal.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/afb545ed41124ed4b9bb7ebf7543b8c6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old HIV-positive man presents with fever for 3 weeks, dry cough, and significant weight loss. His chest X-ray is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcal pneumonia"
      },
      {
        "id": 2,
        "text": "Pneumococcal pneumonia"
      },
      {
        "id": 3,
        "text": "Tuberculosis"
      },
      {
        "id": 4,
        "text": "Pneumocystis jirovecii pneumonia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical picture with features of atypical pneumonia and CXR showing bilateral reticulonodular infiltrates is suggestive of <strong><em>Pneumocystis jirovecii</em> pneumonia.</strong></p>\n<p><em>Pneumocystis jirovecii</em> pneumonia (PCP) is an&nbsp;<strong>HIV/AIDS-defining opportunistic infection</strong>. The clinical manifestations include profound weight loss, fever, dyspnea, and non-productive cough. Chest X-ray shows&nbsp;diffuse infiltrates beginning in the <strong>perihilar region</strong> (characteristic) and atypical manifestations include nodular lesions, cavitary lesions, etc.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1e2783da0a2949d794d2684c45d9fea8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man presents with persistent fever and productive cough for 6 weeks with night sweats and anemia. The following is his CXR. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Carcinoma Lung"
      },
      {
        "id": 2,
        "text": "Tuberculosis"
      },
      {
        "id": 3,
        "text": "Emphysematous bullae"
      },
      {
        "id": 4,
        "text": "Lung abscess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario described along with the&nbsp;chest X-ray image showing<strong> air-fluid level</strong> is suggestive of a<strong>&nbsp;lung abscess</strong>.</p>\n<p>The patients usually present with complaints of fever, cough with sputum production, and chest pain. Patients with putrid lung abscesses may report foul-smelling sputum. Patients with chronic lung abscesses usually have a history of <strong>night sweats, fatigue, and anemia.</strong></p>\n<p><strong>On physical examination</strong>:</p>\n<ul>\n<li>Poor dentition/gingival disease</li>\n<li>Amphoric and/or cavernous breath sounds on lung auscultation</li>\n<li>Digital clubbing</li>\n<li>The absence of a gag reflex</li>\n</ul>\n<p><strong>CXR features of lung abscess:</strong></p>\n<ul>\n<li>A lung cavity with an air-fluid level</li>\n<li>The cavity wall is thick and irregular, and a surrounding pulmonary-infiltrate is often present</li>\n<li>Computed tomography (CT) is more sensitive than chest radiography and is used to detect small cavities</li>\n</ul>\n<p>The two x-ray images given below show thick-walled cavities with air-fluid levels on lateral and PA views respectively.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3503cb9dbcd54ff8a869a9db805caade.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f43b3bae31474f25a8d16af8e5e76e2ex624x1150.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/032da72a34064443be803fb65cb6905ax1280x960.PNG"
    ]
  },
  {
    "text": "The spinal x-ray of a patient with elevated ALP levels is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Paget's disease"
      },
      {
        "id": 2,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 3,
        "text": "Osteopetrosis"
      },
      {
        "id": 4,
        "text": "Ankylosing spondylitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above x-ray shows a\u00a0<strong>rugger jersey spine</strong>\u00a0which is a distinct feature of<strong> hyperparathyroidism.\u00a0</strong>It is associated with <strong>elevated</strong> <strong>ALP</strong>.</p>\n<p>It refers to the prominent <strong>hyperdensities</strong> at the <strong>endplates</strong> of successive <strong>vertebrae</strong>, which mimics the striped appearance of a rugby jersey.\u00a0</p>\n<p>Other radiographic changes in hyperparathyroidism are:</p>\n<ul>\n<li>Subperiosteal bone resorption - radial aspects of proximal and middle phalanges of the second<sup>\u00a0</sup>and third<sup>\u00a0</sup>fingers</li>\n<li>Terminal tuft erosion of phalanges or acro-osteolysis</li>\n<li>Osteopenia</li>\n<li>Brown tumors or osteitis fibrosa cystica</li>\n<li>Salt and pepper appearance of skull or pepperpot skull</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/db8ca6a8eeb54950b9075e2da9879781.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0877d7e947ab46099fc3b022518a4f44x720x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00568f021a0b4706bf668e93dca7df62x452x712.JPEG"
    ]
  },
  {
    "text": "A peripherally inserted central catheter line(PICC) was placed in a patient to provide parenteral nutrition. Following the insertion, a chest X-ray was taken, which appeared as shown in the image below. Which of the following is the ideal position of the tip of this catheter?",
    "choices": [
      {
        "id": 1,
        "text": "Subclavian vein"
      },
      {
        "id": 2,
        "text": "Internal jugular vein"
      },
      {
        "id": 3,
        "text": "Superior vena cava"
      },
      {
        "id": 4,
        "text": "Inferior vena cava"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ideal position of the tip of a <strong>peripherally inserted central catheter </strong>(PICC) line, is <strong>superior vena cava.</strong></p>\n<p>Peripherally inserted central catheters&nbsp;are commonly used for providing parenteral nutrition therapy. They are inserted through veins in the upper arm, and guided into the central venous system, such that the <strong>tip</strong> of the catheter enters the <strong>superior vena cava.&nbsp;</strong>A <strong>chest X-ray</strong> is taken to confirm the position of the tip.</p>\n<p><strong>PICC lines</strong> have the advantage of <strong>minimizing inconvenience</strong> to the patients and clinicians. However, if the patient develops thrombophlebitis, the PICC line may be destroyed.</p>\n<p>The image below shows (A) a typical PICC line (B) an illustration showing insertion of PICC line (C) a patient with PICC line inserted through the upper arm.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0708fded2b8342598dd8e602b7c97719.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d8740e4d6ea043beb074152f3db99fecx900x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9ceb1c45d283410f82b7ae81e265e9d8x1024x840.JPEG"
    ]
  },
  {
    "text": "An infant with Edward's syndrome presents with the following radiological finding. Which of the following is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "More common in boys"
      },
      {
        "id": 2,
        "text": "Mostly presents as vomiting within 1 week"
      },
      {
        "id": 3,
        "text": "Erythromycin exposure in the first 2 weeks of life can lead to this condition"
      },
      {
        "id": 4,
        "text": "Palpation of the pyloric olive is pathognomonic  for this condition"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The radiographic image&nbsp;showing the presence of an enlarged <strong>gastric gas bubble (single bubble) </strong>is suggestive of<strong>&nbsp;congenital hypertrophic pyloric stenosis (CHPS).&nbsp;</strong>It most commonly presents with<strong> non-bilious projectile vomiting </strong>between<strong> 2-8 weeks of age</strong> and is only rarely seen after 13 weeks.</p>\n<p>Hypertrophy of the circular muscle of the pylorus results in constriction and obstruction of the gastric outlet.&nbsp;First-born <strong>male infants</strong> are at the highest risk.</p>\n<p><strong>Risk factors&nbsp;</strong>for congenital hypertrophic pyloric stenosis:</p>\n<ul>\n<li>Turner syndrome</li>\n<li>Edwards syndrome</li>\n<li><strong>Erythromycin</strong> or <strong>azithromycin</strong> exposure in the first 2 weeks of life either orally or via mother's milk.</li>\n</ul>\n<p>Palpation of the <strong>olive-shaped</strong>&nbsp;<strong>mass</strong> in the epigastrium is considered pathognomonic.&nbsp;</p>\n<p><strong>USG</strong> criteria for diagnosing hypertrophic pyloric stenosis - <strong>pyloric</strong> muscle <strong>thickness</strong> of <strong>&gt;3-4 mm</strong> or a pyloric <strong>length</strong> <strong>&gt;15-18 mm</strong> in the presence of functional <strong>gastric outlet obstruction</strong> is diagnostic.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed15e6d347cf419b92c0df7b325734e9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A neonate presented with features of intestinal obstruction. The X-ray showed the following image. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Jejunoileal atresia"
      },
      {
        "id": 2,
        "text": "Esophageal atresia"
      },
      {
        "id": 3,
        "text": "Duodenal atresia"
      },
      {
        "id": 4,
        "text": "Colonic atresia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above plain abdominal radiograph shows a typical <strong>double-bubble sign</strong> suggestive of <strong>duodenal atresia.</strong></p>\n<p>The double-bubble represents dilatation of the <strong>stomach</strong> and the <strong>proximal duodenum.</strong></p>\n<p>The most common cause of <strong>neonatal intestinal obstruction</strong> is <strong>duodenal atresia.&nbsp;</strong>The incidence is 1 in 6000 to 10,000 live births.&nbsp;Duodenal atresia is thought to occur as a result of the failure of vacuolization of the duodenum from its solid cord stage.</p>\n<p>It is associated with several conditions, such as:</p>\n<ul>\n<li>Prematurity</li>\n<li>Down's syndrome</li>\n<li>Maternal polyhydramnios</li>\n<li>Malrotation</li>\n<li>Annular pancreas</li>\n<li>Biliary atresia.&nbsp;</li>\n</ul>\n<p>The duodenal obstruction is distal to the ampulla of Vater in most cases therefore the infant infants present with<strong> bilious vomiting.</strong></p>\n<p>Treatment is by <strong>duodenoduodenostomy</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ee37b00a3ca4409e9d40a013f289c8e4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly lady presents to the trauma care centre following a motor vehicle collision. She complains of chest pain and abdominal pain. On examination, breath sounds are decreased on the right side. X ray chest revealed the following finding. Which of the following statements is false regarding the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Most accurate evaluation of this condition is by VATS"
      },
      {
        "id": 2,
        "text": "Operative repair is indicated in all cases"
      },
      {
        "id": 3,
        "text": "In case of penetrating injury, repair can be done via thoracic incision"
      },
      {
        "id": 4,
        "text": "The defect must be closed with polypropylene sutures"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical history and X-ray image showing obliteration of the diaphragmatic outline are suggestive of <strong>traumatic diaphragmatic injury</strong> in this patient. <strong>Penetrating diaphragmatic injury</strong> must be repaired via the <strong>abdomen</strong> and not the thorax, to rule out penetrating hollow viscus injury.&nbsp;</p>\n<p>Patients with diaphragmatic injury are generally asymptomatic. <strong>Chest X ray after the insertion of a nasogastric tube</strong> may help in identifying the herniation of the stomach in the thoracic cavity. However, the most accurate evaluation is by video assisted thoracoscopy (<strong>VATS</strong>) or laparoscopy. Abdominal contents may get herniated into the chest and get strangulated later. This is associated with high mortality. Hence, <strong>operative</strong> <strong>repair</strong> is indicated in all patients. The defect is closed with running 1-0<strong> polypropylene suture</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a6f3d7e77b094136aba4c5ea66f27de4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient was brought to the casualty ward with high fever and pain abdomen.  He had a history of bloody diarrhea for several months. The abdominal X-ray image obtained is shown below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Toxic megacolon"
      },
      {
        "id": 2,
        "text": "Volvulus"
      },
      {
        "id": 3,
        "text": "Intestinal perforation"
      },
      {
        "id": 4,
        "text": "Pneumatosis intestinalis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The probable diagnosis is <strong>toxic megacolon.</strong></p>\n<p>The X-ray image shows a dilated loop of the transverse colon. The <strong>history of bloody diarrhea since many days is highly suggestive of ulcerative colitis</strong>. Sudden onset of fever, abdominal pain with<strong> dilated loops of bowel in a patient </strong>of<strong> ulcerative colitis is highly suggestive of toxic megacolon.</strong></p>\n<p>A plain abdominal X-ray film may indicate the severity of ulcerative colitis in the acute setting and is particularly valuable in demonstrating the development of toxic megacolon.<br />Feces are present only in parts that are normal or only mildly inflamed. Mucosal islands can sometimes be seen. Small bowel loops in the right lower quadrant maybe a sign of severe disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1c210c636eac445d8195daa46577556b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young boy was brought to the casualty with a history of fever and abdominal pain. On examination, he was febrile,pulse rate was 104 beats/min and there was right iliac fossa tenderness.The CT scan image is shown below. Which of the following  signs is not seen in this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Aaron sign"
      },
      {
        "id": 2,
        "text": "Rovsing\u2019s  sign"
      },
      {
        "id": 3,
        "text": "Psoas sign"
      },
      {
        "id": 4,
        "text": "Ballance sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient is diagnosed with <strong>acute appendicitis</strong> based on the clinical presentation and a CT scan revealing an appendix measuring <strong>more than 6 mm. Ballance's sign</strong> is not associated with appendicitis but is observed in cases of a <strong>ruptured spleen.</strong></p>\n<p>Ballance sign is positive if there is a <strong>fixed dullness</strong> to\u00a0percussion\u00a0in the <strong>left flank</strong> and <strong>shifting dullness</strong> to percussion in the <strong>right flank.</strong> The fixed dullness is \u00a0due to the presence of coagulated blood near the lacerated spleen while the shifting dullness is due to the presence of blood in the peritoneal cavity.</p>\n<p>CT signs of appendicitis include <strong>an appendix measuring greater than 6 mm</strong> in diameter, appendicolith and enhancement of its wall with intravenous contrast medium\u00a0 Surrounding inflammatory changes include increased fat attenuation, fluid, phlegmon, caecal thickening, abscess and extraluminal gas.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Aaron sign</strong> is pain or pressure in epigastrium or anterior chest with persistent firm pressure applied to Mcburney point.</p>\n<p>Option B:\u00a0<strong>Rovsing</strong> sign is seen in appendicitis. Deep palpation of the left iliac fossa may cause pain in the right iliac fossa.</p>\n<p>Option C: The <strong>Psoas sign</strong> is seen in appendicitis. Occasionally, an in\ufb02amed appendix lies on the psoas muscle, and the patient, often a young adult, will lie with the right hip \ufb02exed, for pain relief.</p>\n<p>Note: CT axial cuts are viewed from below to top and thus appendix is on the left of the CT image.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/992cfa7ecc2b46b38035da154c322cb6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3379a845a6994da684dbd79ac2c0e907x1280x1564.JPEG"
    ]
  },
  {
    "text": "A 45-year-old woman is incidentally found to have a lesion in the right lobe of the liver during an abdominal ultrasound. CECT showed the presence of a well-defined hypodense lesion with asymmetrical nodular peripheral enhancement. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatic adenoma"
      },
      {
        "id": 2,
        "text": "Focal nodular hyperplasia"
      },
      {
        "id": 3,
        "text": "Hamartoma"
      },
      {
        "id": 4,
        "text": "Hemangioma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>CECT abdomen showing&nbsp;a well-defined hypodense lesion in the liver with&nbsp;asymmetrical nodular peripheral enhancement is characteristic of&nbsp;<strong>hemangioma</strong>.</p>\n<p>Hemangioma is a<strong> benign </strong>tumor composed of increased proliferation of<strong> blood vessels. </strong>It is the <strong>most common</strong> benign tumor of the liver and is mainly seen in <strong>women</strong> at a mean age of 45 years.</p>\n<p>Small capillary hemangiomas are of no clinical significance.&nbsp;They are usually solitary, &lt;5 cm in diameter, with equal occurrence in the right and left halves of the liver. However,&nbsp;<strong>giant hemangiomas</strong> of diameter <strong>&gt;5 cm </strong>require attention.&nbsp;</p>\n<p>They are most commonly<strong> asymptomatic</strong> and incidentally found in imaging studies. Large compressive masses may cause vague upper abdominal symptoms.&nbsp;The appearance of hepatic hemangioma in a contrast-enhanced CT scan is as follows:</p>\n<ul>\n<li>Non-contrast phase: Well-defined hypodense lesion</li>\n<li>Arterial phase: Peripheral nodular enhancement</li>\n<li>Washout phase: Homogenous enhancement.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5839156639f84b46bfdb662c7007c047.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image below shows the hysterosalpingogram of a 37-year-old nulliparous woman. Identify the false statement about this finding.",
    "choices": [
      {
        "id": 1,
        "text": "It is a thick walled structure on sonography"
      },
      {
        "id": 2,
        "text": "It can be asymptomatic"
      },
      {
        "id": 3,
        "text": "Tubal plicae are flattened on histology"
      },
      {
        "id": 4,
        "text": "Sequelae of pelvic inflammatory disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>bilateral hydrosalpinx</strong>. It appears as a<strong> thin-walled</strong>&nbsp;structure.&nbsp;</p>\n<p>A hydrosalpinx is a&nbsp;chronic cystic swelling of the fallopian tube that forms after a distal tubal obstruction.&nbsp;The tubes are enormously distended due to filling with clear serous fluid and become&nbsp;<strong>retort-shaped. </strong>On histology, the<strong> tubal plicae</strong> appear <strong>flattened.</strong>&nbsp;The interstitial end of the tube is open whereas the fimbrial end is indrawn and closed. This permits the <strong>dye</strong> to <strong>enter</strong> but <strong>not exit</strong> the tube during HSG.&nbsp;</p>\n<p>It is caused due to:&nbsp;</p>\n<ul>\n<li>Pelvic inflammatory disease&nbsp;</li>\n<li>Endometriosis&nbsp;</li>\n<li>Tuberculosis - tubercular salpingitis may also cause tobacco-pouch appearance, lead pipe appearance and pyosalpinx</li>\n<li>Fallopian tube neoplasms (rare)</li>\n</ul>\n<p>It can be an incidental finding during a pelvic exam or ultrasound. The patient may be&nbsp;<strong>asymptomatic,</strong>&nbsp;or present with infertility or chronic pelvic pain<strong>.</strong>&nbsp;</p>\n<p>On HSG, it appears as&nbsp;<strong>terminal sacculation </strong>and<strong> occlusion </strong>of both <strong>fallopian tubes </strong>with a normal uterine cavity. Usually, a&nbsp;<strong>thin-walled,</strong> hypoechoic, cystic structure is seen. However, it may appear as&nbsp;multiple hyperechoic mural nodules around the inner circumference of the tube creating a 'beads on a string' appearance.</p>\n<p>Treatment:</p>\n<ul>\n<li>Treat the underlying cause</li>\n<li>Laparoscopic salpingostomy - in mild disease&nbsp;</li>\n<li>IVF recommended for women with infertility and severe hydrosalpinx</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37889df2d70941639a21b941ef079c56.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4c8d71f448b4482bfe9bf4611b77760x510x411.GIF"
    ]
  },
  {
    "text": "A 60-year-old woman presented with post-menopausal bleeding. Ultrasonography revealed a mass with feeding vessel as shown in the image below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Fibroid uterus"
      },
      {
        "id": 2,
        "text": "Endometrial polyp"
      },
      {
        "id": 3,
        "text": "Endometrial carcinoma"
      },
      {
        "id": 4,
        "text": "Leiomyosarcoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">Visualisation of a <strong>feeding vessel</strong> on ultrasonography is characteristic of an&nbsp;<strong>endometrial polyp</strong>.</p>\n<p class=\"p1\"><strong>Ultrasonography </strong>shows&nbsp;endometrial polyps, which are<strong>&nbsp;</strong><strong>homogeneous, isoechoic</strong> to and continuous with the endometrium and preserve the endomyometrial interface. They may be centrally cystic, corresponding to dilated, fluid-filled glands. <strong>Colour Doppler</strong> usually reveals a characteristic <strong>feeding vessel.</strong></p>\n<p class=\"p1\">&nbsp;Benign endometrial polyps commonly occur at all ages, with their greatest prevalence after age 50. They are a common cause of <strong>postmenopausal bleeding.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/146ea38d60144ec0a4f1b8ededddc80e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman presents to the OG clinic with complaints of lower abdominal pain and mild bleeding per vaginum for 2 days at 12 weeks of gestation.  She also complains of excessive vomiting for one week. USG was done and it is given below.  What is the probable diagnosis____",
    "choices": [
      {
        "id": 1,
        "text": "Missed abortion"
      },
      {
        "id": 2,
        "text": "Complete mole"
      },
      {
        "id": 3,
        "text": "Partial mole"
      },
      {
        "id": 4,
        "text": "Choriocarcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical picture along with the image is suggestive of <strong>complete mole.</strong>&nbsp; The USG image shows the characteristic <strong>&ldquo;snowstorm&rdquo; appearance</strong> seen in complete mole<strong>. </strong>Notably, a fetus and amnionic sac are absent.&nbsp;</p>\n<p><span data-preserver-spaces=\"true\">Molar pregnancy may present with bleeding per vaginum or an acute discharge of</span><strong><span data-preserver-spaces=\"true\">&nbsp;vesicular mass per vaginum</span></strong><span data-preserver-spaces=\"true\">. On examination, the</span><strong><span data-preserver-spaces=\"true\">&nbsp;uterine size is more</span></strong><span data-preserver-spaces=\"true\">&nbsp;than the corresponding period of amenorrhea. It shows a&nbsp;characteristic<strong>&nbsp;snowstorm</strong>&nbsp;appearance on USG.&nbsp;</span>&nbsp;</p>\n<p><strong>Suction&nbsp;</strong>and<strong>&nbsp;evacuation</strong>&nbsp;is the treatment of choice. Here post evacuation,&nbsp;<strong>Intrauterine devices</strong>&nbsp;are<strong>&nbsp;not recommended during&nbsp;</strong>the<strong>&nbsp;period&nbsp;</strong>of<strong>&nbsp;surveillance.&nbsp;</strong>This is because there is increased risk of&nbsp;<strong>perforation</strong>&nbsp;during this period if an&nbsp;<strong>invasive mole</strong>&nbsp;is present.</p>\n<p>Post-evacuation recommendations:</p>\n<ul>\n<li>Anti-D immune globulin if Rh D-negative</li>\n<li>Initiate effective contraception (IUD contraindicated)</li>\n<li>Review pathology report</li>\n<li>Serum hCG levels: within 48 h of evacuation, weekly until undetectable, then monthly for 6 months.</li>\n</ul>\n<p>Pregnancy is allowed after 6 months following a negative hCG titer.</p>\n<p><strong>Snowstorms in radiology</strong>:</p>\n<ul>\n<li>Complete hydatiform mole (ultrasound)</li>\n<li>Extracapsular breast implant rupture (ultrasound)</li>\n<li>Thyroid pulmonary metastases (chest radiograph)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/54f07445d80442c98fdf1c0c1537eae1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman conceived after being treated for infertility. Her USG scan is given below. What is her diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dichorionic diamniotic twins"
      },
      {
        "id": 2,
        "text": "Monochorionic diamniotic twins"
      },
      {
        "id": 3,
        "text": "Monochorionic monoamniotic twins"
      },
      {
        "id": 4,
        "text": "Singleton pregnancy with uterine septum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows the <strong>twin peak sign</strong> which is seen in <strong>dichorionic</strong> <strong>diamniotic</strong> twins. This is also known as the\u00a0<strong>lambda</strong> sign or delta sign.</p>\n<p>In dichorionic twins, the <strong>intervening</strong> <strong>membrane</strong> between the twins has <strong>4 layers</strong> i.e. 2 chorions and 2 amnions. The placenta protrudes from the base to the space between the 2 amnion layers. This gives rise to the twin peak sign i.e. <strong>triangle</strong> with the <strong>base</strong> at <strong>placenta</strong> and <strong>apex</strong> in the intervening membrane.</p>\n<p>The lambda sign:\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ff898a147d46493ab20c324cf8d5d730.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/23edce51fedc411082b4cf4bf4fcfb53x1000x864.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d960c492c424637a219dc944e41e606x1280x1693.JPEG"
    ]
  },
  {
    "text": "A 3 hour old born at 30 weeks of gestation, develops respiratory grunting. The X-ray taken is seen below. Diagnosis is:",
    "choices": [
      {
        "id": 1,
        "text": "Hyaline membrane disease"
      },
      {
        "id": 2,
        "text": "Transient tachypnea of newborn"
      },
      {
        "id": 3,
        "text": "Meconium aspiration syndrome"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Respiratory distress syndrome/Hyaline membrane disease <strong>occurs primarily in premature infants </strong>(as the baby in this case) due to surfactant deficiency in the alveoli.</p>\n<p><strong>Surfactant</strong>, produced by <strong>type II alveolar cells</strong> prevents the alveoli from collapsing during expiration, by reducing the <strong>surface tension.</strong></p>\n<p>Deficiency of surfactant ---&gt; Alveolar collapse---&gt; Inadequate oxygenation---&gt;increased work of breathing---&gt; hypoxemia and acidosis---&gt;pulmonary vasoconstriction ---&gt; right to left shunting ---&gt;worsening hypoxemia and respiratory failure.</p>\n<p>The Chest X-ray shows (as seen above):</p>\n<ul>\n<li>Fine reticulogranular pattern</li>\n<li>Bilateral <strong>diffuse ground glass opacities</strong></li>\n<li>Air bronchograms</li>\n</ul>\n<p><strong>White out lung</strong>&nbsp;is seen in <strong>severe disease.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3e17b4cfd03d4ced85446ee049556313.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy presented with abdominal pain and constipation. Erect X-ray scan of the abdomen showed the following picture. The most likely diagnosis is ____.",
    "choices": [
      {
        "id": 1,
        "text": "Intussusception"
      },
      {
        "id": 2,
        "text": "Gastric volvulus"
      },
      {
        "id": 3,
        "text": "Sigmoid volvulus"
      },
      {
        "id": 4,
        "text": "Hypertrophic pyloric stenosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sigmoid volvulus </strong>occurs when the sigmoid colon twists on the sigmoid mesocolon. It is a cause of large bowel obstruction.</p>\n<p>Erect X-ray scan of the abdomen characteristically shows the <strong>&ldquo;coffee bean&rdquo; sign</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1366b27001d4d8cb22c3bc673e4816b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 7 month old baby who has recently started solid food presented with irritability and red currant jelly stools . USG abdomen  is shown below. What is the diagnosis ?",
    "choices": [
      {
        "id": 1,
        "text": "Sigmoid volvulus"
      },
      {
        "id": 2,
        "text": "Meckel's diverticulum"
      },
      {
        "id": 3,
        "text": "Appendicitis"
      },
      {
        "id": 4,
        "text": "Intussusception"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenorio of a&nbsp; child with currant jelly stools , irrtitability (pain abdomen) and <strong>target sign</strong> on USG is suggestive of <strong>intussusception.</strong></p>\n<p>Intussusception is the<strong> telescoping </strong>of the<strong> proximal segment </strong>of a part of intestine <strong>into the distal segment. </strong>It is a common cause of<strong> intestinal obstruction </strong>in children between 3 months to 6 years of age.</p>\n<p>Common risk factors include weaning to solid foods, vaccination, rotavirus infection, Meckel's diverticulum.</p>\n<p>Early reduction with air insufflation or saline under USG guidance or barium contrast is advised. Necrosis of bowel segment necessitates surgical resection.</p>\n<p>NOTE : The radiological finding of circle within a circle in intussusception on USG is called target sign or&nbsp;<strong>doughnut sign.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b7c0fb1f7ad24e7cb893635bd7d95086.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A term baby born after a prolonged labour presented with respiratory distress. X-ray is shown below. What is the diagnosis ?",
    "choices": [
      {
        "id": 1,
        "text": "Respiratory Distress Syndrome"
      },
      {
        "id": 2,
        "text": "Transient Tachypnea of Newborn"
      },
      {
        "id": 3,
        "text": "Meconium Aspiration Syndrome"
      },
      {
        "id": 4,
        "text": "Congenital Diaphragmatic Hernia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above baby with respiratory distress has X-ray findings of hyperinflation and coarse streaking, suggestive of <strong>meconium aspiration syndrome (MAS)</strong>.</p>\n<p>MAS is seen in <strong>term and post-term babies</strong>. Blockade of large and small airways by the aspirated meconium causes <strong>atelectasis</strong> and <strong>emphysema</strong>. Complications include <strong>pneumothorax</strong>, <strong>persistant pulmonary hypertension</strong> and <strong>respiratory failure</strong>.</p>\n<p>Radiological findings in Meconium aspiration syndrome:</p>\n<ul>\n<li>Hyperinflation</li>\n<li>Patchy infiltrates</li>\n<li>Coarse streaking</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7bbbb66c497f48a490ea526086430ca7.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the pathology in the given radiograph.",
    "choices": [
      {
        "id": 1,
        "text": "Normal Total Hip replacement (THR) implant in situ"
      },
      {
        "id": 2,
        "text": "Dislocated Total Hip replacement (THR) from cup"
      },
      {
        "id": 3,
        "text": "Normal bipolar hemiarthroplasty in situ"
      },
      {
        "id": 4,
        "text": "Bipolar Prosthesis with Dislocated  head"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows a post-op x-ray of patient underwent&nbsp;<strong>hemiarthroplasty</strong> of hip with a&nbsp;<strong>bipolar prosthesis</strong>. The&nbsp;femoral head of the prosthesis is clearly seen to be displaced from the normal acetabulum.<br /><br />Whereas in Total hip replacement surgery, both acetabular cup and head of femur are replaced with prosthesis. The post-op x-ray will show acetabular cup and head of femur in the radiograph.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/57c6986c6e594d34b3e421dce667d70a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Pick out the diagnosis.",
    "choices": [
      {
        "id": 1,
        "text": "Costochondritis"
      },
      {
        "id": 2,
        "text": "Spondylolisthesis"
      },
      {
        "id": 3,
        "text": "Cervical rib"
      },
      {
        "id": 4,
        "text": "Rib fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given Xray shows <strong>Cervical rib.</strong></p>\n<p>Patients with a cervical rib usually show a lump and tenderness in the supraclavicular fossa.</p>\n<p>The pallor and paresthesias are due to vascular and neural compressions each respectively.</p>\n<p>Radiogram of the neck is useful in detecting a cervical rib.</p>\n<p><strong>However, the absence of a rib on the x-ray does not rule out the possibility of a cervical rib. CT and MRI are more sensitive.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a3ba481e2d9482aad1a4681bf0be66f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1ce77625f33446fa8cdb0b6d5c9df9dx576x586.JPEG"
    ]
  },
  {
    "text": "A 25-year-old male with marfanoid features presented with sudden onset breathlessness. The patient's chest radiograph is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pneumothorax"
      },
      {
        "id": 2,
        "text": "Pleural effusion"
      },
      {
        "id": 3,
        "text": "Consolidation"
      },
      {
        "id": 4,
        "text": "Fibrosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The X-ray shows left-sided pneumothorax with the partial collapse of the left lung. Best X-ray view to diagnose pneumothorax is <strong>PA view in full expiration</strong>.</p>\n<p>Chest radiograph in spontaneous pneumothorax demonstrates: &nbsp;</p>\n<ul>\n<li>Visible visceral pleural edge is seen as a very thin, sharp white line</li>\n<li>No lung markings are seen peripheral to this line</li>\n<li>The peripheral space is radiolucent compared to the adjacent lung.</li>\n<li>The lung may completely collapse.</li>\n<li>The mediastinum should not shift away from the pneumothorax unless a&nbsp;tension pneumothorax&nbsp;is present.</li>\n<li>Subcutaneous emphysema&nbsp;and&nbsp;pneumomediastinum&nbsp;may also be present.</li>\n<li>The&nbsp;<strong>deep sulcus sign</strong>&nbsp;on a supine chest radiograph is an indication of a&nbsp;pneumothorax. In a supine film (common in the ICU), it may be the only indication of a pneumothorax because air collects anteriorly and basally, within the nondependent portions of the pleural space, as opposed to the apex when the patient is upright. <strong>The costophrenic angle is abnormally deepened when the pleural air collects laterally, producing the deep sulcus sign.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/42e175d199784eda8aa1181de80df958.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/c27586d1465b4a29a09580df5a7e2121x641x650.PNG"
    ]
  },
  {
    "text": "Identify the given pathology:",
    "choices": [
      {
        "id": 1,
        "text": "Hydatid lung"
      },
      {
        "id": 2,
        "text": "Lung abscess"
      },
      {
        "id": 3,
        "text": "Pneumatocele"
      },
      {
        "id": 4,
        "text": "Bulla"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>CT depicts <strong>Water lily sign</strong> or <strong>Camalote sign </strong>of Lung Hydatid cyst.</p>\n<p>The radiographic appearance resembles the <strong>air crescent</strong> of a mycetoma. If there is a disruption of the inner layers, a cavitary lesion results with one or more of the following radiographic features:</p>\n<ul>\n<li>an air-fluid level</li>\n<li>a floating membrane (<strong>water lily sign, Camalote sign</strong>)</li>\n<li>a double wall</li>\n<li>an essentially dry cyst with crumpled membranes lying at its bottom (<strong>rising sun sign, serpent sign</strong>)</li>\n<li>a cyst with all its contents expectorated (<strong>empty cyst sign</strong>).</li>\n</ul>\n<p><strong>Hydatid cysts</strong> result from infection by the Echinococcus, and can result in cyst formation anywhere in the body. There are two main strains which are causing Hydatid cyst:</p>\n<ul>\n<li>Echinococcus granulosus:&nbsp;commoner</li>\n<li>Echinococcus alveolaris/multilocularis: less common but more invasive</li>\n</ul>\n<p><strong>Definitive hosts</strong> are carnivores (e.g. dogs, foxes, cats), and the <strong>intermediate hosts</strong> are most commonly sheep.&nbsp;Humans are accidental host, and the infection occurs by ingesting food contaminated with Echinococcus&nbsp;eggs. Most common location of Hydatid cyst is<strong> liver</strong> followed by the <strong>lung</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/81c3f6e8fbbc483bbe9eed7321fa7045.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The plain X-ray shows a particular pathological change in ribs and is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Coarctation of aorta"
      },
      {
        "id": 2,
        "text": "Rickets"
      },
      {
        "id": 3,
        "text": "ASD"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The X-ray depicts the&nbsp;<strong>inferior rib notching&nbsp;</strong>which is one of the findings in <strong>coarctation of the aorta.</strong></p>\n<p>The most common location of coarctation of the aorta is just <strong>beyond the origin of the left subclavian artery</strong>.</p>\n<ul>\n<li>Plain radiograph findings:\n<ul>\n<li><strong>A figure of 3 sign </strong>(Reverse 3): Contour abnormality of the aorta</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/85c37798cf5740c6b7ffa907458ce5e5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c30e24d3fd5147cfb198f30738c006e4x1024x1024.JPEG"
    ]
  },
  {
    "text": "Following appearance in IVP is caused by ______",
    "choices": [
      {
        "id": 1,
        "text": "Horse shoe kidney"
      },
      {
        "id": 2,
        "text": "Ureterocoele"
      },
      {
        "id": 3,
        "text": "Bladder tumour"
      },
      {
        "id": 4,
        "text": "Posterior urethral valve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image depicts <strong>cobra head/ adder head deformity</strong> in an IVP of bilateral ureteroceles.</p>\n<ul>\n<li>Ureterocoeles represent <strong>congenital dilatation of the distal-most portion of the&nbsp;ureter.</strong> The dilated portion of the ureter may herniate into the bladder secondary to the abnormal structure of vesicoureteric junction (VUJ).</li>\n<li>The cobra head sign (or spring onion sign) refers to <strong>dilatation of the distal ureter</strong>, surrounded by a thin lucent line, which is seen in patients with an adult-type ureterocoele. The cobra head appearance indicates an <strong>uncomplicated ureterocele</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/38d1492519b14289b7af4f0a647af39f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the diagnosis based on the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Uterus didelphys"
      },
      {
        "id": 2,
        "text": "Bicornuate Uterus"
      },
      {
        "id": 3,
        "text": "Unicornuate Uterus"
      },
      {
        "id": 4,
        "text": "Septate uterus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Tha above given image shows the <strong>hysterosalpingogram of a unicornuate uterus.</strong></p>\n<p>Unicornuate uterus on HSG:<br />The endometrial cavity usually assumes a <strong>fusiform (banana type)</strong> shape, tapering at the apex and draining into a <strong>single fallopian tube</strong>. The uterus is generally <strong>shifted off the midline</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4d3ada7cd36474a9efeebef86a1ea34.PNG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 003 (Radiographs)';
        const quizFilename = 'fmge-mini-test-003-radiographs-884faf7d.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>