<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>43 Glomerular Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the minimum amount of proteinuria required to diagnose a patient with nephrotic syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "> 2.5 g/day"
      },
      {
        "id": 2,
        "text": "> 3 g/day"
      },
      {
        "id": 3,
        "text": "> 3.5 g/day"
      },
      {
        "id": 4,
        "text": "> 2.8 g/day"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>minimum</strong> amount of <strong>proteinuria</strong> required to diagnose a patient with <strong>nephrotic syndrome</strong> is <strong>3.5 g/day</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3985946930734aa4b7015dc4a18905abx1280x2264.JPEG"
    ]
  },
  {
    "text": "A 7-year-old girl is brought with complaints of generalized swelling of the body and frothy urine. Urinary examination revealed grade 3 proteinuria and the presence of hyaline and fatty casts. There were no red blood cells in the urine. Which of the following statements about her condition is true?",
    "choices": [
      {
        "id": 1,
        "text": "IgA nephropathy is the likely diagnosis."
      },
      {
        "id": 2,
        "text": "It is associated with low C3 levels."
      },
      {
        "id": 3,
        "text": "No IgG  or C3 deposition is seen on renal biopsy."
      },
      {
        "id": 4,
        "text": "Alport syndrome is the likely diagnosis."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario in this child is strongly suggestive of <strong>nephrotic syndrome</strong> due to minimal change disease <strong>(MCD)</strong>. It is characterized by the <strong>absence</strong> of<strong>&nbsp;immune deposits</strong> on biopsy and histopathological examination.&nbsp;</p>\n<p>It is the <strong>most common cause </strong>of nephrotic syndrome in <strong>children</strong> (peaks between 2&ndash;6 years).</p>\n<p>Biopsy findings of MCD are as follows:</p>\n<div class=\"page\" title=\"Page 922\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Light microscopy - <strong>glomeruli</strong>&nbsp;appear <strong>normal</strong> (hence called 'minimal change')</li>\n<li>Immunofluorescence studies - <strong>no</strong> Ig or complement <strong>deposits</strong></li>\n<li>Electron microscopy - diffuse effacement of foot processes of visceral epithelial cells (<strong>podocytopathy</strong>)</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy is brought for a follow-up visit. He was diagnosed with nephrotic syndrome 3 months ago and had been started on a course of oral prednisolone. During the current visit, no improvement is noted with regards to facial puffiness and urine analysis reveals grade 3 proteinuria. Mutations in all of the following are associated with this condition except:",
    "choices": [
      {
        "id": 1,
        "text": "Nephrin"
      },
      {
        "id": 2,
        "text": "Megalin"
      },
      {
        "id": 3,
        "text": "Alpha-actinin 4"
      },
      {
        "id": 4,
        "text": "Podocin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>steroid-resistant nephrotic syndrome</strong>. It can be caused due to mutations in the following<strong>&nbsp;</strong>components of the glomerular filtration barrier:</p>\n<ul>\n<li><strong>Nephrin</strong>, <strong>podocin</strong> - are molecular components of the slit diaphragm complex</li>\n<li><strong>Alpha-actinin 4</strong> - is a component of the foot process cytoskeleton</li>\n</ul>\n<p><strong>Megalin</strong> is not a component of the glomerular filtration barrier. It is present in proximal convoluted tubular cells. Mutations in megalin may lead to some <strong>proteinuria</strong> but<strong> not nephrotic</strong> syndrome because glomerular filtration of proteins is not affected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 67-year-old man presents with sudden onset flank pain and hematuria. Ultrasound reveals enlargement of both kidneys. He is a known case of membranous nephropathy. What is the likely pathophysiology for his current presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Loss of antithrombin III"
      },
      {
        "id": 2,
        "text": "Increased fibrinogen"
      },
      {
        "id": 3,
        "text": "Factor 5 Leiden mutation"
      },
      {
        "id": 4,
        "text": "Increase in protein C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario in a patient suffering from <strong>membranous nephropathy</strong>, which is a type of&nbsp;<strong>nephrotic </strong>syndrome,<strong>&nbsp;</strong>is suggestive of<strong> renal vein thrombosis. </strong>It is&nbsp;due to the<strong> loss </strong>of <strong>antithrombin III </strong>(an&nbsp;endogenous anticoagulant)&nbsp;in urine.</p>\n<p>Renal vein thrombosis is most often a consequence of a hypercoagulable state. In adults, it is most commonly seen in patients with membranous nephropathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59324b0dbd1747b6bcf8b77e17071ff9x1280x2264.JPEG"
    ]
  },
  {
    "text": "In a patient with  nephrotic syndrome, all of the following are decreased except:",
    "choices": [
      {
        "id": 1,
        "text": "Thyroid-binding globulin"
      },
      {
        "id": 2,
        "text": "Transferrin"
      },
      {
        "id": 3,
        "text": "Fibrinogen"
      },
      {
        "id": 4,
        "text": "Ferritin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>nephrotic</strong> <strong>syndrome</strong>, there is an <strong>increase</strong> in <strong>fibrinogen</strong> levels.</p>\n<p>The following proteins are&nbsp;increased in nephrotic syndrome:</p>\n<ul>\n<li>Fibrinogen</li>\n<li>Lipoproteins - due to increased synthesis</li>\n</ul>\n<p>The following proteins are&nbsp;<strong>decreased</strong> in nephrotic syndrome as a consequence of <strong>selective proteinuria</strong>:</p>\n<ul>\n<li>Albumin - the largest proportion of protein lost in nephrotic syndrome.</li>\n<li><strong>Transferrin</strong></li>\n<li>Cholecalciferol-binding protein</li>\n<li>Thyroxine-binding globulin (<strong>TBG</strong>)</li>\n<li><strong>Ferritin</strong></li>\n<li>Coagulation factors&nbsp;</li>\n<li>Antithrombin III</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with radiologically confirmed reflux nephropathy develops nephrotic-range proteinuria. What is the most likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Membranous glomerulopathy"
      },
      {
        "id": 2,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 3,
        "text": "Nodular glomerulosclerosis"
      },
      {
        "id": 4,
        "text": "Proliferative glomerulonephritis with crescents"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Electron microscopy of FSGS shows:&nbsp;</p>\n<ul>\n<li><strong>Diffuse effacement</strong> of the podocyte foot processes</li>\n<li>Focal detachment and <strong>degeneration</strong> of the <strong>epithelial cells</strong></li>\n<li>Absence of electron-dense deposits</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ca2ad7be4d64fcc94b4720c8606f4c9x1280x1186.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7160217c4ac84522b1093e4f9d92ff7ex1280x1186.JPEG"
    ]
  },
  {
    "text": "Patients diagnosed with which variant of focal segmental glomerulosclerosis are likely to have the worst prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tip variant"
      },
      {
        "id": 2,
        "text": "Collapsing variant"
      },
      {
        "id": 3,
        "text": "Cellular variant"
      },
      {
        "id": 4,
        "text": "Perihilar variant"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;<strong>collapsing variant</strong> of focal segmental glomerulosclerosis (<strong>FSGS</strong>)&nbsp;is associated with the <strong>worst prognosis</strong>.</p>\n<p>There are&nbsp;5 variants&nbsp;of FSGS:&nbsp;</p>\n<ul>\n<li><strong>Collapsing</strong> variant -&nbsp;<strong>poor</strong> prognosis</li>\n<li><strong>Glomerular tip</strong> variant -&nbsp;<strong>good</strong> prognosis</li>\n<li>Cellular variant</li>\n<li>Perihilar variant</li>\n<li>Not otherwise specified - <strong>most common</strong></li>\n</ul>\n<p>Given below is a histological image of collapsing glomerulopathy showing the&nbsp;involvement of the entire glomerular tuft and proliferation of visceral epithelial cells.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec949d2d1fa744f4a1841024835cbc01x1280x1127.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f897c5b1757849bb9f8e0f1a8fff4db9x1280x1381.JPEG"
    ]
  },
  {
    "text": "Given below is an electron microscopy image showing deposits in the kidney. What could be the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Goodpasture syndrome"
      },
      {
        "id": 2,
        "text": "Membranoproliferative glomerulonephritis"
      },
      {
        "id": 3,
        "text": "Membranous nephropathy"
      },
      {
        "id": 4,
        "text": "Minimal change disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Membranous nephropathy is characterized by the <strong>diffuse thickening</strong> of the glomerular <strong>capillary wall. </strong>It is due to the accumulation of deposits containing Ig along the subepithelial side of the basement membrane.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/60387443a4c949e7bb52709e57708567.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6a602ea110644d62b43870ed07d94e42x529x338.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/862779b26c7243f2a170f9e64927cc5ex1280x1268.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man presents with complaints of facial puffiness and frothy urine. Given below is his renal biopsy findings. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Membranous nephropathy"
      },
      {
        "id": 2,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 3,
        "text": "Membranoproliferative nephritis"
      },
      {
        "id": 4,
        "text": "Dense deposit disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Membranous nephropathy is one of the <strong>most common</strong> causes of nephrotic syndrome in the <strong>adults/elderly</strong>. It is a chronic immune-complex-mediated disease.&nbsp;</p>\n<p class=\"ng-binding\">The following image of the glomerulus shows the characteristic spikes. The spikes are formed due to the presence of basement membrane material (have&nbsp;<strong>affinity </strong>to<strong> silver stain</strong>) in between the immune complex deposits (<strong>lack</strong> <strong>affinity</strong> to silver stain).</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/039a373ac4d94aad85d20e854ee03d9d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20e3ccb588ef4576822cd3363773770ax1280x1171.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6da0f5fcf6e141f39a56e2b1062f3466x1280x1172.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20c0a3d3cf5945f19ea72ab570fc31bcx1280x1189.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/602e1f7681134be2ac85ebcac577ee06x1280x1189.JPEG"
    ]
  },
  {
    "text": "Mesangial deposits are seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 5"
      },
      {
        "id": 2,
        "text": "3, 4, 5"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "1, 2, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Mesangial deposits</strong> are seen in the following conditions:</p>\n<ul>\n<li>IgA nephropathy <strong>(Berger disease)</strong></li>\n<li><strong>Henoch&ndash;Schonlein purpura</strong></li>\n<li><strong>Rapidly progressive&nbsp;glomerulonephritis</strong></li>\n<li>Lupus nephritis classes I and II</li>\n<li>Resolving postinfectious&nbsp; glomerulonephritis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old man presented with complaints of blood in his urine.  Urine analysis was positive for proteins and red cell casts.  A renal biopsy was done as shown below. Immunofluorescence microscopy revealed granular deposits of C3 on either side of the glomerular basement membrane but was negative for IgG,  C1q, and C4. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Membranoproliferative glomerulonephritis\u00a0type 1"
      },
      {
        "id": 2,
        "text": "Membranoproliferative glomerulonephritis type 2"
      },
      {
        "id": 3,
        "text": "Fibrillary glomerulonephritis"
      },
      {
        "id": 4,
        "text": "Rapidly progressive glomerulonephritis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This condition belongs to a group of disorders called C3 glomerulopathies and primarily affects <strong>children</strong> and <strong>young adults</strong>.&nbsp;It&nbsp;is associated with a&nbsp;<strong>dysregulation</strong> in&nbsp;the <strong>alternative complement</strong> <strong>pathway</strong>. It is clinically and morphologically similar to MPGN type 1 but pathogenetically distinct from it.</p>\n<p>In this condition, a circulating autoantibody called&nbsp;<strong>C3 nephritic factor</strong>&nbsp;is present, which&nbsp;<strong>stabilizes&nbsp;</strong>the <strong>C3 convertase&nbsp;</strong>enzyme.&nbsp;The stabilized C3 convertase&nbsp;enhances<strong> C3 activation </strong>and <strong>consumption</strong>&nbsp;causing hypocomplementemia.&nbsp;Patients will have consistently <strong>decreased serum</strong>&nbsp;<strong>C3 </strong>levels<strong>,&nbsp;</strong>but <strong>normal</strong> <strong>C1</strong> and <strong>C4</strong> levels.</p>\n<p>The <strong>prognosis </strong>is<strong> poor</strong>, with about half of these patients progressing to end-stage renal disease <strong>(ESRD)</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3ebaf1cc7944fc2bbaaeeafa653911e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a8a2c088e1584ad3a105f0109ee8627cx1280x1391.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ca3f86d85bb49dab9851b8b442b2f19x1280x1390.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ecf42fbcf92e4f6693223f9cd8063fd1x1280x1330.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ac4142a241d54d55b0e0c99601a32e29x1280x1329.JPEG"
    ]
  },
  {
    "text": "What is the most likely diagnosis based on the given serum electrophoresis image?",
    "choices": [
      {
        "id": 1,
        "text": "Multiple myeloma"
      },
      {
        "id": 2,
        "text": "Tuberculosis"
      },
      {
        "id": 3,
        "text": "Hepatic cirrhosis"
      },
      {
        "id": 4,
        "text": "Nephrotic syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given electrophoresis shows <strong>hypoalbuminemia</strong> and <strong>increased alpha-2 globulin</strong>, which is classically seen in <strong>nephrotic syndrome</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ba2416b811e04838a8e54ea6c7e522fa.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of primary nephritic syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Post-streptococcal glomerulonephritis"
      },
      {
        "id": 2,
        "text": "Diabetic nephropathy"
      },
      {
        "id": 3,
        "text": "IgA nephropathy"
      },
      {
        "id": 4,
        "text": "Membranoproliferative glomerulonephritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>IgA nephropathy </strong>(Berger disease) is the <strong>most common</strong> cause of <strong>primary nephritic syndrome</strong> in the world.</p>\n<div class=\"page\" title=\"Page 903\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Nephritic syndrome\u00a0is characterized by:</p>\n<ul>\n<li>Acute onset of hematuria\u00a0</li>\n<li>Urinalysis - red cell casts\u00a0</li>\n<li>Diminished glomerular filtration rate (GFR) (oliguria)</li>\n<li>Mild to moderate proteinuria</li>\n<li>Hypertension</li>\n<li>Azotemia</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old man is being evaluated for hematuria after UTI. Histopathology showed mesangial widening and endocapillary proliferation. The following finding is seen on immunofluorescence, which was positive for C3 and negative for IgG. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Goodpasture syndrome"
      },
      {
        "id": 2,
        "text": "IgA nephropathy"
      },
      {
        "id": 3,
        "text": "MPGN type I"
      },
      {
        "id": 4,
        "text": "MPGN type 2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> systemic variant </strong>of IgA nephropathy is called<strong> Henoch\u2013Sch\u00f6nlein purpura. </strong>It is\u00a0a disorder of children which presents with similar renal manifestations with characteristic IgA deposits in the mesangium in about one-third of the patients.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b5747047e7d9437590099d0ade5768b3.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5fe8f0fb5ded4459b59ab141165a20c1x1280x1133.JPEG"
    ]
  },
  {
    "text": "A 6-year-old child abruptly develops fever, oliguria, periorbital edema and smoky cola-colored urine 2-weeks after recovery from sore throat. His renal biopsy image is given below. Which of the following statements is false about the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "A rapidly progressive form with oliguria develops in 50% of children"
      },
      {
        "id": 2,
        "text": "It is a form of proliferative glomerulonephritis"
      },
      {
        "id": 3,
        "text": "Granular IgG and C3 deposits are seen on immunofluorescence"
      },
      {
        "id": 4,
        "text": "Dome-shaped subepithelial humps are seen on electron microscopy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 915\">Post-streptococcal glomerulonephritis is a type of <strong>diffuse</strong> <strong>proliferative</strong> glomerulonephritis. It is usually&nbsp;<strong>preceded</strong> by an acute streptococcal <strong>sore throat</strong> or <strong>impetigo</strong>&nbsp;around&nbsp;<strong>1-4 weeks </strong>prior.</div>\n<div class=\"page\" title=\"Page 915\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>It usually presents with features of nephritic syndrome&nbsp;including:</p>\n<ul>\n<li>Hematuria</li>\n<li>Red cell casts in the urine</li>\n<li>Azotemia, oliguria</li>\n<li>Hypertension</li>\n<li>Mild to moderate proteinuria</li>\n<li>Edema</li>\n</ul>\n<p>On microscopy, the following findings are seen:</p>\n<ul>\n<li>Light microscopy - enlarged, hypercellular glomeruli with influx of leucocytes (endocapillary proliferation)</li>\n<li>Electron microscopy - <strong>subepithelial</strong> <strong>humps&nbsp;</strong></li>\n<li>Immunofluorescence - granular IgG and C3 deposits on&nbsp;glomerular basement membrane and mesangium</li>\n</ul>\n<p>Majority (<strong>&gt; 95%</strong>) of affected children <strong>eventually recover</strong> renal function with conservative therapy.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f12cc1a558814f018bb5752c57baf8bb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9fed1dd5a50d488c9a3e7f84c75bbf52x1280x1049.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13f75461996a44b49f80e2f81a527e4fx1280x1050.JPEG"
    ]
  },
  {
    "text": "A pathologist is examining the following renal biopsy specimen. What does it show?",
    "choices": [
      {
        "id": 1,
        "text": "Proliferating  parietal and visceral epithelial  cells and WBCs in Bowman space"
      },
      {
        "id": 2,
        "text": "Diffuse thickening of the glomerular capillary wall"
      },
      {
        "id": 3,
        "text": "Proliferating mesangial cells and increased matrix deposition in the mesangium"
      },
      {
        "id": 4,
        "text": "Proliferation of capillaries with fibrin deposition"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\">RPGN is a type of\u00a0<strong>nephritic</strong> syndrome associated with severe glomerular injury with necrosis and formation of crescents.<strong>\u00a0</strong>It is usually immune-mediated and may be associated with circulating\u00a0anti-neutrophil cytoplasmic antibodies (<strong>ANCAs</strong>), <strong>anti-GBM</strong> antibodies, and antinuclear antibodies (<strong>ANA</strong>).</p>\n<p style=\"text-align: left;\"><strong>Injury</strong> to the glomerular <strong>capillary wall</strong> leads to the escape of <strong>procoagulant</strong> factors\u00a0and cytokines in the <strong>Bowman space</strong>.\u00a0This triggers:</p>\n<ul>\n<li style=\"text-align: left;\"><strong>Proliferation</strong> of glomerular epithelial cells - mostly\u00a0<strong>parietal</strong>, but also some<strong> visceral cells</strong>\u00a0</li>\n<li style=\"text-align: left;\">Recruitment of <strong>leukocytes </strong>and<strong> fibroblasts</strong>\u00a0</li>\n<li style=\"text-align: left;\">Pathognomonic crescents - due to the circumferential accumulation of these cells and fibrin</li>\n</ul>\n<p style=\"text-align: left;\">The <strong>crescents</strong> progressively <strong>compress</strong> the <strong>capillary</strong> tuft. This results in a rapid<strong> decline </strong>of glomerular filtration rate (<strong>GFR</strong>) and, consequently, acute kidney injury (<strong>AKI</strong>). Thus, the degree of crescent formation correlates with the severity and the prognosis of the disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/4dab53d785984102a355f3dac6aa7ab0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1bb74070929c47ae9eb27ad2f0212fb4x1280x1112.JPEG"
    ]
  },
  {
    "text": "A patient with recurrent hemoptysis and renal failure underwent renal biopsy. It revealed the presence of crescents in most of the glomeruli. Immunofluorescence finding is shown in the image below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute post-infectious glomerulonephritis"
      },
      {
        "id": 2,
        "text": "Membranous nephropathy"
      },
      {
        "id": 3,
        "text": "Goodpasture\u2019s syndrome"
      },
      {
        "id": 4,
        "text": "Wegeners granulomatosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Goodpasture's syndrome is an&nbsp;<strong>anti-GBM</strong> (glomerular basement membrane)&nbsp;<strong>antibody</strong>-mediated disease. The antibodies are directed against the non-collagenous portion of the <strong>&alpha;3 chain </strong>of<strong> collagen type IV</strong>. As it is present in both the alveoli and GBM, it usually presents with <strong>pulmonary hemorrhage</strong>&nbsp;and&nbsp;<strong>renal failure</strong>.&nbsp;It makes up about 1/5 of cases of rapidly progressive glomerulonephritis.</p>\n<div class=\"page\" title=\"Page 918\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Crescents</strong> with <strong>linear deposits </strong>of<strong> IgG </strong>and<strong> C3</strong> in the glomerular basement membrane are seen on histopathology.</p>\n<p>Note: Wegener's granulomatosis (granulomatosis with polyangiitis) causes the pauci-immune type of rapidly progressive glomerulonephritis. There is an absence of immune complex deposition on immunofluorescence.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4d1e6cad49ca43608fb3ac5b473a570d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da8d01b4cc2c4ffa8ca671b161e2daa9x1280x1270.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eed715f245be4f9d9f07ce9065e93aeax1280x1270.JPEG"
    ]
  },
  {
    "text": "An 18-year-old otherwise healthy boy presents with complaints of hematuria.  His father has also had similar complaints since childhood. Light microscopy of the renal biopsy specimen showed no abnormalities. Diffuse thinning of the glomerular basement membrane was seen on electron microscopy. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Benign familial hematuria"
      },
      {
        "id": 2,
        "text": "Goodpasture syndrome"
      },
      {
        "id": 3,
        "text": "Alport syndrome"
      },
      {
        "id": 4,
        "text": "Berger's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario with normal findings on light microscopy and <strong>diffuse thinning</strong> of the glomerular <strong>basement membrane</strong>&nbsp;on electron microscopy are highly suggestive of <strong>benign familial hematuria </strong>(thin basement membrane disease).</p>\n<p>It is a type of hereditary nephritis manifested clinically by familial <strong>asymptomatic</strong> <strong>hematuria</strong>.&nbsp;</p>\n<p>The following are the differences between Alport's syndrome and benign familial hematuria.</p>\n<table style=\"height: 510px;\" width=\"409\">\n<tbody>\n<tr>\n<td style=\"width: 129.878px;\">Features</td>\n<td style=\"width: 129.878px;\">Alport's syndrome</td>\n<td style=\"width: 129.965px;\">Benign familial hematuria</td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Inheritance</td>\n<td style=\"width: 129.878px;\">\n<p>X-linked (most common)</p>\n<p>Autosomal inheritance</p>\n</td>\n<td style=\"width: 129.965px;\">Autosomal inheritance</td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Affected protein</td>\n<td style=\"width: 129.878px;\">\n<p>&nbsp;&alpha;5 chain of&nbsp;type IV collagen (Most commonly)</p>\n</td>\n<td style=\"width: 129.965px;\">&alpha;3 or &alpha;4 chains of type IV collagen.</td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Hearing Loss</td>\n<td style=\"width: 129.878px;\">Present</td>\n<td style=\"width: 129.965px;\"><strong>Absent</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Ocular abnormalities</td>\n<td style=\"width: 129.878px;\">Present</td>\n<td style=\"width: 129.965px;\"><strong>Absent</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Progress to end-stage renal disease</td>\n<td style=\"width: 129.878px;\">Yes</td>\n<td style=\"width: 129.965px;\"><strong>No</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Electron microscopy</td>\n<td style=\"width: 129.878px;\"><strong>Irregular</strong> <strong>thickening</strong> and<strong>&nbsp;thinning</strong> of basement membrane&nbsp;\n<p>Splitting and lamination of lamina densa&nbsp;-&nbsp;<strong>basket-weave</strong> appearance&nbsp;</p>\n</td>\n<td style=\"width: 129.965px;\"><strong>Diffuse thinning </strong>of the glomerular basement membrane</td>\n</tr>\n<tr>\n<td style=\"width: 129.878px;\">Prognosis</td>\n<td style=\"width: 129.878px;\">Poor</td>\n<td style=\"width: 129.965px;\"><strong>Good</strong></td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common manifestation of Alport's syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Hematuria"
      },
      {
        "id": 2,
        "text": "Oliguria"
      },
      {
        "id": 3,
        "text": "Deafness"
      },
      {
        "id": 4,
        "text": "Proteinuria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most common</strong> manifestation of Alport syndrome is <strong>gross or microscopic hematuria,</strong> frequently accompanied by <strong>red cell casts</strong>.</p>\n<div class=\"page\" title=\"Page 929\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Proteinuria</strong>&nbsp;and <strong>oliguria</strong> may develop later in the disease, and rarely, nephrotic syndrome develops.&nbsp;The <strong>deafness</strong> may be subtle requiring sensitive testing.</p>\n<p>There are no significant light microscopy changes in Alport syndrome. On electron microscopy, the glomerular basement membrane shows:&nbsp;</p>\n<ul>\n<li><strong>Irregular</strong> foci of <strong>thickening</strong>, alternating with attenuation (<strong>thinning</strong>)</li>\n<li>Pronounced splitting and lamination of the lamina densa&nbsp;-<strong>&nbsp;basket-weave</strong> appearance &nbsp;</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9425f5a7cc74affb27adea28e505770x1280x1195.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e4c4fe8451b4d799e3e97807dde64eex1280x1195.JPEG"
    ]
  },
  {
    "text": "A middle-aged male patient has proteinuria. Looking at the immunofluorescence image below, what is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Focal segmental glomerulosclerosis (FSGS)"
      },
      {
        "id": 2,
        "text": "Post-streptococcal glomerulonephritis (PSGN)"
      },
      {
        "id": 3,
        "text": "Good pasture syndrome"
      },
      {
        "id": 4,
        "text": "Lupus nephritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given immunofluorescence staining of the kidney biopsy specimen shows positive staining for fibrinogen, IgG, IgA, IgM, C1q, C3, &lambda; chain, and k light chain. This is known as <strong>full-house effect</strong>. It is seen in <strong>lupus nephritis</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d16093367db746b79496f5cf6f55e9da.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6c5197f2358421984f32332d40dedcdx1280x1137.JPEG"
    ]
  },
  {
    "text": "Urinary albumin excretion of how much is considered as microalbuminuria?",
    "choices": [
      {
        "id": 1,
        "text": "100-150 mg/24 hours"
      },
      {
        "id": 2,
        "text": "151-200 mg/24 hours"
      },
      {
        "id": 3,
        "text": "30-300 mg/24 hours"
      },
      {
        "id": 4,
        "text": "3-30 mg/24 hours"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Urinary albumin excretion in the range of <strong>30&ndash;300 mg/24 hours </strong>is called<strong>&nbsp;microalbuminuria. </strong>It is the hallmark of<strong>&nbsp;early diabetic nephropathy.&nbsp;</strong></p>\n<p>The terms microalbuminuria and macroalbuminuria are no longer used now. Proteinuria is currently classified as:</p>\n<table style=\"height: 285px; width: 413px;\">\n<tbody>\n<tr style=\"height: 15.333335876464844px;\">\n<td style=\"width: 96.2326px; height: 15.3333px; text-align: center;\">\n<p><strong>Type of Proteinuria</strong></p>\n</td>\n<td style=\"width: 118.889px; text-align: center; height: 15.3333px;\">\n<p style=\"text-align: center;\"><strong>&nbsp; Total proteinuria (mg/day)</strong></p>\n</td>\n<td style=\"width: 178.594px; text-align: center; height: 15.3333px;\">\n<p style=\"text-align: center;\"><strong>Albuminuria&nbsp;</strong><strong>(mg/day)</strong></p>\n</td>\n</tr>\n<tr style=\"height: 96px;\">\n<td style=\"width: 96.2326px; height: 96px; text-align: center;\">\n<p>Normal-range</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"width: 118.889px; text-align: center; height: 96px;\">\n<p style=\"text-align: center;\">&lt;150 &nbsp;</p>\n<p style=\"text-align: left;\">Mainly Tamm-Horsfall protein (70-75 mg/day)&nbsp;</p>\n</td>\n<td style=\"width: 178.594px; text-align: center; height: 96px;\">\n<p style=\"text-align: center;\">&lt; 30</p>\n</td>\n</tr>\n<tr style=\"height: 40px;\">\n<td style=\"width: 96.2326px; height: 40px; text-align: center;\">Moderately increased</td>\n<td style=\"width: 118.889px; height: 40px; text-align: center;\">150-500&nbsp;</td>\n<td style=\"width: 178.594px; height: 40px; text-align: center;\">30-300&nbsp;</td>\n</tr>\n<tr style=\"height: 40px;\">\n<td style=\"width: 96.2326px; height: 40px; text-align: center;\">Severely increased</td>\n<td style=\"width: 118.889px; height: 40px; text-align: center;\">&gt; 500&nbsp;</td>\n<td style=\"width: 178.594px; height: 40px; text-align: center;\">&gt; 300 &nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man presented with the blurring of vision. Urine examination showed proteinuria. Fundus examination showed dot and blot hemorrhages, microaneurysms, and cotton wool spots. Histopathology of the kidney was as shown below. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Renal amyloidosis"
      },
      {
        "id": 2,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 3,
        "text": "Kimmelstiel-Wilson disease"
      },
      {
        "id": 4,
        "text": "Lupus nephritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The following renal lesions are encountered in diabetic nephropathy:</p>\n<ul>\n<li><strong>Glomerular </strong>lesions -\n<ul>\n<li>Capillary basement membrane thickening</li>\n<li>Diffuse mesangial sclerosis</li>\n<li>Nodular glomerulosclerosis/ Kimmelstiel&ndash;Wilson disease</li>\n<li>Intercapillary glomerulosclerosis</li>\n</ul>\n</li>\n<li><strong>Renal vascular </strong>lesions&nbsp;- hyaline arteriolosclerosis</li>\n<li><strong>Pyelonephritis</strong>&nbsp;- necrotizing papillitis</li>\n</ul>\n<p>Option A: In amyloidosis, glomerular deposits appear as thickenings of the mesangial matrix, forming interlacing broad ribbons of amyloid.</p>\n<p>Option B: In focal segmental glomerulosclerosis, there is focal and segmental hyalinosis and sclerosis of the capillary wall with lipid droplets in the sclerosed area.</p>\n<p>Option D: In lupus nephritis, immune complex deposits are seen in the mesangium or along the entire basement membrane (wire loop lesions), with mesangial cell proliferation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4eb82f328ee43d9b8613afd98cda1fd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11cdbf5fe79647149447670d4519c2f1x1280x1131.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8811a478c7604b15819986cc1373117ax1280x1131.JPEG"
    ]
  },
  {
    "text": "A 51-year-old male patient came with complaints of hematuria to the clinic. On examination, he was normotensive and had pedal edema. Investigations revealed the patient had no glycosuria and had a creatinine of 9. His renal biopsy is shown below. Which of the following investigations should be done to identify the disease?",
    "choices": [
      {
        "id": 1,
        "text": "ANA"
      },
      {
        "id": 2,
        "text": "Anti GBM antibodies"
      },
      {
        "id": 3,
        "text": "HIV RNA"
      },
      {
        "id": 4,
        "text": "Urine immunoelectrophoresis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"ng-binding\"><strong>Type 1 RPGN</strong> includes&nbsp;renal limited disease&nbsp;and&nbsp;<strong>Goodpasture's</strong>&nbsp;<strong>disease</strong>. In this condition, antibodies are produced against the non-collagenous domain of the<strong> &alpha;3 chain</strong> of <strong>collagen IV</strong> of the GBM.</p>\n<p>Microscopy findings of Goodpasture's disease are:</p>\n<ul>\n<li>Immunofluorescence -&nbsp;<strong>l</strong><strong>inear deposits </strong>of<strong> Ig </strong>and<strong> complement&nbsp;</strong>along the glomerular basement membrane</li>\n<li>Electron microscopy - <strong>wrinkling</strong> of the glomerular basement membrane with&nbsp;<strong>focal disruptions&nbsp;</strong>without any immune complex deposition.</li>\n</ul>\n<p>A variant of Goodpasture's disease with&nbsp;<strong>pulmonary involvement</strong>&nbsp;is known as&nbsp;<strong>Goodpasture's syndrome.</strong></p>\n<p>Option A: ANA testing is done if SLE is suspected. Electron microscopy will show immune complex deposits.</p>\n<p>Option C: HIV RNA testing is done in immunodeficiency syndrome associated with weight loss. Electron microscopy will show diffuse podocyte injury with complete foot process effacement. Tubuloreticular inclusions will be seen in endothelial cells.</p>\n<p>Option D: Urine electrophoresis is done if nephrotic syndrome is suspected.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c506e0d17a449329f529ccd4cf95bea.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75d54a2509d94955929563a40c1e0d4bx1280x1390.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5dd21bfa410a413883265e38b4ecfd71x1280x1390.JPEG"
    ]
  },
  {
    "text": "Membranoproliferative glomerulonephritis is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "1, 2, 3, 4"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "1, 2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Membranoproliferative glomerulonephritis&nbsp;<strong>(MPGN)</strong> is seen in <strong>HIV</strong>, <strong>SLE</strong>, <strong>CLL,</strong> and <strong>Hepatitis B</strong>.</p>\n<p>MPGN is caused due to <strong>immune-mediated</strong> injury. It often presents with a&nbsp;<strong>nephritic-nephrotic picture.</strong></p>\n<p>The causes of MPGN are as follows:</p>\n<ul>\n<li>Primary MPGN (Idiopathic)</li>\n<li>Secondary MPGN\n<ul style=\"list-style-type: circle;\">\n<li>System lupus erythematosus <strong>(SLE)</strong></li>\n<li>&alpha;1-antitrypsin deficiency</li>\n<li>Infections -&nbsp;&nbsp;<strong>hepatitis B</strong>, hepatitis C, <strong>HIV</strong>, schistosomiasis, endocarditis, infected ventriculoatrial shunts, chronic visceral abscesses</li>\n<li>Malignancies - chronic lymphocytic leukemia (<strong>CLL</strong>)</li>\n</ul>\n</li>\n</ul>\n<p>MPGN is characterized by the proliferation of cells predominantly in the mesangium and the capillary loops. Hence it is also called&nbsp;<strong>mesangiocapillary glomerulonephritis</strong>. There are 2 types of MPGN:</p>\n<ul>\n<li><strong>Type</strong>&nbsp;<strong>I&nbsp;</strong>-&nbsp;It&nbsp;is<strong>&nbsp;</strong>characterized by the deposition of immune complexes and mesangiocapillary proliferation.</li>\n<li><strong>Type II </strong>- It is<strong>&nbsp;</strong>now known as&nbsp;<strong>dense-deposit disease. </strong>It&nbsp;belongs to a group of disorders called <strong>C3 glomerulopathies</strong>.</li>\n</ul>\n<p>Light microscopy findings of MPGN are as follows:</p>\n<ul>\n<li><strong>Lobular glomeruli </strong>with proliferating mesangial cells, capillary endothelium, and infiltrating leukocytes <strong>(endocapillary proliferation)</strong></li>\n<li>Duplication of the basement membrane gives a <strong>double contour&nbsp;</strong>or<strong>&nbsp;tram-track </strong>appearance<strong>. </strong>It is&nbsp;especially evident in<strong> silver</strong> or<strong> PAS stains</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f039af743ee4067a0c727cb7b482b29x1280x1391.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1954f94cdc314e7da9931a38553e4f1bx1280x1390.JPEG"
    ]
  }
];
        let quizName = '43 Glomerular Diseases';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>