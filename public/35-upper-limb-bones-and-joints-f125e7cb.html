<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>35 Upper Limb Bones And Joints - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which is the first bone to ossify in the human body?",
    "choices": [
      {
        "id": 1,
        "text": "Humerus"
      },
      {
        "id": 2,
        "text": "Clavicle"
      },
      {
        "id": 3,
        "text": "Scapula"
      },
      {
        "id": 4,
        "text": "Lunate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>clavicle</strong> is the <strong>first bone</strong> to <strong>ossify </strong>in the human body. It occurs by the <strong>5<sup>th</sup>- 6<sup>th</sup> weeks</strong> of intrauterine life.</p>\n<p>The clavicle is a band of condensed mesenchyme in the early embryonic phase.</p>\n<p>At the terminal ends of this band, early <strong>cartilage</strong> transformation (pre-cartilage) takes place. <strong>Intramembranous</strong> centers of ossification appear and fuse in the mesenchyme between them. Hence, it&nbsp;<strong>ossifies partly</strong> in the&nbsp;<strong>membrane</strong> and partly in <strong>cartilage.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false about clavicle?",
    "choices": [
      {
        "id": 1,
        "text": "Ossify partly in membrane and partly in cartilage"
      },
      {
        "id": 2,
        "text": "Transmits part of the weight of upper limb to the axial skeleton"
      },
      {
        "id": 3,
        "text": "It is subcutaneous throughout its length"
      },
      {
        "id": 4,
        "text": "Fractures typically occur at the junction of medial 1/3rd and lateral 2/3rd"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>It is the junction where the 2 <strong>primary ossification</strong> centers <strong>meet.</strong> It is also where the <strong>transition</strong> from antecurve to retro curve begins and is prone to be at <strong>high risk for fractures</strong>.</p>\n<p>The fracture causes the upward displacement of the proximal fragment (sternocleidomastoid) and downward displacement of the distal fragment&nbsp; (pectoralis major and gravity).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f162a386aa384fafbab99c4b9470edbbx1280x920.JPEG"
    ]
  },
  {
    "text": "Which ligament transmits the weight of the upper limb to the axial skeleton?",
    "choices": [
      {
        "id": 1,
        "text": "1,3 and 5"
      },
      {
        "id": 2,
        "text": "1 and 3 only"
      },
      {
        "id": 3,
        "text": "2 and 3 only"
      },
      {
        "id": 4,
        "text": "2, 4 and 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Note:</strong></p>\n<ul>\n<li>Costoclavicular ligament: Transmits weight of the upper limb to the axial skeleton via the clavicle.</li>\n<li>Coracoclavicular ligament: Transmits weight of the upper limb to the clavicle.</li>\n<li>Sternoclavicular ligament : Transmits weight of the upper limb to axial skeleton via clavicle (inferomedially)&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/679151353a914b9baf4f0b2ce75271b5x1280x1203.JPEG"
    ]
  },
  {
    "text": "In a patient with a coracoid fracture, the action of which of the following muscle is not hindered?",
    "choices": [
      {
        "id": 1,
        "text": "Coracobrachialis"
      },
      {
        "id": 2,
        "text": "Short head of biceps"
      },
      {
        "id": 3,
        "text": "Pectoralis minor"
      },
      {
        "id": 4,
        "text": "Long head of triceps"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In a patient with a coracoid fracture, the action of the&nbsp;<strong>long head of triceps</strong>&nbsp;muscle is not hindered. It attaches to the <strong>infraglenoid tubercle</strong> on the <strong>lateral border</strong> of the <strong>scapula</strong>&nbsp;and not the coracoid process.</p>\n<p>Coracoid process&nbsp;attachements:</p>\n<ul>\n<li>Origin: 2 muscles - Coracobrachialis&nbsp;(medially) and short head of biceps&nbsp;(laterally)</li>\n<li>Insertion: 1 muscle - Pectoralis minor</li>\n<li>3 ligaments:&nbsp;\n<ul>\n<li>Coracoacromial</li>\n<li>Coracoclavicular</li>\n<li>Coracohumeral</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91bd6bb900b440d8a9f3415e2470a3a3x1280x1394.JPEG"
    ]
  },
  {
    "text": "A 16-year-old athlete was diagnosed with an isolated avulsion fracture of the lesser tubercle of the humerus. The forceful contraction of which of the following muscles\u200b causes this fracture?",
    "choices": [
      {
        "id": 1,
        "text": "Teres minor"
      },
      {
        "id": 2,
        "text": "Subscapularis"
      },
      {
        "id": 3,
        "text": "Supraspinatus"
      },
      {
        "id": 4,
        "text": "Infraspinatus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, forceful contraction of the&nbsp;<strong>subscapularis</strong> muscle has caused the isolated&nbsp;<strong>avulsion fracture</strong> of the <strong>lesser tubercle</strong> of the <strong>humerus.</strong>&nbsp;</p>\n<p>The subscapularis muscle is inserted on the lesser tubercle of the humerus. Forceful <strong>contraction</strong> of subscapularis muscle to <strong>resist</strong> the <strong>abduction</strong> and <strong>external rotation</strong> of the shoulder may cause the isolated avulsion fracture of the lesser tubercle.</p>\n<p><strong>Rotator cuff muscles</strong></p>\n<table border=\"1\">\n<tbody>\n<tr>\n<td style=\"text-align: center;\">Muscle</td>\n<td style=\"text-align: center;\">Insertion</td>\n</tr>\n<tr>\n<td><strong>S</strong>: Supraspinatus</td>\n<td rowspan=\"3\">Greater tubercle</td>\n</tr>\n<tr>\n<td><strong>I</strong>: Infraspinatus</td>\n</tr>\n<tr>\n<td><strong>T</strong>: Teres Minor</td>\n</tr>\n<tr>\n<td><strong>S</strong>: Subscapularis</td>\n<td>Lesser tubercle</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/89f6776850b94fea889ad69c9ca3c7d0x1280x1420.JPEG"
    ]
  },
  {
    "text": "Which muscle is attached to the floor of the structure marked A?",
    "choices": [
      {
        "id": 1,
        "text": "Latissimus dorsi"
      },
      {
        "id": 2,
        "text": "Teres major"
      },
      {
        "id": 3,
        "text": "Long head of biceps"
      },
      {
        "id": 4,
        "text": "Pectoralis major"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>attachments</strong> of bicipital groove are as follows:</p>\n<ul>\n<li>Lateral lip:&nbsp;Pectoralis major</li>\n<li>Medial lip: Teres major</li>\n<li>Floor:<strong> Latissimus dorsi </strong></li>\n</ul>\n<p>The <strong>contents</strong> of the sulcus are as follows:</p>\n<ul>\n<li>Long head of the biceps</li>\n<li>ascending branch from the anterior circumflex humeral artery</li>\n</ul>\n<p><strong>MEMORY TIP</strong>:</p>\n<p>Remember '<strong>Lady between two majors'</strong>:&nbsp;The lady <strong>(latissimsus dorsi),</strong> in the intertubercular sulcus, lies between the <strong>pectoralis major</strong> laterally, and <strong>teres</strong> <strong>major</strong> medially.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7d96403ac0b441b58196e980d1262e12.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8e632266fa74f3abc5d5a8dc72c335cx1280x1100.JPEG"
    ]
  },
  {
    "text": "Which of the following types of joints is incorrectly matched?",
    "choices": [
      {
        "id": 1,
        "text": "Acromioclavicular joint \u2013 Plane synovial joint"
      },
      {
        "id": 2,
        "text": "Wrist joint - Condyloid joint"
      },
      {
        "id": 3,
        "text": "Sternoclavicular joint \u2013 Hinge joint"
      },
      {
        "id": 4,
        "text": "Intercarpal and midcarpal joint \u2013 Plane synovial joint"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> sternoclavicular joint </strong>is a <strong>synovial sellar</strong> (saddle, or hyperbolic paraboloid) joint, and not a hinge joint.</p>\n<p>It is the only skeletal articulation between the upper limb and the axial skeleton.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b16a043fe76944cd9bcc4f54973649bdx1280x1587.JPEG"
    ]
  },
  {
    "text": "A 25-year-old man comes with sudden pain in his right shoulder. He complains that he is not able to move his right arm. After evaluation, a diagnosis of shoulder dislocation was made. Which of the following statements is false regarding this joint?",
    "choices": [
      {
        "id": 1,
        "text": "The glenohumeral joint\u00a0is the\u00a0most frequently dislocated joint in the body"
      },
      {
        "id": 2,
        "text": "As mobility of the joint increases, stability also increases"
      },
      {
        "id": 3,
        "text": "The shoulder joint dislocation is rare in children"
      },
      {
        "id": 4,
        "text": "Anterior dislocation is more common than a posterior dislocation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>As <strong>mobility increases, stability</strong> is <strong>lost</strong> in a joint. The <strong>glenohumeral joint</strong> is the most <strong>mobile</strong> joint in the body and is very <strong>unstable.</strong></p>\n<p>The glenohumeral joint&nbsp;is the&nbsp;most <strong>frequently dislocated</strong> joint in the body. The shoulder dislocation occurs more commonly in adults&nbsp;and is <strong>rare </strong>in<strong> children</strong>. <strong>Anterior dislocation</strong> is much <strong>more common</strong> than a posterior dislocation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 17-year-old boy presented with instability of the shoulder joint following sports trauma. Injury to all of the following structures may cause this condition except:",
    "choices": [
      {
        "id": 1,
        "text": "Teres major"
      },
      {
        "id": 2,
        "text": "Supraspinatus"
      },
      {
        "id": 3,
        "text": "Tendon of long head of biceps"
      },
      {
        "id": 4,
        "text": "Coracoacromial ligament"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Teres major has no role in maintaining the stability of the shoulder joint.</p>\n<p>The shoulder joint is a <strong>ball and socket joint</strong>. Since the head of the humerus is larger than the glenoid cavity, it is often prone to displacement. However, the stability of the shoulder joint is provided by the following:</p>\n<ul>\n<li><strong>Rotator cuff</strong>: It is formed by blending of tendons of 4 muscles <strong>(SITS)-</strong>\n<ul>\n<li><strong>S</strong>upraspinatus</li>\n<li><strong>I</strong>nfraspinatus</li>\n<li><strong>T</strong>eres minor</li>\n<li><strong>S</strong>ubscapularis</li>\n</ul>\n</li>\n<li><strong>Tendon</strong> of&nbsp;the<strong> long head of biceps</strong>: It passes over the head of the humerus and prevents upward displacement.</li>\n<li><strong>Coracoacromial ligament</strong></li>\n</ul>\n<p>Degeneration or tear of the above structures leads to instability of the shoulder joint.&nbsp;</p>\n<p>The shoulder joint is <strong>least</strong> protected <strong>inferiorly.</strong> The capsule is loose and only one muscle crosses the joint inferiorly, i.e. long head of triceps.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with shoulder dislocation, which of the following muscle action is not hindered?",
    "choices": [
      {
        "id": 1,
        "text": "Teres major"
      },
      {
        "id": 2,
        "text": "Pectoralis minor"
      },
      {
        "id": 3,
        "text": "Subscapularis"
      },
      {
        "id": 4,
        "text": "Deltoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pectoralis minor</strong> has no action at the shoulder joint.</p>\n<p>Its <strong>origin</strong> is from <strong>3,4,5 ribs</strong> near the costochondral junction and <strong>inserts</strong> at the medial border and the upper surface of the <strong>coracoid process</strong>. The pectoralis minor is an <strong>accessory muscle of inspiration</strong>, which stabilizes the scapula by pulling it anteriorly and inferiorly.&nbsp;&nbsp;</p>\n<p>Movements at the shoulder joint:</p>\n<table style=\"height: 236px; width: 483px;\">\n<tbody>\n<tr>\n<td style=\"width: 116px; text-align: center;\"><strong>Movement</strong></td>\n<td style=\"width: 146px; text-align: center;\"><strong>Prime Movers</strong></td>\n<td style=\"width: 203px; text-align: center;\"><strong>Synergists</strong></td>\n</tr>\n<tr>\n<td style=\"width: 116px;\">Flexion</td>\n<td style=\"width: 146px;\">Pectoralis major&nbsp;<br />Deltoid</td>\n<td style=\"width: 203px;\">Coracobracialis</td>\n</tr>\n<tr>\n<td style=\"width: 116px;\">Extension</td>\n<td style=\"width: 146px;\">Deltoid (Spinal part)</td>\n<td style=\"width: 203px;\">Teres major&nbsp;<br />Latissmus dorsi&nbsp;<br />Triceps brachii (Long head)</td>\n</tr>\n<tr>\n<td style=\"width: 116px;\">Abduction</td>\n<td style=\"width: 146px;\">Deltoid</td>\n<td style=\"width: 203px;\">Supraspinatus</td>\n</tr>\n<tr>\n<td style=\"width: 116px;\">Adduction</td>\n<td style=\"width: 146px;\">Pectoralis major&nbsp;<br />Latissmus dorsi</td>\n<td style=\"width: 203px;\">Teres major&nbsp;<br />Triceps brachii (Long head)</td>\n</tr>\n<tr>\n<td style=\"width: 116px;\">Medial rotation</td>\n<td style=\"width: 146px;\">Subscapularis</td>\n<td style=\"width: 203px;\">Pectoralis major&nbsp;<br />Deltoid&nbsp;<br />Latissmus dorsi&nbsp;<br />Teres major</td>\n</tr>\n<tr>\n<td style=\"width: 116px;\">Lateral rotation</td>\n<td style=\"width: 146px;\">Infraspinatus</td>\n<td style=\"width: 203px;\">Teres minor&nbsp;<br />Deltoid</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which movement range is increased at the glenohumeral joint due to the lateral rotation of the humerus?",
    "choices": [
      {
        "id": 1,
        "text": "Adduction"
      },
      {
        "id": 2,
        "text": "Abduction"
      },
      {
        "id": 3,
        "text": "Flexion"
      },
      {
        "id": 4,
        "text": "Extension"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lateral rotation</strong> of the <strong>humerus</strong> increases the range of&nbsp;<strong>abduction</strong>.</p>\n<p>When the arm is abducted <strong>without</strong> rotation, the <strong>greater tubercle</strong> comes in contact with the <strong>coracoacromial arch</strong>, preventing further abduction.</p>\n<p>If the arm is then <strong>laterally rotated</strong> 180&deg;, the tubercles are rotated posteriorly and the more articular surface becomes available to continue elevation. Hence, the <strong>range of abduction</strong> is <strong>increased.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A normal scapulohumeral rhythm is in the ratio of ________",
    "choices": [
      {
        "id": 1,
        "text": "1:1"
      },
      {
        "id": 2,
        "text": "1:2"
      },
      {
        "id": 3,
        "text": "2:1"
      },
      {
        "id": 4,
        "text": "3:1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A normal <strong>scapulohumeral rhythm</strong> is in the ratio of&nbsp;<strong>2:1</strong>.</p>\n<p>Scapulohumeral rhythm<strong>&nbsp;</strong>is<strong>&nbsp;</strong>the ratio of the glenohumeral movement to the scapulothoracic movement during arm elevation.</p>\n<p>For instance, if the arm is abducted to a 90&deg; angle, the glenohumeral elevation is 60&deg; and the scapulothoracic rotation is 30&deg;. Thus, the humerus and scapula move in a 2:1 ratio.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following structure is intracapsular?",
    "choices": [
      {
        "id": 1,
        "text": "Short head of biceps brachii"
      },
      {
        "id": 2,
        "text": "Medial head of triceps brachii"
      },
      {
        "id": 3,
        "text": "Long head of triceps brachii"
      },
      {
        "id": 4,
        "text": "Long head of biceps brachii"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> fibrous capsule</strong>&nbsp;which envelopes the shoulder joint is attached medially to the glenoid neck at a variable distance from the glenoid labrum. The capsule includes the <strong>supraglenoid tubercle,</strong> to which the<strong> long head of</strong> the<strong> biceps</strong> attaches, and which is therefore intracapsular.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71de576a37ac4d72adae5ec190dafab9x1280x1304.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles form the border of rotator interval?",
    "choices": [
      {
        "id": 1,
        "text": "Supraspinatus and subscapularis"
      },
      {
        "id": 2,
        "text": "Supraspinatus and infraspinatus"
      },
      {
        "id": 3,
        "text": "Infraspinatus and teres minor"
      },
      {
        "id": 4,
        "text": "Teres minor and subscapularis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>It is present between the superior edge of the <strong>subscapularis</strong> and the anterior edge of the&nbsp;<strong>supraspinatus</strong> with the <strong>coracoid</strong> as the medial boundary of the interval. It is reinforced by the coracohumeral ligament, the superior glenohumeral ligament, and fibers from the supraspinatus tendon laterally.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/55ce3da9a22f4f55955e591f7ae88705x600x698.JPEG"
    ]
  },
  {
    "text": "Which of the following structures of the scapula is palpable in the infraclavicular fossa?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The part of the scapula marked as \"<strong>A</strong>\" in this image is <strong>palpable</strong> and it is the <strong>coracoid process.</strong></p>\n<p>The apex of the coracoid process lies approximately <strong>2.5cm below</strong> the <strong>clavicle,</strong> immediately lateral to the infraclavicular fossa <strong>(deltopectoral triangle).&nbsp;</strong>Hence, the coracoid process can be palpated below the clavicle.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/05739eab342443de87b2a0f32f27c86a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/513cc844f1b14e08a1acb4ec45330d50x1280x1348.JPEG"
    ]
  },
  {
    "text": "Movements of pronation and supination occurs in all of the following joints except:",
    "choices": [
      {
        "id": 1,
        "text": "Superior radioulnar joint"
      },
      {
        "id": 2,
        "text": "Wrist joint"
      },
      {
        "id": 3,
        "text": "Inferior radioulnar joint"
      },
      {
        "id": 4,
        "text": "Humeroradial joint"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Prono-supination movements do not happen at the radiocarpal (wrist) joint.</p>\n<p><strong>Supination</strong> and<strong> pronation</strong> mainly occur at <strong>3 joints:&nbsp;</strong></p>\n<ul>\n<li>Humeroradial</li>\n<li>Superior&nbsp;radioulnar joints</li>\n<li>Inferior radioulnar joints</li>\n</ul>\n<p>The middle radioulnar joint is a syndesmosis (fibrous) joint that mainly helps bind the radius and ulna together. It also helps in weight transmission from radius towards ulna.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During an intracapsular arthroscopy, which of the following structure cannot be seen?",
    "choices": [
      {
        "id": 1,
        "text": "Coronoid fossa"
      },
      {
        "id": 2,
        "text": "Radial fossa"
      },
      {
        "id": 3,
        "text": "Olecranon fossa"
      },
      {
        "id": 4,
        "text": "Lateral epicondyle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>During the intracapsular arthroscopy,\u00a0the<strong> lateral epicondyle </strong>is not seen since it is<strong>\u00a0extracapsular.</strong></p>\n<p>The capsular ligament of the elbow joint is attached anteriorly just above the coronoid and radial fossa and posteriorly above the olecranon fossa.</p>\n<p>Note: Medial epicondyle is also extracapsular.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a264a0d64d1e4d078ec046020434ede8x1280x1016.JPEG"
    ]
  },
  {
    "text": "What is the normal approximate carrying angle?",
    "choices": [
      {
        "id": 1,
        "text": "0 deg"
      },
      {
        "id": 2,
        "text": "20 deg"
      },
      {
        "id": 3,
        "text": "17 deg"
      },
      {
        "id": 4,
        "text": "23 deg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 1505\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The average<strong> carrying angle</strong>&nbsp;is approximately <strong>17&deg;.</strong></p>\n<p>The carrying angle is the angle defined by the border of the fully<strong> supinated forearm</strong> and the long axis of the <strong>humerus</strong> when the elbow is fully extended.</p>\n<p>It is usually <strong>10&deg;-15&deg;</strong> in <strong>males</strong> and more than <strong>15&deg;</strong> in <strong>females.</strong>&nbsp;The absolute angle <strong>varies</strong> from individual to individual and also increases as age increases.&nbsp;</p>\n<p>In clinics, it's necessary to see the carrying angle of the contralateral side instead of just on a single side. But anything between 5 to 15 degrees is considered normal. The carrying angle is used to identify <strong>varus or valgus</strong> in the elbow joint. It <strong>decreases</strong> in cubitus <strong>varus</strong> and <strong>increases</strong> in cubitus <strong>valgus.</strong></p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bcaf416936854ff18b9bc75eeaef227ax1280x1519.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/347b924174894849a5e1d1f101051c90x1280x1069.JPEG"
    ]
  },
  {
    "text": "The middle radioulnar joint is an example of a:",
    "choices": [
      {
        "id": 1,
        "text": "Plane synovial"
      },
      {
        "id": 2,
        "text": "Primary cartilaginous"
      },
      {
        "id": 3,
        "text": "Secondary cartilaginous"
      },
      {
        "id": 4,
        "text": "Fibrous joint"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The middle radioulnar joint is an example of a <strong>fibrous joint (syndesmosis).</strong></p>\n<p>The radius and ulna are united with each other by<strong> three joints:</strong></p>\n<ul>\n<li><strong>Proximal</strong> (superior) radioulnar joint</li>\n<li><strong>Middle</strong> radioulnar joint</li>\n<li><strong>Distal</strong> (inferior) radioulnar joint</li>\n</ul>\n<p><strong>Proximal</strong> and<strong> distal</strong> radioulnar joints are uniaxial <strong>pivot joints</strong> (synovial) and are involved in pronation and supination movements of the forearm.</p>\n<p>The <strong>middle radioulnar</strong> joint is a <strong>fibrous</strong> joint (syndesmosis).&nbsp;The radius and ulna, in the middle, are connected by two syndesmoses namely:</p>\n<ul>\n<li>The <strong>oblique cord </strong>-&nbsp;extends from&nbsp;the lateral side of the ulnar tuberosity to the radius, distal to the radial tuberosity.</li>\n<li><strong>Interosseous membrane</strong>&nbsp;- a broad, thin collagenous structure, which runs perpendicular to the oblique cord. It extends&nbsp;distomedially between the interosseous borders of the radius and ulna.</li>\n</ul>\n<p><strong>Based </strong>on the <strong>structure</strong>, joints are classified into <strong>three types:</strong></p>\n<ul>\n<li><strong>Fibrous joints</strong>\n<ul>\n<li>Sutures</li>\n<li>Syndesmosis</li>\n<li>Gomphosis</li>\n</ul>\n</li>\n<li><strong>Cartilaginous joints</strong>\n<ul>\n<li>Primary cartilaginous joints or synchondrosis</li>\n<li>Secondary cartilaginous joints or symphysis</li>\n</ul>\n</li>\n<li><strong>Synovial joints</strong>\n<ul>\n<li>Ball-and-socket or spheroidal joints</li>\n<li>Sellar or saddle joints</li>\n<li>Condylar or bicondylar joints</li>\n<li>Ellipsoid joints</li>\n<li>Hinge joints</li>\n<li>Pivot or trochoid joints</li>\n<li>Plane joints</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbeb75025a58437aae430a9220f93e3fx1280x792.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e596a76b7954204a79544f17f1653cbx1280x1587.JPEG"
    ]
  },
  {
    "text": "A golfer hurt himself after he accidentally hit the ground while taking a shot. He has tenderness in the area shown in the image below. On examination, he has pain radiating to his ring and little finger. Which of the following bones is most likely to be fractured?",
    "choices": [
      {
        "id": 1,
        "text": "Triquetrum"
      },
      {
        "id": 2,
        "text": "Pisiform"
      },
      {
        "id": 3,
        "text": "Hook of Hamate"
      },
      {
        "id": 4,
        "text": "Trapezoid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Mnemonic for Carpal Bones -</p>\n<p>She(S) - Scaphoid</p>\n<p>Looks(L) - Lunate</p>\n<p>Too(T) - Triquetral</p>\n<p>Pretty(P) - Pisiform</p>\n<p>Try (T) - Trapezium&nbsp;</p>\n<p>To(T) - Trapezoid</p>\n<p>Catch(C) - Capitate</p>\n<p>Her(H) - Hamate&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bd66c1b187524626829694c162d733d8.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/785b1b0e2ec84fdba60978bb6004eb3ax600x1420.JPEG"
    ]
  },
  {
    "text": "A child falls from his bicycle and injures his hand. On X-ray, a fracture of the first metacarpal bone is noticed. Where is the epiphysis of the affected bone?",
    "choices": [
      {
        "id": 1,
        "text": "At the base"
      },
      {
        "id": 2,
        "text": "At the neck"
      },
      {
        "id": 3,
        "text": "At the head"
      },
      {
        "id": 4,
        "text": "In the shaft"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>epiphysis</strong> of the <strong>first metacarpal&nbsp;</strong>is present at the <strong>base.</strong>&nbsp;All the <strong>other metacarpals</strong> have epiphysis at the<strong> head.</strong></p>\n<p>Features of the <strong>first metacarpal</strong>:</p>\n<ul>\n<li>Epiphysis at the head is an aberrant epiphysis</li>\n<li>It is the shortest and stoutest of all metacarpals</li>\n<li>The palmar (medial) surface is longitudinally concave and divided by a ridge into a larger lateral (anterior) and smaller medial (posterior) part</li>\n<li>The base has a convexo-concave articular surface to make a saddle synovial joint with trapezium</li>\n</ul>\n<p>The first metacarpal <strong>fracture</strong> at the base of the thumb is called <strong>Bennett's fracture.</strong> It is an&nbsp;<strong>intraarticular fracture</strong>&nbsp;that separates the palmar ulnar aspect of the base of the first metacarpal from the rest of the first metacarpal.</p>\n<p>The image below shows a radiograph of a hand at 2.5 years (dorsopalmar projection). Note the early stages of ossification in the epiphyses at the proximal ends (base) of the phalanges and first metacarpal; the distal ends of the remaining metacarpals and radius.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d8269572e6f245358ff3bbf9f578913ex1280x667.JPEG"
    ]
  },
  {
    "text": "All of the following take part in the formation of the wrist joint, except:",
    "choices": [
      {
        "id": 1,
        "text": "Scaphoid"
      },
      {
        "id": 2,
        "text": "Triquetrum"
      },
      {
        "id": 3,
        "text": "Distal end of radius"
      },
      {
        "id": 4,
        "text": "Distal end of ulna"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The distal end of the ulna does not take part in the formation of the radiocarpal joint.</p>\n<p>The radiocarpal joint (Wrist joint) is a <strong>synovial, biaxial, and ellipsoid joint</strong> formed by the articulation of:</p>\n<ul>\n<li>The distal end of the radius</li>\n<li>Articular disc of the triangular fibrocartilage</li>\n<li>Scaphoid,&nbsp;lunate and triquetrum</li>\n</ul>\n<p>In the neutral position of the wrist, only the scaphoid and lunate are in contact with the radius and articular disc; the <strong>triquetrum </strong>comes into apposition with the disc <strong>only </strong>in full <strong>adduction </strong>of the <strong>wrist joint. </strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/39aab30921544dd58775ce27c5042601x1280x1231.JPEG"
    ]
  }
];
        let quizName = '35 Upper Limb Bones And Joints';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>