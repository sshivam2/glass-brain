<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 033 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the Nissl-free zone from where an axon arises from a neuron called?",
    "choices": [
      {
        "id": 1,
        "text": "Initial segment"
      },
      {
        "id": 2,
        "text": "Mesaxon"
      },
      {
        "id": 3,
        "text": "Axon hillock"
      },
      {
        "id": 4,
        "text": "Nodes of Ranvier"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>Nissl-free zone</strong> of a neuron from where an axon arises is called an <strong>axon hillock.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d90141a9077143f5b8ad7e882019d024x1279x999.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca8e654d13d640b1881bf28464cfd5c5x1200x900.JPEG"
    ]
  },
  {
    "text": "A 45-year-old male met with a road traffic accident and is now having multiple episodes of vomiting.On examination , GCS was 10, he was drowsy and his blood pressure is high. Which reflex is responsible for elevated BP in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "J reflex"
      },
      {
        "id": 2,
        "text": "Bainbridge reflex"
      },
      {
        "id": 3,
        "text": "Bezold-Jarisch reflex"
      },
      {
        "id": 4,
        "text": "Cushing's reflex"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Reflex responsible for elevated BP in head injury patient is <strong>Cushing</strong> <strong>reflex.</strong></p>\n<p>As he has h/o head injury with fall in GCS and vomiting there might be associated intracranial bleed and thus the intracranial pressure will be elevated.</p>\n<p>When intracranial pressure is increased, the blood supply to <strong>rostral ventrolateral</strong>\u00a0neurons is compromised, and the local hypoxia and hypercapnia increase the discharge of the central chemoreceptors. The resultant rise in systemic arterial pressure <strong>(Cushing reflex) </strong>tends to restore the blood flow to the medulla.</p>\n<p><strong>Cushing</strong> <strong>reflex</strong> causes a <strong>triad</strong> of symptoms:</p>\n<ul>\n<li>Reflex bradycardia (via arterial baroreceptors)</li>\n<li>Hypertension (with widened pulse pressure)</li>\n<li>Irregular respiration (bradypnea)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following mucopolysaccharidoses with the defective enzyme in each case:",
    "choices": [
      {
        "id": 1,
        "text": "1-C, 2-B, 3-D, 4-A"
      },
      {
        "id": 2,
        "text": "1-B, 2-D, 3-A, 4-C"
      },
      {
        "id": 3,
        "text": "1-A, 2-D, 3-C, 4-B"
      },
      {
        "id": 4,
        "text": "1-B, 2-A, 3-C, 4-D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The option showing&nbsp;<strong>1-B, 2-D 3-A, 4-C&nbsp;</strong>&nbsp;is correctly matched.</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Mucopolysaccharidosis</strong></td>\n<td><strong>Defective enzyme</strong></td>\n</tr>\n<tr>\n<td>1. Hunter syndrome</td>\n<td>B. Iduronate sulfatase</td>\n</tr>\n<tr>\n<td>2. Morquio syndrome B</td>\n<td>D. &beta;-galactosidase</td>\n</tr>\n<tr>\n<td>3. Hurler syndrome</td>\n<td>A. &alpha;-l-Iduronidase</td>\n</tr>\n<tr>\n<td>4. Sanfilippo syndrome A</td>\n<td>C. Heparan sulfate-N-sulfatase</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>Glycosaminoglycans (GAGs) or mucopolysaccharides are complex carbohydrates made up of&nbsp;<strong>amino sugars and uronic acids</strong>. When they are attached to a protein they are referred to as proteoglycans. These proteoglycans make up a large part of the extracellular matrix and connective tissue.</p>\n<p><strong>Defects </strong>in the <strong>enzymes</strong> <strong>that degrade GAGs</strong> result in the <strong>mucopolysaccharidoses</strong> mentioned above. These defects are <strong>commonly inherited</strong>&nbsp;in an <strong>autosomal recessive</strong> pattern. Accumulation of GAGs in the tissue can result in organomegaly, cartilage and bone abnormalities, facial abnormalities, problems with mental development, etc.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child who was stung multiple times after disturbing a bee hive developed symptoms of shock, respiratory failure, and vascular collapse within minutes. Which of the following is the principal mediators of this reaction?",
    "choices": [
      {
        "id": 1,
        "text": "Adrenaline"
      },
      {
        "id": 2,
        "text": "Histamine"
      },
      {
        "id": 3,
        "text": "Dopamine"
      },
      {
        "id": 4,
        "text": "Substance P"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Anaphylaxis following a bee sting is an example of <strong>IgE-mediated</strong> reaction or<strong> Type 1 hypersensitivity </strong>and the principal mediator involved here is <strong>histamine.</strong></p>\n<p><strong>Immediate (Type I) hypersensitivity reactions </strong>refer to allergic reactions or allergies. It is a <strong>rapid</strong> immunologic reaction that is triggered by the binding of an <strong>antigen</strong> to an <strong>IgE antibody</strong> on the <strong>surface of mast cells</strong>. It occurs in a <strong>previously sensitized</strong> individual. These reactions are induced by environmental antigens (allergens) that stimulate strong <strong>TH2 responses</strong> and IgE production in genetically susceptible individuals.\u00a0</p>\n<p>Activation of TH2 cells is mediated by IL-4 and in turn, TH2 cells produce<strong> IL-4, IL-5, and IL-13.</strong> These cytokines act on B cells to stimulate IgE and activation of eosinophils. I<strong>gE coats mast cells</strong> by binding to the <strong>Fc\u03b5RI receptor.</strong> Re-exposure to the allergen leads to cross-linking of the IgE and Fc\u03b5RI which in turn causes activation of mast cells releasing powerful mediators. The principal mediators are:</p>\n<ul>\n<li><strong>Histamine</strong></li>\n<li>Proteases</li>\n<li>Prostaglandins</li>\n<li>Leukotrienes</li>\n<li>Cytokines like TNF, IL-1, and chemokines.</li>\n</ul>\n<p>The clinical manifestations may be local or systemic and range from mildly annoying rhinitis to fatal anaphylaxis. It occurs in two phases:\u00a0</p>\n<ul>\n<li>The <strong>immediate</strong> phase is characterized by <strong>vasodilation, vascular leakage,</strong> <strong>smooth muscle spasm </strong>(in asthma), or glandular secretions. These changes occur within minutes after exposure to an allergen and subside in a<strong> few hours.</strong></li>\n<li><strong>Late-phase</strong> reaction is characterized by infiltration of tissues with <strong>eosinophils, neutrophils,</strong> basophils, monocytes, and CD4+ T cells. Late-phase reaction sets in <strong>2 to 24 hours</strong> later and may last for several days.</li>\n</ul>\n<p>Image: Sequence of events in immediate (type 1) hypersensitivity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/957777893ca84d688544dd560439d13ex1280x2558.JPEG"
    ]
  },
  {
    "text": "Which of the following organisms produces superantigen?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus epidermidis"
      },
      {
        "id": 2,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 3,
        "text": "Clostridium perfringens"
      },
      {
        "id": 4,
        "text": "Vibrio cholera"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong><em>Streptococcus pyogenes</em></strong> produces streptococcal pyrogenic exotoxin (<strong>SPE</strong>), which is a <strong>superantigen.</strong></p>\n<p>Superantigens are protein toxins that <strong>stimulate large numbers of T cells</strong>, irrespective of antigen specificity.&nbsp;They <strong>bind</strong> to the <strong>class II MHC</strong> molecule <strong>outside the peptide-binding groove</strong> and V&beta; region of the TCR.</p>\n<p>Some examples of superantigens are staphylococcal enterotoxins, toxic shock syndrome toxin, and group A streptococcal pyrogenic exotoxin.</p>\n<p>The below image shows the binding of superantigen to T-cell receptor.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/712d6a8ea7f54478896129e1a83cf088x1279x1284.JPEG"
    ]
  },
  {
    "text": "Which of the following is incorrect regarding the first-line drug used in the treatment of Trigeminal neuralgia ?",
    "choices": [
      {
        "id": 1,
        "text": "It can cause leukopenia"
      },
      {
        "id": 2,
        "text": "It is a GABAc receptor modulator"
      },
      {
        "id": 3,
        "text": "It also has anti-epileptic activity"
      },
      {
        "id": 4,
        "text": "It can lead to hyponatremia in the elderly"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Carbamazepine</strong>&nbsp;is the&nbsp;<strong>primary agent</strong>&nbsp;for the treatment of&nbsp;<strong>trigeminal neuralgia</strong><strong>&nbsp;</strong>which is a<strong>&nbsp;Sodium-channel blocker.</strong></p>\n<p>It slows the recovery rate of voltage-activated sodium channels from their <strong>inactivated</strong> state.</p>\n<p>Carbamazepine is most effective in <span style=\"text-decoration: underline;\">complex partial seizures</span>. It is also used in<strong>&nbsp;</strong>GTCS and simple partial seizures, trigeminal and related neuralgias, manic depressive psychosis.</p>\n<p>Carbamazepine <span style=\"text-decoration: underline;\">potentiates the action of antidiuretic hormone (ADH)</span>. It can result in&nbsp;water retention with decreased osmolarity and hyponatremia, especially in elderly patients with cardiac disease.Carbamazepine and oxcarbazepine can cause leukopenia, aplastic anemia, or hepato-toxicity and hyponatremia in the elderly.</p>\n<p>Idiosyncratic blood dyscrasias with carbamazepine, include fatal cases of&nbsp;aplastic anaemia&nbsp;and&nbsp;agranulocytosis.&nbsp;The most common idiosyncratic reaction is an&nbsp;<span style=\"text-decoration: underline;\">erythematous skin rash</span>.&nbsp;It can rarely cause&nbsp;Steven Johnson Syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following best describes the legal term corpus delicti?",
    "choices": [
      {
        "id": 1,
        "text": "Medico legal autopsy"
      },
      {
        "id": 2,
        "text": "The body of offence"
      },
      {
        "id": 3,
        "text": "Criminal negligence"
      },
      {
        "id": 4,
        "text": "Exhumation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Corpus delicti</strong>, also known as the <strong>body of offense,&nbsp;</strong>says that a crime must be proved to have occurred before a person can be convicted of committing that crime.</p>\n<p>The main part of corpus delicti is the establishment of the identity of the dead body and infliction of violence in a particular way, at a particular time and place, by the person or persons charged with a crime and none other.&nbsp;</p>\n<p>A conviction for an offense does not necessarily depend upon the corpus delicti&nbsp;if there are eyewitnesses or strong corroborative evidence.</p>\n<p>In a charge of homicide, it includes:</p>\n<ul>\n<li>Positive identification of the dead body (victim)</li>\n<li>Proof of its death by a criminal act of the accused</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The image depicts",
    "choices": [
      {
        "id": 1,
        "text": "Epley\u2019s maneuver"
      },
      {
        "id": 2,
        "text": "Heimlich maneuver"
      },
      {
        "id": 3,
        "text": "Cottle\u2019s test"
      },
      {
        "id": 4,
        "text": "Trotter\u2019s method"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Image shows <strong>Cottle test</strong> where <strong>cheek is drawn laterally while the patient breathes quietly</strong>. <br />If the nasal airway improves on the test side, the test is positive and indicates abnormality of the vestibular component of nasal valve. <br /><strong>Option A:</strong> Epley&rsquo;s maneuver is used in treatment of <strong>BPPV</strong>. <br /><strong>Option B:</strong> <strong>Heimlich manoeuvre</strong> is followed in <strong>accidental inhalation of foreign body</strong>. Procedure: Stand behind the person and place your arms around his lower chest and give four abdominal thrusts. The residual air in the lungs may dislodge the foreign body providing some airway. <br /><strong>Option D:</strong> <strong>Trotter&rsquo;s method</strong> is used in treatment of <strong>epistaxis</strong>. In Trotter&rsquo;s method patient is made to sit, leaning a little forward over a basin to spit any blood and breathe quietly from the mouth.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/713fe8a87fae461ab37aedb977b941f7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is correct regarding with-the-rule astigmatism?",
    "choices": [
      {
        "id": 1,
        "text": "The horizontal meridian is more myopic."
      },
      {
        "id": 2,
        "text": "The vertical meridian is more myopic."
      },
      {
        "id": 3,
        "text": "The vertical meridian is more hyperopic."
      },
      {
        "id": 4,
        "text": "The horizontal meridian is more hyperopic."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>with-the-rule astigmatism</strong>, the curvature of the <strong>vertical meridian is more than the horizontal meridian</strong>. Greater the curvature, more the myopia. Hence, the vertical meridian is more myopic in with-the-rule astigmatism.</p>\n<p>Note: In normal conditions, the vertical meridian is more curved than the horizontal meridian. Astigmatism that follows this pattern (wherein the vertical curvature is more than the horizontal curvature), is known as with-the-rule astigmatism. Irrespective of the type of with-the-rule astigmatism, the vertical meridian is always more myopic (curved) than the horizontal meridian.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/68b1a0688e5e420ab6b97bacff8a758dx1279x1038.JPEG"
    ]
  },
  {
    "text": "The cornerstone of treatment for a patient of dengue with warning signs is:",
    "choices": [
      {
        "id": 1,
        "text": "IV Fluids"
      },
      {
        "id": 2,
        "text": "Platelets"
      },
      {
        "id": 3,
        "text": "Cryoglobulins"
      },
      {
        "id": 4,
        "text": "FFP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>mainstay</strong> of treatment for a patient of <strong>dengue with warning signs</strong> is <strong>IV fluid</strong>s.</p>\n<p>The main pathology in dengue is plasma leakage resulting in intravascular volume depletion and thereby shock. So, supportive management with continuous infusion of crystalloid IV fluids remains the primary modality of treatment in these patients. And often patients respond well to supportive management.</p>\n<p><strong>Platelet transfusion</strong> is limited to patients with <strong>severe thrombocytopenia (&lt;10,000/mm<sup>3</sup></strong>) and <strong>active bleeding</strong>.</p>\n<p>FFP and cryoglobulins are not the preferred treatment modality in dengue.</p>\n<p><strong>Warning signs</strong> in dengue include\u00a0</p>\n<ul>\n<li><strong>Abdominal pain</strong> or tenderness</li>\n<li>Persistent <strong>vomiting</strong></li>\n<li><strong>Clinical fluid accumulation</strong> (ascites, pleural effusion)</li>\n<li><strong>Mucosal bleeding</strong></li>\n<li>Lethargy or restlessness</li>\n<li>Hepatomegaly &gt;2 cm</li>\n<li>Increase in hematocrit concurrent with a rapid decrease in platelet count</li>\n</ul>\n<p><strong>Inpatient management</strong> is advised for all patients with <strong>dengue with warning signs</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In order to effectively prevent endemic goiter, what is the recommended iodine content in salt at the consumer level?",
    "choices": [
      {
        "id": 1,
        "text": "10 ppm"
      },
      {
        "id": 2,
        "text": "15 ppm"
      },
      {
        "id": 3,
        "text": "20 ppm"
      },
      {
        "id": 4,
        "text": "30 ppm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The recommended level of iodine content in salt\u00a0is <strong>15 ppm</strong> at the\u00a0<strong>consumer</strong> <strong>level</strong> and <strong>30 ppm\u00a0</strong>at the\u00a0<strong>production</strong>\u00a0<strong>level</strong>.</p>\n<p>The iodization of salt is used as a <strong>prophylactic</strong> measure against <strong>endemic goiter</strong>. In India, the level of iodization is fixed under the Prevention of Food Adulteration (PFA) Act.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A study was done to assess nutritional status among young children in rural and urban areas. 30 children in rural and 20 children in urban areas were malnourished. Which of the following tests of significance is the most appropriate in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Chi Square test"
      },
      {
        "id": 2,
        "text": "Paired T test"
      },
      {
        "id": 3,
        "text": "Standard error of the mean"
      },
      {
        "id": 4,
        "text": "ANOVA"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most appropriate test of significance, in this case, is the <strong>c</strong><strong>hi-square test. </strong>It is used to compare <strong>qualitative data</strong>&nbsp;between&nbsp;<strong>2 groups</strong> with independent measures.</p>\n<p>Other options:</p>\n<p>Option B:&nbsp;Paired t-test compares paired data or pre-intervention and post-intervention data of the same group. This doesn't apply here as the groups are not paired.</p>\n<p>Option C:&nbsp;Standard error of the mean is calculated for quantitative data, with measure of central tendency as mean.</p>\n<p>Option D:&nbsp;ANOVA is used to compare more than 2 groups</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old chronic smoker is being evaluated for chronic diarrhea, steatorrhea, and weight loss. On examination, pallor was noted. Peripheral smear revealed macrocytes and hypersegmented neutrophils. Stool examination showed elevated calprotectin and a positive guaiac test. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ulcerative colitis"
      },
      {
        "id": 2,
        "text": "Diverticulitis"
      },
      {
        "id": 3,
        "text": "Crohn\u2019s disease"
      },
      {
        "id": 4,
        "text": "Irritable bowel syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario is suggestive of <strong>Crohn's </strong>disease<strong>&nbsp;</strong>presenting as <strong>jejunoileitis</strong>. This is evidenced by the presence of features of <strong>malabsorption</strong> such as steatorrhea, chronic diarrhea, and vitamin B12 deficiency anemia.</p>\n<p>The&nbsp;<strong>fecal calprotectin</strong>&nbsp;and&nbsp;<strong>lactoferrin</strong>&nbsp;are elevated in&nbsp;<strong>inflammatory conditions</strong>&nbsp;like inflammatory bowel disease, but not in irritable bowel syndrome.&nbsp;</p>\n<p>The&nbsp;<strong>stool</strong> <strong>guaiac test</strong>&nbsp;or&nbsp;guaiac fecal occult blood test&nbsp;(gFOBT) reveals the presence of microscopic levels of blood suggesting <strong>Crohn's</strong> disease. <strong>Gross bleeding</strong> per rectum is more characteristic of <strong>ulcerative colitis.</strong>&nbsp;&nbsp;</p>\n<p>Additionally, <strong>smoking</strong> is a risk factor for Crohn's disease. However, it is a<strong> protective </strong>factor<strong>&nbsp;</strong>in<strong>&nbsp;ulcerative colitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the first presentation of alcoholic liver disease?",
    "choices": [
      {
        "id": 1,
        "text": "Steatohepatitis"
      },
      {
        "id": 2,
        "text": "Fatty infiltration"
      },
      {
        "id": 3,
        "text": "Micronodular cirrhosis"
      },
      {
        "id": 4,
        "text": "Macronodular cirrhosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Fatty infiltration or <strong>Alcoholic Fatty Liver</strong> is the most common and <strong>initial response</strong> to hepatotoxic insult of excessive alcohol consumption.</p>\n<p>Alcohol Liver Disease refers to a spectrum of liver injuries that progress in the following order:</p>\n<ul>\n<li>Alcoholic Fatty Liver</li>\n<li>Alcoholic Steatohepatitis - mixed pattern of fatty infiltration and inflammation of hepatocytes</li>\n<li>Alcoholic Cirrhosis - <strong>Micronodular cirrhosis</strong>&nbsp;(&lt; 3 mm in diameter). Cessation of alcohol leads to the development of larger nodules showing a mixed micronodular and macronodular pattern.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 37-year-old woman presents with headaches for 6 months. She has been taking analgesics regularly. The headache recently increased in severity for 3 days but was reduced on stopping the analgesic. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medication overuse headache"
      },
      {
        "id": 2,
        "text": "Tension headache"
      },
      {
        "id": 3,
        "text": "Chronic migraine"
      },
      {
        "id": 4,
        "text": "Cluster headache"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features are suggestive of <strong>medication overuse headache</strong>.</p>\n<p>Medication overuse headache&nbsp;is the <strong>headache occurring on &ge;15 days/month</strong> due to <strong>overuse of headache medications for&gt;3 months</strong>. It is also known as&nbsp;analgesic rebound headache, drug-induced headache, or medication-misuse headache. It usually <strong>resolves when the overuse is stoppe</strong>d.</p>\n<p>Management: It includes the following steps:</p>\n<ul>\n<li>Withdrawal of the overused medication</li>\n<li>Treatment of withdrawal symptoms</li>\n<li>Initiation of preventative therapy if required</li>\n<li>Alternative symptomatic medication for future headaches</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: <strong>Tension headache&nbsp;</strong>is a chronic headache syndrome characterized by<strong> bilateral, tight band-like discomfort.&nbsp;</strong>It can be episodic or chronic in nature. It is usually not associated with nausea, vomiting, etc.</p>\n<p>Option C:<strong> Chronic migraine -</strong>&nbsp;Diagnostic criteria for migraine headache is as follows:&nbsp;Repeated attacks of headache lasting 4-72 hours in patients with normal physical examination, no other reasonable cause for headache, and</p>\n<table style=\"height: 194px; width: 553.479px;\">\n<tbody>\n<tr>\n<td style=\"width: 257px;\">At least 2 of the following features</td>\n<td style=\"width: 279.479px;\">Plus at least 1 of the following features</td>\n</tr>\n<tr>\n<td style=\"width: 257px;\">Unilateral pain</td>\n<td style=\"width: 279.479px;\">Nausea or vomiting</td>\n</tr>\n<tr>\n<td style=\"width: 257px;\">Throbbing pain</td>\n<td style=\"width: 279.479px;\">Photophobia and phonophobia</td>\n</tr>\n<tr>\n<td style=\"width: 257px;\">Aggravation by movement</td>\n<td style=\"width: 279.479px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 257px;\">Moderate or severe intensity</td>\n<td style=\"width: 279.479px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>Option D: <strong>Cluster headache</strong>&nbsp;is characterized by deep, excruciating, nonfluctuating pain which is usually <strong>retroorbital</strong>. The classical feature of this condition is its <strong>periodicity</strong>.&nbsp; At least one of the&nbsp;daily attacks of pain recurs at almost the same hour every day.<br />Typically the patient has&nbsp;daily bouts of one or two attacks of relatively short-duration unilateral&nbsp;pain for 8&ndash;10 weeks a year. In between the clusters, there is a pain-free interval.<br /><br /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with acute hepatitis B has recovered from the infection. Identify the serological marker marked in the image:",
    "choices": [
      {
        "id": 1,
        "text": "Anti-HBc Ab"
      },
      {
        "id": 2,
        "text": "Anti-HBs Ab"
      },
      {
        "id": 3,
        "text": "Anti-HBe Ab"
      },
      {
        "id": 4,
        "text": "HBsAg"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The serological marker marked in the image is <strong>anti-HBc Ab</strong>. It <strong>remains elevated</strong> for a long period after recovery from infection.</p>\n<p>Anti-HBc is readily demonstrable in serum, beginning within the first 1&ndash;2 weeks after the appearance of HBsAg. It precedes detectable levels of anti-HBs by weeks to months.&nbsp;<strong>IgM</strong>&nbsp;anti-HBcAg antibody is seen&nbsp;<strong>early</strong>&nbsp;in the infection for about 6 months and indicates a recent infection. Whereas,&nbsp;<strong>IgG</strong>&nbsp;anti-HBcAg antibody is the immunoglobulin class seen&nbsp;<strong>later&nbsp;</strong>i.e.&nbsp;after 6 months, and indicates remote infection.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e8977c8a4c76463e936e085f289f3df1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59d66670c07a481abcc0e406a52edd56x1280x1156.JPEG"
    ]
  },
  {
    "text": "Paraneoplastic syndrome is usually associated with which type of lung cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Squamous Cell Carcinoma"
      },
      {
        "id": 2,
        "text": "Adenocarcinoma"
      },
      {
        "id": 3,
        "text": "Small Cell Carcinoma"
      },
      {
        "id": 4,
        "text": "Large Cell Carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Paraneoplastic Syndrome is usually associated with small cell carcinoma.</strong></li>\n<li><strong>Squamous Cell Carcinoma</strong> is associated with <strong>Smoking</strong> and Central necrosis.</li>\n<li><strong>Adenocarcinoma Metastasize earlier</strong> and is more common in women, it is the most <strong>common type of Carcinoma</strong> lung worldwide.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Triple assessment includes",
    "choices": [
      {
        "id": 1,
        "text": "1,2, 3 and 4"
      },
      {
        "id": 2,
        "text": "2, 3 and 4"
      },
      {
        "id": 3,
        "text": "1, 2 and 3"
      },
      {
        "id": 4,
        "text": "1, 3 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Triple assessment in relation to breast carcinoma includes the following:</p>\n<ul>\n<li>History and clinical examination</li>\n<li>Radiological imaging, including ultrasonography (USG) and/or mammography</li>\n<li>Histopathological examination (HPE), including fine-needle aspiration cytology (FNAC) and/or Tru-Cut biopsy</li>\n</ul>\n<p>The positive predictive value of the triple assessment is 99.9%.</p>\n<p><strong>Note:\u00a0</strong>In Bailey &amp; Love 27th Ed, Pg 863, it is mentioned that clinical assessment, radiological imaging, and HPE constitute triple assessment. However, clinical assessment includes both history and clinical examination. Hence, history is a part of triple assessment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old male patient has undergone unilateral adrenalectomy for Cushing\u2019s syndrome and you have been asked to start him on cortisol supplementation, post-surgery. What is the rationale behind it?",
    "choices": [
      {
        "id": 1,
        "text": "Remaining  adrenal gland has insufficient reserve"
      },
      {
        "id": 2,
        "text": "Contralateral adrenal gland is suppressed by prolonged cortisol over-secretion"
      },
      {
        "id": 3,
        "text": "Insufficient secretion of ACTH"
      },
      {
        "id": 4,
        "text": "To prevent Waterhouse-Fridercihsen syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The rationale behind cortisol supplementation after the surgical removal of the adenoma is that there is&nbsp;</span><strong><span data-preserver-spaces=\"true\">suppression of the contralateral adrenal</span></strong><span data-preserver-spaces=\"true\">&nbsp;gland by the <strong>pre-operative elevated cortisol levels</strong>. This causes&nbsp;</span><strong><span data-preserver-spaces=\"true\">primary adrenal insufficiency.</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Patients undergoing <strong>unilateral</strong> adrenalectomy typically require&nbsp;</span><strong><span data-preserver-spaces=\"true\">exogenous steroids</span></strong><span data-preserver-spaces=\"true\">&nbsp;for up to a <strong>year</strong>, which is usually the duration the remaining adrenal gland takes to recover adequate function. In <strong>bilateral</strong> adrenalectomy, steroids are required <strong>indefinitely</strong>, and patients may also require mineralocorticoid replacement therapy.&nbsp;</span></p>\n<p>Option A: The remaining adrenal gland usually has sufficient reserve to maintain homeostasis.</p>\n<p>Option C: A deficiency of ACTH causes secondary adrenal insufficiency. However, the adrenal insufficiency post adrenalectomy is primary i.e due to the hyposecretion of cortisol from the gland itself.&nbsp;</p>\n<p>Option D: Waterhouse&ndash;Friderichsen syndrome is a bilateral adrenal infarction associated with meningococcal sepsis and is rapidly fatal unless immediately treated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common complication of Nissen's fundoplication?",
    "choices": [
      {
        "id": 1,
        "text": "Esophageal injury"
      },
      {
        "id": 2,
        "text": "Achalasia cardia"
      },
      {
        "id": 3,
        "text": "Gas-bloat syndrome"
      },
      {
        "id": 4,
        "text": "Pneumothorax"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most common complication of Nissen\u2019s fundoplication is<strong> gas-bloat syndrome</strong>.\u00a0</p>\n<p>Fundoplication is the procedure in which the <strong>fundus </strong>of the stomach is<strong> wrapped around </strong>the <strong>lower </strong>end of the<strong> esophagus</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53d7360fbd80481088439f2683f851b2x1280x1892.JPEG"
    ]
  },
  {
    "text": "A pregnant woman with cardiac disease is on warfarin therapy. When will the final switch to heparin be advised?",
    "choices": [
      {
        "id": 1,
        "text": "At the onset of labour"
      },
      {
        "id": 2,
        "text": "34 weeks"
      },
      {
        "id": 3,
        "text": "36 weeks"
      },
      {
        "id": 4,
        "text": "40 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> final switch to heparin</strong> in pregnant women is advised at <strong>36 weeks of pregnancy.</strong></p>\n<p>The American College of Chest Physicians Guidelines for Anticoagulation of Pregnant Women is given below:</p>\n<ul>\n<li>The patient taking warfarin should discontinue it as soon as pregnancy is diagnosed and replace it by heparin 5,000 units twice daily subcutaneously up to the 12th week. Low molecular weight heparin (LMWH) can also be used.</li>\n<li>After the 12th week, it is replaced by warfarin and continued up to 36 weeks.</li>\n<li>Thereafter it is replaced by heparin which is discontinued just before delivery.</li>\n<li>Heparin (unfractionated or LMWH) is restarted 6 hours after vaginal delivery and 24 hours after cesarean section.</li>\n<li>UFH (unfractionated heparin), LMWH and Warfarin therapy are not contraindicated during breastfeeding.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman presented in her 8th week of pregnancy seeking MTP. The appropriate dosage of Misoprostol (administered by mucosal route) would be ______",
    "choices": [
      {
        "id": 1,
        "text": "200 mcg"
      },
      {
        "id": 2,
        "text": "600 mcg"
      },
      {
        "id": 3,
        "text": "400 mcg"
      },
      {
        "id": 4,
        "text": "800 mcg"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The dosage of Misoprostol (administered by mucosal route) in this case is&nbsp;800 mcg.<br />Mucosal misoprostol administration has increased efficacy and minimizes gastrointestinal side effects and is now preferred over the prior oral administration. The mucosal route includes&nbsp;<strong>buccal,</strong>&nbsp;<strong data-stringify-type=\"bold\">sublingual</strong>, and <strong data-stringify-type=\"bold\">vaginal</strong>&nbsp;Misoprostol administration.</p>\n<p><br /><strong data-stringify-type=\"bold\">Medical management protocol for induced abortion for &lt; 12 weeks of gestation (As per WHO 2018 guideline):</strong></p>\n<ul class=\"p-rich_text_list p-rich_text_list__bullet\" data-stringify-type=\"unordered-list\" data-indent=\"0\">\n<li><strong data-stringify-type=\"bold\">Combined Regimen&nbsp;</strong>(Recommended)<strong data-stringify-type=\"bold\">:&nbsp;</strong>200 mg of oral Mifepristone followed 1-2 days later by&nbsp;800 mcg of buccal, vaginal or sublingual Misoprostol</li>\n<li><strong data-stringify-type=\"bold\">Misoprostol only regimen&nbsp;</strong>(Alternative): 800 &mu;g misoprostol administered vaginally, sublingually, or buccally.</li>\n</ul>\n<div class=\"p-rich_text_section\">\n<p class=\"p1\">Outpatient medical abortion is an acceptable option for pregnancies with a menstrual age&nbsp;<strong>&lt; 63 days (9weeks)</strong></p>\n<table style=\"height: 709px; width: 295px;\">\n<tbody>\n<tr style=\"height: 14px;\">\n<td style=\"width: 285px; height: 14px;\"><strong>First trimester&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 70px;\">\n<td style=\"width: 285px; height: 70px;\">\n<p class=\"p1\"><strong>Mifepristone/Misoprostol&nbsp;Combined Regimen (Recommended)</strong>: 200 mg of oral Mifepristone followed 1-2 days later by 800 mcg of buccal, vaginal or sublingual Misoprostol</p>\n<p class=\"p1\"><strong>Misoprostol only regimen</strong> <strong>(Alternative)</strong>: 800 &mu;g misoprostol administered vaginally, sublingually or buccally.</p>\n<p class=\"p1\"><strong>Methotrexate/Misoprostol</strong></p>\n<p class=\"p6\">(d) Methotrexate, 50 mg/m2 body surface area intramuscularly or ora<span class=\"s2\">l</span>ly<span class=\"s3\">; </span>followed in 3-7 days by<span class=\"s3\">:</span></p>\n<p class=\"p6\">(e) Misoprostol, 800 mcg vaginally. Repeat if needed 1 week after methotrexate initially given</p>\n<p class=\"p6\">&nbsp;</p>\n</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 285px; height: 17px;\"><strong>Second Trimester</strong></td>\n</tr>\n<tr style=\"height: 71px;\">\n<td style=\"width: 285px; height: 71px;\">\n<p class=\"p1\"><strong>Mifepristone/Misoprostol&nbsp;</strong><strong>Combined Regimen (Recommended) :&nbsp;</strong>200 mg of oral Mifepristone followed 1-2 days later by 400 mcg of buccal, vaginal or sublingual Misoprostol every 3 hours</p>\n<p class=\"p2\"><strong>Misoprostol Alone(Alternative):&nbsp;</strong>400 mcg of buccal, vaginal or sublingual Misoprostol every 3 hours</p>\n<p class=\"p6\"><strong>Dinoprostone</strong></p>\n<p class=\"p7\">20 mg vaginal suppository every 4 hr</p>\n<p class=\"p8\"><strong>Concentrated Oxytocin</strong></p>\n<p class=\"p9\">50 units oxytocin in 500 mL of normal saline infused during 3 hr; then 1-hr diuresis (no oxytocin); then escalate sequentially in a similar fashion through 150, 200, 250, and finally 300 units oxytocin each in 500 mL normal saline</p>\n</td>\n</tr>\n</tbody>\n</table>\n&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the given features is not a major physiological change in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Insulin resistance"
      },
      {
        "id": 2,
        "text": "Increase in BMR"
      },
      {
        "id": 3,
        "text": "Hypothyroidism"
      },
      {
        "id": 4,
        "text": "Increase in blood volume"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the given features<strong> hypothyroidism&nbsp;</strong>is not a major physiological change in pregnancy.</p>\n<div class=\"page\" title=\"Page 86\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The &alpha;-subunits of hCG and TSH are identical. An increase in <strong>hCG</strong> during pregnancy <strong>stimulates thyroid</strong> and leads to a decrease in <strong>TSH levels</strong>. The thyroid undergoes enlargement and boosts the production of hormones. This is accompanied by <strong>increased </strong>production of <strong>thyroid-binding globulin(TBG)</strong>. All these changes <strong>increase total</strong> <strong style=\"font-size: 14px;\">T4 and T3</strong><span style=\"font-size: 14px;\">&nbsp;in the first trimester. But the physiologically important </span><strong style=\"font-size: 14px;\">free T4 and T3</strong><span style=\"font-size: 14px;\"> levels remain</span><strong style=\"font-size: 14px;\"> unchanged.</strong><span style=\"font-size: 14px;\">&nbsp;Hence, physiologically pregnant women remain </span><strong style=\"font-size: 14px;\">euthyroid</strong><span style=\"font-size: 14px;\">.</span></p>\n</div>\n</div>\n</div>\n</div>\n<p>Option A: Normal pregnancy is characterized by<strong> insulin resistance</strong> and <strong>hyperinsulinemia.&nbsp;<span style=\"font-size: 14px;\">Human placental lactogen</span></strong><span style=\"font-size: 14px;\"><strong>(hPL)</strong> secreted during pregnancy, helps in adaptation to fetal energy requirements. Insulin resistance causes&nbsp;</span><span style=\"font-size: 14px;\"><strong>prolonged hyperglycemia</strong> and</span><span style=\"font-size: 14px;\">&nbsp;<strong>glucose flow to the fetus</strong>. It also favours protein synthesis. To counterbalance the increased insulin resistance and prevent maternal hyperglycemia, maternal insulin levels are increased.</span></p>\n<p>Option B: By the 3<sup>rd</sup> trimester, there is an&nbsp;<strong>increase</strong> in the <strong>maternal basal metabolic rate</strong> by 10 to 20% in comparison to a nonpregnant woman.</p>\n<p>Option D:&nbsp;<span style=\"font-size: 14px;\">During normal pregnancy,<strong> mean arterial pressure</strong>&nbsp;</span><span style=\"font-size: 14px;\">and <strong>vascular resistance decrease</strong>, while <strong>blood volume</strong> and <strong>cardiac output</strong> rate increase. This helps in meeting&nbsp;</span><span style=\"font-size: 14px;\">metabolic demands of the enlarged uterus,&nbsp;</span><span style=\"font-size: 14px;\">provide nutrients to rapidly growing placenta and fetus,&nbsp;</span><span style=\"font-size: 14px;\">safeguard mother against the effects of parturition-associated blood loss.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sabareesh, a 7-year-old boy was playing football with his friends during the PET classes. Suddenly he complained of severe abdominal pain and he is rushed to the pediatric ER.  An erect X-ray scan of the abdomen showed the following picture.  What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Intussusception"
      },
      {
        "id": 2,
        "text": "Gastric volvulus"
      },
      {
        "id": 3,
        "text": "Sigmoid volvulus"
      },
      {
        "id": 4,
        "text": "Meckels diverticulum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sigmoid volvulus</strong>&nbsp;is the most likely diagnosis.<strong>&nbsp;</strong>It occurs when the sigmoid colon twists on the sigmoid mesocolon. It is a cause of large bowel obstruction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0a74095c40d244d495ed76c185730114.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly male has pain and swelling in the knee joint.  Synovial fluid on polarized light microscopy demonstrated",
    "choices": [
      {
        "id": 1,
        "text": "Negatively birefringent rhomboid shaped crystals"
      },
      {
        "id": 2,
        "text": "Positively birefringent rhomboid shaped crystals"
      },
      {
        "id": 3,
        "text": "Negatively birefringent needle shaped crystals"
      },
      {
        "id": 4,
        "text": "Positively birefringent needle shaped crystals"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given case is highly suggestive of <strong>pseudogout</strong> and in the study of synovial aspirate on polarized light, the crystals appear as<strong> Positively birefringent rhomboid shaped crystals<br /></strong></p>\n<table style=\"height: 260px;\" width=\"321\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 311px;\" colspan=\"2\"><strong>Crystals on Polarised Microscopy</strong></td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 145.117px;\"><strong>Gout</strong></td>\n<td style=\"text-align: center; width: 159.883px;\"><strong>Pseudogout</strong></td>\n</tr>\n<tr>\n<td style=\"width: 145.117px; text-align: left;\"><strong>N</strong>egatively Birefringent</td>\n<td style=\"width: 159.883px; text-align: right;\">Positviely birefringent</td>\n</tr>\n<tr>\n<td style=\"width: 145.117px; text-align: left;\"><strong>N</strong>eedle Shaped</td>\n<td style=\"width: 159.883px; text-align: right;\">Rhomboid crystals</td>\n</tr>\n<tr>\n<td style=\"width: 145.117px; text-align: left;\"><strong>N</strong>a Urate(Sodium Urate)</td>\n<td style=\"width: 159.883px; text-align: right;\">Ca pyrophosphate</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the treatment of choice for postpartum blues?",
    "choices": [
      {
        "id": 1,
        "text": "Fluoxetine"
      },
      {
        "id": 2,
        "text": "Cognitive behavioural therapy"
      },
      {
        "id": 3,
        "text": "Lithium carbonate"
      },
      {
        "id": 4,
        "text": "Support and education"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Postpartum blues</strong> is common in mothers in the puerperal period and requires nothing more than <strong>education and support</strong>. It is characterised by a labile mood, sadness and subjective confusion. It is thought to be due to changes in hormone levels, the stress of childbirth and anxiety about the responsibilities of motherhood.</p>\n<p>If symptoms last longer than 2 weeks, an evaluation for <strong>postpartum depression</strong> is needed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old term primigravida is taken to the operation theatre for an emergency cesarean section due to sudden fetal distress. The anaesthetist wants to prevent chances of pulmonary aspiration and decides to intubate using rapid sequence intubation. Which of the following steps is not performed in this technique?",
    "choices": [
      {
        "id": 1,
        "text": "Preoxygenation"
      },
      {
        "id": 2,
        "text": "Cricoid pressure"
      },
      {
        "id": 3,
        "text": "Bag\u00a0and mask ventilation"
      },
      {
        "id": 4,
        "text": "Propofol infusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Bag and mask ventilation is <strong>avoided</strong> in rapid sequence intubation because it leads to <strong>stomach</strong> <strong>inflation</strong> and increases the risk of<strong> aspiration</strong>.<br /><strong><br /></strong><strong>Indications of Rapid sequence intubation:</strong></p>\n<p>RSI is done when the patient is at increased risk of pulmonary aspiration&nbsp;as in:</p>\n<ul>\n<li aria-level=\"1\"><strong>pregnancy</strong></li>\n<li aria-level=\"1\">full stomach</li>\n<li aria-level=\"1\">intestinal obstruction</li>\n<li aria-level=\"1\">hiatus hernia</li>\n<li aria-level=\"1\">encephalopathy</li>\n<li aria-level=\"1\">morbid obesity</li>\n<li aria-level=\"1\">diabetic gastroparesis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f3e319aa6174d5d9044e026fef3eed6x1176x1512.PNG"
    ]
  },
  {
    "text": "A patient presented with scaly lesions as shown in the image below. He later developed arthritis and nail changes.  What is the treatment of choice for this?",
    "choices": [
      {
        "id": 1,
        "text": "PUVA"
      },
      {
        "id": 2,
        "text": "Steroids"
      },
      {
        "id": 3,
        "text": "Methotrexate"
      },
      {
        "id": 4,
        "text": "Clobetasol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient<strong>\u00a0</strong>has<strong> right knee effusion</strong>,<strong> dactylitis</strong> of multiple digits, and sharply demarcated scaly red <strong>papulosquamous lesions</strong> on both knees all of which point toward a diagnosis of<strong> psoriatic arthritis.\u00a0</strong></p>\n<p><strong>Methotrexate</strong>\u00a0and <strong>apremilast</strong>\u00a0are the <strong>first-line</strong> drugs for the treatment of moderate to severe psoriasis associated with psoriatic\u00a0arthritis.</p>\n<p>Features of psoriatic arthritis are :</p>\n<ul>\n<li>Asymmetrical oligoarthritis</li>\n<li>associated with nail pitting/ onycholysis, or</li>\n<li>dactylitis, enthesitis\u00a0</li>\n<li>Inflammation is prominent in the distal interphalangeal joints\u00a0</li>\n<li>There is dactylitis with pronounced telescoping.</li>\n<li>Nail dystrophy (hyperkeratosis and onycholysis) affects each of the fingers</li>\n<li>Axial involvement may occur</li>\n</ul>\n<p>Radiological features:</p>\n<ul>\n<li>Pencil-in-cup deformity of DIP joint</li>\n<li>marginal erosions with adjacent bony proliferation \"whiskering\"</li>\n<li>small joint ankylosis</li>\n<li>Ray distribution of lesions</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/07930b60305f46a499bc1b2f85e98e50.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young woman presented to the OPD with dysphagia and regurgitation of food. She was diagnosed with iron deficiency anaemia 3 months back. Barium swallow was done and is shown below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Esophageal carcinoma"
      },
      {
        "id": 2,
        "text": "Zenker's diverticulum"
      },
      {
        "id": 3,
        "text": "Esophageal leiomyoma"
      },
      {
        "id": 4,
        "text": "Plummer-Vinson syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario along with the barium swallow showing <strong>esophageal web</strong> is suggestive of <strong>Plummer-Vinson syndrome</strong>.</p>\n<p>Plummer-Vinson syndrome is also known as&nbsp;<strong>Paterson-Brown-Kelly</strong> syndrome.&nbsp;It is more common in <strong>women</strong> and is a recognized risk factor for&nbsp;post cricoid hypopharyngeal squamous cell carcinoma.</p>\n<div class=\"page\" title=\"Page 403\">&nbsp;It&nbsp;consists of the following features:</div>\n<ol>\n<li>Dysphagia&nbsp;</li>\n<li>Iron-deficiency anemia &nbsp;&nbsp;&nbsp;&nbsp;</li>\n<li>Esophageal webs&nbsp;or hypopharyngeal webs</li>\n</ol>\n<p>The image below depicts a barium swallow showing an upper esophageal concentric web in lateral view. These are due to&nbsp;an esophageal constriction caused by a thin mucosal membrane projecting into the lumen.&nbsp;More commonly, they are seen in the <strong>cervical&nbsp;esophagus</strong>&nbsp;near the cricopharyngeus muscle. They typically arise from the <strong>anterior wall</strong>, but&nbsp;never from the posterior wall. They may also be circumferential.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7fab163fc5a24516bcb6a57b44a8c98c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35d730273c49480ca36eee41f3997d88x592x571.JPEG"
    ]
  },
  {
    "text": "All are causes of high RAIU (radioactive iodine uptake) except:",
    "choices": [
      {
        "id": 1,
        "text": "Graves\u2019 Disease"
      },
      {
        "id": 2,
        "text": "Endemic Iodine deficiency"
      },
      {
        "id": 3,
        "text": "Subacute thyroiditis"
      },
      {
        "id": 4,
        "text": "HCG induced thyrotoxicosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Subacute thyroiditis</strong> shows <strong>low uptake</strong> of radioactive iodine as it involves destruction and inflammation of the thyroid follicles, which also accounts for the thyrotoxic symptoms due to exocytosis of the hormone.</p>\n<p>The other three are classical examples of high RAIU.</p>\n<p><strong>Radioactive Iodine Scan</strong>:</p>\n<ul>\n<li>Nonpregnant, hyperthyroid patients with physical examination suggesting nodular thyroid disease, radioactive iodine should be the initial test to determine the aetiology of hyperthyroidism.</li>\n<li><strong>Pregnancy and breastfeeding</strong> are <strong>absolute contraindications</strong> to radionuclide imaging.</li>\n<li>Hyperthyroidism with a <strong>high</strong> (or normal) radioiodine uptake indicates <strong>de-novo synthesis of the hormone</strong>.</li>\n<li>Hyperthyroidism with a <strong>low</strong> (nearly absent) radioiodine uptake indicates either <strong>inflammation</strong> and <strong>destruction of thyroid tissue</strong> with release of <strong>preformed hormone</strong> into the circulation or an <strong>extrathyroidal source</strong> of thyroid hormone, such as in patients with <strong>factitious thyrotoxicosis</strong> and in patients with <strong>struma ovari</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 033';
        const quizFilename = 'fmge-mini-test-033-cf9ef379.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>