<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>61 Respiratory System - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pharmacology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a long-acting \u03b2-2 agonist that can be prescribed in a patient with moderately severe bronchial asthma?",
    "choices": [
      {
        "id": 1,
        "text": "Salbutamol"
      },
      {
        "id": 2,
        "text": "Indacaterol"
      },
      {
        "id": 3,
        "text": "Terbutaline"
      },
      {
        "id": 4,
        "text": "Formoterol"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Formoterol </strong>is a <strong>long-acting &beta;-2 agonist</strong>&nbsp;(LABA).</p>\n<p style=\"text-align: justify;\">Beta 2 agonists are classified based on their duration of action into:&nbsp;</p>\n<ul>\n<li style=\"text-align: justify;\">Short-acting &beta;<strong>-</strong>2 agonists (<strong>SABA</strong>):\n<ul>\n<li>Salbutamol</li>\n<li>Terbutaline&nbsp;</li>\n<li>Pirbuterol</li>\n</ul>\n</li>\n<li style=\"text-align: justify;\">Long-acting &beta;<strong>-</strong>2 agonists (<strong>LABA</strong>):\n<ul>\n<li>Salmeterol</li>\n<li>Formoterol</li>\n</ul>\n</li>\n<li style=\"text-align: justify;\">Very long-acting &beta;<strong>-</strong>2 agonists (<strong>V-LABA</strong>):\n<ul>\n<li style=\"text-align: justify;\">Indacaterol</li>\n<li style=\"text-align: justify;\">Olodaterol</li>\n<li style=\"text-align: justify;\">Vilanterol</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the current GINA recommendation for the prescription of long-acting \u03b2-2 agonists in patients suffering from bronchial asthma?",
    "choices": [
      {
        "id": 1,
        "text": "As monotherapy"
      },
      {
        "id": 2,
        "text": "In combination with an inhaled anticholinergic"
      },
      {
        "id": 3,
        "text": "In combination with an inhaled corticosteroid"
      },
      {
        "id": 4,
        "text": "In combination with a short acting \u03b2-2 agonist"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\"><strong>LABA</strong> is used in <strong>combination </strong>with<strong> inhalational corticosteroids</strong>&nbsp;(ICS),<strong>&nbsp;</strong>preferably in the form of a combination inhaler.</p>\n<p style=\"text-align: left;\">LABA is never taken alone as it does not treat the underlying chronic inflammation of asthma. Corticosteroids&nbsp;will decrease the underlying inflammation and halt the progression of the disease.</p>\n<p style=\"text-align: left;\">Short-acting &beta;-2 agonists (<strong>SABA</strong>) can be given as an add-on therapy to the LABA-ICS combination (<strong>as-needed therapy</strong>).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the most appropriate therapy for bronchodilation in acute severe asthma?",
    "choices": [
      {
        "id": 1,
        "text": "Intravenous aminophylline"
      },
      {
        "id": 2,
        "text": "Inhalational anticholinergics"
      },
      {
        "id": 3,
        "text": "Nebulized SABA"
      },
      {
        "id": 4,
        "text": "Intravenous SABA"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Nebulized short-acting beta-2 agonists</strong> (SABAs) are the most appropriate therapy in <strong>acute severe asthma</strong> among the given options.\u00a0</p>\n<p><strong>Nebulized route </strong>is preferred over the intravenous route as it is <strong>easier</strong> and<strong> safer </strong>with equivalent efficacy.</p>\n<p>Intravenous aminophylline is less effective than SABA and is reserved for those who are resistant or intolerant to beta-2 agonists with acute severe asthma.\u00a0</p>\n<p>Inhalational anticholinergics are not indicated in acute severe asthma as they are less effective than SABAs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a side effect of salbutamol?",
    "choices": [
      {
        "id": 1,
        "text": "Hypoglycemia"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Tremors"
      },
      {
        "id": 4,
        "text": "Tachycardia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">Hypoglycemia is not a side effect of <strong>salbutamol</strong>. It causes\u00a0<strong>hyperglycemia.</strong></p>\n<p style=\"text-align: justify;\">The side effects of salbutamol are\u00a0due to the <strong>stimulation</strong> of <strong>extrapulmonary \u03b2<sub>2 </sub>receptors. </strong>They are more\u00a0common after oral or intravenous<strong>\u00a0</strong>administration. The side effects seen are:\u00a0 \u00a0\u00a0</p>\n<ul>\n<li style=\"text-align: justify;\">Muscle tremor</li>\n<li style=\"text-align: justify;\">Tachycardia</li>\n<li style=\"text-align: justify;\">Hypokalemia\u00a0</li>\n<li style=\"text-align: justify;\">Restlessness\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</li>\n<li style=\"text-align: justify;\">Hypoxemia\u00a0 \u00a0 \u00a0 \u00a0 \u00a0</li>\n<li style=\"text-align: justify;\">Increase in free fatty acid, insulin, glucose, pyruvate, and lactate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An asthmatic patient complains of wheezing and shortness of breath most days of the week. Which of the following therapies is preferred in him?",
    "choices": [
      {
        "id": 1,
        "text": "Inhaled SABA"
      },
      {
        "id": 2,
        "text": "Inhaled LABA"
      },
      {
        "id": 3,
        "text": "Inhaled  LABA + inhaled corticosteroids"
      },
      {
        "id": 4,
        "text": "Inhaled SABA + inhaled corticosteroids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\" style=\"text-align: justify;\">This patient has&nbsp;<strong>persistent asthma </strong>for which<strong>&nbsp;</strong>the preferred therapy<strong>&nbsp;</strong>is<strong>&nbsp;LABA with ICS </strong>available as a<strong>&nbsp;combination inhaler.</strong></p>\n<p style=\"text-align: justify;\">ICS should be started in any patient who needs to use a short-acting beta-2 agonist inhaler for symptomatic control more than twice a week (persistent asthma).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child requires bronchodilator therapy. You attach the device shown below to the pressurized metered-dose inhaler for ease of use. Which of the following is false about this device?",
    "choices": [
      {
        "id": 1,
        "text": "Decreases the deposition of drug on the oropharynx"
      },
      {
        "id": 2,
        "text": "Increases the delivery of drug to lower airways"
      },
      {
        "id": 3,
        "text": "Increases the incidence of oropharyngeal candidiasis"
      },
      {
        "id": 4,
        "text": "Systemic absorption of drugs is unaffected"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Nebulizers:</strong>&nbsp;Two types of nebulizer are available -\n<ul>\n<li><strong>Jet nebulizers</strong>&nbsp;that are driven by a stream of gas (air or oxygen)</li>\n<li><strong>Ultrasonic nebulizers</strong>&nbsp;that use a rapidly vibrating piezoelectric crystal and thus do not require a source of compressed gas.</li>\n</ul>\n</li>\n</ul>\n<p>The nebulizers deliver much <strong>higher drug doses</strong> as compared pMDIs. These are useful in:</p>\n<ul>\n<li>Treating acute exacerbations of asthma and COPD</li>\n<li>Extreme airway obstruction (severe COPD)</li>\n<li>Delivering inhaled drugs to infants and small children who cannot use the other inhalation devices</li>\n<li>Administering drugs such as antibiotics in relatively high doses</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c79df03efd6d4a87baad5dad87dd05de.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e51d99cce336454585713400e71a010cx720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf3ec9228e96415da2ec3c3932577099x596x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3fe2da00a2b7445d8a99ec027efeab5ax799x533.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2687fee5df024653908a0728befd85afx1024x683.JPEG"
    ]
  },
  {
    "text": "An asthmatic patient has been taking theophylline tablets for symptomatic relief. On which of the following receptors does this drug have an antagonistic action?",
    "choices": [
      {
        "id": 1,
        "text": "Histamine receptors"
      },
      {
        "id": 2,
        "text": "Bradykinin receptors"
      },
      {
        "id": 3,
        "text": "Adenosine receptors"
      },
      {
        "id": 4,
        "text": "Kallikrein receptors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\"><strong>Theophylline</strong>&nbsp;has an<strong> antagonistic </strong>action on<strong> adenosine receptors.</strong></p>\n<p style=\"text-align: left;\">Theophylline is a <strong>methylxanthine.&nbsp;</strong>It acts as a&nbsp;<strong>non-selective PDE inhibitor</strong>. Its other actions include:&nbsp;</p>\n<ul style=\"text-align: left;\">\n<li>Increased IL-10 release</li>\n<li>Decrease in gene transcription of pro-inflammatory cytokines</li>\n<li>Promotes apoptosis of granulocytes</li>\n<li>Histone deacetylase activation.&nbsp;The recruitment of histone deacetylase-2 by glucocorticoid receptors switches off inflammatory genes. Through this mechanism, theophylline <strong>enhances </strong>the <strong>anti-inflammatory effects</strong> of<strong> corticosteroids</strong>.</li>\n</ul>\n<p style=\"text-align: left;\">Theophylline can be used as a <strong>bronchodilator</strong> in an <strong>asthmatic</strong> patient on ICS as an <strong>add-on</strong> drug. LABAs are more effective but theophylline is a <strong>cheaper</strong> option.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about theophylline is not correct?",
    "choices": [
      {
        "id": 1,
        "text": "Increase in dose is required in cardiopulmonary disease"
      },
      {
        "id": 2,
        "text": "Decreases the breakdown of cAMP in smooth muscles"
      },
      {
        "id": 3,
        "text": "Increase in dose is required in smokers"
      },
      {
        "id": 4,
        "text": "Is a non-selective phosphodiesterase inhibitor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\">A <strong>decrease</strong> in<strong> dose</strong>&nbsp;of theophylline is required in <strong>cardiopulmonary</strong> disease.&nbsp;This is because<strong> reduced clearance </strong>of theophylline is seen in liver disease, pneumonia, and heart failure.</p>\n<p style=\"text-align: left;\">In smokers, <strong>clearance </strong>of theophylline is<strong> increased</strong> due to the <strong>induction of CYP1A2</strong> enzyme.&nbsp;</p>\n<p style=\"text-align: left;\">Theophylline is a <strong>non-selective</strong> phosphodiesterase inhibitor that <strong>decreases</strong> the <strong>breakdown of cAMP</strong> levels in smooth muscles resulting in bronchodilation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an indication for theophylline?",
    "choices": [
      {
        "id": 1,
        "text": "Supraventricular tachycardia"
      },
      {
        "id": 2,
        "text": "Epilepsy"
      },
      {
        "id": 3,
        "text": "Acute severe asthma"
      },
      {
        "id": 4,
        "text": "Apnea of prematurity"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\"><strong>Theophylline</strong> is indicated in the treatment of <strong>apnea of prematurity</strong>.</p>\n<p style=\"text-align: left;\">In apnea of prematurity, methylxanthines such as theophylline and caffeine <strong>increase</strong> the <strong>central respiratory drive</strong> by lowering the threshold of response to hypercapnia. They also enhance the contractility of the diaphragm and prevent diaphragmatic fatigue.</p>\n<p style=\"text-align: left;\">Options A &amp; B - The adenosine receptor antagonism property of theophylline <strong>precipitates </strong>cardiac<strong> arrhythmias </strong>and epileptic<strong> seizures</strong>.&nbsp;</p>\n<p style=\"text-align: left;\">Option C - Theophylline is <strong>no longer recommended</strong> as a treatment for <strong>acute severe asthma</strong> by the latest guidelines (GINA 2021) because of its poor efficacy and safety profile.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with severe persistent asthma continues to have symptoms despite being on high-dose ICS-LABA therapy. Which of the following is a leukotriene receptor antagonist, appropriate as an add-on therapy for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Dupilumab"
      },
      {
        "id": 2,
        "text": "Roflumilast"
      },
      {
        "id": 3,
        "text": "Zafirlukast"
      },
      {
        "id": 4,
        "text": "Zileuton"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\"><strong>Zafirlukast </strong>and montelukast are <strong>leukotriene receptor antagonists</strong>. They are competitive antagonists of the cysLT1 receptors. These drugs act by:&nbsp;</p>\n<ul>\n<li style=\"text-align: left;\">Decreasing bronchoconstriction</li>\n<li style=\"text-align: left;\">Reducing airway mucus secretion</li>\n<li style=\"text-align: left;\">Decreasing vascular permeability and</li>\n<li style=\"text-align: left;\">Reducing eosinophil chemotaxis&nbsp;</li>\n</ul>\n<p style=\"text-align: left;\">Option A: Dupilumab is an interleukin-4 receptor antagonist used in severe asthma.&nbsp;</p>\n<p style=\"text-align: left;\">Option B: Roflumilast is a PDE-4 selective inhibitor used in the treatment of COPD.</p>\n<p style=\"text-align: left;\">Option D: Zileuton is a lipoxygenase inhibitor that can be used in the treatment of asthma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The use of which of the following therapies for acute asthma requires serial monitoring of liver function tests?",
    "choices": [
      {
        "id": 1,
        "text": "3 and 4"
      },
      {
        "id": 2,
        "text": "2 and 3"
      },
      {
        "id": 3,
        "text": "1, 2 and 5"
      },
      {
        "id": 4,
        "text": "1, 4 and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\"><strong>Zileuton, montelukast,&nbsp;</strong>and<strong> zafirlukast </strong>are all associated with rare instances of<strong> hepatic dysfunction.&nbsp;&nbsp;</strong>Liver function tests should be monitored during the course of their therapy.</p>\n<p style=\"text-align: left;\">Therapy with selective &beta;-2 agonists (salbutamol, salmeterol) does not require serial monitoring of LFTs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly asthmatic on treatment presented with fever, malaise, and lower limb sensory deficit. Significant investigations are given below. Which of the following drugs is associated with these findings?",
    "choices": [
      {
        "id": 1,
        "text": "Montelukast"
      },
      {
        "id": 2,
        "text": "Cromolyn sodium"
      },
      {
        "id": 3,
        "text": "Theophylline"
      },
      {
        "id": 4,
        "text": "Ketotifen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">The given scenario points towards a diagnosis of <strong>Churg-Strauss syndrome</strong>. It is an <strong>eosinophilic vasculitis</strong>&nbsp;associated with the use of <strong>montelukast </strong>and zafirlukast. This is a very <strong>rare</strong>ly reported side effect of these drugs.</p>\n<p style=\"text-align: justify;\">These agents <strong>block</strong> the effects of the <strong>cysLTs</strong> (LTC4, LTD4, and LTE4) but they do not block the effect of LTB4, which is a chemoattractant for eosinophils and neutrophils. This can lead to eosinophilia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An asthmatic patient was brought to the ER in an agitated state. His respiratory rate was 32/min and pulse was 124/min. Pulse oximetry revealed a SpO2 of 88% on room air. Which of the following drugs is not useful in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Salbutamol"
      },
      {
        "id": 2,
        "text": "Hydrocortisone"
      },
      {
        "id": 3,
        "text": "Cromolyn sodium"
      },
      {
        "id": 4,
        "text": "Ipratropium bromide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">The given clinical scenario is suggestive of&nbsp;<strong>acute severe asthma</strong>&nbsp;and cromolyn sodium is not useful in its treatment. It is <strong>indicated only</strong> for<strong> chronic prophylaxis.</strong></p>\n<p style=\"text-align: left;\">Short-acting beta 2 agonists (<strong>SABA</strong>) and<strong> intravenous hydrocortisone</strong> are used in the treatment of acute severe asthma.</p>\n<p style=\"text-align: left;\"><strong>Ipratropium bromide</strong> can also be given in severe asthma exacerbations. It&nbsp;should be given after beta 2-agonists as they have a slower onset of bronchodilatory action.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Omalizumab is added as a step-up therapy in a child with severe asthma, refractory to treatment. Which of the following is true about this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Is administered intravenously"
      },
      {
        "id": 2,
        "text": "Has anti interleukin-5 action"
      },
      {
        "id": 3,
        "text": "Is indicated in acute severe asthma"
      },
      {
        "id": 4,
        "text": "Is a monoclonal antibody against IgE"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\"><strong>Omalizumab</strong> is&nbsp;a monoclonal <strong>antibody against IgE.</strong></p>\n<p style=\"text-align: left;\">It is used only in patients with <strong>very severe asthma</strong> (not acute severe asthma) who show poor symptom control even with step 4/5 measures as per GINA 2021 guidelines.</p>\n<p style=\"text-align: left;\">It can only be given to patients aged<strong> &ge;6 years</strong>. It neutralizes circulating IgE and inhibits mast cell degranulation caused by IgE. It is administered <strong>subcutaneously</strong>.</p>\n<p style=\"text-align: left;\">Another drug used in severe asthma is <strong>mepolizumab</strong>. It is a monoclonal antibody acting <strong>against IL-5</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient diagnosed with Churg-Strauss syndrome is started on Mepolizumab. This drug acts against:",
    "choices": [
      {
        "id": 1,
        "text": "IgE"
      },
      {
        "id": 2,
        "text": "IgA"
      },
      {
        "id": 3,
        "text": "IL-5"
      },
      {
        "id": 4,
        "text": "IL-12"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Mepolizumab </strong>is a monoclonal antibody <strong>against IL-5.&nbsp;</strong>It is indicated in:&nbsp;</p>\n<ul>\n<li style=\"text-align: justify;\">Selected (eosinophilic phenotype) patients with <strong>severe asthma</strong></li>\n<li style=\"text-align: justify;\">Churg-Strauss syndrome&nbsp;</li>\n<li style=\"text-align: justify;\">Hypereosinophilic syndrome&nbsp;</li>\n</ul>\n<p style=\"text-align: justify;\">IL-5 plays a pivotal role in <strong>eosinophilic inflammation</strong> and is also involved in eosinophil survival and priming.</p>\n<p style=\"text-align: justify;\">Monoclonal antibodies against IL-5 approved for asthma are:</p>\n<ul>\n<li style=\"text-align: justify;\">Mepolizumab</li>\n<li style=\"text-align: justify;\">Reslizumab</li>\n<li style=\"text-align: justify;\">Benralizumab</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the thromboxane receptor antagonist used in the treatment of asthma?",
    "choices": [
      {
        "id": 1,
        "text": "Seratrodast"
      },
      {
        "id": 2,
        "text": "Rimanobant"
      },
      {
        "id": 3,
        "text": "Sacubitril"
      },
      {
        "id": 4,
        "text": "Roflumilast"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Seratrodast </strong>is a<strong> thromboxane receptor antagonist </strong>indicated for use in<strong> long term prophylaxis of asthma</strong>. It is available and approved in India.</p>\n<p>Option B- <strong>Rimonabant</strong> is a <strong>cannabinoid receptor antagonist</strong> that was investigated for weight gain but now withdrawn due to adverse psychological effects&nbsp;</p>\n<p>Option C- <strong>Sacubitril</strong> is a <strong>neprilysin inhibitor</strong> approved in fixed-dose combination with valsartan for <strong>heart failure</strong> patients.</p>\n<p>Option D- <strong>Roflumilast</strong> is a <strong>phosphodiesterase 4 inhibitor</strong> which reduces eosinophil infiltration and inhibits inflammatory cell ,effective against smoke induced inflammation and emphysema.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a case of acute exacerbation of asthma, salbutamol was given, however, no improvement was noticed. Intravenous corticosteroids and aminophylline were given and the condition improved. What is the probable mechanism by which the corticosteroids would have improved the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Corticosteroids increase bronchial responsiveness to salbutamol"
      },
      {
        "id": 2,
        "text": "Corticosteroids cause direct bronchodilatation when used with xanthines"
      },
      {
        "id": 3,
        "text": "Corticosteroids indirectly increase the effect of xanthines on adenosine receptor"
      },
      {
        "id": 4,
        "text": "Corticosteroids increase mucociliary clearance"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Corticosteroids</strong> improved the condition by <strong>increasing </strong>the <strong>airway&nbsp;responsiveness</strong> to<strong> salbutamol</strong>.</p>\n<p>Mechanism of action of corticosteroids in an acute asthma attack:</p>\n<ul>\n<li>Increases responsiveness to &beta;-2 agonists</li>\n<li>Decreases mucous secretion</li>\n<li>Decreases inflammatory cell response.</li>\n</ul>\n<p><strong>Steroids increase</strong> the <strong>transcription of &beta;-2 receptor genes</strong> and hence increases responsiveness to &beta;-2 agonists.</p>\n<p><strong>&beta;-2 agonists</strong> increase the effect of steroids by <strong>enhancing</strong> the <strong>action</strong> of <strong>glucocorticoid receptors.</strong></p>\n<p>Theophylline increases the effects of steroids by activating&nbsp;the enzyme histone deacetylase which is the target for steroids as well.</p>\n<p>Note: As per recent GINA 2021 guidelines, aminophyllines are no longer preferred in the management of acute severe asthma due to their low efficacy and poor safety profile.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has had 2 acute exacerbations of asthma over the span of 1-month despite being on therapy. Which of the following is a systemic steroid that can be used to treat her?",
    "choices": [
      {
        "id": 1,
        "text": "Ciclesonide"
      },
      {
        "id": 2,
        "text": "Beclomethasone"
      },
      {
        "id": 3,
        "text": "Prednisolone"
      },
      {
        "id": 4,
        "text": "Budesonide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\"><strong>Prednisolone </strong>is a <strong>systemic steroid </strong>used for <strong>maintenance therapy </strong>after an acute exacerbation of asthma.</p>\n<p style=\"text-align: left;\">Intravenous corticosteroids such as hydrocortisone are indicated if the lung function is predicted to be &lt;30% or if there's poor response to nebulized &beta;<sub>2&nbsp;</sub>agonists. After the exacerbation, oral predisolone can be substituted with maximal beneficial effect at 30-40mg daily.</p>\n<p><strong>Inhaled corticosteroids</strong> commonly used in asthma are:</p>\n<ul>\n<li style=\"text-align: justify;\">Beclomethasone dipropionate</li>\n<li style=\"text-align: justify;\">Budesonide</li>\n<li style=\"text-align: justify;\">Ciclesonide</li>\n<li style=\"text-align: justify;\">Fluticasone</li>\n<li style=\"text-align: justify;\">Mometasone</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An asthmatic patient presented to the ER with dyspnea and wheezing. Intake of which of the following is unlikely to have precipitated this?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylbutazone"
      },
      {
        "id": 2,
        "text": "Naproxen"
      },
      {
        "id": 3,
        "text": "Caffeine"
      },
      {
        "id": 4,
        "text": "Aspirin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">The given clinical scenario is suggestive of an<strong> acute exacerbation</strong> of <strong>asthma</strong>. Caffeine&nbsp;does not precipitate this.</p>\n<p style=\"text-align: left;\"><strong>Caffeine</strong> is a <strong>dietary xanthine</strong> similar in structure to <strong>methylxanthines</strong>&nbsp;(theophylline) which are used as adjuvants in the <strong>treatment</strong> of asthma.&nbsp;</p>\n<p style=\"text-align: left;\"><strong>NSAIDs</strong> (like phenylbutazone, naproxen, and aspirin) inhibit the cyclooxygenase pathway thereby diverting arachidonic acid towards the lipoxygenase pathway. This <strong>increases</strong> the level of<strong> pro-inflammatory leukotrienes</strong> and can<strong> precipitate</strong> an <strong>acute asthma</strong> attack.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with mild episodic asthma is prescribed daily low-dose inhaled budesonide therapy. Which of the following conditions is he not at increased risk of developing?",
    "choices": [
      {
        "id": 1,
        "text": "Dysphonia"
      },
      {
        "id": 2,
        "text": "Pulmonary TB"
      },
      {
        "id": 3,
        "text": "Oropharyngeal candidiasis"
      },
      {
        "id": 4,
        "text": "Carcinoma of lung"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\"><strong>Inhaled corticosteroids&nbsp;</strong>(ICS)&nbsp;like <strong>budesonide</strong> do not increase the risk of developing carcinoma of the lung.</p>\n<p style=\"text-align: left;\">Common problems with the use of ICS:&nbsp;</p>\n<ul>\n<li style=\"text-align: left;\"><strong>Hoarseness</strong>&nbsp;of voice</li>\n<li style=\"text-align: left;\">Weakness of voice (<strong>dysphonia</strong>)</li>\n<li style=\"text-align: left;\">Increased risk of bacterial and mycobacterial lung <strong>infection</strong></li>\n<li style=\"text-align: left;\">Oropharyngeal <strong>candidiasis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly man with a 30-year history of smoking complains of breathing difficulty. A diagnosis of COPD is made, and treatment with a long-acting muscarinic antagonist is initiated.  Which of the following will you not prescribe?",
    "choices": [
      {
        "id": 1,
        "text": "Glycopyrronium"
      },
      {
        "id": 2,
        "text": "Umeclidinium"
      },
      {
        "id": 3,
        "text": "Ipratropium"
      },
      {
        "id": 4,
        "text": "Tiotropium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\"><strong>Ipratropium</strong> is a <strong>short-acting muscarinic antagonist&nbsp;</strong>which is not used for the long-term management of COPD. It can be used to treat <strong>acute exacerbations.</strong></p>\n<p style=\"text-align: left;\">The long-acting muscarinic antagonists (<strong>LAMAs</strong>) are:</p>\n<ul>\n<li style=\"text-align: left;\">Tiotropium</li>\n<li style=\"text-align: left;\">Glycopyrronium&nbsp;</li>\n<li style=\"text-align: left;\">Umeclidinium</li>\n<li style=\"text-align: left;\">Aclidinium</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Inhalational anticholinergics the mainstay of treatment in:",
    "choices": [
      {
        "id": 1,
        "text": "Asthma"
      },
      {
        "id": 2,
        "text": "COPD"
      },
      {
        "id": 3,
        "text": "Both a and b"
      },
      {
        "id": 4,
        "text": "Status asthmaticus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>Inhalational anticholinergics</strong> are the mainstay for the treatment of <strong>COPD</strong>.</p>\n<p style=\"text-align: left;\"><strong>Ipratropium</strong> is as <strong>effective</strong> as albuterol in patients with COPD.<strong> Longer-acting antimuscarinic</strong> agents, including tiotropium, aclidinium, and umeclidinium, are approved for maintenance therapy of <strong>COPD.</strong></p>\n<p style=\"text-align: left;\">Anticholinergics are less effective than&nbsp;&beta;-2 agonists as bronchodilators in asthma and are not the mainstay in the treatment of asthma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A chronic obstructive pulmonary disease (COPD) patient requires a step-up in therapy due to symptom persistence.  Which PDE-4 inhibitor can you prescribe as an add-on drug to his treatment regimen?",
    "choices": [
      {
        "id": 1,
        "text": "Seratrodast"
      },
      {
        "id": 2,
        "text": "Roflumilast"
      },
      {
        "id": 3,
        "text": "Zileuton"
      },
      {
        "id": 4,
        "text": "Nedocromil"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>Roflumilast </strong>is a <strong>PDE-4 selective inhibitor </strong>approved for use in<strong> COPD.&nbsp;</strong></p>\n<p style=\"text-align: left;\">PDE-4 is the major isoform present in inflammatory cells and its inhibition results in higher <strong>anti-inflammatory</strong> effects.&nbsp;</p>\n<p style=\"text-align: left;\">Option A:&nbsp;<strong>Seratrodast</strong> is a <strong>thromboxane receptor antagonist</strong> used in the prophylaxis of asthma. It decreases the bronchial hypersensitivity caused by thromboxane.&nbsp;</p>\n<p style=\"text-align: left;\">Option C:&nbsp;<strong>Zileuton</strong> is a <strong>lipoxygenase inhibitor</strong> that can be used in the treatment of asthma.</p>\n<p style=\"text-align: left;\">Option D:&nbsp;<strong>Nedocromil</strong> is a <strong>mast cell stabilizer</strong> indicated in the prophylaxis of asthma.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs are antitussives?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 4"
      },
      {
        "id": 2,
        "text": "1, 2 and 5"
      },
      {
        "id": 3,
        "text": "3 and 5"
      },
      {
        "id": 4,
        "text": "3 and 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>Dextromethorphan, morphine,</strong> and <strong>gabapentin</strong> are all&nbsp;<strong>antitussives</strong>.</p>\n<p style=\"text-align: left;\"><strong>Dextromethorphan</strong> is an NMDA receptor antagonist that <strong>suppresses</strong> the <strong>cough center.</strong></p>\n<p style=\"text-align: left;\">Opiates like <strong>morphine</strong>&nbsp;have a <strong>central</strong> mechanism of action on the medullary <strong>cough center</strong> and are indicated for intractable cough associated with bronchial carcinoma.&nbsp;</p>\n<p style=\"text-align: left;\"><strong>Gabapentin</strong> and pregabalin are <strong>GABA analogs</strong> that&nbsp;have been shown to benefit <strong>chronic idiopathic cough</strong> involving neural hypersensitivity.</p>\n<p style=\"text-align: left;\"><strong>Guaifenesin</strong> is an <strong>expectorant</strong> that is taken orally.</p>\n<p style=\"text-align: left;\"><strong>Carbocysteine</strong> is a <strong>mucolytic</strong> that&nbsp;reduces the disulfide bridges that bind glycoproteins to other proteins, such as albumin and secretory IgA. It is also taken orally and helps reduce the viscosity of sputum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A known case of CREST syndrome presents with dyspnea. On auscultation, a Graham-Steele murmur is heard. On further investigation, her pulmonary artery pressure is found to be 28 mm Hg. Which drug will you use to manage her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Non selective PDE inhibitors"
      },
      {
        "id": 2,
        "text": "Lipoxygenase inhibitors"
      },
      {
        "id": 3,
        "text": "Selective PDE-5 inhibitors"
      },
      {
        "id": 4,
        "text": "Cyclo-oxygenase inhibitors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">The clinical scenario points to a diagnosis of <strong>pulmonary artery hypertension </strong>(pulmonary artery pressure &gt; 20mmHg) which can be managed using<strong> selective PDE-5 inhibitors.</strong></p>\n<p style=\"text-align: left;\">Inhibition of PDE-5 in the pulmonary bed leads to a reduction in the hydrolysis of cGMP which causes pulmonary vasodilation.</p>\n<p style=\"text-align: left;\"><strong>Sildenafil </strong>and<strong>&nbsp;tadalafil</strong> are the PDE-5 inhibitors approved for use in PAH.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following groups does riociguat belong to?",
    "choices": [
      {
        "id": 1,
        "text": "Soluble guanylate cyclase stimulator"
      },
      {
        "id": 2,
        "text": "Soluble guanylate cyclase inhibitor"
      },
      {
        "id": 3,
        "text": "Soluble adenylate cyclase stimulator"
      },
      {
        "id": 4,
        "text": "Soluble adenylate cyclase inhibitor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\"><strong><strong>Riociguat </strong></strong>is a<strong><strong> soluble guanylate&nbsp;</strong></strong><strong>cyclase stimulator (sGC)</strong>, indicated in the treatment of <strong>pulmonary artery hypertension.</strong></p>\n<p style=\"text-align: left;\">Riociguat increases the sensitivity of nitric oxide to sGC and also directly stimulates the sGC enzyme resulting in <strong>increased formation of cGMP</strong>. This leads to <strong>relaxation</strong> in the <strong>pulmonary vasculature.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs is a prostacyclin analog that can be added to the treatment regimen of a patient with pulmonary artery hypertension?",
    "choices": [
      {
        "id": 1,
        "text": "Sildenafil"
      },
      {
        "id": 2,
        "text": "Misoprostol"
      },
      {
        "id": 3,
        "text": "Dinoprost"
      },
      {
        "id": 4,
        "text": "Iloprost"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Iloprost </strong>is a<strong> prostacyclin analog </strong>indicated in the management of <strong>pulmonary artery hypertension</strong>. It falls under the category of&nbsp;IP receptor (prostacyclin receptor) agonists.</p>\n<p class=\"p1\">Other drugs falling under the category of <strong>IP receptor agonists</strong> are:</p>\n<ul>\n<li class=\"p1\">\n<p class=\"p1\">Epoprostenol</p>\n</li>\n<li class=\"p1\">\n<p class=\"p1\">Treprostinil</p>\n</li>\n<li class=\"p1\">\n<p class=\"p1\">Iloprost</p>\n</li>\n<li class=\"p1\">\n<p class=\"p1\">Selexipag</p>\n</li>\n</ul>\n<p>Option A: Sildenafil is a PDE-5 inhibitor.&nbsp;</p>\n<p class=\"p1\">Option B: Misoprostol is a synthetic PGE1 analog.&nbsp;</p>\n<p>Option C: Dinoprost is a natural PGF2-alpha preparation. It should&nbsp;not be confused with dinoprostone which is a synthetic analogue of PGE2.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is a selective endothelin receptor A antagonist used in the management of pulmonary artery hypertension?",
    "choices": [
      {
        "id": 1,
        "text": "Bosentan"
      },
      {
        "id": 2,
        "text": "Ambrisentan"
      },
      {
        "id": 3,
        "text": "Tezosentan"
      },
      {
        "id": 4,
        "text": "Macitentan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>Ambrisentan</strong> is a <strong>selective</strong> endothelin receptor A (<strong>ET-A</strong>)<strong> antagonist</strong>&nbsp;which is used in the management of pulmonary artery hypertension (PAH).</p>\n<p style=\"text-align: left;\">Bosentan, tezosentan, and macitantan are&nbsp;non-selective (ET-A and ET-B) endothelin receptor antagonists.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Dornase alfa is indicated in which of the following patients?",
    "choices": [
      {
        "id": 1,
        "text": "Only 3"
      },
      {
        "id": 2,
        "text": "2, 4 and 5"
      },
      {
        "id": 3,
        "text": "3 and 5"
      },
      {
        "id": 4,
        "text": "1, 2 and 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Dornase alfa </strong>is indicated in patients with <strong>cystic fibrosis</strong> and as a rescue treatment for<strong> refractory atelectasis </strong>in newborn and pediatric populations.</p>\n<p style=\"text-align: justify;\">Dornase alfa is a <strong>recombinant DNase 1 </strong>that<strong>&nbsp;</strong>digests neutrophil DNA deposited in the pulmonary mucus thereby <strong>reducing mucosal viscoelasticity</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following should not be prescribed with theophylline?",
    "choices": [
      {
        "id": 1,
        "text": "Erythromycin"
      },
      {
        "id": 2,
        "text": "Cefotaxime"
      },
      {
        "id": 3,
        "text": "Cotrimoxazole"
      },
      {
        "id": 4,
        "text": "Amoxicillin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\"><strong>Erythromycin</strong>&nbsp;should not be prescribed with theophylline.</p>\n<p style=\"text-align: left;\">Theophylline is mainly metabolized by CYP1A2 in the liver.&nbsp;Erythromycin <strong>inhibits CYP1A2</strong> and thereby <strong>decreases</strong> the <strong>clearance</strong> of<strong> theophylline</strong>.</p>\n<p style=\"text-align: left;\">Factors decreasing the clearance of theophylline are:</p>\n<ul>\n<li style=\"text-align: left;\">Drugs - erythromycin, cimetidine, ciprofloxacin,&nbsp;allopurinol, fluvoxamine, zileuton, zafirlukast</li>\n<li style=\"text-align: left;\">Congestive heart failure</li>\n<li style=\"text-align: left;\">Liver disease</li>\n<li style=\"text-align: left;\">Pneumonia</li>\n<li style=\"text-align: left;\">Viral infection and vaccination</li>\n<li style=\"text-align: left;\">High-carbohydrate diet</li>\n<li style=\"text-align: left;\">Old age</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "If codiene is coming to the market in combination with dextromethorphan as an anti-tussive, this combination _______",
    "choices": [
      {
        "id": 1,
        "text": "Should not be used due to risk of addiction"
      },
      {
        "id": 2,
        "text": "Can be used as both have different mechanism of action"
      },
      {
        "id": 3,
        "text": "Should not be used as it is  irrational"
      },
      {
        "id": 4,
        "text": "Can be used to treat cough effectively"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>It is an <strong>irrational drug combination</strong> and should not be given.</p>\n<p><strong>Codeine</strong> is an <strong>opioid analgesic</strong> having specific antitussive action while <strong>dextromethorphan</strong> is a <strong>centrally</strong> active <strong>NMDA</strong> receptor antagonist that may be effective as an antitussive. Both are <strong>centrally acting antitussives</strong>, and do not provide any added advantage when combined. Hence it is an irrational drug combination.</p>\n<p><strong>Rational fixed-dose combination </strong>drugs for the treatment of cough usually contain:</p>\n<ul>\n<li>A centrally acting anti-tussive (either codeine or dextromethorphan; not both), with</li>\n<li>Antihistamines, decongestants and expectorants.</li>\n</ul>\n<p>Option A - Both of these drugs carry a <strong>risk of addiction,</strong> but it is not the reason to not give the drug. The main reason is that the combination is irrational.</p>\n<p>Options B &amp; D - Both codeine and dextromethorphan have<strong> different mechanisms of action</strong>&nbsp;and<strong> can treat cough effectively.</strong> However, the combination of two centrally acting antitussives does not provide any added advantage compared to using one drug alone. Hence, the combination is irrational.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '61 Respiratory System';
        let hierarchy = ["Marrow", "qBank", "Pharmacology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>