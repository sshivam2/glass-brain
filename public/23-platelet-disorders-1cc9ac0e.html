<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Platelet Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the most potent vasoconstrictor?",
    "choices": [
      {
        "id": 1,
        "text": "Endothelin"
      },
      {
        "id": 2,
        "text": "Urotensin"
      },
      {
        "id": 3,
        "text": "Angiotensin"
      },
      {
        "id": 4,
        "text": "Vasopressin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most potent vasoconstrictor is <strong>urotensin2</strong>&nbsp;followed by endothelin and angiotensin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a component of \u03b4 granules of platelets?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet-derived growth factor"
      },
      {
        "id": 2,
        "text": "Epinephrine"
      },
      {
        "id": 3,
        "text": "Fibrinogen"
      },
      {
        "id": 4,
        "text": "Platelet factor 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Epinephrine</strong> is a component of&nbsp;<strong>&delta; granules</strong> of platelets.</p>\n<p>The different components of platelet granules are:&nbsp;</p>\n<ul>\n<li>&nbsp;&alpha; granules&nbsp;\n<ul>\n<li>Fibrinogen</li>\n<li>Fibronectin</li>\n<li>PF4</li>\n<li>Factor V, VIII&nbsp;</li>\n<li>PDGF</li>\n<li>TGF</li>\n</ul>\n</li>\n<li>&nbsp;&delta; granules&nbsp;\n<ul>\n<li>ADP</li>\n<li>Calcium</li>\n<li>Serotonin</li>\n<li>Histamine</li>\n<li>Epinephrine&nbsp;</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Rees and Ecker diluting fluid is used in ______",
    "choices": [
      {
        "id": 1,
        "text": "Wintrobe tube"
      },
      {
        "id": 2,
        "text": "WBC Pipette"
      },
      {
        "id": 3,
        "text": "RBC Pipette"
      },
      {
        "id": 4,
        "text": "Hemoglobin pipette"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Rees and Ecker's solution</strong> is used as a diluting fluid in the&nbsp;<strong>RBC pipette</strong> for performing <strong>platelet counts</strong>. Its composition is:</p>\n<table style=\"height: 119px;\" width=\"240\">\n<tbody>\n<tr>\n<td style=\"width: 171.302px;\"><strong>Components</strong></td>\n<td style=\"width: 54.7396px;\"><strong>Value</strong></td>\n</tr>\n<tr>\n<td style=\"width: 171.302px;\">Sodium citrate</td>\n<td style=\"width: 54.7396px;\">3.8 g</td>\n</tr>\n<tr>\n<td style=\"width: 171.302px;\">Formaldehyde (40 %)</td>\n<td style=\"width: 54.7396px;\">0.2 ml</td>\n</tr>\n<tr>\n<td style=\"width: 171.302px;\">Brilliant cresyl blue</td>\n<td style=\"width: 54.7396px;\">0.1 g</td>\n</tr>\n<tr>\n<td style=\"width: 171.302px;\">Distilled water</td>\n<td style=\"width: 54.7396px;\">100 ml</td>\n</tr>\n</tbody>\n</table>\n<p>The <strong>steps</strong> involved in <strong>platelet</strong> <strong>count</strong> are:</p>\n<p>I - Filling the pipette</p>\n<ul>\n<li>Diluting fluid is drawn to mark 1 of the RBC pipette and expelled</li>\n<li>Blood is aspirated to 0.5 mark of the RBCs diluting pipette</li>\n<li>Diluting fluid is aspirated to 101 mark</li>\n<li>Blood and diluting fluid are mixed mechanically for 5 min</li>\n</ul>\n<p>II - Filling the counting chamber</p>\n<ul>\n<li>Allow the counting chamber to stand for 20-30 minutes to allow the platelets to settle.</li>\n<li>To prevent drying out of the preparation, it should be kept in a moist atmosphere, this is most easily arranged by placing the filled counting chamber in the bottom of a clean Petri dish, alongside which arrange a small piece of cotton wool which has been soaked in water and squeezed out. Petri dish lid is additionally put over the dish.</li>\n<li>After 20-30minutes, the counting chamber can be removed and carefully transferred to the microscope stage.</li>\n</ul>\n<p>III - Counting the number of platelets</p>\n<ul style=\"font-weight: 400;\">\n<li>Focus on the surface of the hemocytometer chamber with a high power dry objective. Dim the light to make the thrombocytes visible, and count all of the thrombocytes in the entire center 1 mm&sup2; (erythrocyte counting area) of both sides of the hemocytometer. This gives the number of thrombocytes in 0.2 l of 1: 200 dilution of blood.</li>\n<li>The number of thrombocytes counted X 1000 = number of thrombocytes/l of undiluted blood.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old girl with dengue hemorrhagic fever is being monitored by measuring platelet count. Spontaneous bleeding is associated with platelet values below _______ /\u00b5L.",
    "choices": [
      {
        "id": 1,
        "text": "30,000"
      },
      {
        "id": 2,
        "text": "50,000"
      },
      {
        "id": 3,
        "text": "20,000"
      },
      {
        "id": 4,
        "text": "10,000"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Spontaneous bleeding</strong>&nbsp;(non-traumatic) is associated with platelet values below <strong>20,000 platelets/&micro;L.</strong></p>\n<p>It most often involves small vessels. The common sites for such&nbsp;hemorrhages&nbsp;are:</p>\n<ul>\n<li>Skin</li>\n<li>Mucosa of gastrointestinal and genitourinary tracts</li>\n<li>Intracranial bleeding - most feared site of bleeding</li>\n</ul>\n<p>The <strong>production</strong> of the platelets is regulated by the hormone <strong>thrombopoietin</strong> produced in the liver.&nbsp;The platelet synthesis is also specifically <strong>increased</strong> by <strong>interleukin 6</strong>. The average <strong>lifespan</strong> of the platelets is<strong> 7&ndash;10 days</strong>. The <strong>normal</strong> platelet count is <strong>1,50,000 - 4,00,000</strong> /&micro;L.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding functional platelet disorders?",
    "choices": [
      {
        "id": 1,
        "text": "Normal platelet count and normal bleeding time"
      },
      {
        "id": 2,
        "text": "Normal platelet count and increased bleeding time"
      },
      {
        "id": 3,
        "text": "Decreased platelet count and increased bleeding time"
      },
      {
        "id": 4,
        "text": "Decreased platelet count and decreased bleeding time"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Functional platelet disorders have <strong>normal platelet count</strong> and <strong>increased bleeding time</strong>.&nbsp;</p>\n<p><strong>Classification</strong> of platelet functional disorders:</p>\n<ul>\n<li>Defect in platelet-vessel wall interaction (<strong>disorders of adhesion</strong>)\n<ul>\n<li>Von Willebrand disease - deficiency or defect in plasma vWF</li>\n<li>Bernard&ndash;Soulier syndrome - deficiency or defect in GP Ib IX</li>\n</ul>\n</li>\n<li>Defects in platelet-platelet interaction (<strong>disorders of aggregation</strong>)\n<ul>\n<li>Congenital afibrinogenemia - deficiency of plasma fibrinogen</li>\n<li>Glanzmann thrombasthenia - deficiency or defect in GPIIb-IIIa</li>\n</ul>\n</li>\n<li><strong>Disorders of platelet secretion</strong> and signal transduction\n<ul>\n<li>Storage pool deficiency - &alpha;-Granule deficiency and gamma-Granule deficiency</li>\n<li>Quebec platelet disorder</li>\n<li>Chediak&ndash;Higashi syndrome</li>\n<li>Gray platelet syndrome</li>\n<li>Wiskott&ndash;Aldrich syndrome</li>\n</ul>\n</li>\n<li><strong>Disorders of platelet coagulation-protein interaction</strong>\n<ul>\n<li>Scott syndrome - defect in factor Va-Xa interaction on platelets</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about vonWillebrand factor?",
    "choices": [
      {
        "id": 1,
        "text": "It is synthesized by hepatocytes"
      },
      {
        "id": 2,
        "text": "Its deficiency can also cause factor VIII defect"
      },
      {
        "id": 3,
        "text": "Its deficiency may cause defective platelet adhesion"
      },
      {
        "id": 4,
        "text": "It serves as a carrier for factor VIII"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Von Willebrand factor (<strong>vWF</strong>) is not synthesized by hepatocytes. They are <strong>produced</strong> by <strong>endothelial</strong> <strong>cells</strong> of <strong>liver</strong> and <strong>megakaryocytes</strong>. It&nbsp;is also found in:</p>\n<ul>\n<li>Platelet granules - lesser compared to endothelial cells</li>\n<li>Endothelial cells within cytoplasmic vesicles called Weibel-Palade bodies</li>\n<li>Subendothelium - binds to collagen</li>\n</ul>\n<p>It mediates the <strong>adhesion</strong> of <strong>platelets</strong> to sites of vascular injury (subendothelium). It links the exposed collagen to platelets. It facilitates platelet to platelet interaction and also stabilizes the hemostatic plug against shear forces.&nbsp;</p>\n<p>It is a carrier protein for factor VIII&nbsp;and also protects it from proteolytic degradation and&nbsp;stabilizes it.&nbsp;The&nbsp;<strong>half-life</strong> of <strong>factor</strong>&nbsp;<strong>VIII</strong> is about 2.4 hours when free and <strong>12 hours</strong> when <strong>bound</strong> to <strong>vWF</strong> in the circulation.</p>\n<p>Since vWF <strong>stabilizes</strong> <strong>factor VIII</strong>, a deficiency of vWF gives rise to a secondary decrease&nbsp;in factor VIII levels.&nbsp;This may be reflected by a prolongation of the partial thromboplastin time (PTT) in von Willebrand disease types 1 and 3.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b48397155f047a8a2cf821bee2aa392x1280x2261.JPEG"
    ]
  },
  {
    "text": "A 24-year-old woman is found to have uncontrolled bleeding after a minor cut injury. Her lab investigations are given below. Which of the following statements are false about her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Type 1 is most common"
      },
      {
        "id": 2,
        "text": "Type 2 is a qualitative defect"
      },
      {
        "id": 3,
        "text": "Type 3 is inherited as autosomal dominant"
      },
      {
        "id": 4,
        "text": "Type 3 is the severe form"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>von Willebrand\u00a0disease</strong> (vWD). <strong>Type 3</strong> vWD is inherited as an <strong>autosomal recessive</strong> disease.\u00a0</p>\n<p>The characteristics of different subtypes of vWD are:</p>\n<table>\n<tbody>\n<tr>\n<td>\n<p><strong>Subtype</strong></p>\n</td>\n<td>\n<p><strong>Description</strong></p>\n</td>\n<td>\n<p><strong>Inheritance</strong></p>\n</td>\n<td>\n<p><strong>Lab findings</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Type 1</p>\n</td>\n<td>\n<p>Quantitative deficiency of vWF</p>\n</td>\n<td>\n<p>Autosomal dominant</p>\n</td>\n<td>\n<p>Reduced vWF antigen, activity and Factor VIII</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Type 2</p>\n</td>\n<td>\n<p>Qualitative defect in vWF</p>\n</td>\n<td>\n<p>Autosomal dominant</p>\n</td>\n<td>\n<p>Reduced vWF activity to antigen ration&lt;0.6</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Type 3</p>\n</td>\n<td>\n<p>Near-complete (quantitative) deficiency of Factor VIII</p>\n</td>\n<td>\n<p>Autosomal recessive</p>\n</td>\n<td>\n<p>Marked reduction or absence in Factor VIII levels</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Type</strong> <strong>1</strong> is the <strong>most common</strong> subtype of vWD. In Type 2,\u00a0<strong>vWF</strong> is expressed in <strong>normal</strong> <strong>amounts</strong>, but missense mutations are present that lead to <strong>defective</strong> <strong>multimer</strong> <strong>assembly</strong>. This type has several subtypes, of which type <strong>2A</strong> is the <strong>most common</strong>.</p>\n<p><strong>Laboratory findings</strong> in vWD:</p>\n<ul>\n<li>Prolonged bleeding time</li>\n<li>Normal platelet count</li>\n<li>Hess test - positive tourniquet test due to\u00a0defective platelet adhesion\u00a0</li>\n<li>Ristocetin-induced aggregation - defective and diagnostic of this disease</li>\n<li>Platelet aggregation with ADP, collagen, and thrombin - normal</li>\n<li>Increased aPTT</li>\n</ul>\n<p>Though the synthesis of factor VIII remains normal, the\u00a0half-life of VIII in plasma decreases due to reduced vWF (carrier) levels. This leads to <strong>secondary VIIIC deficiency</strong> in plasma. So, the intrinsic pathway of coagulation is affected. Hence,\u00a0<strong>aPTT</strong> is <strong>increased</strong> in these patients.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following occurs due to a defect in \u03b4 granules of the platelets?",
    "choices": [
      {
        "id": 1,
        "text": "Quebec platelet syndrome"
      },
      {
        "id": 2,
        "text": "Grey platelet syndrome"
      },
      {
        "id": 3,
        "text": "Wiskott\u2013Aldrich syndrome"
      },
      {
        "id": 4,
        "text": "Hermansky\u2013Pudlak syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hermansky&ndash;Pudlak&nbsp;syndrome</strong> occurs due to a&nbsp;<strong>defect</strong> in platelet&nbsp;<strong>&delta; granules</strong>.</p>\n<p>Platelet granules disorders include:&nbsp;</p>\n<ul style=\"font-weight: 400;\">\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"14\" aria-setsize=\"-1\" data-aria-posinset=\"1\" data-aria-level=\"1\"><strong>Gray platelet syndrome</strong>&nbsp;- involves <strong>&alpha;</strong> granules and characterized by&nbsp;thrombocytopenia with large platelets&nbsp;that&nbsp;appear&nbsp;pale on the peripheral smear (due to deficiency of the &alpha; granules)</li>\n<li><strong>Quebec platelet syndrome</strong> - defect in<strong>&nbsp;&alpha; </strong>granules&nbsp;</li>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"14\" aria-setsize=\"-1\" data-aria-posinset=\"2\" data-aria-level=\"1\"><strong>Hermansky&ndash;Pudlak&nbsp;syndrome</strong>&nbsp;- defect in&nbsp;<strong>&delta; </strong>granules and characterized by&nbsp;hypopigmentation and bleeding manifestation</li>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"14\" aria-setsize=\"-1\" data-aria-posinset=\"3\" data-aria-level=\"1\"><strong>Wiskott&ndash;Aldrich syndrome</strong> - mutations in the&nbsp;<strong><em>WASp </em>gene&nbsp;</strong>expressed in the X chromosome and characterized by microthrombocytopenia, eczema, recurrent infections</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with large platelets on peripheral smear is diagnosed to have Bernard-Soulier disease. Deficiency of which of the following causes this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gp IIb/ IIIa"
      },
      {
        "id": 2,
        "text": "Gp Ib/ IX"
      },
      {
        "id": 3,
        "text": "von Willebrand factor"
      },
      {
        "id": 4,
        "text": "Factor VIII"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\"><strong>Bernard&ndash;Soulier</strong> disease is due to <strong>deficiency</strong> of <strong>Gp Ib/ IX.</strong></p>\n<p class=\"p1\">Bernard&ndash;Soulier syndrome is characterized by<strong> large platelets</strong>. Ristocetin aggregation is abnormal.</p>\n<table class=\"t1\" style=\"width: 518px;\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td class=\"td1\" style=\"width: 170px;\" valign=\"top\">\n<p class=\"p1\"><strong>Deficiency</strong></p>\n</td>\n<td class=\"td1\" style=\"width: 170.105px;\" valign=\"top\">\n<p class=\"p1\"><strong>Defect</strong></p>\n</td>\n<td class=\"td1\" style=\"width: 170.895px;\" valign=\"top\">\n<p class=\"p1\"><strong>Disease</strong></p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" style=\"width: 170px;\" valign=\"top\">\n<p class=\"p1\">Gp Ib/IX</p>\n</td>\n<td class=\"td1\" style=\"width: 170.105px;\" valign=\"top\">\n<p class=\"p1\">Adhesion of platelets</p>\n</td>\n<td class=\"td1\" style=\"width: 170.895px;\" valign=\"top\">\n<p class=\"p1\">Bernard&ndash;Soulier syndrome</p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" style=\"width: 170px;\" valign=\"top\">\n<p class=\"p1\">Gp IIb/IIIa</p>\n</td>\n<td class=\"td1\" style=\"width: 170.105px;\" valign=\"top\">\n<p class=\"p1\">Aggregation of platelets</p>\n</td>\n<td class=\"td1\" style=\"width: 170.895px;\" valign=\"top\">\n<p class=\"p1\">Glanzmann thrombasthenia</p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" style=\"width: 170px;\" valign=\"top\">\n<p class=\"p1\">von Willebrand factor</p>\n</td>\n<td class=\"td1\" style=\"width: 170.105px;\" valign=\"top\">\n<p class=\"p1\">Adhesion&gt;Aggregation</p>\n</td>\n<td class=\"td1\" style=\"width: 170.895px;\" valign=\"top\">\n<p class=\"p1\">Von Willebrand disease</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p class=\"p2\">Factor VIII deficiency causes hemophilia.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c1e01cfa3e2477998ffbbf290baa16bx1280x2261.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false about Bernard-Soulier syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "There is defective adhesion of platelets to sub-endothelial matrix"
      },
      {
        "id": 2,
        "text": "Deficiency of the platelet membrane glycoprotein complex Ib-IX is seen"
      },
      {
        "id": 3,
        "text": "Platelet aggregation by ristocetin is normal"
      },
      {
        "id": 4,
        "text": "It has an autosomal recessive inheritance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>Bernard&ndash;Soulier</strong> syndrome, platelet aggregation by <strong>ristocetin</strong> is abnormal.</p>\n<p>The&nbsp;<strong>receptor</strong> for <strong>vWF </strong>i.e.<strong>&nbsp;Ib-IX</strong>&nbsp;is essential for normal <strong>platelet adhesion</strong> to the subendothelial extracellular matrix. In this condition, there is&nbsp;<strong>deficiency</strong>&nbsp;of&nbsp;<strong>Gp Ib/ IX.&nbsp;</strong>Clinical manifestations include epistaxis, ecchymoses, menorrhagia, gingival bleeding, and gastrointestinal bleeding.</p>\n<p><strong>Laboratory findings</strong> seen in Bernard-Soulier syndrome:</p>\n<ul>\n<li>Prolonged bleeding time</li>\n<li>Moderate thrombocytopenia</li>\n<li>Platelet aggregation by ristocetin is deficient (but ADP, arachidonic acid, epinephrine, collagen - normal).</li>\n<li>Clot retraction - normal</li>\n<li>Abnormally large platelets</li>\n</ul>\n<p>The image given below shows the abnormally large platelets on peripheral smear seen in Bernard-Soulier syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6c79ad5771a4dbe877613fdacf564d3x519x391.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99d5b89d5c39449dbe3d65dedfd2492ex1280x2261.JPEG"
    ]
  },
  {
    "text": "A 4-year-old girl with a history of easy bruising was referred for further evaluation. Her previous lab reports showed that platelet count and morphology were normal. Platelet aggregations tests are given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bernard-Soulier syndrome"
      },
      {
        "id": 2,
        "text": "Grey platelet syndrome"
      },
      {
        "id": 3,
        "text": "von Willebrand Disease"
      },
      {
        "id": 4,
        "text": "Glanzmann thrombasthenia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Glanzmann thrombasthenia</strong>.</p>\n<p>It is an abnormality of platelet <strong>GPIIb-IIIa</strong> (<strong>fibrinogen receptor</strong>).&nbsp;Platelets are unable to adhere to each other and to the underlying tissue of the damaged blood vessels. It is inherited in an&nbsp;<strong>autosomal recessive</strong>&nbsp;manner. The symptoms include&nbsp;mucocutaneous bleeding in the neonatal period, menorrhagia, ecchymoses, epistaxis, and gingival hemorrhage.</p>\n<p><strong>Types </strong>of&nbsp;Glanzmann thrombasthenia<strong>&nbsp;</strong>include:</p>\n<ul>\n<li>Type 1: Absence of GPIIb-IIIa</li>\n<li>Type 2: Reduced surface expression of GPIIb-IIIa/ Essentialis athrombia - clot retraction is normal</li>\n<li>Type 3: Dysfunction of GPIIb-IIIa</li>\n</ul>\n<p><strong>Laboratory features&nbsp;</strong>of&nbsp;Glanzmann thrombasthenia:</p>\n<ul>\n<li>Normal platelet count and morphology</li>\n<li>Platelet aggregation occurs in response to ristocetin, but not to other agonists (such as ADP, thrombin, collagen or epinephrine)</li>\n<li>Clot retraction is absent</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 1-year-old boy is brought with a history of recurrent impetigo. Physical examination findings are given below. Platelet counts are low and peripheral smear shows abnormally small-sized platelets. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Idiopathic thrombocytopenia purpura"
      },
      {
        "id": 2,
        "text": "Bernard-Soulier syndrome"
      },
      {
        "id": 3,
        "text": "Disseminated intravascular coagulation"
      },
      {
        "id": 4,
        "text": "Wiskott-Aldrich syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>Wiskott&ndash;Aldrich syndrome </strong>(WAS). The given image shows (A) multiple petechiae over face and hematoma under the right eye and (B) eczema of the foot.&nbsp;</p>\n<p>This syndrome is an <strong>X-linked recessive,</strong>&nbsp;primary <strong>immunodeficiency</strong> disorder involving the WAS gene. It is characterised by the <strong>triad </strong>of:</p>\n<ul>\n<li>Severe eczema</li>\n<li>Thrombocytopenia</li>\n<li>Recurrent infections</li>\n</ul>\n<p><strong>Small platelets</strong> are seen in:</p>\n<ul>\n<li>Wiskott&ndash;Aldrich syndrome</li>\n<li>X-linked thrombocytopenia</li>\n</ul>\n<p><strong>Large platelets </strong>are seen in:</p>\n<ul>\n<li>Bernard-Soulier syndrome</li>\n<li>Myeloproliferative syndrome</li>\n<li>Myelodysplastic syndrome</li>\n<li>May&ndash;Hegglin anomaly</li>\n<li>Gray platelet syndrome</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9ac63126e8a842d9a7192bf63b487307.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman presents with epistaxis, easy bruising and menorrhagia. There is no history of drug intake. Physical examination shows scattered petechiae and a normal-sized spleen. Her lab investigations are given below. Antibodies against which of the following can lead to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "vWF"
      },
      {
        "id": 2,
        "text": "Glycoprotein IIb/IIIa"
      },
      {
        "id": 3,
        "text": "ADAMTS13"
      },
      {
        "id": 4,
        "text": "Thromboxane A2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of<strong>&nbsp;chronic immune thrombocytopenic purpura</strong> (ITP). <strong>Autoantibodies</strong> seen in ITP are most often directed against platelet membrane <strong>glycoproteins</strong> <strong>IIb-IIIa</strong> or Ib-IX. It is<strong>&nbsp;</strong>a diagnosis of exclusion<strong>&nbsp;</strong>due to the&nbsp;following findings:</p>\n<ul>\n<li>Bleeding tendency - petechiae</li>\n<li>Low platelet count, elevated bleeding time</li>\n<li>Presence of megathrombocytes in the peripheral smear - a sign of accelerated thrombopoiesis</li>\n<li>Female preponderance</li>\n<li>Absence of splenomegaly</li>\n</ul>\n<p>&nbsp;Note: Prothrombin time (PT) is normal in ITP.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which class of antiplatelet antibodies are seen in patients with chronic immune thrombocytopenic purpura?",
    "choices": [
      {
        "id": 1,
        "text": "Ig G"
      },
      {
        "id": 2,
        "text": "Ig A"
      },
      {
        "id": 3,
        "text": "Ig M"
      },
      {
        "id": 4,
        "text": "Ig E"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Antiplatelet antibodies</strong> in <strong>chronic</strong> immune thrombocytopenic purpura (<strong>ITP</strong>) are mainly <strong>IgG</strong> class.</p>\n<p>Autoantibodies most often directed against platelet membrane glycoproteins are IIb-IIIa or Ib-IX. It can be demonstrated in the plasma and bound to the platelet surface in about 80% of patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old woman is diagnosed to have idiopathic ITP. Which of the following features is least likely to be seen in her?",
    "choices": [
      {
        "id": 1,
        "text": "Megathrombocytes"
      },
      {
        "id": 2,
        "text": "Petechiae and ecchymosis"
      },
      {
        "id": 3,
        "text": "Lymphadenopathy"
      },
      {
        "id": 4,
        "text": "Normal PT and PTT"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Acute ITP</strong>&nbsp;is mainly a disease of childhood.&nbsp;It occurs with equal frequency in both sexes, mostly after a <strong>viral illness.</strong>&nbsp;It is self-limited condition, resolves within 6 months.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/23c3c4d917114552a31d6213d52fa422x800x559.JPEG"
    ]
  },
  {
    "text": "Patients with which of the following predisposing conditions are likely to develop chronic immune thrombocytopenic purpura?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "2, 3, 4, 5"
      },
      {
        "id": 3,
        "text": "1, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Systemic lupus erythematosus, HIV infection, chronic&nbsp;lymphocytic leukemia, antiphospholipid antibody syndrome&nbsp;can predispose to the development of secondary immune thrombocytopenic purpura (ITP).</p>\n<p>The <strong>predisposing conditions</strong> of <strong>secondary</strong> chronic <strong>ITP</strong> include:</p>\n<ul>\n<li>Autoimmune conditions\n<ul>\n<li>Systemic lupus erythematosus (SLE)</li>\n<li>Antiphospholipid antibody syndrome (APS)</li>\n<li>Immune thyroid disease</li>\n<li>Evans syndrome</li>\n</ul>\n</li>\n<li>Lymphoproliferative diseases\n<ul>\n<li>Chronic lymphocytic leukemia</li>\n<li>Large granular T-lymphocyte lymphocytic leukemia</li>\n</ul>\n</li>\n<li>Chronic infection\n<ul>\n<li>Helicobacter pylori</li>\n<li>Human immunodeficiency virus (HIV)</li>\n<li>Hepatitis C virus (HCV)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 63-year-old man with moderate COVID pneumonia developed DVT. Therapeutic anticoagulation with heparin was started. His lab investigations are given below. Which of the following is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Antibodies recognise heparin-platelet factor 4 complex"
      },
      {
        "id": 2,
        "text": "Lesser incidence with use of LMWH"
      },
      {
        "id": 3,
        "text": "Pulmonary thromboembolism is a complication"
      },
      {
        "id": 4,
        "text": "It is a self-resolving condition"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>type II</strong>&nbsp;heparin-induced thrombocytopenia (<strong>HIT</strong>). It is <strong>not self-resolving.</strong></p>\n<p>Thrombocytopenia occurs in about 5% of persons receiving heparin and is of two types:</p>\n<table style=\"height: 145px;\" width=\"550\">\n<tbody>\n<tr>\n<td style=\"width: 176px;\"><strong>Feature</strong></td>\n<td style=\"width: 176px;\"><strong>Type I</strong></td>\n<td style=\"width: 176px;\"><strong>Type II</strong></td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Incidence</td>\n<td style=\"width: 176px;\">More common</td>\n<td style=\"width: 176px;\">Less common</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Occurrence&nbsp;</td>\n<td style=\"width: 176px;\">Rapidly after onset of therapy</td>\n<td style=\"width: 176px;\">5 to 14 days after therapy</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Pathogenesis</td>\n<td style=\"width: 176px;\">Direct&nbsp;platelet-aggregating effect of heparin</td>\n<td style=\"width: 176px;\">Antibodies against heparin-platelet factor 4 complexes</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Severity</td>\n<td style=\"width: 176px;\">Less severe</td>\n<td style=\"width: 176px;\">Often leads to life-threatening venous and arterial thrombosis</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Treatment</td>\n<td style=\"width: 176px;\">Self-resolving</td>\n<td style=\"width: 176px;\">\n<p>Immediate discontinuation of heparin</p>\n<p>Alternate non-heparin anticoagulant to be used</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following commonly cause drug-induced thrombocytopenia except _____",
    "choices": [
      {
        "id": 1,
        "text": "Vancomycin"
      },
      {
        "id": 2,
        "text": "Quinine"
      },
      {
        "id": 3,
        "text": "Rifampin"
      },
      {
        "id": 4,
        "text": "Terlipressin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Terlipressin does not cause drug-induced thrombocytopenia.</p>\n<p>Drug-induced thrombocytopenia can be caused by:</p>\n<ul>\n<li>Vancomycin</li>\n<li>Quinine&nbsp;</li>\n<li>Rifampin</li>\n</ul>\n<p>They cause thrombocytopenia through <strong>direct effects</strong>&nbsp;on platelets or secondary&nbsp;to <strong>immunologically</strong> <strong>mediated</strong>&nbsp;platelet destructions.&nbsp;Quinine, quinidine, and&nbsp;vancomycin bind to platelet glycoprotein and&nbsp;create antigenic determinants&nbsp;that are recognized by antibodies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A post-operative patient was started on prophylactic unfractionated heparin for DVT. Which of the following is false regarding this drug?",
    "choices": [
      {
        "id": 1,
        "text": "It is an indirect thrombin-factor Xa inhibitor"
      },
      {
        "id": 2,
        "text": "It is safe in patients with renal impairment"
      },
      {
        "id": 3,
        "text": "It requires monitoring with aPTT"
      },
      {
        "id": 4,
        "text": "On development of HIT, LMWH can be started alternately"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The risk of severe heparin-induced thrombocytopenia is&nbsp;lowered with LMWH but not eliminated. Hence, once severe <strong>HIT</strong> <strong>develops</strong>&nbsp;even <strong>LMWH</strong> exacerbates the thrombotic tendency&nbsp;and&nbsp;must be <strong>avoided</strong>.</p>\n<p>Management of HIT includes the immediate withdrawal of heparin therapy and instituting an alternative non-heparin anticoagulant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with which of the following conditions is associated with ADAMTS13 deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "Immune thrombocytopenic purpura"
      },
      {
        "id": 2,
        "text": "Hemolytic uremic syndrome"
      },
      {
        "id": 3,
        "text": "Thrombotic thrombocytopenic purpura"
      },
      {
        "id": 4,
        "text": "Von Willebrand disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>ADAMTS13 deficiency</strong> is associated with thrombotic thrombocytopenic purpura (<strong>TTP</strong>).</p>\n<p>ADAMTS13 is also called <strong>vWF metalloprotease</strong> which <strong>degrades</strong> very high-molecular-weight <strong>multimers</strong> of von Willebrand factor (<strong>vWF</strong>). Its deficiency causes accumulation of these multimers in the plasma and promotes platelet activation and aggregation.</p>\n<p>TTP is a part of a spectrum of clinical syndromes called <strong>thrombotic microangiopathy.</strong>&nbsp;They are caused by insults that lead to excessive activation of platelets, which deposit as thrombi in small blood vessels.</p>\n<p><strong>Features</strong> of TTP include:</p>\n<ul>\n<li>Fever</li>\n<li>Thrombocytopenia</li>\n<li>Microangiopathic hemolytic anaemia</li>\n<li>Transient neurologic deficits</li>\n<li>Renal failure</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old girl is brought with complaints of hematuria and melena for 10 days. Laboratory investigations reveal mild thrombocytopenia and normal coagulation tests. Peripheral smear is given below. Which organism is most frequently involved in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "E.coli O157:H7"
      },
      {
        "id": 2,
        "text": "Shigella"
      },
      {
        "id": 3,
        "text": "Enteroinvasive E.coli"
      },
      {
        "id": 4,
        "text": "Salmonella"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and peripheral smear showing <strong>helmet cells</strong> or <strong>schistocytes</strong> are suggestive of <strong>h</strong><strong>emolytic uremic syndrome </strong>(HUS)<strong>.&nbsp;</strong>This condition&nbsp;is most commonly associated with enterohemorrhagic&nbsp;<strong>Escherichia coli</strong> strain&nbsp;<strong>O157: H7&nbsp;</strong>worldwide.</p>\n<p>This strain releases<strong>&nbsp;Shiga-like toxin</strong>.&nbsp;This toxin is absorbed from the inflamed gastrointestinal mucosa into the circulation and causes <strong>endothelial</strong> <strong>dysfunction</strong>. It leads to <strong>platelet </strong>activation and <strong>aggregation</strong>. Children and older adults are at the highest risk.</p>\n<p>The image given below shows schistocytes or helmet cells seen in HUS.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9d74b8d51ae54c0b8d11fd94e1a8222d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ed110bae6299454e81bda8f6e444230fx799x600.JPEG"
    ]
  },
  {
    "text": "Deficiency of which of the following complement components is not associated with atypical hemolytic uremic syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Factor H"
      },
      {
        "id": 2,
        "text": "CD46"
      },
      {
        "id": 3,
        "text": "Factor I"
      },
      {
        "id": 4,
        "text": "CD59"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Atypical hemolytic uremic syndrome</strong> is not associated with deficiency of CD59.</p>\n<p>It<strong>&nbsp;</strong>is&nbsp;<strong>associated</strong> with <strong>deficiency</strong>&nbsp;of the following components:</p>\n<ul>\n<li>Complement factor H</li>\n<li>Membrane cofactor protein (CD46)</li>\n<li>Complement factor I</li>\n</ul>\n<p>These&nbsp;three proteins <strong>prevent</strong> <strong>excessive</strong> <strong>activation</strong> of the <strong>alternative</strong> <strong>complement</strong> pathway.</p>\n<p>Deficiencies of these proteins can be caused by inherited defects or acquired inhibitory autoantibodies. The disease may be associated with a remitting, relapsing course.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Coombs test is found to be positive in a patient with thrombocytopenia. Which of the following conditions could be a likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Thrombotic thrombocytopenic purpura"
      },
      {
        "id": 2,
        "text": "Hemolytic uremic syndrome"
      },
      {
        "id": 3,
        "text": "Immune thrombocytopenic purpura"
      },
      {
        "id": 4,
        "text": "Disseminated intravascular coagulation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span class=\"TextRun SCXW155232901\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW155232901\"><strong>Coombs test</strong> is <strong>positive</strong> in immune thrombocytopenic purpura (<strong>ITP</strong>) as it is an <strong>immunogenic</strong> cause of thrombocytopenia. </span></span></p>\n<p><span class=\"TextRun SCXW155232901\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW155232901\">Thrombotic thrombocytopenic purpura (TTP), hemolytic uremic syndrome (HUS) and disseminated intravascular coagulation (DIC) are&nbsp;</span></span><span class=\"TextRun SCXW155232901\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW155232901\">nonimmunogenic</span></span><span class=\"TextRun SCXW155232901\" lang=\"EN-GB\" xml:lang=\"EN-GB\"><span class=\"NormalTextRun SCXW155232901\">&nbsp;causes. Hence, Coombs test is negative in these conditions.</span></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fed5d26856c9438791b8f719e7cd9b1dx1280x1927.JPEG"
    ]
  },
  {
    "text": "Which of the following is affected in patients with Weber-Osler-Rendu syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Collagen"
      },
      {
        "id": 2,
        "text": "Platelets"
      },
      {
        "id": 3,
        "text": "Clotting factors"
      },
      {
        "id": 4,
        "text": "Blood vessels"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Weber&ndash;Osler&ndash;Rendu syndrome</strong> is a disorder of the <strong>blood vessels</strong>.</p>\n<p>It is an <strong>autosomal-dominant</strong> disorder caused by mutations that modulate TGF-&beta; signalling. It is also known as <strong>hereditary hemorrhagic telangiectasia</strong>.&nbsp;</p>\n<p>This condition is characterized by dilated, <strong>tortuous blood vessels</strong> with thin walls that <strong>bleed</strong> readily.&nbsp;Bleeding is most common in the mucous membranes of the nose (epistaxis), tongue, mouth, and eyes, and throughout the gastrointestinal tract.</p>\n<p>Platelet count, prothrombin time (PT), and activated partial thromboplastin time (aPTT) are normal.</p>\n<p>Clinical conditions in which <strong>abnormalities</strong> of <strong>vessel wall</strong> cause <strong>bleeding </strong>include<strong>:</strong></p>\n<ul>\n<li>Infections - meningococcemia, infective endocarditis, rickettsioses</li>\n<li>Collagen defects - Ehlers&ndash;Danlos syndrome, scurvy, and Cushing's syndrome</li>\n<li>Perivascular amyloidosis - most common with amyloid light-chain (AL) amyloidosis</li>\n<li>Henoch&ndash;Sch&ouml;nlein purpura</li>\n<li>Drug reactions</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '23 Platelet Disorders';
        const quizFilename = '23-platelet-disorders-1cc9ac0e.html';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>