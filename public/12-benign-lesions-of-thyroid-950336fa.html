<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Benign Lesions Of Thyroid - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most common site for a thyroglossal cyst?",
    "choices": [
      {
        "id": 1,
        "text": "Suprahyoid"
      },
      {
        "id": 2,
        "text": "Infrahyoid"
      },
      {
        "id": 3,
        "text": "At the level of the hyoid"
      },
      {
        "id": 4,
        "text": "Floor of the mouth"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A thyroglossal duct cyst is a congenital midline neck swelling that typically presents during childhood. Normally, the <strong>thyroglossal duct</strong> regresses once the thyroid gland has completely descended. If it <strong>fails </strong>to<strong> regress</strong>, a thyroglossal duct <strong>cyst</strong> is formed.</p>\n<p>It can be differentiated from other midline neck swellings by the following features:\u00a0</p>\n<ul>\n<li>Can be moved sideways but not vertically</li>\n<li>Moves with both deglutition and tongue\u00a0protrusion</li>\n</ul>\n<p>Surgical management of a thyroglossal cyst is via\u00a0<strong>Sistrunk procedure.</strong></p>\n<p>Note: Presence of thyroid in the midline posterior 1/3rd of tongue is called lingual thyroid. It is due to failure of descent of the thyroglossal duct during development.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baaef1d7a80f42eab32b820d3c6b9191x1280x1297.JPEG"
    ]
  },
  {
    "text": "A 25-year-old patient presented with neck swelling which moves with deglutition as shown below. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Branchial cyst"
      },
      {
        "id": 2,
        "text": "Cystic hygroma"
      },
      {
        "id": 3,
        "text": "Thyroglossal cyst"
      },
      {
        "id": 4,
        "text": "Cervical lymphadenopathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Clinical features of thyroglossal cyst:</p>\n<ul>\n<li>Classically the cyst <strong>moves upwards</strong> on <strong>swallowing</strong> and on<strong> tongue protrusion.</strong>&nbsp;This indicates attachment to the hyoid bone.&nbsp;</li>\n<li>Swelling is smooth, soft, fluctuant (cystic), nontender, mobile, often transilluminant.</li>\n<li>Thyroid fossa is empty, if there is no thyroid in the normal location.</li>\n</ul>\n<div class=\"page\" title=\"Page 467\">\n<p>Complications of thyroglossal cyst:</p>\n<ul>\n<li>The most common complication is&nbsp;<strong>infection.</strong></li>\n<li>Thyroglossal&nbsp;<strong>fistula</strong>&nbsp;is an acquired condition that either follows&nbsp;<strong>infection</strong>&nbsp;of the cyst which&nbsp;<strong>bursts open or</strong>&nbsp;due to&nbsp;<strong>inadequate removal</strong>&nbsp;of the cyst.</li>\n<li>1% of thyroglossal duct cysts are found to be malignant of which the most common type of&nbsp;<strong>cancer</strong>&nbsp;is&nbsp;<strong>papillary</strong>&nbsp;(85%).</li>\n</ul>\n</div>\n<div class=\"page\" title=\"Page 467\">Neck swellings that move with deglutition are:</div>\n<ul>\n<li aria-level=\"1\">Thyroid swellings</li>\n<li aria-level=\"1\">Subhyoid bursitis&nbsp;</li>\n<li aria-level=\"1\">Dermoid cysts attached to the hyoid bone</li>\n</ul>\n<p>However, only the <strong>thyroglossal cyst</strong>&nbsp;<strong>moves</strong>&nbsp;with<strong>&nbsp;tongue protrusion</strong>. This is because the duct extends from the foramen caecum of the tongue to the isthmus of the gland.&nbsp;</p>\n<p><strong>Sistrunk&rsquo;s operation&nbsp;</strong>is performed to excise the cyst and prevent a recurrence. It involves the <strong>excision&nbsp;</strong>of the&nbsp;<strong>whole thyroglossal tract,</strong>&nbsp;involving removal of the&nbsp;<strong>body of the hyoid bone</strong>, and&nbsp;<strong>suprahyoid tract</strong>&nbsp;through the tongue base to the vallecula at the site of the primitive foramen caecum along with the core of tissue on either side.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5a7d0bb849b4aa1bf7db6cc51aca449.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98e4985058c24cb1ae1cbf0c79b41648x1280x1297.JPEG"
    ]
  },
  {
    "text": "A child with a midline swelling on the neck is being prepared for a Sistrunk procedure. Along with en bloc cystectomy, which of the following structures will be resected?",
    "choices": [
      {
        "id": 1,
        "text": "Thyroglossal tract and part of thyroid"
      },
      {
        "id": 2,
        "text": "Central hyoid bone and thyroglossal tract"
      },
      {
        "id": 3,
        "text": "Thyroglossal tract only"
      },
      {
        "id": 4,
        "text": "Thyroglossal tract and associated cervical lymph nodes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sistrunk</strong> operation involves en bloc cystectomy with <strong>excision</strong> of the entire<strong> thyroglossal tract</strong> till the base of the tongue along with the <strong>central hyoid bone</strong>.</p>\n<p>It is the procedure of choice for the surgical management of thyroglossal duct cysts. It is done to <strong>prevent recurrence</strong>\u00a0and <strong>malignant</strong> transformation.\u00a0</p>\n<p>The most common malignancy in thyroglossal cysts is <strong>papillary</strong> thyroid carcinoma. In such a case,\u00a0<strong>Sistrunk operation </strong>with<strong> total thyroidectomy</strong>\u00a0is considered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a nodule of the neck presents to the surgery OPD. A junior resident performs the following method to palpate it. Identify the procedure shown in the video below.",
    "choices": [
      {
        "id": 1,
        "text": "Lahey's method"
      },
      {
        "id": 2,
        "text": "Crile's method"
      },
      {
        "id": 3,
        "text": "Kocher's method"
      },
      {
        "id": 4,
        "text": "Pemberton's  method"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option C: <strong>Kocher's method</strong> is done to demonstrate the <strong>pressure effect</strong> of the thyroid gland on the <strong>trachea</strong> or <strong>larynx</strong>. <strong>Lateral</strong> <strong>compression</strong> will result in <strong>stridor</strong>.</p>\n<p>Option D: <strong>Pemberton's</strong> <strong>sign </strong>(not method), is <strong>engorgement of neck veins </strong>when the patient is asked to raise their hands above the head and the arms should touch the ears. It is seen in patients with <strong>retrosternal goiter.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/263233731a97445ba5cad0ce70d913a8.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ce429ab8ae72405d88b511078b9a3737x720x734.GIF"
    ]
  },
  {
    "text": "A patient with a solitary, 2x3 cm, nodular thyroid swelling came to your clinic with a recent report that showed elevated T4 and normal TSH levels.  What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Fine needle aspiration cytology (FNAC)"
      },
      {
        "id": 2,
        "text": "Ultrasound"
      },
      {
        "id": 3,
        "text": "Thyroid autoantibodies"
      },
      {
        "id": 4,
        "text": "Radioactive iodine uptake test (RAIU)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ultrasonography</strong>\u00a0is the\u00a0next best step in the evaluation of a euthyroid (normal TSH) patient with a solitary thyroid nodule.\u00a0USG is a non-invasive and inexpensive way to <strong>stratify the risk </strong>of the nodule into benign or malignant tissue.</p>\n<p><strong>Benign</strong> nodules are easily <strong>compressible</strong> and can be seen to <strong>deform </strong>by applying pressure\u00a0with the probe while performing USG. <strong>M</strong><strong>alignant </strong>nodules tend to be <strong>hard</strong> and <strong>firm.</strong>\u00a0</p>\n<p>Ultrasound findings of a nodule that are considered <strong>suspicious</strong> of\u00a0<strong>malignancy</strong> include:</p>\n<ul>\n<li class=\"p1\">Microcalcifications</li>\n<li class=\"p1\">Hypervascularity</li>\n<li class=\"p1\">Infiltrative margins</li>\n<li class=\"p1\">Hypoechoic compared with surrounding parenchyma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ccbb6735c3814342bab6940ff52c3567x1280x2317.JPEG"
    ]
  },
  {
    "text": "FNAC report of a patient with discrete thyroid swelling shows a Thy2 lesion. What do you infer from this report?",
    "choices": [
      {
        "id": 1,
        "text": "Follicular lesion"
      },
      {
        "id": 2,
        "text": "Non-neoplastic lesion"
      },
      {
        "id": 3,
        "text": "Lesion suspicious of malignancy"
      },
      {
        "id": 4,
        "text": "Cystic lesion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>FNAC report of<strong> Thy2</strong> indicates a\u00a0<strong>non-neoplastic</strong> lesion.\u00a0</p>\n<p>Fine-needle aspiration cytology reporting according to Royal College of Pathologists UK:</p>\n<table style=\"height: 155px; width: 344.312px;\">\n<tbody>\n<tr>\n<td style=\"width: 99px;\"><strong>Category</strong></td>\n<td style=\"width: 234.312px;\"><strong>Lesion</strong></td>\n</tr>\n<tr>\n<td style=\"width: 99px;\">Thy1</td>\n<td style=\"width: 234.312px;\">Non-diagnostic</td>\n</tr>\n<tr>\n<td style=\"width: 99px;\">Thy1c</td>\n<td style=\"width: 234.312px;\">Non-diagnostic cystic</td>\n</tr>\n<tr>\n<td style=\"width: 99px;\"><strong>Thy2</strong></td>\n<td style=\"width: 234.312px;\"><strong>Non-neoplastic</strong></td>\n</tr>\n<tr>\n<td style=\"width: 99px;\">Thy3</td>\n<td style=\"width: 234.312px;\">Follicular</td>\n</tr>\n<tr>\n<td style=\"width: 99px;\"><strong>Thy4</strong></td>\n<td style=\"width: 234.312px;\"><strong>Suspicious for malignancy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 99px;\">Thy5</td>\n<td style=\"width: 234.312px;\">Malignant</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 921\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Another cytology reporting system is \"The <strong>Bethesda System</strong> for Reporting Thyroid Cytopathology\" (TBSRTC):</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aad8cc9d53a446b09572a83b3b4652eex1280x1698.JPEG"
    ]
  },
  {
    "text": "A 22-year-old student with a nodular thyroid swelling undergoes a radionuclide scan. What is the risk of malignancy of the pathology given below?",
    "choices": [
      {
        "id": 1,
        "text": "5%"
      },
      {
        "id": 2,
        "text": "50%"
      },
      {
        "id": 3,
        "text": "10%"
      },
      {
        "id": 4,
        "text": "20%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hot nodules</strong> indicate increased function of the gland and are <strong>rarely malignant</strong>. They are managed with either I<sup>131</sup> or surgery. The risk of malignancy is higher with <strong>&ldquo;cold&rdquo;</strong> lesions <strong>(15-20%)</strong> as compared to <strong>&ldquo;warm&rdquo;</strong> lesions (<strong>&lt;5%</strong>).</p>\n<p><strong>Cold nodules</strong> need to be further <strong>evaluated</strong> using <strong>USG</strong> as they pose a higher <strong>risk of malignancy</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/559c53999a13436f98a763034eea99fa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1707c68d743749ca9e543125eb555077x1200x2202.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/352658e45a324fed8bd8c02ebb8c1cd7x1280x2317.JPEG"
    ]
  },
  {
    "text": "A young male patient presents with a discrete thyroid swelling. USG reveals an isolated cystic swelling of the gland. Which of the following statements correctly expresses the risk of malignancy in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "6%"
      },
      {
        "id": 2,
        "text": "12%"
      },
      {
        "id": 3,
        "text": "24%"
      },
      {
        "id": 4,
        "text": "48%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Isolated <strong>cystic</strong> swellings are <strong>malignant</strong> in <strong>24%</strong> of <strong>males</strong>.</p>\n<p>The general rule of thumb is that the risk of malignancy is greater in:</p>\n<ul>\n<li>Isolated &gt; dominant swellings</li>\n<li>Solid &gt; cystic</li>\n<li>Men &gt; women</li>\n</ul>\n<p>The risk of malignancy in thyroid swellings, given by the&nbsp;<strong>rule of twelve,&nbsp;</strong>is depicted below. The risk of cancer in thyroid swelling can be expressed as a factor of 12.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baccc393d54f45959050c46fa33e8990x1200x1899.JPEG"
    ]
  },
  {
    "text": "A patient scheduled for a thyroid radionuclide scan had consumed an I\u00b9\u00b2\u00b3 containing pill at around 6 AM. What is the half-life of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "12-14 hours"
      },
      {
        "id": 2,
        "text": "20-24 hours"
      },
      {
        "id": 3,
        "text": "4-6 hours"
      },
      {
        "id": 4,
        "text": "8-10 days"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The half-life of I<sup>123 </sup>is <strong>12-14 hours.</strong></p>\n<p>Isotopes of Iodine such as Iodine-123 (<sup>123</sup>I) and Iodine-131 (<sup>131</sup>I) are used to image the thyroid gland.</p>\n<table style=\"width: 388.909px;\">\n<tbody>\n<tr>\n<td style=\"width: 87px;\">Iodine radioisotope</td>\n<td style=\"width: 129px; text-align: center;\"><strong>I<sup>123</sup></strong></td>\n<td style=\"width: 159.909px; text-align: center;\"><strong>I<sup>131</sup></strong></td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Half-life</td>\n<td style=\"width: 129px;\"><strong>12- 14 hours</strong></td>\n<td style=\"width: 159.909px;\">8-10 days</td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Radiation exposure</td>\n<td style=\"width: 129px;\">Low</td>\n<td style=\"width: 159.909px;\">High</td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Radiation emission</td>\n<td style=\"width: 129px;\">Gamma rays</td>\n<td style=\"width: 159.909px;\">Beta and Gamma rays</td>\n</tr>\n<tr>\n<td style=\"width: 87px;\">Uses</td>\n<td style=\"width: 129px;\">\n<p>Imaging of lingual thyroids</p>\n<p>Anatomical and physiological function of thyroid</p>\n</td>\n<td style=\"width: 159.909px;\">Screening and treatment of patients with differentiated thyroid cancers for metastatic disease</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a painless swelling of the neck. The histology of the tissue is as given in the image below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medullary carcinoma"
      },
      {
        "id": 2,
        "text": "Non Hodgkin's lymphoma"
      },
      {
        "id": 3,
        "text": "Grave's disease"
      },
      {
        "id": 4,
        "text": "Hashimoto's thyroiditis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C: <strong>Grave's disease</strong> is an autoimmune disorder characterized by hyperthyroidism due to circulating autoantibodies. The thyroid-stimulating immunoglobulins bind to the TSH receptors, causing overgrowth of the thyroid gland and increased thyroid hormone synthesis. Histologically, there is acinar cell hypertrophy and hyperplasia with the absence of normal colloid in the tall columnar epithelium (normally the epithelium is flat with colloid). Lymphoid infiltrates, consisting predominantly of T cells, along with scattered B cells and mature plasma cells, are present throughout the interstitium. Germinal centers are common.</p>\n<p>The given slide below shows Grave's disease:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/daba3807ac4e4b8cb74ffdb00bd2b6f7.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/845a648c25b3440797f586e684e8981ex1280x1164.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db8cadf2a71a452b83f9cbcbc81c5e55x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b67d3c782b3c442db097a93025af036fx1280x853.JPEG"
    ]
  },
  {
    "text": "A middle-aged female patient presented with malaise, fever, and painful neck swelling. She had recently recovered from an episode of upper respiratory tract infection.  Lab reports show slightly elevated T4 and ESR was 100 mm/hr. What is the most appropriate management option for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Antibiotics"
      },
      {
        "id": 2,
        "text": "Antiviral"
      },
      {
        "id": 3,
        "text": "NSAIDS"
      },
      {
        "id": 4,
        "text": "Antithyroid drugs"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of<strong> De Quervain's thyroiditis</strong> for which <strong>NSAIDs</strong> is the treatment of choice. In this condition, T3, T4 and thyroglobulin may be raised due to the release of preformed hormones from the destructed follicles.&nbsp;</p>\n<p>De Quervain&rsquo;s thyroiditis (subacute or viral thyroiditis) is a <strong>granulomatous</strong> enlargement of the thyroid gland, usually following a <strong>viral infection</strong>. It is an inflammatory condition and not an infection as the thyroid gland is inherently resistant to infection due to its extensive blood and lymphatic supply, high iodide content, and fibrous capsule. &nbsp;</p>\n<p>It predominantly occurs in <strong>women</strong> between the ages of 30-40 years. The condition is <strong>self-limiting</strong>, and management is symptomatic i.e.&nbsp;<strong>aspirin </strong>and other<strong> non-steroidal anti-inflammatory drugs</strong> are used for pain relief, but steroids may be indicated in more severe cases.</p>\n<p>Note: Acute suppurative thyroiditis mimics De Quervain&rsquo;s thyroiditis in that it is often preceded by a pyogenic upper respiratory tract infection or otitis media. However, acute suppurative thyroiditis is more common in children.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old lady, with a painless neck swelling, presented with palpitations and weight loss. Thyroid function tests revealed elevated T3 and T4, low TSH, and negative TSH-R Ab. Iodine scan showed multiple thyroid nodules with increased iodine uptake. Initial anti-thyroid treatment was given. What is the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "Long-term antithyroid medication"
      },
      {
        "id": 2,
        "text": "Sub-total thyroidectomy"
      },
      {
        "id": 3,
        "text": "Radioactive iodine"
      },
      {
        "id": 4,
        "text": "Near- total thyroidectomy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of<strong>&nbsp;toxic multinodular goitre</strong>.&nbsp;The next step of management once a euthyroid state is achieved is a&nbsp;<strong>near-total thyroidectomy</strong>.</p>\n<p>Toxic nodular goiters are often large, uncomfortable, and are prone to recurrence. In a developing country like India, a near-total thyroidectomy eliminates the risk of recurrence and simplifies follow-up. However, it causes immediate thyroid failure and necessitates lifelong thyroxine replacement.&nbsp;</p>\n<p>Option A: Toxic multinodular goitres may show a decreased response&nbsp;to&nbsp;<strong>antithyroid drugs</strong> or&nbsp;may even&nbsp;<strong>enlarge further</strong>. Therefore, surgical management is recommended.&nbsp;</p>\n<p>Option B:&nbsp;Sub-total thyroidectomy has chances of recurrence and hence cannot be a definitive therapy.</p>\n<p>Option C: Large goiters show decreased response to radioactive iodine and the chances of recurrence are also high.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What will be the most likely associated condition with increased TSH and low T4 levels?",
    "choices": [
      {
        "id": 1,
        "text": "Hypoparathyroidism"
      },
      {
        "id": 2,
        "text": "Pituitary Adenoma"
      },
      {
        "id": 3,
        "text": "Grave's disease"
      },
      {
        "id": 4,
        "text": "Hashimoto's thyroiditis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Increased TSH</strong> and <strong>low T4</strong> levels are seen in<strong> primary hypothyroidism</strong>. <strong>Hashimoto's thyroiditis</strong> is the only cause of primary hypothyroidism in the given options.&nbsp;</p>\n<p><strong>Hashimoto's thyroiditis</strong> is an <strong>autoimmune disease</strong> that results in the destruction of the thyroid gland and gradual &amp; progressive thyroid failure. It<strong>&nbsp;</strong>is the <strong>most common cause</strong> of primary hypothyroidism in <strong>iodine-sufficient</strong> areas. They also have autoantibodies against thyroid receptors, thyroid peroxidase and thyroglobulin.&nbsp;</p>\n<p>Other options:</p>\n<p>Option A: Hypoparathyroidism is generally not associated with hypothyroidism, except in certain congenital multisystem disorders such as DiGeorge's syndrome.</p>\n<p>Option C: <strong>Grave's disease</strong> is the most common cause of <strong>hyper</strong>thyroidism. It is an autoimmune disorder caused due to autoantibodies against the TSH receptor. There will be elevated T3 and T4 levels with low TSH levels.&nbsp;</p>\n<p>Option B: A <strong>TSH-producing pituitary adenoma</strong> can have increased TSH levels, but there will be <strong>elevated T3, T4 </strong>levels as well.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old hypothyroid female patient presents with a painless, hard anterior neck mass, which progresses over weeks to years associated with dysphagia. Physical examination reveals a hard, \u201cwoody\u201d thyroid gland with fixation to the surrounding tissues. Which of the following investigations will confirm the provisional diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "CECT"
      },
      {
        "id": 2,
        "text": "RAI uptake scan"
      },
      {
        "id": 3,
        "text": "FNAC"
      },
      {
        "id": 4,
        "text": "Open biopsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>Riedel\u2019s thyroiditis,\u00a0</strong> which is confirmed by an <strong>open thyroid biopsy</strong>.</p>\n<p><strong>FNAC </strong>is <strong>inadequate</strong> due to the <strong>firm and fibrous</strong> nature of the gland.</p>\n<p>Riedel\u2019s thyroiditis is invasive autoimmune\u00a0<strong>fibrous thyroiditis</strong>\u00a0where\u00a0thyroid gland tissue is replaced by fibrous tissue. It is an\u00a0<strong>IgG4-related systemic disease</strong> characterized by:</p>\n<ul>\n<li>Elevated serum IgG4 levels</li>\n<li>Lymphoplasmacytic infiltrate</li>\n<li>Abundance of IgG4 bearing plasma cells</li>\n</ul>\n<p>It is associated with other focal sclerosing syndromes including mediastinal, retroperitoneal, periorbital, retro-orbital fibrosis, and sclerosing cholangitis.</p>\n<p><strong>Clinical features</strong>:</p>\n<ul>\n<li>Occurs predominantly in women between 30-60 years</li>\n<li>Painless, hard anterior neck mass</li>\n<li>Progresses over weeks to years to produce\u00a0symptoms of compression:\n<ul>\n<li>Dysphagia</li>\n<li>Dyspnea</li>\n<li>Choking</li>\n<li>Hoarseness</li>\n</ul>\n</li>\n<li>Symptoms of hypothyroidism and hypoparathyroidism as the\u00a0gland is replaced by fibrous tissue</li>\n<li>Physical examination reveals a hard, \u201cwoody\u201d thyroid gland\u00a0with fixation to surrounding tissues</li>\n</ul>\n<p><strong>Treatment </strong>includes<strong>\u00a0surgery,\u00a0</strong>high-dose steroids, tamoxifen, and thyroxine replacement.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The commonest surgical approach to a retrosternal goiter is via:",
    "choices": [
      {
        "id": 1,
        "text": "Neck"
      },
      {
        "id": 2,
        "text": "Chest"
      },
      {
        "id": 3,
        "text": "Median sternotomy"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The commonest <strong>surgical approach</strong> to a<strong> retrosternal goiter</strong>&nbsp;is via the <strong>neck </strong>and the most common type of goitre approached is the secondary retrosternal goiter.</p>\n<p>A goiter is considered to be <strong>retrosternal</strong> if <strong>at least 50%</strong> of the <strong>thyroid tissue</strong> is located <strong>intrathoracically.</strong>&nbsp;They can be primary or secondary.</p>\n<table style=\"width: 456px; height: 352px;\">\n<tbody>\n<tr>\n<td style=\"width: 88px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 165.766px; text-align: center;\"><strong>Primary retrosternal goiter</strong></td>\n<td style=\"width: 177.234px; text-align: center;\"><strong><strong>Secondary&nbsp;</strong></strong><strong>retrosternal goiter</strong></td>\n</tr>\n<tr>\n<td style=\"width: 88px;\">Occurrence</td>\n<td style=\"width: 165.766px;\"><strong>1%</strong>&nbsp;</td>\n<td style=\"width: 177.234px;\"><strong>Majority</strong> of retrosternal goiters&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 88px;\">Origin</td>\n<td style=\"width: 165.766px;\">\n<p>Arise from <strong>ectopic thyroid tissue</strong> in the chest</p>\n<p><strong>No connection</strong> with the thyroid tissue in the neck</p>\n</td>\n<td style=\"width: 177.234px;\">Arise from the&nbsp;<strong>downward extension of cervical thyroid tissue</strong> along the fascial planes of the neck</td>\n</tr>\n<tr>\n<td style=\"width: 88px;\">Blood supply</td>\n<td style=\"width: 165.766px;\"><strong>Intrathoracic </strong>blood vessels</td>\n<td style=\"width: 177.234px;\">Superior and&nbsp;inferior thyroid arteries</td>\n</tr>\n</tbody>\n</table>\n<p>Retrosternal goiter presents with dyspnoea, stridor, and dilated neck veins. <strong>Pemberton&rsquo;s sign</strong> (venous congestion of the neck on the raising of hands above the head) is seen.&nbsp;&nbsp;</p>\n<p>Contrast-enhanced computed tomography<strong> (CECT) </strong>of the <strong>neck</strong>&nbsp;is performed to assess the location of the thyroid. The <strong>definitive treatment</strong> is surgical <strong>excision</strong> of the ectopic thyroid.</p>\n<p>Other options:</p>\n<p>Option B &amp; C: <strong>Median sternotomy </strong>(via chest) is indicated in:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Primary mediastinal</strong> goiter</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Malignant</strong> retrosternal goiter</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Very <strong>large retrosternal </strong>goiter</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Recurrence</strong> in the mediastinum</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about retrosternal goitre?",
    "choices": [
      {
        "id": 1,
        "text": "Operated in all patients regardless of symptoms"
      },
      {
        "id": 2,
        "text": "Sternal incision is always required to operate"
      },
      {
        "id": 3,
        "text": "It receives blood supply from the thoracodorsal artery"
      },
      {
        "id": 4,
        "text": "Most of the retrosternal goitres can be removed by a neck incision"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Most of the retrosternal goiters can be removed by<strong>&nbsp;neck incision </strong>(transcervical approach).</p>\n<p>Retrosternal goitre is defined as having <strong>&gt;50%</strong> of the goiter <strong>below </strong>the<strong> suprasternal notch</strong>. It can be either <strong>primary</strong> or <strong>secondary.</strong></p>\n<ul>\n<li><strong>Primary:</strong> rare and arises from ectopic thyroid tissue in the mediastinum; receives blood supply from <strong>intrathoracic blood vessels</strong>. It is <strong>not related to thyroid tissue</strong> in the <strong>neck.</strong></li>\n<li><strong>Secondary:</strong>&nbsp;they are the <strong>most common type;</strong>&nbsp;an extension of enlarged thyroid from the neck, usually arising from the lower pole of <strong>nodular</strong> goitre. It receives its blood supply from <strong>superior and inferior thyroid vessels</strong>.</li>\n</ul>\n<p>The majority of patients are <strong>asymptomatic</strong> or have minimal symptoms. If the gland enlarges within the thoracic inlet, the <strong>pressure</strong> may lead to dysphagia, tracheal compression, and eventually airway symptoms. <strong>Pemberton sign</strong> can be positive (facial flushing and dilatation of cervical veins upon raising the arms above the head).</p>\n<p><strong>CECT</strong> neck and thorax is the <strong>investigation of choice.</strong></p>\n<p>Over 95% of retrosternal goiters can be removed via a transcervical incision since they are an extension from thyroid tissue in the neck.</p>\n<p>Other options:</p>\n<p>Option A: Surgical removal of the retrosternal goiter is indicated in patients with significant <strong>airway compression,</strong>&nbsp;and in <strong>young</strong> <strong>patients</strong> who have symptoms such as <strong>dyspnoea</strong> or <strong>dysphagia.&nbsp;</strong></p>\n<p>Option B: <strong>Median sternotomy</strong> approach is indicated in:</p>\n<ul>\n<li aria-level=\"1\">Primary mediastinal goiter</li>\n<li aria-level=\"1\">Malignant retrosternal goitre</li>\n<li aria-level=\"1\">Very large retrosternal goiter</li>\n<li aria-level=\"1\">Recurrence in the mediastinum</li>\n</ul>\n<p>For a primary mediastinal goiter&nbsp;whose boundaries are <strong>completely</strong> <strong>within the chest</strong>, resection is often achieved through <strong>median sternotomy</strong> or <strong>thoracotomy</strong> to ensure that the vessels supplying the tumor are properly ligated. Removing the tumor through a cervical approach can result in uncontrolled bleeding and is generally avoided.&nbsp;</p>\n<p>Option C: Blood supply to the retrosternal goiter is from the thyroid vessels (secondary retrosternal goiter).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients with thyroid swellings is least likely to require surgery?",
    "choices": [
      {
        "id": 1,
        "text": "A 22 year old woman with FNAC report of Bethesda category IV"
      },
      {
        "id": 2,
        "text": "A 66 year old man with a positive Pemberton\u2019s sign"
      },
      {
        "id": 3,
        "text": "A 58 year old man with an FNAC report of Thy2"
      },
      {
        "id": 4,
        "text": "A 16 year old girl with recurrence of thyroid cyst"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">FNAC report of Thy2 i.e. non-neoplastic is not an indication for surgery.&nbsp;</p>\n<p class=\"p1\"><strong>Indications</strong> for surgical management of thyroid swellings include:</p>\n<ul>\n<li class=\"p1\">Neoplasia: FNAC positive Thy3&ndash;5 and clinical suspicion\n<ul>\n<li class=\"p1\">Age</li>\n<li class=\"p1\">Male sex</li>\n<li class=\"p1\">Hard texture</li>\n<li class=\"p1\">Fixity</li>\n<li class=\"p1\">Recurrent laryngeal&nbsp;nerve palsy</li>\n<li class=\"p1\">Lymphadenopathy</li>\n<li class=\"p1\">Recurrent cyst</li>\n</ul>\n</li>\n<li class=\"p1\">Toxic adenoma</li>\n<li class=\"p1\">Pressure symptoms</li>\n<li class=\"p1\">Cosmesis</li>\n<li class=\"p1\">Patient&rsquo;s wishes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pick from the following the usual cause of thyroid storm in thyroidectomy:",
    "choices": [
      {
        "id": 1,
        "text": "Rough handling of thyroid during surgery"
      },
      {
        "id": 2,
        "text": "Due to parathyroid gland"
      },
      {
        "id": 3,
        "text": "Inadequate patient preparation"
      },
      {
        "id": 4,
        "text": "Infections"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The usual cause of thyroid storm in thyroidectomy is<strong> inadequate patient preparation</strong> before surgery. Patient preparation <strong>pre-operatively</strong> involves ensuring a <strong>euthyroid</strong> <strong>state</strong>.</p>\n<p><strong>Rough handling</strong> of the thyroid in thyroidectomy does <strong>not</strong> cause a<strong> thyroid storm</strong>. Though a significant amount of thyroglobulin is stored in the acinar cells, they are inactive unless converted to thyroxine (T3 and T4).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with toxic adenoma is being prepared for surgery. Which of the following statements is wrong regarding this?",
    "choices": [
      {
        "id": 1,
        "text": "Iodine may be given pre-operatively with carbimazole"
      },
      {
        "id": 2,
        "text": "Beta blockers administered pre-operatively must be continued post operatively"
      },
      {
        "id": 3,
        "text": "Nadolol is given in a once daily regimen pre-operatively"
      },
      {
        "id": 4,
        "text": "The last dose of carbimazole must be given 24 hours before surgery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The last dose of <strong>carbimazole</strong> may be given the <strong>evening before surgery</strong>.</p>\n<p><strong>Toxic adenoma</strong> is a benign functioning thyroid tumour, which usually presents as a toxic solitary nodule. It is an autonomously functioning tumour that does not respond to TSH.\u00a0Treatment involves <strong>antithyroid </strong>drugs or <strong>radioactive</strong> <strong>iodine</strong>. This is followed by <strong>hemithyroidectomy</strong> as the surrounding normal thyroid tissue regains normal function.</p>\n<p>Traditional <strong>preparation</strong> of a <strong>thyrotoxic patient</strong> aims to make the patient biochemically euthyroid. There are two methods of preparation that can be used:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Carbimazole </strong>30-40 mg per day is the <strong>drug of choice</strong>. When euthyroid (after 8-12 weeks), the dose may be reduced.\u00a0Beta-blockers, if used preoperatively, must be given on the morning of surgery and continued for a week post-op.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Propranolol </strong>40 mg TDS or a longer-acting <strong>nadolol</strong> 160 mg once daily may be given to achieve <strong>beta-blockade</strong>. It is important to <strong>continue</strong> treatment up to <strong>7 days postoperatively</strong>.</li>\n</ol>\n<p>Iodine may be given with carbimazole or a beta-blocker 10 days before the operation. It produces <strong>transient remission</strong> and reduces thyroid vascularity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man was posted for Hartley-Dunhill procedure. What is done in this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Total resection of lobes on one side, with partial resection on the other side"
      },
      {
        "id": 2,
        "text": "Partial resection of each lobe removing the bulk of the gland"
      },
      {
        "id": 3,
        "text": "Total resection of one lobe with partial resection of three lobes"
      },
      {
        "id": 4,
        "text": "Resection of two lobes with the removal of the isthmus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Hartley Dunhill procedure involves <strong>total lobectomy</strong> on the affected side with <strong>sub total resection</strong> on the less affected side.&nbsp;</p>\n<p>Indication: Asymmetrical multinodular goiters especially in older patients.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are performing thyroidectomy in a patient with thyroid neoplasia. Where will you make the Kocher's incision?",
    "choices": [
      {
        "id": 1,
        "text": "1 cm below A"
      },
      {
        "id": 2,
        "text": "1 cm above A"
      },
      {
        "id": 3,
        "text": "1 cm below B"
      },
      {
        "id": 4,
        "text": "1 cm above B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The structures marked as \"A\" and \"B\" in the above image are thyroid cartilage and cricoid cartilage respectively. A <strong>Kocher transverse collar incision</strong> is typically <strong>3 to 5 cm in length</strong> and is placed parallel to a natural skin crease <strong>1 cm below the cricoid cartilage</strong>, which is marked as \"B\".</p>\n<p class=\"p1\"><strong>Rose position</strong> is preferred for thyroid surgery. The patient is supine with a towel roll below the shoulder to enable neck extension of 30 degrees.&nbsp;The advantage is a blood-less field as there is decreased venous congestion. However, there is an increased risk of air embolism.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43828ef104aa4dbfbbf5980816411c00.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "At which of the following points is the recurrent laryngeal nerve at the highest risk for injury during thyroid surgery?",
    "choices": [
      {
        "id": 1,
        "text": "At the level of Berry's ligament as it enters the larynx"
      },
      {
        "id": 2,
        "text": "In the tracheoesophageal groove as it forms one side of the Beahrs triangle"
      },
      {
        "id": 3,
        "text": "Under the tubercle of Zuckerkandl on the posterolateral portion of the gland"
      },
      {
        "id": 4,
        "text": "As the nerve loops around the aorta"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note:&nbsp;On the left side, the nerve has more distance in which to reach the transesophageal groove. Hence it runs in a <strong>medial</strong> plane. On the right, there is less distance and the nerve runs more obliquely to reach the groove.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28da1f896a154945890d49b47ff39067x380x375.JPEG"
    ]
  },
  {
    "text": "In the post-op recovery room, a patient who had undergone a thyroidectomy suddenly experienced dyspnea with stridor. He was immediately sent back to the OT. What is the most likely cause for the patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Diaphragmatic paralysis due to hypocalcemia"
      },
      {
        "id": 2,
        "text": "Thyrotoxicosis causing uncontrolled atrial fibrillation"
      },
      {
        "id": 3,
        "text": "Venous embolism"
      },
      {
        "id": 4,
        "text": "Development of hematoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Development of a <strong>hematoma</strong> post-thyroidectomy may lead to <strong>venous edema </strong>of the <strong>larynx. </strong>This&nbsp;can cause <strong>airway obstruction </strong>and<strong> respiratory distress.&nbsp;</strong>It is evacuated promptly at bedside or through surgical re-exploration.</p>\n<p>Complications of thyroidectomy:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Haemorrhage - most common complication overall</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Nerve injury&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">External laryngeal nerve - hoarseness (more common)</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Recurrent laryngeal nerve - hoarseness if unilateral, life-threatening aspiration and aphonia if bilateral</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Respiratory obstruction</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Laryngeal edema - most common cause of respiratory obstruction</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Bilateral recurrent laryngeal nerve palsy</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Laryngomalacia</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Tension hematoma</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypoparathyroidism - infarction of parathyroids</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Thyroid storm - inadequately prepared for surgery</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypothyroidism</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Recurrent thyrotoxicosis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Wound infection, stitch granuloma, keloid&nbsp;</li>\n</ul>\n<p>Option C: <strong>Venous embolism</strong> typically occurs after a <strong>prolonged</strong> period of <strong>immobilization.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who had undergone a retro-oesophagal goitre resection was found to have partial ptosis and loss of hemifacial sweating. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Transient hypocalcemia"
      },
      {
        "id": 2,
        "text": "Horner's syndrome"
      },
      {
        "id": 3,
        "text": "Recurrent laryngeal nerves injury"
      },
      {
        "id": 4,
        "text": "Post operative hematoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>Horner's syndrome</strong>.&nbsp;</p>\n<p>The <strong>cervical sympathetic trunk</strong> is at risk of <strong>injury</strong> in invasive thyroid cancers and retro-esophageal goitres and may result in Horner's syndrome.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '12 Benign Lesions Of Thyroid';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>