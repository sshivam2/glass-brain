<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 002 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the correct order of layers of epidermis from deep to superficial?",
    "choices": [
      {
        "id": 1,
        "text": "Stratum basale, Stratum granulosum, Stratum spinosum, Stratum corneum"
      },
      {
        "id": 2,
        "text": "Stratum basale, Stratum spinosum, Stratum granulosum, Stratum corneum"
      },
      {
        "id": 3,
        "text": "Stratum corneum, Stratum spinosum, Stratum granulosum, Stratum basale"
      },
      {
        "id": 4,
        "text": "Stratum corneum, Stratum granulosum, Stratum spinosum, Stratum basale"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct order of the given layers from <strong>deep</strong> to <strong>superficial</strong> is stratum basale, stratum spinosum, stratum granulosum, stratum corneum.</p>\n<p>&nbsp;</p>\n<p>LAYERS OF SKIN (superficial to deep):</p>\n<table style=\"height: 216px; width: 394.171875px;\">\n<tbody>\n<tr style=\"height: 35px;\">\n<td style=\"width: 191px; text-align: center; height: 35px;\"><strong>Thin skin</strong></td>\n<td style=\"width: 202.171875px; text-align: center; height: 35px;\">\n<p><strong>Thick skin </strong></p>\n<p><strong>(glabrous skin)</strong></p>\n<p>palms, soles,&nbsp;flexor surfaces of digits</p>\n</td>\n</tr>\n<tr style=\"height: 62px;\">\n<td style=\"width: 191px; height: 62px;\">\n<ul>\n<li>stratum corneum</li>\n<li>stratum granulosum</li>\n<li>stratum spinosum</li>\n<li>stratum basale</li>\n</ul>\n</td>\n<td style=\"width: 202.171875px; height: 62px;\">\n<ul>\n<li>stratum corneum</li>\n<li><strong>stratum lucidum</strong></li>\n<li>stratum granulosum</li>\n<li>stratum spinosum</li>\n<li>stratum basale</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Mnemonic</strong> for skin layers (superficial to deep): <strong>C</strong>ome <strong>L</strong>et's <strong>G</strong>et<strong> So</strong>me<strong> B</strong>eer (Corneum, Lucidum, Granulosum, Spinosum, and Basale).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e25333309704ea0a11decbdd090ab7ax1080x854.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/297b9ad5b8064bf5bd65ba3182c477aex412x600.PNG"
    ]
  },
  {
    "text": "Tetanic contraction is due to the accumulation of _______ ions.",
    "choices": [
      {
        "id": 1,
        "text": "Na+"
      },
      {
        "id": 2,
        "text": "Ca2+"
      },
      {
        "id": 3,
        "text": "K+"
      },
      {
        "id": 4,
        "text": "Cl-"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tetanic contraction occurs due to progressive accumulation of Ca<sup>2+</sup> ions with rapidly repeated stimulation of skeletal muscle.</strong></p>\n<ul>\n<li>With rapidly repeated stimulation, activation of the contractile mechanism occurs repeatedly before any relaxation has occurred, and the individual contractions fuse into one continuous contraction. Such a response is called a <strong>tetanus (tetanic contraction)</strong>.</li>\n<li>A single action potential releases sufficient Ca<sup>2+</sup> to cause a twitch contraction.</li>\n<li>However, the duration of this contraction is very short because Ca<sup>2+</sup> is very rapidly pumped back into the SR.</li>\n<li>If the muscle is stimulated a second time before the muscle is fully relaxed, there is progressive accumulation of Ca<sup>2+</sup> and the force of contraction increases. Thus, twitch forces are amplified as stimulus frequency increases.</li>\n<li>At a high level of stimulation, intracellular Ca<sup>2+</sup> increases and is maintained throughout the period of stimulation, and the amount of force developed greatly exceeds that seen during a twitch. The response is termed tetany.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/49e44474a0a543ac8d259fd1c2111709x763x314.JPEG"
    ]
  },
  {
    "text": "Enzyme activated by a decrease in insulin: glucagon ratio is:",
    "choices": [
      {
        "id": 1,
        "text": "Glucokinase"
      },
      {
        "id": 2,
        "text": "Hexokinase"
      },
      {
        "id": 3,
        "text": "Phosphofructokinase"
      },
      {
        "id": 4,
        "text": "Glucose 6-phosphatase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Enzyme activated by a decrease in insulin: glucagon ratio is<strong> Glucose 6-phosphatase.</strong></p>\n<p>A <strong>decrease</strong> in <strong>insulin: glucagon ratio</strong> is seen in <strong>fasting state</strong>, in which there is the activation of gluconeogenesis and inhibition of glycolysis.</p>\n<p>Among the given options, only glucose 6-phosphatase is an enzyme of gluconeogenesis and therefore is activated. The enzymes mentioned as other options are irreversible enzymes of&nbsp;glycolysis and are inhibited in the fasting state.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c428914beaf486b8890abaf1c2d2055x1280x2966.JPEG"
    ]
  },
  {
    "text": "A 10-year-old boy with fever, weight loss came to the hospital. On examination, he was pale and had significant lymphadenopathy. The bone marrow histology of the person is as given below. Your diagnosis is?",
    "choices": [
      {
        "id": 1,
        "text": "Acute myeloblastic leukemia"
      },
      {
        "id": 2,
        "text": "Aplastic anemia"
      },
      {
        "id": 3,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 4,
        "text": "Juvenile myelomonocytic leukemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image points&nbsp;show lymphoblasts with condensed nuclear chromatin, small nucleoli, scanty agranular cytoplasm which are characteristics of&nbsp;<strong>acute lymphoblastic leukemia</strong>.&nbsp;</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">&nbsp;<strong>Acute lymphoblastic leukemia (ALL)</strong>&nbsp;arises from immature B (pre-B) or T (pre-T) cells called&nbsp;<strong>lymphoblasts.&nbsp;</strong>Immunohistochemistry for terminal deoxynucleotidyl transferase&nbsp;<strong>(TdT)</strong>&nbsp;is positive in pre-B and pre-T lymphoblasts.</p>\n<p>Peripheral smear shows lymphoblasts that have condensed chromatin, less conspicuous nucleoli, and smaller amounts of cytoplasm which lacks granules as shown below.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/15b9b71127b443aea6575f5a700f2f21.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/768a800f0cb443f59b2351fc359495c8x720x820.JPEG"
    ]
  },
  {
    "text": "Identify the class of immunoglobulin\u200b shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Ig A"
      },
      {
        "id": 2,
        "text": "Ig G"
      },
      {
        "id": 3,
        "text": "Ig M"
      },
      {
        "id": 4,
        "text": "Ig E"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a <strong>dimeric</strong> <strong>structure</strong> which is characteristic of <strong>secretory</strong>&nbsp;<strong>IgA.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28c24d874ede4f239646d8b5f937b907.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bda29cacb56546798cb109d057dadd35x427x666.PNG"
    ]
  },
  {
    "text": "An elderly hypertensive patient is diagnosed with bilateral renal artery stenosis. He is also on treatment for diabetes mellitus. Which among the following drugs would be the most appropriate for the management of hypertension?",
    "choices": [
      {
        "id": 1,
        "text": "Enalapril"
      },
      {
        "id": 2,
        "text": "Verapamil"
      },
      {
        "id": 3,
        "text": "Beta blockers"
      },
      {
        "id": 4,
        "text": "Thiazides"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, <strong>Verapamil</strong> can be used for the management of hypertension in the patient. It <strong>does not</strong> have any adverse <strong>effect</strong> on <strong>glycemic</strong> <strong>control</strong>.</p>\n<p>Option A-<strong>\u00a0ACE inhibitors</strong> are <strong>contraindicated in bilateral artery stenosis.\u00a0</strong>Normally angiotensin II reduces GFR by constricting afferent renal arteriole. However, when there is renal hypotension such as bilateral artery stenosis, it constricts the efferent arteriole thus increasing the GFR. If the RAAS system is blocked in a patient with bilateral renal artery stenosis, the GFR would get reduced significantly and may result in renal failure.</p>\n<p>Options C and D- <strong>Beta-blockers and thiazides</strong> can <strong>worsen glycemic control</strong> and are not suitable in the given scenario.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Late signs of death are all except:",
    "choices": [
      {
        "id": 1,
        "text": "Putrefaction"
      },
      {
        "id": 2,
        "text": "Adipocere"
      },
      {
        "id": 3,
        "text": "Suggilation"
      },
      {
        "id": 4,
        "text": "Mummification"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Putrefaction, adipocere formation, mummification are late signs of death whereas<strong> suggilation/postmortem hypostasis</strong> is an early sign of death.&nbsp;</p>\n<p>Immediate signs of death (somatic death):</p>\n<ul>\n<li>Insensibility and loss of voluntary power</li>\n<li>Cessation of respiration</li>\n<li>Cessation of circulation</li>\n</ul>\n<p>Early signs of death (cellular death):</p>\n<ul>\n<li>Pallor and loss of elasticity of skin</li>\n<li>Eye changes</li>\n<li>Primary flaccidity of muscles</li>\n<li>Cooling of the body</li>\n<li>Postmortem lividity/suggilation</li>\n<li>Rigor mortis</li>\n</ul>\n<p>Late signs of death:</p>\n<ul>\n<li>Putrefaction</li>\n<li>Adipocere</li>\n<li>Mummification</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Rinne positive in both ears and Weber lateralised towards right indicates",
    "choices": [
      {
        "id": 1,
        "text": "Right conductive deafness"
      },
      {
        "id": 2,
        "text": "Left conductive deafness"
      },
      {
        "id": 3,
        "text": "Right sensorineural deafness"
      },
      {
        "id": 4,
        "text": "Left sensorineural deafness"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Weber lateralised towards right</strong>\u00a0indicates <strong>right\u00a0sided conductive deafness or left side sensorineural deafness. </strong></p>\n<p>Since <strong>Rinne is positive on both ears</strong>, <strong>conductive deafness is ruled out</strong>.\u00a0</p>\n<p>So it is <strong>left sensorineural hearing loss.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f148467327fc44af9dfc5ba0e5ed9f20x1280x1605.JPEG"
    ]
  },
  {
    "text": "What is the diagnosis from the image given below ?",
    "choices": [
      {
        "id": 1,
        "text": "Pinguecula"
      },
      {
        "id": 2,
        "text": "Concretions"
      },
      {
        "id": 3,
        "text": "Pterygium"
      },
      {
        "id": 4,
        "text": "Bitots spots"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The diagnosis from the above image is<strong> pterygium</strong>.&nbsp;</p>\n<p><strong>Pterygium</strong>:</p>\n<p>It is a <strong>subconjunctival fibrovascular tissue</strong> encroaching the cornea.</p>\n<p>It is a <strong>degenerative condition</strong> of the sub-conjunctival tissue.</p>\n<p>It is a connective tissue disorder and is&nbsp;<strong>never inflammatory.&nbsp;</strong></p>\n<p>It is made up of three parts:</p>\n<ul>\n<li>a \"cap\" (an avascular halo-like zone at the advancing edge),</li>\n<li>a head,</li>\n<li>a body.</li>\n</ul>\n<p>Occurs due to exposure to radiation:&nbsp;<strong>UV-B</strong>.</p>\n<p>The most common site is <strong>nasal</strong>.</p>\n<p>Clinical features:</p>\n<ul>\n<li><strong>Astigmatism with the rule, </strong>usually</li>\n<li><strong>Stocker's line -&nbsp;</strong>deposition of iron on the advancing edge.</li>\n<li><strong>Fuchs islets&nbsp;</strong>are small, discrete,&nbsp;<strong>whitish flecks</strong> consisting of <strong>clusters of pterygial epithelial cells,</strong> often present <strong>at the advancing edge</strong>.</li>\n</ul>\n<p>Treatment:<strong>&nbsp;Excision</strong></p>\n<p>To prevent recurrence:</p>\n<p>Mitomycin C or 5 fluorouracil</p>\n<ul>\n<li><strong>Auto-grafting</strong>:<strong> Conjunctival limbal autograft (CLAG) </strong>from the<strong> superior</strong> limbal conjunctiva is the<strong>&nbsp;best method.</strong></li>\n<li>Bare sclera technique<strong> has high recurrence rate</strong>&nbsp;of<strong>&nbsp;30 to 80%</strong>.</li>\n<li>PERFECT surgery (<span class=\"st\"><strong>P</strong>terygium<strong> E</strong>xtended <strong>R</strong>emoval <strong>F</strong>ollowed by <strong>E</strong>xtended <strong>C</strong>onjunctival<strong> T</strong>ransplant)</span>&nbsp;has<strong> zero </strong>rate of<strong>&nbsp;</strong>recurrence.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/77155548766d4be28eb065f1783acbe6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following vaccine vials can be used based on the vaccine vial monitor (VVM) color changes shown?",
    "choices": [
      {
        "id": 1,
        "text": "Only vial 1 can be used"
      },
      {
        "id": 2,
        "text": "Vials 1 and 2 can be used"
      },
      {
        "id": 3,
        "text": "Vials 1, 2, and 3 can be used"
      },
      {
        "id": 4,
        "text": "All vials can be used"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>From the above image, only <strong>vials 1 and 2</strong> can be used as the inner squares of the VVMs are lighter than the outer circles.</li>\n<li>Vial 3 has crossed the <strong>discard point</strong> as the inner square and outer circle are the same color (if not, the inner square is a little darker than the outer circle) and thus cannot be used.</li>\n<li><strong>Vial 4 cannot</strong> be used as the VVM shows a <strong>darker inner square.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fba1c8e570c54f72ab5721cec83805c3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e2aa7caaf3bb416c8ecf95dae86ed28ax600x1199.JPEG"
    ]
  },
  {
    "text": "A child is brought to the PHC with acute diarrhoea. The doctor, based on history,  suspects that the child maybe suffering from an infection due to Shigella over cholera and proceeds to give ciprofloxacin as the antibiotic. Which of the following points on history, apart from bloody stools, favour the doctor's suspicion?",
    "choices": [
      {
        "id": 1,
        "text": "Absence of rectal pain"
      },
      {
        "id": 2,
        "text": "Presence of abdominal cramps"
      },
      {
        "id": 3,
        "text": "Presence of vomiting"
      },
      {
        "id": 4,
        "text": "Presence of fever"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Among the options given, <strong>the presence of fever</strong> favours the suspicion towards <strong>Shigella</strong> as the infectious agent, for which <strong>ciprofloxacin is the drug of choice.</strong></p>\n<p>The <strong>presence of vomiting</strong> and <strong>absence of rectal pain</strong> favour<strong> cholera</strong> and abdominal pain is present in both the diseases.</p>\n<p>Symptomatic differential diagnosis of shigella and cholera:</p>\n<table style=\"height: 273px; width: 388.474px;\">\n<tbody>\n<tr>\n<td style=\"width: 122px;\"><strong>Symptoms</strong></td>\n<td style=\"width: 124px;\"><strong>Cholera</strong></td>\n<td style=\"width: 125.474px;\"><strong>Shigella</strong></td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Diarrhoea</strong></td>\n<td style=\"width: 124px;\">Acute watery</td>\n<td style=\"width: 125.474px;\">Acute bloody</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Fever</strong></td>\n<td style=\"width: 124px;\">No</td>\n<td style=\"width: 125.474px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Abdominal cramps</strong></td>\n<td style=\"width: 124px;\">Yes</td>\n<td style=\"width: 125.474px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Vomiting</strong></td>\n<td style=\"width: 124px;\">Yes</td>\n<td style=\"width: 125.474px;\">No</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Rectal pain</strong></td>\n<td style=\"width: 124px;\">No</td>\n<td style=\"width: 125.474px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Stool</strong></td>\n<td style=\"width: 124px;\">&gt;3 loose stools per day, watery like rice water</td>\n<td style=\"width: 125.474px;\">&gt; 3 stools/day, with blood or pus.</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following compounds is predominantly responsible for the disinfecting property of bleaching powder?",
    "choices": [
      {
        "id": 1,
        "text": "Hypochlorite ion"
      },
      {
        "id": 2,
        "text": "Hydrochloric acid"
      },
      {
        "id": 3,
        "text": "Hypochlorous acid"
      },
      {
        "id": 4,
        "text": "Chloride ion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The disinfectant property of bleaching powder is predominantly due to the action of <strong>hypochlorous acid.</strong></p>\n<p>Bleaching powder, also known as <strong>chlorinated lime (CaOCl2)</strong>, has <strong>33 per cent of chlorine</strong> in it. When chlorine is added to water, there is the formation of hydrochloric and hypochlorous acids. The hydrochloric acid is neutralized by the alkalinity of the water. The hypochlorous acid ionizes to form hydrogen ions and hypochlorite ions, as follows:</p>\n<p>H<sub>2</sub>O + Cl<sub>2</sub>&nbsp;&rarr; HCl + HOCl</p>\n<p><strong>HOCl &rarr; H + OCl</strong></p>\n<p>The disinfecting action of chlorine is mainly due to <strong>hypochlorous acid.</strong>&nbsp;It is <strong>70-80 times</strong> more effective than&nbsp;Hypochlorite ion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 56-year-old man chronic smoker presented with flecks of blood in his sputum. He is currently on treatment for COPD and hypertension. His BMI is 31 kg/m\u00b2 and he has central obesity. His RBS is 261 mg/dl. During further evaluation, he is found to have high ACTH levels that remained high even after administration of high-dose dexamethasone. What is the underlying cause of this patient's symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Exogenous steroid intake"
      },
      {
        "id": 2,
        "text": "Pituitary adenoma"
      },
      {
        "id": 3,
        "text": "Adrenal cortical adenoma"
      },
      {
        "id": 4,
        "text": "Ectopic ACTH-secreting tumor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Elevated ACTH levels that do not get suppressed by a high-dose dexamethasone test are suggestive of <strong>Cushing&rsquo;s</strong> <strong>syndrome</strong> secondary to an <strong>ectopic</strong> <strong>ACTH-secreting</strong>&nbsp;tumor. Considering the patient's smoking history and presentation with hemoptysis, it is likely to be a lung tumor.</p>\n<table style=\"height: 478px; width: 272px;\">\n<tbody>\n<tr style=\"height: 20px;\">\n<td style=\"width: 298.141px; text-align: center; height: 20px;\" colspan=\"3\"><strong>Dynamic testing for Cushing&rsquo;s syndrome</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 72.1875px; height: 54px;\">&nbsp;</td>\n<td style=\"width: 124.812px; height: 54px;\"><strong>High dose dexamethasone suppression test</strong></td>\n<td style=\"width: 89.1406px; height: 54px;\"><strong>CRH stimulation test</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 72.1875px; height: 54px;\"><strong>Pituitary adenoma</strong></td>\n<td style=\"width: 124.812px; height: 54px;\">Positive (suppressed cortisol)</td>\n<td style=\"width: 89.1406px; height: 54px;\">Positive (increase in ACTH and cortisol)</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 72.1875px; height: 18px;\"><strong>Ectopic ACTH</strong></td>\n<td style=\"width: 124.812px; height: 18px;\"><strong>Negative</strong></td>\n<td style=\"width: 89.1406px; height: 18px;\"><strong>Negative</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 298.141px; height: 36px;\" colspan=\"3\"><strong>Iatrogenic</strong>: Suppressed ACTH levels that are not affected by dynamic testing</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 298.141px; height: 36px;\" colspan=\"3\"><strong>Adrenal</strong> mass or hyperplasia:&nbsp; Suppressed ACTH levels that are not affected by dynamic testing</td>\n</tr>\n</tbody>\n</table>\n<p>Ectopic sources of ACTH include <strong>small cell lung cancers </strong>and<strong> pulmonary carcinoid&nbsp;</strong>tumors. The most effective treatment strategy is the management of the underlying SCLC or carcinoid.&nbsp;</p>\n<p>Option A: <strong>Exogenous steroid</strong> administration&nbsp;presents with suppressed ACTH levels.</p>\n<p>Option B: <strong>Pituitary adenoma</strong> presents with elevated ACTH but a high-dose dexamethasone suppression test is positive (suppressed).</p>\n<p>Option C: <strong>Adrenal adenoma</strong> presents with suppressed ACTH levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ECG of a patient who presented with palpitations to the ER is shown below. Which of the following is a likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sinus tachycardia"
      },
      {
        "id": 2,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 3,
        "text": "Junctional tachycardia"
      },
      {
        "id": 4,
        "text": "Atrial flutter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above ECG shows increased heart rate with <strong>wide QRS complexes</strong> (&gt; 0.12s). This is suggestive of<strong> ventricular tachycardia </strong>(VT).<strong>&nbsp;</strong></p>\n<p>Types of ventricular tachycardia based on QRS morphology:</p>\n<ul>\n<li><strong>Monomorphic</strong><span class=\"term-highlight\">-</span>&nbsp;a stable QRS morphology from beat to beat</li>\n<li><strong>Polymorphic</strong><span class=\"term-highlight\">-</span>&nbsp;changing or multiform QRS variance from beat to beat. Torsades de pointes is an example of polymorphic&nbsp;<span class=\"term-highlight\">ventricular</span>&nbsp;<span class=\"term-highlight\">tachycardia.</span></li>\n<li><strong>Bidirectional</strong>-&nbsp;has a beat-to-beat alternation in the QRS frontal plane axis.&nbsp;It is associated with digitalis toxicity or catecholaminergic polymorphic VT.</li>\n</ul>\n<p>The most common cause of VT is <strong>ischemic heart disease</strong>.</p>\n<p><strong>Ventricular tachyarrhythmias&nbsp;</strong>occur due to impulses that originate within the ventricles. These impulses&nbsp;are conducted through the normal ventricular myocardial cells instead of the fast conducting Purkinje system. Hence, they present with wide QRS complexes ( &gt;0.12 sec) on the ECG.</p>\n<p><strong>Supraventricular tachyarrhythmias</strong>&nbsp;occur due to impulses originating above the ventricles. These impulses reach the ventricles through the proper fast conduction pathway resulting in a narrow QRS complex. SVTs are associated with wide QRS in few exceptional conditions like:</p>\n<ul>\n<li style=\"font-weight: 400;\">Conduction block in the left or right bundle branch</li>\n<li style=\"font-weight: 400;\">Activation of ventricles from an accessory pathway- antidromic AVRT</li>\n</ul>\n<p>The given ECG shows wide stable QRS complexes in monomorphic ventricular tachycardia:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/339c7338dd394f2b89d34c19f752bf50.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1666033aa7a642a3affcca26e2a304a1x536x141.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ceb2466b8dc4f27816de7b23394db97x1280x2006.JPEG"
    ]
  },
  {
    "text": "All of the following are AIDS defining illnesses except:",
    "choices": [
      {
        "id": 1,
        "text": "Encephalopathy attributed to HIV"
      },
      {
        "id": 2,
        "text": "Invasive cervical cancer"
      },
      {
        "id": 3,
        "text": "Mycobacterium tuberculosis of any site"
      },
      {
        "id": 4,
        "text": "Oral candidiasis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Oral candidiasis(thrush) is not an AIDS-defining\u00a0illness. <strong>Candidiasis </strong>of the <strong>esophagus,\u00a0bronchi, trachea, </strong>or<strong> lungs</strong> is an <strong>AIDS-defining illness</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child presents with hepatitis and progressive neurological degeneration. A picture of his eye has been provided below. Among the following options, what would be the initial step regarding the investigations done for this child's diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Serum ceruloplasmin levels"
      },
      {
        "id": 2,
        "text": "Serum copper levels"
      },
      {
        "id": 3,
        "text": "Enzyme assay"
      },
      {
        "id": 4,
        "text": "Karyotyping"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">This clinical scenario and <strong>Kayser-Fleischer </strong>(KF) <strong>ring</strong>&nbsp;seen in the image are suggestive of <strong>Wilson's</strong> disease. The <strong>initial step</strong> regarding investigations done for the diagnosis is the measurement of serum <strong>ceruloplasmin</strong> levels.</p>\n<p class=\"p1\"><strong>Low serum ceruloplasmin</strong>, <strong>raised 24 hr urinary copper</strong> and <strong>KF rings</strong> are diagnostic in symptomatic cases of Wilson's disease.</p>\n<p class=\"p1\">Lab investigations in Wilson's disease would show:</p>\n<table style=\"width: 498.535px;\">\n<tbody>\n<tr>\n<td style=\"width: 139px;\"><strong>Lab markers</strong></td>\n<td style=\"width: 111px;\"><strong>Change in Wilson's disease</strong></td>\n<td style=\"width: 225.535px;\"><strong>Reason</strong></td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Serum ceruloplasmin</td>\n<td style=\"width: 111px;\">&darr;&darr;&darr;</td>\n<td style=\"width: 225.535px;\">ATP7B deficiency results in reduced bound copper</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">24h urinary copper</td>\n<td style=\"width: 111px;\">&uarr;&uarr;</td>\n<td style=\"width: 225.535px;\">Excess free copper excreted in urine</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Total serum copper</td>\n<td style=\"width: 111px;\">&darr;</td>\n<td style=\"width: 225.535px;\">Due to marked reduction in ceruloplasmin</td>\n</tr>\n</tbody>\n</table>\n<p>Option B: The role of total serum copper in the diagnosis of Wilson's disease is limited. Measurement of <strong>serum ceruloplasmin</strong> and <strong>urinary copper</strong> is <strong>preferred</strong>.</p>\n<p>Option C: ATP7B <strong>enzyme assays</strong> have shown promise in early studies as a neonatal screening test for Wilson's disease. However, it is <strong>not yet part </strong>of routine clinical practice.</p>\n<p>Option D: <strong>Karyotyping</strong>&nbsp;is done for every <strong>asymptomatic</strong> 1st and 2nd degree relative of a patient with Wilson&rsquo;s disease. This helps differentiate the carriers (heterozygous) from the patients (homozygous) and can lead to early initiation of treatment before the onset of symptoms.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/57ba204d1e5a41388d107c1b7d7231e2.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a 2.5 cm swelling on her neck. The swelling is firm, non-tender, and moves on swallowing. TSH, T3, and T4 levels are normal. An ultrasound reports the swelling to be cystic and regular with low suspicion for malignancy. What is the next step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Perform an fine needle aspiration biopsy"
      },
      {
        "id": 2,
        "text": "Perform a Radioiodine uptake test"
      },
      {
        "id": 3,
        "text": "Prepare for resection of nodule"
      },
      {
        "id": 4,
        "text": "Reassure the patient and monitor periodically"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Fine needle aspiration (FNA) biopsy</strong>&nbsp;needs to be performed for further evaluation of the nodule.</p>\n<p>In cases where the FNAC is inconclusive, tru-cut or open biopsy can be done. However, this is rarely required.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e48786779f743f39ae0aebf3625373ex862x1612.PNG"
    ]
  },
  {
    "text": "A patient with acute pancreatitis was admitted following an episode of binge drinking. 7-days post-admission, he complains of fever with chills and rigor. Blood investigation shows a WBC count of 21,450. CT scan reveals the presence of extraluminal gas in the pancreatic tissue. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Cystogastrostomy"
      },
      {
        "id": 2,
        "text": "Cystojejunostomy"
      },
      {
        "id": 3,
        "text": "Percutaneous catheter drainage"
      },
      {
        "id": 4,
        "text": "IV antibiotics alone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario with a history of pancreatitis, elevated WBC, and CT scan findings are suggestive of <strong>pancreatic abscess. </strong>It is treated by <strong>percutaneous drainage.</strong></p>\n<p>A pancreatic abscess is a circumscribed intra-abdominal collection of pus, usually in proximity to the pancreas. It may be an acute fluid collection or walled-off <strong>necrosis<strong><strong>&nbsp;</strong></strong></strong>that has become <strong>infected</strong>.</p>\n<p>Clinical features include:</p>\n<ul>\n<li>Fever with chills</li>\n<li>Elevated white blood cell count</li>\n<li>Abdominal pain</li>\n</ul>\n<p><strong>Contrast-enhanced CT </strong>and <strong>MRI</strong> are both options for the assessment of pancreatic necrosis and abscesses. On imaging, the presence of <strong>extraluminal gas</strong> in the pancreatic and/or peripancreatic tissues is consistent with an underlying infection.</p>\n<article class=\"single-article\"></article>\n<p>Treatment is by <strong>percutaneous drainage with the widest possible drains</strong> placed under imaging guidance, along with appropriate antibiotics and supportive care.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient underwent laparoscopic cholecystectomy for cholelithiasis. Histopathology of the resected gall bladder is reported as Stage T1a of gallbladder cancer. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "No further treatment"
      },
      {
        "id": 2,
        "text": "Perform extended cholecystectomy"
      },
      {
        "id": 3,
        "text": "Adjuvant chemotherapy"
      },
      {
        "id": 4,
        "text": "Palliative nonsurgical therapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cholecystectomy</strong> is sufficient for gallbladder carcinoma with T1a lesions, wherein the tumor penetrates the lamina propria but does not invade the muscle layer.</p>\n<p>Treatment of gallbladder carcinoma (in general):</p>\n<table style=\"height: 272px; width: 407px;\">\n<tbody>\n<tr>\n<td style=\"width: 128.28125px;\"><strong>TNM staging</strong></td>\n<td style=\"width: 263.71875px;\"><strong>Treatment</strong></td>\n</tr>\n<tr>\n<td style=\"width: 128.28125px;\">T<sub>1a</sub></td>\n<td style=\"width: 263.71875px; text-align: left;\">Simple cholecystectomy</td>\n</tr>\n<tr>\n<td style=\"width: 128.28125px;\">T<sub>1b</sub>, T<sub>2</sub>, T<sub>3</sub></td>\n<td style=\"width: 263.71875px; text-align: left;\">Radical cholecystectomy</td>\n</tr>\n<tr>\n<td style=\"width: 128.28125px;\">T<sub>4</sub></td>\n<td style=\"width: 263.71875px; text-align: left;\">Unresectable, chemotherapy and palliative nonsurgical therapy are provided</td>\n</tr>\n<tr>\n<td style=\"width: 128.28125px;\">N<sub>1</sub></td>\n<td style=\"width: 263.71875px; text-align: left;\">Regional lymphadenectomy</td>\n</tr>\n<tr>\n<td style=\"width: 128.28125px;\">N<sub>2</sub></td>\n<td style=\"width: 263.71875px; text-align: left;\">Radical cholecystectomy plus hepatopancreatic duodenectomy</td>\n</tr>\n</tbody>\n</table>\n<p><br />If the carcinoma gall bladder was found incidentally after cholecystectomy:</p>\n<ul>\n<li>Up to stage Ia and stage Ib with negative margins,&nbsp;<strong>standard cholecystectomy</strong> would suffice</li>\n<li>Stage Ib with perineural, lymphatic, vascular invasion and stage II, <strong>extended cholecystectomy</strong> should be performed</li>\n</ul>\n<div class=\"page\" title=\"Page 1232\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>If the initial procedure was performed laparoscopically, the surgeon should examine the laparoscopic port sites. The finding of disease at the port sites is a sign of generalized peritoneal disease and carries a very poor prognosis. However,&nbsp;<strong>resection of port sites </strong>is<strong> no longer recommended.</strong></p>\n<p>Chemotherapy is not required in early gall bladder cancer. Radiation has no role.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the investigation and the lesion depicted in the image given below.",
    "choices": [
      {
        "id": 1,
        "text": "Retrograde cystourethrogram with membranous urethra stricture"
      },
      {
        "id": 2,
        "text": "Retrograde cystourethrogram with penile urethral stricture"
      },
      {
        "id": 3,
        "text": "Micturating cystourethrography with bulbar stricture"
      },
      {
        "id": 4,
        "text": "Micturating cystourethrography with prostratic urethra stricture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">The given image shows <strong>retrograde cystourethrogram</strong> with findings consistent with <strong>penile urethral stricture</strong>.</p>\n<p style=\"text-align: left;\">The male urethra can be visualized by <strong>retrograde urethrography (RGU)</strong>&nbsp;or&nbsp;<strong>voiding cystourethrogram (VCU), </strong>also known as <strong>micturating cystourethrogram (MCU).</strong></p>\n<p style=\"text-align: left;\">In RGU, the urethra is visualized with the instillation of contrast into the <strong>anterior urethra</strong> (penile urethra and bulbar urethra). It is helpful for diagnosing <strong>anterior urethral abnormalities</strong>.</p>\n<p style=\"text-align: left;\">The following image shows an RGU with bulbar urethral stricture:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0f6f0a7e20b94f10b12af9c4debbb0ab.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e25e9ceb90c490d861289d850eac22ex608x520.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08236bd5a4d343518c8760b7cb3d28f3x1080x1400.JPEG"
    ]
  },
  {
    "text": "What is the single most important galactopoetic hormone in post-natal women?",
    "choices": [
      {
        "id": 1,
        "text": "Oxytocin"
      },
      {
        "id": 2,
        "text": "Prolactin"
      },
      {
        "id": 3,
        "text": "Estrogen"
      },
      {
        "id": 4,
        "text": "Progesterone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Prolactin </strong>is the&nbsp;single most important galactopoietic hormone in postnatal women.</p>\n<table style=\"height: 321px;\" width=\"393\">\n<tbody>\n<tr>\n<td style=\"width: 108.640625px;\"><strong>Function</strong></td>\n<td style=\"width: 132.984375px;\"><strong>Definition</strong></td>\n<td style=\"width: 129.390625px;\"><strong>Hormone</strong></td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Mammogenesis</td>\n<td style=\"width: 132.984375px;\">Breast growth and development</td>\n<td style=\"width: 129.390625px;\">\n<p>Estrogen (ductal growth)</p>\n<p>Progesterone (alveolar growth)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Lactogenesis</td>\n<td style=\"width: 132.984375px;\">Initiation of milk secretion</td>\n<td style=\"width: 129.390625px;\">Prolactin</td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Galactokinesis</td>\n<td style=\"width: 132.984375px;\">Ejection of milk</td>\n<td style=\"width: 129.390625px;\">Oxytocin</td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Galactopoiesis</td>\n<td style=\"width: 132.984375px;\">Maintainence of lactation</td>\n<td style=\"width: 129.390625px;\">Prolactin</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman delivered her baby on the way to the hospital. While examining her, you notice a perineal tear. This injury could have been prevented by all except:",
    "choices": [
      {
        "id": 1,
        "text": "Maintaining flexion of head"
      },
      {
        "id": 2,
        "text": "Timely episiotomy as a routine"
      },
      {
        "id": 3,
        "text": "Slow delivery of the head in between contractions"
      },
      {
        "id": 4,
        "text": "Effective perineal guard"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Perineal injury cannot be prevented in normal labor by routine timely episiotomy. Routine episiotomy is associated with an increased incidence of disruption of anal sphincters and rectal tears.</p>\n<p><strong>Indications of episiotomy:</strong></p>\n<ul>\n<li>Shoulder dystocia</li>\n<li>Breech delivery</li>\n<li>Fetal macrosomia</li>\n<li>Operative vaginal deliveries</li>\n<li>Persistent occiput posterior positions</li>\n</ul>\n<p><strong>Methods of prevention of perineal laceration:</strong></p>\n<ul>\n<li>Avoid delivery by early extension</li>\n<li>Deliver head in between contractions</li>\n<li>Perform timely episiotomy when indicated (not routine).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Single-dose of a drug used in emergency contraception:",
    "choices": [
      {
        "id": 1,
        "text": "Levonorgestrel 0.75 mg"
      },
      {
        "id": 2,
        "text": "Ethinyl estradiol+ levonorgestrel"
      },
      {
        "id": 3,
        "text": "Levonorgestrel 1.5 mg"
      },
      {
        "id": 4,
        "text": "Desogestrel 3 mg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Single dose of drug used in emergency contraception is <strong>Levonorgestrel 1.5 mg</strong>.</p>\n<p><strong>Levonorgestrel (LNG):</strong></p>\n<p>Prostinar tablet contains 0.75 mg LNG. One tablet should be taken<strong> within 72 h of unprotected intercourse and another 12 h later</strong>. Alternately, two tablets can be taken as a single dose. <strong>The failure rate is 1.1%</strong>. The tablets can be offered up to 120 h but its efficacy decreases with the longer coital-drug interval. LNG prevents ovulation and causes desynchronization of endometrium through its receptors (luteal phase deficiency). The period may come earlier or delayed.</p>\n<p>Side effects are those of progestogens. The <strong>hormone is not teratogenic in case pregnancy does occur</strong> but risk of ectopic pregnancy remains.</p>\n<p><strong>Advantages:</strong></p>\n<ul>\n<li>It has no oestrogen and its associated side effects</li>\n<li>It can be offered to hypertensive, cardiac and diabetic woman</li>\n<li>It can be offered to a lactating woman</li>\n<li>It can be given as late as 120 h after the unprotected intercourse</li>\n<li>Single-dose therapy is an advantage</li>\n</ul>\n<p><strong>Contraindicated in liver disease</strong>, contains lactate, so allergy to galactose. The drug is also contraindicated in a woman with history of thrombophlebitis and migraine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old child from a draught-ridden village is seen in the medical camp. What is the cause of this skin condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lesch-Nyhan syndrome"
      },
      {
        "id": 2,
        "text": "Marasmus"
      },
      {
        "id": 3,
        "text": "Kwashiorkor"
      },
      {
        "id": 4,
        "text": "Pellagra"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above skin condition is <strong>Flaky paint dermatosis </strong>and is seen in <strong>Kwashiokar.</strong></p>\n<p>These changes commonly occur over the <strong>limbs</strong> and are characterized by <strong>peeling, hyper, and/or hypo-pigmented patches</strong> of skin that are crackled.</p>\n<p><strong>3 Fs</strong> in Kwashiorkor:</p>\n<ul>\n<li><strong>F</strong>atty liver</li>\n<li><strong>F</strong>laky paint dermatosis</li>\n<li><strong>F</strong>lag sign -&nbsp;alternating bands of hypopigmented and normal pigmented areas on the hair strands. (shown below)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d9065cc479a4493aa921b6f31ecf8be1.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e693aa40f4d4bc89221be3f272c316cx348x252.JPEG"
    ]
  },
  {
    "text": "A patient has a history of a road traffic accident 2 years back, and has developed pain and swelling now at the same site. His X-ray image is shown in the image given below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteogenic sarcoma"
      },
      {
        "id": 2,
        "text": "Ewing's sarcoma"
      },
      {
        "id": 3,
        "text": "Chronic osteomyelitis"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows <strong>oval-shaped sequestrum </strong>and periosteal new bone formation surrounding the sequestrum, known as&nbsp;<strong>involucrum</strong>. Along with the given clinical scenario, it is suggestive of&nbsp;<strong>chronic osteomyelitis</strong> of the tibia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/348b625b68ab41dca77f62ed0acd25f5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25473767faa94becbb1021acb8b539c8x1280x979.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8921e24f73664be396e94ba6dd8ddfb4x1280x979.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8db6a6c4971948929c10ad4b774df132x720x765.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9e9731f65584171aa40292bfb2d6b0fx720x1363.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c289cde70b046f889e36bbf1df0071dx720x1850.JPEG"
    ]
  },
  {
    "text": "Identify the structure marked as 'A' in the CT scan shown below:",
    "choices": [
      {
        "id": 1,
        "text": "Descending aorta"
      },
      {
        "id": 2,
        "text": "Ascending aorta"
      },
      {
        "id": 3,
        "text": "Superior vena cava"
      },
      {
        "id": 4,
        "text": "Right pulmonary artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked as 'A' in the CT thorax is the <strong>superior vena cava</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8be2a775b9834e3cbf076523566c263e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1274ffeca49b4fd89e7d0afb70831733x1280x1185.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83cd5d2f7efe4c079c0e5b047d1932d4x1280x1185.JPEG"
    ]
  },
  {
    "text": "Which of the following is not an OCD related disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Hair pulling disorder"
      },
      {
        "id": 2,
        "text": "Temper tantrums"
      },
      {
        "id": 3,
        "text": "Hoarding disorder"
      },
      {
        "id": 4,
        "text": "Skin picking"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Temper tantrums</strong> are not OCD-related.</p>\n<p>Obsessive-compulsive or related disorders (as per ICD 11):</p>\n<p>It refers to a group of disorders that are characterized by repetitive thoughts and behaviors that share similar etiologies and important diagnostic validators. Important features of these disorders are <strong>obsessions, intrusive thoughts, and preoccupations</strong>. It includes:</p>\n<ul>\n<li>Obsessive-compulsive disorder</li>\n<li><strong>Body dysmorphic disorder</strong></li>\n<li><strong>Hypochondriasis</strong></li>\n<li>Olfactory reference disorder</li>\n<li>Hoarding disorder</li>\n<li>Body focused repetitive behavior disorders (Excoriation,&nbsp;Trichotillomania)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the most potent inhaled anesthetic?",
    "choices": [
      {
        "id": 1,
        "text": "Halothane"
      },
      {
        "id": 2,
        "text": "Isoflurane"
      },
      {
        "id": 3,
        "text": "Desflurane"
      },
      {
        "id": 4,
        "text": "Sevoflurane"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most potent</strong> inhaled anesthetic among the given options is <strong>halothane,&nbsp;</strong>with a minimum alveolar concentration (MAC) value of 0.75%.</p>\n<p>The <strong>least potent</strong> inhaled anesthetic is <strong>nitrous oxide</strong> with a MAC value of 104%.</p>\n<p>Note:<strong>&nbsp;</strong>Methoxyflurane has a MAC of 0.16%, making it more potent than halothane. However, it is obsolete now. The&nbsp;most potent agent overall is methoxyflurane and the most potent agent in clinical use&nbsp;is halothane.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While collecting data on nail changes in psoriasis patients, you note the following findings. Which of the following is the most specific finding for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Image A"
      },
      {
        "id": 2,
        "text": "Image D"
      },
      {
        "id": 3,
        "text": "Image C"
      },
      {
        "id": 4,
        "text": "Image B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Subungual oil drop sign</strong> or<strong>&nbsp;salmon patch</strong> (image C),&nbsp;a<strong>&nbsp;highly specific&nbsp;</strong>pathognomonic sign seen in nail psoriasis. It is a yellow-red discoloration in the nail bed resembling a drop of oil. The reddish-brown color is due to dilated, tortuous, superficial capillaries in the papillary dermis and parakeratosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c1e588e9751f4422b856d5669e17e914.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d7ef24f74e9544dcb059ab6443a290e1x1280x2068.JPEG"
    ]
  },
  {
    "text": "Patients with which of the following tumors are best treated with radiotherapy?",
    "choices": [
      {
        "id": 1,
        "text": "Seminoma"
      },
      {
        "id": 2,
        "text": "Melanoma"
      },
      {
        "id": 3,
        "text": "Osteosarcoma"
      },
      {
        "id": 4,
        "text": "Pancreatic carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Patients diagnosed with <strong>seminoma</strong>&nbsp;are best treated with radiotherapy, as it is a <strong>highly radiosensitive</strong> tumor.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 002';
        const quizFilename = 'fmge-mini-test-002-f11fdf67.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>