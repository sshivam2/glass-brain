<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>42 Urethra And Penis - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">17</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Where does urethral stricture most commonly occur?",
    "choices": [
      {
        "id": 1,
        "text": "Penile urethra"
      },
      {
        "id": 2,
        "text": "Bulbar urethra"
      },
      {
        "id": 3,
        "text": "Prostatic urethra"
      },
      {
        "id": 4,
        "text": "Membranous urethra"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most common site of urethral stricture is the&nbsp;<strong>bulbar urethra.</strong></p>\n<p>A urethral stricture is a narrowing of the urethra caused by <strong>scarring</strong>, which functionally causes <strong>obstructive voiding dysfunction</strong> of the lower urinary tract.&nbsp;</p>\n<p>The most common cause of urethral stricture is <strong>trauma</strong>.&nbsp; It can also be <strong>iatrogenic</strong>&nbsp;due urethral catheterization and <strong>infections</strong>.&nbsp;</p>\n<p>These patients present with features of the hesitancy of micturition, straining to void, and poor urinary stream.</p>\n<p>The <strong>most common complication</strong> of urethral stricture is&nbsp;<strong>urinary tract infection.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5967edc9c5da448b9691829b139a4a28x1280x1573.JPEG"
    ]
  },
  {
    "text": "Identify the investigation and the lesion depicted in the image given below.",
    "choices": [
      {
        "id": 1,
        "text": "Retrograde cystourethrogram with membranous urethra stricture"
      },
      {
        "id": 2,
        "text": "Retrograde cystourethrogram with penile urethral stricture"
      },
      {
        "id": 3,
        "text": "Micturating cystourethrography with bulbar stricture"
      },
      {
        "id": 4,
        "text": "Micturating cystourethrography with prostratic urethra stricture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><br />In VCU,&nbsp;after injecting contrast into the bladder using a Foleys catheter,&nbsp;the <strong>posterior urethra </strong>(membranous urethra and prostatic urethra)&nbsp;is visualized during micturition. It is helpful for diagnosing <strong>posterior urethral abnormalities </strong>and&nbsp;<strong>bladder abnormalities. </strong>It is the investigation of choice for <strong>vesicoureteric reflux</strong>&nbsp;(VUR) and <strong>posterior urethral valve</strong>.</p>\n<p style=\"text-align: left;\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/32eb798d6bc34d4892cb9c59c28224b0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e25e9ceb90c490d861289d850eac22ex608x520.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08236bd5a4d343518c8760b7cb3d28f3x1080x1400.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man presents to the OPD with complaints of difficulty to start urination and that he has to strain to maintain a proper flow. He gives a history of pelvic injury one year back. Investigations reveal a stricture of length 1.5 cm at the bulbar urethra. What will be the best management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Urethral dilatation"
      },
      {
        "id": 2,
        "text": "Excision with end-to-end urethroplasty"
      },
      {
        "id": 3,
        "text": "Partial graft urethroplasty"
      },
      {
        "id": 4,
        "text": "Urethrotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with a&nbsp;<strong>short bulbar urethral stricture</strong> (&lt;2cm) due to <strong>trauma</strong>, will be best managed by&nbsp;<strong>excision with end-to-end urethroplasty.&nbsp;</strong>It is the gold standard for the repair of <strong>anterior urethral stricture</strong>.</p>\n<p>The management of a urethral stricture&nbsp;depends on the site, the length, and the cause of the stricture. They include:</p>\n<ul>\n<li><strong>Endoscopic urethrotomy</strong> - The stricture is released using a knife passed through a <strong>rigid urethroscope</strong>.</li>\n<li><strong>Urethroplasty</strong> - <strong>Excision of the stenosed length</strong> of the urethra and <strong>re-anastomosis</strong>&nbsp;is done. A&nbsp;<strong>buccal mucosa graft</strong>&nbsp;can be used to bridge the gap. It is considered when a stricture is due to <strong>trauma</strong> or recurred following e<strong>ndoscopic treatment</strong>.&nbsp;</li>\n<li><strong>Urethral dilation</strong> - The <strong>urethra is stretched</strong> using urethral dilators. This is a blind procedure and it can cause <strong>injury</strong>. Hence, it is not done frequently.</li>\n<li><strong>Intermittent self-dilatation</strong> -&nbsp;In patients with <strong>recurrent strictures</strong> who are <strong>unable to undergo urethroplasty</strong>, then intermittent self-dilatation with soft hydrophilic catheters is done on a daily basis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man was brought to the emergency department after he fell into a manhole and injured his perineum. He gets an urge to micturate but is unable to urinate. On examination, blood was seen at the tip of the urethra, and swelling of the penis and scrotum was seen. What is the site of injury?",
    "choices": [
      {
        "id": 1,
        "text": "Membranous urethra rupture"
      },
      {
        "id": 2,
        "text": "Bulbar urethra injury"
      },
      {
        "id": 3,
        "text": "Prostatic urethra injury"
      },
      {
        "id": 4,
        "text": "Urinary bladder rupture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with a history of a <strong>blow to the perineum</strong>,<strong> blood at the tip of the meatus</strong>,&nbsp;<strong>swelling of the penis and scrotum</strong> is suggestive of an injury to the <strong>bulbar urethra.</strong></p>\n<p>Urethral injuries can be classified into:</p>\n<table style=\"height: 563px; width: 638px;\">\n<tbody>\n<tr style=\"height: 43px;\">\n<td style=\"width: 128.844px; height: 43px;\">&nbsp;Type</td>\n<td style=\"width: 251.156px; height: 43px;\"><strong>Proximal urethral injury</strong></td>\n<td style=\"width: 235px; height: 43px;\"><strong>Distal urethral injury</strong></td>\n</tr>\n<tr style=\"height: 82px;\">\n<td style=\"width: 128.844px; height: 82px;\">Site of injury</td>\n<td style=\"width: 251.156px; height: 82px;\">\n<ul>\n<li>Prostatic urethra</li>\n<li>Membranous urethra</li>\n</ul>\n</td>\n<td style=\"width: 235px; height: 82px;\">\n<ul>\n<li>Bulbar urethra</li>\n<li>Penile urethra</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 168px;\">\n<td style=\"width: 128.844px; height: 168px;\">Mechanism</td>\n<td style=\"width: 251.156px; height: 168px;\">Secondary to <strong>pelvic fracture</strong></td>\n<td style=\"width: 235px; height: 168px;\">\n<p>Occurs due to a blow to the perineum by:</p>\n<ul>\n<li><strong>Straddle injury</strong></li>\n<li><strong>Loose manhole covering</strong></li>\n<li>Gymnasium accidents</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 244px;\">\n<td style=\"width: 128.844px; height: 244px;\">Clinical features</td>\n<td style=\"width: 251.156px; height: 244px;\">\n<ul>\n<li>Urinary retention</li>\n<li>Blood at the urethral meatus</li>\n<li>High-riding prostate on digital rectal examination (<strong>Vermooten sign</strong>)</li>\n<li>Deep perineal hematoma</li>\n</ul>\n</td>\n<td style=\"width: 235px; height: 244px;\">\n<ul>\n<li>Urinary retention</li>\n<li>Blood at the urethral meatus</li>\n<li>Perineal hematoma (<strong>b</strong><strong>utterfly hematoma</strong>)</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><br />Note: Urinary bladder rupture occurs due to an injury to the <strong>suprapubic</strong> region.&nbsp;<strong>Extraperitoneal</strong> bladder rupture is more common and associated with<strong> pelvic fracture</strong>. <strong>Intraperitoneal</strong> bladder rupture is caused by a blow or a fall on a <strong>distended bladder</strong>. It manifests as sudden severe <strong>pain in the hypogastrium</strong> and <strong>syncope</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old was brought to the ER after falling off his bicycle. His vitals were stable, but he had a bruise over the perineum and he has not passed urine yet. Blood was seen at the meatus and the bladder was not palpable. What will be the next step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Suprapubic catheterization"
      },
      {
        "id": 2,
        "text": "Immediate insertion of foleys catheter"
      },
      {
        "id": 3,
        "text": "Nephrogram"
      },
      {
        "id": 4,
        "text": "Wait for bladder to fill and urge to urinate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical features such as perineal bruise and blood at the urethral meatus following a fall from the bicycle are suggestive of a <strong>bulbar urethral injury</strong>. In this case, as the <strong>bladder is not palpable</strong> the best option would be to <strong>wait for the</strong> <strong>bladder to fill and urge to urinate</strong>. Once the bladder is full the urine should be drained by a <strong>suprapubic catheter.</strong></p>\n<p><strong>Foleys catheter insertion should not be done </strong>in cases of suspected <strong>urethral injury</strong>, as it can convert a partial tear into a complete tear.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/235cb96aa2354e83a1f80db69712e7cax1280x2105.JPEG"
    ]
  },
  {
    "text": "A worried mother brings her 18-month-old son to OPD with complaints of repeated urinary tract infections. During diagnostic work-up, pelvic USG shows the following finding. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Vesicoureteric reflux"
      },
      {
        "id": 2,
        "text": "Posterior urethral valve"
      },
      {
        "id": 3,
        "text": "Ureterocele"
      },
      {
        "id": 4,
        "text": "Pelvi-ureteric junction obstruction"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with the USG showing the&nbsp;<strong>key-hole sign</strong>&nbsp;is suggestive of the&nbsp;<strong>posterior urethral valve (PUV)</strong>. It is seen due to dilatation of the bladder and the proximal urethra.</p>\n<p>The posterior urethral valves are <strong>membranes</strong> that have a small posterior slit, which lies just <strong>distal to the verumontanum.&nbsp;</strong>They function as flap valves and are <strong>obstructive to antegrade urinary flow</strong>.</p>\n<p>The posterior urethral valve is the most common congenital cause of bladder outlet obstruction in males. PUV is classified into three types based on <strong>Young's classification.</strong></p>\n<div class=\"page\" title=\"Page 1498\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is made <strong>antenatally</strong> with <strong>ultrasound</strong>, which demonstrates <strong>bilateral hydronephrosis above a distended bladder</strong>.&nbsp;If the diagnosis is not made antenatally, then neonates typically present with urinary infection or&nbsp;<strong>uremia</strong> and <strong>renal failure</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 1498\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The investigation of choice for a posterior urethral valve is&nbsp;<strong>micturating cystourethrography (MCUG).</strong></p>\n<p>Initially, the obstruction is relieved by <strong>catheterization</strong> to preserve renal function. Definitive treatment is by <strong>urethroscopic destruction of the valves </strong>with lifelong supportive treatment.&nbsp;</p>\n<p>The following VCUG shows vesicoureteric reflux due to posterior urethral valves:</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e73d024662f34d1bb8a690d6a13e7640.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/92222870b817434f822033561d0ba3e8x790x786.JPEG"
    ]
  },
  {
    "text": "A newborn was found to have a following anomaly of the penile urethra while being examined by a pediatrician. Identify the incorrect statement regarding the condition.",
    "choices": [
      {
        "id": 1,
        "text": "It is the most common congenital abnormality of the urethra"
      },
      {
        "id": 2,
        "text": "Circumcision should be done to remove the excess skin"
      },
      {
        "id": 3,
        "text": "It does not cause urinary obstruction"
      },
      {
        "id": 4,
        "text": "Ventral\u00a0chordee is a common association"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><br />The image below shows <strong>epispadias</strong> with <strong>bladder exstrophy</strong>:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5ec5ec6428c14c278f7c3625aad688ec.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1acd96af2a024d718463d238bd9a5f93x600x747.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf89df7753cc4c5ba7cb6d0affc8ad12x448x510.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e2199c750caf49f29fb7abea9892b61dx1043x1053.JPEG"
    ]
  },
  {
    "text": "What is the appropriate age at which corrective surgery should be done for the defect shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "6-18 months"
      },
      {
        "id": 2,
        "text": "1-6 months"
      },
      {
        "id": 3,
        "text": "Immediately after birth"
      },
      {
        "id": 4,
        "text": "After 2 years of age"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows <strong>penoscrotal hypospadias.</strong> Operations for hypospadias are routinely performed when the patient is between <strong>6 and 18 months</strong> of age. The infant has good <strong>tolerance to surgery</strong> by the age of <strong>6</strong> months. The child is well <strong>aware of his genitalia</strong> and will be <strong>toilet trained</strong> by the age of <strong>18</strong> months.</p>\n<p>Surgery in hypospadias is done to correct problems with the urinary stream and for cosmetic reasons. The main principles of surgery in hypospadias include:</p>\n<div class=\"page\" title=\"Page 971\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1499\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li><strong>Orthoplasty</strong> - Chordee correction</li>\n<li><strong>Urethroplasty</strong> - To reposition the urethral opening</li>\n<li><strong>Glanuloplasty</strong> - Reconstruction of glans</li>\n<li>Skin cover and <strong>scrotoplasty</strong></li>\n</ul>\n<p>Surgery depends on the <strong>site</strong> of the hypospadias. <strong>Tubularized incised plate (TIP) urethroplasty </strong>is the most commonly done procedure. It is done for <strong>distal</strong> hypospadias.</p>\n<p>&nbsp;<strong>Complications&nbsp;</strong>of hypospadias surgery include:</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li><strong>Urethrocutaneous fistula </strong>(most common)</li>\n<li>Recurrence of chordee</li>\n<li>Urethral stricture</li>\n<li>Meatal stenosis</li>\n<li>Infection</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e157b1d3274b461f8891381e6f77dfb2.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with sickle cell anemia presents to the casualty with complaints of painful erection of the penis for the past 5 hours. On examination, his penis is rigid. Penile blood aspiration is performed and it shows dark-colored blood. This patient can be managed by all of the following, except:",
    "choices": [
      {
        "id": 1,
        "text": "Aspiration of the sludged blood"
      },
      {
        "id": 2,
        "text": "Intracavernosal phenylephrine injection"
      },
      {
        "id": 3,
        "text": "Selective arterial embolization"
      },
      {
        "id": 4,
        "text": "Quackel's shunt"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario with a <strong>sickle cell patient</strong> having <strong>prolonged erection</strong> and <strong>dark-colored blood</strong> in penile aspiration is suggestive of <strong>low-flow priapism</strong>. Selective arterial embolization has no role in low-flow priapism.</p>\n<p>Persistent erection of penis lasting <strong>longer than 4 hours </strong>is defined as priapism.<strong>\u00a0</strong>If the erection lasts for more than 6 hours, ischemia and necrosis can occur. Hence ischemic priapism is a surgical\u00a0<strong>emergency</strong>.</p>\n<table style=\"width: 632.547px; height: 564px;\">\n<tbody>\n<tr style=\"height: 37px;\">\n<td style=\"width: 158px; height: 37px;\">Type</td>\n<td style=\"width: 215px; height: 37px;\"><strong>Low-flow / Ischemic priapism</strong></td>\n<td style=\"width: 234.547px; height: 37px;\"><strong>High-flow / Non-ischemic priapism</strong></td>\n</tr>\n<tr style=\"height: 37px;\">\n<td style=\"width: 158px; height: 37px;\">Mechanism</td>\n<td style=\"width: 215px; height: 37px;\"><strong>Venous</strong> outflow obstruction</td>\n<td style=\"width: 234.547px; height: 37px;\">Increased <strong>arterial</strong> flow</td>\n</tr>\n<tr style=\"height: 37px;\">\n<td style=\"width: 158px; height: 37px;\">Incidence</td>\n<td style=\"width: 215px; height: 37px;\">More common</td>\n<td style=\"width: 234.547px; height: 37px;\">Less common</td>\n</tr>\n<tr style=\"height: 59px;\">\n<td style=\"width: 158px; height: 59px;\">Cause</td>\n<td style=\"width: 215px; height: 59px;\">\n<p><strong>Sickle cell anemia</strong></p>\n<p>Leukemia</p>\n<p>Antipsychotics</p>\n</td>\n<td style=\"width: 234.547px; height: 59px;\">\n<p><strong>Trauma</strong></p>\n<p>Papaverine injection</p>\n<p>Spinal injury</p>\n</td>\n</tr>\n<tr style=\"height: 92px;\">\n<td style=\"width: 158px; height: 92px;\">\n<p>Pain</p>\n</td>\n<td style=\"width: 215px; height: 92px;\">\n<p><strong>Painful</strong></p>\n</td>\n<td style=\"width: 234.547px; height: 92px;\">\n<p>Painless</p>\n</td>\n</tr>\n<tr style=\"height: 63px;\">\n<td style=\"width: 158px; height: 63px;\">\n<p>Corpora cavernosa</p>\n</td>\n<td style=\"width: 215px; height: 63px;\">\n<p>Rigid</p>\n</td>\n<td style=\"width: 234.547px; height: 63px;\">\n<p>Tumescent</p>\n</td>\n</tr>\n<tr style=\"height: 81px;\">\n<td style=\"width: 158px; height: 81px;\">\n<p>Penile blood gas analysis</p>\n</td>\n<td style=\"width: 215px; height: 81px;\">\n<p>Deoxygenated blood</p>\n</td>\n<td style=\"width: 234.547px; height: 81px;\">\n<p>Oxygenated blood</p>\n</td>\n</tr>\n<tr style=\"height: 92px;\">\n<td style=\"width: 158px; height: 92px;\">\n<p>Doppler</p>\n</td>\n<td style=\"width: 215px; height: 92px;\">\n<p>Absence of blood flow within the penis</p>\n</td>\n<td style=\"width: 234.547px; height: 92px;\">\n<p>Demonstrate the <strong>fistula</strong>\u00a0between the artery and the sinusoidal space due to trauma</p>\n</td>\n</tr>\n<tr style=\"height: 84px;\">\n<td style=\"width: 158px; height: 84px;\">Treatment</td>\n<td style=\"width: 215px; height: 84px;\">\n<div class=\"page\" title=\"Page 1512\">\n<div class=\"page\" title=\"Page 1512\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Aspiration</strong> of the sludged blood in the corpora cavernosa</p>\n<p>Intracavernosal <strong>phenylephrine</strong> injection\u00a0</p>\n<p><strong>Decompression</strong> of the penis by creating a shunt between the corpus cavernosum and either the glans (<strong>Winter shunt</strong>) or the corpus spongiosum (<strong>Quackel's shunt</strong>)\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 234.547px; height: 84px;\">Selective arterial embolization</td>\n</tr>\n</tbody>\n</table>\n<p><strong><br />Stuttering </strong>or<strong>\u00a0intermittent</strong>\u00a0<strong>priapism</strong> is historically described as\u00a0<strong>recurrent</strong> unwanted and <strong>painful erections</strong> in men with <strong>sickle cell disease (SCD).\u00a0</strong>Any patient who has experienced an episode of ischemic priapism is also at risk for stuttering priapism.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dc4d82aaba264576869c0dfe0dd6a47cx600x603.JPEG"
    ]
  },
  {
    "text": "What is the most common cause of erectile dysfunction?",
    "choices": [
      {
        "id": 1,
        "text": "Drugs"
      },
      {
        "id": 2,
        "text": "Stress"
      },
      {
        "id": 3,
        "text": "Atherosclerosis"
      },
      {
        "id": 4,
        "text": "Diabetes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most common cause of erectile dysfunction (ED) is <strong>stress</strong>. It can also be associated with diabetes, hypertension, dyslipidemia, and smoking.</p>\n<p>The most common pathological cause of ED is vascular disease affecting the penile arterial blood flow.</p>\n<p>Evaluation of ED involves confirmation of the diagnosis by history taking, assessing the patient for underlying risk factors, and physical examination of the genitalia. Measurement of the <strong>blood pressure</strong> and assessment of the <strong>secondary sexual characteristics</strong> is also done.</p>\n<p>Biochemical assessment of the <strong>blood sugar</strong>, the <strong>serum lipid profile</strong>, and the <strong>serum testosterone</strong> is done in all cases.</p>\n<p>Treatment involves the use of <strong>phosphodiesterase-V inhibitors</strong> (sildenafil) with an intra-cavernosal injection of <strong>alprostadil</strong>. <strong>Vacuum erection devices</strong> and penile implants are reserved for resistant cases.</p>\n<p>The most common cause of erectile dysfunction in:</p>\n<ul>\n<li>Middle-aged men: Psychological\u00a0</li>\n<li>Older men: Organic (atherosclerosis)</li>\n<li>Overall: Psychological\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are indications to perform circumcision in children, except:",
    "choices": [
      {
        "id": 1,
        "text": "1 and 4"
      },
      {
        "id": 2,
        "text": "2 and 5"
      },
      {
        "id": 3,
        "text": "3 and 5"
      },
      {
        "id": 4,
        "text": "3 and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A tight frenulum and physiological phimosis are <strong>not </strong>indications of circumcision in children.&nbsp;</p>\n<p><strong>Physiological phimosis</strong> is seen in children that are <strong>less than 6 years</strong> of age (2-6 years) due to natural adhesions between the glans and inner preputial skin. It rectifies on its own.&nbsp;</p>\n<p>Circumcision is the surgical <strong>removal of the foreskin</strong> that covers the glans penis.</p>\n<p>Indications of circumcision in children:&nbsp;</p>\n<ul>\n<li><strong>True</strong> <strong>phimosis</strong> (associated with a white, scarred preputial orifice, most common just before puberty)</li>\n<li>Paraphimosis</li>\n<li><strong>On request</strong> (most common)&nbsp;</li>\n<li><strong>Balanitis xerotica obliterans</strong> (BXO)</li>\n<li>Recurrent UTI with abnormal upper urinary tract</li>\n<li>Recurrent balanoposthitis</li>\n</ul>\n<p>Indications of circumcision in adults:&nbsp;</p>\n<ul>\n<li>Recurrent balanitis&nbsp;</li>\n<li><strong>Tight frenulum</strong> (Splitting of frenulum can occur during sexual activity)</li>\n<li>Inability to retract the foreskin for intercourse&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4aea5a01bf79432d81f6772a9d425f92x1280x2774.JPEG"
    ]
  },
  {
    "text": "A 7-year-old boy was catheterized for a surgical procedure, and an intern noticed the following finding when he removed the catheter.  A manual reduction was attempted and was not successful.  What will be the next step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Circumcision"
      },
      {
        "id": 2,
        "text": "Nesbit's procedure"
      },
      {
        "id": 3,
        "text": "Urinary diversion"
      },
      {
        "id": 4,
        "text": "Dorsal slit procedure"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical history and the image showing swollen glans are suggestive of&nbsp;<strong>paraphimosis. </strong>If manual reduction of the skin is unsuccessful, a <strong>dorsal slit procedure</strong> should be performed.</p>\n<p><strong>Paraphimosis&nbsp;</strong>is the inability to place back the retracted preputial skin. This creates a <strong>ring-like constriction</strong>,<strong>&nbsp;</strong>and the glans tend to be <strong>swollen</strong>, and&nbsp;<strong>edematous</strong>, with severe pain and tenderness. Paraphimosis is precipitated after sexual intercourse or iatrogenically after <strong>urethral catheterization.</strong></p>\n<p>The&nbsp;<strong>first</strong>&nbsp;line of treatment includes&nbsp;<strong>manual reduction</strong>&nbsp;of the skin by applying lignocaine jelly. Ice bags and injection of a solution of hyaluronidase in normal saline may help to reduce the swelling.</p>\n<p>If this fails,&nbsp;an&nbsp;initial <strong>dorsal slit</strong>&nbsp;is made to relieve the edema and compression.&nbsp;Antibiotics and analgesics are also given. <strong>Circumcision</strong>&nbsp;is performed&nbsp;<strong>after 3 weeks</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a6d4ad6f1573413eb1e9a34da7fc629a.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In patients with which of the following symptoms is Nesbitt\u2019s procedure done?",
    "choices": [
      {
        "id": 1,
        "text": "Penile deformity, painful erection and palpable penile plaques"
      },
      {
        "id": 2,
        "text": "Downward directed stream of urine with bending of penis"
      },
      {
        "id": 3,
        "text": "Painful erection of penis > 4hrs"
      },
      {
        "id": 4,
        "text": "Popping sound during sexual intercourse, painful and flaccid penis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><br />Nesbitt's procedure</strong> corrects the deformity by <strong>plicating the opposite side of the deformity</strong>, thereby straightening the penis. This procedure&nbsp;is done once the <strong>active phase</strong> subsides as the <strong>bend increases</strong> during the active phase (18-24 months).&nbsp;&nbsp;</p>\n<p>Option B: <strong>Downward directed stream of urine</strong> with bending of the penis are symptoms of <strong>hypospadias</strong>.</p>\n<p>Option C: Persistent <strong>erection lasting longer than 4 hours</strong> is called <strong>priapism</strong>.</p>\n<p>Option D:&nbsp;<strong>Popping sound during sexual intercourse</strong>, painful and flaccid penis is suggestive of <strong>fracture of the penis</strong>. There will be&nbsp;bluish discoloration of the penis and scrotum due to extensive bruising (<strong>eggplant deformity</strong>). Management is mainly surgery for <strong>evacuation of hematoma</strong> and <strong>repair</strong> of corpora.</p>\n<p>The image below shows eggplant deformity in fracture of the penis:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/31794e444c064e7db72067079bc6293fx1279x1560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2bf549f7ecf041b3b7a62dfe7631d4dbx1280x985.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d03b94360121425a990bb918a30c7929x708x446.PNG"
    ]
  },
  {
    "text": "Heineke-Mikulicz principle is used in which of the following procedures?",
    "choices": [
      {
        "id": 1,
        "text": "Preputioplasty & circumcision"
      },
      {
        "id": 2,
        "text": "Preputioplasty & frenuloplasty"
      },
      {
        "id": 3,
        "text": "Circumcision & frenuloplasty"
      },
      {
        "id": 4,
        "text": "Circumcision alone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Heineke-Mikulicz principle is used in both&nbsp;<strong>preputioplasty and&nbsp;frenuloplasty.&nbsp;</strong></p>\n<p>The&nbsp;Heineke-Mikulicz principle involves the use of a <strong>longitudinal incision followed by a transverse&nbsp;closure, </strong>or vice-versa.&nbsp;In&nbsp;<strong>preputioplasty</strong>, it allows for the <strong>retraction of the foreskin</strong>, and in <strong>frenuloplasty</strong>, it allows the <strong>lengthening of the&nbsp;frenulum</strong>.&nbsp;</p>\n<p><strong>Heineke-Mikulicz's pyloroplasty</strong> also uses the same principle. Here, a <strong>longitudinal incision is done through the pylorus</strong>, with extension to the duodenum and gastric antrum. This incision is then <strong>closed transversely</strong>.&nbsp; It is done for <strong>gastric outlet obstruction</strong> and along with <strong>highly selective vagotomy</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding carcinoma of the penis?",
    "choices": [
      {
        "id": 1,
        "text": "Balanitis xerotica obliterans is a pre-malignant condition"
      },
      {
        "id": 2,
        "text": "It is usually painless"
      },
      {
        "id": 3,
        "text": "Jackson staging is used to stage the disease"
      },
      {
        "id": 4,
        "text": "Superficial inguinal lymphadenopathy indicates metastasis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Superficial inguinal lymphadenopathy</strong> in the context of <strong>carcinoma of the penis</strong> more often reflects <strong>infection</strong> rather than metastatic disease.&nbsp;</p>\n<p>It is usually a <strong>painless</strong> condition and the patient <strong>presents late</strong> because of embarrassment or misdiagnosis. They may&nbsp; present with:</p>\n<ul>\n<li>Large <strong>fungating</strong> lesion</li>\n<li>Foul, bloody discharge (secondary to infection)&nbsp;</li>\n<li>Non-retractile prepuce</li>\n<li><strong>Enlarged inguinal lymph nodes</strong> (often due to infection)</li>\n<li>Erosion of inguinal lymph nodes&nbsp;</li>\n</ul>\n<p><strong>Jackson staging</strong> is used for the staging of penile carcinoma:</p>\n<ul>\n<li>Stage I - Only&nbsp;<strong>glans&nbsp;</strong>/&nbsp;<strong>prepuce</strong>&nbsp;involved</li>\n<li>Stage II - Tumour extending into the&nbsp;<strong>body of penis</strong></li>\n<li>Stage III - Tumour having&nbsp;<strong>mobile inguinal nodes</strong></li>\n<li>Stage IV - Tumour spreading to&nbsp;<strong>adjacent structures&nbsp;</strong>/&nbsp;<strong>fixed nodes</strong></li>\n</ul>\n<p>Premalignant lesions of penile squamous cell carcinoma include</p>\n<ul>\n<li><strong>Bowen disease -</strong>&nbsp;Reddish papules&nbsp;in the&nbsp;<strong>shaft</strong> of the penis</li>\n<li><strong>Erythroplasia of Queyrat -&nbsp;</strong>Reddish papules&nbsp;involving <strong>glans</strong> and prepuce</li>\n<li>Condyloma acuminatum<strong>&nbsp;</strong>- Usually benign, but<strong>&nbsp;</strong>can undergo a malignant transformation (<strong>Buschke&ndash;L&ouml;wenstein tumor</strong>)&nbsp;when associated with&nbsp;HPV 16, 18, 31, 33, 35, and 39</li>\n<li><strong>Balanitis xerotica obliterans (BXO) - </strong>White, thickened foreskin which forms a constricting band. This prevents retraction and later develops into carcinoma</li>\n<li>Leukoplakia</li>\n</ul>\n<p>The following image shows erythroplasia of Queyrat:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef8694a7f1c84f7d9450be413b6e77c1x500x376.PNG"
    ]
  },
  {
    "text": "A 52-year-old man came to the urology OPD with complaints of a slow-growing ulcerative lesion in the penis for the past few months. On examination, a fungating mass in his glans penis was seen and lymph nodes were not palpable. He was suspected to have penile carcinoma. Which of the following statements is false regarding the management of the patient?",
    "choices": [
      {
        "id": 1,
        "text": "MRI is the investigation of choice for staging"
      },
      {
        "id": 2,
        "text": "1cm margin of normal tissue must be removed"
      },
      {
        "id": 3,
        "text": "Sentinel lymph node biopsy should be done"
      },
      {
        "id": 4,
        "text": "If stump is < 3cm, total amputation of the penis is done"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In penile carcinoma, <strong>total amputation</strong> of the penis is done if the <strong>stump is &lt; 2cm</strong>.</p>\n<p>The investigation of choice for penile carcinoma is a <strong>biopsy</strong> from the primary tumor. For <strong>staging</strong>, <strong>MRI</strong> is the investigation of choice.</p>\n<p>The <strong>first lymph node</strong> to be involved is the <strong>superficial inguinal lymph node</strong> and thus, the <strong>sentinel lymph node biopsy (SLNB)</strong> is helpful for evaluating the spread of penile cancer.</p>\n<p>The management is divided into treatment of the primary tumour and the treatment of the lymph nodes.\u00a0</p>\n<p>The main principles of penile cancer surgery are to <strong>remove a 1cm margin of normal tissue</strong> and have <strong>at least a 2cm stump</strong> after surgery.</p>\n<p>Surgery is the mainstay treatment of penile cancer. <strong>Chemotherapy</strong> regime includes <strong>5-fluorouracil and cisplatin</strong>. <strong>Radiotherapy</strong> can be done for inguinal lymph nodes if lymph node dissection is not done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2008d88e432f4db0b71ec4f33d005f18x1280x2304.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most important prognostic factor in patients with penile cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Depth of primary lesion"
      },
      {
        "id": 2,
        "text": "Stage of primary lesion"
      },
      {
        "id": 3,
        "text": "Site of primary lesion"
      },
      {
        "id": 4,
        "text": "Lymph node status"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 1514\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Inguinal lymph node status</strong> is the most important prognostic indicator in penile carcinoma.</p>\n<p>The prognosis for <strong>tumors confined to the penis</strong> is good with 5-year survival rates in excess of <strong>80%</strong>. With <strong>nodal involvement</strong>, the 5-year survival rate falls to around <strong>40%</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '42 Urethra And Penis';
        const quizFilename = '42-urethra-and-penis-6e746c2d.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>