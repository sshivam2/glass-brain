<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>37 Vasculitis - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a large vessel vasculitis?",
    "choices": [
      {
        "id": 1,
        "text": "Giant cell arteritis"
      },
      {
        "id": 2,
        "text": "Behcet's syndrome"
      },
      {
        "id": 3,
        "text": "Cogan's syndrome"
      },
      {
        "id": 4,
        "text": "Cryoglobulinemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Giant cell arteritis&nbsp;</strong>is a <strong>large vessel vasculitis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following vasculitides involves veins except?",
    "choices": [
      {
        "id": 1,
        "text": "Thrombangiitis obliterans"
      },
      {
        "id": 2,
        "text": "Behcet disease"
      },
      {
        "id": 3,
        "text": "Leucocytoclastic vasculitis"
      },
      {
        "id": 4,
        "text": "Giant cell arteritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Giant cell arteritis does not involve the veins.</p>\n<p>Vasculitides affecting the veins are as follows:</p>\n<ul>\n<li>Leukocytoclastic vasculitis</li>\n<li>Behcet disease</li>\n<li>Buerger disease (Thrombangiitis obliterans)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents with sudden onset blindness. He gives a history of frequent headaches along the sides of his scalp. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Thromboangiitis obliterans"
      },
      {
        "id": 2,
        "text": "Granulomatosis with polyangiitis"
      },
      {
        "id": 3,
        "text": "Takayasu arteritis"
      },
      {
        "id": 4,
        "text": "Giant cell arteritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>giant cell arteritis</strong>.</p>\n<p><strong>Giant cell / temporal arteritis&nbsp;</strong>is a chronic inflammatory disorder of large to small-sized arteries that especially affects the <strong>temporal arteries. </strong>It is seen in people over <strong>50 years</strong> of age. It usually presents with facial pain or <strong>headache </strong>along the course of the <strong>superficial temporal artery.</strong></p>\n<p>It can also affect:</p>\n<ul>\n<li><strong>Ophthalmic arteries</strong>- leading to <strong>sudden onset diplopia </strong>or blindness</li>\n<li><strong>Aorta</strong>- leading to<strong>&nbsp;giant-cell aortitis</strong></li>\n<li><strong>Vertebral arteries</strong></li>\n</ul>\n<p>A biopsy is needed to confirm the diagnosis.</p>\n<p>Giant cell arteritis needs to be promptly diagnosed and treated with <strong>steroids</strong> to prevent permanent blindness.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly patient presented with temporal headache and jaw claudication. She was diagnosed to be a case of Giant cell arteritis. Which of the following statements about giant cell arteritis is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Inflammatory lesions are focally distributed"
      },
      {
        "id": 2,
        "text": "A negative biopsy excludes the diagnosis"
      },
      {
        "id": 3,
        "text": "The classic lesions are medial granulomas"
      },
      {
        "id": 4,
        "text": "Fragmentation is seen in internal elastic lamina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A negative biopsy cannot exclude the diagnosis of giant cell arteritis. It is because the <strong>lesions are focally distributed. </strong>A&nbsp;biopsy sample may be taken from the normal part of the artery leading to a false-negative report. An adequate biopsy requires at least a 1-cm segment.</p>\n<p><strong>Biopsy findings</strong>:</p>\n<ul>\n<li>Giant cell arteritis is primarily <strong>medial granulomatous inflammation</strong><strong>. </strong></li>\n<li>These lesions involve the internal elastic lamina&nbsp;leading to&nbsp;<strong>elastic lamina fragmentation.</strong></li>\n<li>There is<strong> intimal thickening </strong>that reduces the luminal diameter.</li>\n</ul>\n<p><strong>Granulomas</strong> with multinucleated giant cells, infiltrate of T cells (CD4+ &gt;CD8+), and macrophages.<br /><strong><br />Note</strong>&nbsp;:&nbsp;According to the 21st edition of Harrison's Medicine, as involvement of the vessel may be segmental, getting a biopsy segment of 3&ndash;5 cm together with serial sectioning of biopsy specimens would help to increase a positive yield. And Robbin's 10th edition mentions that an adequate biopsy requires at least a 1-cm segment.</p>\n<p><strong>Image</strong>: Giant-cell arteritis with intimal thickening and internal elastic lamina fragmentation</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d1f97d1accf94d96ba346ce5c7d751c9x1280x950.JPEG"
    ]
  },
  {
    "text": "A 30-year-old lady presents with weakness of the left upper limb. On examination, the blood pressure recorded on the left upper limb was found to be lower than that of the right upper limb. Her aortic arch angiogram showed narrowing of the arch of the aorta and subclavian artery. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Giant-cell arteritis"
      },
      {
        "id": 2,
        "text": "Takayasu arteritis"
      },
      {
        "id": 3,
        "text": "Thrombangiitis obliterans"
      },
      {
        "id": 4,
        "text": "Behcet's Disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and radiological findings are suggestive of <strong>Takayasu arteritis</strong>.</p>\n<p><strong>Takayasu's arteritis&nbsp;</strong>is a granulomatous vasculitis affecting medium and large-sized arteries, in this case, the&nbsp;<strong>aortic arch</strong>&nbsp;and its&nbsp;<strong>branches.</strong>&nbsp;Clinical manifestations include&nbsp;<strong>vision&nbsp;disturbances</strong>&nbsp;and profound&nbsp;<strong>weakening of the pulses</strong>, especially in the upper&nbsp;<strong>extremities</strong>.&nbsp;</p>\n<p><strong>Histopathology:</strong></p>\n<ul>\n<li><span style=\"font-size: 12pt;\">Irregular thickening of the vessel wall is seen with associated&nbsp;<strong>intimal hyperplasia.</strong>&nbsp;</span></li>\n<li><span style=\"font-size: 12pt;\">Characteristic&nbsp;<strong>granulomatous inflammation,</strong>&nbsp;with the presence of&nbsp;<strong>giant cells</strong>&nbsp;and patchy&nbsp;<strong>medial necrosis.</strong></span></li>\n<li><span style=\"font-size: 12pt;\">Disease progression is associated with&nbsp;<strong>collagenous scarring&nbsp;</strong>and chronic inflammatory infiltrates across all layers of the vessel wall.</span>&nbsp;</li>\n</ul>\n<p>Other options-&nbsp;</p>\n<p>Option A: <strong>Giant cell arteritis</strong> (GCA), also known as<strong> temporal arteritis</strong>, is an inflammation of medium and large-sized vessels. It is more common in women and <strong>people aged &gt;50 years</strong>.<br />The clinical features include headache associated with scalp pain and jaw claudication, fever, fatigue, malaise, and weight loss. Half of the patients have temporal artery abnormalities such as enlargement, tenderness, nodular swelling, and loss of pulse of the temporal artery, either unilateral or bilateral. Gentle pressure on the scalp may elicit focal or generalized tenderness.&nbsp;<br />Though the arch of the aorta may also be involved in giant cell arteritis (known as giant cell aortitis), it is seen in people more than 50 years of age. Whereas, Takayasu arteritis is seen more commonly in adolescents and young women.</p>\n<p>Option C: <strong>Thromboangitis obliterans</strong>, also known as <strong>Buerger's disease</strong>, is an inflammatory occlusive vascular disorder involving medium- and small-sized vessels in the distal extremities. It is most frequently seen in <strong>male smokers</strong> less than 40 years of age.</p>\n<p>Option D: <strong>Behcet's disease </strong>is a neutrophilic vasculitis affecting small- to medium-sized vessels that classically presents as a clinical triad of recurrent <strong>oral aphthous ulcers</strong>,<strong> genital ulcers, and uveitis</strong>. There can also be gastrointestinal and pulmonary manifestations, with disease mortality related to severe neurologic involvement or rupture of vascular aneurysms.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young girl with bilaterally unequal pulses is diagnosed with Takayasu Arteritis. Which of the following is the most commonly involved site in Takayasu arteritis?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary artery"
      },
      {
        "id": 2,
        "text": "Coronary arteries"
      },
      {
        "id": 3,
        "text": "Abdominal aorta"
      },
      {
        "id": 4,
        "text": "Subclavian artery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most commonly involved blood vessel in Takayasu arteritis is <strong>sublclavian artery.</strong></p>\n<p class=\"p1\"><span class=\"s1\">Takayasu arteritis </span>is an inflammatory and stenotic disease of medium and large-sized arteries characterized by a strong predilection for the aortic arch and its branches.&nbsp;It is also known as&nbsp;<strong>aortic arch syndrome.</strong></p>\n<p>The order of arteries affected in Takayasu arteritis is <strong>subclavian artery</strong> &gt; common carotid artery &gt; abdominal aorta &gt; renal artery &gt; aortic arch = vertebral &gt; coeliac axis &gt; iliac &gt; pulmonary &gt; coronary artery.</p>\n<p>Takayasu arteritis&nbsp;causes irregular&nbsp;<strong>thickening</strong> of the vessel wall with <strong>intimal hyperplasia</strong> leading to narrowing of the lumen and organ ischemia.</p>\n<p>It may have various clinical presentations depending on the vessel involved:</p>\n<ul>\n<li>Arch of aorta and its branches:\n<ul>\n<li>Subclavian artery- leads to&nbsp;<strong>weak pulses</strong> in the upper extremities. Hence it is also known as <strong>pulseless disease</strong></li>\n<li>Carotid arteries- leads to<strong>&nbsp;</strong>weak pulses, <strong>blindness, neurological deficits</strong></li>\n</ul>\n</li>\n<li>Distal aorta- leads to claudication of the legs</li>\n<li>Pulmonary artery- leads to&nbsp;<strong>pulmonary hypertension</strong></li>\n<li>Coronary arteries- leads to <strong>myocardial infarction</strong></li>\n<li>Renal arteries- leads to <strong>systemic hypertension</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young male presents to the emergency room with severe abdominal pain. The small bowel is found to have a small infarcted area which is surgically removed. Histopathological examination of the biopsy specimen is given below. Which of the following is the most likely cause of the small bowel infarction?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperplastic arteriosclerosis"
      },
      {
        "id": 2,
        "text": "Cystic medial degeneration"
      },
      {
        "id": 3,
        "text": "M\u00f6nckeberg\u2019s arteriosclerosis"
      },
      {
        "id": 4,
        "text": "Polyarteritis nodosa"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and the histopathological findings are suggestive of <strong>polyarteritis nodosa</strong> (PAN).</p>\n<p>PAN affects small or <strong>medium-sized muscular arteries</strong>. It typically affects young adults. The patient may present with <strong>rapidly accelerating hypertension</strong> due to <strong>renal artery involvement&nbsp;</strong>(most common) or <strong>abdominal pain</strong> and <strong>bloody stools</strong> caused by involvement of gastrointestinal vessels.</p>\n<p>Option A:&nbsp;<strong>Hyperplastic arteriosclerosis&nbsp;</strong>is a vascular pathology seen in&nbsp;<strong>severe hypertension</strong>.&nbsp;</p>\n<p>Option B: <strong>Cystic medial degeneration</strong> leads to dissecting aortic aneurysm.</p>\n<p>Option C: <strong>M&ouml;nckeberg&rsquo;s arteriosclerosis</strong> does not cause infarction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8c04a1dca1684dd6824330f59f983cd0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is characteristically spared in polyarteritis nodosa?",
    "choices": [
      {
        "id": 1,
        "text": "Coronary circulation"
      },
      {
        "id": 2,
        "text": "Gastro-intestinal circulation"
      },
      {
        "id": 3,
        "text": "Renal circulation"
      },
      {
        "id": 4,
        "text": "Pulmonary circulation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Polyarteritis nodosa</strong> (PAN) characteristically&nbsp;<strong>spares the pulmonary circulation.</strong></p>\n<p><strong>PAN</strong> is a systemic vasculitis of <strong>small or medium-sized muscular arteries</strong>. It typically involves the <strong>renal </strong>(most commonly involved) and<strong> visceral vessels</strong>. It has <strong>no&nbsp;association with ANCA</strong>, but about 30% of patients <strong>have chronic hepatitis-B</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old child was brought to the hospital with complaints of fever, rash and swelling of her hands and feet since past 5 days.  There is desquamative skin rash, oedema of hands and feet, erythema of palms and soles, oral erythema, and cervical lymphadenopathy. What is the likely condition?",
    "choices": [
      {
        "id": 1,
        "text": "Kawasaki disease"
      },
      {
        "id": 2,
        "text": "Measles"
      },
      {
        "id": 3,
        "text": "Scarlet fever"
      },
      {
        "id": 4,
        "text": "Henoch Schonlein Purpura"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Kawasaki</strong> <strong>disease</strong> or <strong>mucocutaneous</strong> <strong>lymph</strong> <strong>node</strong> <strong>syndrome</strong>.</p>\n<p>Kawasaki disease is an acute febrile illness associated with <strong>arteritis</strong> of <strong>medium to large-sized vessels.&nbsp;</strong>It is commonly seen in <strong>infants</strong> and <strong>children</strong> <strong>&lt;4 years</strong> of age.</p>\n<p>Clinical features include<strong>:</strong></p>\n<ul>\n<li>Fever</li>\n<li><strong>Conjunctival&nbsp;and oral erythema</strong></li>\n<li>Blistering, edema of hands and feet</li>\n<li>Erythema of palms and soles</li>\n<li><strong>Desquamative</strong> <strong>rash</strong></li>\n<li><strong>Cervical lymphadenopathy</strong></li>\n</ul>\n<p>The disease is usually <strong>self-limiting</strong>. In some cases, the disease may involve coronary artery leading to <strong>thrombosis</strong> and <strong>acute</strong> <strong>myocardial</strong> <strong>infarction</strong>. <strong>Intravenous</strong> <strong>immunoglobulin</strong> and <strong>aspirin</strong> may be given to reduce the risk of coronary artery disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antibodies is associated with vasculitis seen in patients with Kawasaki disease?",
    "choices": [
      {
        "id": 1,
        "text": "Immune complex deposition"
      },
      {
        "id": 2,
        "text": "Antineutrophil cytoplasmic antibodies"
      },
      {
        "id": 3,
        "text": "Antiendothelial cell antibodies"
      },
      {
        "id": 4,
        "text": "Autoreactive T cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Antibodies to endothelial cells</strong> are associated with vasculitis in Kawasaki disease.</p>\n<p>Option A: Immune complex deposition is characteristic of vasculitis due to systemic immunologic disorders such as SLE.&nbsp;</p>\n<p>Option B: ANCA-associated vasculitis is seen in microscopic polyangiitis, Churg&ndash;Strauss syndrome, and granulomatosis with polyangiitis.</p>\n<p>Option D: Autoreactive T cells are seen in giant cell arteritis.</p>\n<p>Reports have been described in children with a multisystem inflammatory condition (MIS-C) linked to COVID-19 infection with some features similar to Kawasaki disease and toxic shock syndrome. Although shock is rarely associated with Kawasaki disease, many children with the inflammatory syndrome related to COVID show signs of shock.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is known as mucocutaneous lymph node syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Behcet disease"
      },
      {
        "id": 2,
        "text": "Kawasaki disease"
      },
      {
        "id": 3,
        "text": "Espundia"
      },
      {
        "id": 4,
        "text": "Tubercular lymphadenitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Kawasaki disease</strong> is also known as <strong>mucocutaneous lymph node syndrome.</strong></p>\n<p><strong>Kawasaki disease </strong>is an acute febrile illness occurring in children aged 4 years or younger. It is usually self- limiting. This vasculitis affects large to medium-sized vessels and even small vessels.&nbsp;</p>\n<p>It is also known as <strong>mucocutaneous lymph node syndrome</strong> because it can present with non-purulent <strong>conjunctivitis</strong>,&nbsp;<strong>oral erythema</strong>, edema of the hands and feet, desquamative rash, and cervical lymph node enlargement<strong>.</strong></p>\n<p>It has a&nbsp;<strong>predilection for coronary artery involvement</strong>&nbsp;and is the leading cause of acquired heart disease in children. Untreated patients may develop<strong> coronary artery ectasia or aneurysms</strong>, leading to rupture or thrombosis, myocardial infarction, and sudden death.</p>\n<p>Espundia is the muco-cutaneous variant of Leishmaniasis</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-yr-old woman, presented to OPD with complaints of joint pain and photosensitivity. On examination, you see a butterfly rash on the face and petechial hemorrhages on the lower limbs. On serology ANA, turns out to be positive. Which of the following is the most likely cause of vasculitis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Autoreactive T cells"
      },
      {
        "id": 2,
        "text": "Antiendothelial cell antibodies"
      },
      {
        "id": 3,
        "text": "Antineutrophil cytoplasmic antibodies"
      },
      {
        "id": 4,
        "text": "Immune complex deposition"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>systemic lupus erythematosus.&nbsp;</strong>The vasculitis occurring in a patient with systemic lupus erythematosus is due to <strong>immune complex deposition.</strong></p>\n<p><strong>Vasculitis&nbsp;</strong>is the <strong>inflammation of the vessel wall</strong>.&nbsp;The various mechanisms that cause vasculitis are:</p>\n<ul>\n<li><strong><strong>Immune-mediated inflammation-&nbsp;</strong></strong>Vasculitis caused by immune-mediated inflammation may occur due to the following factors:\n<ul>\n<li><strong>Immune complex deposition</strong>: Seen in systemic immunological disorders like <strong>systemic lupus erythematosus</strong> (SLE)</li>\n<li>Antineutrophil cytoplasmic antibodies (ANCA): Seen in Wegener's granulomatosis, Churg&ndash;Strauss disease, etc</li>\n<li>Anti endothelial cell antibodies:&nbsp;Implicated in Kawasaki disease</li>\n<li>Autoreactive T cells</li>\n</ul>\n</li>\n<li><strong>Infectious pathogens</strong>- by direct invasion, generating immune complexes or triggering cross-reactivity.</li>\n<li><strong>Physical or chemical injury</strong>- from irradiation, trauma, toxins, etc.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 43 year-old-male patient came to the clinic with complaints of occasional hematuria and recurrent upper respiratory tract infections. Examination revealed tiny petechial hemorrhages over his lower limbs. The patient tests positive for the anti-proteinase-3 antibody. Which of the following is true about this major antibody?",
    "choices": [
      {
        "id": 1,
        "text": "It is also known as p-ANCA"
      },
      {
        "id": 2,
        "text": "It is induced by propylthiouracil"
      },
      {
        "id": 3,
        "text": "It is triggered by infections"
      },
      {
        "id": 4,
        "text": "It shows perinuclear staining on immunofluorescence"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Anti-proteinase-3/PR3-ANCA / c-ANCA is <strong>triggered by certain infections</strong> as proteinase 3 shares similarities with many microbial peptides. This is the major antibody responsible for Granulomatosis with Polyangiitis (GPA).<strong>&nbsp;</strong></p>\n<p><strong>Antineutrophil cytoplasmic&nbsp;antibodies (ANCA)</strong>&nbsp;are a heterogeneous group of&nbsp;autoantibodies directed against the constituents of neutrophils or monocytes. Many patients with vasculitis have circulating antibodies that react with&nbsp;neutrophil cytoplasmic antigens.</p>\n<p>The two most important ANCAs related to vasculitis are:&nbsp;</p>\n<ul>\n<li><strong>Anti-proteinase-3</strong>/PR3-ANCA/c-ANCA - Directed against PR3 which is a neutrophil azurophilic granule constituent.</li>\n<li><strong>Anti-myeloperoxidase</strong>/MPO-ANCA/p-ANCA&nbsp;<em>-</em>&nbsp;Directed against MPO which is a lysosomal granule constituent involved in oxygen free-radical generation. MPO-ANCAs are induced by several therapeutic agents, particularly <strong>propylthiouracil</strong>.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a pauci-immune rapidly progressive glomerulonephritis?",
    "choices": [
      {
        "id": 1,
        "text": "Lupus nephritis"
      },
      {
        "id": 2,
        "text": "Microscopic polyangiitis"
      },
      {
        "id": 3,
        "text": "IgA nephropathy"
      },
      {
        "id": 4,
        "text": "Goodpasture syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Type III or pauci-immune-type</strong> of rapidly progressive glomerulonephritis (RPGN) may be a component of systemic vasculitis such as Wegener granulomatosis or <strong>microscopic polyangiitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about microscopic polyangiitis is not true?",
    "choices": [
      {
        "id": 1,
        "text": "It affects capillaries, small arterioles, and venules"
      },
      {
        "id": 2,
        "text": "MPO-ANCA positivity is seen"
      },
      {
        "id": 3,
        "text": "It is also known as leukocytoclastic vasculitis"
      },
      {
        "id": 4,
        "text": "Lesions of different stages of activity coexist in the same vessel"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All lesions of <strong>microscopic polyangiitis</strong> tend to be of the <strong>same age</strong> in any given patient, unlike <strong>polyarteritis nodosa</strong> where all stages of activity from early to late may coexist in different vessels or even within the same vessel.</p>\n<p><strong>Microscopic polyangiitis</strong> is a necrotizing vasculitis that <strong>affects capillaries, small arterioles, and venules.&nbsp;</strong>It is associated with <strong>MPO-ANCA.&nbsp;</strong>It is also called leukocytoclastic vasculitis because of apoptotic neutrophils.</p>\n<p>It may involve the skin, mucous membranes, lungs, brain, heart, gastrointestinal tract, kidneys, and muscle. Therefore, the patient may present with hemoptysis, hematuria, proteinuria, bowel pain or bleeding, muscle pain or weakness, and palpable cutaneous purpura.&nbsp;<strong>Necrotizing glomerulonephritis </strong>(90% of patients) and <strong>pulmonary capillaritis </strong>are particularly common.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old boy, who is a known case of asthma, presents with wheezing and rhinitis. Laboratory results show peripheral eosinophilia and antibodies against neutrophil myeloperoxidase. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Churg-Strauss syndrome"
      },
      {
        "id": 2,
        "text": "Granulotomatosis with polyangiitis"
      },
      {
        "id": 3,
        "text": "Good pasteur syndrome"
      },
      {
        "id": 4,
        "text": "Wegener granulomatosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the lab findings are suggestive of <strong>Churg&ndash;Strauss syndrome.</strong></p>\n<p><strong>Churg-Strauss Syndrome / Allergic granulomatosis and angiitis</strong> is a&nbsp;small-vessel necrotizing vasculitis classically associated with:</p>\n<ul>\n<li><strong>asthma</strong></li>\n<li><strong>allergic rhinitis</strong></li>\n<li>asymmetric mono neuritis multiplex</li>\n<li>lung infiltrates</li>\n<li>peripheral <strong>hypereosinophilia</strong></li>\n<li>extravascular necrotizing granulomata.</li>\n</ul>\n<p>It is a multisystem disease with cutaneous involvement (palpable purpura), gastrointestinal tract bleeding, and renal disease. <strong>Eosinophilic infiltrates</strong> may also be seen in the myocardium giving rise to cardiomyopathy.</p>\n<p><strong>p- ANCA (MPO-ANCA)</strong>&nbsp;is positive in about 50% of cases. Histological features are similar to those observed in polyarteritis nodosa (PAN) or microscopic polyangiitis but characteristically accompanied by granulomas and eosinophils.</p>\n<p><strong>Eosinophilic vasculitis</strong> seen in Churg-Strauss syndrome:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73fbc0f713064072b3d1316c5c8d56c3x1280x853.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man presents with hematuria, intermittent hemoptysis and chronic sinusitis. His chest radiograph shows multiple opacities and cavities. Renal biopsy suggests focal necrotizing glomerulonephritis. Which of the following is not seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Necrotizing granulomas of the upper respiratory tract"
      },
      {
        "id": 2,
        "text": "Small to medium-sized vessel vasculitis"
      },
      {
        "id": 3,
        "text": "Associated predominantly with MPO- ANCA"
      },
      {
        "id": 4,
        "text": "Cresentic glomerulonephritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario suggests a diagnosis of&nbsp;<strong>Wegener's granulomatosis.</strong>&nbsp;It is <strong>associated </strong>with<strong> PR3- ANCA</strong> (and not MPO- ANCA) in about 95% of cases.</p>\n<p><strong>Granulomatosis with Polyangiitis/</strong><strong>Wegener granulomatosis</strong>&nbsp;is a <strong>necrotizing vasculitis</strong> characterized by a triad of necrotizing inflammation:</p>\n<ul>\n<li><strong>Necrotizing granulomas </strong>of the upper respiratory tract or the lung</li>\n<li><strong>Necrotizing or granulomatous vasculitis </strong>affecting small to medium-sized vessels, most prominently in the lungs</li>\n<li><strong>Focal necrotizing&nbsp;</strong>crescentic glomerulonephritis</li>\n</ul>\n<p><strong>Males</strong> are affected more often than females. The most common clinical features include<strong> persistent pneumonitis</strong> with bilateral nodular and <strong>cavitary</strong> infiltrates, <strong>chronic sinusitis</strong>, <strong>mucosal ulcerations of the nasopharyn</strong>x, and evidence of <strong>renal</strong> disease.</p>\n<p>Image: Chest radiograph showing pulmonary granulomatosis</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cc1d42f2db874b64b3298ac4c870b198x793x680.JPEG"
    ]
  },
  {
    "text": "A 15-year old boy comes to the clinic complaining about recurrent painful oral ulcers. He also experiences repeated episodes of eye redness and pain which subside with medication. On examination, ulcers are seen on his genitals. Which of the following features would you not expect to see in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Dural sinus thrombosis"
      },
      {
        "id": 2,
        "text": "Pulmonary aneurysms"
      },
      {
        "id": 3,
        "text": "Nailfold capillary abnormalities"
      },
      {
        "id": 4,
        "text": "Uveitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of<strong> Beh&ccedil;et disease. </strong>Nail fold capillary abnormalities&nbsp;are typically seen in <strong>systemic sclerosis.</strong></p>\n<p>Behcet disease is a neutrophilic vasculitis affecting small- to medium-sized vessels that classically presents as a clinical <strong>triad </strong>of<strong>&nbsp;recurrent oral aphthous ulcers, genital ulcers, </strong>and <strong>uveitis</strong>.&nbsp;Other skin findings include <strong>erythema nodosa</strong> (red tender nodules on legs) and <strong>positive pathergy test</strong> (pustular reaction 24-48 hrs after sterile needle puncture or normal saline injection).</p>\n<p>There can also be gastrointestinal and pulmonary manifestations, with disease mortality related to severe neurologic involvement or rupture of vascular aneurysms. <strong>Dural sinus thrombosis</strong> is the most common CNS manifestation in children. <strong>Pulmonary aneurysms</strong> are the most severe feature of pediatric BD.</p>\n<p>It is associated with <strong>HLA subtype B51.&nbsp;</strong><strong>T helper 17 (Th17) </strong> cells play an important contribution in the recruitment of neutrophils, which will later infiltrate into the vessel wall.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child presents with colicky abdominal pain and purpuric skin lesions on the extensor surfaces of the arms and legs. Urine analysis reveals hematuria and mild proteinuria.\u00a0The most probable diagnosis is:",
    "choices": [
      {
        "id": 1,
        "text": "Henoch-Sch\u00f6nlein Purpura"
      },
      {
        "id": 2,
        "text": "Wegener\u2019s granulomatosis"
      },
      {
        "id": 3,
        "text": "Kawasaki\u2019s disease"
      },
      {
        "id": 4,
        "text": "Good pasteur syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features and the investigations are suggestive of <strong>Henoch-Schonlein purpura</strong>.</p>\n<p><strong>Henoch-Sch&ouml;nlein purpura</strong> is a systemic immune disorder, commonly seen in the age group of 3-8 years. The patient may present with the following clinical features:</p>\n<ul>\n<li class=\"p1\"><strong>Skin lesions</strong>- characteristically involve the <strong>extensor surfaces of arms and legs,</strong> and also the buttocks</li>\n<li class=\"p1\"><strong>Abdominal manifestations</strong>- include <strong>pain,</strong> vomiting, and intestinal bleeding.</li>\n<li class=\"p1\"><strong>Renal manifestations</strong>- include <strong>gross or microscopic hematuria</strong>, nephritic or nephrotic syndrome. Renal manifestations are more severe in the adults</li>\n</ul>\n<p class=\"p1\">It is strongly associated with atopy in a few patients, and the onset often follows an upper respiratory infection. IgA is deposited in the glomerular mesangium in a distribution similar to that of IgA nephropathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following structures are involved in Buerger's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Arteries only"
      },
      {
        "id": 2,
        "text": "Veins only"
      },
      {
        "id": 3,
        "text": "Arteries and veins"
      },
      {
        "id": 4,
        "text": "Arteries, nerves and veins"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Arteries, veins and nerves</strong> can be involved in <strong>thrombangiitis&nbsp;obliterans</strong> (Buerger's disease). It is a vasculitis of small and medium-sized arteries and secondarily extends into contiguous veins and nerves. With time, all three structures can be encased in fibrous tissue.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old male smoker presents with intermittent claudication and gangrene of the lower extremities. Biopsy of the blood vessels supplying this area shows acute and chronic inflammation, with luminal thrombosis containing small neutrophilic microabscesses. Granulomatous inflammation appears to extend into the contiguous veins and nerves. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Thrombangiitis obliterans"
      },
      {
        "id": 2,
        "text": "Churg-Strauss syndrome"
      },
      {
        "id": 3,
        "text": "Wegener's granulomatosis"
      },
      {
        "id": 4,
        "text": "Berger disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis is <strong>thromboangiitis obliterans / Buerger disease.</strong></p>\n<p>It<strong>&nbsp;</strong>is the segmental, thrombosing, acute and chronic inflammation of medium-sized and small arteries. It principally involves the<strong> tibial </strong>and<strong> radial arteries.</strong></p>\n<p>It is seen in&nbsp;<strong>heavy cigarette smokers, usually before the age of 35 years</strong>.&nbsp;<strong>HLA-A-9 and HLA-B-5</strong>&nbsp;associated with a high risk of TAO.</p>\n<p>The patients present with intermittent claudication, chronic ulcerations of the extremity, and later progress to frank gangrene. The microscopy findings include <strong>luminal thrombosis</strong> (thrombangiitis), that is, thrombus&nbsp;containing microabscesses that <strong>occlude the lumen </strong>(obliterans). They contain small microabscesses composed of neutrophils.</p>\n<p><strong>Berger disease</strong> refers to<strong> IgA nephropathy</strong>. It is seen within 3-5 days of sore throat. It is associated with purpuric rash in the lower limbs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following histologic findings would be most suggestive of Buerger\u2019s disease in a patient?",
    "choices": [
      {
        "id": 1,
        "text": "Mononuclear infiltrates with perivascular cuffing of the vasavasorum"
      },
      {
        "id": 2,
        "text": "Fragmentation of neutrophils"
      },
      {
        "id": 3,
        "text": "Thrombosis with microabscesses"
      },
      {
        "id": 4,
        "text": "Fibrinoid necrosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Luminal thrombosis</strong> containing <strong>small microabscesses </strong>composed of neutrophils is seen in thromboangiitis obliterans or<strong> Buerger disease</strong>.</p>\n<p>Option A: <strong>Adventitial mononuclear infiltrates </strong>with <strong>perivascular cuffing</strong> of the vasa vasorum has been described in <strong>Takayasu arteritis.</strong></p>\n<p>Option B: Fragmented neutrophils undergoing apoptosis infiltrating blood vessels termed <strong>leukocytoclastic vasculitis </strong>are seen in <strong>small vessel vasculitis.</strong></p>\n<p>Option D:&nbsp;<strong>Fibrinoid necrosis</strong>&nbsp;is seen in immune reactions involving blood vessels seen in <strong>immunologically mediated vasculitis syndromes.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '37 Vasculitis';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>