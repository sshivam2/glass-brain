<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paediatrics Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Test Series Subject / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A one-and-a-half-year-old child was brought to the hospital with a history of breathlessness, fever, cough, cold, and respiratory rate was 46/min. According to the WHO guidelines, which of the following, if present, is not considered a danger sign in this baby?",
    "choices": [
      {
        "id": 1,
        "text": "Convulsions"
      },
      {
        "id": 2,
        "text": "Severe malnutrition"
      },
      {
        "id": 3,
        "text": "Chest indrawing"
      },
      {
        "id": 4,
        "text": "Persistent vomiting"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>From the given clinical picture, it can be inferred that the child has <strong>pneumonia</strong>. <strong>Chest indrawing</strong> is&nbsp;not considered a danger sign in this baby.</p>\n<p>&nbsp;Danger signs of pneumonia in children are:&nbsp;</p>\n<ul>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"1\" aria-setsize=\"-1\" data-aria-posinset=\"1\" data-aria-level=\"1\">Not able to drink&nbsp;</li>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"1\" aria-setsize=\"-1\" data-aria-posinset=\"1\" data-aria-level=\"1\"><strong>Persistent vomiting&nbsp;</strong></li>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"1\" aria-setsize=\"-1\" data-aria-posinset=\"1\" data-aria-level=\"1\"><strong>Convulsions</strong>, lethargic or unconscious&nbsp;</li>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"1\" aria-setsize=\"-1\" data-aria-posinset=\"1\" data-aria-level=\"1\">Stridor in a calm child&nbsp;</li>\n<li data-leveltext=\"\uf0b7\" data-font=\"Symbol\" data-listid=\"1\" aria-setsize=\"-1\" data-aria-posinset=\"1\" data-aria-level=\"1\"><strong>Severe malnutrition&nbsp;</strong></li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">&nbsp;Pneumonia diagnosis is as given in the table below:</p>\n<table border=\"1\">\n<tbody>\n<tr>\n<td><strong>Age of child</strong></td>\n<td><strong>Fast breathing RR</strong></td>\n</tr>\n<tr>\n<td>&lt;2 months</td>\n<td>&nbsp;&gt;60 breaths/min</td>\n</tr>\n<tr>\n<td>2-12 months</td>\n<td>&nbsp;&gt;50 breaths/min</td>\n</tr>\n<tr>\n<td>1-5 years</td>\n<td>&nbsp;&gt;40 breaths/min</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;The revised classification of acute respiratory&nbsp;infections is simplified to include only two categories of pneumonia:</p>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li>pneumonia- with fast breathing and/or chest indrawing, which requires home therapy with oral amoxicillin.</li>\n<li>severe pneumonia- pneumonia with any general danger sign, which requires a referral and injectable therapy.</li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/402ec23059f642f1840119590a5d55fdx1280x711.PNG"
    ]
  },
  {
    "text": "A 7-year-old girl presented with ascending left-sided flank pain during micturition and recurrent episodes of urinary tract infections. The urologist suspects vesicoureteric reflux. Which of the following investigations can be done to confirm this condition?",
    "choices": [
      {
        "id": 1,
        "text": "DMSA scan"
      },
      {
        "id": 2,
        "text": "Ultrasound abdomen"
      },
      {
        "id": 3,
        "text": "Voiding cystourethrogram"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A <strong>voiding cystourethrogram (VCUG)\u00a0</strong>can be done to confirm\u00a0<strong>vesicoureteric reflux</strong>.</p>\n<p>Vesicoureteric reflux is the <strong>retrograde flow</strong> of urine from the bladder back to the ureter and kidney. The condition is usually <strong>congenital</strong> and familial. It is more commonly seen in <strong>females</strong> during evaluation for a <strong>urinary tract infection</strong>. It predisposes the child to<strong> pyelonephritis</strong> resulting in renal injury or scarring. This is known as <strong>reflux-related renal injury</strong> or <strong>reflux nephropathy</strong>.</p>\n<p>The international reflux study (IRS) classification divides it into grades I-V based on the severity as shown below. This is based on the appearance seen in <strong>contrast voiding cystourethrogram</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13a0b2172bf74ce9b99ac0d886096e00x1280x2420.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7266ca79063c478e93e72a3a6609416cx720x720.JPEG"
    ]
  },
  {
    "text": "You are a pathology resident who is looking at a slide, showing small round blue cells and Homer-Wright rosettes as shown below. The history you received from the pediatric surgery resident was that the specimen was resected from a 5-year-old child with ataxia. The tumor was present in the midline vermis. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medulloblastoma"
      },
      {
        "id": 2,
        "text": "Ependymoma"
      },
      {
        "id": 3,
        "text": "Pilocytic astrocytoma"
      },
      {
        "id": 4,
        "text": "Glioblastoma multiforme"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and slide are suggestive of&nbsp;<strong>Medulloblastoma.&nbsp;</strong></p>\n<p>Medulloblastoma is an embryonal CNS tumor, occurring predominantly in the <strong>cerebellar vermis</strong> that causes&nbsp;<strong>ataxia</strong>, poor balance, and dysmetria.&nbsp;It may cause obstructive hydrocephalus and often&nbsp;<strong>metastasizes extraneurally.</strong></p>\n<p>Histopathology shows<strong>&nbsp;</strong>a tumor composed of <strong>small, round, blue cells</strong> and is&nbsp;characterized by <strong>Homer&ndash;Wright rosettes</strong> and an immunopositivity for <strong>synaptophysin</strong>.&nbsp;</p>\n<p>Standard treatment for medulloblastomas is <strong>surgical resection</strong>, with adjuvant <strong>craniospinal radiotherapy</strong> for those over 3 years of age and <strong>chemotherapy</strong>. <br />Prognosis is strongly influenced by surgical resection, the presence of CSF metastases at the time of diagnosis, and the expression of the c-erbB-2 (HER2/neu) oncogene.</p>\n<p><strong>Note:&nbsp;</strong>Small, round, blue-cell tumors are malignant neoplasms that have a characteristic appearance under the microscope. It consists of sheets of small round cells that stain blue on routine hematoxylin and eosin (H&amp;E) staining.&nbsp;Examples are:</p>\n<ul>\n<li>Medulloblastoma</li>\n<li>Neuroblastoma</li>\n<li>Retinoblastoma</li>\n<li>Ewing&rsquo;s sarcoma</li>\n<li>Rhabdomyosarcoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2ef492955eb34bc19b48a13b49dddb4a.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "Which among the following disorders does not follow the classic mendelian inheritance?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, and 3"
      },
      {
        "id": 2,
        "text": "1 and 4"
      },
      {
        "id": 3,
        "text": "2 and 5"
      },
      {
        "id": 4,
        "text": "1, 3, and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Out of the given options, <strong>Angelman syndrome</strong> (1), <strong>Kearns-Sayre syndrome</strong> (3), and <strong>Prader-Willi syndrome</strong> (4) do not follow a <strong>classic Mendelian inheritance pattern</strong>.</p>\n<p>The non-mendelian inheritance pattern is used to describe <strong>mitochondrial inheritance</strong>, <strong>trinucleotide repeat disorders</strong>, and<strong>\u00a0genetic imprinting</strong>.</p>\n<p><strong>Angelman syndrome</strong> and<strong> Prader-Willi syndrome</strong> arise due to <strong>genetic imprinting</strong>. Here, the gene expression depends on the <strong>parental origin</strong> of the chromosome. It results due to an <strong>imbalance</strong> in the<strong> active copies</strong> of a specific gene. In Angelman syndrome, the <strong>maternal copy</strong> is affected while the <strong>paternal one</strong> is affected in Prader-Willi syndrome. Both the syndromes present with <strong>developmental delays</strong> and <strong>mental retardation</strong>.\u00a0</p>\n<p><strong>Kearns-Sayre syndrome is a mitochondrial disorder </strong>that results in lactic acidosis, pigmentary retinitis, and progressive external ophthalmoplegia.\u00a0</p>\n<p>The classic forms of genetic inheritances such as <strong>autosomal dominant, autosomal recessive, and X-linked inheritance</strong> are referred to as Mendelian inheritance forms.</p>\n<p><strong>Autosomal dominant</strong> inheritance is marked by the presence of <strong>one abnormal gene on one of the autosomes/ chromosomes</strong> 1-22. <strong>Autosomal recessive</strong> inheritance requires both copies of the same to be abnormal. If genes located on the X chromosome are affected, an<strong> X-linked pattern of inheritance</strong> with males being affected more commonly is seen.\u00a0</p>\n<p>Other Options:</p>\n<p>Option 2:<strong> Marfan's syndrome</strong> follows an <strong>autosomal dominant</strong> pattern of inheritance. Features include <strong>tall stature</strong>, <strong>arachnodactyly</strong>, lens subluxation, and aortic root dilatation.\u00a0</p>\n<p>Option 5<strong>: Duchenne muscular dystrophy</strong> is an <strong>X-linked recessive</strong> disorder that is characterized by the involvement of the proximal muscles of the lower limbs. <strong>Calf hypertrophy</strong> is a characteristic feature.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-day-old neonate presents with yellowish discolouration of skin and sclera. Which of the following may not be a cause of neonatal jaundice that appears after the first week of life?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital atresia of bile ducts"
      },
      {
        "id": 2,
        "text": "Breast milk jaundice"
      },
      {
        "id": 3,
        "text": "Erythroblastosis fetalis"
      },
      {
        "id": 4,
        "text": "Cystic fibrosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Erythroblastosis fetalis</strong>&nbsp;causes neonatal jaundice and&nbsp;manifests within the <strong>first 24 hours of life,</strong> not after 1st week.</p>\n<p>Jaundice in the first 24 hours of life requires<strong> immediate attention</strong> and can be due to erythroblastosis fetalis, concealed hemorrhage, sepsis, or congenital infections, including syphilis, cytomegalovirus, rubella, and toxoplasmosis. Jaundice appearing on the 2<sup>nd</sup> or 3<sup>rd</sup> day of life is usually physiologic but also can be due to early onset breastfeeding jaundice and Crigler-Najjar syndrome (familial non-hemolytic icterus). Neonatal jaundice appearing after the 3<sup>rd</sup> day but within the 1<sup>st</sup> week of life can be due to bacterial sepsis, urinary tract infections or other infections like syphilis, etc.</p>\n<p>Neonatal jaundice appearing <strong>after the 1<sup>st</sup> week of life</strong> can be due a number of conditions like <strong>breast milk jaundice</strong>, <strong>congenital atresia</strong> or paucity of bile ducts, hepatitis, <strong>cystic fibrosis</strong>, hemolytic anemia, enzyme deficiencies etc.</p>\n<p><strong>Physiological jaundice/Icterus neonatorum</strong> is due to&nbsp;increased bilirubin production&nbsp;from the&nbsp;breakdown&nbsp;of&nbsp;fetal red&nbsp;blood cells&nbsp;combined with transient&nbsp;limitation in the conjugation of bilirubin&nbsp;by the immature&nbsp;neonatal liver. <strong>Continuation of breastfeeding</strong> exclusively resolves most of the cases.</p>\n<p>The image below is of a schematic to approach to the diagnosis of neonatal jaundice:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0be12a483f1d40838d5152d04220b208x1280x2324.JPEG"
    ]
  },
  {
    "text": "During your neonatal rotation, a final year student asks you to explain the score which evaluates the baby at 1 minute and 5 minutes after birth. Which among the following is an incorrect statement regarding it?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, and 5"
      },
      {
        "id": 2,
        "text": "2 and  5"
      },
      {
        "id": 3,
        "text": "1, 3, and 4"
      },
      {
        "id": 4,
        "text": "3 and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The score which evaluates the baby at 1 minute and 5 minutes after birth is the <strong>APGAR score</strong>, and statements 3 and 4 are incorrect.</p>\n<p>The Apgar score is a method of systematically evaluating newborn infants immediately after birth. It measures <strong>appearance, pulse, grimace, activity,&nbsp;</strong>and&nbsp;<strong>respiration</strong>.&nbsp;It is performed at <strong>1 minute</strong> and again at<strong> 5 minutes</strong> after birth.</p>\n<p>Statements 3 and 4 are incorrect because <strong>0</strong>&nbsp;points are assigned if the <strong>pulse</strong> is <strong>absent</strong>, and&nbsp;<strong>respiratory rate</strong> is <strong>not used</strong> in calculating the&nbsp;APGAR score, but the <strong>respiratory effort</strong> is considered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f11e60e8090a4b9c814908343fc017eax1279x1330.JPEG"
    ]
  },
  {
    "text": "A 3-year-old boy last vaccinated at 12 weeks of life presents to you with a high-grade fever, cough, and a rash. The parents say that the rash shown below started from the forehead and behind the ears, and then it spread to the neck and body. Which of the following is true regarding this child's condition?",
    "choices": [
      {
        "id": 1,
        "text": "3,4, and 5"
      },
      {
        "id": 2,
        "text": "1 and 2"
      },
      {
        "id": 3,
        "text": "1, 3 and 4"
      },
      {
        "id": 4,
        "text": "1, 2, and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario with the symptoms, <strong>incomplete vaccination history</strong>, and regional distribution of the red maculopapular<strong> rash</strong> is suggestive of\u00a0<strong>measles</strong>.\u00a0<strong>Options 1</strong>,<strong>2</strong> and<strong> 5</strong> are correct regarding this condition.</p>\n<p>Measles is caused by a <strong>single-stranded</strong>, <strong>lipid-enveloped RNA paramyxovirus</strong>. Contact with large droplets or small-droplet aerosols is the route of transmission. Infection results in respiratory tract epithelial necrosis and lymphocytic infiltration. Clinical features include <strong>high fever</strong>, <strong>cough</strong>, coryza, and a rash.</p>\n<p><strong>Koplik spots</strong> appear 1-4 days before the onset of the rash. They appear as discrete red lesions with bluish-white spots at the level of the <strong>premolars</strong>. It can also involve the lips and gingiva. This is followed by the appearance of the rash that <strong>starts</strong> on the <strong>forehead</strong>, neck, and <strong>behind the ears</strong>. It then spreads to involve the torso and extremities. The image below shows Koplik's spots.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/278655fb5a1c468693482ad351546156.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db284b1d4ea64e4281e3195b5fefbd89x490x338.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/68a00c63446442a89c9e16e40a7f7ec5x527x644.JPEG"
    ]
  },
  {
    "text": "On ultrasound, a fetus was found to have intrauterine growth restriction, with the head circumference relatively preserved compared to length and weight. This type of growth restriction would have occurred due to all of the following causes except",
    "choices": [
      {
        "id": 1,
        "text": "Pregnancy-induced hypertension"
      },
      {
        "id": 2,
        "text": "Placental insufficiency"
      },
      {
        "id": 3,
        "text": "Poor maternal nutrition"
      },
      {
        "id": 4,
        "text": "TORCH infections"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario is suggestive of\u00a0<strong>asymmetric</strong> intrauterine growth restriction (IUGR), which would have been caused by all the above conditions except <strong>TORCH infections</strong>, which cause symmetric IUGR.</p>\n<div class=\"page\" title=\"Page 1335\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Intrauterine growth restriction (IUGR) refers to a deficiency of fetal growth and an abnormal fetal growth trajectory. It is often classified as\u00a0</p>\n</div>\n</div>\n</div>\n<p><strong>Symmetric</strong> <strong>IUGR</strong>:</p>\n<ul>\n<li>Insult on fetal growth occurs <strong>early.</strong></li>\n<li>As a result, head circumference, length, and weight are equally affected.</li>\n<li>It can be due to genetic causes, chromosomal disorders, or <strong>TORCH</strong> infections in the fetus.</li>\n</ul>\n<p><strong>Asymmetric IUGR </strong></p>\n<ul>\n<li>Insult occurs in <strong>late</strong> gestation, producing a\u00a0relative<strong>\u00a0</strong><strong>brain-sparing effect</strong>.</li>\n<li>The <strong>Head circumference</strong> is relatively <strong>preserved</strong> compared to weight and length.</li>\n<li>It is caused by <strong>placental insufficiency</strong>, <strong>pregnancy-induced hypertension</strong>(PIH), <strong>poor maternal nutrition</strong>, or maternal medical diseases (option A,B and C)</li>\n</ul>\n<p>Severe maternal hypertension causes symmetric IUGR while late-onset maternal vascular disease(PIH, preeclampsia) causes asymmetric IUGR.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A teacher complains that a 7-year-old girl with falling grades is inattentive in class and has unresponsive episodes with staring. On hyperventilation, her symptoms increase and her EEG findings show a 3Hz spike and wave discharge. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Myoclonic seizures"
      },
      {
        "id": 2,
        "text": "Myoclonus"
      },
      {
        "id": 3,
        "text": "Typical Absence seizure"
      },
      {
        "id": 4,
        "text": "Juvenile myoclonic epilepsy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>The clinical vignette of a child who is </strong>inattentive in class and has <strong>unresponsive episodes</strong> with staring with EEG showing a <strong>3Hz spike and wave</strong> discharge<strong> </strong>is suggestive of <strong>typical absence seizures</strong>.</p>\n<p><strong>Absence seizure</strong>s are a form of <strong>generalized seizures</strong> marked by <strong>unresponsiveness</strong>, <strong>staring</strong>, and eye flutter which usually last for a few seconds.\u00a0<strong>GABA<sub>B</sub>\u00a0receptors, T-type Ca<sup>2+</sup>\u00a0channels</strong>, and\u00a0<strong>K<sup>+</sup>\u00a0channels</strong>\u00a0situated within the <strong>thalamus\u00a0</strong>are involved in the pathophysiology of absence seizures.</p>\n<p>It is of two types:</p>\n<ul>\n<li>Typical absence seizures\u00a0\u00a0</li>\n<li>Atypical absence seizures\u00a0\u00a0</li>\n</ul>\n<p>Typical absence seizures are associated with <strong>3-Hz spikes</strong> and <strong>slow wave discharges</strong> on EEG. It usually starts by the age of <strong>5-8 years</strong> and can occur up to a <strong>hundred times</strong> per day.<strong> Hyperventilation</strong> can precipitate seizures and EEG changes. They last only for a <strong>few seconds</strong> and do not have an aura. It can be accompanied by eyelid flutter or upward rolling of the eyes. <strong>Simple automatisms</strong> such as lip smacking or picking at clothing can also be seen. There is <strong>no postictal period</strong> and the child usually <strong>resumes whatever activity</strong> he/she was engaged in prior to the episode.\u00a0</p>\n<p><strong>Atypical absence seizures</strong>\u00a0are associated with <strong>1-2-Hz spike-and-slow-wave discharges</strong>. Head atonia and <strong>myoclonus</strong> can also be seen during the seizures. It is precipitated by <strong>drowsiness</strong> and is generally more difficult to treat.\u00a0</p>\n<p><strong>Juvenile absence seizures</strong> occur at a later stage and are similar to typical absences. It is marked by 4-to-6 Hz spike-and-slow-wave and polyspike-and-slow-wave discharges. It is associated with juvenile myoclonic epilepsy.</p>\n<p><strong>EEG\u00a0</strong>is the<strong> diagnostic test </strong>for\u00a0absence seizures. An <strong>MRI</strong> would appear normal and so is not useful.\u00a0<strong>Ethosuximide</strong> is the drug of choice for typical absence seizures. Its mechanism of action is the\u00a0<strong>inhibition\u00a0</strong>of<strong>\u00a0T-type calcium channels</strong>.\u00a0<strong>Phenytoin, carbamazepine</strong>, and\u00a0<strong>oxcarbazepine</strong>\u00a0have all been associated with\u00a0<strong>aggravation </strong>of<strong> absence seizures</strong>\u00a0and even\u00a0<strong>absence status epilepticus</strong>\u00a0in children with absence epilepsy.</p>\n<p>The<strong>\u00a0</strong>following epilepsy syndromes are associated with the absence seizures:</p>\n<ul>\n<li><strong>Childhood absence epilepsy</strong></li>\n<li><strong>Juvenile absence epilepsy</strong></li>\n<li><strong>Juvenile myoclonic epilepsy</strong></li>\n<li><strong>Myoclonic absence epilepsy</strong></li>\n<li><strong>Lennox-gestaut syndrome</strong></li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Myoclonic seizures</strong> can be focal, multifocal, or generalized. It is marked by the <strong>rapidity</strong> of jerks (&lt;50 mseconds). EEG changes depend on the type of myoclonic seizure.</p>\n<p>Option B: <strong>Myoclonus</strong> is very brief, abrupt, and involuntary jerky contractions of a single muscle or muscle group. Some causes of myoclonus in children include hiccups (physiologic), <strong>meningitis</strong>, and<strong> electrolyte disturbances</strong>.\u00a0\u00a0</p>\n<p>Option D: <strong>Juvenile myoclonic epilepsy</strong> also known as <strong>Janz syndrome</strong> is a type of generalized epilepsy seen in young adults. It presents as myoclonic jerks in the morning and generalized tonic-clonic or clonic-tonic-clonic seizures upon awakening. <strong>Sleep deprivation</strong> and photic stimulation can precipitate the episodes. <strong>4-5 Hz polyspike-and-slow-wave discharges</strong> can be seen on EEG.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2cb252e3b2c346fb9494a53e552403ff.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "An anxious mother is worried about feeding her baby. The baby was born at 29 weeks of gestation with a birth weight of 2 kg. What will you advise as a routine primary feeding method for this baby?",
    "choices": [
      {
        "id": 1,
        "text": "Intravenous fluids"
      },
      {
        "id": 2,
        "text": "Nasogastric tube feeding"
      },
      {
        "id": 3,
        "text": "Paladai feeding"
      },
      {
        "id": 4,
        "text": "Breastfeeding"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given clinical scenario of a baby born at<strong> 29 weeks of gestation </strong>and <strong>2 kg birth weight, nasogastric tube feeding</strong> can be advised as a <strong>routine\u00a0primary feeding</strong> method.</p>\n<p>The feeding of neonates depends on their gestational age and it depends on the level of maturity of the neonate. In this scenario, as the baby is <strong>2 kg</strong> (low birth weight) and was born at\u00a0<strong>29 weeks </strong>of gestation,<strong>\u00a0</strong>nasogastric tube feeding is preferred. Babies born <strong>before 32 weeks</strong> will not have the coordination between swallowing and breathing. So, <strong>paladai feeding</strong> can only be used <strong>occasionally.</strong> Babies born<strong> after 34 weeks</strong> will have a completely mature sucking pattern and <strong>breastfeeding</strong> is more preferred.</p>\n<p>Based on birth weight, babies can be classified into</p>\n<ul>\n<li>Low birth weight (LBW) - Birth weight &lt; 2.5kg</li>\n<li>Very low birth weight (VLBW)-\u00a0Birth weight &lt;1.5kg</li>\n<li>Extremely low birth weight (ELBW)-\u00a0Birth weight &lt;1kg</li>\n</ul>\n<p>All LBW infants, irrespective of their initial feeding method\u00a0should receive <strong>only breast milk</strong>. This can be given as<strong>\u00a0expressed breast milk</strong> (mothers' own milk) to those infants fed by paladai or gastric tube. An alternative is\u00a0<strong>human\u00a0</strong><strong>donor milk</strong>.\u00a0When there is a contraindication to breastfeeding or if the mother is sick, <strong>formula feeds</strong> can be given. <strong>Term formula</strong>\u00a0<strong>feed</strong> in babies with birth weight\u00a0<strong>&gt;1500 g</strong>\u00a0and\u00a0<strong>preterm formula</strong>\u00a0<strong>feed\u00a0</strong>in <strong>VLBW</strong> babies can be given.\u00a0All\u00a0<strong>hemodynamically stable LBW\u00a0</strong>babies should receive <strong>Kangaroo Mother Care (KMC).</strong></p>\n<p>LBW can result from <strong>preterm birth</strong> (born before 37 completed weeks) <strong>IUGR</strong>\u00a0(intrauterine growth restriction) or both. Prematurity and low birth weight are the leading causes of <strong>neonatal mortality</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother has brought her 6-month-old infant to a pediatrician for a regular checkup. She tells her baby's weight was approximately\u00a0double the birth weight at 5 months of age. The baby's weight would be approximately triple the birth weight by the age of:",
    "choices": [
      {
        "id": 1,
        "text": "1 year"
      },
      {
        "id": 2,
        "text": "10 months"
      },
      {
        "id": 3,
        "text": "1.5 years"
      },
      {
        "id": 4,
        "text": "3 years"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The baby's weight would be approximately <strong>triple</strong> the birth weight by the age of&nbsp;<strong>1 year</strong>.&nbsp;<strong>&nbsp;</strong></p>\n<p>Infant weight approximately <strong>doubles</strong>&nbsp;by the age of 5 months, <strong>triples</strong>&nbsp;by 1 year, and is&nbsp;<strong>4 times</strong>&nbsp;by 2 years of age. Infants may lose up to 10% of their birth weight in the 1<sup>st</sup> week of life as a result of excretion of excess extravascular fluid and limited nutritional intake. They regain their birth weight by their 2<sup>nd</sup> week and thereafter gain weight at specific rates at specific age groups.</p>\n<p>The growth and development of a child between the age of&nbsp;<strong>6-12 months</strong><strong>&nbsp;</strong>can be classified as:</p>\n<ul>\n<li class=\"p1\"><strong><strong>Physical Development:&nbsp;&nbsp;</strong></strong>By 12 months of age, birth weight has tripled, length has increased by 50%, and head circumference has increased by 10 cm. A mature pincer grasp occurs and tooth eruption has started to occur. Motor achievements correlate with increasing myelinization and cerebellar growth.</li>\n<li class=\"p1\"><strong>Cognitive Development:&nbsp;</strong>Object permanence appears by 9 months of age. The baby tries to search for a hidden object.</li>\n<li class=\"p1\"><strong><strong>Emotional Development:&nbsp;</strong></strong>Infants may cling or cry anxiously when a stranger approaches, demonstrating stranger anxiety. Separation anxiety can also seen.</li>\n<li class=\"p1\"><strong><strong>Linguistic Development:&nbsp;</strong></strong>Between 8 and 10 months of age, infants produce multisyllabic sounds (&ldquo;ba-da-ma&rdquo;) called<strong> canonical babbling</strong>. Babies can discriminate between languages.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-month-old infant who was born at term was presented with complaints of lethargy and poor feeding. On examination, the infant had a puffy face, enlarged fontanelles, and protruding tongue, as shown below. The lower limb x-ray revealed an absence of distal femoral and proximal tibial epiphysis. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Down's syndrome"
      },
      {
        "id": 2,
        "text": "Congenital rickets"
      },
      {
        "id": 3,
        "text": "Congenital hypothyroidism"
      },
      {
        "id": 4,
        "text": "Hurler's syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the image are suggestive of\u00a0<strong>congenital hypothyroidism</strong>.</p>\n<p>The clinical features of congenital hypothyroidism include a <strong>puffy face</strong>, <strong>enlarged fontanelles</strong>, <strong>protruding tongue</strong>, prolonged <strong>jaundice</strong>,<strong> lethargy</strong>, and a <strong>history of poor feeding</strong>. The <strong>absence</strong> of <strong>distal femoral and proximal tibial epiphyses</strong> denotes the <strong>onset</strong> of congenital hypothyroidism. These epiphyses are normally present at birth.</p>\n<p><strong>Congenital hypothyroidism</strong>\u00a0is the most common <strong>preventable</strong> cause of <strong>intellectual disability</strong>. Thyroid<strong> dysgenesis</strong>\u00a0is the\u00a0<strong>most common cause of </strong>congenital hypothyroidism\u00a0in India accounting for about 75% of all cases.</p>\n<p>Congenital hypothyroidism is mostly <strong>asymptomatic at birth</strong> and is detected mainly by the\u00a0<strong>neonatal screening</strong> of <strong>TSH levels</strong> in the first few weeks of life. Clinical features present <strong>after maternal thyroxine wanes</strong>.</p>\n<p>Screening is usually done on\u00a0<strong>day 2-day 4 postnatally,</strong>\u00a0and usually,\u00a0<strong>dried blood samples </strong>are used\u00a0for this. The most commonly used strategy is screening for<strong> TSH</strong> first, as they have\u00a0<strong>higher sensitivity</strong>\u00a0compared to the T4-based screening.</p>\n<p>In untreated hypothyroidism, as the child grows older, there is a discrepancy between chronological age and osseous development. <strong>Epiphyseal dysgenesis</strong> wherein there are multiple foci of ossification in the epiphyses, is common. X-rays of the skull reveal <strong>large</strong> <strong>fontanelles</strong>, wide sutures, and <strong>intersutural (wormian) bones</strong>.\u00a0Radiotracer uptake study with radioactive iodine or technetium should be done as soon as primary congenital hypothyroidism is diagnosed.</p>\n<p>Treatment with levothyroxine should be started <strong>within 2 weeks</strong> in order to maintain normal cognitive and physical development.\u00a0<strong>Thyroxine</strong>\u00a0of dose\u00a0<strong>10-15\u00a0\u03bcg/kg/day</strong>\u00a0should be started and adjusted to achieve the normal free T4 range. TSH may be elevated up to 2 years of age with a reset of the hypothalamic-pituitary axis.\u00a0</p>\n<p>Other options:</p>\n<p>Option A- Down\u2019s syndrome also presents with developmental delay and hypothyroidism. They have characteristic facial features such as a <strong>flat face, depressed nasal bridge, upslanting palpebral fissures</strong>, and a <strong>single palmar crease</strong>. The image shown below depicts an infant with Down's syndrome. Radiological features include<strong> atlantoaxial dislocation.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1a71695aeb345a086774cb4048b3280.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/41510456878a485eb25d34bf8f3f2c94x1280x1291.JPEG"
    ]
  },
  {
    "text": "Match the following radiographs to the corresponding conditions.",
    "choices": [
      {
        "id": 1,
        "text": "1-C, 2-D, 3-A, 4-B"
      },
      {
        "id": 2,
        "text": "1-B, 2-A, 3-D, 4-C"
      },
      {
        "id": 3,
        "text": "1-A, 2-C, 3-B, 4-D"
      },
      {
        "id": 4,
        "text": "1-C, 2-B, 3-A, 4-D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct match is\u00a0<strong>1-C, 2-D, 3-A, </strong>and<strong> 4-B</strong>.</p>\n<table style=\"border-collapse: collapse; width: 30.8398%; height: 89.5936px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 22.6768%; height: 22.3984px;\">Image 1\u00a0</td>\n<td style=\"width: 77.3232%; height: 22.3984px;\">C. Tetralogy of Fallot</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 22.6768%; height: 22.3984px;\">Image 2\u00a0</td>\n<td style=\"width: 77.3232%; height: 22.3984px;\">D. Transposition of great arteries</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 22.6768%; height: 22.3984px;\">Image 3</td>\n<td style=\"width: 77.3232%; height: 22.3984px;\">A. Ebstein's anomaly</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 22.6768%; height: 22.3984px;\">Image 4</td>\n<td style=\"width: 77.3232%; height: 22.3984px;\">B. TAPVC</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Tetralogy of Fallot (TOF) </strong>\u00a0is the most common cyanotic heart disease encountered beyond the age of 1 year. It is characterized by a tetrad of:</p>\n<ol>\n<li>Severe right ventricle outflow obstruction</li>\n<li>Large ventricular septal defect (VSD)</li>\n<li>Aorta overriding VSD</li>\n<li>Right ventricular hypertrophy</li>\n</ol>\n<p>In TOF, the hypertrophied right ventricle causes the rounded apical shadow to be uptilted so that it is situated higher above the diaphragm than normal. This on X-rays appears as a <strong>boot-shaped heart or Coeur en sabot</strong>.</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p><strong>Transposition of great arteries</strong> (TGA)\u00a0<span class=\"TextRun SCXW247863283\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW247863283\">is characterized by the\u00a0<strong>aorta arising\u00a0</strong>from the\u00a0<strong>right ventricle</strong>\u00a0and the\u00a0<strong>pulmonary artery\u00a0</strong>from the l<strong>eft ventricle</strong>. Because of this, the pulmonary and systemic circulations remain separate. </span></span><span class=\"TextRun SCXW247863283\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW247863283\">The cardiac silhouette usually has an <strong>egg-on-side</strong> appearance due to cardiomegaly and a narrow mediastinum. Normal to <strong>increased pulmonary blood flow</strong> is also seen.\u00a0</span></span></p>\n<p><strong>Ebstein anomaly</strong> is a rare cyanotic congenital heart disease characterized by the downward displacement of an <strong>abnormal tricuspid valve</strong> into the right ventricle. In some cases, there can be <strong>massive cardiomegaly resulting in a box-shaped heart</strong>.\u00a0</p>\n<p><strong>Total anomalous pulmonary venous return (TAPVC)</strong> occurs due to the anomalous connection of pulmonary veins instead of joining to the left atrium resulting in pulmonary venous blood reaching the right atrium. In <strong>supracardiac</strong> TAPVC the configuration of the heart and the superior mediastinal borders resemble a <strong>snowman</strong>. It is also referred to as the <strong>figure of 8 sign</strong>.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fa18a690c635459badc7becd920a26c0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old baby was examined in a village camp. The child had a poor appetite and visible peripheral edema. The hair was sparse and easily pluckable. The skin showed peeling as shown below.  What could be the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Marasmus"
      },
      {
        "id": 2,
        "text": "Pellagra"
      },
      {
        "id": 3,
        "text": "Vitamin A deficiency"
      },
      {
        "id": 4,
        "text": "Kwashiorkor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical vignette of a child with <strong>poor appetite</strong>, <strong>sparse easily pluckable hair,</strong> and the image showing <strong>flaky paint dermatosis</strong> are suggestive of <strong>Kwashiorkar.</strong></p>\n<p>Kwashiorkor results due to severe <strong>protein</strong> and essential amino acid deprivation along with <strong>adequate calorie intake</strong>. It is particularly seen in children at the time of weaning, to a diet consisting majorly of corn, rice, or beans.\u00a0</p>\n<p>The clinical features include a classic cutaneous finding of diffuse reddish-brown scaling dermatosis that has been likened to cracked skin,<strong> peeling paint</strong>, enamel paint, <strong>flaky paint</strong>, or crazy paving. This is due to the typical scaling and irregular fissuring.\u00a0Nails are thin and soft. Hairs are thin and sparse and display a <strong>flag sign</strong> consisting of alternative light and dark bands of hair. The consistent feature is\u00a0<strong>peripheral edema</strong> due to the associated <strong>hypoproteinaemia</strong>. Edema of the face results in <strong>moon facies</strong>.\u00a0<strong>Abdominal distention</strong> (pot belly)\u00a0is a feature and is due to hepatomegaly from increased fatty deposition due to a lack of available apolipoproteins.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Marasmus</strong> results due to global <strong>macro-nutrient deficiency</strong>, which leads to <strong>growth retardation</strong> with\u00a0<strong>&lt;60%</strong> of<strong> ideal body weight</strong>.<strong>\u00a0</strong>Loss of subcutaneous tissue, growth stunting, dyspigmentation, and desquamative changes are seen in these patients. Marasmus patients <strong>do not</strong> <strong>demonstrate hypoproteinaemia or edema</strong>. There is distension of the abdomen due to hypotonia of the abdominal musculature. These patients typically have <strong>wrinkled, loose, </strong>and <strong>dry skin</strong>. The hair and nails often grow slowly and may show brittleness. The hair falls out easily and often shows features of alopecia.</p>\n<p>Below is the image of a child with marasmus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/96e1202eca294f378a1480be47feea18.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b09297ea159a40e38d22343d30966901x241x354.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e09dff74d1d4b4398e83562a6b1f38fx412x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0c2428be3e54ae8ad914fcd9f045d4bx283x169.PNG"
    ]
  },
  {
    "text": "A 10-day-old female neonate with hypoxic-ischemic encephalopathy (HIE) is hyper-alert with normal EEG. Examination shows hyperactive tendon reflexes, mydriatic pupil, and clonus.  What stage of HIE is she in?",
    "choices": [
      {
        "id": 1,
        "text": "Stage 1"
      },
      {
        "id": 2,
        "text": "Stage 2"
      },
      {
        "id": 3,
        "text": "Stage 3"
      },
      {
        "id": 4,
        "text": "Stage 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>According to <strong>Sarnat staging</strong> of <strong>hypoxic-ischemic encephalopathy</strong> (HIE), a <strong>hyperalert</strong> neonate with <strong>mydriatic pupil</strong>, hyperactive tendon reflex, <strong>clonus</strong>, and <strong>normal EEG</strong> belongs to <strong>stage</strong> <strong>1</strong>.&nbsp;</p>\n<p>HIE is a brain injury that <strong>prevents adequate blood supply to the infant's brain</strong>.&nbsp;</p>\n<p>Sarnat staging of HIE:</p>\n<table style=\"width: 446px; height: 576px;\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Signs</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\"><strong>Stage 1</strong></td>\n<td style=\"text-align: center; width: 95.7188px;\"><strong>Stage 2</strong></td>\n<td style=\"text-align: center; width: 111.641px;\"><strong>&nbsp;Stage 3</strong></td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Level of consciousness</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\"><strong>Hyperalert</strong></td>\n<td style=\"text-align: center; width: 95.7188px;\">Lethargic</td>\n<td style=\"text-align: center; width: 111.641px;\">Stuporous, comatose</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Muscle tone</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">Normal</td>\n<td style=\"text-align: center; width: 95.7188px;\">Hypotonic</td>\n<td style=\"text-align: center; width: 111.641px;\">Flaccid</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Posture</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">Normal</td>\n<td style=\"text-align: center; width: 95.7188px;\">Flexion</td>\n<td style=\"text-align: center; width: 111.641px;\">Decerebrate</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Tendon reflex/clonus</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\"><strong>Hyperactive</strong></td>\n<td style=\"text-align: center; width: 95.7188px;\">Hyperactive</td>\n<td style=\"text-align: center; width: 111.641px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Myoclonus</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">Present</td>\n<td style=\"text-align: center; width: 95.7188px;\">Present</td>\n<td style=\"text-align: center; width: 111.641px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Moro reflex</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">Strong</td>\n<td style=\"text-align: center; width: 95.7188px;\">Weak</td>\n<td style=\"text-align: center; width: 111.641px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Pupils</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\"><strong>Mydriasis</strong></td>\n<td style=\"text-align: center; width: 95.7188px;\">Miosis</td>\n<td style=\"text-align: center; width: 111.641px;\">Unequal, poor light reflex</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Seizures</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">None</td>\n<td style=\"text-align: center; width: 95.7188px;\">Common</td>\n<td style=\"text-align: center; width: 111.641px;\">Decerebration</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>EEG findings</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\"><strong>Normal</strong></td>\n<td style=\"text-align: center; width: 95.7188px;\">Low voltage changing to seizure activity</td>\n<td style=\"text-align: center; width: 111.641px;\">\n<p>Burst suppression to isoelectric</p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Duration</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">&lt;24 hours if progress it; otherwise, can remain normal</td>\n<td style=\"text-align: center; width: 95.7188px;\">24 hours to 14 days</td>\n<td style=\"text-align: center; width: 111.641px;\">Days to weeks</td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 117.906px;\"><strong>Outcome</strong></td>\n<td style=\"text-align: center; width: 92.7344px;\">Good</td>\n<td style=\"text-align: center; width: 95.7188px;\">Variable</td>\n<td style=\"text-align: center; width: 111.641px;\">Death, severe deficits</td>\n</tr>\n</tbody>\n</table>\n<p>Maternal<strong>&nbsp;</strong>causes for HIE are&nbsp;hypoventilation during anesthesia, cyanotic heart disease, respiratory failure, or carbon monoxide poisoning. Failure of oxygenation due to severe anemia, massive blood loss, and intracranial or adrenal hemorrhages are fetal causes of HIE.&nbsp;</p>\n<p>Hypoxia and ischemia cause <strong>anaerobic metabolism</strong> that generates a large amount of <strong>lactate and inorganic phosphates&nbsp;</strong>accumulation of toxic byproducts and overactivation of receptors. This leads to increased cellular permeability to sodium and calcium ions, resulting in cytotoxic edema and neuronal death.&nbsp;The most sensitive imaging modality for detecting hypoxic brain injury in neonates is an <strong>MRI</strong>.</p>\n<p><strong>Therapeutic hypothermia</strong> within the first 6 hours of life reduces mortality and major neurodevelopmental impairment. <strong>High-dose erythropoietin</strong> is used as an adjuvant to therapeutic hypothermia. Antiepileptic medications like phenobarbital and levetiracetam can be used to treat seizures.&nbsp;</p>\n<p>&nbsp;<strong>Poor prognostic factors</strong> in HIE are:</p>\n<ul>\n<li>Initial blood ph less than 6.7</li>\n<li>Low (0-3) 10&nbsp; in Apgar score</li>\n<li>Delayed onset of spontaneous breathing</li>\n<li>Seizure onset in less than 12 hours</li>\n<li>Burst suppression pattern in EEG</li>\n<li>Basal ganglia or thalamic lesion</li>\n<li>Oliguria or anurias for more than 24 hours</li>\n<li>Decerebrate posture</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Arrange the following milestones in the order of their development.",
    "choices": [
      {
        "id": 1,
        "text": "3-1-2-4"
      },
      {
        "id": 2,
        "text": "1-2-3-4"
      },
      {
        "id": 3,
        "text": "4-3-2-1"
      },
      {
        "id": 4,
        "text": "3-4-1-2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct order of development of the<strong> milestones</strong> given is <strong>3</strong>-<strong>1</strong>-<strong>2</strong>-<strong>4</strong>.</p>\n<p>Development in a child is the maturation of functions and skills for optimal functioning of an individual. Developmental milestones are <strong>easily identifiable events</strong> that occur during the developmental process. It is assessed under the following <strong>domains</strong>.</p>\n<ul>\n<li>Gross motor</li>\n<li>Fine motor</li>\n<li>Personal and social development</li>\n<li>Language</li>\n</ul>\n<p>A baby will <strong>reach out</strong> for objects with <strong>both hands</strong>, also known as <strong>bidextrous reach</strong> by the age of <strong>4 months</strong>. It is a key <strong>fine motor milestone</strong>.\u00a0</p>\n<p>A child is able to sit with his <strong>arms forward</strong> for support, known as the <strong>tripod position</strong> at around <strong>6-7 months</strong>. The ability to sit <strong>without any support</strong> develops by 8 months. It is part of <strong>gross motor development</strong>.\u00a0</p>\n<p>By around <strong>9 months</strong>, the baby can <strong>wave bye-bye</strong>. He/she also repeats any activity that can get an appreciative response from the observers. It is a <strong>social</strong> and adaptive <strong>milestone</strong>.</p>\n<p>By the age of <strong>18 months</strong>, the baby has a vocabulary of <strong>8-10 words</strong>. By the age of <strong>2</strong>, increases to <strong>100 words\u00a0</strong>which can be joined to form <strong>simple sentences</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following metabolic derangements with their most likely presentations -",
    "choices": [
      {
        "id": 1,
        "text": "A-4, B-2, C-3, D-1"
      },
      {
        "id": 2,
        "text": "A-3, B-4, C-2, D-5"
      },
      {
        "id": 3,
        "text": "A-2, B-1, C-5, D-3"
      },
      {
        "id": 4,
        "text": "A-5, B-4, C-1, D-3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The correct match is&nbsp;</span><strong><span data-preserver-spaces=\"true\">A-3, B-4, C-2, and D-5.</span></strong></p>\n<p><span data-preserver-spaces=\"true\">A. <strong>Glucose-6-phosphatase</strong> deficiency is seen in <strong>Von Gierke disease</strong> which is a <strong>glycogen storage disorder (Type Ia).&nbsp;</strong></span><span data-preserver-spaces=\"true\">Patients with GSD Type I present with a protruding abdomen due to <strong>hepatomegaly</strong>, <strong>doll-like facies</strong>, <strong>hypoglycemia</strong>, lactic acidosis<strong>,</strong> hyperuricemia, organomegaly, <strong>seizures</strong>,&nbsp;and pulmonary hypertension.&nbsp;</span><span data-preserver-spaces=\"true\">It is an <strong>autosomal recessive disorder</strong>&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">B.&nbsp;<strong>Beta-galactosidase</strong> deficiency is seen in <strong>Krabbe's disease</strong> which is a lysosomal storage disorder.&nbsp;</span><span data-preserver-spaces=\"true\">It is an autosomal recessive disorder that results from the deficiency of galactocerebrosidase.&nbsp;</span><span data-preserver-spaces=\"true\">The classic manifestations that would suggest Krabbe's disease include <strong>irritability</strong>, seizures, and hypertonia.&nbsp;<strong>&nbsp;Optic atrophy</strong> and <strong>developmental delay</strong> are other features.</span></p>\n<p><span data-preserver-spaces=\"true\">C.&nbsp;<strong>Alpha-L-iduronidase</strong> deficiency is seen in <strong>Hurler syndrome,&nbsp;</strong></span><span data-preserver-spaces=\"true\">&nbsp;a type of mucopolysaccharidosis&nbsp;</span><span data-preserver-spaces=\"true\">type I.&nbsp; Infants develop characteristic coarse facial features, hepatosplenomegaly, <strong>inguinal hernias</strong>, and typical skeletal abnormalities, known as <strong>dysostosis multiplex</strong>. <strong>Corneal clouding</strong>, short stature, and <strong>copious nasal discharge</strong> are other features.</span></p>\n<p><span data-preserver-spaces=\"true\">D.&nbsp;<strong>Galactose-1-phosphate uridyl transferase </strong>deficiency&nbsp;is seen in classical <strong>galactosemia</strong>. C</span><span data-preserver-spaces=\"true\">linical features include jaundice, <strong>vomiting</strong>, <strong>hepatomegaly</strong>, and <strong>sepsis</strong>.&nbsp;They also tend to develop <strong>cataracts</strong>.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9-month-old boy presents with progressive pallor and abdominal distension. Red cell distribution width is normal.  The peripheral smear is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Megaloblastic anemia"
      },
      {
        "id": 2,
        "text": "Iron-deficiency anemia"
      },
      {
        "id": 3,
        "text": "Thalassemia"
      },
      {
        "id": 4,
        "text": "Pernicious anemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical history and peripheral blood smear showing\u00a0<strong>target cells</strong> and <strong>aniso-poikilocytosis</strong>, along with the<strong>\u00a0normal red cell distribution width(RDW)</strong><strong>,</strong>\u00a0are suggestive of<strong>\u00a0thalassemia</strong>.</p>\n<p>Thalassemia is a <strong>hemoglobinopathy</strong> that arises due to deficient synthesis of the <strong>globin chains</strong>. Depending on the chain affected, it is classified into\u00a0\u03b1-thalassemia and\u00a0\u03b2-thalassemia.</p>\n<p><strong>\u03b2-Thalassemia</strong> arises due to the deficient synthesis of\u00a0\u03b2-chains. Normal adult RBCs have HbA, along with HbA2 and fetal haemoglobin (HbF) in small amounts. There is a deficit in the synthesis of HbA with an <strong>elevation</strong> of <strong>HbA2</strong> and <strong>HbF</strong> levels in \u03b2-thalassemia.\u00a0</p>\n<p><strong>\u03b1-Thalassemia</strong> is caused by deficient synthesis of \u03b1-chains. It can also present as an \u03b1-thalassemia trait, with trivial hematologic abnormalities. Excess of \u03b2- and \u03b3-globin chains form <strong>Bart hemoglobin</strong> (\u03b34) in fetal life and <strong>HbH</strong> (\u03b24) after birth. Severe deficiency leads to\u00a0<strong>hydrops fetalis.</strong></p>\n<p><strong>Ineffective erythropoiesis</strong> leads to bone marrow hyperplasia and <strong>extramedullary hematopoiesis,</strong> which can involve the <strong>liver</strong>, <strong>spleen</strong>, and lymph nodes. In\u00a0\u03b2-thalassemia major, anemia manifests 6 to 9 months after birth. <strong>HbF</strong> levels are markedly <strong>elevated</strong>.\u00a0The presence of bony anomalies such as frontal bossing, prominent facial bones, and dental malocclusion is typical.</p>\n<p>The image below shows\u00a0<strong>thalassemic facies</strong>\u00a0(frontal bossing and maxillary hyperplasia) in a child with thalassemia major.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ca41cde67258471e99fc97e23a04b5e4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1a2fcda0c2c74489b0ad2ad11b3e416dx512x357.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1bc23b3eb6b74129b2c30c1686cefd70x474x474.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b4cdbc3e5514a3691f0d6635589a130x1200x900.JPEG"
    ]
  },
  {
    "text": "A junior radiologist performing a fetal doppler follows the direction of the flow of oxygenated blood from the placenta to the fetus to examine the fetal circulatory vessels. The sequence that he would follow is:",
    "choices": [
      {
        "id": 1,
        "text": "Umbilical artery \u2192 inferior vena cava \u2192 ductus venosus \u2192 right atrium \u2192 left atrium"
      },
      {
        "id": 2,
        "text": "Umbilical artery \u2192 superior vena cava \u2192 right atrium \u2192 ductus arteriosus \u2192 left atrium"
      },
      {
        "id": 3,
        "text": "Umbilical vein \u2192 ductus venosus \u2192 inferior vena cava \u2192 right atrium \u2192 left atrium"
      },
      {
        "id": 4,
        "text": "Umbilical vein \u2192 ductus arteriosus \u2192 superior vena cava \u2192 right atrium \u2192 left atrium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The sequence of oxygenated blood flow from the placenta to the fetal heart is umbilical vein&nbsp;&rarr; ductus venosus &rarr; inferior venacava&nbsp;&rarr; right atrium&nbsp;&rarr; left atrium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child presented with sudden onset of high-grade fever, seizures,  and loss of consciousness. On examination, the child had anaemia, hypoglycemia, and no neurological deficits. What is the probable diagnosis",
    "choices": [
      {
        "id": 1,
        "text": "Tubercular meningitis"
      },
      {
        "id": 2,
        "text": "Viral meningitis"
      },
      {
        "id": 3,
        "text": "Cerebral malaria"
      },
      {
        "id": 4,
        "text": "Fungal meningitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">This scenario depicts a case of\u00a0<strong>cerebral malaria </strong>due to a severe complicated falciparum infection.</p>\n<p style=\"text-align: left;\">Severe complicated malaria is caused by<strong> <em>Plasmodium falciparum</em></strong> and is characterized by jaundice,\u00a0severe anaemia,\u00a0respiratory distress, bleeding manifestation, cardiovascular collapse, renal failure and cerebral malaria.</p>\n<p style=\"text-align: left;\"><strong>Cerebral malaria</strong> is diagnosed in the case of P. falciparum parasitemia with <strong>altered consciousness.</strong>\u00a0Common features include <strong>seizures</strong> and <strong>hypoglycemia</strong>. Retinal haemorrhages, neurological findings like hemiplegia, absent or exaggerated deep tendon reflexes, and a positive Babinski sign can also be seen.</p>\n<p style=\"text-align: left;\">All patients with severe malaria should be <strong>treated with intravenous or intramuscular artesunate</strong> for at least 24 hours.</p>\n<p style=\"text-align: left;\">Meningitis has fever accompanied by lethargy, irritability, signs of meningeal irritation like the <strong>Kernig sign-</strong>flexion of the hip 90 degrees with subsequent pain with extension of the leg, and <strong>Brudzinski sign-</strong>involuntary flexion of the knees and hips after passive flexion of the neck while supine.\u00a0Increased ICP is suggested by headache, emesis, bulging fontanel or widening of the sutures, oculomotor (anisocoria, ptosis) or abducens nerve paralysis, hypertension with bradycardia, apnea or hyperventilation, stupor, coma, or signs of herniation. A lumbar puncture is essential to obtain CSF for Gram stain and culture, which is the most important step in the diagnosis of meningitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Paediatrics Test';
        let hierarchy = ["Marrow", "FMGE Test Series Subject", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>