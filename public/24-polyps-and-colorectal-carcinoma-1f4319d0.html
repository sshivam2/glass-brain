<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24 Polyps And Colorectal Carcinoma - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">36</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 50-year-old woman underwent a screening colonoscopy. A single polyp is found, resected, and sent for histopathological examination. Which of the following biopsy findings will have the highest risk of malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Villous adenoma"
      },
      {
        "id": 2,
        "text": "Hyperplastic polyps"
      },
      {
        "id": 3,
        "text": "Inflammatory polyps"
      },
      {
        "id": 4,
        "text": "Tubular adenoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Villous adenoma</strong>&nbsp;has the highest risk of malignancy.</p>\n<p><strong>Adenomatous polyps</strong> can be tubular, tubulovillous, and villous adenomas. Among these, tubular adenoma has the least risk and villous adenoma has the highest risk of malignancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During a colonoscopy on a 58-year-old female patient, a smooth nodular polyp is found and excised. The microscopic image is given. Choose the incorrect statement regarding the polyp.",
    "choices": [
      {
        "id": 1,
        "text": "Most common type of polyp"
      },
      {
        "id": 2,
        "text": "More common in recto-sigmoid region"
      },
      {
        "id": 3,
        "text": "Usually seen in the 6th and 7th decade of life"
      },
      {
        "id": 4,
        "text": "Malignant transformation takes place within 5 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hyperplastic polyps</strong>, as seen in the histological picture, <strong>do not have malignant potential.&nbsp;</strong>&nbsp;</p>\n<p>Elongated crypts, i.e.,&nbsp;<strong>serrated (saw-toothed) </strong>or<strong> star-shaped appearance</strong>, is a characteristic feature of a<strong> hyperplastic polyp. </strong></p>\n<p>They are&nbsp;the <strong>most common type</strong> of colorectal polyps and are usually seen in the<strong> 6th and 7th </strong>decade of life. More than&nbsp;90% occur in <strong>rectosigmoid region.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7298758fc08342e8a1d0c6d8820f963a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The biopsy of a polyp reported dysplasia up to the colonic submucosa. Classify this lesion using Haggitt's classification:",
    "choices": [
      {
        "id": 1,
        "text": "Level 1"
      },
      {
        "id": 2,
        "text": "Level 2"
      },
      {
        "id": 3,
        "text": "Level 3"
      },
      {
        "id": 4,
        "text": "Level 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>According to <strong>Haggitt&rsquo;s classification,</strong>&nbsp;a polyp invading the submucosa comes under<strong> level 4.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old patient undergoes a screening colonoscopy after his brother was diagnosed with colorectal cancer. Which of the following, if detected, does not indicate a risk of developing colon cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Villous adenomas in the ascending colon"
      },
      {
        "id": 2,
        "text": "More than 100 polyps in the transverse and descending colon"
      },
      {
        "id": 3,
        "text": "Inflammatory polyps in the sigmoid colon and rectum"
      },
      {
        "id": 4,
        "text": "Sessile serrated adenomatous polyps in the sigmoid colon"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Inflammatory polyps</strong> are <strong>not premalignant.</strong></p>\n<p>Inflammatory polyps (pseudopolyps) are found in cases of:</p>\n<ul>\n<li>Inflammatory bowel disease (most common)</li>\n<li>Amebic colitis</li>\n<li>Ischemic colitis</li>\n<li>Schistosomal colitis</li>\n</ul>\n<p>Microscopic examination shows islands of normal, regenerating mucosa (the polyp) surrounded by areas of mucosal loss.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/243e3f3edfe849c182628fe9d7eac529x781x349.JPEG"
    ]
  },
  {
    "text": "A 12-year-old is brought to the emergency with features of intestinal obstruction. An ultrasound reveals a target sign, suggesting intussusception. On closer examination, her palm and oral mucosa are spotted with multiple 1-2 mm blue-gray macules. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Turcot syndrome"
      },
      {
        "id": 2,
        "text": "Lynch syndrome"
      },
      {
        "id": 3,
        "text": "Peutz\u2013Jegher\u2019s syndrome"
      },
      {
        "id": 4,
        "text": "Cowden syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient most likely has<strong> Peutz&ndash;Jeghers syndrome.</strong></p>\n<p>It is characterized by <strong>hamartomatous polyps </strong>of the<strong> intestinal tract </strong>(more commonly small intestine) and<strong> hyperpigmentation </strong>of the<strong> buccal mucosa, lips, and digits. </strong>In the given clinical scenario, the patient has had an intestinal intussusception. The numerous polyps in Peutz-Jeghers syndrome often serve as a lead point.</p>\n<p>Option A:<strong> Turcot syndrome</strong>&nbsp;constitutes <strong>colorectal polyps</strong> and brain tumors (including <strong>cerebellar medulloblastoma and glioblastomas</strong>)</p>\n<p>Option B<strong>: Lynch syndrome&nbsp;</strong>is also called<strong> hereditary nonpolyposis colon cancer (HNPCC)</strong>. It is due to defective <strong>mismatch repair (MMR) of DNA.</strong></p>\n<p>Option D<strong>: Cowden syndrome</strong> is characterized by <strong>polyps of the stomach or colon, </strong>macrocephaly and<strong> benign tumors </strong>of&nbsp;<strong>thyroid,&nbsp;</strong><strong>breast</strong>, and&nbsp;<strong>uterus.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e9724fd52f45418fa2df6f60ab13da8d.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Ophthalmoscopy performed on a 14-year-old boy had the given incidental finding. Family history revealed that his grandfather had colon cancer and an aunt was diagnosed with endometrial carcinoma. Genetic testing confirmed APC gene mutation. Which of the following is false about his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Condition can be passed on to his daughter in the future"
      },
      {
        "id": 2,
        "text": "Mutation of APC gene is on chromosome 15"
      },
      {
        "id": 3,
        "text": "100-10,000s of colonic polyps may develop"
      },
      {
        "id": 4,
        "text": "Prophylactic surgery is indicated"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image showing a pigmented retina, the patient's family history and APC gene mutation is suggestive of familial adenomatous polyposis. <strong>Familial adenomatous polyposis&nbsp;</strong>is due to the&nbsp;<strong>mutation </strong>of <strong><em>APC</em> gene </strong>located on the <strong>long arm</strong> of <strong>chromosome 5</strong> (5q21), not 15.</p>\n<p>Familial adenomatous polyposis (FAP) is<strong> autosomal dominant.&nbsp;</strong>It is characterized by the presence of <strong>&gt;100 adenomatous polyps</strong> in colon and rectum.&nbsp;It usually manifests by the late 2<sup>nd</sup> or early 3<sup>rd</sup>&nbsp;decade. Although it<strong>&nbsp;</strong>accounts for 1% of all colorectal carcinoma, the&nbsp;risk of development of cancer is&nbsp;100%.</p>\n<p>CHRPE (Congenital hypertrophy of retinal pigment epthelium) is the earliest extra-colonic manifestation of FAP, present in up to 75% of patients.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/17e45a5e8b574f358c74c2a3843bba67.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "All of the following are gastrointestinal manifestations seen in patients with FAP except:",
    "choices": [
      {
        "id": 1,
        "text": "Gastric and duodenal polyps"
      },
      {
        "id": 2,
        "text": "Fundal gland hyperplasia in gastric polyp"
      },
      {
        "id": 3,
        "text": "Ampullary carcinoma"
      },
      {
        "id": 4,
        "text": "Esophageal carcinoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Esophageal carcinoma is not associated with FAP</p>\n<p>Familial adenomatous polyposis (FAP) is associated with <strong>gastric</strong> and <strong>duodenal polyps</strong> in approximately 50% of the affected individuals.</p>\n<p>Most of the <strong>gastric polyps</strong> represent fundic gland hyperplasia and have <strong>limited malignant potential</strong>. <strong>Duodenal polyps</strong> are adenomatous in nature and <strong>premalignant</strong>.</p>\n<p>Patients with FAP have an increased risk for <strong>duodenal ampullary cancer</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a component of Gardner's syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Desmoid tumors"
      },
      {
        "id": 2,
        "text": "Brain tumors"
      },
      {
        "id": 3,
        "text": "Osteomas"
      },
      {
        "id": 4,
        "text": "Dental abnormalities"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Note: </strong></p>\n<p><strong>Turcot&rsquo;s syndrome</strong>&nbsp;includes&nbsp;<strong>brain tumor </strong>and <strong>colorectal polyps.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common presentation of abdominal desmoid tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Abdominal pain"
      },
      {
        "id": 2,
        "text": "Abdominal mass"
      },
      {
        "id": 3,
        "text": "Fever"
      },
      {
        "id": 4,
        "text": "Rectal prolapse"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Explanation:&nbsp;</p>\n<p>The most common presentation of an abdominal desmoid tumor is an <strong>abdominal mass.&nbsp;</strong></p>\n<p>Desmoid tumors, also known as <strong>fibromatosis</strong>, <strong>aggressive fibromatosis</strong> or <strong>desmoid-type fibromatosis</strong> are locally aggressive tumors that <strong>lack</strong> metastatic potential.&nbsp;Desmoid tumors can be <strong>sporadic</strong> in origin or associated with <strong>familial adenomatous polyposis</strong>.&nbsp;</p>\n<p>These tumors arise from fibro-aponeurotic tissue and typically are manifested as a slowly growing mass. They present as firm, non-painful, non-tender masses in the abdominal wall, shoulder, hip and limbs, mesentery, and pelvis. They are also associated with trauma, pregnancy, and oral contraceptive usage.</p>\n<p>The investigation of choice for a desmoid tumor is <strong>MRI</strong>. It is superior to CT in defining the pattern and the extent of involvement and can determine recurrence after surgery. Diagnosis is established by a biopsy with immunohistochemistry, which stains <strong>positive</strong> for <strong>beta-catenin</strong>, actin and vimentin, and&nbsp;<strong>negative</strong> for desmin, cytokeratin and S-100.</p>\n<p>Treatment:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">An<strong> initial observation</strong> is preferred for stable, asymptomatic, primary or recurrent desmoids, especially if surgery can cause high mortality.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Surgical resection</strong> with negative margin clearance is reserved for patients with small abdominal wall tumors associated with pain or an increase in size.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Tamoxifen</strong>&nbsp;and<strong>&nbsp;NSAIDs&nbsp;</strong>are used as<strong>&nbsp;first-line medical therapy.</strong>&nbsp;Other systemic treatment options are low-dose chemotherapy, tyrosinase kinase inhibitors, and full-dose chemotherapy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Radiotherapy is preferred for candidates unfit for surgery, patients refusing surgery and when surgical resection is associated with high morbidity.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old man was brought to the hospital with a history of headache and vomiting for the past 7 days and an episode of a tonic-clonic seizure. The image of the MRI scan is shown below. Colonoscopy revealed numerous polyps in the colon and the rectum which were found to be adenomatous on biopsy. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Familial adenomatous polyposis"
      },
      {
        "id": 2,
        "text": "Turcot's syndrome"
      },
      {
        "id": 3,
        "text": "Gardner's syndrome"
      },
      {
        "id": 4,
        "text": "Peutz-Jeghers syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 2163\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>In the given clinical scenario, the patient has <strong>numerous adenomatous polyps</strong> and a <strong>tumor in the brain</strong>. Therefore the most likely diagnosis is&nbsp;<strong>Turcot's syndrome</strong>. It is a variant of familial adenomatous polyposis.</p>\n<p><strong>Familial adenomatous polyposis (FAP)</strong>&nbsp;is an <strong>autosomal dominant</strong> condition and is caused due to the mutation in the <strong>APC gene</strong> located on chromosome 5.</p>\n<p class=\"p1\">Clinically, patients develop hundreds to thousands of <strong>adenomatous polyps</strong> in the colon and rectum. Some patients may also develop duodenal adenomas. The lifetime risk of developing colorectal carcinoma in these patients is 100%.&nbsp;</p>\n<p class=\"p1\">The treatment of the FAP includes <strong>total proctocolectomy</strong> with <strong>ileal pouch-anal anastomosis</strong> (IPAA).</p>\n<p class=\"p1\">Variants of FAP are:</p>\n<ol>\n<li class=\"p1\"><strong>Gardner's syndrome</strong>- It is an autosomal dominant variant of FAP. In addition to colonic polyps the patients will have\n<ul>\n<li class=\"p1\">Osteomas of the mandible or skull&nbsp;</li>\n<li class=\"p1\">Epidermal cysts</li>\n<li class=\"p1\">Soft tissue tumors like desmoid tumor</li>\n</ul>\n</li>\n<li class=\"p1\"><strong>Turcot's syndrome</strong>- In addition to the colonic polyps the patients will have central nervous system tumors (primary brain tumors).</li>\n</ol>\n<p>Option D: <strong>Peutz-Jegher's syndrome</strong>&nbsp;is not related to familial adenomatous polyposis.&nbsp;It is an autosomal dominant disease characterized by</p>\n<ul>\n<li>Pigmentation of the mouth and lips</li>\n<li>Multiple <strong>hamartomatous polyps</strong> in the small and large intestine.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe61bc395a8d4614bc2d04ceec08a069.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Colonoscopy and biopsy on a 35-year-old man revealed hundreds of adenomatous polyps in the entire descending and sigmoid colon. Options for prophylactic surgery are discussed. Which of the following procedures will reduce the occurrence of malignancy the most?",
    "choices": [
      {
        "id": 1,
        "text": "Total colectomy with ileorectal anastomosis"
      },
      {
        "id": 2,
        "text": "Total colectomy with ileal pouch-anal anastomosis"
      },
      {
        "id": 3,
        "text": "Total proctocolectomy with ileal pouch-anal anastomosis"
      },
      {
        "id": 4,
        "text": "Total proctocolectomy with end ileostomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario is <strong>diagnostic</strong> of <strong>familial adenomatous polyposis syndrome</strong>. To prevent an occurrence of cancer,&nbsp;<strong>total proctocolectomy with ileal pouch-anal anastomosis </strong>is the management of choice<strong>.&nbsp;</strong>This procedure is usually accompanied by resection of the rectal mucosa.</p>\n<p>Following surgery, the patient has to be routinely followed up for ileoanal-pouch surveillance. Upper GI endoscopy should also be performed to evaluate for the presence of duodenal adenomas.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man was recently diagnosed and treated for an autosomal dominant disorder. The gross specimen of his resected colon is given in the image. What is the initial step in screening his 9-year-old child?",
    "choices": [
      {
        "id": 1,
        "text": "Genetic testing for APC gene mutation"
      },
      {
        "id": 2,
        "text": "Genetic testing for MSH-6 gene mutation"
      },
      {
        "id": 3,
        "text": "Routine flexible sigmoidoscopy starting from 10 years of age"
      },
      {
        "id": 4,
        "text": "Routine colonoscopy starting from 10 years of age"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>More than 100 colonic polyps are diagnostic of&nbsp;<strong>familial adenomatous polyposis</strong>&nbsp;syndrome and the<strong>&nbsp;initial step in screening</strong>&nbsp;the child syndrome is to perform<strong>&nbsp;genetic testing</strong>&nbsp;for&nbsp;<strong>APC gene mutation.&nbsp;</strong></p>\n<p>If screening is positive,&nbsp;<strong>flexible sigmoidoscopy&nbsp;</strong>or&nbsp;<strong>colonoscopy</strong>&nbsp;is&nbsp;done annually starting from<strong>&nbsp;10 years&nbsp;</strong>of age.</p>\n<p>If the APC testing is negative, then the risk of developing colorectal carcinoma in the relative is similar to the general population. The screening can be started from 50 years of age.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/890d316aa07c4b0da4471dd57359bd06.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which among the following is true about Amsterdam criteria?",
    "choices": [
      {
        "id": 1,
        "text": "At least 3 successive generations affected"
      },
      {
        "id": 2,
        "text": "At least 2 or more first-degree relatives affected"
      },
      {
        "id": 3,
        "text": "At least one case diagnosed before 50 years of age"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the <strong>Amsterdam criteria </strong>for hereditary nonpolyposis colorectal cancer (HNPCC)<strong>,</strong> <strong>at least one case </strong>should be <strong>diagnosed before 50 </strong>years of age.</p>\n<p>Option A: According to the <strong>Amsterdam criteria </strong>for a presumptive diagnosis of HNPCC, at least <strong>2</strong> (not 3) successive<strong> generations</strong> should be affected.</p>\n<p>Option B: According to the <strong>Amsterdam criteria </strong>for a presumptive diagnosis of HNPCC, at least <strong>3</strong>&nbsp;relatives (not 2) with at least one being&nbsp;<strong>first-degree relatives</strong> should be affected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common extra-colonic cancer in patients with a mutation in MMR genes?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric carcinoma"
      },
      {
        "id": 2,
        "text": "Breast carcinoma"
      },
      {
        "id": 3,
        "text": "Endometrial carcinoma"
      },
      {
        "id": 4,
        "text": "Ovarian carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Endometrial carcinoma</strong> is the most common extracolonic carcinoma in patients with<strong> mutated MMR genes.</strong></p>\n<p><strong><strong>Autosomal dominant</strong>\u00a0</strong>mutation in <strong><strong>DNA mismatch repair (<em>MMR</em>) genes, </strong></strong>such as<strong><strong> <em>hMLH1</em>, <em>hMSH2</em></strong>, <em>hMSH6</em>, <em>PMS1</em>, and <em>PMS2\u00a0</em></strong>lead to various cancers. This condition is known as <strong>Lynch Syndrome/HNPCC.</strong></p>\n<p><strong>Gastric </strong>and<strong> ovarian carcinoma\u00a0</strong>are also commonly found.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/608ccf9b15cd4c5f9161cfda0bb34095x1280x2239.JPEG"
    ]
  },
  {
    "text": "Which among the following is false about colorectal carcinoma in HNPCC?",
    "choices": [
      {
        "id": 1,
        "text": "The onset of cancer occurs early"
      },
      {
        "id": 2,
        "text": "The progression of the carcinoma is slow"
      },
      {
        "id": 3,
        "text": "Mucinous adenocarcinoma is the most common type"
      },
      {
        "id": 4,
        "text": "Tumors predominantly develop in right sided colon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In hereditary nonpolyposis colorectal cancer (<strong>HNPCC)</strong>, there is <strong>accelerated tumor progression </strong>and normal tumor initiation.</p>\n<p><strong>Accelerated tumor initiation</strong> is seen in&nbsp;familial adenomatous polyposis (FAP).</p>\n<p>In Hereditary Non-polyposis Colorectal Cancer (HNPCC), the onset of cancer is at a&nbsp;<strong>relatively young age&nbsp;</strong>(mean, 44 years). Proximal distribution is more common and nearly 70% of cancers are located in the&nbsp;<strong>right colon</strong>.&nbsp;<strong>Mucinous </strong>or<strong> poorly differentiated </strong>(signet cell)<strong> adenocarcinoma </strong>predominate. There is an increased number of&nbsp;<strong>synchronous </strong>and<strong> metachronous cancers. </strong>The&nbsp;<strong>outcome after surgery </strong>is<strong>&nbsp;</strong>relatively&nbsp;<strong>good.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c467f1c1c0740008a03832fdb72bce7x1280x1675.JPEG"
    ]
  },
  {
    "text": "A 25-year-old man presented to the dermatologist's office with multiple small bumps on his forehead. Excisional biopsy findings are suggestive of multiple small sebaceous adenomas. Detailed family history reveals that his grandfather and brother have colon cancer while his aunt was diagnosed with rectal cancer. Which syndrome should be suspected?",
    "choices": [
      {
        "id": 1,
        "text": "Gardner\u2019s syndrome"
      },
      {
        "id": 2,
        "text": "Cowden's syndrome"
      },
      {
        "id": 3,
        "text": "Muir-Torre syndrome"
      },
      {
        "id": 4,
        "text": "Turcot's syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Multiple cutaneous sebaceous adenomas</strong>\u00a0and a family history of various cancers are seen in <strong>Muir\u2013Torre syndrome.</strong></p>\n<p>Muir\u2013Torre variant of hereditary nonpolyposis colorectal cancer (HNPCC) may have:</p>\n<ul>\n<li>Sebaceous adenomas</li>\n<li>Keratoacanthomas</li>\n<li>Sebaceous epitheliomas</li>\n<li>Basal cell epitheliomas</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which criteria is used to select patients for microsatellite instability (MSI) testing?",
    "choices": [
      {
        "id": 1,
        "text": "Amsterdam criteria"
      },
      {
        "id": 2,
        "text": "Revised Amsterdam criteria"
      },
      {
        "id": 3,
        "text": "Bethesda criteria"
      },
      {
        "id": 4,
        "text": "Lynch criteria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Bethesda criteria</strong> is used to <strong>select patients for microsatellite instability testing</strong>.&nbsp;</p>\n<p>Microsatellites are regions of repeated DNA that change in length (show instability) when mismatch repair is not functioning. Defects in mismatch repair genes (as in Lynch syndrome/HNPCC)&nbsp;leads to <strong>microsatellite instability</strong>.&nbsp;</p>\n<p><strong><span class=\"topic-highlight\">Amsterdam criteria</span></strong> is used for a <strong>presumptive diagnosis</strong> of <strong>HNPCC in a family</strong>. Because the Amsterdam criteria do not include some patients with known germline MMR gene mutations, another set of guidelines, known as the <strong>Bethesda guidelines</strong>, was established to <strong>help decide</strong> whether or not a patient should undergo further <strong>molecular testing</strong> to rule out HNPCC.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which part of the colon does colorectal carcinoma most commonly develop?",
    "choices": [
      {
        "id": 1,
        "text": "Cecum"
      },
      {
        "id": 2,
        "text": "Sigmoid colon"
      },
      {
        "id": 3,
        "text": "Transverse colon"
      },
      {
        "id": 4,
        "text": "Right colon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the colon, colorectal carcinoma most commonly develops in the <strong>sigmoid colon</strong>.</p>\n<p><strong>Overall</strong>, the <strong>most common site</strong> of <strong>colorectal carcinoma</strong> is the <strong>rectum</strong>.</p>\n<p>The sites of development of colorectal carcinoma in order of frequency are:</p>\n<ul>\n<li><strong>Rectum&nbsp;</strong></li>\n<li><strong>Sigmoid colon</strong></li>\n<li>Caecum</li>\n<li>Transverse colon</li>\n<li>Ascending colon</li>\n<li>Descending colon</li>\n<li>Splenic flexure</li>\n<li>Hepatic flexure</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/128b95702668473a93a116fb19801ce0x1279x1150.JPEG"
    ]
  },
  {
    "text": "Which of the following are risk factors for colon carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "2,4,5"
      },
      {
        "id": 2,
        "text": "1,3,5"
      },
      {
        "id": 3,
        "text": "1,2,3"
      },
      {
        "id": 4,
        "text": "1,2,3,4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ulcerative colitis,&nbsp;familial adenomatous polyposis (FAP), cholecystectomy, ureterosigmoidostomy, and smoking are risk factors for colon cancer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following dietary recommendation puts patients at risk of developing colon cancer?",
    "choices": [
      {
        "id": 1,
        "text": "High-calorie diet"
      },
      {
        "id": 2,
        "text": "Low-animal-fat diet"
      },
      {
        "id": 3,
        "text": "Selenium"
      },
      {
        "id": 4,
        "text": "Vitamin A"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 815\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>High-calorie, low-fiber, </strong>and<strong> high-animal-fat diet </strong>as well as <strong>alcohol consumption increase </strong>the<strong> risk</strong> of colon cancer.</p>\n<p><strong>Calcium, selenium, vitamins A, C, </strong>and<strong> E, carotenoids, </strong>and<strong> plant phenols </strong>are <strong>protective.</strong></p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following colonoscopic findings has the highest risk of developing colorectal cancer?",
    "choices": [
      {
        "id": 1,
        "text": "A single pedunculated polyp"
      },
      {
        "id": 2,
        "text": "Multiple flat polyps"
      },
      {
        "id": 3,
        "text": "Multiple pedunculated  polyps"
      },
      {
        "id": 4,
        "text": "A solitary flat rectal polyp"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sessile/flat polyps</strong> are at a\u00a0<strong>higher risk</strong> of malignancy compared to pedunculated polyps. <strong>Multiple polyps increase the risk</strong> of malignancy.\u00a0</p>\n<p>The probability of development of malignancy of a polyp depends on the following<strong>:</strong></p>\n<ul>\n<li><strong>Gross appearance of lesion:\u00a0</strong>Sessile polyps are at higher risk for malignancy than pedunculated tumors.</li>\n<li><strong>Histology:\u00a0</strong>Villous &gt; Tubulovillous &gt; tubular</li>\n<li><strong>Size:\u00a0</strong>Polyps of size &gt;2 cm are at higher risk.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mutations in which gene is responsible for malignant changes in late colonic adenomas?",
    "choices": [
      {
        "id": 1,
        "text": "APC"
      },
      {
        "id": 2,
        "text": "K-ras"
      },
      {
        "id": 3,
        "text": "p53"
      },
      {
        "id": 4,
        "text": "DCC"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong><em>p53</em></strong> mutation is responsible for the transformation of late adenoma to carcinoma.</p>\n<p>The <strong>earliest mutations</strong> in the adenoma-carcinoma sequence occur in the <strong><em>APC</em> gene </strong>and the <strong>earliest phenotypic change</strong>&nbsp;is known as <strong>aberrant crypt formation.</strong></p>\n<p><strong>The most consistent genetic aberrations</strong> within these cells abnormally result in the formation of short pro&shy;teins known as <strong>APC truncations</strong>.<strong>&nbsp;</strong>They<em>&nbsp;</em>occur in the <strong>mutational cluster region</strong> of the gene, an area responsible <strong>for &beta;-catenin binding.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the correctly matched set regarding risk category and colon cancer screening recommendation?",
    "choices": [
      {
        "id": 1,
        "text": "1-C, 2-D, 3-B, 4-A"
      },
      {
        "id": 2,
        "text": "1-D, 2-A, 3-C, 4-B"
      },
      {
        "id": 3,
        "text": "1-C, 2-B, 3-A, 4-D"
      },
      {
        "id": 4,
        "text": "1-B, 2-D, 3-A, 4-C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option A states the correctly matched pairs regarding risk category and colon cancer screening recommendation.</p>\n<table style=\"height: 482px; width: 575px;\">\n<tbody>\n<tr>\n<td style=\"width: 565.8px;\" colspan=\"3\">Current recommendation on colon cancer screening</td>\n</tr>\n<tr>\n<td style=\"width: 349.533px;\" colspan=\"2\">Risk category</td>\n<td style=\"width: 210.667px;\">Recommendation</td>\n</tr>\n<tr>\n<td style=\"width: 133.55px;\">Patients at average risk</td>\n<td style=\"width: 210.383px;\">General population</td>\n<td style=\"width: 210.667px;\">Colonoscopy <strong>every 10 years</strong> between <strong>50 -75 years</strong></td>\n</tr>\n<tr>\n<td style=\"width: 133.55px;\" rowspan=\"4\">Patients at higher risk</td>\n<td style=\"width: 210.383px;\">Diagnosis of colon cancer or adenomatous polyps in\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Any first-degree relative at age &lt;60 years</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&ge;2 first-degree relatives at age &ge;60 years</li>\n</ul>\n</td>\n<td style=\"width: 210.667px;\">Colonoscopy every 3-5 years starting at <strong>whichever comes first</strong>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">age 40 or&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">at least 10 years before the relative&rsquo;s age of diagnosis</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 210.383px;\">Inflammatory bowel disease (Crohn's disease or ulcerative colitis)</td>\n<td style=\"width: 210.667px;\">Colonoscopy every 1-2 years starting 8 years after diagnosis</td>\n</tr>\n<tr>\n<td style=\"width: 210.383px;\"><strong>Familial adenomatous polyposis</strong></td>\n<td style=\"width: 210.667px;\">Colonoscopy <strong>every year</strong> starting at the age of <strong>10-12 years</strong></td>\n</tr>\n<tr>\n<td style=\"width: 210.383px;\">Lynch syndrome (HNPCC)</td>\n<td style=\"width: 210.667px;\">Colonoscopy every 1-2 years starting at 20-25 years</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 61-year-old man presents with complaints of fatigue and shortness of breath. He has conjunctival pallor and has lost significant weight over 3 months. A CBC reveals low haemoglobin and MCV. A stool occult blood test is positive. What is the next best step in evaluation?",
    "choices": [
      {
        "id": 1,
        "text": "Barium enema"
      },
      {
        "id": 2,
        "text": "Colonoscopy"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "CT scan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of an elderly patient with sudden onset anemia always warrants screening for colorectal cancer, as cancers in the <strong>right colon&nbsp;</strong>often manifest as&nbsp;<strong>melena </strong>and<strong> fatigue associated with anemia. </strong>Thus, the next best investigation is a <strong>colonoscopy.</strong></p>\n<p><strong>Colonoscopy</strong> is the investigation of choice &amp;&nbsp;gold standard&nbsp;for establishing the diag&shy;nosis of colon cancer.</p>\n<p>It permits biopsy of the tumor to verify the diagnosis&nbsp;while allowing inspection of the entire colon to exclude metachronous polyps or cancers.</p>\n<p>Colonoscopy is generally performed even after cancer is detected by<strong> barium enema</strong>, in order to obtain a biopsy specimen and to detect (and remove) small polyps that may have been missed in the contrast study.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old woman presents with abdominal pain and constipation. A barium enema reveals an apple core sign. In which part of the colon is such a growth commonly seen?",
    "choices": [
      {
        "id": 1,
        "text": "Left colon"
      },
      {
        "id": 2,
        "text": "Right colon"
      },
      {
        "id": 3,
        "text": "Transverse colon"
      },
      {
        "id": 4,
        "text": "Caecum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Apple core sign&nbsp;</strong>on barium enema is suggestive of a <strong>constricting type</strong> of colon cancer that is more common on the <strong>left side</strong>. <strong>Ulcerative type</strong> is more common on the <strong>right side.</strong></p>\n<p class=\"p1\">Most patients with<strong>&nbsp;left-</strong>sided colon cancers often present with <strong>increasing constipation&nbsp;</strong>while patients with <strong>right-</strong>sided colon cancer often present with&nbsp;<strong>melena and fatigue associated with anemia.</strong></p>\n<p class=\"p1\">The <strong>apple core sign</strong> describes a short&nbsp;segment&nbsp;irregular circumferential stricture of the large bowel that has&nbsp;abrupt shouldered margins&nbsp;resembling an&nbsp;apple core.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae7541322ef44b599425886cb36312ffx1108x922.PNG"
    ]
  },
  {
    "text": "What is the most common presenting feature in patients with right sided colon cancer ?",
    "choices": [
      {
        "id": 1,
        "text": "Diarrhoea"
      },
      {
        "id": 2,
        "text": "Anemia"
      },
      {
        "id": 3,
        "text": "Constipation"
      },
      {
        "id": 4,
        "text": "Abdominal pain"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Anemia</strong> is the most common presenting feature in patients with <strong>right-sided</strong> colon cancer.</p>\n<p>Cancers in the <strong>right colon</strong>&nbsp;are more often manifested as&nbsp;<strong>melena, fatigue </strong>associated with<strong> anemia,</strong> or<strong> abdominal pain </strong>(if the tumor is advanced).</p>\n<p>Cancer of the<strong> left colon&nbsp;</strong>mainly presents with<strong> altered bowel habits, </strong>usually<strong> constipation </strong>and <strong>intestinal obstruction.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following statements is false about virtual colonoscopy as compared to conventional colonoscopy?",
    "choices": [
      {
        "id": 1,
        "text": "Virtual colonoscopy is less sensitive for small polyps"
      },
      {
        "id": 2,
        "text": "Provids a better image than conventional colonoscopy"
      },
      {
        "id": 3,
        "text": "Easier to take tissue biopsy during virtual colonoscopy"
      },
      {
        "id": 4,
        "text": "Less time consuming than conventional colonoscopy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Virtual colonoscopy</strong> is a <strong>non-invasive technique</strong> and is <strong>not useful in taking biopsy</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female presented with low-grade fever, easy fatiguability, and pain in the right hypochondrium. On examination, pallor and moderate hepatomegaly were present. A CT scan revealed non-enhancing masses. The biopsy showed adenocarcinoma, not of hepatic origin. A combination of IHC tests was done and was reported as CK 7 (-), CK20 (+). Which of the following is the most likely primary site of origin?",
    "choices": [
      {
        "id": 1,
        "text": "Ovary"
      },
      {
        "id": 2,
        "text": "Colon"
      },
      {
        "id": 3,
        "text": "Pancreas"
      },
      {
        "id": 4,
        "text": "Lung"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Colorectal carcinoma</strong> is the <strong>most likely primary tumor</strong> for the given metastases. Among the given options, <strong>cytokeratin 7 </strong>is<strong> negative </strong>only in <strong>colon carcinoma</strong>.</p>\n<p>The <strong>most common site of distant metastasis</strong> from colorectal cancer is the <strong>liver.&nbsp;</strong>These metastases arise from <strong>hematogenous spread via the portal venous system</strong>.The lung is the next most common site for metastasis.</p>\n<p>Cytokeratin profiles of various primary tumors:</p>\n<table style=\"height: 520px; width: 294px;\">\n<tbody>\n<tr>\n<td style=\"width: 94px;\">\n<p>&nbsp;</p>\n<p>CK 7 positive</p>\n<p>CK20 positive</p>\n</td>\n<td style=\"width: 184px;\">\n<ul>\n<li>Cholangiocarcinoma</li>\n<li>Ovarian mucinous carcinoma</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 94px;\">\n<p>CK 7 <strong>positive&nbsp;</strong></p>\n<p>CK 20 negative</p>\n</td>\n<td style=\"width: 184px;\">\n<ul>\n<li><strong>Breast carcinoma</strong></li>\n<li>Ovarian serous adenocarcinoma</li>\n<li><strong>Thyroid carcinoma</strong></li>\n<li>Pancreatic adenocarcinoma</li>\n<li><strong>Lung carcinoma</strong></li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 94px;\">\n<p>CK 7 <strong>negative</strong></p>\n<p>CK 20 <strong>positive</strong></p>\n</td>\n<td style=\"width: 184px;\">\n<ul>\n<li><strong>Colorectal adenocarcinoma</strong></li>\n<li>Merkel cell carcinoma</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 94px;\">\n<p>CK 7 negative</p>\n<p>CK 20 negative</p>\n</td>\n<td style=\"width: 184px;\">\n<ul>\n<li>Hepatocellular carcinoma</li>\n<li>Renal cell carcinoma</li>\n<li>Prostatic adenocarcinoma</li>\n<li>Squamous cell carcinoma</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/51267f2f2b3d4cad857b887f855081a0.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most important prognostic factor in patients with colorectal carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Site of lesion"
      },
      {
        "id": 2,
        "text": "Size of lesion"
      },
      {
        "id": 3,
        "text": "Stage of lesion"
      },
      {
        "id": 4,
        "text": "Age of patient"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most important determinant of prognosis for colorectal carcinoma is the&nbsp;<strong>tumour stage</strong> and, in particular,&nbsp;<strong>lymph node status</strong>. The T-stage (depth of invasion) is the single most significant predictor of lymph node spread.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Choose the parameters used to stage colorectal carcinoma according to Duke's classification ?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 5"
      },
      {
        "id": 2,
        "text": "3, 4"
      },
      {
        "id": 3,
        "text": "1, 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3,4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Duke&rsquo;s classification is based on the depth of tumor and lymph node status.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/406f1131dcf840579c3aed85987110bfx1280x1193.JPEG"
    ]
  },
  {
    "text": "The biopsy of a hemicolectomy specimen revealed an adenocarcinoma with colonic subserosa invasion. Deposits were found on the mesentery but lymph nodes were not involved. Further investigation on the patient did not indicate local or distant metastases. What is the stage of the tumor ?",
    "choices": [
      {
        "id": 1,
        "text": "T4b N0 M1c"
      },
      {
        "id": 2,
        "text": "T4a N2b M0"
      },
      {
        "id": 3,
        "text": "T3 N1c M0"
      },
      {
        "id": 4,
        "text": "T3 N0 M1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to 8th American Joint Committee on Cancer (AJCC) classification of colorectal cancers, <strong>tumor deposits in the subserosa or mesentery</strong> are staged as <strong>N1c</strong> and <strong>tumor invading the subserosa without involvement of peritonealized organs</strong> is <strong>T3</strong>.\u00a0</p>\n<table style=\"width: 408px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 76px;\">TNM staging</td>\n<td style=\"width: 151.926px;\">7th AJCC (2010)</td>\n<td style=\"width: 163.074px;\"><strong>8th AJCC (2018)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">Primary tumor(pT)</td>\n<td style=\"width: 151.926px;\">\u00a0</td>\n<td style=\"width: 163.074px;\">\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">TX</td>\n<td style=\"width: 151.926px;\">Cannot be assessed</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">T0</td>\n<td style=\"width: 151.926px;\">No evidence of cancer</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">Tis</td>\n<td style=\"width: 151.926px;\">Carcinoma in situ</td>\n<td style=\"width: 163.074px;\">Carcinoma in situ, <strong>intramucosal carcinoma</strong> (involvement of lamina propria with no extension through muscularis mucosae)</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">T1</td>\n<td style=\"width: 151.926px;\">invades submucosa</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">T2</td>\n<td style=\"width: 151.926px;\">invades muscularis propria</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">T3</td>\n<td style=\"width: 151.926px;\">invades muscularis propria into subserosa or into nonperitonealized pericolic or perirectal tissues</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">T4</td>\n<td style=\"width: 151.926px;\">invades other organs or tissues or perforates the visceral peritoneum of specimen</td>\n<td style=\"width: 163.074px;\">\n<p><strong>T4a:\u00a0</strong>invades through visceral peritoneum (including gross perforation of the bowel and invasion of tumor through areas of inflammation to the surface of the visceral peritoneum)</p>\n<p><strong>T4b:\u00a0</strong>invades or adheres to other adjacent organs or structures<br /><br /></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">Regional lymph nodes (pN)</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">NX</td>\n<td style=\"width: 151.926px;\">Regional lymph nodes cannot be assessed</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">N0</td>\n<td style=\"width: 151.926px;\">No lymph node metastasis</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">N1</td>\n<td style=\"width: 151.926px;\">1-3 pericolic or perirectal lymph nodes</td>\n<td style=\"width: 163.074px;\">\n<p><strong>N1a:</strong> 1 regional lymph node</p>\n<p><strong>N1b:</strong> 2 - 3 regional lymph nodes</p>\n<p><strong>N1c:</strong> no regional lymph nodes are positive but there are <strong>tumor deposits</strong> in the subserosa, mesentery or nonperitonealized pericolic or perirectal / mesorectal tissues</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">N2</td>\n<td style=\"width: 151.926px;\">Metastasis to &gt; 4 pericolic or perirectal lymph nodes</td>\n<td style=\"width: 163.074px;\">\n<p><strong>N2a:</strong> 4 - 6 regional lymph nodes</p>\n<p><strong>N2b:</strong>\u00a0 <span style=\"text-decoration: underline;\">&gt;</span>7 regional lymph nodes<br /><br /></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">Distant metastasis (pM)</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">M0</td>\n<td style=\"width: 151.926px;\">No Distant metastasis</td>\n<td style=\"width: 163.074px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 76px;\">M1</td>\n<td style=\"width: 151.926px;\">Distant metastasis present</td>\n<td style=\"width: 163.074px;\">\n<p><strong>M1a</strong>: confined to 1 organ or site without peritoneal metastasis</p>\n<p><strong>M1b:</strong> metastasis to <span style=\"text-decoration: underline;\">&gt;</span>2 sites or organs is identified without peritoneal metastasis</p>\n<p><strong>M1c:</strong> metastasis to the peritoneal surface is identified alone or with other site or organ metastases</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following patients with colon cancer to the procedure that is best suited.",
    "choices": [
      {
        "id": 1,
        "text": "1-A, 2-B, 3-C"
      },
      {
        "id": 2,
        "text": "1-C, 2-A, 3-B"
      },
      {
        "id": 3,
        "text": "1-B, 2-A, 3-C"
      },
      {
        "id": 4,
        "text": "1-B, 2-C, 3-A"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All of the given procedures may be performed in a patient with colonic cancer presenting with features of left colonic obstruction. The most appropriate answer is 1-B,2-C,3-A.</p>\n<p>In<strong> Hartmann's procedure,&nbsp;</strong>the segment of the colon containing the obstructing cancer is resected and&nbsp;<strong>closure of the distal sigmoid or rectum</strong> is performed.&nbsp;A <strong>colostomy </strong>is made. <strong>Later,</strong>&nbsp;intestinal continuity is re-established by the closure of the colos&shy;tomy and fashioning a <strong>colorectal anastomosis. </strong></p>\n<p>This procedure is preferred in patients when a resection and primary anastomosis cannot be performed immediately due to complications such as <strong>inflammation of the bowel</strong>, <strong>perforation</strong>, or <strong>peritonitis.</strong></p>\n<p><strong>Resection and primary anastomosis </strong>is&nbsp;done in patients who are<strong> hemody&shy;namically stable </strong>and have <strong>pliable, nonedematous, well-vascularized bowel.</strong>&nbsp;</p>\n<p>In this procedure, the segment of the left colon containing the cancer is resected. The remain&shy;ing colon is cleaned with saline lavage by inserting a catheter through the appendix or ileum into the cecum and irrigating the contents from the colon.&nbsp;Primary anastomosis between the prepared colon and rectum is fashioned subsequently, without the need for a temporary colostomy&nbsp;</p>\n<p><strong>Stent placement via colonoscope</strong>&nbsp;is a temporary measure to obtain time for bowel preparation for primary anastomosis.&nbsp;A stent that traverses the tumor is placed to relieve the obstruction. It is done in <strong>partial obstruction</strong> and is preferred in <strong>old</strong> and <strong>frail</strong> patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man was rushed to the ER with abdominal pain, obstipation, and altered mental status for the last 2 days. Physical examination and imaging findings are suggestive of perforated intestinal obstruction with peritonitis. After stabilization, he is immediately taken to the operating room, where a suspicious ascending colon mass is seen. Which of the following is the most appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Right hemicolectomy with ileocolostomy"
      },
      {
        "id": 2,
        "text": "Resection and anastomosis"
      },
      {
        "id": 3,
        "text": "Hartmann\u2019s procedure"
      },
      {
        "id": 4,
        "text": "Endoluminal stent placement"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The elderly man with ascending colon mass leading to <strong>perforated intestinal obstruction</strong> with <strong>peritonitis</strong> should ideally be treated with <strong>right hemicolectomy and ileocolostomy</strong>.</p>\n<p>In case of suspected colorectal cancer presenting with intestinal obstruction the following surgeries are done:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Right-sided lesion:</strong>&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">A <strong>resection</strong> (right hemicolectomy) and <strong>anastomosis</strong> if the patient is <strong>stable</strong>&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><strong>Perforation</strong> with substantial contamination or if the patient is <strong>unstable</strong>: <strong>right hemicolectomy + ileocolostomy</strong></li>\n</ul>\n</ul>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Left-sided lesion:</strong>&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><strong>Resection</strong> and <strong>anastomosis</strong> if the patient is <strong>stable</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><strong>Perforation</strong> with substantial contamination or if the patient is <strong>unstable</strong>: <strong>Hartmann procedure</strong> is done. Later,&nbsp;intestinal continuity is re-established by the closure of the colos&shy;tomy and fashioning a <strong>colorectal anastomosis. </strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Where endoscopic and radiological facilities are present an <strong>obstructing left-sided lesion</strong> can be treated with an expanding metal <strong>stent</strong> provided bowel <strong>perforation</strong> is <strong>absent</strong>.</li>\n</ul>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man is diagnosed with stage II colorectal carcinoma located in the transverse colon. Which of the following is the surgical procedure of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Right hemicolectomy"
      },
      {
        "id": 2,
        "text": "Transverse colectomy"
      },
      {
        "id": 3,
        "text": "Extended right hemicolectomy"
      },
      {
        "id": 4,
        "text": "Left hemicolectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Extended right hemicolectomy</strong> is the most appropriate surgical procedure for a neoplastic tumor in the transverse colon. This procedure involves resection of the&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Terminal ileum with Ileocecal junction</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cecum</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ascending colon</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hepatic flexure, and</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Distal transverse colon</li>\n</ul>\n<p>Very <strong>small and localized lesions</strong> in the transverse colon may be resected by <strong>transverse colectomy</strong>. However, this procedure is very<strong> uncommon</strong>.</p>\n<table style=\"width: 931.717px;\">\n<tbody>\n<tr>\n<td style=\"width: 183px;\">Tumor location</td>\n<td style=\"width: 241px;\">Procedure of choice</td>\n<td style=\"width: 482.717px;\">Resected bowel segments</td>\n</tr>\n<tr>\n<td style=\"width: 183px;\">Cecum / Ascending colon / Hepatic flexure</td>\n<td style=\"width: 241px;\">Right hemicolectomy</td>\n<td style=\"width: 482.717px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Terminal ileum with Ileocecal junction</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cecum</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ascending colon</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hepatic flexure</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183px;\">Transverse colon / Hepatic flexure</td>\n<td style=\"width: 241px;\">Extended right hemicolectomy</td>\n<td style=\"width: 482.717px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Terminal ileum with Ileocecal junction</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cecum</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ascending colon</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hepatic flexure</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Distal transverse colon&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Splenic flexure may be resected based on the tumor location</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183px;\">Descending colon &plusmn; sigmoid colon</td>\n<td style=\"width: 241px;\">Left hemicolectomy</td>\n<td style=\"width: 482.717px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Transverse colon(left MCA territory)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Splenic flexure</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Descending colon upto sigmoid colon</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183px;\">Sigmoid colon</td>\n<td style=\"width: 241px;\">Sigmoid colectomy, or LAR (Low anterior resection)</td>\n<td style=\"width: 482.717px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Entire sigmoid colon and rectum is removed</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Coloanal anastomosis is performed</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9727f7dd42e145a7bb79c3c4dc1c2387x1280x1567.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d6da8b022334e1987d7dbb2cfbf3078x1280x1567.JPEG"
    ]
  },
  {
    "text": "A male patient presented with dull abdominal pain and rectal bleeding. On investigations, he was diagnosed with colon carcinoma. Which of the following statements is false regarding the management of colorectal carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Stage III cancer is treated with surgical resection and chemotherapy"
      },
      {
        "id": 2,
        "text": "Stage II cancer with young age is an indication for chemotherapy"
      },
      {
        "id": 3,
        "text": "FOLFOX regimen is used for colorectal carcinoma"
      },
      {
        "id": 4,
        "text": "Immunotherapy is ineffective in metastatic colorectal carcinoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Immunotherapy is not ineffective in metastatic colorectal cancer. <strong>Metastatic</strong> or<strong> recurrent colorectal cancers</strong> are the <strong>indications</strong> for <strong>immunotherapy</strong>.</p>\n<p>Monoclonal antibodies such as</p>\n<ul>\n<li><strong>Bevacizumab</strong> (Anti-VEGF),</li>\n<li><strong>Cetuximab</strong> (anti-EGFR),</li>\n<li><strong>Panitumumab</strong> (anti-EGFR),</li>\n<li><strong>Pembrolizumab</strong> (anti-PDL1),</li>\n<li><strong>Nivolumab</strong> (anti-PDL), etc. are the commonly used immunotherapeutic drugs in colorectal carcinoma.</li>\n</ul>\n<p>Option A: Surgical resection is indicated in all the stages of colon carcinoma. Management of Stage III colorectal carcinoma should also include chemotherapy, in addition to surgical resection. The stage-specific therapies are as follows:</p>\n<table style=\"height: 77px; width: 820.633px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 108px; height: 18px;\">Stage</td>\n<td style=\"width: 696.633px; height: 18px;\">Management</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 108px; height: 46px;\"><strong>Stage I</strong>:</td>\n<td style=\"width: 696.633px; height: 46px;\">\n<ul>\n<li>Surgical resection</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 108px; height: 72px;\"><strong>Stage II</strong>:</td>\n<td style=\"width: 696.633px; height: 72px;\">\n<ul>\n<li>Surgical resection</li>\n<li><strong>Adjuvant chemotherapy&nbsp;</strong>in<strong> high-risk </strong>patients (presence of <strong>poor prognostic factors</strong>)</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 108px; height: 18px;\"><strong>Stage III</strong>:</td>\n<td style=\"width: 696.633px; height: 18px;\">\n<ul>\n<li>Surgical resection</li>\n<li><strong>Adjuvant chemotherapy</strong> (folinic acid, 5-fluorouracil, oxaliplatin)</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 108px; height: 18px;\"><strong>Stage IV</strong>:</td>\n<td style=\"width: 696.633px; height: 18px;\">\n<ul>\n<li>Surgical resection with adjuvant chemotherapy</li>\n<li>Radiotherapy</li>\n<li>Immunotherapy (monoclonal antibodies)</li>\n<li>Palliative treatment in extensive metastasis.&nbsp;</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>Option B: Stage II cancer in young patients should be considered for chemotherapy. Treatment of stage II colon carcinoma is surgical resection of the cancerous mass. <strong>Adjuvant chemotherapy</strong> is indicated in patients with at least one <strong>poor prognostic indicator</strong> like:</p>\n<ul>\n<li><strong>Young patients</strong></li>\n<li><strong>Inadequate lymph node excision</strong>(&lt;12 lymph nodes)</li>\n<li><strong>Poorly differentiated histology</strong></li>\n<li><strong>Positive margin</strong> of resection</li>\n<li>T4 lesions</li>\n<li>Bowel obstruction or perforation</li>\n<li>Presence of perineural or lymphovascular invasion</li>\n</ul>\n<p>Option C: <strong>FOLFOX</strong> is a chemotherapy regimen used for the treatment of colorectal cancer, made up of the drugs <strong>folinic acid</strong>, <strong>5-fluorouracil</strong>, and <strong>oxaliplatin.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a false statement regarding different types of artificial stoma?",
    "choices": [
      {
        "id": 1,
        "text": "Output from an ileostomy is liquid in nature"
      },
      {
        "id": 2,
        "text": "In Hartmann procedure, a loop colostomy is formed"
      },
      {
        "id": 3,
        "text": "Skin excoriation is the most common complication of ileostomy"
      },
      {
        "id": 4,
        "text": "Parastomal herniation is more common in Loop colostomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Colostomy formed during the Hartmann procedure is not a loop colostomy. It is an example of <strong>end-colostomy</strong>.</p>\n<p>Artificial stomas are surgically created openings on the abdominal wall following certain types of surgeries, to serve as an alternate path for internal organs to drain externally. <strong>Ileostomy</strong> and <strong>colostomy</strong> are the two most common types of artificial stomas for the GI system.</p>\n<table>\n<tbody>\n<tr>\n<td>Ileostomy</td>\n<td>Colostomy</td>\n</tr>\n<tr>\n<td>Any portion of the entire ileum can be chosen for stoma creation</td>\n<td>Only mobile parts of the colon (<strong>transverse colon</strong> and <strong>sigmoid colon</strong>) can be used</td>\n</tr>\n<tr>\n<td>Gross appearance - <strong>margin</strong> of the stoma is <strong>elevated</strong> (pouting) from the skin\u00a0</td>\n<td>Gross appearance - at the same level as that of skin</td>\n</tr>\n<tr>\n<td>The output is <strong>liquid</strong> in nature and therefore higher in volume</td>\n<td>The output is <strong>semi-solid or solid</strong> in nature</td>\n</tr>\n<tr>\n<td>Higher chance of skin excoriation and electrolyte imbalance</td>\n<td>Easier to handle</td>\n</tr>\n</tbody>\n</table>\n<p>Based on the structural pattern, stomas can be classified into different types:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">End stoma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Loop stoma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Double barrel stoma</li>\n</ul>\n<p>End stoma is preferred as a permanent stoma. Loop and double barrel stomas are used as temporary stomas.</p>\n<p>Complications of stoma include</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Skin excoriation</strong> (most common)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Stoma infection</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Diarrhea</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Stoma leakage</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Parastomal herniation</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1a30db51c9a43018c96653b260f4b21x1280x3145.JPEG"
    ]
  }
];
        let quizName = '24 Polyps And Colorectal Carcinoma';
        const quizFilename = '24-polyps-and-colorectal-carcinoma-1f4319d0.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>