<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>35 Renal Tubular Functions, Urine Concentration And Dilution - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Physiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">32</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is implied if a drug has more renal clearance than GFR?",
    "choices": [
      {
        "id": 1,
        "text": "Drug is reabsorbed by the renal tubules"
      },
      {
        "id": 2,
        "text": "Drug is secreted in the renal tubules"
      },
      {
        "id": 3,
        "text": "Drug is excreted in renal tubules"
      },
      {
        "id": 4,
        "text": "Drug is neither excreted nor reabsorbed in renal tubules"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>If drug has more renal clearance than GFR, then drug is secreted in renal tubules.&nbsp;</p>\n<p><strong>Excretion rate= (filtration rate- reabsorption rate)+ secretion rate.</strong></p>\n<p>The clearance of the substance:</p>\n<ul>\n<li>Equals the GFR if there is no net tubular secretion or reabsorption.</li>\n<li>Exceeds the GFR if there is net tubular secretion.</li>\n<li>Less than the GFR if there is net tubular reabsorption.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Choose the correct formula regarding renal physiology.",
    "choices": [
      {
        "id": 1,
        "text": "Filtration fraction   =     ( RPF / GFR ) * 100"
      },
      {
        "id": 2,
        "text": "Filtration rate           =    GFR * urine concentraion"
      },
      {
        "id": 3,
        "text": "Excretion rate           =     UxV"
      },
      {
        "id": 4,
        "text": "Clearance                   =     UP / V"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct formula is Excretion rate = UV.</p>\n<ol>\n<li>Filtration fraction = ( GFR / RPF ) * 100 = 20% (or ) 0.2 (approx)</li>\n<li style=\"font-weight: 400;\">Filtration rate = GFR * Plasma concentration</li>\n<li style=\"font-weight: 400;\">Clearance &nbsp;= U*V/P</li>\n</ol>\n<p>Where,</p>\n<p>GFR = Glomerular filtration rate</p>\n<p>RPF = Renal plasma flow</p>\n<p>U = Concentration of the substance in urine</p>\n<p>V = Urine flow rate</p>\n<p>P = Concentration of the substance in plasma</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Choose the correct option.",
    "choices": [
      {
        "id": 1,
        "text": "Inulin is completely secreted and never reabsorbed."
      },
      {
        "id": 2,
        "text": "Glucose is completely reabsorbed in DCT."
      },
      {
        "id": 3,
        "text": "Creatinine is partially secreted."
      },
      {
        "id": 4,
        "text": "PAH at any plasma concentration is completely filtered and secreted."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Creatinine is partially secreted and never reabsorbed.<strong>&nbsp;</strong>Clearance of creatinine (CCr) can also be used to determine GFR. Since creatinine is secreted by the tubules, the <strong>clearance of creatinine will be slightly</strong> higher than inulin.<span class=\"Apple-converted-space\">&nbsp;Hence, it <strong>overestimates GFR.&nbsp;</strong></span></p>\n<p><strong>Inulin</strong> is completely<strong> filtered</strong> and <strong>never reabsorbed.&nbsp;</strong>Hence, it can be used for <strong>GFR estimation.</strong>&nbsp;</p>\n<p><strong>Glucose</strong> is <strong>completely reabsorbed</strong> below the renal threshold (i.e ~180mg/dl) in <strong>PCT</strong>.&nbsp;</p>\n<p><strong>PAH(para amino hippuric acid)</strong> at <strong>low</strong> plasma concentrations is<strong> completely filtered</strong> and <strong>secreted.&nbsp;</strong>Hence, it can be used for estimation of <strong>renal blood flow.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Renal plasma flow is being calculated using PAH in a patient. The technician inadvertently uses PAH thrice the recommended dose. What will be the estimated effective renal plasma flow?",
    "choices": [
      {
        "id": 1,
        "text": "False high"
      },
      {
        "id": 2,
        "text": "False low"
      },
      {
        "id": 3,
        "text": "Both"
      },
      {
        "id": 4,
        "text": "Correct and is not affected"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Where,</p>\n<ul>\n<li>ERPF = Effective Renal Plasma Flow</li>\n<li>U<span style=\"font-size: 8pt;\">PAH</span> = [PAH] in urine</li>\n<li>V= Urine flow rate</li>\n<li>P<span style=\"font-size: 8pt;\">PAH</span> = [PAH] in plasma</li>\n<li><span style=\"font-size: 8pt;\"><span style=\"font-size: 10pt;\"><span style=\"font-size: 12pt;\">C</span></span>PAH =&nbsp;</span>Clearance of PAH</li>\n</ul>\n<div class=\"page\" title=\"Page 694\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>At high concentrations of PAH, as given in this question, tubular secretion attains saturation after which the clearance of PAH falls. Hence, a <strong>low ERPF</strong> will be seen.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9ec536f63ece4b9a99201b8be388c98dx403x141.PNG"
    ]
  },
  {
    "text": "Which of the following transporter is present in the ascending loop of Henle?",
    "choices": [
      {
        "id": 1,
        "text": "Na+ - Cl- co transporter"
      },
      {
        "id": 2,
        "text": "ENaC channel"
      },
      {
        "id": 3,
        "text": "Na+ - 2Cl- - K+ co transporter"
      },
      {
        "id": 4,
        "text": "Na+ - aminoacid co transporter"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Thick ascending limb of loop of Henle has Na<sup>+</sup> - 2Cl<sup>-</sup> - K<sup>+</sup> co transporter that cotransports one Na+, one K+, and 2Cl&ndash; from the tubular lumen into the tubu&shy;lar cells. This is an example of secondary active trans&shy;port.</p>\n<p><strong>Na+</strong> is transported out of the cell into the interstitium by <strong>Na, K ATPase</strong> in the basolateral membrane of the cell.</p>\n<p><strong>Cl&ndash;</strong> exits in <strong>basolateral ClC&ndash;Kb Cl&ndash; channels</strong>.&nbsp;<strong>Barttin,</strong> a protein in the cell membrane, is <strong>essential for normal ClC&ndash;Kb function.</strong></p>\n<p><strong>K+</strong> moves from the cell to the interstitium and the tubular lumen by <strong>ROMK</strong>(renal outer medullary potassium channel) and other K+ channels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9c334a180a4437484a343a7a862cc96x1280x1410.JPEG"
    ]
  },
  {
    "text": "The principal site of absorption of Na + is_____",
    "choices": [
      {
        "id": 1,
        "text": "Proximal convoluted tubule"
      },
      {
        "id": 2,
        "text": "Distal convoluted tubule"
      },
      {
        "id": 3,
        "text": "Thick ascending limb of Loop of Henle"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The principal site of absorption of Na + is PCT. About <strong>60-65% of filtered sodium is reabsorbed in the proximal convoluted tubule (PCT),</strong>&nbsp;coupled with the movement of H+, glucose, amino acids, organic acids, phosphate, and other electrolytes and substances.</p>\n<table style=\"width: 442.71875px;\">\n<tbody>\n<tr>\n<td style=\"width: 45px;\"><strong>% of filtered Na reabsorbed</strong></td>\n<td style=\"width: 163px;\"><strong>Part of nephron</strong></td>\n<td style=\"width: 220.71875px;\"><strong>Main transporter involved</strong></td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">60</td>\n<td style=\"width: 163px;\">PCT</td>\n<td style=\"width: 220.71875px;\">Na<sup>+</sup> &ndash;H<sup>+</sup> exchanger</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">30</td>\n<td style=\"width: 163px;\">Thick ascending limb of the loop of Henle</td>\n<td style=\"width: 220.71875px;\">Na<sup>+</sup> &ndash;2Cl<sup>-</sup>&ndash;K cotransporter</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">7</td>\n<td style=\"width: 163px;\">DCT</td>\n<td style=\"width: 220.71875px;\">Na&ndash;Cl cotransporter</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">3</td>\n<td style=\"width: 163px;\">Collecting ducts</td>\n<td style=\"width: 220.71875px;\">ENaC channels (regulated by aldosterone to permit homeostatic adjustments)</td>\n</tr>\n</tbody>\n</table>\n<p>All segments of nephron are involved in sodium reabsorption <strong>except thin descending loop of Henle.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35783f7c4b7f43e9a9a525c4acfe370ex1280x1670.JPEG"
    ]
  },
  {
    "text": "Potassium is maximally absorbed in____",
    "choices": [
      {
        "id": 1,
        "text": "PCT"
      },
      {
        "id": 2,
        "text": "DCT"
      },
      {
        "id": 3,
        "text": "Collecting duct"
      },
      {
        "id": 4,
        "text": "Loop of henle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Potassium is maximally absorbed in PCT.&nbsp;</p>\n<p>Potassium is freely filtered by the glomerulus. The bulk of filtered K<sup>+</sup> is reabsorbed in the proximal tubule. In the <strong>proximal tubule</strong>, K<sup>+</sup> absorption is primarily passive and proportional to Na<sup>+</sup> and water through <strong>paracellular transport</strong>.&nbsp;</p>\n<p>K<sup>+</sup> <strong>reabsorption</strong> in the thick ascending limb of Henle occurs through both transcellular (<strong>Na<sup>+</sup>- K<sup>+</sup>- 2Cl<sup>-&nbsp;</sup>cotransport</strong>)&nbsp;and paracellular pathways.</p>\n<p>K<sup>+</sup> <strong>secretion</strong> begins in the early distal convoluted tubule and progressively increases along the distal nephron into the cortical collecting duct . Most<strong> urinary K<sup>+</sup> can be accounted for by K<sup>+</sup> secretion mediated by principal cells</strong>. Under conditions of K<sup>+</sup> depletion, reabsorption of K<sup>+</sup> occurs in the collecting duct.&nbsp;</p>\n<p><strong>It is the only electrolyte to be reabsorbed as well as secreted.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d73788c6efc54361871276b838a79d50x600x758.JPEG"
    ]
  },
  {
    "text": "Bicarbonate is reabsorbed across the luminal membrane with the help of ______",
    "choices": [
      {
        "id": 1,
        "text": "Na+ - HCO3- antiport"
      },
      {
        "id": 2,
        "text": "Na+ - HCO3- Co transport"
      },
      {
        "id": 3,
        "text": "Na+ - H+ exchanger"
      },
      {
        "id": 4,
        "text": "Na+ - K+ exchanger"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Bicarbonate is reabsorbed at the <strong>luminal</strong> membrane&nbsp;in the form of <strong>CO<sub>2</sub> and H<sub>2</sub>O</strong> with the help of<strong> Na<sup>+</sup> - H<sup>+</sup> exchanger.</strong></p>\n<p>In the tubular cell of the PCT, CO<sub>2</sub> and H<sub>2</sub>O recombine with the help of carbonic anhydrase II, and then dissociate into H<sup>+</sup> and HCO<sub>3</sub><sup>-</sup>. From here, the H<sup>+</sup> moves back into the tubular lumen via the Na<sup>+</sup> - H<sup>+</sup> exchanger while the <strong>HCO<sub>3</sub><sup>-</sup></strong> is <strong>reabsorbed</strong> at the <strong>basolateral</strong> membrane via the <strong>Na<sup>+</sup> - HCO<sub>3</sub><sup>-</sup> co-transporter.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/149e260d9a854942bdb9af4074029daex1280x1517.JPEG"
    ]
  },
  {
    "text": "True about renal tubular transport_____",
    "choices": [
      {
        "id": 1,
        "text": "Maximum reabsorption in distal tubule"
      },
      {
        "id": 2,
        "text": "Urea is absorbed 100% in PCT"
      },
      {
        "id": 3,
        "text": "H+ is absorbed in proximal tubule"
      },
      {
        "id": 4,
        "text": "Amino acid is reabsorbed in proximal tubule"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Glucose and amino acids are completely reabsorbed in the proximal tubule.</p>\n<p>Option A: Maximum reabsorption occurs in proximal tubule</p>\n<p>Option B: Urea is reabsorbed and secreted. It is reabsorbed in PCT and in collecting duct. It is secreted in thin ascending loop of henle.</p>\n<p>Option C: H<sup>+&nbsp;</sup>is secreted in PCT as well as in collecting ducts.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/af72c18060f747c99d95c30dde2e31ebx1280x1670.JPEG"
    ]
  },
  {
    "text": "Which of the following occurs along with glucose transport into the cell?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium symport"
      },
      {
        "id": 2,
        "text": "Calcium antiport"
      },
      {
        "id": 3,
        "text": "Potassium transport"
      },
      {
        "id": 4,
        "text": "Amino acid antiport"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Sodium symport occurs along with glucose transport into the cell.</p>\n<p>Sodium and glucose are co-transported across the luminal membrane of proximal tubular cells<strong>.</strong>&nbsp;This occurs via<strong> sodium glucose co-transporters (SGLT2 and SGLT1)</strong>. The energy derived from the movement of Na<sup>+</sup> is used to move glucose against its concentration gradient into the tubular cell. This is referred to as <strong>secondary active transport</strong>.&nbsp;</p>\n<p>The Na<sup>+</sup> is then pumped out of the cell into the interstitium, and the <strong>glucose exits by facilitated diffusion</strong> via <strong>glucose transporter (GLUT)-2</strong>&nbsp;along the basolateral membrane into the interstitial fluid.</p>\n<p><strong>Clinical correlation:</strong></p>\n<p>Fanconi-Bickel syndrome: Defective GLUT2</p>\n<p>Isolated renal glycosuria: Defective SGLT2</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa5f369ca1624611a61ff70f0ae54506x1280x1464.JPEG"
    ]
  },
  {
    "text": "Normal renal threshold (g/L) and transport maxima (mg/min)  for glucose respectively are _______, _________",
    "choices": [
      {
        "id": 1,
        "text": "200, 375"
      },
      {
        "id": 2,
        "text": "375, 200"
      },
      {
        "id": 3,
        "text": "2, 375"
      },
      {
        "id": 4,
        "text": "375, 2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The actual renal threshold is about 200 mg/dL (i.e., <strong>2 g/L</strong> ) (1g/L=100mg/dl) and the transport maximum for glucose is <strong>375 mg/min.</strong></p>\n<p>For substances that are actively reabsorbed&nbsp;or secreted, there is a <strong>limit to the rate at which the&nbsp;solute can be transported</strong>, which is referred to as&nbsp;the <strong>transport maximum</strong>. This limit is due to <strong>saturation</strong> of&nbsp;the specific <strong>transport systems</strong> involved.&nbsp;</p>\n<p>Normally, measurable glucose does not&nbsp;appear in the urine because essentially all the filtered&nbsp;glucose is reabsorbed in the proximal tubule<strong>.</strong></p>\n<p>The transport maximum for&nbsp;glucose is about 375 mg/min, whereas the filtered&nbsp;load of glucose is only about 125 mg/min. With large increases&nbsp;in GFR and/or plasma glucose concentration that&nbsp;increase the filtered load of glucose above 375 mg/min,&nbsp;the excess glucose filtered is not reabsorbed and passes&nbsp;into the urine.</p>\n<p>When the plasma glucose concentration&nbsp;is 100 mg/100 ml and the filtered load is at its&nbsp;normal level (125 mg/min) there is no loss of glucose in&nbsp;the urine. However, when the <strong>plasma concentration of&nbsp;glucose rises above about 200 mg/100 ml</strong>, increasing&nbsp;the filtered load to about 250 mg/min, a small amount&nbsp;of <strong>glucose begins to appear in the urine. </strong>This point is&nbsp;termed as the <strong>threshold</strong> for glucose.</p>\n<p><strong>Splay</strong> is due to separation between filtered load and exceretion. It occurs due to<strong> different transport maximums of different nephrons</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4730bbf78c6349ef873c596192b78e15x1280x1735.JPEG"
    ]
  },
  {
    "text": "The image of PAH excretion is depicted below. Match the labellings.",
    "choices": [
      {
        "id": 1,
        "text": "a. Filtered, b. Excreted, c. Tm, d. Secreted"
      },
      {
        "id": 2,
        "text": "a. Filtered, b. Secreted, c. Tm, d. Excreted"
      },
      {
        "id": 3,
        "text": "a. Secreted, b. Filtered, c. Tm, d. Excreted"
      },
      {
        "id": 4,
        "text": "a. Excreted, b. Filtered, c. Tm, d. Secreted"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The labellings depticed are a. Filtered, b. Secreted, c. Tm, d. Excreted</p>\n<p><strong>Filtered Load</strong>:&nbsp;The filtered load of PAH increases <strong>linearly</strong> as the&nbsp;unbound <strong>concentration of PAH increases</strong> (filtered&nbsp;load = GFR. &nbsp;[P]PAH).</p>\n<p><strong>Secretion</strong>:&nbsp;At low concentrations&nbsp;of PAH, many carriers are available and secretion&nbsp;increases linearly as the plasma concentration&nbsp;increases. When the PAH concentration increases to&nbsp;a level where the <strong>carriers are saturated, Tm is&nbsp;reached</strong>. After this point, no matter how much the&nbsp;PAH concentration increases, there can be no further&nbsp;increase in the secretion rate.</p>\n<p><strong>Excretion</strong>. For a secreted substance such as PAH,&nbsp;<strong>excretion is the sum of filtration and secretion</strong>.&nbsp;At low PAH concentrations (below Tm), excretion&nbsp;increases steeply with increases in plasma PAH concentration&nbsp;because both filtration and secretion are&nbsp;increasing. At PAH concentrations above Tm,<strong> excretion&nbsp;increases less steeply (and parallels the curve&nbsp;for filtration)</strong> because only the filtration component&nbsp;increases as concentration increases; <strong>secretion is&nbsp;already saturated.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8ba11beaacc54612b265c5a9c9d0fbed.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In a patient with uncontrolled diabetes, what is the value of plasma clearance of glucose?",
    "choices": [
      {
        "id": 1,
        "text": "Zero"
      },
      {
        "id": 2,
        "text": "Equal to inulin clearance"
      },
      {
        "id": 3,
        "text": "Greater than PAH clearance"
      },
      {
        "id": 4,
        "text": "Greater than zero"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above graph depicts renal handling of glucose, inulin, and para-aminohippurate (PAH) and can be explained as follows:</p>\n<p>Glucose clearance: Normally, all the glucose that is filtered is reabsorbed and no glucose is excreted in the urine. Hence, the clearance is zero.&nbsp;In uncontrolled diabetes, since the <strong>plasma glucose concentration</strong> is <strong>greater</strong> than the <strong>renal threshold for reabsorption</strong>, excess glucose is excreted in the urine and the clearance is greater than zero.</p>\n<p>Inulin clearance:&nbsp;Inulin is freely filtered and is neither reabsorbed nor secreted. Hence, it is <strong>constant and equal to the glomerular filtration rate</strong>.</p>\n<p>PAH clearance:&nbsp;PAH is both filtered and secreted. When <strong>plasma PAH is low</strong>, <strong>clearance is high</strong>. However, as <strong>plasma PAH rises</strong> above the threshold level for PAH secretion, <strong>clearance falls</strong> progressively.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7030b4fe87de418c9e303664c0f063f0x1020x1026.JPEG"
    ]
  },
  {
    "text": "A patient has a \u200bblood glucose level of 200 mg/dL and GFR of 90 ml/min. What is the amount of glucose excreted if the transport maximum of the patient is as shown below?",
    "choices": [
      {
        "id": 1,
        "text": "80 mg/min"
      },
      {
        "id": 2,
        "text": "50 mg/min"
      },
      {
        "id": 3,
        "text": "40 mg/min"
      },
      {
        "id": 4,
        "text": "30 mg/min"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The amount of glucose excreted in the above scenario is 30 mg/min.</p>\n<p><strong>Calculation:</strong></p>\n<p><strong>Step 1:</strong> <strong>Calculate total filtered glucose:</strong></p>\n<p>In this question,</p>\n<ul>\n<li>GFR = 90 ml/min</li>\n<li>Plasma glucose concentration = 200 mg/dL= 2 mg/ml (1 dL=100 ml).</li>\n<li><strong>Total filtered glucose = GFR X Plasma glucose concentration</strong>.</li>\n</ul>\n<p style=\"padding-left: 60px;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 90 ml/min X 2 mg/ml<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 180 mg/min.</p>\n<p><strong>Step 2:</strong> <strong>Check transport maximum: </strong></p>\n<p>In the above question transport maximum is 150 mg/min.</p>\n<p><strong>Step 3: Calculate the excretion:</strong></p>\n<p>Excretion = Total filtered glucose - Total reabsorbed glucose (Transport Maximum)</p>\n<p style=\"padding-left: 60px;\">&nbsp; = 180-150 mg/min<br />&nbsp; = 30 mg/min</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/500e1da504d94d398ff2bf10eaabe8eb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the correct statement regarding the concentration of solutes at the end of  proximal convoluted tubule",
    "choices": [
      {
        "id": 1,
        "text": "Concentration of glucose in tubular fluid is more than that of plasma"
      },
      {
        "id": 2,
        "text": "Concentration of urea  in tubular fluid is more than that of plasma"
      },
      {
        "id": 3,
        "text": "Concentration of bicarbonate in tubular fluid is more than that of plasma"
      },
      {
        "id": 4,
        "text": "Concentration of sodium in tubular fluid is less than that of plasma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>[TF/P]&gt;1, when solute is reabsorbed less quickly than water or when <strong>solute is secreted.&nbsp;</strong>Ex- PAH, Creatinine, Inulin, Urea.</p>\n<p>[TF/P]=1, when <strong>solute and water are reabsorbed at the same rate&nbsp;</strong>Ex - Na.</p>\n<p>[TF/P]&lt;1, when <strong>solute is reabsorbed</strong> more quickly than water. Ex- glucose, amino acid, bicarbonate.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d2118c403a9c424bb4ffe14d53733d7bx1280x1742.JPEG"
    ]
  },
  {
    "text": "The mechanism by which majority of water is reabsorbed in PCT is",
    "choices": [
      {
        "id": 1,
        "text": "Active"
      },
      {
        "id": 2,
        "text": "Secondary active"
      },
      {
        "id": 3,
        "text": "Facilitated"
      },
      {
        "id": 4,
        "text": "Osmosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Water reabsorption in PCT mainly occurs by osmosis.</p>\n<p>The proximal tubule reabsorbs 67% of the filtered water.&nbsp;The driving force for water reabsorption is a transtubular osmotic gradient established by reabsorption of solutes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A dehydrated patient is excreting hypertonic urine. Absorption of water in which part of the nephron causes this?",
    "choices": [
      {
        "id": 1,
        "text": "Collecting duct"
      },
      {
        "id": 2,
        "text": "PCT"
      },
      {
        "id": 3,
        "text": "Ascending loop"
      },
      {
        "id": 4,
        "text": "Descending loop"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hypertonic urine</strong> is excreted due to <strong>absorption</strong> of water in <strong>collecting duct.</strong></p>\n<p>The <strong>final concentration of urine</strong> is determined by the <strong>amount of water reabsorption that occurs in the collecting ducts.&nbsp;</strong>The changes in osmolarity of the urine (hypo/hypertonic) <strong>depends on the amount of ADH (vasopressin) acting on the collecting ducts.</strong></p>\n<p>The basic requirements for forming a concentrated urine (hypertonic urine) are</p>\n<ul>\n<li><strong>A high level of ADH</strong><em>, </em>which increases the permeability of the <strong>distal tubules and collecting ducts</strong> to water, thereby allowing these tubular segments to avidly <strong>reabsorb water.</strong></li>\n<li><strong>A high osmolarity of the renal medullary</strong><strong> interstitial fluid,</strong> which provides the <strong>osmotic gradient necessary for water reabsorption</strong> to occur in the presence of high levels of ADH.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with diabetes insipidus is prescribed vasopressin. This drug has its maximum effect on which part of the renal tubule?",
    "choices": [
      {
        "id": 1,
        "text": "Proximal tubule"
      },
      {
        "id": 2,
        "text": "Distal tubule"
      },
      {
        "id": 3,
        "text": "Loop of henle"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Vasopressin</strong> has the&nbsp;<strong>maximum effect</strong> on the <strong>collecting ducts.</strong></p>\n<p>Vasopressin acts by inserting<strong> aquaporin 2</strong> present in cytoplasmic vesicles of <strong>principal cells on to the apical membrane</strong>.&nbsp;The effect is mediated via the vasopressin V2 receptor, cyclic adenosine 5-monophosphate (cAMP), and protein kinase A.&nbsp;When <strong>vasopressin is absent</strong>, the <strong>collecting duct</strong> epithelium is relatively <strong>impermeable to water.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e1c236e761442979c2e69cecee49c5fx1280x1780.JPEG"
    ]
  },
  {
    "text": "Which of the following is true about free water clearance?",
    "choices": [
      {
        "id": 1,
        "text": "Regulated by ADH"
      },
      {
        "id": 2,
        "text": "Regulated by aldosterone"
      },
      {
        "id": 3,
        "text": "Unaffected by furosemide"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Free water clearance is regulated by ADH.</p>\n<p>Free water clearance is defined as the amount of <strong>solute-free water</strong> generated by the kidneys, either when dilute urine or when concentrated urine is formed.</p>\n<p>Free-water clearance is <strong>positive</strong>, when <strong>excess water is being&nbsp;excreted</strong>&nbsp;(<strong>dilute urine</strong>).</p>\n<p>Free-water clearance is <strong>negative,</strong> when&nbsp;excess solutes are being removed and <strong>water is being conserved&nbsp;</strong>(<strong>concentrated urine</strong>).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following picture shows the composition of solute in the urine and plasma sample of 3 patients. Identify the true statement.",
    "choices": [
      {
        "id": 1,
        "text": "A shows negative free water clearance, B is isotonic, C is positive free water clearance"
      },
      {
        "id": 2,
        "text": "A shows positive free water clearance B is isotonic C is positive free water clearance"
      },
      {
        "id": 3,
        "text": "A shows positive free water clearance B is isotonic C is negative free water clearance"
      },
      {
        "id": 4,
        "text": "A shows negative free water clearance B is isotonic C is negative free water clearance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Patient A shows positive free water clearance B is isotonic C shows negative free water clearance.</p>\n<p>Free water clearance is defined as the amount of <strong>solute-free water</strong> generated by the kidneys, either when dilute urine or when concentrated urine is formed.</p>\n<p>Patient A has positive free-water clearance, since&nbsp;<strong>excess water is being&nbsp;excreted</strong>&nbsp;(<strong>dilute urine</strong>).</p>\n<p>Patient C has negative free-water clearance, since&nbsp;excess solutes are being removed and <strong>water is being conserved&nbsp;</strong>(<strong>concentrated urine</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/542e02d2f2ad4c88ac6eb507cee7430c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "All are true except that ____.",
    "choices": [
      {
        "id": 1,
        "text": "PCT is permeable to water"
      },
      {
        "id": 2,
        "text": "Descending limb of loop of henle is permeable to water"
      },
      {
        "id": 3,
        "text": "Thick ascending limb is permeable to water"
      },
      {
        "id": 4,
        "text": "Distal tubule is permeable to water"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ascending limb is always impermeable to H<sub>2</sub>O.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The average urine osmolality in mosm/kg is _____.",
    "choices": [
      {
        "id": 1,
        "text": "100-800"
      },
      {
        "id": 2,
        "text": "500-1400"
      },
      {
        "id": 3,
        "text": "200-400"
      },
      {
        "id": 4,
        "text": "50-1400"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The average urine osmolality is 100-800&nbsp;mosm/kg.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What are the requirements for a patient to excrete concentrated urine?",
    "choices": [
      {
        "id": 1,
        "text": "High ADH levels and hypoosmolar renal medulla"
      },
      {
        "id": 2,
        "text": "Low ADH levels and hypoosmolar renal medulla"
      },
      {
        "id": 3,
        "text": "High ADH levels and hyperosmolar renal medulla"
      },
      {
        "id": 4,
        "text": "Low ADH levels and hyperosmolar renal medulla"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The requirements for excreting concentrated urine are high ADH levels and hyperosmolar renal medulla.&nbsp;</p>\n<p>A <strong>high level of ADH</strong>, which increases the permeability&nbsp;of the <strong>distal tubules and collecting ducts</strong> to water,&nbsp;thereby allowing these tubular segments to avidly <strong>reabsorb&nbsp;water</strong>, and a <strong>high osmolarity of the renal medullary</strong>&nbsp;interstitial fluid, which provides the<strong> osmotic gradient&nbsp;</strong>necessary for <strong>water reabsorption </strong>to occur in the presence&nbsp;of high levels of ADH.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Maximum osmotic gradient is found in____",
    "choices": [
      {
        "id": 1,
        "text": "Outer medulla"
      },
      {
        "id": 2,
        "text": "Inner medulla"
      },
      {
        "id": 3,
        "text": "Outer cortex"
      },
      {
        "id": 4,
        "text": "Inner cortex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Maximum osmotic gradient is found in the inner medulla.&nbsp;The gradient of osmolarity from the cortex (300 mosm/L) to the inner medulla (1200 mosm/L) is <strong>produced by the loops of Henle as countercurrent multipliers </strong>and<strong> maintained by operation of the vasa recta as countercurrent exchangers.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hyperosmolarity of renal medulla is due to____",
    "choices": [
      {
        "id": 1,
        "text": "K+"
      },
      {
        "id": 2,
        "text": "Na+"
      },
      {
        "id": 3,
        "text": "Glucose"
      },
      {
        "id": 4,
        "text": "H+"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Hyperosmolarity of the medullary interstitium is mainly due to NaCl and urea.</p>\n<p>The major factors that contribute to the buildup of solute concentration into the renal medulla are&nbsp;</p>\n<ul>\n<li><strong>Active transport of Na<sup>+ </sup>and co-transport of K<sup>+</sup>, Cl<sup>-</sup></strong>, and other ions out of the <strong>thick portion of the ascending limb of the loop of Henle into the medullary interstitium.</strong></li>\n<li>Active transport of ions from the <strong>collecting ducts into the medullary interstitium.</strong></li>\n<li><strong>Facilitated diffusion of urea</strong> from the <strong>inner medullary collecting ducts</strong> into the medullary interstitium.</li>\n<li>Diffusion of only small amounts of water from the&nbsp;<strong>medullary tubules</strong> into the medullary interstitium</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b703ef23a0f432b967fa05869097c1dx1280x1806.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a component of the countercurrent mechanism?",
    "choices": [
      {
        "id": 1,
        "text": "Thick ascending loop of Henle"
      },
      {
        "id": 2,
        "text": "Proximal convoluted tubule"
      },
      {
        "id": 3,
        "text": "Vasa recta"
      },
      {
        "id": 4,
        "text": "Descending limb of loop of Henle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Proximal convoluted tubule (PCT) does not play a role in countercurrent mechanism.</p>\n<p>The countercurrent mechanism consists of 2 components:&nbsp;</p>\n<ol>\n<li>Countercurrent multiplier:&nbsp;<br />&nbsp; &nbsp; a. Absorption of water via <strong>Aquaporin 1</strong> in <strong>thin descending limb&nbsp;</strong><strong><br />&nbsp; &nbsp;&nbsp;</strong>b. Active transport of<strong> Na<sup>+</sup>- K<sup>+</sup>- 2Cl<sup>-</sup></strong> in <strong>thick ascending limb<br /></strong>&nbsp; &nbsp; c. <strong>Flow of fluid</strong> from PCT to DCT<br />&nbsp; &nbsp;</li>\n<li>Countercurrent exchanger: <strong>Vasa recta&nbsp;</strong>are involved in this process. They help in maintaining the osmotic gradient in the renal medulla. This is a passive process.&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d27f85e7708a483195a6ae51b43d8effx1280x1806.JPEG"
    ]
  },
  {
    "text": "Maximum osmolality that can be reached at the tip of medulla is proportional to",
    "choices": [
      {
        "id": 1,
        "text": "Distribution of Na-K-2Cl channel in the thick ascending loop of Henle"
      },
      {
        "id": 2,
        "text": "Permeability of descending loop to water"
      },
      {
        "id": 3,
        "text": "Length of loop of Henle"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The maximum osmolality that can be reached at the tip of the medulla is proportional to the length of the loop of Henle, because the Loop of Henle acts as Countercurrent multiplier to maitain the gradient in medulla.&nbsp;<strong>Greater is the length</strong> of loop of Henle, <strong>greater will be the osmolality</strong> that can be reached at the tip of the medulla.&nbsp;</p>\n<p>In case of <strong>juxtamedullary nephrons with longer loops</strong> and thin ascending limbs, the osmotic gradient is spread over a greater distance and the <strong>osmolality at the tip of the loop is greater.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Counter current blood flow is seen in all except_____",
    "choices": [
      {
        "id": 1,
        "text": "Kidney"
      },
      {
        "id": 2,
        "text": "Testes"
      },
      {
        "id": 3,
        "text": "Eye"
      },
      {
        "id": 4,
        "text": "Small intestine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The eye does not have a countercurrent blood flow system.</p>\n<p>Heat and substances, including gases, steroids and peptide hormones, can pass from venous blood, interstitial fluid and lymph to the arterial blood; the process is called local counter-current transfer.</p>\n<p><strong>Examples of countercurrent blood flow</strong></p>\n<ul>\n<li>Heat exchange between the arteries and venae comitantes of the limbs.</li>\n<li>Vasa recta in the kidneys</li>\n<li>Testes</li>\n<li>Small intestine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are components responsible for the countercurrent mechanism in the kidney except _____.",
    "choices": [
      {
        "id": 1,
        "text": "Sodium outflow in thick ascending limb"
      },
      {
        "id": 2,
        "text": "Water outflow in thin descending limb"
      },
      {
        "id": 3,
        "text": "Sodium outflow in thin ascending limb"
      },
      {
        "id": 4,
        "text": "Flow of tubular fluid from PCT to DCT"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Thin ascending limb is not a component of the countercurrent mechanism.&nbsp;</p>\n<p>The <strong>loop of Henle</strong> function as <strong>countercurrent multipliers</strong> and <strong>vasa recta</strong> as <strong>countercurrent exchangers.</strong></p>\n<p>The functioning of the loop of Henle depends upon:</p>\n<ol>\n<li>High permeability of the thin descending limb to water ( via aquaporin-1)</li>\n<li>Active transport of Na<sup>+</sup> and Cl<sup>-</sup> from the thick ascending limb</li>\n<li>Inflow of tubular fluid from proximal tubule and outflow to the distal tubule.</li>\n</ol>\n<p><strong>Note:</strong> The thin ascending limbs of juxtamedullary nephrons are permeable to Na<sup>+</sup> and Cl<sup>-</sup> and hence do contribute passively to countercurrent multiplication. However, among the options provided, Option C is the best answer as the other options are directly responsible for the countercurrent mechanism.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the diluting segment of the kidney?",
    "choices": [
      {
        "id": 1,
        "text": "PCT"
      },
      {
        "id": 2,
        "text": "Collecting duct"
      },
      {
        "id": 3,
        "text": "Ascending thick loop of Henle"
      },
      {
        "id": 4,
        "text": "Descending loop of Henle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ascending thick limb of the&nbsp;loop of Henle is called the <strong>diluting segment.</strong></p>\n<p>In the ascending limb, there is the <strong>movement of Na+ and Cl&ndash; out of the tubular lumen</strong>, and the tubular fluid becomes <strong>more dilute.</strong></p>\n<p>When the fluid reaches the top of the ascending limb, it becomes <strong>hypotonic </strong>to plasma.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As filtrate flows through PCT,  the concentration of all of the following decreases except:",
    "choices": [
      {
        "id": 1,
        "text": "Aminoacid"
      },
      {
        "id": 2,
        "text": "Glucose"
      },
      {
        "id": 3,
        "text": "Chloride"
      },
      {
        "id": 4,
        "text": "Bicarbonate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>As the filtrate flows through the proximal convoluted tubule, the <strong>concentration of the chloride increases.</strong></p>\n<ul>\n<li>The concentration of <strong>chloride</strong> in the <strong>early part</strong> of the <strong>pCT is \u2248105 mEq/L.</strong></li>\n<li>As the sodium is reabsorbed, it preferentially carries <strong>glucose, amino acids,</strong> and <strong>bicarbonate.</strong></li>\n<li>This leaves behind the solute, that has a higher concentration of the <strong>chloride,</strong> which as it reaches the second half of the PCT is<strong> \u2248140 mEq/L.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Macula densa is formed by which part of the nephron?",
    "choices": [
      {
        "id": 1,
        "text": "PCT"
      },
      {
        "id": 2,
        "text": "DCT"
      },
      {
        "id": 3,
        "text": "Afferent arteriole"
      },
      {
        "id": 4,
        "text": "Bowman's capsule"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The juxtaglomerular apparatus consists of the following parts:</p>\n<ul>\n<li><strong>Macula densa:</strong> At the end of the thick ascending limb of Henle, and at the beginning of the distal tubule, the tubular epithelial cells are specialized to form the macula densa. They detect sodium concentration of the fluid in the tubule<strong> (chemoreceptor). </strong>In response to <strong>elevated sodium</strong>, the macula densa cells trigger<strong>&nbsp;</strong>the<strong> contraction of the afferent arteriole</strong>, <strong>reducing</strong>&nbsp;the flow of blood to the glomerulus and the <strong>glomerular filtration rate</strong>. This happens as follows: When there is increased sodium, there is increased <strong>sodium-potassium ATPase activity which</strong>&nbsp;leads to increased <strong>ATP hydrolysis</strong> causing more <strong>adenosine</strong> formation. The adenosine receptors on the macula densa cells stimulate it to release<strong> more calcium</strong>, so that there is vasoconstriction of the afferent arteriole, thereby decreasing the <strong>GFR.</strong></li>\n<li>Lacis cells:<strong> Extraglomerular mesangial cells</strong> situated between afferent and efferent arteriole.</li>\n<li>Granular cells/JG cells:&nbsp;Modified <strong>smooth muscle cells of the afferent arteriole, </strong>they secrete renin.&nbsp;<strong>Fall in pressure</strong> in afferent arteriole stimulates renin release <strong>(mechanoreceptor)</strong>, which, in turn, <strong>increases blood pressure.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5461ebba66b64151ba826ae7f04b9317x1280x1384.JPEG"
    ]
  }
];
        let quizName = '35 Renal Tubular Functions, Urine Concentration And Dilution';
        const quizFilename = '35-renal-tubular-functions-urine-concentration-and-dilution-a3c24659.html';
        let hierarchy = ["Marrow", "qBank", "Physiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>