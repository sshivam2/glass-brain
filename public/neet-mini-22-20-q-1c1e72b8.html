<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet Mini - 22 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 50-year-old male presented with a history of epigastric pain, vomiting and peripheral edema. He also gave a history of involuntary weight loss in the last 2 months. On investigation, his serum protein level was found to be low. An endoscopy was done, and an image obtained when the scope was in the stomach is shown below. The gastric aspirate showed a decrease in the acid content of the stomach. Which part of the stomach is usually spared in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Antrum"
      },
      {
        "id": 2,
        "text": "Fundus"
      },
      {
        "id": 3,
        "text": "Body"
      },
      {
        "id": 4,
        "text": "Cardia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a 50-year-old male who presented with <strong>epigastric pain, vomiting, peripheral edema,</strong>\u00a0<strong>involuntary weight loss</strong> and <strong>hypoproteinemia</strong> with a decreased acid content of the stomach (<strong>hypochlorhydria)</strong> and endoscopy showing <strong>hypertrophied gastric mucosal folds</strong> is suggestive of <strong>M\u00e9n\u00e9trier disease</strong> which usually spares the <strong>antrum</strong> of the stomach.</p>\n<p><strong>Menetrier</strong> <strong>disease, </strong>also called<strong>\u00a0hyperplastic hypersecretory gastropathy\u00a0</strong>is a disorder of the stomach characterized by <strong>enlarged rugae</strong> (gastric folds). It is common in <strong>men</strong> and the age of onset is usually between 40-60 years. In children, it is usually associated with <strong>cytomegalovirus infection</strong> and in adults the aetiology is unknown.</p>\n<p>Clinical features include <strong>epigastric pain,</strong> nausea, <strong>vomiting,</strong> anorexia, <strong>peripheral edema,</strong> and <strong>weight loss.</strong> <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">It occurs due to <strong>excessive secretion</strong> of </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">transforming growth factor (TGF)-\u03b1,</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> which stimulates the epidermal growth factor receptor <strong>(EGFR) pathway,</strong> resulting in increased proliferation of <strong>mucus cells/foveolar hyperplasia</strong> within the body and fundus, causing enlarged gastric folds. The <strong>antrum is usually spared.\u00a0</strong></span></p>\n<p>There is excessive production of <strong>mucous</strong> in the stomach which results in increased loss of proteins <strong>(hypoproteinemia),</strong> and a decreased number of parietal cells and oxyntic glands leads to <strong>hypochlorhydria.</strong> They are at an increased risk of developing <strong>gastric carcinoma.</strong></p>\n<p>Histopathologic examination of the stomach shows hyperplasia of foveolar mucous cells, <strong>cystically dilated glands</strong> that are elongated\u00a0(with a <strong>corkscrew-like appearance)</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7a3503d2b0a54954b6e3c3b1fe26064d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4860366c504447dfa0b85302a5bd5a21x510x802.GIF"
    ]
  },
  {
    "text": "A male patient presents to your clinic with complaints of a large lesion on the back and left shoulder. There is no pain or itching associated with the lesion. On examination, there is a 15x20 cm hyperpigmented patch with irregular borders over the left shoulder and back, with hair growth over the lesion. The image of the physical examination findings is shown below. When is the onset of the lesion most likely to occur?",
    "choices": [
      {
        "id": 1,
        "text": "4th decade"
      },
      {
        "id": 2,
        "text": "6th decade"
      },
      {
        "id": 3,
        "text": "Infancy"
      },
      {
        "id": 4,
        "text": "Puberty"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given stem and image show <strong>Becker's Naevus, </strong>the onset of which is usually in <strong>puberty.</strong></p>\n<p>Becker's naevus is an <strong>epidermal melanocytic naevus</strong> with aggregation of melanocyte clusters in the epidermis beginning in<strong>\u00a0adolescence</strong> when there is an <strong>increased sensitivity to androgens</strong> especially in the distribution of outer arms, scapular area and chest. It is rarely congenital. A triad of features can be seen:</p>\n<ul>\n<li><strong> Hyperpigmentation</strong></li>\n<li><strong>Hypertrichosis</strong></li>\n<li><strong>Acne</strong></li>\n</ul>\n<p>Becker naevus can also be associated with extracutaneous abnormalities such as aplasia or hypoplasia of the underlying breast tissue, or pectoralis major muscle or lipoatrophy. In such cases, it is referred to as Becker naevus Syndrome. Other extracutaneous associations include ipsilateral limb growth disturbance, supernumer\u00adary nipples, and scoliosis.</p>\n<p>\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6c20f0259b74442e949ec18e806f85e3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You read an article on a protective reflex that occurs during over-inflation of the lungs. Choose the true statement regarding the reflex.",
    "choices": [
      {
        "id": 1,
        "text": "Occurs when the tidal volume reaches 1500 mL"
      },
      {
        "id": 2,
        "text": "Mediated by rapidly adapting myelinated vagal fibres"
      },
      {
        "id": 3,
        "text": "Decreases the rate of respiration"
      },
      {
        "id": 4,
        "text": "Plays a major role in regulating normal respiration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The protective reflex that occurs in response to over inflation of the lung is the <strong>Hering-Breuer reflex</strong>.\u00a0It is activated when the lung volume increases to more than <strong>three times the normal tidal volume</strong> (tidal volume = 0.5 liters/breath; So, lung volume <strong>&gt; 1.5 liters</strong> per breath activates the reflex).</p>\n<p>Hering-Breuer inflation reflex means <strong>prolonged inspiration</strong> <strong>inhibits</strong> further <strong>inspiration</strong>. Overinflation of the lung activates the pulmonary stretch receptors. Signals from these receptors travel through the vagus nerve and inhibit the inspiratory ramp signals in <strong>dorsal respiratory group of neurons. </strong>This also increases the respiratory rate. It is a protective mechanism and prevents over inflation of the lungs.</p>\n<p><strong>Hering-Breuer inflation reflex</strong>: \"Prolonged inspiration inhibits further inspiration\"</p>\n<p>Hyperinflation of lungs stimulates<strong>\u00a0slowly adapting pulmonary stretch receptors</strong> and the impulses travel in the vagus nerve via <strong>large myelinated fibers.</strong></p>\n<p>This signal <strong>inhibits</strong> the <strong>inspiratory ramp signals</strong> of the <strong>dorsal respiratory group of neurons</strong> (DRG), thus, inspiration is quickly inhibited and expiration follows.</p>\n<p>It also <strong>increases the rate</strong> of respiration.</p>\n<p>The Hering-Breuer reflex is activated when the lung volume increases to more than three times the normal tidal volume (tidal volume = 0.5 liters/breath; So, lung volume <strong>&gt; 1.5 liters</strong> per breath activates the reflex).</p>\n<p>It signifies that the reflex plays a <strong>protective\u00a0role preventing the overinflation of the lung</strong> rather than regulating the normal ventilation.\u00a0</p>\n<p>Advantages of Hering-Breuer inflation reflex: It cuts down the inspiration time, and therefore,</p>\n<ul>\n<li>It prevents overinflation of the lungs.</li>\n<li>Lungs operate at lower lung volumes, thereby preventing wastage of energy.</li>\n</ul>\n<p><strong>Hering-Breuer deflation reflex</strong>- A decrease in the duration of expiration in response to marked deflation of the lung.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A professor demonstrates the following reflex on a healthy newborn.  Match the correct pairs regarding this reflex.",
    "choices": [
      {
        "id": 1,
        "text": "1-c, 2-d, 3-b, 4-a"
      },
      {
        "id": 2,
        "text": "1-d, 2-c, 3-b, 4-a"
      },
      {
        "id": 3,
        "text": "1-c, 2-a, 3-b, 4-d"
      },
      {
        "id": 4,
        "text": "1-a, 2-c, 3-b, 4-d"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The reflex shown in the image is<strong> Moro reflex. Option C </strong>is correctly matched.</p>\n<ol>\n<li>Stage I HIE - Brisk Moro reflex</li>\n<li>Stage III HIE - Absent\u00a0moro reflex</li>\n<li>Erb's palsy - Asymmetric Moro reflex</li>\n<li>Hydranencephaly - Exaggerated Moro reflex</li>\n</ol>\n<p>The above-animated GIF shows a\u00a0<strong>normal response</strong> to Moro's reflex: <strong>symmetrical extension</strong> and <strong>abduction of the upper extremities</strong>, followed by <strong>flexion of the upper extremities</strong>.</p>\n<p>\u00a0<strong>The Moro reflex:</strong></p>\n<ul>\n<li>It is a primitive reflex that is very sensitive to the infant's level of alertness.</li>\n<li>It can be elicited by supporting the infant in the semierect position and allowing the infant\u2019s head to fall backward onto the examiner\u2019s hand.</li>\n</ul>\n<p><strong>Absent\u00a0</strong>Moro reflex: caused by significant generalized disturbance of the CNS</p>\n<ul>\n<li>Stage III HIE (Hypoxic ischemic encephalopathy)</li>\n<li>Kernicterus</li>\n</ul>\n<p><strong>Asymmetric\u00a0</strong>Moro reflex:\u00a0Feature of the root, plexus, or nerve disease</p>\n<ul>\n<li>Fractured clavicle</li>\n<li>Brachial plexus injury (Erb's palsy)</li>\n<li>Hemiparesis</li>\n</ul>\n<p><strong>Brisk</strong>\u00a0Moro reflex<strong>\u00a0</strong></p>\n<ul>\n<li>Neonatal hypoglycemia</li>\n<li>It can also be a normal variant in healthy infants</li>\n<li>Stage I HIE\u00a0(Hypoxic ischemic encephalopathy)</li>\n</ul>\n<p><strong>Exaggerated,\u00a0</strong>stereotyped, non-habituating Moro reflex is a feature of severe bilateral intrauterine cerebral disturbance, perhaps because of the release of the brain stem from inhibitory cortical influences. It is seen in conditions such as the following:</p>\n<ul>\n<li>Hydranencephaly</li>\n<li>Severe micrencephaly vera</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9926536096b64ea8b69d928e13bc18e5.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman came with complaints of massive painless vaginal bleeding. She also reported amenorrhea for 2 months. The histopathological examination of the endometrium showed a characteristic Swiss cheese pattern. What is the most probable cause?",
    "choices": [
      {
        "id": 1,
        "text": "Endometriosis"
      },
      {
        "id": 2,
        "text": "Halban disease"
      },
      {
        "id": 3,
        "text": "Metropathia haemorrhagica"
      },
      {
        "id": 4,
        "text": "Endometrial carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario history of painless vaginal bleeding preceded by amenorrhea with histopathological examination of the endometrium revealing a characteristic <strong>Swiss cheese pattern </strong>is suggestive of<strong> metropathia hemorrhagica.</strong></p>\n<p><strong>Metropathia hemorrhagica</strong>&nbsp;is a specialized form of <strong>anovulatory DUB,</strong>&nbsp;seen in women aged&nbsp;40 to 45 years. The typical symptoms are <strong>continuous painless vaginal bleeding </strong>at the onset of menses or <strong>preceded</strong> by a 6-8 week period of <strong>amenorrhoea. Occasionally</strong> the woman gives a history of <strong>menorrhagia</strong> prior to this.</p>\n<p>On examination, the uterus is bulky and uniformly enlarged. Histopathological findings are:</p>\n<ul>\n<li><strong>Myohyperplasia</strong>&nbsp;of the uterine wall - up to 2.5cm</li>\n<li>Thick endometrium with cystic glandular hyperplasia appearing as&nbsp;<strong>Swiss cheese pattern</strong></li>\n<li><strong>Absence</strong>&nbsp;of&nbsp;<strong>secretory endometrium</strong> i.e. absence of corkscrew glands&nbsp;</li>\n<li>Thin, slender endometrial&nbsp;<strong>polyps</strong>&nbsp;project into the uterine cavity</li>\n<li>Corpus luteum is absent</li>\n<li>One or both ovaries may contain a cyst</li>\n</ul>\n<p>Other options</p>\n<p>Option A: <strong>Endometriosis</strong>&nbsp;usually presents in the&nbsp;<strong>reproductive age</strong> group, with symptoms of dysmenorrhea, <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">dyspareunia, menorrhagia, and infertility.</span></p>\n<p>Option C: <strong>Halban's disease</strong>&nbsp;is irregular shedding and is due to&nbsp;<strong>persistent corpus luteum</strong>. Regular cycles with prolonged bleeding and normal flow are present.&nbsp;</p>\n<p>Option D: <strong>Endometrial carcinoma</strong> usually presents as postmenopausal bleeding. There may be a history of PCOS or HRT indicating chronic estrogen exposure. There will be no Swiss cheese appearance on histopathological examination.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 44-year-old HIV patient presents with a non-productive cough and progressively worsening breathing difficulty. Chest x-ray shows diffuse bilateral interstitial infiltrates along with a pneumatocele. Microscopic examination of the bronchoalveolar lavage shows the following. What is the special stain used in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Methenamine silver stain"
      },
      {
        "id": 2,
        "text": "Fontana-Masson stain"
      },
      {
        "id": 3,
        "text": "Malachite green stain"
      },
      {
        "id": 4,
        "text": "Periodic acid-Schiff stain"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture and the staining showing the black-colored stained cysts, resembling the\u00a0crushed ping pong balls, are suggestive of\u00a0<strong><em>Pneumocystis</em> pneumonia (PCP). </strong>It is caused by <strong><em>Pneumocystis jirovecii</em>.\u00a0</strong>The stain used for staining the causative organism is\u00a0<strong>Gomori\u2019s methenamine silver stain</strong>.</p>\n<p>Patients with PCP generally present with fever and cough that is usually non-productive. Finding on chest x-ray is either a normal film if the disease is suspected early, or diffuse<strong>\u00a0</strong>bilateral interstitial infiltrates. The classic finding of<strong>\u00a0</strong>dense perihilar infiltrate is unusual in patients with AIDS.</p>\n<p>Treatment:\u00a0Trimethoprim-sulfamethoxazole\u00a0and pentamidine isethionate</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/106db2c331f04be0b855581104ede6e4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the following barium studies with the image shown in the radiograph.",
    "choices": [
      {
        "id": 1,
        "text": "1-b, 2-d, 3-c, 4-a"
      },
      {
        "id": 2,
        "text": "1-b, 2-d, 3-a, 4-c"
      },
      {
        "id": 3,
        "text": "1-d, 2-b, 3-a, 4-c"
      },
      {
        "id": 4,
        "text": "1-a, 2-d, 3-b, 4-c"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option B is correct.</p>\n<p>Image 1 - Barium enema</p>\n<p>Image 2 - Barium meal&nbsp;</p>\n<p>Image 3 - Barium swallow</p>\n<p>Image 4 - Barium meal follow through</p>\n<p>The below radiograph shows <strong>barium meal</strong> examination. It is used to assess the&nbsp;<strong>stomach and duodenum.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/29638d55ee064e66b07a79e7a674c106.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d41b1715a91b48d2bd19db1a16c7dc5dx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f6e2f41aa2e4522bb3b8ed6ba5d3053x387x450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28e5eed1bc2f4885af1e3b62ccb1e2dex323x461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea02236ff7f5404e8467d40cc5a67b81x484x698.JPEG"
    ]
  },
  {
    "text": "A 17-year-old boy is brought to the ED after being involved in a high-speed motorcycle collision. He is hypotensive with a systolic pressure of 60 mm Hg. A FAST scan is positive. At laparotomy, he is found to have a large amount of bleeding from behind the liver with hollow-viscous perforation. Temporary application of a Pringle manoeuvre does not control the bleeding. However, laparotomy packs are placed, and the bleeding appears to slow down. The systolic blood pressure fails to increase even after aggressive resuscitation. The patient\u2019s pH is 7.06 and his temperature is 34\u00b0C. What would be the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ligate the hepatic arteries"
      },
      {
        "id": 2,
        "text": "Hepatectomy"
      },
      {
        "id": 3,
        "text": "Hepatic artery embolization"
      },
      {
        "id": 4,
        "text": "Shift to ICU to resuscitate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient has a&nbsp;<strong>blunt trauma abdomen.&nbsp;</strong>He is&nbsp;<strong>hypothermic&nbsp;</strong>and he is battling&nbsp;<strong>acidosis.&nbsp;</strong>Thus, he should be subjected to&nbsp;<strong>damage control surgery&nbsp;</strong>and must be<strong> shifted to ICU</strong> for <strong>further resuscitation.</strong>&nbsp;</p>\n<p>Damage control surgery is<strong>&nbsp;minimal intervention done to stabilize the patient and do the definite surgery later.&nbsp;</strong>It centers on coordinating&nbsp;<strong>staged operative interventions&nbsp;</strong>with periods of&nbsp;<strong>aggressive resuscitation&nbsp;</strong>to salvage trauma patients sustaining major injuries.</p>\n<p><strong>3 Phases&nbsp; :</strong></p>\n<p><strong>Phase I (Initial Exploration) -</strong></p>\n<p>This phase consists of an initial operative exploration to attain rapid&nbsp;<strong>control of active hemorrhage&nbsp;</strong>and&nbsp;<strong>contamination.</strong></p>\n<p><strong>Phase II (Secondary Resuscitation) -</strong></p>\n<p>This phase focuses on secondary resuscitation to&nbsp;<strong>correct hypothermia, coagulopathy,&nbsp;</strong>and&nbsp;<strong>acidosis.&nbsp;</strong></p>\n<p><strong>Phase III (Definitive Operation) -</strong></p>\n<p>It consists of&nbsp;<strong>planned re-exploration&nbsp;</strong>and&nbsp;<strong>definitive repair</strong>&nbsp;of injuries.&nbsp;This phase typically occurs&nbsp;<strong>48&nbsp;</strong>to&nbsp;<strong>72 hours following initial&nbsp;</strong>and&nbsp;<strong>after successful secondary resuscitation.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/19a3fbf7b5d0424f80cbf9652a9a5821x1279x1623.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4036cc9b0ec9403abdd9a486966c7714x1280x1630.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5353dd7cd7934093baf22c25862bac2bx720x569.GIF"
    ]
  },
  {
    "text": "A 62-year-old male patient has FBS of 200 mg/dl, PPBS of 432 mg/dl, and HbA1c of 10%. A diabetologist decides to add long-acting insulin into the usual insulin regimen of this patient. Identify the long-acting insulin among the following.",
    "choices": [
      {
        "id": 1,
        "text": "Insulin NPH"
      },
      {
        "id": 2,
        "text": "Insulin lispro"
      },
      {
        "id": 3,
        "text": "Insulin aspart"
      },
      {
        "id": 4,
        "text": "Insulin glulisine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Insulin NPH&nbsp;is a long-acting insulin.</p>\n<p><strong>Insulin preparations and duration of action:</strong></p>\n<ul>\n<li>Short-acting\n<ul>\n<li>Insulin lispro, Insulin aspart, Insulin glulisine: 3-4 hours</li>\n<li>Regular insulin: 4-6 hours</li>\n</ul>\n</li>\n<li>Long-acting\n<ul>\n<li>Insulin NPH: 10-16 hours</li>\n<li>Insulin Detemir: 12-24 hours</li>\n<li>Insulin Glargine: 12-24 hours</li>\n<li>Insulin Degludec: 24-42 hours</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect about thallium poisoning?",
    "choices": [
      {
        "id": 1,
        "text": "It resembles natural disease"
      },
      {
        "id": 2,
        "text": "It gives no odour after death"
      },
      {
        "id": 3,
        "text": "It is an ideal homicidal agent"
      },
      {
        "id": 4,
        "text": "It can be detected in the ashes of the burnt body"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In\u00a0thallium poisoning, postmortem examination reveals a <strong>garlicky odour</strong> from the mouth and nose.\u00a0</p>\n<p>Thallium is odourless, tasteless, and water-soluble. The poisoning with this metal closely <strong>resembles a natural disease</strong>. Therefore, this is an <strong>ideal homicidal poison.</strong></p>\n<p>Thallium salts are used in dye and glass industries and as rodenticides and insecticides. In mild cases, joint pain, loss of appetite and drowsiness can occur. In severe cases, there is colicky pain, hair loss, vomiting, severe muscle and joint pains, motor and sensory neuropathies, convulsions, psychosis, optic neuritis, tremors delirium and coma. <strong>Madarosis </strong>(loss of outer third of eyebrows) is significant. Death occurs due to respiratory paralysis. On postmortem examination, it has a\u00a0<strong>garlic-like odour</strong>, <strong>Mees lines</strong> may be present on nail. It can also be detected in the <strong>ashes of the burnt body</strong> i.e. after cremation.</p>\n<p><strong>Chronic thallium poisoning </strong>has a triad of<strong> alopecia, skin rashes, painful peripheral neuropathy </strong>and<strong> mental confusion with lethargy.</strong></p>\n<p><strong>Treatment\u00a0</strong>is mainly by stomach wash with potassium iodide or Prussian blue, activated charcoal. Hemodialysis is useful and forced diuresis can be given.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-month-old baby is brought to the pediatric department with characteristic hair as shown in the image. Further examination shows that the child has truncal hypotonia, and failure to thrive. Which of the following genetic mutation will be seen in this child?",
    "choices": [
      {
        "id": 1,
        "text": "ATP8B gene on Chromosome 13"
      },
      {
        "id": 2,
        "text": "ATP8A gene on Chromosome X"
      },
      {
        "id": 3,
        "text": "ATP7A gene on Chromosome X"
      },
      {
        "id": 4,
        "text": "ATP7B gene on Chromosome 13"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario, the image showing an irritable child with<strong> kinky colorless, and</strong>&nbsp;<strong>sparse hair with truncal hypotonia</strong> on examination is suggestive of <strong>Menke's disease</strong>. It is due to a defect in the <strong>ATP7A gene on chromosome X.</strong></p>\n<p>Menkes disease is a rare <strong>X-linked recessive</strong> progressive multisystemic disease of copper metabolism.&nbsp;In this<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> condition, dietary copper is absorbed from the GI tract but it <strong>cannot</strong> be <strong>transported</strong> to<strong> blood </strong>due to the <strong>absence of</strong> an intracellular <strong>copper binding ATPase </strong>(mutation in ATP7A gene). Copper deficiency results in the <strong>defective </strong>function of<strong> the lysyl oxidase</strong> enzyme and thus leading to reduced cross-linkage of collagen.</span></p>\n<p>Note :</p>\n<ul>\n<li>ATP7A: Menkes disease - X-linked&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</li>\n<li>ATP7B: Wilson's disease - Autosomal recessive (Chromosome 13)&nbsp;<strong>(Option D)</strong></li>\n</ul>\n<p>Other options-</p>\n<p>Option (A) and (B) are not associated with disorders of copper absorption.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dfc65b7efdfb4149ae70e10b49084a24.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the clinic with a history of fever, body pains, and cough for the past 3 days. On examination, his SpO2 is found to be 89% on room air and his respiratory rate is 32 per minute. Rapid antigen test for COVID-19 is found to be positive. You admit the patient for the treatment of the infection. Which of the following is true regarding the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Enoxaparin 0.1mg/kg per dose twice a day"
      },
      {
        "id": 2,
        "text": "D-dimer levels assessment once in 5 days"
      },
      {
        "id": 3,
        "text": "Liver function tests once a week"
      },
      {
        "id": 4,
        "text": "Inj. methylprednisolone 1 to 2mg/kg"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above patient has a <strong>severe infection\u00a0</strong>of COVID-19. His\u00a0<strong>SpO2 is &lt;90%</strong>\u00a0on room air and his respiratory rate is <strong>more than 30</strong> minutes. He should be administered <strong>inj. methylprednisolone 1 to 2mg/kg\u00a0</strong>IV in two divided doses.</p>\n<p>Management of severe COVID-19 infection</p>\n<ul>\n<li><strong>Symptomatic treatment</strong> with paracetamol and antitussives.</li>\n<li>Maintain euvolemia, use conservative fluid management in patients with severe covid when there is no evidence of shock.</li>\n<li>Respiratory support with supplemental oxygen, non-invasive ventilation, or intubation.</li>\n<li>Inj <strong>methylprednisolone 1 to 2mg/kg</strong> IV in 2 divided doses (or 0.2-0.4mg/kg of dexamethasone) usually for a duration 5 to 10 days.</li>\n<li>Prophylactic use of unfractionated heparin or low molecular weight heparin-like <strong>enoxaparin 0.5mg/kg per dose</strong> twice a day subcutaneously.</li>\n<li>A serial chest radiograph should be taken to monitor. High-resolution CT chest to be done only if there is worsening of symptoms</li>\n<li>Lab monitoring: C- reactive protein and <strong>D-dimer levels</strong> should be assessed <strong>24-48 hourly</strong>. Complete blood count, renal function tests, and <strong>liver function tests</strong> should be assessed daily. If the patient's condition is deteriorating and the laboratory facilities are available, the estimation of IL-6 is to be done.</li>\n</ul>\n<p>Classification of Covid19 infection severity according to Ministry of Health and family welfare.</p>\n<p><strong>Mild</strong>-\u00a0patients with uncomplicated upper respiratory tract infection, may have mild symptoms such as fever, cough, sore throat, nasal congestion, malaise, headache. There is no shortness of breath or hypoxia.</p>\n<p><strong>Moderate</strong>- patient with signs of pneumonia but without signs of severe disease.\u00a0Adults with the presence of clinical features of\u00a0<strong>dyspnea and or hypoxia</strong>, fever, cough, including\u00a0<strong>SpO2 90 to \u226493%</strong>\u00a0on room air, the respiratory rate more or equal to 24 per minute.</p>\n<p><strong>Severe-</strong>\u00a0Adults with clinical signs of pneumonia plus\u00a0<strong>one</strong>\u00a0of the following; respiratory rate\u00a0<strong>&gt;30 breaths</strong>/min, severe respiratory distress,<strong>\u00a0SpO2 &lt;90%</strong>\u00a0on room air.</p>\n<p>Severe infection further has:</p>\n<ul>\n<li><strong>Acute respiratory distress syndrome (ARDS)</strong>- it is defined by\n<ul>\n<li>patients develop new or worsening respiratory symptoms\u00a0<strong>within one week</strong>\u00a0of onset of the symptoms.</li>\n<li>There are opacities in the chest radiographs which are not due to\u00a0effusions, lobar or lung collapse, or nodules.</li>\n<li>The patients develop respiratory failure which is not due to cardiac failure or fluid overload. The\u00a0<strong>PaO2/FiO2 \u2264 300 mmHg</strong>\u00a0(with PEEP or CPAP \u22655 cm H2O)</li>\n</ul>\n</li>\n<li>ARDS can be further classified as\n<ul>\n<li><strong>Mild ARDS</strong>: 200 mmHg &lt; PaO2/FiO2 \u2264 300 mmHg (with PEEP or CPAP \u22655 cm H2O)</li>\n<li><strong>Moderate ARDS</strong>: 100 mmHg &lt; PaO2/FiO2 \u2264200 mmHg with PEEP \u22655 cm H2O)</li>\n<li><strong>Severe ARDS</strong>: PaO2/FiO2 \u2264 100 mmHg with PEEP \u22655 cm H2O)</li>\n</ul>\n</li>\n<li>Sepsis</li>\n<li>Septic shock</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59944f955f1040a583bf86dc5faf9d54x1280x3808.JPEG"
    ]
  },
  {
    "text": "An 8-year-old child diagnosed with Downs syndrome comes to the psychiatry OPD for a mental status evaluation. After the assessment, his intelligence quotient is recorded to be 50. What is his mental age?",
    "choices": [
      {
        "id": 1,
        "text": "6"
      },
      {
        "id": 2,
        "text": "5"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "8"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The mental age of this child is <strong>4 years old</strong>.</p>\n<p>Historically,&nbsp;<strong>IQ = Mental age x 100/ Chronological age</strong></p>\n<p>In this scenario, 50 = Mental age x 100 / 8</p>\n<p>50 x 8 / 100 = Mental Age</p>\n<p>400 / 100 = Mental age</p>\n<p>4 = Mental Age.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old college student sustained a knee injury in the basketball match in the sports fest. The orthopaedic resident performed the Lachman test which turned out to be positive. Identify the ligament affected.",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The positive Lachman's test is suggestive of injury to the&nbsp;<strong>anterior cruciate ligament,&nbsp;</strong>which is marked as 'A' in the image shown.</p>\n<p><strong>The anterior cruciate ligament</strong> is attached to the anterior intercondylar area of the tibia. It&nbsp;ascends posterolaterally, twisting on itself and fanning out to attach high on the posteromedial aspect of the lateral femoral condyle.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/618a5524bb45402eb304a7ea231f1669.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/acc4646455fd45e39db863908c395376x1280x730.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73d4846612174f298a215b2a97f7bfbcx300x188.GIF"
    ]
  },
  {
    "text": "A child with bilateral cataracts was brought to the ophthalmology department. Systemic examination reveals hearing loss, a congenital heart defect along with the following lesions that have been present since birth. All of the following are the ocular findings associated with this condition except:",
    "choices": [
      {
        "id": 1,
        "text": "Glaucoma"
      },
      {
        "id": 2,
        "text": "Anterior uveitis"
      },
      {
        "id": 3,
        "text": "Congenital megalophthalmos"
      },
      {
        "id": 4,
        "text": "Salt and pepper pigmentary retinopathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the image showing\u00a0<strong>blueberry muffin lesions\u00a0</strong>is suggestive of\u00a0Congenital rubella syndrome\u00a0and <strong>microphthalmos\u00a0</strong>is seen in this condition (not megalophthalmos).</p>\n<p class=\"p1\">Congenital rubella cataract may occur alone or as part of the classical rubella syndrome which consists of:</p>\n<ul>\n<li class=\"p1\"><span class=\"s1\"><strong>Ocular defects</strong>:\u00a0</span>Congenital cataract, <strong>salt and pepper chorioretinopathy</strong>, <strong>microphthalmos</strong>, <strong>Glaucoma,</strong>\u00a0and <strong>anterior uveitis</strong></li>\n<li class=\"p1\">Sensorineural hearing loss</li>\n<li class=\"p1\"><span class=\"s1\"><strong>Heart defects</strong>:\u00a0</span>Patent ductus arteriosus, pulmonary stenosis, and ventricular septal defects.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a8b38980bf054d7885f3ed4b2dbe17fd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman presents with a sudden loss of vision in both eyes that occurred after a stressful argument with her boss. On examination, her visual acuity is recorded as 6/6 in each eye, and her pupils are equal, round, and reactive to light. There are no abnormalities found on ophthalmic examination or in other neurological evaluations. When asked to follow a moving object or identify visual stimuli, she demonstrates inconsistent performance. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Conversion disorder"
      },
      {
        "id": 2,
        "text": "Catatonia"
      },
      {
        "id": 3,
        "text": "Central retinal vein occlusion"
      },
      {
        "id": 4,
        "text": "Eale's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis based on the clinical vignette given is\u00a0<strong>conversion disorder</strong>\u00a0/functional neurologic symptom disorder.</p>\n<p>Conversion disorder is a condition with symptoms or deficits that involve <strong>voluntary motor</strong> or <strong>sensory functions</strong>. Though it points to an underlying medical condition, in reality, it arises due to <strong>psychological factors</strong>. The symptoms are <strong>not intentionally produced</strong> and the gain obtained is primarily psychological.\u00a0</p>\n<p>It can be associated with <strong>depressive disorders</strong>, anxiety disorders, personality disorders, and somatization disorders. Paralysis, <strong>blindness</strong>, and mutism are the most frequently seen conversion disorder symptoms. <strong>Anaesthesia</strong> and<strong> paresthesia </strong>of the extremities, abnormal movements, and gait disturbance are the other features commonly seen.\u00a0</p>\n<p>Conversion disorder usually <strong>resolves spontaneously</strong>. Insight-oriented or <strong>behavioural therapy</strong> is also helpful. Hypnosis and <strong>anxiolytics</strong> are used in some cases.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option B: <strong>Catatonia</strong>\u00a0is a condition seen in advanced<strong>\u00a0primary mood</strong>\u00a0or\u00a0<strong>psychotic illnesses</strong>.\u00a0Some conditions that can cause catatonia include\u00a0<strong>head trauma</strong>, encephalitis, and\u00a0<strong>hepatic encephalopathy</strong>. Some medications such as<strong>\u00a0corticosteroids</strong>, immunosuppressants, or antipsychotics can also result in the condition. Some clinical features include\u00a0<strong>grimacing</strong>, mutism, <strong>echolalia,</strong> stupor, and posturing.</p>\n<p>Option C: <strong>Central retinal vein occlusion (CRVO)</strong>, especially in its<strong> ischemic </strong>form, usually presents with <strong>severe visual loss</strong>, marked<strong> retinal haemorrhages, cotton wool spots, optic disc oedema</strong>, and a <strong>relative afferent pupillary defect (RAPD)</strong>, often accompanied by detectable abnormalities on ophthalmic examination. However, this patient has normal visual acuity, normal pupillary reactions, and no detectable abnormalities on ophthalmic or neurological exams, making CRVO an unlikely diagnosis in this case.</p>\n<p>Option D: <strong>Eales' disease</strong>, common in <strong>young Asian males</strong>, features <strong>recurrent vitreous haemorrhage</strong> and <strong>retinal neovascularization</strong> due to peripheral <strong>retinal vein inflammation</strong>. It presents with a <strong>reddish vitreous mass</strong> and can lead to <strong>vision loss</strong> and complications like <strong>retinal detachment</strong>. However, it is less likely here due to the patient\u2019s demographics and absence of characteristic findings.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A surgery resident during the rounds advised the intern to monitor the burns patient for adequate fluid resuscitation and also instructed him to give a bolus of 10 mL/kg body weight if the patient showed signs of hypoperfusion. All of the following are indications to give bolus fluid, except:",
    "choices": [
      {
        "id": 1,
        "text": "Tachycardia"
      },
      {
        "id": 2,
        "text": "Low haematocrit"
      },
      {
        "id": 3,
        "text": "Restlessness"
      },
      {
        "id": 4,
        "text": "Cool peripheries"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A low hematocrit does not indicate a need for fluid resuscitation.</p>\n<p>Instead, a high hematocrit is an indicator of hypoperfusion.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is posted for an ambulatory surgery and the following agent is used for intravenous induction of anesthesia. Which of the following statements is incorrect regarding the agent shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "It acts on GABA-A receptors"
      },
      {
        "id": 2,
        "text": "It causes pain on intravenous injection"
      },
      {
        "id": 3,
        "text": "Increases the risk of post-operative nausea and vomiting"
      },
      {
        "id": 4,
        "text": "Used as sedation for mechanically ventilated patients"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The anesthetic agent used in this patient for induction is <strong>propofol </strong>which appears as a <strong>milky white liquid</strong> as shown in the image.&nbsp;Propofol has&nbsp;<strong>antiemetic&nbsp;</strong>properties which help&nbsp;reduce post-operative nausea and vomiting.</p>\n<p>Its <strong>constituents</strong> are:</p>\n<ul>\n<li aria-level=\"1\"><strong>1% propofol</strong></li>\n<li aria-level=\"1\"><strong>1.2% egg phospholipid </strong><span style=\"font-weight: 400;\">(emulsifier)</span></li>\n<li aria-level=\"1\"><strong>2.25% glycerol</strong><span style=\"font-weight: 400;\"> (Tonicity adjusting agent)</span></li>\n<li aria-level=\"1\"><strong>10% soya bean oil</strong><span style=\"font-weight: 400;\">&nbsp;</span></li>\n<li aria-level=\"1\"><strong>NaOH</strong> (to change pH)</li>\n<li aria-level=\"1\">EDTA (bacteriostatic)</li>\n</ul>\n<p>Propofol is formulated as a lipid emulsion, which causes <strong>pain on injection</strong>. A new aqueous prodrug,&nbsp;<strong>fospropofol</strong>&nbsp;is associated with&nbsp;less pain&nbsp;on injection. Propofol should be handled with sterile techniques as it has a risk of growth of bacteria.</p>\n<p>Propofol facilitates the <strong>inhibitory </strong>neurotransmission by<strong>&nbsp;</strong>action on<strong> GABA-A receptors.</strong>&nbsp;It has a rapid onset of action (within <strong>15 sec</strong>). Induction dose is usually <strong>1-2 mg/ kg</strong> and maintenance dose is <strong>100-200 &micro;g/ kg/ min.</strong></p>\n<p>Effects on CNS:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">It is <strong>cerebro-protective</strong>. Reduces intracranial pressure and cerebral blood flow.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Anticonvulsant</strong> properties</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Has anti-emetic properties at a dose of 10-20mg.</li>\n</ul>\n<p>Other effects:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Produce <strong>hypotension</strong> and <strong>bradycardia</strong>; hence dose reduction is needed in elderly and hypovolemic patients.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Produce apnea since it is a profound respiratory depressant.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Anti-pruritic property</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Propofol infusion syndrome</strong>: It is a rare syndrome that can happen when propofol is used for long-term sedation in young patients who are critically ill or underwent neurosurgery. Symptoms include metabolic acidosis, lipemia, and death.</li>\n</ul>\n<p>It is the IV agent of choice for</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Induction</strong> of anesthesia for neuro anesthesia and other surgeries</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Maintenance</strong> of anesthesia in patients undergoing cardiac surgery.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Sedation</strong> <strong>for mechanical ventilation</strong> and minor procedures in the ICU.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Total iv anesthesia (TIVA) and short-term anesthesia for ambulatory surgeries&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Malignant hyperthermia&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d0f04dab920e46d6b5042625e6fc94c6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following surgery is done commonly in Tubotympanic type of CSOM?",
    "choices": [
      {
        "id": 1,
        "text": "Radical mastoidectomy"
      },
      {
        "id": 2,
        "text": "Simple mastoidectomy"
      },
      {
        "id": 3,
        "text": "Tympanoplasty"
      },
      {
        "id": 4,
        "text": "Modified radical mastoidectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Tympanoplasty is done commonly in Tubotympanic type of CSOM.</p>\n<p>It is the eradication of disease from the middle ear and reconstruction of hearing (ossiculoplasty) with or without grafting of the tympanic membrane.</p>\n<p><strong>Myringoplasty</strong> is the term given for closure of perforation of tympanic membrane done to check repeated infections from external ear.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the emergency department after he fell on his outstretched hand. An X-ray was performed and is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Colle's fracture"
      },
      {
        "id": 2,
        "text": "Rolando's fracture"
      },
      {
        "id": 3,
        "text": "Galeazzi fracture"
      },
      {
        "id": 4,
        "text": "Montegia fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The provided history of <strong>falling on an outstretched arm</strong> and the X-ray revealing an <strong>oblique fracture in the lower third of the radius</strong> with <strong>dislocation of the distal radio-ulnar joint</strong> point to the diagnosis of <strong>Galeazzi's fracture</strong>.</p>\n<p>Galeazzi's fracture is the <strong>fracture of the lower third of the radius</strong> and the <strong>subluxation or dislocation of the distal radioulnar joint</strong>. This injury usually happens when one <strong>falls on an outstretched hand</strong>.&nbsp;</p>\n<p>Patients present with<strong> pain, swelling, and deformity at the lower end of the radius.</strong> On examination, the disruption of the radio-ulnar joint can be elicited by pressing the lower end of the ulna. The ulna moves down and comes back like the key of a piano (<strong>piano-key sign</strong>).&nbsp;</p>\n<p>The aim of treatment for this fracture is to preserve supination and pronation of the forearm. In <strong>children</strong>, <strong>closed reduction</strong> is usually enough to achieve perfect reduction. However, in <strong>adults</strong>, <strong>open reduction using a k-wire fixation or compression plating</strong> is usually required. It is also important to look for <strong>ulnar nerve</strong> damage.</p>\n<p>Galeazzi's fracture can cause complications such as <strong>malunion</strong> due to displacement of the fragment. This often results in <strong>deformity</strong> and <strong>limitation</strong> in supination and pronation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/572f0c2032df4002961e892d18219f52.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Neet Mini - 22 (20 Q)';
        const quizFilename = 'neet-mini-22-20-q-1c1e72b8.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>