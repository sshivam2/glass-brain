<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>234 Surgery Neet 2021 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">18</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient underwent surgery for breast carcinoma. She now presents with painless swelling involving the arm as shown in the image below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lymphedema"
      },
      {
        "id": 2,
        "text": "Lymphangiosarcoma"
      },
      {
        "id": 3,
        "text": "Venous thrombosis"
      },
      {
        "id": 4,
        "text": "Cellulitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The generalized swelling of the left arm of the patient post-surgery for breast carcinoma is suggestive of <strong>post-mastectomy</strong>&nbsp;<strong>lymphedema.</strong></p>\n<p>Lymphoedema occurs when interstitial fluid accumulates due to defective lymphatic drainage. It is a common complication of breast cancer treatment, involving <strong>axillary lymph node dissection</strong>&nbsp;and <strong>radiotherapy.</strong><strong>&nbsp;Sentinel lymph node dissection</strong> (SLND) reduces the risk of lymphedema significantly.</p>\n<p>Clinical signs and symptoms are observed in the <strong>ipsilateral arm.</strong>&nbsp;A significant increase in limb size due to swelling is seen. Other symptoms are&nbsp;heaviness, tightness, numbness, tingling, limb fatigue, and reduced limb mobility.</p>\n<p><strong>Diagnosis</strong> is predominantly based on the clinical swelling of the arm. The girth of the affected arm &gt;2 centimetres than the normal limb,&nbsp;a 200-mL or more increase in limb volume, or a 5% or greater limb volume change are other diagnostic criteria.</p>\n<p>Management:</p>\n<ol>\n<li><strong>Limb elevation</strong>, <strong>elastic arm stockings</strong>, and<strong> pneumatic compression devices</strong> to reduce swelling.&nbsp;</li>\n<li>Using a <strong>low-pH water-based moisturizer </strong>to prevent dry skin caused by excess fluid accumulation.&nbsp;</li>\n<li><strong>Manual lymphatic drainage</strong> (MLD) by a therapist followed by <strong>simple lymphatic drainage</strong> (SLD) by the patient daily aids interstitial fluid evacuation.</li>\n<li>Surgical options include <strong>lymphaticovenular anastomosis</strong>, liposuction, and debulking.</li>\n</ol>\n<p>Other options:</p>\n<p>Option B:&nbsp; &nbsp;<strong>Stewart-Treves syndrome</strong>&nbsp;refers to <strong>lymphangiosarcoma</strong> seen in chronic <strong>long-standing</strong> lymphedema following mastectomy (more than 10 years). They present as single/multiple <strong>bluish-red</strong> skin and<strong> subcutaneous nodules.</strong> They can ulcerate and hemorrhage.</p>\n<p>Option C: <strong>Axillary venous thrombosis</strong> or <strong>Paget-Schrotter disease</strong> is seen in patients doing rigorous exercise and in weightlifters. The compression of the subclavian vein at the thoracic outlet causes <strong>p</strong><strong>ainful</strong> swelling of the arm.</p>\n<p>Option D: <strong>Cellulitis </strong>(lymphangitis) is a bacterial infection of the <strong>skin and subcutaneous tissue</strong>. It is characterized by a <strong>painful</strong> area of <strong>erythematous</strong> and <strong>edematous</strong> tissue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/67451aee83c247989f7c4d258187fb6b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding the condition given below?",
    "choices": [
      {
        "id": 1,
        "text": "Patient must be started on anti-gas gangrene serum therapy"
      },
      {
        "id": 2,
        "text": "It is a mixed flora aerobic and anaerobic infection"
      },
      {
        "id": 3,
        "text": "Bilateral orchidectomy is generally performed"
      },
      {
        "id": 4,
        "text": "Compulsory urinary diversion is performed"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A: <strong>Anti-gas gangrene serum</strong> refers to refined <strong>equine antitoxin against Clostridium species</strong>. Hence, it has no role in Fournier's gangrene.</p>\n<p>Option C: <strong>Bilateral orchidectomy</strong> is <strong>not</strong> <strong>performed</strong> as testes are<strong> not affected </strong>and need not be removed.&nbsp;</p>\n<p>Option D: Urinary diversion <strong>may</strong> <strong>be</strong> necessary in a few cases, and is <strong>not compulsory.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/63c8e803ee8541dc90e9b2cb9ba591db.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e2124599a699429c9012677fe20766f4x720x540.JPEG"
    ]
  },
  {
    "text": "A baby playing unsupervised was brought with complaints of difficulty in swallowing for the last few hours.  The X-ray image is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Foreign body in the trachea"
      },
      {
        "id": 2,
        "text": "Foreign body in the esophagus"
      },
      {
        "id": 3,
        "text": "Artifact"
      },
      {
        "id": 4,
        "text": "Soft tissue calcification in the neck"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical picture of the child presenting with <strong>difficulty in swallowing</strong> and the <strong>chest X-rays</strong> (AP and lateral) showing a <strong>circular homogenous</strong> <strong>opacity</strong> in the <strong>neck</strong> region is suggestive of a foreign body (<strong>coin</strong>) lodged in the esophagus.</p>\n<p><strong>Foreign</strong> <strong>bodies</strong> commonly ingested by children are <strong>coins</strong>, <strong>disk</strong> <strong>batteries</strong>, and small toy items. In <strong>adults</strong>, it is usually a <strong>food bolus</strong> (mostly meat) that gets lodged.</p>\n<p>The <strong>flat surface</strong> of a coin is seen on the anteroposterior view <strong>(AP view)</strong> and the <strong>edge</strong> is seen on the <strong>lateral view</strong>. This <strong>indicates</strong> that it is oriented in the <strong>coronal</strong> <strong>plane</strong>, which is seen when it is lodged in the <strong>esophagus</strong> (and not in the trachea).</p>\n<p>Initial <strong>symptoms</strong> are <strong>choking</strong>, gagging, and coughing followed by <strong>excessive salivation</strong>, <strong>dysphagia</strong>, food refusal, vomiting, or pain in the neck and throat. Respiratory symptoms such as <strong>stridor</strong>, wheezing, cyanosis, or <strong>dyspnea</strong> are seen if the esophageal foreign body impinges on the larynx or tracheal wall.</p>\n<p>Imaging with <strong>chest</strong> and <strong>abdominal</strong> <strong>X-rays</strong> should be performed in <strong>AP</strong> and <strong>lateral</strong> <strong>positions</strong>. <strong>Chest</strong> <strong>CT</strong> should always be <strong>performed</strong> if <strong>oesophageal perforation</strong> is suspected.</p>\n<p><strong>Endoscopic</strong> <strong>removal</strong> of the esophageal foreign body is the <strong>procedure</strong> <strong>of</strong> <strong>choice</strong>. It should be performed</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Immediately in esophageal obstruction, disk batteries, and sharp pointed objects.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Within 12-24h in non-pointed objects, pointed objects in the stomach, and coins in the esophagus.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Non-urgent removal in objects in stomach &gt;2.5cm in diameter, and disk battery in the stomach (up to 48h)</li>\n</ol>\n<p>Other options:</p>\n<p>Option A: For <strong>coins</strong> lodged in the <strong>trachea</strong>, the <strong>edge</strong> is seen <strong>anteroposteriorly </strong>view&nbsp;and the <strong>flat</strong> <strong>side</strong> is seen in the <strong>lateral</strong> view of the X-rays (oriented in the sagittal plane).</p>\n<p>Option C: <strong>Artifacts</strong> refer to an appearance or <strong>unintended</strong> <strong>structure</strong> that is<strong> not normally seen </strong>on the radiograph and is produced by some artificial means. It can occur due to <strong>technical</strong> or <strong>processing errors</strong> while taking a radiograph.</p>\n<p>Option D: <strong>Soft</strong> <strong>tissue</strong> <strong>calcification</strong> in the neck is due to physiologic or pathological conditions. Commonly encountered soft tissue calcifications in the head and neck region include <strong>tonsilloliths</strong>, <strong>carotid</strong> <strong>artery</strong> <strong>calcifications</strong>, and calcified stylohyoid ligaments.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c0fdfc3aac3477ab85270ae322b061e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 75-year-old man with prostate carcinoma presents to you with a PSA  of 9 ng/mL with a small tumor focus. His Gleason score is 6. What will be your most likely management?",
    "choices": [
      {
        "id": 1,
        "text": "Radical prostatectomy"
      },
      {
        "id": 2,
        "text": "External beam radiation"
      },
      {
        "id": 3,
        "text": "Brachytherapy"
      },
      {
        "id": 4,
        "text": "Active surveillance"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette of a <strong>75-year-old man</strong>, with a <strong>low PSA (&lt;10 ng/ml)</strong>, <strong>Gleason score of 6</strong>, and a <strong>small tumor focus</strong> point to a diagnosis of <strong>low-risk prostatic carcinoma</strong>. The most likely management for this patient would be <strong>active surveillance</strong> only.</p>\n<p>Active surveillance is done when there is:</p>\n<div class=\"page\" title=\"Page 1685\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Gleason score of 6</li>\n<li>Early-stage disease (T1c)</li>\n<li>Small volume disease on biopsy</li>\n<li>Low PSA (&lt; 10 ng/ml)</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>Active surveillance protocols include a <strong>digital rectal examination</strong> and <strong>PSA monitoring</strong> every 3 to 6 months, with <strong>TRUS-guided prostate biopsies </strong>every 1 to 3 years.</p>\n<div class=\"page\" title=\"Page 2131\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Gleason grading system evaluates the abnormalities in the glandular architecture of the prostate. It is based on a scale of 1 to 5, with 1 being the most differentiated grade and 5 being the least differentiated. The grades are added to give the Gleason score.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The classification and management of carcinoma prostate are outlined below:</p>\n<table style=\"width: 911px;\">\n<tbody>\n<tr>\n<td style=\"width: 117px;\"><strong>Grade</strong></td>\n<td style=\"width: 711.828px;\"><strong>Treatment</strong></td>\n</tr>\n<tr>\n<td style=\"width: 117px;\">Low Risk</td>\n<td style=\"width: 711.828px;\">\n<p>Radical prostatectomy (&lt;70 years),</p>\n<p>Active surveillance (&gt;70 years)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 117px;\">Intermediate Risk&nbsp;</td>\n<td style=\"width: 711.828px;\">\n<p>Radical prostatectomy and/or Radical radiotherapy(EBRT) (&lt;70 years)</p>\n<p>Active surveillance +/- TURP and hormone therapy (&gt;70 years)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 117px;\">High Risk</td>\n<td style=\"width: 711.828px;\">\n<p>Early androgen ablation + Radiotherapy + Surgical treatment (&lt; 70 years)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 117px;\">Metastatic disease</td>\n<td style=\"width: 711.828px;\">\n<p>Systemic chemotherapy with palliative treatment ( &lt;70 years)</p>\n<p>Androgen ablation therapy and palliative treatment for symptomatic patients&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>EBRT: External beam radiation therapy, TURP: Transurethral resection of the prostate</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the gross specimen obtained from a cystoprostatectomy.",
    "choices": [
      {
        "id": 1,
        "text": "Malakoplakia"
      },
      {
        "id": 2,
        "text": "Bladder carcinoma"
      },
      {
        "id": 3,
        "text": "Prostate carcinoma"
      },
      {
        "id": 4,
        "text": "Schistosomiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image of the <strong>cystoprostatectomy</strong> specimen shows a large, fungating growth from the bladder wall involving the entire bladder. The two lobes of the prostate are not affected. The given specimen is that of <strong>bladder carcinoma</strong>.&nbsp;</p>\n<p>Clinical features of bladder carcinoma include <strong>painless, gross hematuria </strong>(most common symptom), which may cause clots and urinary retention subsequently. Increased frequency and discomfort during urination may be seen.&nbsp;</p>\n<p>Depending upon the depth of invasion, bladder carcinoma is divided into 3 groups:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Non-muscle invasive bladder cancer - does not invade detrusor muscle but can invade lamina propria. It accounts for 70% of cases.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Muscle-invasive bladder cancer - invades the detrusor muscle&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Flat, non-invasive carcinoma in situ (CIS)&nbsp;</li>\n</ul>\n<p>Staging and diagnosis:</p>\n<p>It is done by cystoscopy and resection of the tumor. A bimanual examination should be performed after resection of the tumor. Complete urinary tract imaging is required using contrast computed tomography (CT) or magnetic resonance (MR) urography.</p>\n<p>Management:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Non-muscle invasive bladder cancer:\n<ul style=\"list-style-type: circle;\">\n<li style=\"font-weight: 400;\" aria-level=\"2\">Transurethral resection of bladder tumor <strong>(TURBT)</strong> followed by intravesical chemotherapy with mitomycin C or epirubicin</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Immunotherapy with <strong>regular intravesical</strong> <strong>instillations</strong> of Bacille Calmette Guerin <strong>(BCG)</strong> in high-risk tumors.</li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Muscle invasive bladder cancer: Radical cystectomy along with urinary diversion procedure and lymph node dissection +/- neoadjuvant chemotherapy</li>\n</ol>\n<p>Other options:&nbsp;</p>\n<p>Option A: <strong>Malakoplakia</strong> is a rare inflammatory condition that is typically seen in <strong>immunocompromised individuals</strong>. The term 'malakoplakia' means 'soft plaques'. General principles of treatment include systemic antibiotics, surgical excision, and limiting immunosuppression. Surgical excision is done for malakoplakia lesions based on the site affected, complications, and if medical treatment fails.</p>\n<p>Option B: <strong>Prostatic carcinoma</strong> can be surgically managed by <strong>radical prostatectomy</strong>, which does not involve cystectomy. In prostatic carcinoma usually, one or more of the lobes are predominantly involved unlike in the given gross specimen.</p>\n<p>Option D: <strong>Schistosomiasis</strong> of the bladder is a parasitic infection by <strong>Schistosoma hematobium</strong>. On <strong>cystoscopy</strong>, it can look like <strong>nodules</strong>, pseudo tubercles, ulceration, sandy patches, and in the end stage can cause <strong>squamous cell carcinoma</strong> of the bladder.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/077ca9dc32a1417289a6b988426f963d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient after a road traffic accident presented with pain abdomen. The resident examines the child and found that vitals were stable and tenderness was present in the left lumbar region. Which is the best investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast enhanced CT scan"
      },
      {
        "id": 2,
        "text": "Retrograde urethrogram"
      },
      {
        "id": 3,
        "text": "Wait and watch"
      },
      {
        "id": 4,
        "text": "Emergency laparotomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette with <strong>abdominal pain</strong> and tenderness in&nbsp;the left lumbar region following a road traffic accident is suggestive of <strong>blunt renal trauma</strong>. The investigation of choice is <strong>CECT</strong> in a<strong> hemodynamically stable patient.</strong></p>\n<p><strong>Blunt trauma</strong> is the main cause of renal injuries and is generally self-limiting. Radiological investigations are indicated when there is gross haematuria, shock in combination with microscopic haematuria, <strong>pediatric renal trauma</strong>, and penetrating injuries.</p>\n<p><strong>CECT</strong> is the investigation of choice. It assesses&nbsp;the extent of the injury, showing laceration, extravasation, surrounding hemorrhage, and vessel injury. It also shows non-renal injuries and effectively stages renal pedicle injuries. Arterial occlusion will manifest as rim enhancement of the normal renal contour.</p>\n<p>Blunt trauma is mostly treated <strong>conservatively. </strong>Most of the <strong>penetrating injuries</strong> require surgical <strong>renal exploration.</strong></p>\n<p>Absolute indications for surgical intervention in renal trauma are:</p>\n<ul>\n<li>Massive hemorrhage</li>\n<li>Renal pedicle avulsion (grade 5 injury)</li>\n<li>Expanding, pulsatile, or uncontained <strong>retroperitoneal</strong> hematoma</li>\n</ul>\n<p>Relative indications are:</p>\n<ul>\n<li>Large laceration of the renal pelvis or avulsion of the ureteropelvic junction</li>\n<li>Bowel or pancreatic injuries</li>\n<li>Persistent urinary leakage, postinjury urinoma, or perinephric abscess&nbsp;</li>\n<li>Complete renal artery thrombosis of both kidneys&nbsp;</li>\n<li>Renal hypertension</li>\n</ul>\n<p>Other options:</p>\n<p>Option D: <strong>Exploratory laparotomy</strong> is recommended in unstable patients and those with penetrating renal injuries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with rectal prolapse underwent surgery. The postoperative image is given below. Identify the procedure.",
    "choices": [
      {
        "id": 1,
        "text": "Stapled hemorroidopexy"
      },
      {
        "id": 2,
        "text": "Well's procedure"
      },
      {
        "id": 3,
        "text": "Thiersch wiring"
      },
      {
        "id": 4,
        "text": "Altemeier repair"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The postoperative image shows a <strong>purse-string suture</strong> which is suggestive of <strong>Thiersch wiring for rectal prolapse</strong>.</p>\n<p>In <strong>Thiersch's wiring</strong>, a <strong>steel wire or a silastic/nylon tape</strong> is placed <strong>around the anal canal</strong>. It is <strong>rarely done</strong> now due to<strong> post-operative problems</strong> like chronic perineal sepsis, <strong>anal stenosis</strong>, and obstructed defecation.</p>\n<p>Rectal prolapse is of two types:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Partial</strong> rectal prolapse - <strong>only</strong> the <strong>mucosal</strong> layer of the rectum is prolapsed. It is seen in <strong>children</strong> and is managed by<strong> digital repositioning</strong>. If there is a recurrence, then Theirsch's wiring or sclerotherapy is performed.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Complete</strong> rectal prolapse - <strong>all the layers</strong> of the rectum are involved. It is seen in <strong>adults</strong> due to the <strong>weakening</strong> of the <strong>pelvic</strong> floor. It is managed by using the following approaches:</li>\n<ol style=\"list-style-type: lower-alpha;\">\n<li style=\"font-weight: 400;\" aria-level=\"2\">The<strong> perineal </strong>approach - easy to perform, and has fewer complications but a high recurrence rate. It is preferred in elderly patients with comorbidities. The surgeries done include:</li>\n<ol style=\"list-style-type: lower-roman;\">\n<li style=\"font-weight: 400;\" aria-level=\"3\">Thiersch's wiring\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\"><strong>Delorme's mucosectomy</strong> - In this procedure, the rectal <strong>mucosa</strong> is <strong>stripped circumferentially </strong>from the rectum over the length of the prolapse. The underlying muscle is plicated with a series of sutures. The excess rectal mucosa is excised and a mucosal anastomosis is performed.</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\"><strong>Altemeier's recto sigmoidectomy</strong> <strong>(option D)</strong> - In this procedure, full-thickness resection of the prolapsed rectum is performed, incorporating any associated colonic prolapse. Restoration of colorectal continuity can be performed by hand-sewn/stapled anastomosis. This is the<strong> procedure of choice </strong>in patients presenting with <strong>incarcerated and strangulated prolapse</strong>.</li>\n</ol>\n<li style=\"font-weight: 400;\" aria-level=\"2\">The <strong>abdominal</strong> approach - It is difficult to perform and has more complications, but a lower recurrence rate. The surgeries done include:\u00a0</li>\n<ol style=\"list-style-type: lower-roman;\">\n<li style=\"font-weight: 400;\" aria-level=\"3\"><strong>Ripstein's procedure</strong> - It involves the placement of a <strong>prosthetic mesh</strong> around the <strong>mobilized rectum</strong>, with the attachment of the <strong>mesh to the presacral fascia</strong> below the sacral promontory.</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Well's procedure <strong>(option B)</strong> - It involves posterior rectopexy.</li>\n</ol>\n</ol>\n</ol>\n<p><br />Other options:</p>\n<p>Option A: <strong>Stapled hemorroidopexy</strong> is used in the <strong>treatment</strong> of <strong>internal</strong> <strong>hemorrhoids</strong>, where a<strong> circular stapling device</strong> is used to excise a cylinder of mucosa and submucosa and simultaneously staple the mucosal ends together.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e48fd53fa6724c148ef8bc2df1bb7813.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents after a motorcycle road traffic accident with no reported pain or injury. During examination, blood is observed at the tip of the urethral meatus, and the bladder is non-palpable. What would be your next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Foley's catheterization"
      },
      {
        "id": 2,
        "text": "Wait for bladder to fill"
      },
      {
        "id": 3,
        "text": "Nephrogram"
      },
      {
        "id": 4,
        "text": "Suprapubic cystostomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Retrograde urethrography using water-soluble contrast is used for localizing the site of urethral injury.</p>\n<p>The patient should be managed with analgesia and antibiotics. If the bladder is full, it should be drained with a catheter placed by percutaneous suprapubic puncture using a Seldinger technique.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Foley catheterization</strong> should <strong>not be done</strong> since it might convert a partial tear into a complete tear.</p>\n<p>Option C: <strong>Nephrogram</strong> is <strong>not</strong> done but retrograde urethrogram is performed in urethral injury.\u00a0</p>\n<p>Option D: <strong>Suprapubic</strong> <strong>Cystostomy</strong> is done <strong>only</strong> in cases where the <strong>bladder</strong> is <strong>full</strong> or the patient is <strong>unable</strong> to <strong>urinate</strong> following a pelvic fracture/ RTA.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/76b9b9a8d6ca400593334e69d47c0dbdx1280x2105.JPEG"
    ]
  },
  {
    "text": "A patient presents with a hernia medial to the inferior epigastric artery. What is the most likely diagnosis and appropriate management for the same?",
    "choices": [
      {
        "id": 1,
        "text": "Direct hernia and Bassini repair"
      },
      {
        "id": 2,
        "text": "Direct hernia and Lichtenstein mesh repair"
      },
      {
        "id": 3,
        "text": "Indirect hernia and Bassini repair"
      },
      {
        "id": 4,
        "text": "Indirect hernia and Lichtenstein mesh repair"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other surgical methods used for the repair of an inguinal hernia are:</p>\n<ul>\n<li><strong>Bassini repair</strong> - It is done for the <strong>reconstruction</strong> of the <strong>inguinal floor</strong> in <strong>adults</strong>. In this method, a <strong>mesh is not</strong> used. It is associated with a <strong>high</strong>&nbsp;<strong>recurrence</strong>&nbsp;and is not used frequently now. It is used only in cases of hernial strangulation and peritonitis where the use of a mesh is not preferred. It is performed by <strong>suturing</strong> the transversus abdominis and internal oblique musculoaponeurotic arches/<strong>conjoined tendon</strong> to the<strong> inguinal ligament</strong>.&nbsp;</li>\n<li><strong>Shouldice repair</strong>&nbsp;- It is a&nbsp;<strong>multilayered repair,</strong>&nbsp;where the posterior wall of the inguinal canal is strengthened by <strong>continuous sutures.</strong>&nbsp;It involves <strong>double-breasting</strong> of the<strong> transversalis fascia</strong>. It is associated with a&nbsp;<strong>very low recurrence rate.</strong></li>\n<li><strong>Gilbert repair</strong> (plug and patch repair) - It&nbsp;is an <strong>extension</strong> of <strong>Lichtenstein&rsquo;s original mesh repair</strong> and has now become the <strong>most commonly</strong> performed <strong>primary anterior inguinal hernia repair</strong>. In this technique, a <strong>cone-shaped plug</strong> of<strong> polypropylene mesh</strong> is used. It is deployed like an upside-down umbrella when inserted into the internal inguinal ring to occlude the hernia</li>\n<li><strong>McVay repair </strong>(Cooper's ligament repair)<strong>&nbsp;</strong>is used for the correction of direct inguinal hernia, large indirect hernia,<strong> recurrent hernia</strong>, femoral hernias (particularly suited for <strong>strangulated femoral hernias</strong>). In this method, the&nbsp;transversus abdominis aponeurosis is approximated to Cooper's ligament.</li>\n<li><strong>Stoppa-Rives repair</strong>&nbsp;- It is used for the repair of large, recurrent, or bilateral hernias. In this method, a sub-umbilical&nbsp;<strong>midline incision </strong>is given to place a<strong> large mesh</strong> into the <strong>preperitoneal space.</strong></li>\n<li><strong>Herniotomy</strong> - It is used to treat <strong>inguinal hernia</strong> in a<strong> child </strong>which&nbsp;occurs due to the<strong> presence</strong> of a&nbsp;<strong>patent processus vaginalis</strong>. Therefore in herniotomy, the repair of the inguinal ring is not done.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0aeac8d0744e4138bc41f46999891d7cx1280x1584.JPEG"
    ]
  },
  {
    "text": "A patient following a road traffic accident presented with subcutaneous emphysema. On auscultation, there was no air entry on the right side.  Vitals were unstable. What will be your immediate management?",
    "choices": [
      {
        "id": 1,
        "text": "Insertion of wide bore needle in the 5th intercostal space (ICS)"
      },
      {
        "id": 2,
        "text": "Wide bore needle decompression and IV fluids"
      },
      {
        "id": 3,
        "text": "Intubation and positive pressure ventilation"
      },
      {
        "id": 4,
        "text": "eFAST"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:</p>\n<p>Option B: While IV fluids are a <strong>part of the resuscitation protocol</strong>, hypotension in a tension pneumothorax is due to an obstructive type of shock, increasing circulating volume will have minimal effect on improving blood pressure. The management of the primary cause, <strong>tension</strong> <strong>pneumothorax,</strong> takes <strong>higher precedence</strong> as the next immediate step.</p>\n<p>Option C: <strong>Intubation</strong> is performed when the patient is unresponsive <strong>post</strong> <strong>chest</strong> <strong>tube</strong> insertion.&nbsp;</p>\n<p>Option D: Extended Focused Assessment with Sonography in Trauma <strong>(eFAST)</strong> is <strong>not</strong> required before emergency decompression as tension pneumothorax is a <strong>clinical diagnosis</strong>, but it can be performed following chest tube insertion.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/92b076a858c74bcb9ae9acd8b88a22d5x600x1759.JPEG"
    ]
  },
  {
    "text": "A 54-year-old female patient presents with abdominal pain and bilious vomiting. She had a history of abdominal hysterectomy 2 years back. On examination, abdomen auscultation revealed high-pitched bowel sounds. Investigations showed air within the biliary tree. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gallstone ileus"
      },
      {
        "id": 2,
        "text": "Adhesive intestinal obstruction"
      },
      {
        "id": 3,
        "text": "Ischemic enterocolitis"
      },
      {
        "id": 4,
        "text": "Diverticulitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Plain X-rays show air-fluid levels consistent with a small bowel obstruction and pneumobilia can also be visualized on CT imaging.</p>\n<p>Gallstone ileus is managed by an <strong>explorative laparotomy</strong> to relieve the bowel obstruction. The <strong>stone</strong> is milked away from the site of impacted and then crushed or <strong>removed</strong>.</p>\n<p>Other complications of gallstones include biliary colic, acute and chronic cholecystitis, empyema of the gallbladder, mucocele, perforation, acute cholangitis, and acute pancreatitis.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Adhesive intestinal obstruction</strong> is seen after any abdominal surgery or any cause for peritoneal irritation, the features are consistent with <strong>bowel</strong> <strong>obstruction</strong> (air-fluid levels, featureless distal ileum) but there is <strong>no pneumobilia</strong>.</p>\n<p>Option C: <strong>Ischaemic</strong> <strong>colitis</strong> on contrast-enhanced CT of the abdomen (<strong>CECT</strong>) shows <strong>bowel wall thickening</strong>, and signs of <strong>vascular</strong> <strong>insufficiency</strong>.</p>\n<p>Option D: <strong>Diverticulitis</strong> on CT abdomen shows <strong>bright</strong> <strong>bowel</strong> <strong>outpouching</strong>, which may be complicated by infection and abscess formation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d9584d9e07d5409280c53ab3e63fc802x527x630.JPEG"
    ]
  },
  {
    "text": "In a patient with abdominal pain and sterile pyuria, what is the finding shown in the image given?",
    "choices": [
      {
        "id": 1,
        "text": "Putty kidney"
      },
      {
        "id": 2,
        "text": "Nephrocalcinosis"
      },
      {
        "id": 3,
        "text": "Staghorn calculus"
      },
      {
        "id": 4,
        "text": "Psoas calcification"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Psoas</strong> <strong>calcification</strong> is a muscle calcification that develops after <strong>acute renal failure</strong> and <strong>rhabdomyolysis</strong>. It is <strong>not</strong> associated with sterile pyuria.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f4f50c5f1f674ce89ce50d157a6fa490.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9b7fc3c5c6a45698024013c1ae6f717x1280x1703.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ef8a12be91346fcbbf1110c83f50f74x490x649.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11138d2cb6824c879bc3b2b05541cc10x502x449.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/671962f1854c4c7186982ec8d1359b23x441x548.PNG"
    ]
  },
  {
    "text": "A patient was found to have a mass arising from the antrum of the stomach which involves the head of the pancreas and metastasis to the right lobe of the liver. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Palliative gastrojejunostomy followed by chemotherapy"
      },
      {
        "id": 2,
        "text": "Radical gastrectomy"
      },
      {
        "id": 3,
        "text": "Whipple's procedure"
      },
      {
        "id": 4,
        "text": "Gastrectomy with right hepatectomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:</p>\n<p>Option B: <strong>Radical gastrectomy</strong>\u00a0is done in\u00a0<strong>proximal gastric cancer and linitis plastica.</strong></p>\n<p>Option C: <strong>Whipple\u2019s procedure</strong> is done for <strong>gastric carcinoma</strong> that has <strong>spread</strong> to the <strong>head </strong>of the<strong> pancreas.\u00a0</strong>Since the patient already has metastases to the liver, this will not be the preferred option.</p>\n<p>Option D: <strong>Gastrectomy</strong> with <strong>right hepatectomy</strong> is done in <strong>gastric cancer</strong> that has<strong> hepatic metastasis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65c6e3d53eda4ceaae735070727222fex1280x2106.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e931c7d18db047e3812c4baf744f7272x1280x5287.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17b42c2604cc48a38f103a33ebb730dax1280x2558.JPEG"
    ]
  },
  {
    "text": "A patient underwent cholecystectomy for gallstones over 2 years ago. She now presents with symptoms of obstructive jaundice. Investigation reveals a stone in the common bile duct. What is the stone most likely to be?",
    "choices": [
      {
        "id": 1,
        "text": "Primary"
      },
      {
        "id": 2,
        "text": "Secondary"
      },
      {
        "id": 3,
        "text": "Tertiary"
      },
      {
        "id": 4,
        "text": "Retained"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient has a history of cholecystectomy done for gallstones 2 years ago. Thus, in this patient with choledocholithiasis, the stones found in the common bile duct would most likely be <strong>primary stones.</strong></p>\n<p>Choledocholithiasis or common bile duct stones are classified based on their point of origin:</p>\n<ul>\n<li><strong>Primary stones</strong> are <strong>brown pigment</strong> stones that arise de novo in the bile duct and are composed of bile pigments and cholesterol.</li>\n<li><strong>Secondary stones</strong> (option B) are usually <strong>cholesterol stones</strong>, which originate in the gall bladder and pass down into the common bile duct. Since this patient has already undergone cholecystectomy more than 2 years ago, secondary stones are unlikely.</li>\n<li>When stones are found in the common bile duct <strong>within 2 years</strong> of history of cholecystectomy, they are termed <strong>retained stones</strong> (option D).</li>\n<li>If they are found <strong>more than 2 years</strong> after cholecystectomy, they are known as <strong>recurrent stones </strong>(which are <strong>mostly primary)</strong>.</li>\n</ul>\n<p>Clinical features: Mostly clinically silent, but may present with biliary colic and even obstructive jaundice. When there is <strong>fever, jaundice</strong>, and associated <strong>right upper quadrant abdominal pain</strong>, it is known as <strong>Charcot&rsquo;s triad</strong>, seen in cholangitis.</p>\n<p><strong>Management of choledocholithiasis</strong>:<br />ERCP +/- sphincterotomy followed by laparoscopic cholecystectomy is the most preferred management of choledocholithiasis.</p>\n<p>If stones cannot be removed through ERCP and sphincterotomy, then common bile duct exploration is carried out intraoperatively either in an open procedure or via laparoscopy. A T-tube is left in place after choledochotomy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old female patient presents with pain in the thigh during walking. Investigation reveals the following finding as given below. What will be the best surgical management?",
    "choices": [
      {
        "id": 1,
        "text": "PTA with stenting"
      },
      {
        "id": 2,
        "text": "Iliofemoral bypass"
      },
      {
        "id": 3,
        "text": "Aortofemoral bypass"
      },
      {
        "id": 4,
        "text": "Aorto-iliac bypass"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The symptom of pain in the thigh while walking and the given angiography image showing common iliac artery obstruction is suggestive of&nbsp;<strong>peripheral obstructive vascular disease </strong>with <strong>aortoiliac obstruction. </strong>The best surgical course, in this case, is to perform an<strong> aortofemoral bypass.</strong></p>\n<p>Clinical findings of aortoiliac obstruction are <strong>:</strong></p>\n<ul>\n<li><strong>Intermittent claudication</strong> is the debilitating&nbsp;<strong>cramp-like pain</strong>&nbsp;felt in the buttocks, leg, and thigh muscles due to&nbsp;<strong>reduced blood flow</strong>.&nbsp;</li>\n<li>Femoral and distal pulses are&nbsp;<strong>absent</strong> in both limbs.</li>\n<li><strong>Arterial bruit</strong>&nbsp;is heard over the aortoiliac region.</li>\n<li>Impotence (Leriche syndrome) may occur. Buttock claudication is present.</li>\n</ul>\n<p>As the disease progresses, rest pain, ulceration, gangrene, and slow capillary refilling may be seen.</p>\n<p><strong>CT angiography (CTA)</strong> and <strong>MR angiography (MRA)</strong> are specific investigations. Doppler ultrasound, duplex scanning, and digital subtraction percutaneous angiography (DSA) are the other available investigations.</p>\n<p>An<strong> aortofemoral bypass </strong>is the choice of surgical intervention in&nbsp;aortoiliac obstruction.<strong> Dacron graft</strong>&nbsp;is a collagen-impregnated, knitted graft that is used to perform the proximal aortic anastomosis in aortofemoral bypass. It can also be used in aortic valve repair. In unfit patients, axillofemoral bypass may be done.</p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Percutaneous Transluminal Angioplasty (PTA)</strong> is most useful in the treatment of <strong>isolated iliac stenoses</strong> (&lt;4cm in length) than in occlusive disease.&nbsp;&nbsp;</p>\n<p>Option B:<strong> Iliofemoral bypass&nbsp;</strong>is&nbsp;done in patients with unilateral occlusion of the <strong>distal</strong> common iliac or external iliac arteries.</p>\n<p>Option D:&nbsp;<strong>Aortoiliac bypass&nbsp;</strong>more commonly known as the aortoiliac endarterectomy is rarely performed now a days because of greater blood loss associated with this surgery and greater sexual dysfunction caused, additionally it is difficult to perform.<br /><br /><strong>Note</strong>: Aortofemoral bypass surgery has long-term patency of 70-80% at 10years and is often done bilaterally as the occlusion is more likely to be bilateral with one side affected more severely than the other. Bilateral aortofemoral bypass does not add to physiological stress and has equal benefits comparatively.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f8bab0143a0a44aebac8b596cf5c70dd.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young air-hostess presented to the outpatient department with dilated veins on her left leg (image). According to the CEAP classification for varicose veins, what will be the C stage in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "C2A"
      },
      {
        "id": 2,
        "text": "C2S"
      },
      {
        "id": 3,
        "text": "C4a"
      },
      {
        "id": 4,
        "text": "C1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 995\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>&nbsp;</p>\n<p>The images below show C5 and C6 - healed and active venous ulcers respectively.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/299dec7ce467441ab2587d7d16a6c1e8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a8710644f6454710bb237aa02464cb00x464x1513.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/782e30f3abda49e68ea3f6ee3e5a484ax1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0400f6b898e040d89a286cfd17edf069x495x375.PNG"
    ]
  },
  {
    "text": "An alcoholic patient presented with severe abdominal pain. Pancreatitis was suspected and a CT scan revealed lesions with fluid collected near the body of the pancreas. Which of the following enzymes is most likely to be elevated in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Serum GGT"
      },
      {
        "id": 2,
        "text": "CEA"
      },
      {
        "id": 3,
        "text": "Serum lipase"
      },
      {
        "id": 4,
        "text": "Serum bilirubin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In an <strong>alcoholic</strong> patient with <strong>acute</strong> <strong>pancreatitis</strong>, <strong>serum</strong> <strong>lipase</strong> is the enzyme most likely to be elevated.</p>\n<p>Acute pancreatitis is often caused by <strong>gallstones</strong> (70%) or alcoholism (25%). The <strong>cardinal</strong> <strong>symptom</strong> is <strong>acute-onset severe pain</strong> in the <strong>upper quadrant</strong> of the <strong>abdomen</strong>. The patient usually presents in shock (hypotension and tachycardia) and tachypnoea. Some may also present with signs of bleeding into the fascial planes leading to discoloration of the sites involved:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cullen&rsquo;s sign: Around the umbilicus</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Grey Turner&rsquo;s sign: Flanks</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Fox sign: Inguinal region</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bryant&rsquo;s sign: Scrotum</li>\n</ol>\n<p>The diagnosis is often <strong>clinical</strong> with a laboratory diagnosis. Though serum amylase (&gt;3 times) is indicative of pancreatitis, <strong>serum</strong> <strong>lipase</strong> is <strong>preferred</strong> over serum <strong>amylase</strong> as it is more <strong>sensitive</strong> and <strong>specific</strong>. Contrast-enhanced tomography <strong>(CECT)</strong> of the <strong>abdomen</strong> can be used to exclude pancreatitis if in doubt.</p>\n<p>The <strong>severity</strong> of the acute pancreatitis is assessed using the <strong>Ranson and Glasgow</strong> scoring system ( &ge;3 at 48h of onset of pain ). APACHE, SOFA, SAPS, and MODS can also be used to assess the severity of pancreatitis in intensive care (ICU) settings.&nbsp;&nbsp;Pancreatitis is managed <strong>conservatively</strong> with initial nasogastric drainage followed by intravenous fluids, analgesia, and frequent monitoring of vital signs, urine output, and blood gases.</p>\n<p>Other options:</p>\n<p>Option A: Serum gamma-glutamyl transferase (GGT) can also be elevated. It is a biomarker for pancreatic disease and alcohol consumption but is not sensitive and specific to acute pancreatitis.</p>\n<p>Option B: Carcinoembryonic antigen <strong>(CEA)</strong>, a <strong>tumor marker</strong> that is elevated in the adenocarcinoma of the pancreas.</p>\n<p>Option D: <strong>Elevated serum bilirubin</strong> is a result of (i) overproduction of bilirubin (E.g: hemolytic anemia) or (ii) impaired uptake by the liver (liver cirrhosis) or (iii) regurgitation of bilirubin (obstructive jaundice). It is <strong>not seen</strong> in acute pancreatitis.<br /><br /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old patient presents with abdominal pain and fever for 3 days duration. The chest X-ray in the erect position is given below. What will be the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric volvulus"
      },
      {
        "id": 2,
        "text": "Hollow viscus perforation"
      },
      {
        "id": 3,
        "text": "Liver abscess"
      },
      {
        "id": 4,
        "text": "Empyema thoracis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: Empyema thoracis is an <strong>infection</strong> of the <strong>pleural space.</strong>&nbsp;An empyema thoracis on a chest X-ray can <strong>mimic a pleural effusion or a lung abscess.</strong>The fluid is commonly drained completely with a chest tube or small-bore catheter.</p>\n<p>The chest radiograph showing pleural empyema.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ce2b590de54e4e438c22d64c59229f86.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd1e84119c69416fb1a65f0ccd373deax1280x1410.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc8457c92a734e949c8463f34c2d087ax512x475.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4772b06e9cc49f2abdf9c13ccc96b9cx291x303.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ce8319786d1c4babb7d4e78e90593131x329x364.PNG"
    ]
  }
];
        let quizName = '234 Surgery Neet 2021';
        let hierarchy = ["Marrow", "PYQs", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>