<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chest Pain Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A young, previously healthy man presents to the emergency department with chest pain and shortness of breath that occurred at rest. His BP is 132/90 in both arms, RR is 21, HR: 120. He reports snorting cocaine about an hour ago.  An EKG shows ST segment elevations, and troponins are normal. Sublingual nitroglycerin promptly relieves his chest pain. What is the most likely mechanism of his chest pain?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic dissection"
      },
      {
        "id": 2,
        "text": "Pulmonary embolus"
      },
      {
        "id": 3,
        "text": "Coronary vasospasm"
      },
      {
        "id": 4,
        "text": "Myocardial Infarction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient appears to be having symptoms and EKG signs of <strong>Prinzmetal/Variant/Vasospastic angina</strong>, likely due to cocaine use.</p>\n<p><strong>Cocaine inhibits monoamine </strong>(dopamine, norepinephrine, epinephrine, and serotonin) <strong>reuptake</strong> and acts as a<strong> vasoconstrictor - </strong>can lead to a decrease in blood flow to the heart: Chest pain, and shortness of breath. This sympathetic stimulation can occur at all concentrations of cocaine and <strong>causes</strong> hypertension and ventricular ectopics. Cocaine can also increase heart rate and blood pressure, which further worsens these symptoms. The first-line agents that are used are <strong>calcium channel blockers (CCBs)</strong> and <strong>nitrates.</strong></p>\n<p><strong>Prinzmetal angina </strong>occurs as a result of vasospasm of the epicardial coronary artery. It may result in transient transmural ischemia. The cause of this spasm is poorly understood and is suspected to be due to <strong>hypercontractility</strong> of cardiac smooth muscles. This type of angina is commonly seen in <strong>women</strong> under 50 years of age and is precipitated by <strong>smoking</strong> and <strong>cocaine</strong> use.</p>\n<p>The vasospasm leads to<strong> transmural ischemia,\u00a0</strong>which is seen on the ECG as transient\u00a0<strong>ST-segment elevation although</strong>\u00a0there is no atherosclerosis present on angiography.\u00a0</p>\n<p>Depolarization of cardiac myocytes depends primarily on the influx of Ca<sup>2+\u00a0</sup>ions. Ca <sup>2+\u00a0</sup>antagonists relax arterial smooth muscle, thereby <strong>decreasing</strong> arterial <strong>resistance,</strong> <strong>blood pressure</strong>, and <strong>cardiac afterload</strong>. Hence, calcium channel blockers such as long-acting <strong>nifedipine and amlodipine</strong> are employed along with <strong>nitrates</strong> to alleviate vasospasm.</p>\n<p>Cocaine is obtained from the plant <strong><em>Erythroxylum coca</em>.</strong>\u00a0The symptoms of cocaine poisoning are divided into two stages:</p>\n<ol>\n<li><strong>Stage of excitement:</strong> This stage is characterized by features like dysphagia, dryness in the mouth, tachycardia, and dilated pupils. The reflexes are exaggerated and are associated with tingling and numbness in the hands and feet.\u00a0</li>\n<li><strong>Stage of depression</strong>: This stage presents with feeble respiration, profuse sweating, convulsions, and death. In most cases, the cause of death is cardiopulmonary failure or vascular collapse.</li>\n</ol>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b70d2bb24022494a9171d7143c07b1c0x904x632.PNG"
    ]
  },
  {
    "text": "A 60-year-old male patient presents with chest pain that is described as a squeezing sensation in the center of his chest. The pain has been present for 30 minutes and is not relieved by rest or sublingual nitrates.  EKG revealed ST depression and T wave inversion in anterior chest leads The patient has a history of hypertension and hyperlipidemia. Which risk scoring system can be used for diagnosis and treatment for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "HEART score"
      },
      {
        "id": 2,
        "text": "CHADS2VAS2 score"
      },
      {
        "id": 3,
        "text": "GRACE score"
      },
      {
        "id": 4,
        "text": "TIMI score"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Chest pain for &gt;20 minutes not relieved by rest/nitrates and ST depression and T wave inversion in anterior chest leads is suspicious for a diagnosis of <strong>unstable angina or NSTEMI</strong>. Unstable angina is a subtype of <strong>acute coronary syndrome</strong> (ACS). The <strong>TIMI Score\u00a0</strong>is a <strong>clinical risk score</strong> tht helps stratify patients with UA/NSTEMI to different risk categories.</p>\n<p>\u00a0<strong>Non-ST-segment elevation acute coronary syndrome</strong> (NSTE-ACS): Unstable angina and Non-ST-segment elevation myocardial infarction (NSTEMI)</p>\n<p style=\"text-align: left;\">The diagnosis of NSTE-ACS is based on the following:</p>\n<p><strong>1. Severe chest discomfort</strong> with at least <strong>one of 3</strong> features:</p>\n<ul>\n<li>Occurring at rest or minimal exertion and lasting for more than 10 minutes</li>\n<li style=\"text-align: left;\">Recent onset</li>\n<li style=\"text-align: left;\">Crescendo pattern</li>\n</ul>\n<p style=\"text-align: left;\"><strong>2. ECG</strong> showing: <strong>ST segment depression and/or </strong><strong>T wave inversion</strong></p>\n<p style=\"text-align: left;\"><strong>3. Troponins: </strong>elevated in the case on NSTEMI.</p>\n<p style=\"text-align: left;\">The<strong> TIMI Risk Score</strong> is based on <strong>seven variables</strong>:</p>\n<ul>\n<li data-sourcepos=\"13:1-13:15\">Age <strong>\u226565 </strong>years</li>\n<li data-sourcepos=\"14:1-14:105\"><strong>\u22653 </strong>cardiovascular<strong> risk factors</strong> (hypertension, hyperlipidemia, diabetes, smoking, family history of CAD)</li>\n<li data-sourcepos=\"15:1-15:11\"><strong>Known CAD</strong></li>\n<li data-sourcepos=\"16:1-16:32\"><strong>Aspirin use</strong> in the past 7 days</li>\n<li data-sourcepos=\"17:1-17:41\"><strong>Severe angina</strong> (\u22652 episodes in 24 hours)</li>\n<li data-sourcepos=\"18:1-18:24\">EKG <strong>ST </strong>changes<strong> \u22650.5 mm</strong></li>\n<li data-sourcepos=\"19:1-20:0\">Positive <strong>cardiac marker</strong></li>\n</ul>\n<p>Management of NSTE-ACS: To provide relief of pain and discomfort, initial treatment includes bed rest, <strong>nitrates</strong>, <strong>beta blockers,</strong> and inhaled <strong>oxygen</strong> (only if arterial O2 saturation &lt;90%).</p>\n<ul>\n<li><strong>Dual antiplatelet therapy</strong> (DAPT): Aspirin (162-325 mg) AND one ADP receptor inhibitor (Ticagrelor, clopidogrel or prasugrel)</li>\n<li><strong>Anticoagulation:</strong> Enoxaparin, unfractionated heparin, fondaparinux or bivalirudin</li>\n<li>An early invasive strategy including <strong>diagnostic coronary angiography</strong> (within 2\u201372 hours of presentation) followed by <strong>revascularization </strong>(percutaneous coronary intervention/ coronary artery bypass grafting) is indicated for stabilized patients who are at high risk of coronary events (Based on TIMI, GRACE or HEART score).</li>\n</ul>\n<p>Other options:</p>\n<p>Option A:<strong> HEART score: </strong>Clinical risk score used to predict the risk of 30-day mortality in patients with <strong>acute heart failure</strong>.\u00a0</p>\n<p data-sourcepos=\"14:3-14:177\">Option B:<strong> CHA2DS2-VASc score:</strong> The CHA2DS2-VASc score is a clinical risk score used to predict the risk of stroke in patients with atrial fibrillation.\u00a0</p>\n<p>Option C: <strong>GRACE score: </strong>The GRACE score is a clinical risk score used to predict the 6-month risk of death or myocardial infarction (MI) in patients with acute coronary syndrome (ACS).</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man who underwent cholecystectomy a week ago presents with fever and chest pain that is worse on inspiration and lying to his right. Physical examination reveals right upper quadrant tenderness and exquisite pain on palpating the chest. Chest xray is unremarkable except for the blunting of the right costophrenic angle. Thoracentesis reveals cloudy fluid. Which of the following is the most likely cause of the patient's chest pain?",
    "choices": [
      {
        "id": 1,
        "text": "Parapneumonic effusion"
      },
      {
        "id": 2,
        "text": "Subdiaphragmatic abscess"
      },
      {
        "id": 3,
        "text": "Lung abscess"
      },
      {
        "id": 4,
        "text": "Diaphragmatic hernia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with a recent history of <strong>abdominal surgery</strong>, <strong>right upper quadrant pain</strong>, and now, chest pain demonstrating fluid collection is suggestive of a <strong>subdiaphragmatic abscess </strong>that has<strong> tracked </strong>into the <strong>pleural space</strong>.</p>\n<p>When there is <strong>chest pain with fever</strong>: <strong>pneumonia</strong>, <strong>pleural effusion</strong>, <strong>pericarditis, pulmonary embolism, </strong>and <strong>subdiaphragmatic abscess</strong> must be considered.\u00a0\u00a0</p>\n<p data-sourcepos=\"5:1-5:86\">The clinical presentation of subdiaphragmatic abscess(SDA) includes <strong>pleuritic chest pain, foul-smelling sputum, </strong>and marked<strong> chest-wall tenderness </strong>and pain in the<strong> right upper quadrant.</strong> SDA is typically diagnosed based on the <strong>clinical</strong> presentation <strong>chest X-ray or ultrasound</strong>. In some cases, a <strong>needle aspiration</strong> of the abscess may be necessary to confirm the diagnosis. <strong>Antibiotics and needle drainage</strong> may be required to treat the SDA. <strong>SDA</strong> would demonstrate a <strong>transudative</strong> <strong>effusion</strong>.</p>\n<p data-sourcepos=\"3:1-3:34\">The <strong>Light's criteria</strong> are as follows:</p>\n<ul data-sourcepos=\"5:1-8:0\">\n<li data-sourcepos=\"5:1-5:53\">Pleural fluid protein/serum protein ratio <strong>&gt; 0.5</strong></li>\n<li data-sourcepos=\"6:1-6:67\">Pleural fluid lactate dehydrogenase (LDH)/serum LDH ratio <strong>&gt; 0.6</strong></li>\n<li data-sourcepos=\"7:1-8:0\">Pleural fluid LDH &gt; two-thirds upper limit of normal for serum LDH</li>\n</ul>\n<p data-sourcepos=\"9:1-9:80\">If <strong>any one of these criteria is met</strong>, the effusion is considered to be <strong>exudative</strong>. The Light criteria are very sensitive for exudative effusions, but they are not very specific.</p>\n<p data-sourcepos=\"25:1-25:211\">Option A:<strong>\u00a0</strong>A <strong>parapneumonic effusion</strong> is a pleural effusion associated /secondary to either bacterial pneumonia, lung abscess, or bronchiectasis. If this further progresses, it may yield a turbid fluid as well. However, this is unlikely in this patient with no signs of pneumonia such as cough or <strong>consolidation</strong> on x-ray.</p>\n<p data-sourcepos=\"25:1-25:211\">Option C:<strong> Lung abscess</strong> is a collection of pus in the lung. It can be caused by various factors, including infection from a subdiaphragmatic abscess. However, lung abscess is less likely than subdiaphragmatic abscess extension to cause chest pain in this case, because the patient does <strong>not have any other symptoms of lung abscess</strong>, such as cough and sputum production.</p>\n<p data-sourcepos=\"25:1-25:211\">Option D: Esophageal perforation can present as chest pain and subcutaneous emphysema. (Boerhaave syndrome) The lower esophagus towards the <strong>left pleural cavity i</strong>s the most common perforation site. A crunching sound is heard during the auscultation of the chest (<strong>Hamman's sign</strong>) due to subcutaneous emphysema. Other findings include tachypnea, tachycardia, fever, and hypotension. Diaphoresis and abdominal rigidity can also be present. Gastric acid and ingested food are ejected into the left chest and the <strong>left pleural effusion </strong>rapidly accumulates.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old male presents with sudden onset, tearing chest pain that radiates to the back. Blood pressure in right arm is 110/80, left arm is 160/100. An ascending thoracic dissection is suspected and he is given labetalol, but continues to have severe chest pain. He develops breathlessness and hypotension with jugular venous distention.  What is the most appropriate next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Chest tube insertion"
      },
      {
        "id": 2,
        "text": "Pericardiocentesis"
      },
      {
        "id": 3,
        "text": "Nitroglycerin"
      },
      {
        "id": 4,
        "text": "Coronary angiography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient likely has a type A dissection that has extended to cause a <strong>cardiac tamponade due to hemopericardium. The next</strong>\u00a0step in his management would be to perform<strong> a pericardiocentesis.</strong></p>\n<p>Cardiac tamponade is characterized by the accumulation of fluid in the pericardial space leading to <strong>impairment of diastolic relaxation</strong> of the cardiac chambers. This leads to a decline in cardiac output. The characteristic signs of cardiac tamponade are:</p>\n<ul>\n<li>Tachycardia and<strong> hypotension</strong></li>\n<li>Pericardial rub</li>\n<li><strong>Pulsus paradoxus</strong> - paradoxical reduction in the systemic blood pressure <strong>(&gt;10 mm Hg)</strong> on inspiration.</li>\n<li><strong>Beck's triad</strong> - <strong>hypotension, muffled heart sounds,</strong> and <strong>elevated jugular venous pressure</strong> with prominent x descent and absent y descent. The sensitivity of jugular venous distention in detecting tamponade is 100%.</li>\n</ul>\n<p>ECG shows reduced voltage and <strong>electrical alternans</strong>; an Echocardiogram shows a <strong>swinging heart sign</strong>.</p>\n<p>In a patient with clinical features suggestive of tamponade, the best course of action is performing <strong>pericardiocentesis</strong>, preferably carried out under echocardiographic guidance. Definitive management includes emergency thoracotomy or sternotomy\u00a0</p>\n<p>Risk factors for aortic dissection:<br />1. <strong>Hypertension</strong> (most common risk factor)<br />2. Atherosclerosis (<strong>second most common</strong> risk factor)<br />3. Known/prior aortic aneurysm or dissection<br />5. Diabetes\u00a0<br />6. Marfan syndrome<br />7. Cocaine use, particularly in younger patients.</p>\n<p>An aortic dissection is initiated by an <strong>intimal tear</strong>, which allows blood to penetrate the medial layer, producing a cleavage plane (false lumen) between the inner two-thirds and outer one-third of the media. The true lumen is separated from the false lumen by an intimomedial flap.</p>\n<p>Predisposing factors for aortic dissection are:</p>\n<ul>\n<li>Age</li>\n<li><strong>Hypertension</strong></li>\n<li>Marfan syndrome</li>\n<li>Pregnancy</li>\n<li>Other <strong>connective tissue disorders</strong>, for example, Ehlers\u2013Danlos syndrome, giant cell arteritis, systemic lupus erythematosus</li>\n<li>Coarctation of the aorta</li>\n<li><strong>Turner or Noonan</strong> syndromes</li>\n<li>Aortic cannulation site (iatrogenic)</li>\n</ul>\n<p>Clinical features:</p>\n<p>The most typical presentation of aortic dissection is a tearing interscapular pain.<br />The tracheal tug sign, also known as<strong> Oliver\u2019s sign</strong>, is seen in the arch of the aorta aneurysm.<br /><br />The dissection can extend <strong>distally</strong> down the aorta to involve the:</p>\n<ul>\n<li>Renal arteries (renal pain and renal failure)</li>\n<li>Mesenteric arteries (abdominal pain and bowel ischemia)</li>\n<li>Spinal arteries (paraplegia)</li>\n<li>Iliac arteries (leg pain, pallor, loss or reduced pulses, and limb ischemia).</li>\n<li>The dissection may track proximally to involve the:Head and neck vessels (symptoms and signs of a stroke or transient ischaemic attack)</li>\n<li>Coronary vessels (MI)</li>\n<li>Aortic root (aortic regurgitation)</li>\n</ul>\n<p>On examination, unequal pulses or blood pressure in the extremities may be seen due to changes of flow in the true and false lumens. There can be hypertension or hypotension, loss of pulses, findings of aortic regurgitation, and pulmonary edema.\u00a0</p>\n<p>Imaging:\u00a0</p>\n<p><strong>Transesophageal echocardiography</strong> (TEE) is the investigation of choice in a hemodynamically unstable patient. In hemodynamically stable patients, the diagnosis is established with a contrast-enhanced CT scan.\u00a0</p>\n<p>Treatment options:</p>\n<p>Stanford type A (DeBakey types I and II) requires <strong>surgical</strong> intervention once the patient's blood pressure is stabilized.<br />Stanford type B (DeBakey type III) is best managed by <strong>antihypertensive</strong> drugs. Surgical intervention is indicated in complicated cases if the pain increases (signaling impending rupture) or when there is evidence of malperfusion of organs or neurological symptoms.</p>\n<p>Option A: Chest tube insertion would be appropriate for a <strong>pneumothorax</strong>, which is unlikely in this case. A tension pneumothorax may present with signs of hypotension and jugular venous distention, but there would be a tracheal deviation and hyper resonance to percussion.</p>\n<p>Option C: Nitroglycerin may be useful to further <strong>lowering blood pressure</strong>. It would not be helpful in this case, the dissection has extended to cause a tamponade and needs pericardiocentesis.</p>\n<p>Option D: Aortic dissection can extend to involve the coronary arteries and cause a <strong>myocardial infarction</strong>, which would <strong>warrant a coronary angiography</strong>, however, it is unlikely in this case, given the presence of Beck's triad and low voltage complexes. On EKG, ST changes would be expected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old man presents to the emergency department due to chest pain. He describes it as sharp and worsens on lying supine or breathing deeply. An EKG is obtained and shows PR depression and diffuse ST elevations. Which of the following is most likely to be found on cardiac examination?",
    "choices": [
      {
        "id": 1,
        "text": "S3"
      },
      {
        "id": 2,
        "text": "Triphasic rub"
      },
      {
        "id": 3,
        "text": "Midsystolic click"
      },
      {
        "id": 4,
        "text": "Diastolic rumble"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Considering the patient's symptoms and EKG findings, the most likely finding on cardiac examination is a <strong>triphasic rub</strong>.\u00a0</p>\n<p><strong>Acute pericarditis</strong> is an inflammation of the pericardium characterized by <strong>retrosternal chest pain</strong> that is <strong>aggravated by deep inspiration</strong> and <strong>supine position</strong> and <strong>relieved by sitting and leaning forward</strong>. It can be attributed to various causes like infections or inflammatory conditions like RA and SLE, or miscellaneous causes like iatrogenic, neoplasms, drugs, etc.</p>\n<p>A pericardial <strong>rub</strong> is nearly <strong>100% specific</strong> to pericarditis. This appears as a rough <strong>scratching sound at the end of expiration</strong> when the patient is <strong>sitting and leaning forward.</strong> It is usually<strong> triphasic; ventricular systole, early diastolic filling, </strong>and<strong> late presystolic filling after atrial contraction.\u00a0</strong></p>\n<p>Types of pericarditis and their causes:</p>\n<p><strong>Serous pericarditis</strong>: It is seen in rheumatic fever, SLE, systemic scleroderma, tumors, uremia, viral infection, or tuberculosis. Mild inflammation of epicardial and pericardial surfaces. Exudative serous fluid which is usually only 50\u2013200 mL thus, it develops slowly and rarely alters cardiac function.</p>\n<p><strong>Suppurative (purulent) pericarditis</strong>: Bacterial, mycotic, or parasitic invasion<br />Enter pericardial space by direct extension, seeding from blood, lymphatic spread, and seeding by instrumentation. Inflammation may extend into the surrounding mediastinum. Usually, this results in the organization and, therefore, constrictive pericarditis with clinical sequelae</p>\n<p><strong>Hemorrhagic pericarditis</strong>: Tuberculosis or malignant neoplasm (from lung or breast). This can also be seen following cardiac surgery</p>\n<p><strong>Caseous pericarditis</strong>: Almost always tubercular in origin</p>\n<p>ECG findings of acute pericarditis need to be differentiated from those of myocardial infarction as they are similar. There are <strong>four stages</strong> in the development of acute pericarditis ECG changes.</p>\n<ul>\n<li>Stage 1: <strong>Widespread elevation of ST</strong> segments; <strong>depression</strong> of <strong>PR segment below the TP </strong>segment</li>\n<li>Stage 2: <strong>ST segments return to normal</strong> after a few days</li>\n<li>Stage 3: <strong>T waves </strong>become <strong>inverted</strong></li>\n<li>Stage 4: ECG<strong> returns to normal </strong>after weeks or months.\u00a0</li>\n</ul>\n<p>Echocardiography is diagnostic for acute pericarditis. It would reveal a small amount of pericardial fluid. It can also be confirmed by CT or MRI. Treatment of acute pericarditis is nonspecific. <strong>Non-steroidal anti-inflammatory drugs</strong> are recommended, along with bed rest.</p>\n<p>Option A: S3 can be physiological in young adults due to hyperdynamic circulation, but is almost always pathological in older adults. It occurs in states where this is high-output (anemia, thyrotoxicosis, pregnancy) or volume overload (LV failure). Pericarditis in and of itself does not have a hyperdynamic state.</p>\n<p>Option C: A mid-systolic click would be seen in Mitral valve prolapse and is followed by a late systolic murmur.</p>\n<p>Option D:\u00a0 A (low-pitched) diastolic rumble is seen in mitral stenosis; usually preceded by an opening snap, which is heard soon after S2.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with sickle cell disease presents to the emergency room with chest pain and respiratory distress. He is tachycardic, tachypenic, and has bibasilar crackles. The pulse oximeter shows 85% saturation in room air. Chest X-ray shows new radiodensities. Sputum and blood culture showed no growth. What is the pathophysiology behind the cause of his chest pain?",
    "choices": [
      {
        "id": 1,
        "text": "Vaso-occlusion of pulmonary vasculature"
      },
      {
        "id": 2,
        "text": "Widespread constriction of bronchioles"
      },
      {
        "id": 3,
        "text": "Increased microvascular permeability of alveoli"
      },
      {
        "id": 4,
        "text": "Accumulation of air in the pleural space"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of<strong> acute chest syndrome</strong>, which occurs due to sickling of the RBCs, leading to <strong>vasocclusion of the pulmonary vasculature</strong>.</p>\n<p>Acute chest syndrome (ACS) refers to a life-threatening pulmonary complication of sickle cell disease. It is diagnosed with the presence of a <strong>new radiodensity</strong> on chest radiography with any 2 of the following:</p>\n<ul>\n<li><strong>Fever\u00a0</strong></li>\n<li><strong>Respiratory distress</strong></li>\n<li><strong>Hypoxia</strong></li>\n<li><strong>Cough</strong></li>\n<li><strong>Chest pain</strong></li>\n</ul>\n<p>\u00a0Note that ACS must be suspected in children with sickle cell disease even in the absence of respiratory symptoms.\u00a0</p>\n<p>Most patients with ACS do not have a single identifiable cause. Infection is the most well-known etiology, yet only 30% of ACS episodes will have positive sputum or bronchoalveolar culture. The most common bacterial pathogens implicated are <strong>S. pneumoniae, Mycoplasma pneumoniae, and Chlamydia spp.</strong></p>\n<p><strong>Oxygen</strong> should be supplemented to all patients who demonstrate hypoxia.\u00a0Blood transfusion is the only method to abort a rapidly progressing episode of ACS.</p>\n<p>Because of the clinical <strong>overlap between pneumonia and ACS</strong>, all episodes should be treated promptly with antimicrobial therapy, including at least a <strong>macrolide</strong> and possibly a<strong> third-generation cephalosporin.</strong></p>\n<p>Regular use of an <strong>incentive spirometer</strong> at 10-12 breaths every 2 hours can significantly reduce the frequency of subsequent acute chest pain episodes.</p>\n<p>Option B: <strong>Asthma i</strong>s characterized by reversible <strong>bronchoconstriction</strong> caused by airway hyperresponsiveness to a variety of stimuli. Radiodensities are unlikely to be seen in this case.\u00a0</p>\n<p>Option C:\u00a0In <strong>pulmonary edema</strong>, excess fluid in the bloodstream can increase the <strong>pressure in the blood vessels</strong>, particularly in the pulmonary circulation. The elevated pressure can cause <strong>fluid to leak</strong> from the small blood vessels in the lungs into the air spaces. Features include shortness of breath and impaired gas exchange, as the fluid-filled air spaces in the lungs make it difficult for oxygen to pass from the air into the bloodstream. In severe cases, it can lead to respiratory failure and can be life-threatening.\u00a0</p>\n<p>Option D: Air in the pleural space refers to <strong>pneumothorax</strong>. There would be hyperresonance and lack of lung/vascular markings in this case.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old male presents with a sharp chest pain that worsens and radiates to the arms and shoulders on deep breathing and coughing. He has no other symptoms. On examination, there is tenderness over the junction between the 2nd intercostal cartilage and rib. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Costochondritis"
      },
      {
        "id": 2,
        "text": "Pleuritic pain"
      },
      {
        "id": 3,
        "text": "Rib fracture"
      },
      {
        "id": 4,
        "text": "Pericarditis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Costochondritis</strong> is the inflammation of the costochondral junction and is the <strong>most common cause</strong> of <strong>non-cardiac</strong> chest pain in young adults. The pain is typically <strong>sharp </strong>and <strong>localized </strong>to the area of inflammation. It may be exacerbated and can radiate to the arms, shoulders, and neck by<strong> deep breathing, coughing, </strong>and<strong> physical activity.</strong></p>\n<p>Musculoskeletal chest pain is a broad term that refers to chest pain due to inflammation/pathology in the connective tissue of the chest wall. It is important to differentiate musculoskeletal chest pain from cardiac chest pain, as the treatments for the two conditions are different.</p>\n<p>Some causes of musculoskeletal causes of chest pain:</p>\n<ul>\n<li>Costochondritis: Inflammed costochondral junctions.</li>\n<li>Precordial catch syndrome: A sudden, sharp chest pain that worsens with inspiration.</li>\n<li>Tietze syndrome: Inflammation of the cartilage that connects the second rib to the sternum.</li>\n<li>Pectoral muscle strain: Stretching or tearing of the pectoral muscles.</li>\n<li>Rib fracture: A break in one or more ribs.</li>\n<li>Cervical or thoracic spondylosis (C4-T6): Degeneration of the intervertebral discs and joints in the neck and upper back.</li>\n<li>Myositis: Inflammation of the muscles.</li>\n<li>Herpes Zoster: due to reactivation of the virus along the chest dermatome</li>\n</ul>\n<p>A rib fracture can be caused by trauma, such as a fall or car accident, or by overuse, such as from repetitive coughing or heavy lifting. The pain from a rib fracture is also typically sharp and localized to the area of the fracture. It may be exacerbated by deep breathing, coughing, and movement. Costochondritis vs Rib Fracture:</p>\n<p>Location: Costochondritis pain is typically localized to the costochondral junctions. Rib fracture pain is typically <strong>localized to the area of the fracture,\u00a0</strong>in this case, it is localized to the costochondral junction.<br />Exacerbating factors: Costochondritis pain is typically exacerbated by deep breathing, coughing, and physical activity. Rib fracture pain is typically exacerbated by deep breathing, coughing, and <strong>movement.</strong><br />Other symptoms: Costochondritis is not typically associated with other symptoms. Rib fractures may be associated with other symptoms, such as <strong>shortness of breath, fever, and bruising</strong>.<br />Imaging: <strong>X-rays</strong> are typically used to diagnose rib fractures. Costochondritis is often diagnosed based on clinical findings alone, but X-rays may be used to rule out other causes of chest pain. (option C)</p>\n<p>Options B and D: Pleuritic pain and pericarditis are often associated with infections, and present as a sharp, stabbing pain The pain is typically worsened by deep breathing and coughing, but the pain would not be localized to the costochondral junction.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old male presents with a 2-day history of fever of 101 F, pleuritic chest pain and dyspnea. He has decreased breath sounds on the left side of his chest. A chest X-ray shows a left-sided pleural effusion. A diagnostic thoracentesis shows purulent fluid with Gram-positive cocci. What is the most appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thoracentesis alone"
      },
      {
        "id": 2,
        "text": "Thoracentesis with antibiotics"
      },
      {
        "id": 3,
        "text": "Chest tube drainage with antibiotics"
      },
      {
        "id": 4,
        "text": "Chest tube drainage with surgery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient presents with Empyema, often a complication of pneumonia. Empyema is the presence of pus in the pleural cavity. A chest x-ray may demonstrate <strong>air-fluid levels</strong> along with obliteration of the costophrenic angle. Most cases of empyema require <strong>chest tube drainage</strong> to remove the infected fluid and pus. <strong>Antibiotics</strong> are always necessary for empyema.</p>\n<p>A <strong>parapneumonic effusion</strong> is pleural effusion associated with either bacterial pneumonia, lung abscess, or bronchiectasis. If this <strong>progresses</strong>, it can result in the collection of frank pus in the pleural space, leading to empyema. Risk factors include <strong>diabetes, immunosuppression, alcoholism, \u00a0cancer, and poor dental hygiene</strong>.</p>\n<p>Investigations:\u00a0</p>\n<p>Chest X-ray:\u00a0<br /><strong>Loculations</strong> or encystments indicate a complicated parapneumonic effusion<br />Intrapleural <strong>air-fluid level</strong> indicates the presence of bronchopulmonary fistula<br />Parenchymal infiltrations in the lung lobes indicating an underlying pneumonia</p>\n<p>Ultrasound: Shows echogenic pleural fluid with septations and helps in characterizing the effusion<br />Pleural fluid analysis:<br /><strong>Exudative</strong> neutrophilic effusion\u00a0<br />Low pH &lt;7.2, low glucose &lt;60 mg/dL, high LDH &gt;1000 IU/L in complicated parapneumonic effusion<br />CECT: <strong>Split pleura</strong> sign seen in empyema</p>\n<p>Antibiotics: Tailored according to the microorganism<br />Therapeutic thoracocentesis<br />Tube thoracostomy is indicated if:</p>\n<ul>\n<li>Pleural fluid pH &lt;7.2</li>\n<li>Frank pus</li>\n<li>Microorganisms isolated in Gram stain or culture of pleural fluid.</li>\n</ul>\n<p>A thoracentesis alone is not sufficient treatment for empyema. Chest tube drainage is necessary to remove the infected fluid and pus. (Options A and B)</p>\n<p>Surgery may be required in case of loculated empyema or if the patient does not respond to chest tube drainage and antibiotics. (Option D)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old male patient presents with chest pain, fever, and shortness of breath. He has no history of coronary artery disease. His physical examination reveals a pericardial rub. A chest xray is normal. His laboratory results show elevated troponin levels and an increased white blood cell count. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Myocarditis"
      },
      {
        "id": 2,
        "text": "Myocardial infarction"
      },
      {
        "id": 3,
        "text": "Pneumonia"
      },
      {
        "id": 4,
        "text": "Pulmonary embolism"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Myocarditis is a common cause of <strong>chest pain in young adults</strong>. The diagnosis is based on clinical presentation, laboratory findings, and imaging studies. It can extend to involve the pericardium, seen here as a pericardial rub and can result in chest pain with ST elevations.</p>\n<p>Myocarditis is most often attributable to infective agents - common viral causes are <strong>coxsackieviruses</strong> A and B, <strong>echovirus</strong>, and <strong>influenza virus</strong>, but can also arise from other causes of inflammation. These causes are grouped as non-infective causes of Myocarditis. The most commonly diagnosed noninfective inflammatory process affecting the myocardium is <strong>granulomatous </strong>myocarditis which includes both <strong>Sarcoidosis and Giant Cell </strong>arteritis. Most patients recover from acute myocarditis, but a few may die from congestive heart failure or arrhythmias. [see pearl]</p>\n<p><strong>Elevated troponin</strong> levels are seen in both myocarditis and myocardial infarction. However, the troponin levels are typically higher in myocardial infarction.</p>\n<p>Other laboratory investigations that can be helpful in differentiating between myocarditis and myocardial infarction include:</p>\n<p>White blood cell count: Myocarditis is often associated with an elevated white blood cell count, while myocardial infarction is typically not.<br />Viral serology: Viral serology can be used to test for evidence of recent viral infection, which can be a cause of myocarditis.<br />If the diagnosis is unclear, cardiac imaging studies, such as<strong> echocardiography </strong>or <strong>cardiac magnetic resonance imaging</strong> (MRI), can be helpful in differentiating between myocarditis and myocardial infarction. (Option B)</p>\n<p>The<strong> Dallas criteria </strong>is used for the<strong> </strong>diagnosis of myocarditis on the basis of the findings of endomyocardial biopsy.\u00a0</p>\n<p>Endomyocardial biopsy is the <strong>gold standard </strong>for the diagnosis and shows interstitial inflammatory infiltrate with focal myocyte necrosis. There is a predominant lymphocytic infiltration.<strong>\u00a0Endomyocardial biopsy would not change the management.</strong> Indications for endomyocardial biopsy include:</p>\n<ul>\n<li>Unexplained fulminant (&lt; 2 weeks duration) heart failure</li>\n<li>Unexplained new onset heart failure 2 weeks to 3 months in duration with new onset ventricular arrhythmias, second/third degree AV block or failure to respond to usual care within 1-2 weeks</li>\n</ul>\n<p>Management of myocarditis includes:</p>\n<p>Heart failure is managed with diuretics and vasodilators such as nitrates. In hypotensive patients, inotropic agents such as dobutamine and milrinone is indicated. Vasopressors such as norepinephrine and dopamine may also be used if there is persistent hypotension.\u00a0<br />Antiarrhythmics such as amiodarone and dofetilide are given if there is sustained arrhythmia.<br />Anticoagulation<br />NSAIDs and physical activity are avoided in patients with myocarditis.</p>\n<p>Option C: Pneumonia is unlikely in this patient with a normal chest xray.</p>\n<p>Option D: This patient has a low pre-test probability of pulmonary embolism, raising low suspicion for PE.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male patient presents with a 3-day history of severe chest pain, dyspnea, and fever. He been feeling unwell since he underwent a balloon dilation of his esophageal stricture a few days ago. He is tachypneic and tachycardic. He has a tracheal shift to the right and dullness to percussion over the right lung. A chest X-ray shows a mediastinal mass and a pleural effusion. What is this most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Empyema"
      },
      {
        "id": 2,
        "text": "Mediastinitis"
      },
      {
        "id": 3,
        "text": "Pericarditis"
      },
      {
        "id": 4,
        "text": "Thoracic duct trauma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with <strong>severe chest pain, dyspnea, fever </strong>and a recent history of <strong>esophageal dilation </strong>likely has <strong>mediastinitis</strong>. Mediastinitis can be caused by esophageal perforation, infection (eg: Anthrax, Histoplasmosis), anastomotic leakage, and trauma.</p>\n<p>On examination, patients with mediastinitis may have a <strong>tracheal shift, dullness</strong> to percussion over the affected lung, and crepitations. A chest X-ray may show a mediastinal<strong> mass, pleural effusion,</strong> or <strong>air in the mediastinum</strong>.</p>\n<p>Mediastinitis is a <strong>medical emergency</strong> warranting a prompt diagnosis and treatment. The diagnosis can be made via <strong>mediastinal needle aspiration</strong>. Treatment includes<strong> immediate drainage, debridement,</strong> and <strong>parenteral antibiotic therapy</strong>, and surgery to <strong>repair any underlying </strong>esophageal perforation or other injury, but the <strong>mortality</strong> rate usually exceeds <strong>20%</strong>.</p>\n<p>Option A: Pleural empyema is an infection of the pleural space and can cause chest pain, dyspnea, and fever, but it is typically not associated with a mediastinal mass.</p>\n<p>Option C: Pericarditis can cause chest pain, dyspnea, and fever, but it is typically not associated with a mediastinal mass.</p>\n<p>Option D: Thoracic duct trauma is rare and can occur after trauma to the chest or neck. It can cause mediastinal mass and pleural effusion, but it is typically not associated with esophageal perforation.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female presents with a 2-week history of intermittent discomfort in her right chest, shoulders and neck. The pain is sharp and exacerbated by coughing, sneezing and relieved by lifting her arms above her head. She also reports a tingling sensation and weakness in her right arm and hand. Chest X-ray is unremarkable. What is the most likely cause of her pain?",
    "choices": [
      {
        "id": 1,
        "text": "Pleuritic chest pain"
      },
      {
        "id": 2,
        "text": "Pneumothorax"
      },
      {
        "id": 3,
        "text": "Musculoskeletal chest pain"
      },
      {
        "id": 4,
        "text": "Cervical radiculopathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The likely cause is <strong>cervical radiculopathy</strong> due to the <strong>positive shoulder abduction test</strong> and <strong>tingling/weakness in the arms</strong>. Symptoms can include pain, numbness, and weakness in the neck, arm and chest. The most common cause of cervical radiculopathy is a herniated disk.</p>\n<p>Clinical Features:</p>\n<ul>\n<li><strong>Pain</strong> in the neck, shoulder, arm, hand and depending on the dermatome level, chest pain or discomfort, <strong>exacerbated by coughing/sneezing.</strong></li>\n<li>Numbness and tingling in the arm and hand</li>\n<li>Weakness in the arm and hand</li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>Spurling's maneuver</strong>, which involves axial neck flexion and lateral bending, may also <strong>reproduce the patient's pain.</strong></span></li>\n</ul>\n<p>Diagnosis: Along with clinical features:</p>\n<ul>\n<li>Electrodiagnostic testing, such as electromyography (EMG) and nerve conduction studies (NCS), can help confirm the diagnosis of cervical radiculopathy.</li>\n<li>Imaging studies: (Not always necessary) such as X-rays, MRI, or CT scans, may help identify the cause of cervical radiculopathy.<br /><br /></li>\n</ul>\n<p>The treatment for cervical radiculopathy may include:</p>\n<ul>\n<li>Rest/Ice/Heat/Analgesics/Physical therapy</li>\n<li>Corticosteroid injections</li>\n<li>Surgery</li>\n</ul>\n<p>Other options:</p>\n<p><strong>Pleuritis</strong> can cause <strong>sharp chest pain</strong> that may radiate, but a positive shoulder abduction test and weakness in the arms will not be seen.</p>\n<p><strong>Pneumothorax</strong> which leads to chest pain, would be <strong>visible on x-ray</strong>, which is not the case here.</p>\n<p><strong>Musculoskeletal chest pain</strong> will <strong>not</strong> be<strong> accompanied by tingling</strong>, <strong>weakness</strong> of arms, or a positive shoulder abduction test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old woman with no comorbidities presents with sudden onset of chest pain, shortness of breath, and palpitations. She is anxious and is hyperventilating. EKG and troponins are obtained and are unremarkable. Which of the following would control her chest pain and hyperventilation?",
    "choices": [
      {
        "id": 1,
        "text": "Rebreathing technique"
      },
      {
        "id": 2,
        "text": "Calcium channel blocker"
      },
      {
        "id": 3,
        "text": "Nitrates"
      },
      {
        "id": 4,
        "text": "IV Haloperidol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient's symptoms are consistent with an <strong>episode of panic attack </strong>or<strong> hyperventilation syndrome</strong>. The <strong>rebreathing technique</strong> is a simple and effective way to relieve the symptoms of a panic attack. The technique involves <strong>breathing into a paper bag</strong> <strong>or other small container</strong> for several minutes.\u00a0</p>\n<p>In hyperventilation syndrome, the patient may experience shortness of breath, chest tightness, dizziness, lightheadedness, tingling in the hands and feet, muscle spasms, and tachycardia. <strong>Diagnosis is clinical </strong>and breathing retraining with paper bag rebreathing or pursed lip breathing is effective in relieving the symptoms.</p>\n<p>In a panic attack, a patient may experience <strong>tachycardia, sweating, trembling, shortness of breath, chest tightness, nausea, dizziness, feeling of unreality, and fear of losing control or dying</strong>. Diagnosis is based on symptoms and a history of panic attacks. Immediate treatment involves breathing techniques, and if ineffective, psychotherapy or medication.<strong> Lorazepam may be given</strong> if rebreathing technique is not useful. IV <strong>haloperidol</strong> is <strong>not recommended</strong>\u00a0(option D)</p>\n<p>Nitrates, CCBs, are useful for DES and ACS and are not treatments for chest pain caused by a panic attack or hyperventilation syndrome. (Options B and C)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man presents with a history of progressive exertional dyspnea and chest pain. On physical examination, he has a slow rising and weak pulse, and a systolic ejection murmur at the aortic area. His peak aortic valve velocity is 4 m/s. What is the most likely mechanism of his chest pain?",
    "choices": [
      {
        "id": 1,
        "text": "Afterload mismatch"
      },
      {
        "id": 2,
        "text": "Tensing of chordae tendinae"
      },
      {
        "id": 3,
        "text": "Preload reduction"
      },
      {
        "id": 4,
        "text": "Asymmetric septal hypertrophy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely mechanism of chest pain in this patient with aortic stenosis is<strong> afterload mismatch.</strong></p>\n<p>This patient with dyspnea and anginal symptoms, with a systolic murmur and slow and late peaking (parvus et tardus) pulse and aortic jet velocity of 4 likely has aortic stenosis. Afterload is the pressure against which the heart must pump. In aortic stenosis, the <strong>narrowed aortic valve increases</strong> the <strong>afterload </strong>on the left ventricle. This forces the left ventricle to work harder to pump blood, which can lead to chest pain. With a sustained increase in afterload, <strong>diastolic dysfunction develops</strong>, which may progress to an (irreversible) <strong>myocardial fibrosis.</strong></p>\n<p>The clinical features of AS are:</p>\n<p><strong>Exertional dyspnea</strong>: This occurs due to left ventricular (LV) diastolic dysfunction. Raised end-diastolic LV volume and reduced LV compliance lead to increased <strong>LV pressure</strong>, leading to elevation of pulmonary capillary wedge pressure.<br /><strong>Angina</strong> pectoris: This occurs due to the combination of the increased O2 needs of the myocardium and the reduction of O2 delivery.<br /><strong>Syncope:</strong> This occurs due to the combination of decreased cardiac output and systemic arterial dilation which leads to a reduction of cerebral perfusion.</p>\n<p><strong>Severe AS</strong> is characterized by a <strong>mean systolic pressure gradient &gt;40 mmHg</strong>, a normal or reduced CO, and an effective <strong>aortic orifice area of &lt;1 cm^2</strong>.<br />The elevated LV end-diastolic pressure in patients with severe AS and preserved EF signifies diminished compliance of the hypertrophied LV.</p>\n<p>Other options:</p>\n<p><strong>Tensing of the chordae tendineae</strong>: If they are tense, as in <strong>Mitral valve prolapse</strong>, they can pull on the leaflets and cause them to prolapse further, which can lead to chest pain.</p>\n<p>In <strong>HOCM</strong>, there is an <strong>asymmetric thickening of the interventricular septum</strong> that obstructs the outflow of blood from the left ventricle and leads to chest pain, shortness of breath, and syncope. <strong>Reduced preload</strong> can <strong>worsen the symptoms</strong>. This patient does <strong>not have the features of HOCM.</strong></p>\n<p><strong>Reduced preload </strong>can occur due to <strong>venous pooling or shock.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old woman presents with a sudden onset of chest pain. She describes the pain as burning and constricting, and it is worse when she lies down. She also has difficulty swallowing and is avoiding meals. Her current medications are iron supplements that she started last week for anemia and ibuprofen for arthritis. What is the most likely cause of her chest pain?",
    "choices": [
      {
        "id": 1,
        "text": "Diffuse esophageal spasm"
      },
      {
        "id": 2,
        "text": "Pill-induced esophagitis"
      },
      {
        "id": 3,
        "text": "Coronary artery disease"
      },
      {
        "id": 4,
        "text": "Hiatal hernia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely diagnosis in this case is pill-induced esophagitis. The patient has been taking <strong>NSAIDs/Ibuprofen for arthirits and recently started Iron supplements for anemia</strong>, both known causes for pill-induced esophagitis.\u00a0</p>\n<p>Pill-induced esophagitis is caused when the pill <strong>lodges within the lumen</strong> of the esophagus. This pill causes <strong>direct damage</strong> to the mucosa. The risk factors for pill-induced esophagitis include <strong>poor pill-taking habits, consuming inadequate liquids, and lying down immediately after</strong> consuming the pill. The most common site for pill-induced esophagitis is in the<strong> mid-esophagus</strong>, near the crossing of the<strong> aorta or carina</strong>. These structures <strong>externally compress</strong> the esophagus and prevent the movement of the pills.</p>\n<p>Drugs causing esophagitis:\u00a0</p>\n<ol>\n<li>Doxycycline</li>\n<li>Tetracycline</li>\n<li>Quinidine</li>\n<li>Potassium chloride</li>\n<li><strong>Ferrous sulfate</strong></li>\n<li>Nonsteroidal anti-inflammatory drugs (<strong>NSAIDs</strong>)</li>\n<li>Bisphosphonates</li>\n<li>Phenytoin</li>\n</ol>\n<p>Treatment is <strong>discontinuation of the offending pill.</strong></p>\n<p>Other options:</p>\n<p>Option A: Patients with<strong> diffuse esophageal spasms</strong> present with <strong>dysphagia for solids and liquids </strong>and a sensation of <strong>food getting stuck in the esophagus</strong>. The pain is usually squeezing or constricting in character. Pill esophagitis is more likely in the setting of a new offending medication intake.</p>\n<p>Option C: <strong>Coronary artery disease</strong> is typically described as a <strong>pressure or squeezing sensation</strong>, and it is often precipitated by exertion or stress.</p>\n<p>Option D: <strong>Hiatal hernia</strong> is a condition in which part of the stomach protrudes through the diaphragm and into the esophagus. The symptoms of hiatal hernia can include <strong>heartburn, regurgitation, and chest pain that usually occurs postprandially. </strong>However, the chest pain is typically not as severe as the pain associated with pill-induced esophagitis, and the new medication usage makes pill esophagitis more likely.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman presents with a history of chest pain, dyspnea on exertion, and fatigue for the past several months. She has a history of scleroderma diagnosed 10 years ago. Examination reveals right ventricular heave and a systolic murmur at the left lower sternal border. CXR is shown below. Which of the following is the most likely cause of the patient's chest pain?",
    "choices": [
      {
        "id": 1,
        "text": "Left heart failure"
      },
      {
        "id": 2,
        "text": "Widespread bronchospasm"
      },
      {
        "id": 3,
        "text": "Intimal thickening of pulmonary artery"
      },
      {
        "id": 4,
        "text": "Alveolar destruction and air trapping"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of<strong> SSc-associated pulmonary hypertension.</strong> In PH, there is <strong>intimal thickening of the pulmonary arteries</strong>, which leads to narrowing of the arteries and increased resistance to blood flow: leading to chest pain, dyspnea on exertion and when severe, hemoptysis.</p>\n<p>Right ventricular dysfunction occurs with the progression of the disease -syncope, abdominal distention, ascites, and peripheral edema.<br />Pulmonary vasculature may have <strong>intimal proliferation, fibrosis, and in situ thrombosis</strong>. There may be <strong>vascular remodelling</strong> at late stages. These changes increase <strong>right ventricular afterload and total pulmonary vascular resistance</strong>. This eventually leads to a drop in cardiac output. It is irreversible and does not have a curative treatment. It can lead to decompensated right heart failure and death.\u00a0</p>\n<p>Pulmonary hypertension is characterized by an elevation in pulmonary arterial pressures and right heart catheterization can confirm the diagnosis.</p>\n<ul>\n<li>Mean pulmonary artery pressure (PAP) &gt; 22 mmHg</li>\n<li>Estimated systolic PAP &gt; 36 mmHg</li>\n<li>Pulmonary vascular resistance of \u22653 wood units.</li>\n</ul>\n<p>An echocardiogram with a<strong> bubble study </strong>is an important screening test that will reveal a dilated and hypertrophied right ventricle. On chest x-ray, '<strong>vascular pruning</strong>' (as seen in the given CXR) may be seen as well as enlarged pulmonary arteries.</p>\n<p>Management for pulmonary hypertension:</p>\n<p><strong>Vasoreactivity testing</strong> involves the administration of <strong>inhaled nitric oxide, IV epoprostenol, IV adenosine, or inhaled iloprost.</strong> The test is considered positive if the mean pulmonary arterial pressure (mPAH) decreases by \u2265 10 mmHg leading to mPAH \u2264 40 mmHg, without a decrease in cardiac output (CO).</p>\n<p><strong>Positive vasoreactivity test: </strong>Calcium channel blockers are indicated. Long-acting nifedipine, diltiazem or amlodipine are used.<br /><br /></p>\n<p><strong>Negative vasoreactivity test:</strong></p>\n<ul>\n<li>For patients with lower risk (class II, III) based on clinical assessment: Oral therapy with endothelin receptor antagonists like ambrisentan, sitaxsentan, bosentan, or phosphodiesterase 5 inhibitors (PDE-5 I's) like sildenafil, tadalafil is the first line of therapy.</li>\n<li>For patients with higher risk (class IV) based on clinical assessment: Continuous treatment with iv prostacyclins (epoprostenol or treprostinil) would be the first line of therapy recommended.</li>\n<li>Lung transplantation and/or atrial septostomy are reserved for patients who progress despite optimal medical treatment.</li>\n</ul>\n<p><br />Revised WHO classification of pulmonary hypertension:</p>\n<ul>\n<li>Group I: Pulmonary arterial hypertension (PAH)</li>\n<li>Group II: Pulmonary hypertension with left heart disease</li>\n<li>Group III: Pulmonary hypertension associated with lung diseases and/or hypoxemia</li>\n<li>Group IV: Pulmonary hypertension due to chronic thrombotic and/or embolic disease (CTEPH)</li>\n<li>Group V: Pulmonary hypertension due to miscellaneous causes<br /><br /></li>\n</ul>\n<p>Other options:</p>\n<p>Option A: Left heart failure would likely be accompanied by orthopnea/PND, S3, or signs of pulmonary edema on physical exam or chest x-ray.</p>\n<p>Option C: Asthma/Anaphylaxis is associated with widespread bronchospasm and is likely to be episodic or associated with an exposure. On examination, wheezing would be seen and CXR would be clear.</p>\n<p>Option D: Emphysema is associated with air trapping and alveolar destruction. PAH associated with SSc is more likely in this patient with no smoking history and signs of pruning. Hyper-expansion and diaphragm flattening would be expected on CXR.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90b2d6f5dc4f472d88b929c78b1db304.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presents with a sudden onset of severe left-sided chest pain that is sharp and stabbing in nature. He also has shortness of breath and difficulty breathing. His heart rate is 120 bpm, BP: 100/60 mmHg, and RR: 30. There are decreased breath sounds on the left side of the chest and hyperresonance on percussion. Which of the following is the most likely cause of this patient's chest pain and respiratory distress?",
    "choices": [
      {
        "id": 1,
        "text": "Positive intrathoracic pressure"
      },
      {
        "id": 2,
        "text": "Increased CVP"
      },
      {
        "id": 3,
        "text": "Increased PCWP"
      },
      {
        "id": 4,
        "text": "Increased LVEDP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient likely has a tension pneumothorax, characterized by the presence of <strong>air in the pleural space -&gt; positive intrathoracic/pleural pressure</strong>, i.e.: <strong>higher than the atmospheric pressure</strong>. This positive pleural pressure compresses the lung and causes the symptoms of tension pneumothorax.</p>\n<p>Tension pneumothorax is a <strong>clinical diagnosis</strong>, and treatment should never be delayed while waiting for radiological confirmation. Imaging modalities used are ultrasound\u2013extended focused assessment with sonar for trauma<strong> (eFAST), chest x-ray, and spiral CT.</strong></p>\n<p>A tension pneumothorax develops when there is a tear either in the parietal or visceral pleura. This tear acts as a <strong>one-way valve</strong> i.e. air enters from the lung or chest wall through it during inspiration but has no way to escape during expiration. This increased intrathoracic pressure ultimately leads to the collapse of the affected lung.</p>\n<p>It usually occurs following penetrating or blunt chest trauma, iatrogenic lung injury, or <strong>mechanical positive pressure ventilation.</strong></p>\n<p>It is characterized by:</p>\n<ul>\n<li>Chest pain</li>\n<li>Tachypnoea, and acute dyspnea</li>\n<li>Sudden onset hemodynamic compromise (tachycardia, hypotension, low O2 saturation, loss of consciousness)</li>\n<li>Neck vein distension</li>\n<li>Tracheal deviation away from the side of the injury\u00a0</li>\n<li>Decreased chest movements on the affected side</li>\n<li>Hyper-resonance on percussion on the affected side</li>\n<li>Absence or decreased breath sounds on the affected side</li>\n</ul>\n<p>\u00a0</p>\n<p>Management of tension pneumothorax:</p>\n<p>Immediate management- needle decompression or needle thoracostomy i.e. insertion of a wide-bore needle in the 5th ICS anterior to the mid-axillary line.</p>\n<p>Definitive management- tube thoracostomy or chest tube insertion in the 5th ICS in the triangle of safety, identified as a triangle that lies anterior to the mid-axillary line above the nipple, below, and lateral to the pectoralis major muscle.</p>\n<p>Other Options:</p>\n<p>Options B, C, and D: <strong>Elevated CVP, increased PCWP, and increased LVEDP</strong> are not typically seen in tension pneumothorax. Elevated <strong>CVP</strong> may be seen in patients with <strong>right heart failure or fluid overload</strong>. Increased <strong>PCWP </strong>may be seen in patients with <strong>left heart failure or pulmonary hypertension</strong>. <strong>Increased LVEDP</strong> may be seen in patients with heart failure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presents during an outbreak of coxsackievirus B with a severe, sharp, stabbing chest pain that worsens with deep breathing and coughing. He also has a fever, headache, and myalgia. What would be the cause for chest pain if Bornholm's disease is suspected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pleural effusion"
      },
      {
        "id": 2,
        "text": "Myositis"
      },
      {
        "id": 3,
        "text": "Pneumonia"
      },
      {
        "id": 4,
        "text": "Costochondritis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bornholm disease</strong>, also known as<strong> epidemic pleurodynia/\"Devil's grip\"</strong>, can cause severe chest pain. It is a <strong>myositis of the chest/abdomen </strong>caused by the <strong>Coxsackie B virus</strong> or other viruses.</p>\n<p>It is characterized by an<strong> intermittent stabbing pain</strong>, accompanied by <strong>fever, headache, and myalgia</strong>. Chest X-ray is usually normal. Most cases occur during epidemics of coxsackievirus B. The disease is named after the Danish island of Bornholm where most early cases were discovered.</p>\n<p>The treatment is <strong>non-steroidal anti-inflammatory agents</strong> or hot fomentation of the involved muscles.\u00a0</p>\n<p>Other diseases associated with coxsackievirus B:</p>\n<ul>\n<li>Neonatal myocarditis and pericarditis</li>\n<li>Juvenile diabetes mellitus</li>\n<li>Orchitis</li>\n<li>Severe disseminated congenital infection- hepatitis, meningoencephalitis, adrenocortical involvement</li>\n</ul>\n<p>Other options:</p>\n<p>Option A:\u00a0 <strong>Effusion</strong> can cause chest pain, but it is usually <strong>not as severe</strong> as the pain of Bornholm disease, which also doesn't lead to pleural effusion. Pleural effusion is also <strong>associated with shortness of breath and a cough</strong>, not seen in this patient.</p>\n<p>Option C: <strong>Pneumonia</strong> can cause<strong> chest pain, fever, cough, and shortness of breath</strong>. <strong>Chest X-ray</strong> usually shows signs of pneumonia, such as <strong>infiltrates</strong>. It is unlikely in this patient without a cough. Pneumonia is <strong>not a feature of Bornholm disease</strong>.</p>\n<p>Option D: <strong>Costochondritis</strong> is an inflammation of the costochondral cartilage. It can cause <strong>chest pain that is worsened by deep breathing and coughing</strong>. However, costochondritis is <strong>typically not associated with fever, headache, or myalgia</strong>, and is <strong>not seen in Bornholm's disease.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year male patient came to the hospital with complaints of dysphagia and chest pain since 1 month. ECG was normal. A barium study was done and is shown. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Diffuse esophageal spasm"
      },
      {
        "id": 2,
        "text": "Esophageal carcinoma"
      },
      {
        "id": 3,
        "text": "Esophageal ulcer"
      },
      {
        "id": 4,
        "text": "Achalasia cardia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> barium study </strong>of the patient shows the<strong> corkscrew appearance</strong> of the esophagus which is seen in <strong>diffuse esophageal spasm.</strong></p>\n<ul>\n<li>Diffuse/distal esophageal spasm (DES) is a motility disorder of the esophagus.</li>\n<li>On barium swallow, DES may appear as a<strong> corkscrew</strong> or<strong> rosary bead </strong>esophagus, but this is uncommon.</li>\n<li><strong>Manometry</strong> is the gold-standard diagnostic test.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6fad27d9f2ea475c9cbddb525b039783.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3185fb2a432248dc8489a21a92e1e204x245x520.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9a90b9b7bdb849d7a534fb067087094ex1071x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d47fadeaf5cd49d5a363b1f60b9652cax154x362.JPEG"
    ]
  },
  {
    "text": "A patient comes to the hospital with chest pain for the last 3 hours. Vitals are stable. ECG revealed ST depression and T wave inversion in anterior chest leads. Which of the following would be the most appropriate line of management in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "PCI"
      },
      {
        "id": 2,
        "text": "Thrombolysis with alteplase"
      },
      {
        "id": 3,
        "text": "Prophylaxis for arrhythmia"
      },
      {
        "id": 4,
        "text": "Aspirin with heparin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Based on the given clinical scenario of a patient presenting with<strong> sudden onset of chest pain,</strong> with ECG findings of<strong> ST depression</strong> in the anterior chest leads and<strong> T wave inversion,</strong> the most likely diagnosis is a <strong>non-ST-segment elevation-acute coronary syndrome (NSTE-ACS).</strong>\u00a0 The most appropriate line of management in this patient would be to administer<strong> aspirin with heparin.</strong></p>\n<p>Percutaneous coronary intervention is indicated after coronary angiography in high-risk patients.</p>\n<p>Fibrinolytic therapy is not indicated in patients with NSTE-ACS.</p>\n<p>Arrhythmia prophylaxis is generally not routinely recommended in all patients with NSTE-ACS.</p>\n<p><strong>Acute coronary syndrome</strong> is classified into 2 groups:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">ST-segment Elevation Myocardial Infarction <strong>(STEMI)</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>NSTE-ACS</strong></li>\n</ul>\n<p>NSTE-ACS further includes:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>NSTEMI</strong> (myocyte necrosis present and cardiac troponins elevated)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Unstable Angina</strong> (myocyte necrosis absent and cardiac troponins not elevated)</li>\n</ul>\n<p>The diagnosis of NSTE-ACS is based on the following:</p>\n<p><strong>Severe chest discomfort</strong> with at least <strong>one of 3</strong> features:</p>\n<ul>\n<li>Occurring at rest or minimal exertion and lasting for more than 10 minutes</li>\n<li>Recent onset</li>\n<li>Crescendo pattern</li>\n</ul>\n<p><strong>ECG</strong> showing:</p>\n<ul>\n<li aria-level=\"1\"><strong>ST segment depression</strong></li>\n<li aria-level=\"1\"><strong>T wave inversion</strong></li>\n</ul>\n<p>\u00a0</p>\n<p><strong>Elevated cardiac troponins</strong> in case of NSTEMI.</p>\n<p>Management of NSTE-ACS:</p>\n<p>To provide relief of pain and discomfort, initial treatment includes bed rest, <strong>nitrates</strong>, <strong>beta blockers,</strong> and inhaled <strong>oxygen</strong> (only if arterial O2 saturation &lt;90%).</p>\n<p><strong>Antithrombotic therapy</strong> consisting of antiplatelet and anticoagulant drugs:</p>\n<ul>\n<li><strong>Dual antiplatelet therapy</strong> (DAPT): Aspirin (162-325 mg) AND one ADP receptor inhibitor (Ticagrelor, clopidogrel or prasugrel)</li>\n<li><strong>Anticoagulation:</strong> Enoxaparin, unfractionated heparin, fondaparinux or bivalirudin</li>\n<li>An early invasive strategy including <strong>diagnostic coronary angiography</strong> (within 2\u201372 hours of presentation) followed by <strong>revascularization (</strong>percutaneous coronary intervention/ coronary artery bypass grafting) is indicated for stabilized patients who are at high risk of coronary events (Based on TIMI, GRACE or HEART score).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with the complaints of chest pain. Which among the following is the best investigation to diagnose MI within 2-4 hours?",
    "choices": [
      {
        "id": 1,
        "text": "LDH"
      },
      {
        "id": 2,
        "text": "CKMB"
      },
      {
        "id": 3,
        "text": "Troponin-T"
      },
      {
        "id": 4,
        "text": "BNP"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Measurement of troponin\u00a0is the best investigation to diagnose MI within 2-4 hours.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ed64afdfd20483f9ce84324d54c018bx1280x1171.JPEG"
    ]
  }
];
        let quizName = 'Chest Pain Mini Test - -Tmt';
        const quizFilename = 'chest-pain-mini-test-tmt-3689d559.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>