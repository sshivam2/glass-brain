<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet 2021 Mini Test 10  (20 Questions) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 42-year-old woman who presented with a 3-month history of a painless firm lump in her breast's upper outer quadrant underwent breast conservative surgery and is now awaiting instructions on follow-up. What is the recommended advice regarding the follow-up for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Annual mammograms of the treated and contralateral breast"
      },
      {
        "id": 2,
        "text": "Annual mammograms of the contralateral breast only"
      },
      {
        "id": 3,
        "text": "Annual mammograms of the contralateral breast only and Serum tumor markers"
      },
      {
        "id": 4,
        "text": "Annual mammograms of the treated and contralateral breast and Serum tumor markers"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>For a patient with the given clinical scenario after treatment of breast cancer, the recommended follow-up advice consists of a routine physical examination once in 3 months for the first two years<strong> </strong>and<strong> annual mammograms of the treated and contralateral breast.</strong></p>\n<p><strong>Mammography is the only imaging</strong> modality\u00a0necessary for follow-up after breast cancer surgery. There is currently <strong>no role for tumour markers</strong>, serum investigations, or any other imaging studies like bone scans in follow-up.</p>\n<p>Women who have had a <strong>mastectomy</strong>, including simple mastectomy, modified radical mastectomy, and radical mastectomy would <strong>not need further routine screening mammograms on that side</strong>, but will still need to have a <strong>yearly mammogram</strong> on the remaining breast.</p>\n<p>The guidelines for follow-up are as follows,</p>\n<p><strong>Physical examination:</strong></p>\n<ul>\n<li>For the <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">first 2 years:</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0once every</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> 3 </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">months</span></li>\n<li>For<strong>\u00a03-5 years:</strong> once every <strong>6 </strong>months</li>\n<li><strong>After 5 </strong>years: <strong>Annually</strong></li>\n</ul>\n<p><strong>Mammography: </strong>Annually</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old man presented to the emergency department following a road traffic accident. His vitals are stable but he complains of flank pain and blood in the urine. On examination, there was some abrasion on the abdomen in the right iliac and lumbar region. A CECT was done which revealed a laceration in the right kidney extending to the collecting ducts with some urine extravasation. He was managed conservatively. Follow-up imaging revealed the presence of a persistent urinoma. What is the next best management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ureteral stenting"
      },
      {
        "id": 2,
        "text": "Surgical exploration"
      },
      {
        "id": 3,
        "text": "Observation"
      },
      {
        "id": 4,
        "text": "Percutaneous drainage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient in the given question has renal laceration with urine extravasation, indicating that he had a <strong>grade 4 renal injury.</strong></p>\n<p>During the follow-up of grade IV injury, a <strong>persistent urinoma\u00a0</strong>should be managed with the placement of an internal <strong>ureteral stent. </strong>In patients not cured by ureteral stenting, percutaneous\u00a0nephrostomy or transcutaneous drain may be required.</p>\n<p><strong>Management of renal injuries</strong></p>\n<ul>\n<li><strong>Grading</strong> of injury through <strong>CECT</strong></li>\n<li>If hemodynamically <strong>stable</strong>\n<ul>\n<li><strong>Conservative</strong> management - Bedrest &amp; hemodynamic monitoring</li>\n<li>In grade <strong>IV</strong>, a <strong>repeat CT</strong> scan to ensure the extravasation of urine has resolved.</li>\n</ul>\n</li>\n<li>If hemodynamically <strong>unstable</strong>\n<ul>\n<li>Surgical exploration and repair</li>\n<li>In grade V, <strong>nephrectomy.</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old woman presents with hoarseness and a low-pitched voice. She is a singer and a known smoker. Her laryngoscopy findings are given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Reinke's edema"
      },
      {
        "id": 2,
        "text": "Laryngeal papilloma"
      },
      {
        "id": 3,
        "text": "Vocal polyp"
      },
      {
        "id": 4,
        "text": "Vocal nodules"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The laryngoscopy findings show <strong>diffuse bilateral edema</strong> of the vocal folds suggestive of <strong>Reinke's edema.</strong></p>\n<p>It occurs due to edema of the subepithelial space (<strong>Reinke\u2019s space</strong>) of the vocal cords\u00a0in the<strong> glottis</strong>.</p>\n<p><strong>Key clinical features</strong></p>\n<ul>\n<li>History of <strong>smoking</strong> and/or voice abuse.</li>\n<li><strong>Hoarseness</strong> is the most common symptom.</li>\n<li>Patients use false cords for voice production and this gives them a <strong>low-pitched</strong> and rough voice.</li>\n</ul>\n<p>On indirect laryngoscopy, both vocal cords show diffuse symmetrical swellings. They appear as fusiform swellings with a pale translucent look. Ventricular bands may appear hyperemic and hypertrophic and may hide the view of the true cords.</p>\n<p><strong>Treatment</strong></p>\n<ul>\n<li>Voice rest and cessation of smoking</li>\n<li>Decortication of the vocal cords, i.e. removal of a strip of epithelium</li>\n<li>Speech therapy for proper voice production.</li>\n</ul>\n<p>Other options</p>\n<p>Option B: <strong>Laryngeal papilloma/ squamous papilloma</strong> are <strong>benign tumors</strong> of the larynx caused by the human papillomavirus (<strong>HPV type 6 and 11</strong>). They occur in children (<strong>juvenile papillomatosi</strong>s) as well as adults.\u00a0Patients present with hoarseness, dyspnea or stridor.</p>\n<p>Laryngoscopy shows pinkish to white \u201c<strong>grape-like</strong>\u201d projections that can be sessile or pedunculate with a visible central vascular core.\u00a0</p>\n<p>The image below shows laryngeal papilloma.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da302df4f4ab41928c8b2739273fb052.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33a0ca51918c422a8ac174c58204c36cx512x422.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c7edadc331644ceb6249ab5cc7fd429x507x258.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3581adddfd984e86b17bc92a97d0b573x512x380.PNG"
    ]
  },
  {
    "text": "The histopathological slide obtained from the lungs of a patient who died from respiratory failure is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "CMV-associated organizing pneumonia"
      },
      {
        "id": 2,
        "text": "Giant cell pneumonia"
      },
      {
        "id": 3,
        "text": "Silicosis"
      },
      {
        "id": 4,
        "text": "Cryptogenic organizing pneumonia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given histopathological slide shows <strong>Masson bodies</strong>\u00a0which are seen in <strong>cryptogenic organizing pneumonia.</strong></p>\n<p><strong>Cryptogenic organizing pneumonia</strong> is synonymous with the previously popular designation bronchiolitis obliterans organizing pneumonia (BOOP).</p>\n<div class=\"page\" title=\"Page 694\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Histologically COP is characterized by the presence of Masson bodies. These are <strong>polypoid plugs of loose organizing connective tissue</strong> within alveolar ducts, alveoli and bronchioles along with foci of fibrosis. There is <strong>no interstitial fibrosis or honeycombing of lung</strong>. The clinical presentation of COP is the development of nonspecific systemic and respiratory symptoms. It is associated with filling of the lung alveoli that are visible on a chest x-ray as patchy consolidation.</p>\n<p>Other options</p>\n<p>Option A - CMV-associated organizing pneumonia</p>\n<p><strong>CMV is</strong>\u00a0a \u03b2-group herpesvirus. It primarily affects the <strong>lungs</strong> (pneumonitis) and <strong>gastrointestinal tract</strong> (colitis). It commonly affects neonates and immunocompromised people (e.g., transplant recipients, HIV- infected individuals).\u00a0The histopathology slide below shows a cytomegalic pneumocyte containing characteristic intranuclear basophilic inclusion surrounded by a clear halo -\u00a0<strong>owl\u2019s eye.</strong></p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2c0966f929ca42158af5ff64e6cf6731.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/69bda4f3c415481ca212df082cf16371x720x478.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1278611e1a23442084ba9e14fafcff41x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9447ac21c7fa4c34ae7dfbb1054a7c9ax1024x683.JPEG"
    ]
  },
  {
    "text": "A 32-year-old obese woman who recently joined a weight loss program presents with pain along the anterior and medial aspects of her tibia. The pain increases while doing jogging and walking on the treadmill for long periods. On examination, there is diffuse tenderness along the tibial shaft. A plain X-ray radiograph of her leg is shown below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Runner's fracture"
      },
      {
        "id": 2,
        "text": "Shin splint"
      },
      {
        "id": 3,
        "text": "Lisfranc fracture"
      },
      {
        "id": 4,
        "text": "Pilon fracture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most probable diagnosis in this patient with diffuse tibial pain and a normal x-ray is the&nbsp;<strong>shin splint</strong>&nbsp;or <strong>medial tibial stress syndrome (MTSS).</strong>&nbsp;</p>\n<p>MTSS is a stress injury of the tibia which occurs due to the frequent <strong>overuse</strong> of lower limbs. It is commonly seen in <strong>athletes and military personnel</strong>.</p>\n<p>Risk factors for MTSS</p>\n<ul>\n<li>High body mass index (BMI)</li>\n<li>An increase in training volume or intensity</li>\n<li>Female gender</li>\n<li>Previous history of MTSS</li>\n</ul>\n<p><strong>Exercise-induced diffuse pain</strong> along the <strong>distal two-thirds</strong> of the medial <strong>tibial</strong> border is typical. Since it is a stress injury, the <strong>radiograph</strong> of the leg appears <strong>normal.</strong></p>\n<p>MTSS often leads to stress fractures of the tibia. When this occurs, the pain increases in intensity becomes localized and is associated with swelling.</p>\n<p>It is treated conservatively. The patient should take physical rest and modify daily activities to avoid repetitive and load-bearing exercises. Other modalities being studied include ice massage and ultrasound therapy.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e87e5445544b4a098ad8e0f9b226ee32.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Mr. Kumar presented with complaints of itchy eyes since 1 year. His symptoms are worse in the morning with some blurring of vision which quickly improves on blinking. On examination, his eyelids appear red and swollen with cylindrical dandruff-like scaling around the base of eyelashes. The rest of the eye examination was unremarkable. Which of the following organisms is linked to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Sarcoptes scabiei"
      },
      {
        "id": 2,
        "text": "Streptococcus"
      },
      {
        "id": 3,
        "text": "Propionibacterium"
      },
      {
        "id": 4,
        "text": "Demodex folliculorum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>chronic anterior blepharitis\u00a0</strong>of the <strong>seborrheic type</strong> linked to\u00a0<strong><em>Demodex folliculorum</em></strong>.</p>\n<p>Chronic blepharitis is characterized by the inflammation of the eyelids associated with eye irritation. It is of two types:</p>\n<ul>\n<li><strong>Posterior blepharitis</strong>\n<ul>\n<li>Inflammation of inner portion of the eyelid (more common)</li>\n<li>Caused by <strong>meibomian gland</strong> dysfunction</li>\n<li>Associated with acne rosacea</li>\n</ul>\n</li>\n<li><strong>Anterior blepharitis</strong>\n<ul>\n<li>Inflammation of <strong>base of eyelashes</strong></li>\n<li>Two types\n<ul>\n<li>Seborrhoeic type which is associated with dermatitis. This is characterized by\u00a0<strong>dandruff-like skin changes and greasy scales</strong>.</li>\n<li>Staphylococcal type is characterized by <strong>fibrinous scales and crust</strong> around the eyelashes caused by <strong>colonization of the eyelids</strong> by Staphylococcus aureus and CoNS</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>Parasitic causes of blepharitis</p>\n<ul>\n<li><strong>Blepharitis acarica</strong> caused by <em>Demodex folliculorum</em> - A key clinical feature of this infestation is the presence of dandruff-like scaling at the base of eye-lashes.</li>\n<li><strong>Phthiriasis palpebrarum</strong> caused by crab louse.</li>\n</ul>\n<p><strong>Image:\u00a0</strong>Swollen and inflamed eyelid suggestive of blepharitis</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/62dbd670f7b94148a8135e678c9f81cdx220x165.JPEG"
    ]
  },
  {
    "text": "A 48-year-old woman with a history of end-stage renal disease due to diabetic renal disease is admitted to the hospital with 1 day of abdominal pain and fever. She has been on continuous ambulatory peritoneal dialysis for the last 6 months. She reports that for the last day she has had a poor return of dialysate and is feeling bloated. Her vital signs include a pulse rate of 105 beats per minute, a blood pressure of 130/65, and a temperature of 38.8\u00b0C. Her abdomen is slightly distended and diffusely tender with rebound tenderness. A sample of dialysate reveals a WBC count of 400/\u03bcL with 80% neutrophils. Empiric intraperitoneal antibiotic therapy should include antibiotics against which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 2,
        "text": "Escherichia coli"
      },
      {
        "id": 3,
        "text": "Staphylococcus spp"
      },
      {
        "id": 4,
        "text": "Klebsiella pneumoniae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient has chronic ambulatory peritoneal dialysis (<strong>CAPD)-associated peritonitis</strong>&nbsp;likely to have been caused by <strong>Staphylococcus aureus.</strong>&nbsp;</p>\n<p>CAPD is usually caused most commonly by skin organisms such as Staphylococcus species that migrate into the peritoneal fluid via the device, unlike primary and secondary bacterial peritonitis which are caused by endogenous bacteria.</p>\n<p>Clinically, there is an acute onset of symptoms with diffuse abdominal pain and peritoneal signs.</p>\n<p>Laboratory analysis reveals a cloudy dialysate with &gt;100 WBC/&mu;L and &gt;50% neutrophils. It should be cultured in blood culture media. Organisms most commonly isolated are gram-positive organisms such as S. epidermidis, followed by S. aureus, and Streptococcus spp.</p>\n<p>Therefore, Empirical therapy should be directed against Staphylococcus aureus&nbsp;along with CoNS and gram negative Bacilli. An initial empirical regimen could include vancomycin with an aminoglycoside. IV antibiotics should be added in severe infections. Catheter removal should be considered if the patient does not adequately respond to antibiotic therapy within four days.</p>\n<p>Peritonitis is the most common reason for discontinuing CAPD and switching to hemodialysis. Other complications of peritoneal dialysis are-</p>\n<ol>\n<li>Catheter blockage</li>\n<li>Weight gain and poor diabetic control (dialysate fluid has high sugar content)</li>\n<li>Pleural effusion</li>\n<li>Metabolic disturbances: Hypoproteinemia, hyperglycemia.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The likely diagnosis based on the serum electrophoresis image is:",
    "choices": [
      {
        "id": 1,
        "text": "Hepatic cirrhosis"
      },
      {
        "id": 2,
        "text": "\u02511 antitrypsin deficiency"
      },
      {
        "id": 3,
        "text": "Multiple myeloma"
      },
      {
        "id": 4,
        "text": "Nephrotic syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image demonstrates a sharp peak (\"church spire&rdquo; or <strong>M band</strong>) in the gamma globulin region. This is characteristically seen in&nbsp;a patient with <strong>multiple myeloma.</strong></p>\n<p>Multiple myeloma involves a malignant proliferation of plasma cells, resulting in excessive production of abnormal immunoglobulins, causing a spike called the M band.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/802beb788324434dba4c93fdf8a2d488.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91b57e696cd64c41a1108d96cbd56972x1279x606.JPEG"
    ]
  },
  {
    "text": "A 2-year-old macrocephalic child was brought to the ER with seizures. The child has stiffness and spasticity of both limbs along with delayed milestones. Bilateral symmetrical white matter signal hyperintensity with a frontal predominance is noted on T2 MRI. Unfortunately despite resuscitation, the child passed away. The autopsy image of the brain of the child is as shown below and shows macroencephaly. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Canavan disease"
      },
      {
        "id": 2,
        "text": "Alexander\u2018s disease"
      },
      {
        "id": 3,
        "text": "X linked adrenoleukodystrophy"
      },
      {
        "id": 4,
        "text": "Metachromatic leukodystrophy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A macrocephalic child with developmental delay, seizures, and T2 MRI showing bilateral symmetrical white matter signal hyperintensity with a frontal predominance and macroencephaly is indicative of <strong>Alexander's Disease.</strong></p>\n<p>Early involvement of <strong>subcortical white matter</strong> with the predilection for the&nbsp;<strong>frontal lobe </strong>is characteristic of <strong>Alexander's disease</strong>. The disease progresses posteriorly to parietal white matter and internal and external capsules with the formation of cysts.</p>\n<p>The autopsy specimen shows&nbsp;macroencephaly and periventricular demyelination (brownish discoloration around the cerebral ventricles)</p>\n<ul>\n<li>Dysmyelinating diseases, or leukodystrophies, are inherited neurodegenerative disorders that affect the integrity of myelin in the brain and peripheral nerves. They can be seen in lysosomal storage diseases, peroxisomal disorders, and diseases caused by mitochondrial dysfunction.</li>\n<li>The most common of these are presented below.</li>\n<li><strong>Metachromatic leukodystrophy:</strong> <strong>Late infantile (most common)</strong>, juvenile, and adult types. <strong>Symmetric confluent areas of T2 hyperintensity in the periventricular white matter</strong>. Radiating T2-hypointense lines through the demyelinated deep white matter represent sparing of the perivascular white matter and result in the <strong>tigroid</strong> and <strong>leopard skin </strong>patterns when imaged in the long axis or cross-section, respectively.&nbsp;<strong>Subcortical U fibers are spared. </strong></li>\n<li><strong>X-linked Adrenoleukodystrophy: </strong>Affects the white matter of the <strong>central nervous system, adrenal cortex, and testes</strong>.</li>\n<li><strong>Canavan Disease</strong>: Spongiform leukodystrophy (extensive vacuolization of <strong>subcortical white matter</strong>). There is preferential involvement of the subcortical U fibers early on.</li>\n<li><strong>MELAS</strong> Syndrome: Mitochondrial Encephalomyopathy with Lactic Acidosis and Stroke-like episodes.</li>\n</ul>\n<p><strong>Imaging findings of other options:</strong></p>\n<p>The pattern of signal abnormality on MRI of various demyelinating diseases is depicted in the image below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/45de8988c6d947be91246e48e575abb6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65c64adcd42347fca1a243ed5440f93bx185x300.JPEG"
    ]
  },
  {
    "text": "A 31-year-old woman presents with dysmenorrhoea, menorrhagia, and infertility. After ruling out other possible causes, the gynecologist performs laparoscopy during which he finds the following lesions in the pelvis. Which of the following drugs can be administered intra-nasally to treat this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Leuprolide"
      },
      {
        "id": 2,
        "text": "Goserelin"
      },
      {
        "id": 3,
        "text": "Nafarelin"
      },
      {
        "id": 4,
        "text": "Histrelin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Nafarelin is administered via nasal spray<strong>\u00a0</strong>and it is approved for use in\u00a0<strong>endometriosis</strong>\u00a0and\u00a0<strong>central precocious puberty.</strong> Nafarelin is<strong>\u00a0</strong>used in a 200-\u03bcg twice-daily nasal spray regimen.</p>\n<p>The diagnosis of the given condition is <strong>Endometriosis</strong>. The laparoscopic picture shows <strong>powder-burn</strong> spots pathognomic of endometriosis. Endometriosis presents with unexplained infertility, dysmenorrhea, and menorrhagia.</p>\n<p>A new agent,<strong>\u00a0elagolix\u00a0sodium</strong>, is a <strong>nonpeptide oral GnRH antagonist</strong> that is recently approved by the FDA for\u00a0the management of <strong>moderate to severe pain associated with endometriosis.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ec1bd007b0da4e0aa38a31a5349d517f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 20-month-old child was diagnosed with severe acute malnutrition and was started on treatment. When can the child's treatment be considered complete?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3 and 5"
      },
      {
        "id": 2,
        "text": "2, 3 and 4"
      },
      {
        "id": 3,
        "text": "2, 3 and 5"
      },
      {
        "id": 4,
        "text": "1, 3 and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The correct answer is <strong>1, 3 and 4.</strong></p>\n<p>A child with SAM may be considered to have <strong>completed treatment</strong> when:</p>\n<ul>\n<li>There is no edema for <strong>at least 2 weeks</strong> +</li>\n<li>Weight-for-height (or length) reaches <strong>-2 SD</strong> or higher<span style=\"font-size: 12pt;\"><strong> or</strong></span> mid-upper-arm circumference is <strong>more than 12.5 cm.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8e1d7e0138c4f5b8b96873822e0396fx1280x2560.JPEG"
    ]
  },
  {
    "text": "During your visit to the CHC, you notice the ANM takes one frozen vial of a vaccine, as control, and another vial of the same vaccine.  She shakes both the vials and is trying to compare the rate of sedimentation of solutes in both vials. For which of the below-mentioned vaccines would you not be performing this test?",
    "choices": [
      {
        "id": 1,
        "text": "MMR"
      },
      {
        "id": 2,
        "text": "Pentavalent (DTwP-hepatitis B-Hib)"
      },
      {
        "id": 3,
        "text": "TT"
      },
      {
        "id": 4,
        "text": "Hepatitis B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span data-preserver-spaces=\"true\">The freeze damage to vaccines is detected by\u00a0</span><strong><span data-preserver-spaces=\"true\">the Shake test.\u00a0</span></strong><span data-preserver-spaces=\"true\">It is used for all freeze-sensitive vaccines - all the 'T-series' vaccines. The shake test is not used for\u00a0</span><strong><span data-preserver-spaces=\"true\">the MMR vaccine.</span></strong></p>\n<p>The freeze damage to vaccines is detected by <strong>Shake test. </strong></p>\n<ul>\n<li>A frozen vaccine is used as a\u00a0<strong>control vial</strong>\u00a0and the vial suspected to be damaged by freezing is taken as the\u00a0<strong>test vial</strong>.</li>\n<li>Both are\u00a0<strong>shaken after thawing</strong>\u00a0and the\u00a0<strong>rate of sedimentation</strong>\u00a0is compared.</li>\n<li>If the rate of sedimentation in test vial is slower than the control vial, then it is usable and has not been damaged.</li>\n<li>Some of the most widely used\u00a0vaccines\u00a0are\u00a0freeze-sensitive. Examples:\u00a0Diphtheria, Tetanus, Pertussis, Liquid Haemophilus influenza type b (Hib), Hepatitis B.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with long standing liver cirrhosis presents with renal dysfunction and is suspected to have hepatorenal syndrome. Which of the following statements regarding its management is true?",
    "choices": [
      {
        "id": 1,
        "text": "Treatment involves concomitant liver and renal transplant"
      },
      {
        "id": 2,
        "text": "Definitive treatment of this condition is renal transplant"
      },
      {
        "id": 3,
        "text": "Recovery of kidney function can occur spontaneously post liver transplantation"
      },
      {
        "id": 4,
        "text": "Terlipressin has no role in management of this condition"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Renal function</strong> can <strong>recover spontaneously</strong> in cases of <strong>hepatorenal syndrome (HRS) </strong>after a<strong> liver transplantation.\u00a0</strong></p>\n<p>Hepatorenal syndrome is a <strong>progressive renal failure</strong> in patients with acute or chronic liver disease.\u00a0The <strong>diagnostic criteria</strong> for hepatorenal syndrome include:</p>\n<ul>\n<li><strong>Cirrhosis</strong> with ascites</li>\n<li>Diagnosis of acute kidney injury (AKI)\n<ul>\n<li>Increase in <strong>serum creatinine of\u00a0\u2265 0.3mg/dL</strong> in 48 hours, OR</li>\n<li><strong>50% increase </strong>in serum creatinine from baseline within 7 days</li>\n</ul>\n</li>\n<li>Absence of shock</li>\n<li>No evidence of recent use of nephrotoxic agents</li>\n<li>Absence of intrinsic renal disease</li>\n<li>Other criteria that also apply:\n<ul>\n<li>Urine r<strong>ed cell excretion</strong> of <strong>fewer than 50 cells</strong> per high power field (when no urinary catheter is in place) and <strong>protein excretion</strong> less than <strong>500 mg/day</strong></li>\n<li><strong>Lack of improvement </strong>in kidney function after volume expansion with<strong> intravenous albumin </strong>(1 g/kg of body weight per day up to 100 g/day) for at least two days and withdrawal of diuretics</li>\n</ul>\n</li>\n</ul>\n<p>Management of hepatorenal syndrome includes:</p>\n<ul>\n<li>Norepinephrine</li>\n<li>Octreotide</li>\n<li><strong>Terlipressin </strong>(Option D)</li>\n<li>Midodrine</li>\n<li>Intravenous albumin\u00a0</li>\n<li><strong>Liver transplantation</strong> - definitive treatment</li>\n</ul>\n<p>Renal transplantation (Options A and B) is not indicated in HRS.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old male patient is brought with ataxia. He recalls an episode of diarrhea last week. On examination, the patient has the eye findings shown below and absent knee jerk reflexes. Which of the following is true about this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Eye movements will be normal"
      },
      {
        "id": 2,
        "text": "Antibodies against a ganglioside component will be present"
      },
      {
        "id": 3,
        "text": "The preceding diarrhea is unrelated to the condition"
      },
      {
        "id": 4,
        "text": "Electrodiagnostic study will reveal increased sensory response"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with a history of <strong>ataxia</strong>,&nbsp;<strong>absent knee jerk,</strong>&nbsp;<strong>fixed</strong> and <strong>dilated pupil, </strong>and a<strong> history of diarrhea</strong>&nbsp;is likely to have <strong>Miller-Fisher syndrome</strong> (MFS). MFS is a variant of Guillain-Barr&eacute;&nbsp;syndrome (GBS). In MFS, antibodies are seen against GQ1b, which is a <strong>ganglioside component</strong> of the nerve.</p>\n<p>GBS is progressive, symmetric muscle weakness with absent or reduced deep tendon reflexes of variable severity. It is typically an ascending paralysis that may lead to severe respiratory muscle weakness.</p>\n<p>In MFS, like GBS, symptoms may be <strong>preceded</strong> by a <strong>viral illness </strong>(upper respiratory tract infections or diarrhea). It classically presents as a triad of</p>\n<ul>\n<li>Ataxia</li>\n<li>Areflexia</li>\n<li>Ophthalmoplegia.</li>\n</ul>\n<p>The condition is usually not associated with weakness, and even if present, is very mild. It is strongly associated with antibodies to ganglioside. The prognosis for Miller-Fisher syndrome is usually good. Recovery occurs in 8-12 weeks. Some individuals are left with residual deficits.&nbsp;</p>\n<p>Electrodiagnostic studies will reveal <strong>reduced or absent</strong> <strong>sensory responses</strong> without slowing the conduction velocity. Motor nerve conduction abnormalities may be present if there is associated weakness.&nbsp;</p>\n<p>Treatment for Miller-Fisher syndrome is identical to treatment for Guillain-Barr&eacute; syndrome: <strong>intravenous immunoglobulin</strong> (IVIg) or <strong>plasmapheresis</strong> and <strong>supportive</strong> care.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/163874fce0df4b4cb4a73ad9ff0acc17.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old girl is brought to the clinic by her mother for evaluation of hair growth. Her mother noticed pubic hair growth while bathing her yesterday and is concerned that there is something wrong. Further examination reveals a girl child at 95th centile for height, tanner stage III breast development, and tanner stage IV axillary and pubic hair. Which of the following is incorrect about her condition?",
    "choices": [
      {
        "id": 1,
        "text": "The next step after physical examination is evaluation of bone age"
      },
      {
        "id": 2,
        "text": "Secondary sexual characteristics before the age of 8 is considered precocious puberty"
      },
      {
        "id": 3,
        "text": "Fasting glucose levels and HbA1C levels should be done in this patient"
      },
      {
        "id": 4,
        "text": "Serum FSH, LH and thyroid profile should be obtained in this patient"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario describes a girl child with precocious puberty. Fasting glucose levels and HbA1C levels are not recommended in the workup of precocious puberty and are rather used in the evaluation of a patient with polycystic ovarian syndrome.</p>\n<p>Precocious menstruation is one of the menstrual cycle irregularities.&nbsp;Precocious puberty&nbsp;in a girl is the appearance of any of the secondary sexual characteristics before the age of 8 years or the occurrence of menarche before the age of 10 years.&nbsp;Precocious puberty&nbsp;in boys is the onset of secondary sexual characteristics before the age of nine years.&nbsp;</p>\n<p>Classification:</p>\n<ul>\n<li>Complete precocious puberty: Idiopathic, familial, sporadic, genetic, congenital/acquired lesions of the hypothalamic and pituitary glands, specific syndromes (McCune Albright)</li>\n<li>Incomplete: Premature thelarche, adrenarche, menarche</li>\n<li>Pseudoprecocious (GnRH independent): Ovarian tumors, Adrenal hyperplasia/neoplasm, hypothyroidism, hepatoblastoma, iatrogenic-estrogen administration</li>\n</ul>\n<p>Investigations:</p>\n<ul>\n<li>Radiograph of the wrist for bone age</li>\n<li>Thyroid function tests</li>\n<li>EEG and MRI of the skull</li>\n<li>Adrenal function tests</li>\n<li>Pelvic ultrasonography</li>\n<li>GnRH, FSH, LH and estrogen levels</li>\n</ul>\n<p>Management:</p>\n<ul>\n<li>Injection DMPA</li>\n<li>Cyproterone acetate</li>\n<li>GnRH agonists</li>\n<li>Calcium and Vitamin D supplements</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old male patient comes to the clinic for preoperative evaluation before bariatric surgery. He has a complex medical history and takes many medications. He was diagnosed with schizophrenia at the age of 18 on risperidone and bronchial asthma at the age of 10 for which he takes a daily SABA and ICS. Two years ago, he was found to have an abnormal lipid profile. Subsequently, he had an anterior wall myocardial infarction for which he received percutaneous coronary intervention with stenting. On examination, the patient is obese, pulse rate is 90/min, blood pressure is 140/80 mm Hg and respiratory rate is 20/min. Read the following about anesthetic choices in this patient and choose the correct statements.",
    "choices": [
      {
        "id": 1,
        "text": "1 and 4 are correct"
      },
      {
        "id": 2,
        "text": "4 and 5 are correct"
      },
      {
        "id": 3,
        "text": "1 and 3 are correct"
      },
      {
        "id": 4,
        "text": "2, 4 and 5 are correct"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient with a complex medical history needs careful consideration of the contraindications to the use of certain anesthetic agents.&nbsp;</p>\n<p>Ketamine is not contraindicated in this patient with bronchial asthma but history of schizophrenia precludes its use in this patient</p>\n<p><strong>Contraindications for use of ketamine:</strong></p>\n<ul>\n<li>Raised intracranial pressure</li>\n<li>Open globe injury- as ketamine raises intraocular pressure</li>\n<li>Vascular aneurysm surgery- because of the possible sudden change in arterial blood pressure</li>\n<li>Psychiatric disease, such as schizophrenia</li>\n<li>Hyperthyroidism -&nbsp; exaggerated elevations in blood pressure and heart rate.</li>\n<li>Ischemic heart disease - increase in myocardial oxygen consumption</li>\n</ul>\n<p>Propofol has been associated with <strong>hypertriglyceridemia,</strong> which may predispose the patient to <strong>pancreatitis</strong>.</p>\n<p>Risk factor for propofol-induced hypertriglyceridemia:</p>\n<ul>\n<li>Old age</li>\n<li>Longer ICU stay</li>\n<li>Received propofol for a longer duration.</li>\n</ul>\n<p>Hence it is essential to monitor serum triglyceride levels when propofol is used for prolonged duration or at higher infusion rates (especially in older patients).</p>\n<p>As the patient has a history of coronary artery disease, the agent of choice is <strong>etomidate.</strong></p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Etomidate is the most <strong>cardiac stable</strong>intravenous agent due to its lack of effect on the sympathetic nervous system and on the function of the baroreceptor. The myocardial oxygen supply-to-demand ratio is well maintained. Hence, etomidate is the intravenous agent of choice in patients with<strong>&nbsp;coronary artery disease, cardiomyopathy,&nbsp;</strong>and&nbsp;<strong>cerebral vascular disease.</strong></p>\n<p><strong>Disadvantages of etomidate:</strong></p>\n<ul>\n<li>Postoperative nausea and vomiting (PONV)</li>\n<li>Myoclonus</li>\n<li>Adrenocortical suppression</li>\n<li>Epileptogenic potential</li>\n</ul>\n<p>&nbsp;</p>\n</div>\n<div class=\"ng-scope\">&nbsp;</div>\n</div>\n<div class=\"panel panel-default ng-scope\" style=\"box-sizing: border-box; margin-bottom: 20px; background-color: #ffffff; border: 1px solid #dddddd; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; -webkit-box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 1px; box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 1px;\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is/are correct with respect to the cardiac cycle, heart sounds, and the waveforms seen on the ECG?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 3"
      },
      {
        "id": 2,
        "text": "1 and 4"
      },
      {
        "id": 3,
        "text": "1, 2, and 4"
      },
      {
        "id": 4,
        "text": "1, 2, and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The statements<strong>\u00a01, 2, and 3\u00a0</strong>are correct.</p>\n<p>As clear from Wigger's diagram below, S1 corresponds the timing of S1 heart sound corresponds temporally to the occurrence of QRS wave in ECG.</p>\n<p>Similarly, the timing of the S2 heart sound corresponds to the end of the T wave in ECG.\u00a0</p>\n<p>The statement D is incorrect as the\u00a0<strong>\u2018c\u2019 wave of JVP </strong>is seen during the<strong>\u00a0isovolumetric contraction </strong>(with all valves closed)<strong>\u00a0</strong>phase<strong>\u00a0</strong>when the ventricular muscle continues to contract.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c11ba5e94b749528b9e51f2fefad15ex783x600.PNG"
    ]
  },
  {
    "text": "A 1 week-old neonate was brought to the tertiary care hospital with the following findings and a head circumference less than -3SD. The mother informs that she had been taking a drug for a neurological condition, for the last 4 years. Which of the following drugs is likely to be implicated in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Lithium"
      },
      {
        "id": 2,
        "text": "Levetiracetam"
      },
      {
        "id": 3,
        "text": "Phenytoin"
      },
      {
        "id": 4,
        "text": "Lamotrigine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The drug implicated in this case is <strong>phenytoin</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\">The mother would have been taking</span><strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong>phenytoin<strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong><span data-preserver-spaces=\"true\">during pregnancy which can cross the placenta and cause</span><strong><span data-preserver-spaces=\"true\">&nbsp;fetal hydantoin syndrome&nbsp;</span></strong><span data-preserver-spaces=\"true\">as shown in the image.</span></p>\n<p><span data-preserver-spaces=\"true\">In fetal hydantoin syndrome, the child may be small at birth with increased hair on the body and face&nbsp;facial features include a flat nasal bridge, an underdeveloped vertical groove in the centre of the upper lip (philtrum), malformed ears, downward-slanting eyes, which are spaced widely (hypertelorism), strabismus, ptosis and epicanthal folds. Other features include microcephaly and growth deficiencies like underdeveloped fingers and toes, malformed nails.<br /><br />The child would have varying degrees of&nbsp;developmental delay and the risk of an affected child having neurological deficits, cleft lip, cleft palate and heart defects very high. They may be an increased risk of the occurrence of benign or malignant tumours, such as neuroblastoma and Wilms tumour.</span></p>\n<p><span data-preserver-spaces=\"true\">Side effects of phenytoin include:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Hirsutism</span></li>\n<li><span data-preserver-spaces=\"true\">Hypersensitivity reactions</span></li>\n<li><span data-preserver-spaces=\"true\">Osteomalacia</span></li>\n<li><span data-preserver-spaces=\"true\">Megaloblastic anemia</span></li>\n<li><span data-preserver-spaces=\"true\">Fetal hydantoin syndrome&nbsp;</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Dose-related toxicity</span></strong><span data-preserver-spaces=\"true\">&nbsp;of phenytoin causes the following:</span></p>\n<ul>\n<li><strong><span data-preserver-spaces=\"true\">Ataxia, vertigo, diplopia, and nystagmus</span></strong><span data-preserver-spaces=\"true\">&nbsp;(most characteristic)</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">Other options:</span></p>\n<p><span data-preserver-spaces=\"true\">Option A: Maternal use of <strong>L</strong></span><strong>ithium</strong><span data-preserver-spaces=\"true\">&nbsp;leads to&nbsp;</span><strong><span data-preserver-spaces=\"true\">Ebstein's anomaly&nbsp;</span></strong><span data-preserver-spaces=\"true\">where there is</span>&nbsp;downward displacement of an abnormal tricuspid valve into the right ventricle&nbsp;<span data-preserver-spaces=\"true\">and macrosomia.</span></p>\n<p>Options B and D: <strong>Levetiracetam</strong> and <strong>Lamotrigine</strong> are relatively safe in pregnancy and do not seem to cause neural tube defects.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ad9a5a405b4142e6aa0b27a9f091b3fe.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e97bccf06d8446b8aa70167465ae978x1280x2129.JPEG"
    ]
  },
  {
    "text": "A 27-year-old female presents with the following lesions on the back and similar multiple, nodulocystic lesions on the face. She has tried various remedies for this condition like chemical peeling, topical and oral antibiotics, but there was no respite. She requests you to prescribe the most effective drug for this condition. You decide to start her on oral isotretinoin after performing a baseline evaluation of serum lipids, serum transaminases, and CBC. You would be correct to do all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Inform the patient to do monthly pregnancy tests while on the drug"
      },
      {
        "id": 2,
        "text": "Inform the patient to repeat testing of serum lipids, serum transaminases, and CBC again in 6 months"
      },
      {
        "id": 3,
        "text": "Ask the patient to take the drug along with high-fat meals"
      },
      {
        "id": 4,
        "text": "Ask the patient to delay pregnancy as this is a teratogenic drug"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">Baseline evaluation of serum lipids, transaminases, and CBC should be done before starting any systemic retinoids. These values should be checked <strong>monthly</strong> for the <strong>first 3&ndash;6 months</strong> and <strong>once every 3 months</strong> thereafter.</span></p>\n<p><span data-preserver-spaces=\"true\">Systemic absorption of isotretinoin is improved when taken with a fatty meal. Patients on isotretinoin should be asked to delay pregnancy as this is a teratogenic drug. Monthly pregnancy tests should be done while on the drug.</span></p>\n<p>&nbsp;<span data-preserver-spaces=\"true\">Acne is a multifactorial condition characterized by excess sebum production, epithelial hyperkeratinization, cutibacterium acnes colonization in the pilosebaceous unit, and inflammation.&nbsp;</span><span data-preserver-spaces=\"true\">Isotretinoin is an oral-systemic retinoid that has been approved for the treatment of recalcitrant and nodular acne vulgaris and is remarkably effective in severe acne. It can induce prolonged remissions after a single course of therapy. Clinical effects are seen within 1&ndash;3 months of starting therapy. Systemic absorption is improved when taken with a high-fat meal.</span></p>\n<p><span data-preserver-spaces=\"true\">Mucocutaneous side effects like&nbsp;</span><strong><span data-preserver-spaces=\"true\">cheilitis</span></strong><span data-preserver-spaces=\"true\">, xerosis, blepharoconjunctivitis, cutaneous photosensitivity, photophobia, myalgia, arthralgia, headaches, alopecia, nail fragility, and increased susceptibility to staphylococcal infections can be seen with use.&nbsp;</span><span data-preserver-spaces=\"true\">Retinoid dermatitis can develop which is characterized by erythema, pruritus, and scaling. Very rarely, patients can also develop&nbsp;</span><strong><span data-preserver-spaces=\"true\">pseudotumor cerebri,</span></strong><span data-preserver-spaces=\"true\">&nbsp;especially when systemic retinoids are taken with antibiotics like&nbsp;</span><strong><span data-preserver-spaces=\"true\">tetracyclines</span></strong><span data-preserver-spaces=\"true\">.</span></p>\n<p><span data-preserver-spaces=\"true\">Systemic retinoids are highly&nbsp;</span><strong><span data-preserver-spaces=\"true\">teratogenic&nbsp;</span></strong><span data-preserver-spaces=\"true\">and no dose is safe during pregnancy. Absolute contraindications include pregnant women, planning to become pregnant, or breastfeeding mothers. Two negative pregnancy tests (on separate occasions) are required for females of childbearing age before starting acitretin or isotretinoin.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Serum lipid elevation</span></strong><span data-preserver-spaces=\"true\">&nbsp;is the</span><strong><span data-preserver-spaces=\"true\">&nbsp;most common laboratory</span></strong><span data-preserver-spaces=\"true\">&nbsp;abnormality. Elevated transaminases, decreased thyroid hormone, and leukopenia is less common. </span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dbcc6ee70a394420bdc50936ca97f189.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the 2030 target of the India Newborn Action Plan with regards to the stillbirth rate?",
    "choices": [
      {
        "id": 1,
        "text": "< 10 per 1000 live births"
      },
      {
        "id": 2,
        "text": "< 20 per 1000 live births"
      },
      {
        "id": 3,
        "text": "< 30  per 10000 live births"
      },
      {
        "id": 4,
        "text": "< 40 per 10000 live births"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The India Newborn Action Plan targets to achieve a <strong>stillbirth rate</strong> of <strong>&lt; 10/ 1000 </strong>live births&nbsp;and <strong>neonatal mortality rate</strong> of <strong>&lt; 10/ 1000 </strong>live births (<strong>single-digit</strong> SBR and NMR) by <strong>2030</strong>.</p>\n<p>This program was launched to reduce preventable newborn deaths and stillbirths.&nbsp;It provides the following:</p>\n<ul>\n<li>Pre-conception and antenatal care</li>\n<li>Care during labor and childbirth</li>\n<li>Immediate newborn care</li>\n<li>Care of healthy newborn</li>\n<li>Care of small and sick newborn</li>\n<li>Care beyond newborn survival</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Neet 2021 Mini Test 10  (20 Questions)';
        const quizFilename = 'neet-2021-mini-test-10-20-questions-0d1eb27d.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>