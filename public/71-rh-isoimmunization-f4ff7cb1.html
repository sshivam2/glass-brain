<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>71 Rh Isoimmunization - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        PrepLadder / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">12</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "<p>All of the following statements about Rh isoimmunisation are true except:</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Occurs when Rh-ve mother encounters Rh+ve fetal blood"
      },
      {
        "id": 2,
        "text": "Mother first produces IgM, then IgG antibodies against the Rh antigen"
      },
      {
        "id": 3,
        "text": "Maternal-fetal ABO incompatibility can increase the risk"
      },
      {
        "id": 4,
        "text": "Methergine use during labor can increase the risk"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) Maternal-fetal ABO <span class=\"customMeta\" data-dictid=\"722db2c56816927771903e6469e2dc\">incompatibility</span> can increase the risk</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>Maternal-fetal ABO incompatibility</strong>\u00a0have a <strong>protective effect </strong>rather than increasing the risk of Rh isoimmunisation.</li>\n\t<li>The mother's existing antibodies eliminate <span class=\"customMeta\" data-dictid=\"10dcdd93561692777190d73418c5a7\">incompatible</span> <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> cells before they can trigger a significant <span class=\"customMeta\" data-dictid=\"dc6add5cf91692777189b30a6bae38\">immune response</span> to the Rh antigen.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Rh Isoimmunisation:</strong></p>\n\n<ul>\n\t<li>Occurs when an <strong>Rh-negative mother </strong>is exposed to <strong>Rh-positive <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> blood</strong>, most commonly during delivery, miscarriage, <span class=\"customMeta\" data-dictid=\"0decefe0901692777186f7f3f89b2a\">ectopic</span> pregnancy, or procedures like amniocentesis. This exposure sensitizes the mother\u2019s immune system to the D antigen. <strong>(Option A) </strong></li>\n\t<li>The <strong>mother's immune system</strong>, once <span class=\"customMeta\" data-dictid=\"e1c24f762816927771989a2101cb3c\">sensitized</span> to the Rh antigen, initially <strong>produces IgM antibodies</strong>, which cannot cross the placenta. These are usually <strong>followed by</strong> the production of <strong>IgG</strong> <strong>antibodies</strong>, which can cross the <span class=\"customMeta\" data-dictid=\"5276da31d11692777195f0e82f5e1d\">placenta</span> and lead to <span class=\"customMeta\" data-dictid=\"c2b082746716927771888f0933941d\">hemolysis</span> of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> red blood cells in the subsequent pregnancies. <strong>(Option B) </strong></li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"Rh incompatibility\" data-author=\"\" data-hash=\"229\" data-license=\"\" data-source=\"\" data-tags=\"November2024\" height=\"473\" src=\"https://image.prepladder.com/notes/em2JxRFjKAHqx9ChQDKq1732422061.jpg\" width=\"518\" /></p>\n\n<ul>\n\t<li>The <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">prophylactic</span> use of<strong> <span class=\"customMeta\" data-dictid=\"fdcbf0e9f71692777192931a9e29d6\">methergine</span> </strong>(ergometrine) during labor, can potentially increase fetomaternal <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> that can <strong>elevate the risk of Rh isoimmunisation</strong> by allowing more <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> red blood cells to enter the mother's circulation. <strong>(Option D) </strong></li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/notes/em2JxRFjKAHqx9ChQDKq1732422061.jpg"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/WEzAHIO9QyaZtV3wGFsC1751010393.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/L0EDejPk2LTJNaItTR9C1751010519.mp3"
  },
  {
    "text": "<p>A term newborn, delivered via LSCS to a 30-year-old G2P1 woman with O-negative blood type and inadequate prenatal care, presents with generalized edema, ascites, pallor, severe respiratory distress, and hepatosplenomegaly. The infant is critically ill and admitted to the NICU. What is the likely diagnosis?</p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"\" data-hash=\"\" data-license=\"\" data-source=\"\" data-tags=\"\" height=\"659\" src=\"https://image.prepladder.com/content/mAeiyEiDTY1sGnq2LbOj1726293012.png\" width=\"411\" /></p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Congenital Anemia of Newborn"
      },
      {
        "id": 2,
        "text": "Icterus Gravis Neonatorum"
      },
      {
        "id": 3,
        "text": "Hydrops Fetalis"
      },
      {
        "id": 4,
        "text": "Prematurity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">Hydrops</span> Fetalis</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>The baby looks pale and edematous with an enlarged <span class=\"customMeta\" data-dictid=\"ac388c59831692777180f5a8e12913\">abdomen</span> due to ascites, this is characteristic of <strong>Hydrops fetalis</strong>, a <span class=\"customMeta\" data-dictid=\"a1b06f401f1692777203a53393ba98\">form</span> of<strong> </strong><strong>hemolytic disease of the <span class=\"customMeta\" data-dictid=\"421fecf0e21692777202704942ac48\">fetus</span> and <span class=\"customMeta\" data-dictid=\"04df903fe8169277719383126b1b02\">newborn</span> (HDFN).</strong>\u00a0</p>\n\n<ul>\n\t<li><strong>Hydrops</strong> is diagnosed by identifying two or more <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> effusions \u2013 <strong>pleural, pericardial, or ascites</strong> \u2013 <strong>or one <span class=\"customMeta\" data-dictid=\"73909075e71692777187f08d3c9b7e\">effusion</span> plus anasarca.\u00a0</strong></li>\n\t<li><strong>Pathophysiology of <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis:</strong></li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"\" data-hash=\"\" data-license=\"\" data-source=\"\" data-tags=\"\" height=\"398\" src=\"https://image.prepladder.com/content/GSBBx5IHjXFdpgOGKuQv1726293096.jpg\" width=\"347\" /></p>\n\n<p><strong>Congenital <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">Anemia</span> of the <span class=\"customMeta\" data-dictid=\"04df903fe8169277719383126b1b02\">Newborn</span> (Option A)</strong>\u00a0is the <strong>mildest <span class=\"customMeta\" data-dictid=\"a1b06f401f1692777203a53393ba98\">form</span> of HDFN</strong>, characterized by slow destruction of RBCs in the first few weeks of life, leading to anemia, enlarged liver, and spleen, but typically without noticeable jaundice. Unlike <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">Hydrops</span> fetalis, it does not present with <span class=\"customMeta\" data-dictid=\"18b452e75916927771864c9ad533e1\">edema</span> and <span class=\"customMeta\" data-dictid=\"a1146fb9d8169277718250cf1224a8\">ascites</span> in the baby.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Icterus Gravis Neonatorum (Option B) </strong>is\u00a0the <strong>moderate <span class=\"customMeta\" data-dictid=\"a1b06f401f1692777203a53393ba98\">form</span> of HDFN</strong> presents as jaundice, developing within 24 hours of birth due to a build-up of unconjugated bilirubin, a <span class=\"customMeta\" data-dictid=\"1635abe5e5169277718365a15769c5\">by-product</span> of <span class=\"customMeta\" data-dictid=\"8790b4667016927771979066e8958c\">RBC</span> breakdown. The infant's liver can't process the <span class=\"customMeta\" data-dictid=\"7a1ae24f701692777187a7f60bbd9f\">excess</span> bilirubin, which can reach toxic levels and potentially lead to kernicterus, a type of brain damage. The baby in this scenario has anasarca, indicating <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">Hydrops</span> fetalis.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Prematurity (Option C):\u00a0</strong>The given condition does not indicate prematurity.</p>",
    "question_images": [
      "https://image.prepladder.com/content/mAeiyEiDTY1sGnq2LbOj1726293012.png"
    ],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/GSBBx5IHjXFdpgOGKuQv1726293096.jpg"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/NqSYdJ6KbBkflpSTCF9P1746178085.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/oJQ6xnqOcVjUzBhyF5qk1746178194.mp3"
  },
  {
    "text": "<p>A 25 year old Rh-negative woman presents to her obstetrician a day after she experienced a spontaneous miscarriage at 10 weeks gestation. She has no history of RhIG administration. What is the appropriate management to prevent Anti-D alloimmunization in this patient?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Administer 300 \u03bcg of RhIG intramuscularly"
      },
      {
        "id": 2,
        "text": "Administer 50 \u03bcg of RhIG intramuscularly"
      },
      {
        "id": 3,
        "text": "No RhIG administration needed at this stage"
      },
      {
        "id": 4,
        "text": "Check for fetomaternal hemorrhage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct Answer: B) Administer 50 \u03bcg of RhIG intramuscularly</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:624px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Pregnancy</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Rh Anti-D dosing</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>First Trimester</strong>\u00a0(Miscarriage, Abdominal trauma, Ectopic)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>50 \u03bcg</strong>, administered within 72 hours. <strong>(Option B)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>28 weeks</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>300 \u03bcg of RhIG</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>After delivery </strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>300 \u03bcg of RhIG</strong> (ideally within 72 hours but can be given up to 4 weeks) <strong>(Option A)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li>The standard <span class=\"customMeta\" data-dictid=\"8a99f9c37f16927771902daa814697\">intramuscular</span> dose of anti-D immune globulin, 300 \u03bcg or 1500 IU, will protect the average-sized mother from a <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"4642acfc0c16927771880b34fa5174\">hemorrhage</span> of up to 30 mL of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"60d609888b169277720258496ef45a\">whole blood</span> or 15 mL of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> red cells.</li>\n\t<li><strong>RhIG administration\u00a0(Option C) </strong>is recommended after pregnancy-related events like <span class=\"customMeta\" data-dictid=\"423516578d1692777192412d27cc61\">miscarriage</span> to prevent Anti-D alloimmunization, regardless of <span class=\"customMeta\" data-dictid=\"2727bb69eb1692777188a09a87f2b8\">gestational age</span> .</li>\n\t<li><strong>Checking for fetomaternal hemorrhage\u00a0(Option D)</strong>\u00a0is not needed for sensitizing events before 20 weeks .</li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/WDQQ2Tbzf5ifAFt1RGE61751010666.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/Jc15ryJKhgKfOCS7o5561751010786.mp3"
  },
  {
    "text": "<p>A pregnant woman at term with a weight of 60 kg with an approximate blood volume of 5000ml is found to have a 2% contamination of fetal-maternal hemorrhage (FMH). Calculate the dose of Anti-D required for Rh immunoprophylaxis.</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "300 \u03bcg"
      },
      {
        "id": 2,
        "text": "600 \u03bcg"
      },
      {
        "id": 3,
        "text": "1000 \u03bcg"
      },
      {
        "id": 4,
        "text": "1300 \u03bcg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) 1000 \u03bcg</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p><strong>Anti-D is given as 10 \u00b5g for every 1 mL of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> whole blood, or for every 0.5 ml of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> RBC:</strong></p>\n\n<ul>\n\t<li>Maternal blood volume= 5000 ml = 5 L</li>\n\t<li>Fetal-Maternal Hemorrhage = 2%</li>\n\t<li>FMH volume = 2% of 5000 ml = 0.02 \u00d7 5000 ml = 100 ml</li>\n\t<li>Therefore, Anti-D dose = 10 \u03bcg/ml \u00d7 100 ml =<strong> 1000 \u03bcg</strong>.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>\n\n<p><strong>Kleihauer Betke Test (Acid <span class=\"customMeta\" data-dictid=\"7c0d452a441692777187ce1b15aae3\">Elution</span> Technique):</strong></p>\n\n<ul>\n\t<li>Primarily used to detect and quantify the presence of <strong>fetal red blood cells (RBCs)</strong> in the <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> circulation.</li>\n\t<li>This is crucial for <strong>determining the appropriate dose of anti-D immune globulin</strong> in D-negative pregnant women to prevent Rh immunization.</li>\n\t<li><strong>Principle:</strong> <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">Fetal</span> RBCs contain <span class=\"customMeta\" data-dictid=\"ad2073fe6716927771885f3c1ec652\">hemoglobin</span> F, which is more resistant to acid <span class=\"customMeta\" data-dictid=\"7c0d452a441692777187ce1b15aae3\">elution</span> compared to adult <span class=\"customMeta\" data-dictid=\"ad2073fe6716927771885f3c1ec652\">hemoglobin</span> (hemoglobin A), when immersed in a <span class=\"customMeta\" data-dictid=\"3569209ba41692777184f88db9316d\">citrate</span> buffer, the HbF remained intact while the HbA leaked out.</li>\n\t<li>In the KB test, <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> blood is exposed to acid, which causes adult <span class=\"customMeta\" data-dictid=\"ad2073fe6716927771885f3c1ec652\">hemoglobin</span> to wash out (ghosts), leaving behind the more resistant <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> hemoglobin.</li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"\" data-hash=\"\" data-license=\"\" data-source=\"\" data-tags=\"\" height=\"330\" src=\"https://image.prepladder.com/content/FbP9uvafvZzdRlaSwkZ41726293270.png\" width=\"206\" /></p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/FbP9uvafvZzdRlaSwkZ41726293270.png"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/7fi1As3YVNJu6KFLTJnn1751010950.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/cCz5RO7ZGNX0Sbr39j8e1751011037.mp3"
  },
  {
    "text": "<p>A 30-year-old G3P1A1 woman, Rh-negative, at 28 weeks of gestation, presents for a routine antenatal visit. Her first child is Rh-positive, and she had a spontaneous abortion at 10 weeks during her second pregnancy. Her initial ICT was negative, but at 28 weeks, a repeat ICT is positive with a titer of 1:32. What is the next best step in her antenatal management?</p>",
    "choices": [
      {
        "id": 1,
        "text": "Administer anti-D immunoglobulin immediately"
      },
      {
        "id": 2,
        "text": "Monitor fetal MCA Doppler"
      },
      {
        "id": 3,
        "text": "Routine follow-up in 4 weeks"
      },
      {
        "id": 4,
        "text": "Early delivery at 34 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct Answer: B) Monitor <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> MCA Doppler </strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>MCA (Middle Cerebral Artery) Doppler ultrasound</strong> is a non-invasive method to assess <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> anemia, which can occur due to Rh isoimmunization.</li>\n\t<li><strong>MCA PSV >1.5 MoM</strong> for the corresponding gestational age, predicts a moderate to severe degree of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> anemia.</li>\n\t<li>Currently, <strong>MCA PSV</strong> is the <strong>mainstay of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> surveillance</strong> in a case with red cell alloimmunization.</li>\n\t<li>This value (between 24 and 35 weeks of gestation), is an indication of <strong>cordocentesis</strong> and <strong>intrauterine <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> transfusion</strong></li>\n</ul>\n\n<p><strong>Algorithm of Antenatal Management of Rh Isoimmunisation:</strong></p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"\" data-hash=\"\" data-license=\"\" data-source=\"\" data-tags=\"\" height=\"574\" src=\"https://image.prepladder.com/content/VDGkyhRmfdfVJjLbXHGG1726293427.jpg\" width=\"358\" /></p>\n\n<p><strong>Administer anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> immediately (Option A): </strong>Anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> is administered to Rh-negative mothers who are not <span class=\"customMeta\" data-dictid=\"e1c24f762816927771989a2101cb3c\">sensitized</span> (negative ICT) to prevent Rh isoimmunization. In this case, the patient already has a positive ICT with a significant <span class=\"customMeta\" data-dictid=\"07e6f3a1921692777200051f692a60\">titer</span> (critical <span class=\"customMeta\" data-dictid=\"07e6f3a1921692777200051f692a60\">titer</span> values > 1:16), indicating sensitization, so administering anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> will not be effective.</p>\n\n<p><strong>Routine follow-up in 4 weeks (Option C)</strong>: Given the ICT with a single positive titer, routine follow-up without specific assessment for <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> is not appropriate. This patient requires closer monitoring due to the risk of <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">hemolytic</span> disease of the <span class=\"customMeta\" data-dictid=\"421fecf0e21692777202704942ac48\">fetus</span> and <span class=\"customMeta\" data-dictid=\"04df903fe8169277719383126b1b02\">newborn</span> (HDFN)</p>\n\n<p><strong>Early delivery at 34 weeks (Option D)</strong>: Early delivery might be considered if severe <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> or <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis is detected and <span class=\"customMeta\" data-dictid=\"1d5d2712dc169277719050154d38a1\">intrauterine</span> <span class=\"customMeta\" data-dictid=\"cbb73554631692777200444a9ea263\">transfusion</span> is not feasible or has failed. However, this decision would be based on MCA-PSV Doppler findings.\u00a0\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/VDGkyhRmfdfVJjLbXHGG1726293427.jpg"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/p4AKabwfukq1HUfNl2ah1751011170.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/GjAxpCYdBxLhTfiUfxeE1751011298.mp3"
  },
  {
    "text": "<p>A 25-year-old Rh-negative woman, G2P1, at 28 weeks of gestation, presents for a routine antenatal visit. Her first child is Rh-positive, and she received anti-D postpartum. She reports falling on her stomach but is not experiencing any abdominal pain or bleeding. Her ICT is negative. What is the most appropriate management step regarding Rh isoimmunization?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Administer a standard prophylactic dose of anti-D immunoglobulin immediately"
      },
      {
        "id": 2,
        "text": "Schedule a USG to check for placental abruption"
      },
      {
        "id": 3,
        "text": "Repeat ICT in 2 weeks to monitor for sensitization"
      },
      {
        "id": 4,
        "text": "No intervention is needed as the patient is asymptomatic"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Correct Answer: A) Administer a standard <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">prophylactic</span> dose of anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> immediately</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li>Even <strong>blunt <span class=\"customMeta\" data-dictid=\"1665a40f1016927771801899eaed5d\">abdominal</span> trauma</strong> can cause a trivial <span class=\"customMeta\" data-dictid=\"32583099e91692777200c34d388c09\">transplacental</span> hemorrhage, which can lead to <strong>Rh sensitization.</strong></li>\n\t<li>A Standard <strong>Prophylactic anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> </strong>should be given to all Rh-negative pregnant women at 28 weeks and within 72 hours of delivery of a Rh+ve baby.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:NaN\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Standard 300 \u00b5g of anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> IM dose will protect a mother from <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"4642acfc0c16927771880b34fa5174\">hemorrhage</span> of up to 30 mL of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"60d609888b169277720258496ef45a\">whole blood</span> or 15 mL of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> RBCs.</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:NaN\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Causes of Feto-Maternal Haemorrhage and Indications of Anti-D Immunoglobulin</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Abdominal trauma</li>\n\t\t\t\t<li>Miscarriage</li>\n\t\t\t\t<li>Medical <span class=\"customMeta\" data-dictid=\"a35c217ec416927772009a7f3b20f4\">termination</span> of pregnancy</li>\n\t\t\t\t<li>Ectopic pregnancy</li>\n\t\t\t\t<li>Chorion <span class=\"customMeta\" data-dictid=\"b0bb7d5b6716927772028625a93e1e\">villus</span> biopsy</li>\n\t\t\t\t<li>Cordocentesis</li>\n\t\t\t\t<li>Genetic amniocentesis</li>\n\t\t\t\t<li>Delivery of an Rh-positive infant to Rh-negative mother: postpartum</li>\n\t\t\t\t<li>ECV (External Cephalic Version)</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p><strong>Schedule a USG to check for <span class=\"customMeta\" data-dictid=\"797686400a16927771956b27d401ff\">placental</span> abruption (Option A): </strong>While a USG may be useful to assess the <span class=\"customMeta\" data-dictid=\"5276da31d11692777195f0e82f5e1d\">placenta</span> and <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> well-being after trauma, in the absence of symptoms such as <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> or pain, it is not the immediate priority in managing Rh isoimmunization. The focus should be on preventing <span class=\"customMeta\" data-dictid=\"4fe92aaac71692777198234aaa055a\">sensitization</span> with anti-D immunoglobulin.</p>\n\n<p><strong>Repeat ICT in 2 weeks to monitor for <span class=\"customMeta\" data-dictid=\"4fe92aaac71692777198234aaa055a\">sensitization</span> (Option C):</strong> Repeating the ICT alone is not sufficient as a preventative measure. By the time <span class=\"customMeta\" data-dictid=\"4fe92aaac71692777198234aaa055a\">sensitization</span> is detected on an ICT, it is too late for prophylaxis. <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">Prophylactic</span> anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> should be administered immediately</p>\n\n<p><strong>No intervention is needed as the patient is <span class=\"customMeta\" data-dictid=\"d1a9a79f701692777182066af09044\">asymptomatic</span> (Option D):</strong> Even minor trauma can cause fetomaternal hemorrhage, and Rh-negative women should receive <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">prophylactic</span> anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> to prevent sensitization.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/4XBj9OdAM7yBhEuwAJ0V1751011434.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/BmV2iDeTmaUEksDxknZA1751011568.mp3"
  },
  {
    "text": "<p>In pregnancies complicated by Rh isoimmunization, which diagnostic procedure involves analyzing the bilirubin levels in amniotic fluid to assess the severity of fetal hemolysis and anemia indirectly?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Doppler ultrasound of MCA-PSV"
      },
      {
        "id": 2,
        "text": "Serial USG monitoring"
      },
      {
        "id": 3,
        "text": "Fetal blood sampling (FBS) via cordocentesis"
      },
      {
        "id": 4,
        "text": "Amniocentesis with \u0394OD450 analysis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Correct Answer: D) Amniocentesis with \u0394OD450 analysis</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>Amniocentesis</strong> with <span class=\"customMeta\" data-dictid=\"ccea7fb8c61692777198ee9aeb76dd\">spectral</span> analysis involves obtaining <span class=\"customMeta\" data-dictid=\"2c0fb943ce16927771815ddeb9824d\">amniotic</span> fluid and analyzing it for <strong>bilirubin concentration</strong> using <strong>spectrophotometric analysis (\u0394OD450).</strong></li>\n\t<li>This method indirectly <strong>assesses the severity of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> hemolysis</strong> by measuring the presence of bilirubin, which correlates with <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"248111ded81692777197946454db52\">red blood cell</span> breakdown<strong>.</strong></li>\n\t<li>\u0394OD450 values are interpreted using<strong> Modified Liley's (Queenan) chart</strong>,\u00a0depending upon the rise of <span class=\"customMeta\" data-dictid=\"9d7a12cab116927771811a0079086d\">antibody</span> titer<strong> </strong><strong>(>1: 8)</strong>,\u00a0to guide management decisions regarding the timing of delivery or the need for <span class=\"customMeta\" data-dictid=\"1d5d2712dc169277719050154d38a1\">intrauterine</span> <span class=\"customMeta\" data-dictid=\"cbb73554631692777200444a9ea263\">transfusion</span> in Rh-sensitized pregnancies.</li>\n\t<li>Usually done<strong> </strong><strong>after 20 weeks</strong> of pregnancy and divided into zones:</li>\n</ul>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:612px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align:center\"><strong>Zone</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align:center\"><strong>Clinical Presentation</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align:center\"><strong>Management</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align:center\"><strong>Zone 1 (Low zone)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>The <span class=\"customMeta\" data-dictid=\"421fecf0e21692777202704942ac48\">fetus</span> is unlikely to be affected</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Delivery at term is suggested</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align:center\"><strong>Zone 2 (Mid-zone)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Fetal anemia</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Preterm delivery after 34 weeks or IUT may be needed</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align:center\"><strong>Zone 3 (High zone)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Severe <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> (Hb < 8 g/dL)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Immediate IUT (Intrauterine Transfusion) needed</p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p style=\"text-align:center\"><img alt=\"Modified Liley's (Queenan) chart\" data-author=\"\" data-hash=\"232\" data-license=\"\" data-source=\"\" data-tags=\"November2024\" src=\"https://image.prepladder.com/notes/45K2UcC9tGjGUws1ws5H1732471765.jpg\" /></p>\n\n<p>\u00a0</p>\n\n<p><strong>Doppler <span class=\"customMeta\" data-dictid=\"df077f2c3d16927772019f8223e58f\">ultrasound</span> of MCA-PSV (Option A)</strong> is a non-invasive method with greater sensitivity and accuracy used to assess <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> by measuring <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> velocities in the <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> brain. It focuses on <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> dynamics(Low blood <span class=\"customMeta\" data-dictid=\"2313fc54841692777202a008c72950\">viscosity</span> & increased blood velocity) rather than direct measurement of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"2d60c5a677169277718325a811dcf1\">bilirubin</span> levels.</p>\n\n<p><strong>Serial USG monitoring (Option B): </strong>Although it is crucial for general <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> surveillance, eg. for detecting <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> hydrops, anemia, <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> anomalies, and monitoring growth restriction it does not help in assessing <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> <span class=\"customMeta\" data-dictid=\"c2b082746716927771888f0933941d\">hemolysis</span> or <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> caused by Rh isoimmunization.</p>\n\n<p><strong>Fetal blood <span class=\"customMeta\" data-dictid=\"521de62abe16927771989a90d0e9e8\">sampling</span> (FBS) via <span class=\"customMeta\" data-dictid=\"55e95ef9fe16927771856fe5e5775f\">cordocentesis</span> (Option C)</strong> involves direct <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> blood analysis from the <span class=\"customMeta\" data-dictid=\"9cc3973459169277720194a0847477\">umbilical</span> cord. It provides detailed information, such as <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> hematocrit, <span class=\"customMeta\" data-dictid=\"249592767b16927771976df58de24d\">reticulocyte</span> count, and <span class=\"customMeta\" data-dictid=\"a3c99b36b6169277718332b20cc393\">blood group</span> compatibility, and is used when other methods indicate severe <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> anemia, typically if MCA PSV is >1.5 MoM.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/notes/45K2UcC9tGjGUws1ws5H1732471765.jpg"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/DPGGtNfYvNVVMbbZwGae1751011915.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/Q1VI29BuHv1KRkY695Yr1751012047.mp3"
  },
  {
    "text": "<p>A 28-year-old pregnant woman at 30 weeks gestation, with a history of Rh isoimmunization and ICT titres above the critical level, presents with signs of moderate hydrops fetalis on ultrasound. MCA-PSV is greater than 1.5 MoM, and cordocentesis reveals that the fetal hematocrit is less than 30%, what is the most appropriate management strategy?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Monitor and terminate the pregnancy at 38 weeks"
      },
      {
        "id": 2,
        "text": "Administer steroids and plan termination at 34 weeks."
      },
      {
        "id": 3,
        "text": "Immediate intrauterine transfusion, then monitor closely."
      },
      {
        "id": 4,
        "text": "Confirm lung maturity, terminate at 34 weeks."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) Immediate <span class=\"customMeta\" data-dictid=\"1d5d2712dc169277719050154d38a1\">intrauterine</span> transfusion, then monitor closely.</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>In cases of <strong>severe <span class=\"customMeta\" data-dictid=\"c2b082746716927771888f0933941d\">hemolysis</span> with <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> compromise </strong>like <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis, <strong>immediate <span class=\"customMeta\" data-dictid=\"1d5d2712dc169277719050154d38a1\">intrauterine</span> transfusion</strong> corrects severe anemia. <strong>Close monitoring </strong>to assess response; <span class=\"customMeta\" data-dictid=\"a35c217ec416927772009a7f3b20f4\">termination</span> may be considered if conditions persist despite treatment.</p>\n\n<p><strong>Algorithm of Antenatal Management of Rh Isoimmunisation:</strong></p>\n\n<p><img alt=\"Algorithm of antenatal management of Rh Isoimmunisation\" data-author=\"\" data-hash=\"233\" data-license=\"\" data-source=\"\" data-tags=\"November2024\" src=\"https://image.prepladder.com/notes/mhUx33txWsNCw0PO1iUG1732472463.jpg\" /></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:562px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align: center;\"><strong>Condition</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align: center;\"><strong>Action</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align: center;\"><strong>Mild Affection</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Continue pregnancy up to <strong>38 weeks (Option A)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td rowspan=\"3\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p style=\"text-align: center;\"><strong>Severe Affection</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p>Terminate pregnancy <strong>around 34 weeks</strong> after steroids<strong> (Option B)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p><strong>Confirm <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> lung <span class=\"customMeta\" data-dictid=\"76948f718016927771924774ade7e9\">maturation</span> </strong>with L:S ratio (<strong><34 weeks</strong>) <strong>(Option D)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:middle\">\n\t\t\t<p><strong>Intrauterine <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> transfusion</strong> if severe <strong>before 34 weeks (Option C)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/notes/mhUx33txWsNCw0PO1iUG1732472463.jpg"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/0NWyYDPngR7mBLWGW4W81751012163.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/CW9RkSAU4FtcH6CmPVPK1751012244.mp3"
  },
  {
    "text": "<p>A 2-day-old newborn born to an Rh-negative mother presents with severe jaundice and hemolytic anemia. The mother had anti-D antibodies during pregnancy, and the baby has Hemolytic Disease of the Newborn (HDN). The neonatologist decides to perform an exchange transfusion. Which of the following is NOT a favorable characteristic for selecting blood for the transfusion?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Blood cross-matched with the mother\u2019s serum"
      },
      {
        "id": 2,
        "text": "Freshly collected blood (<7 days old)"
      },
      {
        "id": 3,
        "text": "Blood volume of 80 mL/kg body weight of the baby"
      },
      {
        "id": 4,
        "text": "Group 'O' blood if the same ABO grouping as the baby is unavailable"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) Blood volume of 80 mL/kg body weight of the baby</strong><br />\n\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>The correct amount of blood for <span class=\"customMeta\" data-dictid=\"6a80cf399d16927771875bd0f76dd9\">exchange transfusion</span> is about <strong>160 mL/kg body weight of the baby.</strong> Using only <strong>80 mL/kg would be insufficient</strong> to effectively treat severe <span class=\"customMeta\" data-dictid=\"029f7520711692777190fd7d70c220\">jaundice</span> and <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">hemolytic</span> anemia.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Characteristics of Blood for Transfusion:</strong></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:658px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Parameters</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Characteristics</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Rationale</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Blood Type\u00a0(Option D)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Rh-negative <span class=\"customMeta\" data-dictid=\"60d609888b169277720258496ef45a\">whole blood</span> with the same blood <strong>ABO grouping</strong> as that of the baby, <strong>otherwise group \u2018O\u2019.</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>To prevent any further <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">hemolytic</span> reactions.</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Cross-Matching\u00a0(Option A)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Should be done with the <strong>mother\u2019s serum</strong> or with the infant\u2019s serum</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>To ensure <span class=\"customMeta\" data-dictid=\"9f961c54641692777184ddaf41886b\">compatibility</span> and prevent <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">hemolytic</span> reactions.</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Quality\u00a0(Option B)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>The <strong>blood </strong>should be collected relatively <strong>fresh (<7 days old)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Ensures better <span class=\"customMeta\" data-dictid=\"a8dece102f16927772026b199f06af\">viability</span> and functionality of the red blood cells.</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Amount\u00a0(Option C)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>About <strong>160 mL/kg body weight of the baby.</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>To adequately treat the condition</p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/KoktjH62783ygmz5RVQA1751012377.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/SyT0w76vCdD6KySPNy4D1751012499.mp3"
  },
  {
    "text": "<p>A G2P1L1 woman is seen at 28 weeks. Her blood group is B negative & her husband's blood group is B positive. Her ICT is positive with a titre of 1:8. What is the next step in management?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Administer Anti-D immunoglobulin (RhIg)"
      },
      {
        "id": 2,
        "text": "Monitor ICT titres"
      },
      {
        "id": 3,
        "text": "Perform MCA doppler"
      },
      {
        "id": 4,
        "text": "Perform cordocentesis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct Answer: B) Monitor ICT titres </strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>ICT is positive </strong>with a <strong>titre of 1:8</strong>, which indicates the presence of <strong>antibodies in the mother's blood against Rh-positive blood cells.</strong></li>\n\t<li>Titre level of 1:8 is relatively low, i.e., <strong>less than the critical <span class=\"customMeta\" data-dictid=\"6c8421504e1692777200e552c3b421\">titre</span> (<1:16)</strong>, and does not immediately indicate severe <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">hemolytic</span> disease of the <span class=\"customMeta\" data-dictid=\"421fecf0e21692777202704942ac48\">fetus</span> or <span class=\"customMeta\" data-dictid=\"04df903fe8169277719383126b1b02\">newborn</span> (HDFN). Once the critical <span class=\"customMeta\" data-dictid=\"07e6f3a1921692777200051f692a60\">titer</span> of 1 is to 16 is crossed, then we perform MCA Doppler. Once the MCA Doppler is abnormal, then we perform cordocentesis.</li>\n</ul>\n\n<p><strong>Administer Anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> (RhIg) (Option A): </strong>Not effective since the mother is already sensitized.</p>\n\n<p><strong>Perform MCA Doppler (Option C): </strong>Not needed at this low <span class=\"customMeta\" data-dictid=\"6c8421504e1692777200e552c3b421\">titre</span> level; typically done if there\u2019s a higher risk of <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> anemia.</p>\n\n<p><strong>Perform <span class=\"customMeta\" data-dictid=\"55e95ef9fe16927771856fe5e5775f\">Cordocentesis</span> (Option D): </strong>An <span class=\"customMeta\" data-dictid=\"1c5272ad3d1692777190e71409d07a\">invasive</span> procedure reserved for cases with more severe indications, not necessary with a <span class=\"customMeta\" data-dictid=\"6c8421504e1692777200e552c3b421\">titre</span> of 1:8.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/Q0n55twrH3qE2r6DGEZp1751012593.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/Vbry7ue1bd6LYMRDPUlh1751012688.mp3"
  },
  {
    "text": "<p>A 28-year-old Rh-negative woman at 28 weeks gestation, who previously received anti-D immunoglobulin after the birth of an Rh-positive baby, seeks prenatal care. What is the recommended management for anti-D immunoglobulin administration in her current pregnancy?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Administer IM Rh immunoglobulin at 28 weeks gestation."
      },
      {
        "id": 2,
        "text": "Wait until after the delivery to administer Anti-D Immunoglobulin."
      },
      {
        "id": 3,
        "text": "Administer Anti-D Immunoglobulin only if there is evidence of maternal trauma or bleeding."
      },
      {
        "id": 4,
        "text": "No further administration of Anti-D Immunoglobulin is needed during current pregnancy."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Correct Answer: A) Administer IM Rh <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> at 28 weeks gestation.</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li>The <strong>standard practice</strong> is to administer a dose of<strong> anti-D immunoglobulin</strong> around <strong>28 weeks of gestation.</strong></li>\n\t<li>This timing ensures that any<strong> small amounts of Rh-positive blood</strong> that might have <span class=\"customMeta\" data-dictid=\"6b4030e51a1692777185c6a9dc95b0\">crossed</span> from the <span class=\"customMeta\" data-dictid=\"421fecf0e21692777202704942ac48\">fetus</span> into the <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> <span class=\"customMeta\" data-dictid=\"337d16dac5169277718474b97f6e4a\">circulation</span> are<strong> neutralized</strong> before the mother can develop an immune response.</li>\n\t<li>This <span class=\"customMeta\" data-dictid=\"bc36e9b9381692777196b5f9a2f79c\">prophylaxis</span> helps<strong> prevent </strong>the development of <strong>anti-D antibodies</strong>, which could lead to complications in the current or future pregnancies.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Wait until after the delivery to administer Anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">Immunoglobulin</span> (Option B):</strong> While anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> is also administered after delivery if the baby is Rh-positive, the <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">prophylactic</span> dose at 28 weeks is crucial for preventing Rh <span class=\"customMeta\" data-dictid=\"4fe92aaac71692777198234aaa055a\">sensitization</span> during the pregnancy.<strong>\u00a0</strong></p>\n\n<p><strong>Administer Anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">Immunoglobulin</span> only if there is evidence of <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> trauma or <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> (Option C):</strong> <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">Prophylactic</span> anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> at 28 weeks is given regardless of whether there is evidence of trauma or bleeding, to ensure comprehensive protection against Rh sensitization.\u00a0</p>\n\n<p><strong>No further administration of Anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">Immunoglobulin</span> is needed during current pregnancy (Option D):</strong> Even though she received anti-D <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> after a previous pregnancy, a <span class=\"customMeta\" data-dictid=\"a87d6eeedb16927771967434e19075\">prophylactic</span> dose at 28 weeks is still necessary in the current pregnancy to prevent sensitization.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/7qzchh4gth0oTop0mjwW1751012811.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/VEENCYn34Wi6MUki979w1751012932.mp3"
  },
  {
    "text": "<p>A 30-year-old woman at 32 weeks gestation presents with ultrasound findings of non-immune hydrops fetalis. What potential underlying cause should be considered?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Maternal Rh incompatibility"
      },
      {
        "id": 2,
        "text": "Gestational diabetes"
      },
      {
        "id": 3,
        "text": "Fetal chromosomal abnormalities"
      },
      {
        "id": 4,
        "text": "Mild maternal hypertension"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C)</strong> <strong>Fetal chromosomal abnormalities</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p><strong>Fetal chromosomal abnormalities</strong>, such as <span class=\"customMeta\" data-dictid=\"5e54fdc4d3169277720003f231621d\">trisomy</span> 21 (Down syndrome) or Turner syndrome (45, XO), are commonly associated with <strong>non-immune <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis.</strong> These genetic conditions can disrupt normal <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> development, leading to <strong>cardiovascular abnormalities</strong> and <strong>fluid accumulation.</strong></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:624px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td colspan=\"2\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Causes of Non-Immune <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">Hydrops</span> Fetalis</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Chromosomal <span class=\"customMeta\" data-dictid=\"e7ed1a964716927771801ab913204a\">abnormality</span> </strong>(20%)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Trisomies (13, 18, 21)</li>\n\t\t\t\t<li>Turner syndrome</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Congenital <span class=\"customMeta\" data-dictid=\"e1fb96fd2416927771830dfed40e14\">cardiac</span> lesions</strong> (15%)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Congenital heart block</li>\n\t\t\t\t<li>Supraventricular tachycardia</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Congenital abnormalities</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Diaphragmatic hernia</li>\n\t\t\t\t<li>Renal abnormality</li>\n\t\t\t\t<li>Cystic hygroma.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Hematological</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Beta-thalassemia</li>\n\t\t\t\t<li>G6PD deficiency</li>\n\t\t\t\t<li>Leukemia</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Infections\u00a0</strong>(14%)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Parvovirus</li>\n\t\t\t\t<li>Rubella</li>\n\t\t\t\t<li>Toxoplasma</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Placental and Umbilical Cord Pathology</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Twin-to-twin transfusion</li>\n\t\t\t\t<li>Chorioangioma</li>\n\t\t\t\t<li>Umbilical <span class=\"customMeta\" data-dictid=\"75ddd4cc7016927772012e0acd424d\">vein</span> thrombosis</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align:center\"><strong>Maternal Diseases </strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Uncontrolled diabetes</li>\n\t\t\t\t<li>Severe anemia</li>\n\t\t\t\t<li>Thyrotoxicosis</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<p><strong>Maternal Rh <span class=\"customMeta\" data-dictid=\"722db2c56816927771903e6469e2dc\">incompatibility</span> (Option A) </strong>can lead to<strong> immune <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis</strong> (not non-immune hydrops) in which <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> antibodies against <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> red blood cells cause <span class=\"customMeta\" data-dictid=\"c2b082746716927771888f0933941d\">hemolysis</span> and subsequent fluid accumulation in the fetus.</p>\n\n<p><strong>Gestational diabetes (Option B) </strong>is not typically associated with non-immune <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis. It primarily <strong>affects <span class=\"customMeta\" data-dictid=\"f375a3584316927772020efa386e3e\">fetal</span> growth</strong> and can lead to <span class=\"customMeta\" data-dictid=\"aaabbd79f01692777191a03c0b8cbc\">macrosomia</span> (large fetus) and other <span class=\"customMeta\" data-dictid=\"d92cbff33316927771927b4de10a5b\">metabolic</span> issues.</p>\n\n<p><strong>Mild <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> hypertension</strong> <strong>(Option D) </strong>alone is unlikely to cause non-immune <span class=\"customMeta\" data-dictid=\"7b09c2b34916927771896ff30fcaa0\">hydrops</span> fetalis. Severe <span class=\"customMeta\" data-dictid=\"a191a950d7169277719148e72a75e2\">maternal</span> <span class=\"customMeta\" data-dictid=\"45372f6c361692777189ff3209e642\">hypertension</span> (pre-eclampsia) with <span class=\"customMeta\" data-dictid=\"797686400a16927771956b27d401ff\">placental</span> <span class=\"customMeta\" data-dictid=\"80feaae4b31692777190ea1ba3fc25\">insufficiency</span> can lead to<strong> fetal</strong> <strong>growth restriction</strong> and sometimes hydrops, but this is less common than other causes like chromosomal abnormalities.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/2NU4BixaHVDQtyUXUZcA1751013016.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/iPcL4K8sNGEbYMj8ZVNF1751013133.mp3"
  }
];
        let quizName = '71 Rh Isoimmunization';
        const quizFilename = '71-rh-isoimmunization-f4ff7cb1.html';
        let hierarchy = ["PrepLadder", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>