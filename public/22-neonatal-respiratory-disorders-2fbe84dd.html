<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>22 Neonatal Respiratory Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The following image shows the chest X-ray of a preterm neonate who was admitted to the NICU in view of severe respiratory distress.  What does this suggest?",
    "choices": [
      {
        "id": 1,
        "text": "Meconium  aspiration syndrome"
      },
      {
        "id": 2,
        "text": "Hyaline membrane disease"
      },
      {
        "id": 3,
        "text": "Transient tachypnoea of newborn"
      },
      {
        "id": 4,
        "text": "Bronchopulmonary  dysplasia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;</p>\n<p>Chest radiograph <strong>(A)</strong> shows reticulogranular opacities throughout both lungs with prominent air bronchograms. The cardiac silhouette is preserved and both lungs are hypoaerated.</p>\n<p>Chest radiograph <strong>(B)</strong> shows more severe changes. There is obliteration of the cardiac and diaphragmatic contours due to marked opacification, giving a complete <strong>&lsquo;white out&rsquo;</strong> <strong>appearance</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1e4844d80d374529952ccd89c2225999.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b0e3f7efb9f4f75866b447a9463a883x720x304.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most important risk factor for neonatal respiratory distress syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Perinatal Asphyxia"
      },
      {
        "id": 2,
        "text": "Prematurity"
      },
      {
        "id": 3,
        "text": "Caesarean section"
      },
      {
        "id": 4,
        "text": "History of affected sibling"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Respiratory distress syndrome</strong> occurs primarily in <strong>premature infants.</strong>&nbsp;Its incidence is inversely related to gestational age and birthweight. It occurs in <strong>60&ndash;80% of infants</strong>&nbsp;delivered at <strong>&lt;28 wk</strong> of gestational age, in 15&ndash;30% of those delivered between 32 and 36 weeks of gestational age, and rarely in those delivered at &gt;37 wk of gestational age.</p>\n<p>Other risk factors include the following:</p>\n<ul>\n<li>Maternal diabetes</li>\n<li>Multiple births</li>\n<li>Cesarean delivery</li>\n<li>Asphyxia</li>\n<li>History of previously affected siblings</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A father runs to a PHC with a baby wrapped in a towel. The neonate was delivered a few hours back, at home, by the local dai. On initial examination, the medical officer notes cyanosis and severe tachypnoea. Which of the following features would favor a diagnosis of neonatal respiratory distress syndrome in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Patchy coarse infiltrates on chest X-ray"
      },
      {
        "id": 2,
        "text": "Air bronchogram on chest X-ray"
      },
      {
        "id": 3,
        "text": "Emaciated appearance with palmar and plantar creases"
      },
      {
        "id": 4,
        "text": "Onset of distress after 6 hours of birth"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Air bronchogram</strong> on chest x-ray is suggestive of <strong>neonatal respiratory distress syndrome.</strong></p>\n<p>Other chest x-ray findings in respiratory distress syndrome (RDS):</p>\n<ul>\n<li>Fine reticulogranular pattern</li>\n<li>Bilateral diffuse ground-glass opacities</li>\n<li>White-out lung (severe disease)</li>\n</ul>\n<p>Option A:<strong> Patchy coarse infiltrates</strong> are associated with <strong>meconium aspiration syndrome.</strong></p>\n<p>Option C: Reduced fat under the skin resulting in an<strong> emaciated appearance</strong> as well as <strong>prominent creases</strong> is a feature of <strong>post-term babies.</strong>&nbsp;Respiratory distress syndrome is more common among preterm babies&nbsp;</p>\n<p>Option D: Onset of <strong>respiratory distress syndrome</strong> is <strong>within 6 hours</strong> of birth.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding the treatment of RDS with surfactant is false?",
    "choices": [
      {
        "id": 1,
        "text": "It is given in neonates with RDS who fail CPAP"
      },
      {
        "id": 2,
        "text": "It is given prophylactically to all neonates at < 31 weeks gestation."
      },
      {
        "id": 3,
        "text": "It can be given as rescue treatment when RDS actually develops."
      },
      {
        "id": 4,
        "text": "Repeated dosing is given every 6-12 hr for a total of 2 to 4 doses."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Surfactant is given <strong>prophylactically to all neonates &lt; 28 weeks, </strong>not 31 weeks. It is given irrespective of the presence or absence of RDS. The <strong>route</strong> of administration is <strong>intratracheal.</strong></p>\n<p>Surfactant is indicated in all infants with <strong>moderate to severe RDS</strong>. It is also given as a <strong>rescue treatment</strong> when CPAP fails.</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A first-year resident receives a call from the casualty regarding an unbooked primigravida, at 32 weeks of gestation. She has presented with regular painful uterine contractions. On examination, her cervix is 2cm dilated. What dose of betamethasone injection should the resident give her?",
    "choices": [
      {
        "id": 1,
        "text": "6mg q12h; 2 doses"
      },
      {
        "id": 2,
        "text": "12mg q24h; 2 doses"
      },
      {
        "id": 3,
        "text": "12mg q6h; 4 doses"
      },
      {
        "id": 4,
        "text": "6mg q12h; 4 doses"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The woman is currently in preterm labour and the dose of antenatal <strong>betamethasone</strong>&nbsp;given for avoiding complications of prematurity is <strong>12mg IM every 24 hours (total 2 doses).</strong></p>\n<p><strong>Dexamethasone</strong> is used, the dose is&nbsp;<strong>6mg IM every 12 hours (total 4 doses).</strong></p>\n<p>Corticosteroid administration is recommended for all women in<strong> preterm labour</strong> (&lt;34 weeks of gestation).</p>\n<p>Antenatal steroid administration reduces the risk of the following: (RINN)</p>\n<ul>\n<li>Respiratory distress syndrome (<strong>R</strong>DS)</li>\n<li>Intraventricular haemorrhage&nbsp;(<strong>I</strong>VH)</li>\n<li>Necrotizing enterocolitis (<strong>N</strong>EC)</li>\n<li><strong>N</strong>eurodevelopmental delay</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman with a history of recurrent late-trimester abortions is in preterm labor, presumed to be due to chorioamnionitis. She has received one dose of betamethasone injection. This is a precious pregnancy and the relatives are concerned about prematurity-related complications in the baby. Which of the following is useful for assessing lung maturity in this fetus?",
    "choices": [
      {
        "id": 1,
        "text": "L/S ratio"
      },
      {
        "id": 2,
        "text": "Bilirubin content of amniotic fluid"
      },
      {
        "id": 3,
        "text": "Ultrasound"
      },
      {
        "id": 4,
        "text": "Amniocentesis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>lecithin&ndash;sphingomyelin ratio (L/S ratio)</strong> is an amniotic fluid test used to assess fetal lung maturity.<strong> L/S ratio of &lt; 2</strong> in amniotic fluid indicates <strong>lung&nbsp;immaturity</strong>.&nbsp;</p>\n<p>Surfactant starts appearing in the fetal lung by <strong>20 weeks</strong> of gestation. Levels indicating lung maturity are detected <strong>after 35 weeks</strong>.</p>\n<p>Surfactant is a complex mixture of lipids, proteins, and carbohydrates produced by<strong> type II pneumocytes</strong> in the lung epithelium.&nbsp;The absence of surfactant in the liquid film lining the alveoli causes an increase in surface tension and alveolar collapse. If not treated, such atelectasis leads to increased work of breathing, intrapulmonary shunting, ventilation-perfusion mismatch, hypoxia, and eventually respiratory failure.&nbsp;</p>\n<p>The relative concentration of the phospholipids lecithin (L) and sphingomyelin (S) is an indicator of lung maturity. The outward flow of pulmonary secretions from the fetal lungs into the amniotic fluid maintains the level of lecithin and sphingomyelin equally until 32&ndash;33 weeks gestation when the lecithin concentration begins to increase significantly while sphingomyelin remains nearly the same. An L&ndash;S ratio of 2.5 or more indicates fetal lung maturity while an L/S ratio of less than 1.5 is associated with a high risk of infant respiratory distress syndrome.</p>\n<p>Other tests done to assess fetal lung maturity are:</p>\n<ul>\n<li>Shake test/bubble test</li>\n<li>Phosphatidyl glycerol measurement</li>\n<li>Surfactant:albumin ratio</li>\n<li>Lamellar body counts</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an indicator of fetal lung maturity?",
    "choices": [
      {
        "id": 1,
        "text": "Lecithin-sphingomyelin ratio > 2.5"
      },
      {
        "id": 2,
        "text": "Positive shake test"
      },
      {
        "id": 3,
        "text": "Increased phosphatidyl glycerol"
      },
      {
        "id": 4,
        "text": "Nile blue test showing >50% of blue cells"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Nile blue test&nbsp;</strong>showing <strong>&gt;50% orange cells</strong> is a sign of fetal lung maturity, not blue cells.</p>\n<p>Tests for the assessment of <strong>fetal lung maturity</strong> include:&nbsp;</p>\n<p>The <strong>Nile blue test</strong> involves staining desquamated fetal cells from amniotic fluid with 0.1% Nile blue sulfate. The presence of <strong>orange cells &gt; 50%</strong>&nbsp;suggests<strong>&nbsp;lung maturity.&nbsp;</strong><strong>Lecithin/sphingomyelin ratio</strong> at 31 to 32 weeks is 1, and at 35 weeks ratio is 2. The <strong>ratio&nbsp;&ge;2</strong> indicates lung maturity (option A).&nbsp;</p>\n<p>The <strong>shake test</strong> or <strong>bubble test</strong> (<strong>Clement's test</strong>) (option B) involves mixing <strong>amniotic fluid</strong> with <strong>95% ethanol</strong>, shaking it for 15 seconds, and observing it for 15 minutes. A <strong>complete ring of</strong> <strong>bubbles</strong> at the meniscus is a <strong>positive test</strong> and indicates lung maturity. This is a useful bedside test.</p>\n<p>The presence of <strong>phosphatidylglycerol</strong>, (option C)&nbsp;<strong>saturated phosphatidylcholine</strong>&nbsp;and&nbsp;<strong>lamellar body count (&gt;50,000/mcL)</strong>&nbsp;indicates lung maturity.</p>\n<p><strong>Glucocorticoids</strong> accelerate <strong>lung maturation</strong> and <strong>lower</strong> the incidence of <strong>respiratory distress</strong> and <strong>neonatal mortality</strong> in preterms if the birth was delayed for at least 24 hours after initiation of betamethasone. A single course of corticosteroids is recommended for women between <strong>24 and 36 weeks</strong> who are at risk of delivery within 7 days. Intramuscular injections of either<strong> 2 doses of 12 mg</strong> <strong>betamethasone</strong> are given <strong>24 hourly</strong> or <strong>4 doses of 6 mg dexamethasone</strong> are given <strong>12 hourly</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female infant was born in a community hospital by spontaneous vaginal delivery at 34 weeks of gestation. 30 minutes later, the baby\u2019s breathing became excessively laboured. Despite providing non-invasive ventilation, the baby died. Post-mortem histopathological examination of the lung showed thick pink membranes lining the small, collapsed alveolar spaces and necrotic debris, mainly within the respiratory bronchioles, alveolar ducts, and unopened alveoli. What are these membranes chiefly composed of?",
    "choices": [
      {
        "id": 1,
        "text": "Phosphatidylcholine"
      },
      {
        "id": 2,
        "text": "Fibrin"
      },
      {
        "id": 3,
        "text": "Mucoprotein"
      },
      {
        "id": 4,
        "text": "Complex polysaccharide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The history of respiratory distress in a premature baby (34 weeks) and a biopsy showing pink (hyaline) membranes in the alveoli is indicative of <strong>hyaline membrane disease</strong> (HMD). The hyaline membranes are composed of layers of <strong>fibrin-rich edema fluid</strong> and necrotic cells of lining alveoli. Diffuse ischemic damage to the alveoli causes the transudation of proteins into the alveoli to form the hyaline membrane.</p>\n<p>Hyaline membrane disease (HMD), also known as infantile respiratory distress syndrome (IRDS) or respiratory distress syndrome of newborns (RDS) is a syndrome in premature infants caused by developmental insufficiency of pulmonary surfactant production and structural immaturity of the lungs.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4100ce6c80f64fdaa4da6220b53f6fbd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A primigravida was taken up for emergency cesarean section in view of placental abruption, at 32 weeks of gestation. Immediately after delivery, you dry the baby, clear secretions from the mouth and nose, and provide tactile stimulation. But even after 30 seconds, you note the baby is still gasping for breath and oxygen saturation has not increased more than 92%. Which is the next best step?",
    "choices": [
      {
        "id": 1,
        "text": "Mechanical  ventilation"
      },
      {
        "id": 2,
        "text": "CPAP"
      },
      {
        "id": 3,
        "text": "100% oxygen"
      },
      {
        "id": 4,
        "text": "Surfactant and ventilation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>most common cause </strong>of<strong> respiratory distress</strong> in a <strong>preterm </strong>infant is <strong>neonatal RDS </strong>(hyaline membrane disease). The infant has presented with moderate respiratory distress without any signs of respiratory failure so early <strong>continuous positive airway pressure (CPAP)</strong> is the appropriate treatment.</p>\n<p>CPAP started at birth is the choice for the management of a preterm infant at risk for respiratory distress syndrome (RDS).\u00a0Early nasal CPAP has shown to lower mortality and risk of bronchopulmonary dysplasia. Room air is better than oxygen for the resuscitation of preterm infants, and 100% oxygen is also harmful, causing increased oxidative stress.</p>\n<p>The intubate-surfactant-extubate (INSURE) on CPAP technique is recommended for <strong>surfactant</strong> administration when babies showed signs of<strong> RDS</strong> and <strong>needed more than 30% inspired oxygen</strong> to maintain saturation\u00a0in the normal range.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-hour-old neonate with apnea has been on bag and mask ventilation for the last 30 seconds. She has now started taking spontaneous breaths. The heart rate is still between 100 and 110/min. What is your next step?",
    "choices": [
      {
        "id": 1,
        "text": "Discontinue ventilation"
      },
      {
        "id": 2,
        "text": "Continue ventilation"
      },
      {
        "id": 3,
        "text": "Give chest compression"
      },
      {
        "id": 4,
        "text": "ET intubation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>As per the NRP algorithm, at any time during resuscitation<strong>, </strong>if the<strong> HR &gt; 100</strong> and<strong> spontaneous breathing </strong>resumes then<strong> discontinue ventilation</strong>.<br />The components of NRP resuscitation include: (TABCD)</p>\n<ul>\n<li><strong>T</strong>emperature- maintain between 36.5 and 37.5 C</li>\n<li><strong>A</strong>irway- \"sniffing\" position, clear secretions if needed</li>\n<li><strong>B</strong>reathing- free flow O2 (maintain sats 91&ndash;95%), PPV (40&ndash;60 breaths /min), ETT</li>\n<li><strong>C</strong>irculation- chest compressions:ventilation ratio (3:1 = 90:30; lower 1/3rd sternum; two thumb technique preferred)</li>\n<li><strong>D</strong>rugs- Epinephrine, volume expanders&nbsp;</li>\n</ul>\n<p>Algorithm states:</p>\n<ul>\n<li><strong>HR &lt; 100/min</strong> + no respirations&nbsp;&rarr;&nbsp; Positive pressure ventilation (<strong>PPV)</strong></li>\n<li>No response with PPV &rarr;<strong>&nbsp;</strong>Endotracheal intubation (<strong>ET</strong>)</li>\n<li><strong>HR &lt; 60/min</strong>&nbsp;&rarr;&nbsp;<strong>Chest compressions</strong></li>\n<li>No response to chest compressions&nbsp;&rarr; <strong>epinephrine</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A preterm infant in the NICU was observed to have marked nasal flare, distinct xiphoid retractions, minimal intercostal retractions, and inspiratory lag with an audible grunt. What would be the Silverman Anderson score?",
    "choices": [
      {
        "id": 1,
        "text": "10"
      },
      {
        "id": 2,
        "text": "7"
      },
      {
        "id": 3,
        "text": "8"
      },
      {
        "id": 4,
        "text": "9"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Downes&rsquo; Score</strong> is also used for assessing the severity of respiratory distress. It is more comprehensive and can be applied to any gestational age and condition.&nbsp;Downe&rsquo;s<strong> score of &gt;7</strong>&nbsp;means <strong>impending respiratory failure.</strong></p>\n<table style=\"height: 191px;\" width=\"621\">\n<tbody>\n<tr>\n<td style=\"width: 148.25px;\">Score</td>\n<td style=\"width: 148.25px;\">0</td>\n<td style=\"width: 148.25px;\">1</td>\n<td style=\"width: 148.25px;\">2</td>\n</tr>\n<tr>\n<td style=\"width: 148.25px;\"><strong>Respiratory rate</strong></td>\n<td style=\"width: 148.25px;\">&lt;60/min</td>\n<td style=\"width: 148.25px;\">60&ndash;80/min</td>\n<td style=\"width: 148.25px;\">&gt;80/min</td>\n</tr>\n<tr>\n<td style=\"width: 148.25px;\"><strong>Air entry</strong></td>\n<td style=\"width: 148.25px;\">Normal</td>\n<td style=\"width: 148.25px;\">Mild decrease</td>\n<td style=\"width: 148.25px;\">Marked decrease</td>\n</tr>\n<tr>\n<td style=\"width: 148.25px;\"><strong>Cyanosis</strong></td>\n<td style=\"width: 148.25px;\">Nil</td>\n<td style=\"width: 148.25px;\">In-room air</td>\n<td style=\"width: 148.25px;\">On &gt;40% O2</td>\n</tr>\n<tr>\n<td style=\"width: 148.25px;\"><strong>Grunting</strong></td>\n<td style=\"width: 148.25px;\">None</td>\n<td style=\"width: 148.25px;\">Only on auscultation</td>\n<td style=\"width: 148.25px;\">Audible with the naked ear</td>\n</tr>\n<tr>\n<td style=\"width: 148.25px;\"><strong>Retraction</strong></td>\n<td style=\"width: 148.25px;\">Nil</td>\n<td style=\"width: 148.25px;\">Mild</td>\n<td style=\"width: 148.25px;\">Moderate</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8389224afa548be8afcd8bc995b38c8x1280x1839.JPEG"
    ]
  },
  {
    "text": "As part of calculating Downe's score for a baby, you would assess all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Cyanosis"
      },
      {
        "id": 2,
        "text": "Nasal flaring"
      },
      {
        "id": 3,
        "text": "Air entry"
      },
      {
        "id": 4,
        "text": "Respiratory rate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Downe's scoring</strong></p>\n<table>\n<tbody>\n<tr>\n<td><strong>Score</strong></td>\n<td><strong>\u00a00</strong></td>\n<td><strong>\u00a01</strong></td>\n<td><strong>\u00a02</strong></td>\n</tr>\n<tr>\n<td>Respiratory rate</td>\n<td>&lt;60/min</td>\n<td>\u00a060\u201380/min</td>\n<td>&gt;80/min</td>\n</tr>\n<tr>\n<td>Air entry</td>\n<td>\u00a0Normal</td>\n<td>Mild decrease</td>\n<td>Marked decrease</td>\n</tr>\n<tr>\n<td>Cyanosis</td>\n<td>\u00a0Nil</td>\n<td>In room air</td>\n<td>On &gt;40% O2</td>\n</tr>\n<tr>\n<td>Grunting</td>\n<td>\u00a0None</td>\n<td>Only on auscultation</td>\n<td>Audible with naked ear</td>\n</tr>\n<tr>\n<td>Retraction</td>\n<td>\u00a0Nil</td>\n<td>Mild</td>\n<td>Moderate</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Your brother-in-law calls you during one of your night duties and tells you that your sister just delivered a baby girl and that both the mother and the child are doing well following the cesarean delivery. The next morning, however, you get a call that the baby started having trouble breathing and has been shifted to the NICU. He also sends you a photo of her chest X-ray via WhatsApp. On the radiograph, you note streaky, perihilar linear densities and fluid in the horizontal fissure. Which of the following is true regarding the given clinical condition?",
    "choices": [
      {
        "id": 1,
        "text": "Only observation and supportive therapy is needed"
      },
      {
        "id": 2,
        "text": "It can predispose to bronchopulmonary dysplasia"
      },
      {
        "id": 3,
        "text": "More common in preterm infants"
      },
      {
        "id": 4,
        "text": "Management involves surfactant administration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div id=\"F0007\" class=\"whole_rhythm\">\n<div class=\"caption\">\n<p>&nbsp;</p>\n<p id=\"__p17\">Chest radiograph <strong>(A)</strong> on day 1 at 6 hours shows a bilateral diffuse ground-glass appearance and fine granularity due to interstitial opacities.</p>\n<p>Chest radiograph <strong>(B)</strong> of the same patient at the age of 2 days (B) shows that the pulmonary parenchymal opacities have decreased, though perihilar streaky markings are still present.</p>\n</div>\n</div>\n<p>Treatment is supportive and minimal oxygen treatment (&lt; 40%) is often adequate; infants usually <strong>recover within 3 days.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd07535baff44951aec4d4dd3f470691x557x219.JPEG"
    ]
  },
  {
    "text": "A preterm, extremely low birth weight baby, delivered by emergency caesarian section was admitted to the NICU and treated for respiratory distress syndrome. She responded to treatment and was discharged. At 6 months of age, she is still having recurrent respiratory distress and requires supplemental oxygen at home. The baby was diagnosed with bronchopulmonary dysplasia. Which of the following does not cause this clinical complication?",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen therapy in the NICU"
      },
      {
        "id": 2,
        "text": "Mechanical trauma to the lungs"
      },
      {
        "id": 3,
        "text": "Inhalation of nitrous oxide"
      },
      {
        "id": 4,
        "text": "Patent Ductus Arteriosus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Inhalation of nitrous oxide (N2O)&nbsp;</strong>is <strong>not associated</strong> with bronchopulmonary dysplasia (BPD). Inhaled NO is a pulmonary vasodilator approved for the treatment of hypoxic respiratory failure in term and near-term infants with pulmonary hypertension. It may have a role in preventing BPD.</p>\n<p>BPD is a pathologic process leading to clinical features of chronic lung disease that originates in the neonatal period and is defined by an oxygen requirement for 28 days postnatally. Inflammatory injury to the developing lungs due to&nbsp;<strong>barotrauma</strong> and <strong>oxygen toxicity </strong>resulting&nbsp;from<strong> prolonged mechanical ventilation </strong>is the key factor driving the pathogenesis of BPD. Together with other antenatal and postnatal factors, it results in aberrant tissue repair, dysregulated vascular and arrested alveolar development, which is the basis of the pathology seen in BPD.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9363aa9487641e1a00373c13bfe65a3x1280x1784.5980253878702.JPEG"
    ]
  },
  {
    "text": "A female newborn was delivered at 40 weeks of gestation by emergency C-section, following signs of severe fetal distress. Greenish amniotic fluid was noted. Immediately following delivery, the baby was shifted to the NICU and had to be intubated. Her chest X-Ray is as below. What does it show?",
    "choices": [
      {
        "id": 1,
        "text": "Mediastinal shift"
      },
      {
        "id": 2,
        "text": "Ground glass opacities"
      },
      {
        "id": 3,
        "text": "Fluid in the interlobar fissure"
      },
      {
        "id": 4,
        "text": "Patchy infiltrates and coarse streaking"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows <strong>patchy infiltrates and coarse streaking,</strong>&nbsp;which are characteristic findings in the chest X-ray image of infants with <strong>meconium&nbsp;aspiration syndrome</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7148095bf7b245168b7ff6818a157cb5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A newborn infant,  delivered at home, at 42 weeks of gestation, became cyanotic and started breathing rapidly. The child was immediately taken to the nearby primary health centre. As the medical officer prepares to intubate, she notes greenish staining on the vocal cords. Which of the following is this baby likely to develop?",
    "choices": [
      {
        "id": 1,
        "text": "Listeriosis"
      },
      {
        "id": 2,
        "text": "Pathological jaundice"
      },
      {
        "id": 3,
        "text": "Obstructive emphysema"
      },
      {
        "id": 4,
        "text": "Meconium ileus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Respiratory distress in a post-term neonate with a history of greenish (meconium-stained) amniotic fluid during delivery is suggestive of meconium aspiration syndrome (MAS). The aspirated meconium can block the large and small airways, causing patchy&nbsp;<strong>atelectasis</strong> and <strong>emphysema. </strong>This&nbsp;produces a ventilation-perfusion mismatch. Severe overinflation can lead to air leak syndromes such as pneumothorax.&nbsp;</p>\n<p>Meconium consists of water, desquamated GIT cells, skin, lanugo hair, vernix, bile salts, pancreatic enzymes, lipids, and mucopolysaccharides. The bile salts and pancreatic enzymes can cause&nbsp;<strong>chemical pneumonitis</strong>. Meconium can also cause <strong>surfactant inactivation</strong> by displacing it from the alveolar surface and inhibiting its surface tension-lowering ability. Severe MAS is associated with remodelling and thickening of the muscular walls, resulting in <strong>pulmonary hypertension.</strong>&nbsp;</p>\n<p>Infants who develop MAS typically present in the first 12 hours after birth with varying degrees of respiratory distress. On inspection, many affected infants have 'barrel chests'; crackles (rales) and rhonchi often can be heard on auscultation. In severe cases, the entire lungs can be involved resulting in a total &ldquo;whiteout&rdquo; of the lungs on the radiograph.</p>\n<p><strong>Listeriosis</strong> is an infection that is acquired from the mother and is reported to be rarely associated with meconium-stained amniotic fluid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4121032c96c141f2aad7b004668a6fb4x1280x1538.JPEG"
    ]
  },
  {
    "text": "Which of the following is false about apnea of prematurity (AOP)?",
    "choices": [
      {
        "id": 1,
        "text": "Usually resolves by 37 weeks post conceptional age"
      },
      {
        "id": 2,
        "text": "Gentle tactile stimulation is often adequate for mild to moderate episodes"
      },
      {
        "id": 3,
        "text": "Recurrent AOP can be treated with caffeine or theophylline"
      },
      {
        "id": 4,
        "text": "AOP is a risk factor for Sudden infant death syndrome (SIDS)"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Apnea of prematurity <strong>(AOP)</strong> is <strong>not a risk</strong> factor for sudden&nbsp;infant death syndrome <strong>(SIDS)</strong>.</p>\n<p>It is defined as <strong>cessation of breathing for longer than 20 seconds</strong> or for any duration if accompanied by <strong>cyanosis or bradycardia.&nbsp;</strong>It is a diagnosis of exclusion. It is seen in <strong>preterm</strong> infants and usually resolves by the 37th week of gestation. Recurrent apnea of prematurity may be treated with caffeine or theophylline. It does not predict the future occurrence of SIDS.</p>\n<p><strong>Sudden Infant Death Syndrome</strong> (SIDS) is the sudden death of an infant <strong>under one year</strong> of age, which remains <strong>unexplained</strong> after a thorough case investigation, including the performance of a complete autopsy, examination of the death scene, and review of the clinical history.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While monitoring the respiratory rate of the infants in the NICU, you notice one baby which suddenly stops breathing. Which of the following statements is true in this regard?",
    "choices": [
      {
        "id": 1,
        "text": "Primary apnea is characterized by  labile BP and tachycardia"
      },
      {
        "id": 2,
        "text": "Caffeine therapy should be given in primary apnea"
      },
      {
        "id": 3,
        "text": "Secondary apnea responds to stimulation by establishing normal breathing."
      },
      {
        "id": 4,
        "text": "Central asphyxia can cause secondary apnea"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Secondary apnea&nbsp;</strong>can occur as a central CNS meditated asphyxia or due to neuromuscular disorders.&nbsp;</p>\n<p>Apnea is the <span data-token-index=\"1\"><strong>cessation</strong> of <strong>breathing</strong> for <strong>&gt;20 seconds</strong>&nbsp;</span>or<span data-token-index=\"3\">&nbsp;for <strong>any duration</strong>&nbsp;</span>if <strong>accompanied</strong> by&nbsp;<strong>bradycardia</strong>&nbsp;and&nbsp;<strong>cyanosis.</strong>&nbsp;</p>\n<table style=\"height: 252px;\" width=\"453\">\n<tbody>\n<tr>\n<td style=\"width: 219.132px; text-align: center;\"><strong>Primary Apnea&nbsp;</strong></td>\n<td style=\"width: 219.132px; text-align: center;\"><strong>Secondary Apnea</strong></td>\n</tr>\n<tr>\n<td style=\"width: 219.132px;\">Failure to initiate respiratory effort at birth</td>\n<td style=\"width: 219.132px;\">Apnea developing in an infant who has initiated a respiratory effort</td>\n</tr>\n<tr>\n<td style=\"width: 219.132px;\">There may be bradycardia and decreased tone. BP remains normal</td>\n<td style=\"width: 219.132px;\">\n<p>Can originate in CNS due to asphyxia or peripherally due to neuromuscular disorders</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 219.132px;\">Respond to tactile stimulation</td>\n<td style=\"width: 219.132px;\">Require ventilatory assistance and drugs- caffeine or theophylline</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 15-day-old infant had conjunctivitis, which later developed into respiratory distress and pneumonia. Chest X-ray examination revealed bilateral lung infiltrates. Peripheral smear count showed 14,300/dL (N 43, L 54, E3).  Which of the following is the most likely pathogenic organism?",
    "choices": [
      {
        "id": 1,
        "text": "Chlamydia trachomatis"
      },
      {
        "id": 2,
        "text": "Streptococcus pneumonia"
      },
      {
        "id": 3,
        "text": "Neisseria gonorrhoeae"
      },
      {
        "id": 4,
        "text": "Mycoplasma pneumonia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The organism most likely to cause the mentioned infections is<strong> Chlamydia trachomatis</strong>.</p>\n<p><strong>Pneumonia</strong> caused by C. trachomatis can develop in 10\u201320% of infants born to <strong>women</strong> with <strong>active, untreated</strong> chlamydial <strong>infection.</strong> Only approximately 25% of infants with nasopharyngeal chlamydial infection develop pneumonia.</p>\n<p><strong>C. trachomatis pneumonia of infancy</strong> has a very characteristic presentation. It\u00a0usually occurs between <strong>1-3 months</strong> of age and is insidious, with a persistent <strong>cough, tachypnea,</strong> and <strong>absence</strong> of <strong>fever.</strong> Auscultation reveals <strong>rales;</strong> wheezing is uncommon.</p>\n<p>The absence of fever and wheezing helps to distinguish C. trachomatis pneumonia from respiratory syncytial virus pneumonia.</p>\n<p>A distinctive laboratory finding is the presence of <strong>peripheral eosinophilia (&gt;400 cells/\u00b5L).</strong> <br />The most consistent finding on <strong>chest radiograph</strong> is<strong> hyperinflation</strong> accompanied by<strong> minimal interstitial or alveolar infiltrates.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The radiologist calls and confirms a Bochdalek hernia in a baby born with multiple congenital anomalies. The baby had been placed under an oxygen hood in the NICU, in view of postnatal respiratory distress. On repeat evaluation, he continues to have sternal retractions and is not maintaining saturation. Which of the following would be your initial clinical intervention in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Intubate and insert a nasogastric tube"
      },
      {
        "id": 2,
        "text": "Bag and mask ventilation"
      },
      {
        "id": 3,
        "text": "Insert a central venous pressure line"
      },
      {
        "id": 4,
        "text": "Ventilate with a high-frequency ventilator"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Once the diagnosis of congenital diaphragmatic hernia is made or suspected, all patients are<strong> intubated. </strong>Also a<strong>&nbsp;</strong><strong>nasogastric&nbsp;<span id=\"mark_text_5\" class=\"highlightedCurrent\">tube,&nbsp;</span></strong>connected to continuous suction, is placed in the stomach to reduce lung compression.&nbsp;</p>\n<p>Congenital diaphragmatic hernia (CDH) is a birth defect of the diaphragm. The most common type of CDH is a <strong>Bochdalek hernia</strong> (postero-lateral diaphragmatic hernia); other types include Morgagni hernia (anterior-parasternal), diaphragm eventration, and central tendon defects of the diaphragm. Malformation of the diaphragm allows the abdominal organs to push into the chest cavity, hindering proper lung formation and expansion.</p>\n<p class=\"bulletIndent2\"><strong><span class=\"glyph\">Immediate steps of management:&nbsp;</span></strong></p>\n<p class=\"bulletIndent2\"><span class=\"glyph\">Endotracheal intubation&nbsp;&rarr;&nbsp;</span>Placement of a nasogastric&nbsp;<span id=\"mark_text_6\" class=\"highlightedCurrent\">tube</span>&nbsp;&nbsp;<span class=\"glyph\">&rarr;&nbsp;</span>Administration of fluids and inotropic agents&nbsp;<span class=\"glyph\">&rarr;&nbsp;</span>Administration of surfactant therapy to&nbsp;<strong>only</strong>&nbsp;preterm infants with findings suggestive of respiratory distress syndrome.<strong>Other options:</strong></p>\n<p>Option B: <strong>Bag and mask ventilation is to be avoided</strong> as they lead to&nbsp;<span class=\"nowrap\">gastric/abdominal</span>&nbsp;distension and compression of the lung.</p>\n<p>Option C: Both arterial and central venous lines are inserted; however, this is not the first line of intervention.</p>\n<p>Option D: To support respiratory failure, the first modality to be used is conventional ventilation, and if there is no improvement, then high-frequency ventilation is used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newborn delivered vaginally, at term, was diagnosed with congenital diaphragmatic hernia. The most important limiting factor for survival in this condition is ________.",
    "choices": [
      {
        "id": 1,
        "text": "Mediastinal shift"
      },
      {
        "id": 2,
        "text": "Left-sided hernia"
      },
      {
        "id": 3,
        "text": "Intestinal obstruction"
      },
      {
        "id": 4,
        "text": "Pulmonary hypoplasia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Pulmonary hypoplasia</strong> is a very poor prognostic factor in congenital diaphragmatic hernia.</p>\n<p>Poor prognostic indicators in CDH:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The presence of liver in the thoracic cavity&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Pulmonary hypoplasia,</strong> pulmonary hypertension&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Early respiratory distress, within 24 h after birth&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Need for extracorporeal membrane oxygenation</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Herniation to the contralateral lung (<strong>right-sided hernia)</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are doing a quick pre-op evaluation of a 2-day-old baby shifted for emergency pediatric surgery. Parents had brought him with a history of sudden, noisy breathing. He appeared cyanotic with decreased breath sounds on the left side of the chest. Chest X-ray taken in the casualty is given below. Which of the following is not true about the underlying condition?",
    "choices": [
      {
        "id": 1,
        "text": "Not associated with dextrocardia"
      },
      {
        "id": 2,
        "text": "Most commonly seen on the left side"
      },
      {
        "id": 3,
        "text": "Mortality is usually associated with pulmonary hypoplasia"
      },
      {
        "id": 4,
        "text": "Pulmonary dilators markedly improve the survival"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture of neonatal respiratory distress, absent breath sounds in the left side of the chest, and an X-ray image showing bowel loops in the thoracic cavity is diagnostic of <strong>congenital diaphragmatic hernia</strong> (CDH). Though less commonly documented, dextrocardia is seen in association with CDH.</p>\n<p>A diaphragmatic hernia is defined as a communication between the abdominal and thoracic cavities with or without abdominal contents in the thorax. It&nbsp;is mostly congenital, with a defective formation of the pleuroperitoneal membrane.&nbsp;<strong>Females</strong>&nbsp;are affected twice as often as males.</p>\n<p><strong>Bochdalek hernia</strong> accounts for up to 90% of the hernias seen in the newborn period, with 80-90% occurring on the <strong>left side.&nbsp;</strong>So, the&nbsp;heart will be pushed to the&nbsp;right side (dextroposition).</p>\n<p>Predictors of a poor prognosis include an associated major anomaly, symptoms before completion of 24 hours since birth, severe <strong>pulmonary hypoplasia</strong>, herniation to the contralateral lung, and the need for extracorporeal membrane oxygenation (ECMO).</p>\n<p>Nitric oxide is a selective pulmonary vasodilator. It reduces ductal shunting and pulmonary pressures, resulting in improved oxygenation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4d54c6672a594c98aaf5c67977719c98.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '22 Neonatal Respiratory Disorders';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>