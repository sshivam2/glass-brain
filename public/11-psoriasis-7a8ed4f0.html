<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11 Psoriasis - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient presented to her primary care physician with an itchy scalp and dandruff. On examination, the following finding was seen and the Auspitz sign was present. This disease is least likely to affect the ____________.",
    "choices": [
      {
        "id": 1,
        "text": "Axilla"
      },
      {
        "id": 2,
        "text": "Lower back"
      },
      {
        "id": 3,
        "text": "Elbows and knees"
      },
      {
        "id": 4,
        "text": "Gluteal cleft"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of <strong>chronic plaque psoriasis</strong>. <strong>Axilla</strong> is usually<strong> not involved</strong> in chronic plaque psoriasis. It is affected in inverse psoriasis.</p>\n<p>Psoriasis is a common,&nbsp;<strong>chronic, immune-mediated inflammatory</strong>&nbsp;condition in which multiple genetic and environmental factors may lead to the formation of erythematous plaques with silvery-white scales.&nbsp;Genetic predisposition is present in type 1 plaque psoriasis and guttate psoriasis with&nbsp;<strong>HLA\u2010C:06:02</strong>.</p>\n<p>Chronic plaque psoriasis, also called <strong>psoriasis vulgaris</strong> is the <strong>most common</strong> clinical type of psoriasis. Commonly affected sites are:&nbsp;</p>\n<ul>\n<li>Scalp</li>\n<li>Elbows</li>\n<li>Knees</li>\n<li>Lower back</li>\n<li>Gluteal cleft</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fc843ee0a5854170ae0d5c37c2ca4fd9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man presents with the following skin finding. Which of the following clinical tests will aid in diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Grattage test"
      },
      {
        "id": 2,
        "text": "KOH smear"
      },
      {
        "id": 3,
        "text": "Besnier's sign"
      },
      {
        "id": 4,
        "text": "Skin biopsy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The presence of <strong>silvery-white scaly plaques</strong> on the extensor aspect of elbows and knees is a characteristic feature of <strong>psoriasis. Grattage test </strong>aids in its diagnosis.</p>\n<p><strong>Scratching</strong>&nbsp;(grattage) scales in psoriasis makes the scale appear <strong>more silver</strong> in color by introducing <strong>air&ndash;keratin</strong> interfaces. When the scales are completely scraped off, the basement membrane is exposed and is seen as a moist red surface (<strong>membrane of Bulkeley</strong>) through which dilated capillaries at the tip of elongated dermal papillae are torn, leading to multiple bleeding points. This classical <strong>pinpoint bleeding</strong>&nbsp;is known as the&nbsp;<strong>Auspitz sign</strong>.</p>\n<p>Auspitz sign is due to the <strong>elongated, dilated, tortuous vessels</strong> in the <strong>dermal papilla</strong>&nbsp;along with&nbsp;<strong>supra papillary</strong>&nbsp;<strong>thinning</strong> of the&nbsp;<strong>epidermis</strong>.</p>\n<p>However, the Auspitz sign is neither sensitive nor specific for psoriasis.</p>\n<table style=\"height: 100px;\" width=\"537\">\n<tbody>\n<tr>\n<td style=\"width: 260.5px; text-align: center;\"><strong>Auspitz sign present&nbsp;</strong></td>\n<td style=\"width: 260.5px; text-align: center;\"><strong>Auspitz sign absent</strong></td>\n</tr>\n<tr>\n<td style=\"width: 260.5px;\">Psoriasis vulgaris</td>\n<td style=\"width: 260.5px;\">Pustular psoriasis&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 260.5px;\">Darrier's disease&nbsp;</td>\n<td style=\"width: 260.5px;\">Guttate psoriasis&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 260.5px;\">Actinic keratosis&nbsp;</td>\n<td style=\"width: 260.5px;\">Inverse psoriasis&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 260.5px;\">&nbsp;</td>\n<td style=\"width: 260.5px;\">Erythrodermic psoriasis&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/484facdbb5e94279877094d5edb6656b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is an inflammatory, non-infectious disease"
      },
      {
        "id": 2,
        "text": "Nail pitting is superficial and regular."
      },
      {
        "id": 3,
        "text": "Joint involvement is seen in 5-30% of patients."
      },
      {
        "id": 4,
        "text": "Koebner\u2019s phenomenon is seen."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The presence of dull red sharply demarcated plaques on the knees with loosely adherent silvery-white scales is in favor of<strong> psoriasis. Nail plate pitting</strong> is the <strong>most common</strong> feature of nail psoriasis and is of the <strong>deep</strong> and<strong> irregular</strong> type.</p>\n<p>About&nbsp;5 to 30%&nbsp;of patients&nbsp;with cutaneous psoriasis have <strong>psoriatic arthritis</strong>(PsA). Psoriasis patients have a variable degree of pruritus.</p>\n<p><strong>Koebner&rsquo;s phenomenon </strong>or isomorphic phenomenon,&nbsp;the phenomena of appearance of new lesions along the line of trauma, is seen in psoriasis.</p>\n<p>Nail pitting is superficial and regular in alopecia areata.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f49fe0dd22b448c293f014d4eff61c3a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "While collecting data on nail changes in psoriasis patients, you note the following findings. Which of the following is the most specific finding for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Image A"
      },
      {
        "id": 2,
        "text": "Image D"
      },
      {
        "id": 3,
        "text": "Image C"
      },
      {
        "id": 4,
        "text": "Image B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Subungual oil drop sign</strong> or<strong>&nbsp;salmon patch</strong> (image C),&nbsp;a<strong>&nbsp;highly specific&nbsp;</strong>pathognomonic sign seen in nail psoriasis. It is a yellow-red discoloration in the nail bed resembling a drop of oil. The reddish-brown color is due to dilated, tortuous, superficial capillaries in the papillary dermis and parakeratosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/69713e013afe4bd188462145cd6af24c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d7ef24f74e9544dcb059ab6443a290e1x1280x2068.JPEG"
    ]
  },
  {
    "text": "A model presents to the OPD with the following cutaneous lesions. She informs the dermatologist that these lesions increase in size whenever she consumes alcohol and that they bleed whenever she scratches them. Which of the following is false regarding the pathogenesis of her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperproliferation of epidermis"
      },
      {
        "id": 2,
        "text": "Genetic predisposition HLA\u2010C:06:02"
      },
      {
        "id": 3,
        "text": "Deficient Th1 and Th17 helper cells"
      },
      {
        "id": 4,
        "text": "IFN-\u03b3, TNF-\u03b1, IL-17 levels are raised"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows sharply marginated, dull-red <strong>plaques</strong> with silvery-white <strong>scales</strong> which have coalesced to form geographical lesions. The history and image point towards a diagnosis of <strong>psoriasis</strong>. Here, there is an&nbsp;<strong>increased number of&nbsp;</strong>activated <strong>Th1, Th17,&nbsp;</strong>and Th22 cells, with a <strong>deficiency</strong> of<strong> Th2 cells.</strong></p>\n<p>It is a common, <strong>chronic, immune-mediated inflammatory</strong> condition in which multiple genetic and environmental factors may lead to the formation of erythematous plaques with silvery-white scales.&nbsp;Genetic predisposition is present in type 1 plaque psoriasis and guttate psoriasis with&nbsp;<strong>HLA\u2010C:06:02</strong>.</p>\n<p>There is <strong>increased keratinocyte turnover.</strong> It&nbsp;normally takes <strong>30 days</strong> for basal keratinocytes to reach the surface but in patients with psoriasis, this is&nbsp;<strong>reduced</strong> to<strong> 4-5 days</strong>.</p>\n<p>The activation of T cells of the adaptive immune system, specifically Th17 cells, in turn,&nbsp;activates keratinocytes to proliferate and produce multiple chemokines and antimicrobial peptides.&nbsp;</p>\n<p>Cytokines in psoriasis:</p>\n<table style=\"width: 471px; height: 147px;\">\n<tbody>\n<tr>\n<td style=\"width: 221.391px; text-align: center;\"><strong>Increased</strong></td>\n<td style=\"width: 233.609px; text-align: center;\"><strong>Decreased</strong></td>\n</tr>\n<tr>\n<td style=\"width: 221.391px;\">\n<p>Inflammatory cells and cytokines</p>\n</td>\n<td style=\"width: 233.609px;\">Anti-inflammatory cells and cytokines</td>\n</tr>\n<tr>\n<td style=\"width: 221.391px;\">Th1 and Th17 cells&nbsp;</td>\n<td style=\"width: 233.609px;\">&nbsp;Th2 cells</td>\n</tr>\n<tr>\n<td style=\"width: 221.391px;\">\n<p>IL\u20102, IL\u20108, IFN\u2010&gamma;,&nbsp;TNF\u2010&alpha;, IL\u201015, IL-17, IL\u201022, and IL\u201023</p>\n</td>\n<td style=\"width: 233.609px;\">\n<p>IL-4 and IL-10 absent</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/98cc9ff35c6144298e189360420d74b6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs is not responsible for an exacerbation of psoriasis?",
    "choices": [
      {
        "id": 1,
        "text": "Atenolol"
      },
      {
        "id": 2,
        "text": "Enalapril"
      },
      {
        "id": 3,
        "text": "Lithium"
      },
      {
        "id": 4,
        "text": "Levothyroxine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Levothyroxine</strong> is <strong>not implicated</strong>&nbsp;in exacerbations of<strong> psoriasis.</strong></p>\n<p><strong>Drugs</strong> inducing/<strong>exacerbating</strong> psoriasis:</p>\n<ul>\n<li>Beta-blockers</li>\n<li>Synthetic antimalarials</li>\n<li>NSAIDS</li>\n<li>Lithium</li>\n<li>ACE inhibitors &amp; angiotensin receptor blockers</li>\n<li>Interferon alpha</li>\n<li>Tetracycline</li>\n<li>Terbinafine</li>\n<li>Gemfibrozil</li>\n</ul>\n<p>Other <strong>environmental</strong> and <strong>immunological</strong> factors that may <strong>trigger</strong> psoriasis are:</p>\n<ul>\n<li>Infections- beta-hemolytic streptococci can trigger guttate psoriasis</li>\n<li>Alcohol misuse and smoking</li>\n<li>Emotional stress</li>\n<li>Trauma - Koebner phenomenon</li>\n<li>Winter&nbsp;</li>\n<li>Sunlight</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who presented to the OPD with a papulosquamous lesion has the following nail finding. Histopathology of the skin lesion is unlikely to show which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Epidermal thickening"
      },
      {
        "id": 2,
        "text": "Suprapapillary thinning"
      },
      {
        "id": 3,
        "text": "Kogoj spongiform pustules"
      },
      {
        "id": 4,
        "text": "Pautrier's microabscess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image showing<strong> nail pitting</strong> and <strong>salmon patches</strong> in fingernails are characteristic of psoriasis.<strong> Munro microabscess</strong> is seen in <strong>psoriasis</strong> whereas<strong> Pautrier's microabscess</strong> is seen in <strong>mycosis fungoides.</strong></p>\n<p>Histopathological features of psoriasis:</p>\n<ul>\n<li>Irregular epidermal thickening (<strong>acanthosis</strong>)</li>\n<li>Hyperkeratosis and parakeratosis</li>\n<li><strong>Suprapapillary thinning</strong></li>\n<li><strong>Clubbing</strong> of <strong>rete</strong> <strong>ridges</strong> at the base</li>\n<li><strong>Kogoj</strong> <strong>spongiform</strong> <strong>pustules&nbsp;</strong>(collection of neutrophils in Malpighian layer)</li>\n<li><strong>Munro</strong> <strong>microabscesses </strong>(collection of neutrophils in stratum corneum)</li>\n<li>Absence of stratum granulosum</li>\n<li>Dilated, tortuous blood vessels in the dermis</li>\n<li>Suprapapillary mononuclear leukocytic infiltrates</li>\n</ul>\n<p>Remember:&nbsp; <strong>M (Munro microabscess)</strong> is seen in <strong>P (Psoriasis)</strong> and <strong>P (Pautrier&rsquo;s microabscess)</strong> is seen in <strong>M (mycosis fungoides)</strong></p>\n<p>The image below shows histopathology of psoriasis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8b6f64576253458586f8bcf2434964c5.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2e0db71b1b14c5baaf5a5ca45c0ff1ax1280x1418.JPEG"
    ]
  },
  {
    "text": "Biopsy taken from a patient who presented with a papulosquamous skin disorder shows a camel foot appearance on HPE. Which disorder is she most likely suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "Pityriasis rubra pilaris"
      },
      {
        "id": 2,
        "text": "Psoriasis"
      },
      {
        "id": 3,
        "text": "Lichen nitidus"
      },
      {
        "id": 4,
        "text": "Lichen planus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Camel foot appearance</strong> is seen in histopathology of <strong>plaque-type psoriasis.&nbsp;</strong></p>\n<p>Normally, only 10% of the basal cells are in the proliferative phase, whereas in psoriasis about 90% of the basal cells are in this phase.&nbsp;As a result, to accommodate the increasing population of basal cells, rete pegs take a plunge in the dermis in the form of regular <strong>elongation of rete ridges</strong>, giving the <strong>'camel foot'</strong>&nbsp;or <strong>clubbed</strong> appearance to epidermal rete ridges.</p>\n<p>Other HPE findings seen in psoriasis:</p>\n<ul>\n<li>Regular <strong>acanthosis</strong> (epidermal thickening)&nbsp;</li>\n<li><strong>Hyperkeratosis</strong> and <strong>parakeratosis</strong></li>\n<li>Suprapapillary thinning</li>\n<li>Kogoj&nbsp;spongiform&nbsp;pustules&nbsp;(collection of <strong>neutrophils</strong> in <strong>Malpighian layer)</strong></li>\n<li><strong>Munro</strong>&nbsp;<strong>microabscesses&nbsp;</strong>(collection of neutrophils in stratum corneum)</li>\n<li>Absence of stratum granulosum</li>\n<li>Dilated, tortuous blood vessels in dermis</li>\n<li>Suprapapillary mononuclear leukocytic infiltrates</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f76af7514d6462e9762dd35435c5099x1280x1551.JPEG"
    ]
  },
  {
    "text": "Which among the following is the most common presentation of psoriatic arthritis?",
    "choices": [
      {
        "id": 1,
        "text": "Classic psoriatic arthritis"
      },
      {
        "id": 2,
        "text": "Arthritis mutilans"
      },
      {
        "id": 3,
        "text": "Asymmetric oligoarthritis"
      },
      {
        "id": 4,
        "text": "Symmetric polyarthritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Asymmetric oligoarthritis</strong>&nbsp;is the <strong>most common type</strong> of psoriatic arthritis.</p>\n<p><span class=\"s1\"><strong>Psoriatic arthritis</strong> </span>refers to an <strong>inflammatory musculoskeletal</strong> disease that has both <strong>autoimmune</strong> and autoinflammatory features characteristically occurring in individuals with psoriasis.</p>\n<p class=\"p1\">Asymmetric oligoarthritis commonly involves a knee or another large joint with a few small joints in the fingers or toes, often with dactylitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman who presented with pain and stiffness in her hand for the past 6 weeks was diagnosed with classic psoriatic arthritis after a thorough workup. Which of the following joints is typically affected by this disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Proximal interphalangeal joint"
      },
      {
        "id": 2,
        "text": "Distal Interphalangeal joint"
      },
      {
        "id": 3,
        "text": "Metatarsophalangeal joint"
      },
      {
        "id": 4,
        "text": "Metacarpophalangeal joint"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>Classic psoriatic arthritis</strong>&nbsp;typically involves the&nbsp;<strong>distal interphalangeal </strong>joints.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9e44ad4a389452c87dc53df37b63873x1280x1062.JPEG"
    ]
  },
  {
    "text": "A 42-year-old man with a history of psoriasis vulgaris was referred to the dermatology department with 6 weeks of worsening psoriasis. He was started on valproic acid for bipolar disorder 4 months prior. On examination, the following finding was noted. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Rupioid psoriasis"
      },
      {
        "id": 2,
        "text": "Photosensitive psoriasis"
      },
      {
        "id": 3,
        "text": "Small plaque psoriasis"
      },
      {
        "id": 4,
        "text": "Koebnerised psoriasis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cone-shaped</strong> heaped-up <strong>hyperkeratotic</strong> lesions shaped like a <strong>shell</strong> (limpet) are seen in this <strong>rupioid</strong>&nbsp;variety of psoriasis. Valproic acid may be associated infrequently with such psoriatic flare-ups.</p>\n<p>The term &ldquo;rupioid&rdquo; (from the Greek&nbsp;<em>rhupos</em>, meaning filth) is used to describe<strong> oyster</strong> or<strong> limpet shell-shaped thick keratotic lesions.</strong> In contrast to rupioid forms, regular plaque-type psoriasis has a white, nonadherent, and thin, scaly surface.</p>\n<p>Severe psoriatic flares and atypical forms of the disease (including rupioid plaques) have been reported in HIV-positive patients and with certain drugs.&nbsp;</p>\n<p>Drugs associated with psoriasis:&nbsp;</p>\n<ul>\n<li>&beta;-Blockers</li>\n<li>Lithium</li>\n<li>Synthetic antimalarials</li>\n<li>Nonsteroidal anti-inflammatory drugs</li>\n<li>Tetracyclines</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a5166039f766483d8a89197c385d9d1e.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "In which variant of psoriasis is scaling absent?",
    "choices": [
      {
        "id": 1,
        "text": "Erythrodermic Psoriasis"
      },
      {
        "id": 2,
        "text": "Guttate Psoriasis"
      },
      {
        "id": 3,
        "text": "Inverse psoriasis"
      },
      {
        "id": 4,
        "text": "Sebopsoriasis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>inverse psoriasis</strong>, flexural plaques are thin and <strong>scaling</strong> is<strong> greatly reduced</strong> or<strong> absent</strong>.</p>\n<p>It involves the inguinal creases, axillae, submammary folds, gluteal cleft, umbilicus, and other body folds. It is more common in <strong>older adults</strong> and is associated with <strong>obesity.</strong>&nbsp;</p>\n<p>Option B: Guttate psoriasis presents with small plaque lesions with scales 2-3mm to 1 cm distributed over the trunk and proximal limbs in children</p>\n<p>Option D:&nbsp;In sebopsoriasis, plaques of thin sharply demarcated erythema with variable scales may occur in the typical distribution of seborrhoeic dermatitis</p>\n<p>Option A: Erythrodermic psoriasis has most or all of the body surface affected (&gt;90%BSA)</p>\n<p>The image below shows inverse psoriasis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/26c7eff70fc94fad8fc6741b29e8b174x431x288.PNG"
    ]
  },
  {
    "text": "A patient was treated with steroids for psoriasis. On stopping the treatment, he develops fever, malaise, and lesion as seen in the image below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pustular psoriasis"
      },
      {
        "id": 2,
        "text": "Staphylococcal infection"
      },
      {
        "id": 3,
        "text": "Acute generalised exanthematous pustulosis"
      },
      {
        "id": 4,
        "text": "Subcorneal pustulosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario points towards the diagnosis of <strong>pustular psoriasis.</strong></p>\n<p><strong>Pustular psoriasis</strong> is a type of psoriasis characterized by <strong>tiny pus-filled lesions</strong> (pustules) having a characteristic <strong>lakes or sheets of pus appearance</strong> (seen in the image).</p>\n<p>The patient presents with a history of <strong>fever</strong> and malaise along with the presence of <strong>pustules</strong> on a <strong>circumscribed, fiery red, edematous or scaling plaque.</strong> The pus is usually <strong>sterile.</strong> Sudden <strong>withdrawal of systemic steroids</strong> is usually the trigger for this condition.</p>\n<p>Pustular psoriasis can be divided into:</p>\n<ul>\n<li><strong>Localized pustular psoriasis</strong></li>\n<li><strong>Generalized pustular psoriasis</strong>:\n<ul>\n<li>Acute generalized pustular psoriasis (<strong>Von Zumbusch</strong>)</li>\n<li>Subacute annular and circinate pustular psoriasis</li>\n<li>Acute generalized pustular psoriasis of pregnancy (<strong>Impetigo herpetiformis</strong>)</li>\n</ul>\n</li>\n</ul>\n<p>Treatment: <strong>Acitretin</strong> (oral retinoid) is the <strong>drug of choice</strong> for pustular psoriasis. However, it is <strong>contraindicated in pregnancy.</strong> <strong>Systemic steroids</strong> are used instead. <strong>Cyclosporine</strong> is the second-line drug.</p>\n<p>Note: Systemic steroids are never used for the treatment of psoriasis except in the case of Impetigo herpetiformis where they are first-line agents.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/62275958406c41f796408aef8dff04af.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old boy developed skin lesions on his trunk and proximal portion of his arms, 10 days after he recovered from an episode of pharyngitis.   Which of the following statements are correct about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "2, 3"
      },
      {
        "id": 2,
        "text": "2 and  5"
      },
      {
        "id": 3,
        "text": "3, 4, and 5"
      },
      {
        "id": 4,
        "text": "1 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical stem of small, red, drop-like lesions on the trunk and arms (shown in the image) after an attack of pharyngitis is suggestive of <strong>guttate psoriasis.&nbsp;</strong></p>\n<div class=\"page\" title=\"Page 1144\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Guttate psoriasis is a type of psoriasis occurring as a <strong>sudden onset shower of small lesions</strong> seen diffusely over the body, more on the trunk and proximal limbs.&nbsp;It is more common in children and young adults, <strong>following infection</strong> with<strong> group A streptococcus</strong> and is often the first presentation of psoriasis. It can also occur as a flare-up in adults with plaque psoriasis that began in childhood.&nbsp;It is linked to <strong>HLA\u2010C:06:02.</strong></p>\n<p>Lesions usually <strong>resolve</strong> over about 3 months. Some patients with acute guttate psoriasis might develop plaque psoriasis in the future.</p>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li>Topical <strong>steroids</strong></li>\n<li><strong>Antimicrobials</strong> - Recurrent episodes may be related to the pharyngeal carriage of the responsible streptococcus by the patient or close contact. A course of semisynthetic penicillin with rifampin may be required to clear chronic streptococcal carriage.</li>\n<li><strong>Phototherapy</strong> - Broad-band ultraviolet B (UVB)- Response is better with broadband UVB over narrow-band UVB.&nbsp;</li>\n</ul>\n<p>A <strong>chronic</strong> course is seen in <strong>plaque</strong> and <strong>follicular psoriasis.&nbsp;</strong></p>\n<p><strong>Pustular</strong> psoriasis patients can have a <strong>fever,</strong> erythroderma, <strong>hypocalcemia,</strong> and cachexia.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3483058dd990480f863a1b72b1b71c74.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A dermatologist can use the Goekerman regimen to treat which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Paraneoplastic pemphigus"
      },
      {
        "id": 2,
        "text": "Psoriasis"
      },
      {
        "id": 3,
        "text": "Eczema"
      },
      {
        "id": 4,
        "text": "Lichen planus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Goekerman regimen</strong> is used in the treatment of<strong>&nbsp;psoriasis</strong>.</p>\n<p>The modified Goekerman regimen involves <strong>application</strong> of<strong> coal tar</strong>&nbsp;for 5 hours/day in combination with exposure to <strong>narrow\u2010band UVB</strong> (NBUVB).</p>\n<p><strong>Ingram Regimen</strong> is another treatment regimen used in psoriasis. In\u2010patients are treated with a <strong>coal tar bath</strong>, <strong>suberythemogenic&nbsp;</strong><strong>UVB</strong> and then<strong> dithranol</strong> in Lassar&rsquo;s paste is applied to plaques.&nbsp;</p>\n<p>The mechanism of action of dithranol may relate to its <strong>antiproliferative</strong> and <strong>proapoptotic</strong> effects on keratinocytes. Dithranol produces <strong>brown staining</strong> of the skin, which resolves about 2 weeks after therapy is completed.</p>\n<p>Both regimens have a good safety profile and are highly efficacious.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the treatment of choice for a patient who presented with the following finding?",
    "choices": [
      {
        "id": 1,
        "text": "PUVA"
      },
      {
        "id": 2,
        "text": "Steroids"
      },
      {
        "id": 3,
        "text": "Methotrexate"
      },
      {
        "id": 4,
        "text": "Infliximab"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient<strong>&nbsp;</strong>has<strong> right knee effusion</strong>,<strong> dactylitis</strong> of multiple digits, sharply demarcated red <strong>papulosquamous lesions</strong> on both knees all of which point towards a diagnosis of<strong> psoriatic arthritis.&nbsp;</strong></p>\n<p><strong>Methotrexate</strong>&nbsp;and <strong>apremilast</strong>&nbsp;are the <strong>first-line</strong> drugs for the treatment of moderate to severe psoriasis associated with psoriatic&nbsp;arthritis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/82e1832cf1db40dab49cb3dc9263579f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with a known case of chronic plaque psoriasis with more than 50% skin involvement presents to you. Which of the following will you not recommend?",
    "choices": [
      {
        "id": 1,
        "text": "Oral methotrexate"
      },
      {
        "id": 2,
        "text": "NB UVB"
      },
      {
        "id": 3,
        "text": "Oral steroids"
      },
      {
        "id": 4,
        "text": "Oral cyclosporine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Oral/systemic steroids</strong> are <strong>not used</strong> in the management of <strong>chronic plaque psoriasis</strong>. Topical steroids may be used.</p>\n<p>Systemic steroids are avoided because the withdrawal of systemic steroids causes the development of pustular psoriasis.</p>\n<p>The <strong>only indication</strong> of using <strong>systemic</strong> steroids in psoriasis is generalized pustular psoriasis in pregnancy (<strong>impetigo herpetiformis</strong>).&nbsp;</p>\n<p>Other options maybe used in treatment of extensive (&gt;30%) chronic plaque psoriasis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following cases would you prescribe systemic corticosteroids?",
    "choices": [
      {
        "id": 1,
        "text": "22-year-old woman with impetigo herpetiformis"
      },
      {
        "id": 2,
        "text": "40-year-old man with severe psoriatic arthritis"
      },
      {
        "id": 3,
        "text": "11-year-old boy with guttate psoriasis"
      },
      {
        "id": 4,
        "text": "33-year-old woman with erythrodermic psoriasis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Impetigo herpetiformis </strong>(pustular psoriasis of pregnancy) is the only definitive indication for <strong>systemic steroids</strong>.</p>\n<p>Steroids can also be used for the <strong>control</strong> of <strong>acute symptoms</strong> like <strong>ARDS</strong> accompanying pustular psoriasis.</p>\n<p>Steroids are<strong> contraindicated</strong> in all other forms of psoriasis as sudden <strong>withdrawal</strong> can trigger <strong>severe pustular</strong> or<strong> erythrodermic psoriasis.&nbsp;</strong>As most of the other medications are contraindicated in pregnancy, this is the only definitive indication for systemic steroids.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the treatment of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Systemic steroids"
      },
      {
        "id": 2,
        "text": "Topical anthralin"
      },
      {
        "id": 3,
        "text": "Oral retinoids"
      },
      {
        "id": 4,
        "text": "PUVA"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows<strong> pustular psoriasis. Acitretin,</strong> an oral retinoid is the <strong>treatment of choice </strong>for pustular psoriasis<strong>. </strong>Other first-line drugs are methotrexate and cyclosporine.</p>\n<p>Pustular psoriasis is a complication of psoriasis wherein&nbsp;<strong>multiple sterile pustules</strong> develop.&nbsp;The acute generalized form of pustular psoriasis is termed as <strong>Von Zumbusch</strong> type.&nbsp;</p>\n<p>The most <strong>provocative</strong> factor is&nbsp;the <strong>withdrawal</strong> of <strong>systemic corticosteroids.</strong> Steroids are relatively contraindicated except in pustular psoriasis of pregnancy (impetigo herpetiformis) where it is the treatment of choice.</p>\n<p>Note:&nbsp;Tar and dithranol are absolutely contraindicated&nbsp;in pustular psoriasis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5e777cab30bd40aab7cd01b178125ef1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A dermatologist wants to prescribe acitretin to a patient with psoriasis. Which of the following statements is false regarding the drug?",
    "choices": [
      {
        "id": 1,
        "text": "Contraindicated in persons with hyperlipidemia"
      },
      {
        "id": 2,
        "text": "It can cause increased sensitivity to sunlight"
      },
      {
        "id": 3,
        "text": "Female patients should avoid getting pregnant for 6 months after therapy"
      },
      {
        "id": 4,
        "text": "Acitretin has a half life of about 50 hours"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Female patients should <strong>avoid</strong>&nbsp;<strong>conception</strong>&nbsp;for<strong> 3 years</strong> after receiving <strong>acitretin</strong> treatment to prevent <strong>retinoid-induced embryopathy.</strong></p>\n<p><strong>Acitretin </strong>is approved for use in the <strong>cutaneous</strong> manifestations of <strong>psoriasis.</strong></p>\n<p>Absolute contraindications:</p>\n<ul>\n<li>Pregnant women</li>\n<li>Women who are planning to get pregnant</li>\n<li>Breastfeeding</li>\n</ul>\n<p>Relative contraindications:</p>\n<ul>\n<li>Leukopenia</li>\n<li>Alcoholism</li>\n<li>Hyperlipidemia</li>\n<li>Hypercholesterolemia</li>\n<li>Hypothyroidism</li>\n<li>Significant hepatic or renal disease</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A researcher developed a drug 'X' that functions as an IL-17 receptor antagonist for the treatment of psoriasis. Identify drug 'X'.",
    "choices": [
      {
        "id": 1,
        "text": "Secukinumab"
      },
      {
        "id": 2,
        "text": "Ixekizumab"
      },
      {
        "id": 3,
        "text": "Brodalumab"
      },
      {
        "id": 4,
        "text": "Infliximab"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Brodalumab&nbsp;</strong>is a monoclonal antibody against the <strong>IL-17 receptor</strong>.</p>\n<p>These biological drugs are used in cases of <strong>severe psoriasis</strong> and <strong>psoriatic arthritis.</strong>&nbsp;</p>\n<p>Secukinumab and ixekizumab bind to IL-17 and prevent its binding to the receptor. They are considered&nbsp;<strong>IL-17 neutralizers.</strong></p>\n<table style=\"height: 438px; width: 394px;\">\n<tbody>\n<tr>\n<td style=\"width: 183.859px; text-align: center;\"><strong>Class</strong></td>\n<td style=\"text-align: center; width: 192.141px;\"><strong>Drugs</strong></td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">TNF-alpha inhibitors</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Adalimumab</li>\n<li>Infliximab</li>\n<li>Etanercept</li>\n<li>Golimumab</li>\n<li>Certolizumab</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">IL-17 antagonists (neutralizers)</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Secukinumab</li>\n<li>Ixekizumab</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">IL-17 receptor antagonist</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Brodalumab</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">IL-23 antagonist</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Guselkumab</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">IL-12/23 antagonist</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Ustekinumab</li>\n<li>Briakinumab</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">CD-11a antagonist</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Efalizumab</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 183.859px;\">Phosphodiesterase -4 inhibitors</td>\n<td style=\"width: 192.141px;\">\n<ul>\n<li>Apremilast</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '11 Psoriasis';
        const quizFilename = '11-psoriasis-7a8ed4f0.html';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>