<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>47 Wound Healing, Tissue Repair & Scar - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "If histopathological examination of a 2-day-old forearm laceration is done, which of the following would be seen?",
    "choices": [
      {
        "id": 1,
        "text": "Early collagen deposition"
      },
      {
        "id": 2,
        "text": "Neutrophilic infiltration"
      },
      {
        "id": 3,
        "text": "Angiogenesis"
      },
      {
        "id": 4,
        "text": "Increased fibroblast activity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Neutrophil peak is seen on <strong>day 2</strong> of the inflammatory phase of wound healing.</p>\n<p>Wound healing has three phases: The inflammatory phase, proliferative phase, and maturation phase. The inflammatory phase lasts 2-3 days.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d43467f8353a4512921d7d56c8a5a9afx1280x2562.JPEG"
    ]
  },
  {
    "text": "A patient's wound has the given appearance 1 week after the injury. Which cells are predominantly found in this stage of wound healing?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophils"
      },
      {
        "id": 2,
        "text": "Lymphocytes"
      },
      {
        "id": 3,
        "text": "Macrophages"
      },
      {
        "id": 4,
        "text": "Fibroblasts"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows<strong> granulation tissue </strong>formed during the<strong> proliferative </strong>stage of wound healing<strong>. Fibroblasts</strong> are the predominant cell during the <strong>proliferative</strong> stage.</p>\n<p>Fibroblasts are specialized cells that differentiate from resting mesenchymal cells into connective tissue. The primary function of fibroblasts is to <strong>synthesize collagen.</strong></p>\n<p>The <strong>proliferative stage</strong> of wound healing is characterized by the formation of granulation tissue, which consists of a capillary bed, fibroblasts, macrophages, and a loose arrangement of collagen, fibronectin, and hyaluronic acid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2cf1fd66487e45d4be3cb1c0ab30f7f6.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an anti-inflammatory cytokine involved in wound healing?",
    "choices": [
      {
        "id": 1,
        "text": "IL-1"
      },
      {
        "id": 2,
        "text": "IL-6"
      },
      {
        "id": 3,
        "text": "IL-8"
      },
      {
        "id": 4,
        "text": "IL-10"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Interleukins 1, 6 and 8 are pro-inflammatory cytokines, whereas IL-10 is an anti-inflammatory cytokine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following events of wound healing will be altered in a patient with scurvy?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet aggregation"
      },
      {
        "id": 2,
        "text": "Phagocytosis"
      },
      {
        "id": 3,
        "text": "Early matrix scaffolding"
      },
      {
        "id": 4,
        "text": "Deposition of inorganic matrix"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 273\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Dietary deficiency of </strong><strong>vitamin C</strong> (scurvy) results in <strong>poorly formed collagen</strong>&nbsp;and affects the <strong>e</strong><strong>arly matrix scaffolding.</strong></p>\n<p>Type I and Type III collagens are both present in the extracellular matrix of normal skin (in an <strong>8:1 ratio</strong>). However, during the <strong>proliferative phase of wound healing</strong>, the dominant collagen that is laid is&nbsp;<strong>Type&nbsp;III. </strong>This stage is also known as<strong> early matrix scaffolding</strong>. Type III collagen is gradually <strong>replaced by type I</strong> collagen (during the final remodeling phase) until a ratio (type I: type III) of <strong>4:1</strong> is achieved.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/85af6a133f424e85ad9eac65a6844613x1280x2562.JPEG"
    ]
  },
  {
    "text": "In patients presenting with non-healing surgical incisions, what is the most common underlying cause?",
    "choices": [
      {
        "id": 1,
        "text": "Malnutrition"
      },
      {
        "id": 2,
        "text": "Infection"
      },
      {
        "id": 3,
        "text": "Smoking"
      },
      {
        "id": 4,
        "text": "Diabetes mellitus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>All the factors listed impair wound healing, but <strong>local infection </strong>is the most common underlying cause of non-healing surgical incisions.</p>\n<p>To reduce the chances of infection ,the surgeon should make every effort to remove all devitalized tissue and leave a clean wound for closure.</p>\n<p>Factors affecting wound healing:</p>\n<ul>\n<li>Site of the wound</li>\n<li>Structures involved</li>\n<li>Mechanism of wounding (crushing, incision, avulsion)</li>\n<li>Contamination</li>\n<li>Loss of tissue</li>\n<li>Local factors (vascularity, previous irradiation, pressure)</li>\n<li>Systemic factors (malnutrition, anemia, steroids, AIDS, smoking)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with a grazed knee comes to your clinic for first aid. He has a history of nephrotic syndrome and is on oral prednisolone therapy. Which stage of wound healing would be most affected by his medication?",
    "choices": [
      {
        "id": 1,
        "text": "Epithelialisation of the wound"
      },
      {
        "id": 2,
        "text": "Collagen synthesis and remodelling"
      },
      {
        "id": 3,
        "text": "Initial inflammatory phase and angiogenesis"
      },
      {
        "id": 4,
        "text": "Contraction of the wound"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>While <strong>all</strong> of the given options are <strong>inhibited</strong> by <strong>steroids</strong>, the <strong>major effect</strong> of <strong>steroids</strong> is to inhibit the initial&nbsp;<strong>inflammatory phase </strong>of wound healing (angiogenesis, neutrophil and macrophage migration, and fibroblast proliferation) and the <strong>release of lysosomal enzymes.</strong></p>\n<p>The stronger the anti-inflammatory effect of the steroid compound used, the greater the inhibitory effect on wound healing. Steroids used after the first 3 to 4 days post-injury do not affect wound healing as severely as when they are used in the immediate postoperative period.&nbsp;</p>\n<p>In addition to inhibiting collagen synthesis, steroids also<strong> inhibit epithelialization</strong> and <strong>contraction </strong>and contribute to increased rates of <strong>wound infection,</strong> regardless of the time of administration.</p>\n<p>Steroid delayed healing of cutaneous wounds can be stimulated to epithelialize by topical application of <strong>vitamin A.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following findings in a long-standing ulcer would indicate malignant transformation?",
    "choices": [
      {
        "id": 1,
        "text": "Persistent granulation tissue with bleeding"
      },
      {
        "id": 2,
        "text": "Oedema beyond area of erythema"
      },
      {
        "id": 3,
        "text": "Everted wound edges"
      },
      {
        "id": 4,
        "text": "Non-healing after 2 weeks of therapy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Everted edge&nbsp;</strong>around a chronic wound is a<strong> sign of malignant transformation.</strong></p>\n<p>The majority of wounds that have <strong>not healed in 3 months</strong> are considered <strong>chronic </strong>and are prone to malignant changes. Malignant wounds are differentiated clinically from non-malignant wounds by the presence of <strong>overturned edges.&nbsp;</strong>Biopsy of the wound edges should be performed to rule out malignancy.</p>\n<p>Malignant transformation can occur in <strong>any long-standing wound.</strong> The image shows a Marjolin's ulcer with everted edges. It is squamous cell carcinoma that develops on a long-standing burn.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fcf459e5346a446fabacb52f40eff0d7x1088x864.PNG"
    ]
  },
  {
    "text": "A 21-year-old man came to the casualty 12 hours after sustaining a laceration on his leg from a trekking accident. On closer examination, other than dirt, you do not notice any pus or signs of infection. What is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Closure after granulation tissue has formed"
      },
      {
        "id": 2,
        "text": "Delayed closure 2 days after removal of devitalised tissue"
      },
      {
        "id": 3,
        "text": "Primary closure after adequate wound toileting and debridement"
      },
      {
        "id": 4,
        "text": "Wound debridement, topical antibiotics and dressing"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">Contaminated wounds <strong>older than 6 hours</strong> should be managed with <strong>delayed primary closure.\u00a0</strong></p>\n<p class=\"p1\">The wound is cleaned, debrided, and left open for a few days. This allows soft tissues to drain and also ensures no infection is present before surgical closure can be done.\u00a0</p>\n<p class=\"p1\">Wound closure is categorized into primary, secondary, or tertiary:</p>\n<p class=\"p1\"><strong>Primary closure</strong> is done for <strong>clean wounds with minimal tissue loss</strong> that are amenable to approximation of wound edges. Healing occurs by <strong>primary intention. </strong>Primary closure is ideally performed within <strong>6 to 8 hrs </strong>of trauma, but wounds in vascular areas (e.g. face) may be delayed to up to 24 hours after trauma.<span class=\"Apple-converted-space\">\u00a0</span></p>\n<p class=\"p1\"><strong>Secondary closure</strong> allows healing by <strong>secondary intention</strong>. The wound is <strong>left open</strong> to heal largely by the <strong>formation of granulation tissue and contraction</strong>. These wounds often have <strong>significant tissue loss</strong> precluding tension-free approximation of edges, with devitalized edges. Wound dressings are changed daily to aid in the formation of granulation tissue and subsequent contraction.<span class=\"Apple-converted-space\">\u00a0</span></p>\n<p class=\"p1\"><strong>Tertiary closure</strong>, also known as <strong>delayed primary closure</strong>, results in a combination of healing by primary and secondary intention. The wound is thoroughly irrigated, debrided, and left open for 2 to 5 days before surgical closure. It is used for wounds that are <strong>grossly contaminated without significant tissue loss.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90fa4f8561c14032a5feb8deca640f49.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Stage the bedsore in the following image:",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>complete</strong> <strong>skin</strong> <strong>loss</strong> that involves <strong>muscles</strong> and shows <strong>exposed</strong> <strong>bone</strong> indicating a <strong>stage</strong> <strong>4</strong> <strong>pressure sore.</strong></p>\n<p>Pressure sores are skin or soft tissue injuries that occur due to <strong>prolonged</strong> <strong>pressure</strong> over <strong>specific</strong> <strong>areas</strong> of the body. An external pressure of <strong>&gt;30 mmHg</strong> leads to the formation of pressure sores. The common sites of pressure sores in decreasing frequency are the <strong>ischium</strong>, <strong>greater</strong> <strong>trochanter</strong>, sacrum, heel, malleolus (lateral followed by medial), and occiput.</p>\n<p>Pressure sores can be prevented with <strong>good skincare</strong>, the use of air-fluidized beds, special pressure-dispersion cushions, or foams. <strong>Repositioning</strong> the patient<strong> every two hours</strong> can lessen the pressure on the area.&nbsp;</p>\n<p>Ulcers of <strong>stages 1 and 2</strong> often do <strong>not</strong> require <strong>operative</strong> <strong>measures</strong>. They are managed with regular wound cleaning and dressing with a good antibiotic cover.</p>\n<p><strong>Stage 3 and 4</strong> ulcers are adequately <strong>debrided</strong>, and vacuum-assisted closure <strong>(VAC)</strong> is used to promote the growth of granulation tissue required for surgical closure. Large skin flaps that have muscle with sensory innervation are best for reconstruction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/93227f683c5c406398747cba22815f56.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common site of pressure sores ?",
    "choices": [
      {
        "id": 1,
        "text": "Heel"
      },
      {
        "id": 2,
        "text": "Occiput"
      },
      {
        "id": 3,
        "text": "Greater tochanter"
      },
      {
        "id": 4,
        "text": "Ischium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pressure sore frequency in descending order:</p>\n<ul>\n<li><strong>Ischium</strong></li>\n<li>Greater Trochanter</li>\n<li>Sacrum</li>\n<li>Heel</li>\n<li>Malleolus</li>\n<li>Occiput</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly paraplegic patient admitted to a nursing home, developed an ulcer on her gluteal region. All of the following are true regarding the management of this patient except:",
    "choices": [
      {
        "id": 1,
        "text": "Diet and nutritional support should aim to establish a positive nitrogen balance"
      },
      {
        "id": 2,
        "text": "Following debridement, exposure of the wound is recommended"
      },
      {
        "id": 3,
        "text": "Tensor fascia lata flap with an intact nerve supply may be used for covering the defect"
      },
      {
        "id": 4,
        "text": "Frequent change in position and air mattresses can help in preventing further sores"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image is that of a <strong>grade 3 bedsore.</strong> A grade 3 pressure sore <strong>requires dressing </strong>following debridement.</p>\n<p><strong>Preoperative</strong> management involves adequate <strong>debridement</strong>, and the use of <strong>vacuum</strong>-<strong>assisted</strong> <strong>closure</strong> (VAC) to provide a suitable wound for surgical closure.&nbsp;Alginates, foams, hydrocolloids, hydrogels are other options that are available.</p>\n<p>The aim of surgery is to <strong>fill</strong> the <strong>dead</strong> <strong>space</strong> and to provide durable sensate skin. Large skin flaps that include muscle are best and, occasionally, an intact sensory innervated area can be included (e.g. <strong>extensor fascia lata flap with the lateral cutaneous nerve of the thigh</strong>).</p>\n<p>Nutritional optimization with <strong>high caloric and protein diet</strong> should be done to establish a <strong>positive nitrogen balance.&nbsp;</strong>Frequent <strong>changes in position</strong> and <strong>air mattresses</strong> can also help in preventing further sores.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/06c5a4293ab5420bbae46dfa695c9c26.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A meshed skin graft was used to cover a defect and vacuum-assisted closure of the transplant was done. What is the pressure generated within the dressing?",
    "choices": [
      {
        "id": 1,
        "text": "-50 mmHg"
      },
      {
        "id": 2,
        "text": "-100 mmHg"
      },
      {
        "id": 3,
        "text": "-125 mmHg"
      },
      {
        "id": 4,
        "text": "-150 mmHg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The pressure used in vacuum-assisted closure for wound healing is <strong>&ndash;125 mmHg.</strong></p>\n<p>Applying negative pressure appears to <strong>hasten debridement </strong>and the formation of <strong>granulation tissue </strong>in chronic wounds and ulcers.</p>\n<p>It acts by <strong>decreasing edema</strong>, by <strong>removing interstitial fluid,&nbsp;</strong>and as a result, helps in decreasing bacterial counts and cell proliferation increases.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d7c98a315c1d4a76bcc541f92e615ab3.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A man who had undergone an exploratory laparotomy 6 months ago came for a follow-up visit. Which of the following statements about healed incision is false?",
    "choices": [
      {
        "id": 1,
        "text": "Disorganized collagen fibers become aligned along stress lines"
      },
      {
        "id": 2,
        "text": "Strength of the scar is in their weave rather than in their amount"
      },
      {
        "id": 3,
        "text": "By the first week it is held by sutures and a weak type 3 collagen matrix"
      },
      {
        "id": 4,
        "text": "Tensile strength is about 60-80% of normal skin by  3 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>During the first week,&nbsp;a surgical wound has minimal inherent strength because the dermal edges are held together solely by a<strong> hemostatic plug</strong> and <strong>sutures.</strong></p>\n<p>During the second postoperative week, fibroblasts proliferate rapidly and begin to produce type I collagen in addition to type III. The strength of the wound is still limited to less than 10% of its final strength.&nbsp;By week 6, the concentration of strong collagen fibers begins to resemble that of intact skin.</p>\n<p>As the collagen matures and becomes denser, the scar becomes <strong>almost acellular</strong> as the fibroblasts and blood vessels reduce.The disorganized collagen fibers become <strong>aligned along stress lines </strong>with their strength being in their weave rather than in their amount.</p>\n<p>Most of these changes occur over the <strong>first three months</strong> but a scar will continue to mature for 1 to 2 years.&nbsp;Tensile strength will continue to increase but would not be expected to exceed <strong>60&ndash;80%</strong>&nbsp;of that of normal skin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b72ac66835784d84b7a009900b801a2d.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The forearm of a patient admitted to the psychiatric ward is shown in the image. Which of the following is true about the healed injury?",
    "choices": [
      {
        "id": 1,
        "text": "Extends beyond the original incision"
      },
      {
        "id": 2,
        "text": "Has racial and genetic predilection"
      },
      {
        "id": 3,
        "text": "Parallel orientation of collagen fibers"
      },
      {
        "id": 4,
        "text": "Does not heal spontaneously"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows <strong>hypertrophic scars&nbsp;</strong>which have developed on possible sites of self-inflicted cuts.&nbsp;Type 3 <strong>collagen fibers</strong> are <strong>arranged parallelly&nbsp;</strong>in hypertrophic scars. This is in contrast to a keloid where the collagen fibers are more and randomly arranged.&nbsp;</p>\n<p>Hypertrophic scars rise above the skin level but stay within the confines of the original wound and often regress over time. They have no racial or genetic predilection.&nbsp;</p>\n<p><strong>Difference between keloid and hypertrophic scar:</strong></p>\n<table style=\"width: 399px;\">\n<tbody>\n<tr>\n<td style=\"width: 97.9688px;\"><strong>Features</strong></td>\n<td style=\"width: 130.789px;\"><strong>Hypertrophic scar</strong></td>\n<td style=\"width: 148.242px;\"><strong>Keloid</strong></td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Genetic predisposition</td>\n<td style=\"width: 130.789px;\">Not familial</td>\n<td style=\"width: 148.242px;\">Maybe familial - Autosomal dominant with incomplete penetration</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Age</td>\n<td style=\"width: 130.789px;\">Children</td>\n<td style=\"width: 148.242px;\">Adolescents. Middle age</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Race</td>\n<td style=\"width: 130.789px;\">No predilection</td>\n<td style=\"width: 148.242px;\">African American, Asian, Hispanic</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Site</td>\n<td style=\"width: 130.789px;\">Anywhere (more common on extensor surface)</td>\n<td style=\"width: 148.242px;\">Neck, chest, ear lobes, shoulders, upper back</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Timings</td>\n<td style=\"width: 130.789px;\">4&ndash;6 weeks postinjury</td>\n<td style=\"width: 148.242px;\">Symptom-free interval; may appear years after injury</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Symptoms</td>\n<td style=\"width: 130.789px;\">Raised, some pruritus, respects wound confines</td>\n<td style=\"width: 148.242px;\">Pain, pruritus, hyperesthesia, growth beyond wound margins</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Regression</td>\n<td style=\"width: 130.789px;\">Frequent spontaneous</td>\n<td style=\"width: 148.242px;\">No</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Contracture</td>\n<td style=\"width: 130.789px;\">Frequent</td>\n<td style=\"width: 148.242px;\">Rare</td>\n</tr>\n<tr>\n<td style=\"width: 97.9688px;\">Histology</td>\n<td style=\"width: 130.789px;\">Parallel orientation of collagen fibers</td>\n<td style=\"width: 148.242px;\">Hypocellular, thick, wavy collagen fibers in random orientation</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/71f33b0cb9f64d3d9de12049f89753db.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements are true with regards to a keloid scar?",
    "choices": [
      {
        "id": 1,
        "text": "The extent does not cross the wound margins"
      },
      {
        "id": 2,
        "text": "Wide excision of the keloid scar prevents recurrence"
      },
      {
        "id": 3,
        "text": "Histopathology of a keloid scar shows reduced collagen and increased vascularity"
      },
      {
        "id": 4,
        "text": "A keloid scar forms due to increase in the level of growth factors"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Differences between Keloids and Hypertrophic scars:</p>\n<table style=\"border-collapse: collapse; width: 59.4374%; height: 380.773px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\"><strong>Keloid&nbsp;</strong></td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\"><strong>Hypertrophic scar&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">Incidence&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\">Rare&nbsp;</td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\">Frequent&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Ethnic groups&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">African, American, Asian, Hispanic&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">No predilection&nbsp;</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">Prior injury&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\">Yes&nbsp;</td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\">Yes&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Site predilection</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">Neck, chest, earlobes, shoulders, upper back&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">Anywhere&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Genetics&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\"><strong>Autosomal dominant</strong> with incomplete penetration&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">No&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Timing&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">Symptom-free interval; may appear years after injury&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">4-6 weeks post-injury&nbsp;</td>\n</tr>\n<tr style=\"height: 67.1953px;\">\n<td style=\"width: 20.3378%; height: 67.1953px; text-align: center;\">Symptoms&nbsp;</td>\n<td style=\"width: 40.2127%; height: 67.1953px; text-align: center;\">Pain, pruritus, hyperesthesia, growth beyond wound margins</td>\n<td style=\"width: 39.4495%; height: 67.1953px; text-align: center;\">Raised, some pruritus, respects wound confines&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Regression and contracture&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">No, and rare&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">Frequent&nbsp;</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">Histology&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\">Hypocellular, thick, wavy collagen fibres in <strong>random orientation&nbsp;</strong></td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\"><strong>Parallel orientation</strong> of collagen fibres&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61e40243f86143daacfc9c2ba914eaaax800x534.JPEG"
    ]
  },
  {
    "text": "A patient has been treated for the lesion shown in the picture below for the past 12 months but there has been no response to treatment. What is the next line of treatment for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Intralesional injection of steroids"
      },
      {
        "id": 2,
        "text": "Pressure treatment"
      },
      {
        "id": 3,
        "text": "Excision with adjuvant therapy"
      },
      {
        "id": 4,
        "text": "Excision alone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Surgical exci&shy;sion in combination with adjuvant therapy is advised to patients with refractory keloids.&nbsp;</strong></p>\n<p>The adjuvant therapy usually includes radiation.The risk of malignancy attributable to keloid radiation therapy is minimal&nbsp;</p>\n<p><strong>Treatment of keloids</strong> :</p>\n<ul>\n<li>First-line treatments include silicones in combination with <strong>pressure therapy</strong> and <strong>intralesional corticosteroid</strong> <strong>injections.</strong></li>\n<li>Intralesional 5-fluorouracil, bleomycin, and verapamil should be used in accordance with established treatment protocols.</li>\n<li><strong>Refractory cases&nbsp;</strong>after <strong>12 months</strong> of therapy should be considered for surgical <strong>excision</strong> in combination with <strong>adjuvant therapy</strong>.</li>\n<li>Excision alone results in a <strong>high recurrence rate</strong> of 50% to 100% and enlargement of the keloid.</li>\n<li>Immediate postoperative electron beam irradiation or brachytherapy with iridium-192 reduces recurrence rates. The risk of malignancy attributable to keloid radiation therapy is minimal.</li>\n<li>An additional new invasive treatment modality is <strong>internal cryotherapy</strong>, in which a metal rod is introduced into the keloid and the subsequent extreme cooling leads to tissue necrosis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da47955eb717404784932b666ec2dfe5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following techniques will you use to reduce suture marks and scars?",
    "choices": [
      {
        "id": 1,
        "text": "2,5"
      },
      {
        "id": 2,
        "text": "1,2,4"
      },
      {
        "id": 3,
        "text": "3,4,5"
      },
      {
        "id": 4,
        "text": "2,4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Fine sutures </strong>(6/0 or smaller) <strong>placed close </strong>to the wound margins tend to cause less scarring.&nbsp;<strong>Subcuticular suturing </strong>avoids suture marks on either side of the wound or incision.</p>\n<p>Suture marks can be minimized using <strong>monofilament sutures </strong>that are<strong> removed early</strong> (3&ndash;5 days). Wounds can be strengthened post-suture removal by the use of sticky strips.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a skin substitute?",
    "choices": [
      {
        "id": 1,
        "text": "Integra"
      },
      {
        "id": 2,
        "text": "Alloderm"
      },
      {
        "id": 3,
        "text": "Trancyte"
      },
      {
        "id": 4,
        "text": "Duoderm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Duoderm is a <strong>hydrocolloid </strong>and not a skin substitute.</p>\n<p>Skin substitutes are skin products made of cells, extracellular matrix components, or a combination of the two.</p>\n<p><strong>Integra </strong>is a bilayered membrane skin substitute.</p>\n<p><strong>Alloderm </strong>is a acellular cadaveric dermis.</p>\n<p><strong>Apligraf </strong>is a living bilayered biologic dressing composed of neonatal dermal fibroblasts on a collagen matrix.</p>\n<p><strong>Trancyte</strong> is a&nbsp;tissue-engineered skin substitute is made from a nylon mesh and a silastic semi-permissible and biocompatible layer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the procedure shown in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Venesection"
      },
      {
        "id": 2,
        "text": "Fasciotomy of lower limb"
      },
      {
        "id": 3,
        "text": "GSV stripping"
      },
      {
        "id": 4,
        "text": "Linton's operation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image depicts a <strong>fasciotomy</strong> of the lower limb.</p>\n<p>Fasciotomy involves incising the <strong>deep muscle fascia </strong>and is best carried out via longitudinal incisions of skin, fat, and fascia. The <strong>muscle </strong>is seen<strong> bulging out </strong>through the fasciotomy opening.</p>\n<p>The lower limb can be decompressed via <strong>two incisions</strong>, each being lateral to the subcutaneous border of the tibia. This gives access to the two posterior compartments and to the peroneal and anterior compartments of the leg.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/89acddf347384543bbf2aac00fb5fbad.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A catheter is inserted into the limb of a patient suspected to have compartment syndrome. What minimum reading on the pressure monitor will prompt an immediate fasciotomy?",
    "choices": [
      {
        "id": 1,
        "text": "20 mmHg"
      },
      {
        "id": 2,
        "text": "30 mmHg"
      },
      {
        "id": 3,
        "text": "40 mmHg"
      },
      {
        "id": 4,
        "text": "50 mmHg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>pressure threshold </strong>for doing a <strong>fasciotomy</strong> in a case of suspected compartment syndrome is <strong>30 mmHg</strong></p>\n<p>Fasciotomy involves incising the deep muscle fascia and is best carried out via longitudinal incisions of skin, fat, and fascia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While performing a fasciotomy for compartment syndrome, the following layers are incised:",
    "choices": [
      {
        "id": 1,
        "text": "Skin and Subcutaneous tissue"
      },
      {
        "id": 2,
        "text": "Skin, Subcutaneous tissue, Superficial fascia"
      },
      {
        "id": 3,
        "text": "Skin, Subcutaneous tissue, Superficial fascia and Deep fascia"
      },
      {
        "id": 4,
        "text": "Skin, Subcutaneous tissue, Superficial fascia, Deep fascia and a few muscular fibres"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The incision for a fasciotomy involves the <strong>skin, subcutaneous tissue, superficial fascia,</strong> and<strong> deep fascia.</strong></p>\n<p>Fasciotomy involves incising the <strong>deep muscle fascia&nbsp;</strong>and is best carried out via longitudinal incisions of skin, subcutaneous fat, and superficial and deep fascia. The&nbsp;<strong>muscle will be seen bulging out&nbsp;</strong>through the fasciotomy opening.</p>\n<p>The lower limb can be decompressed via&nbsp;<strong>two incisions</strong>, each being lateral to the subcutaneous border of the tibia. This gives access to the two posterior compartments and the leg's peroneal and anterior compartments.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bfba91ccc33140e4a8452ca04386c448x720x1280.JPEG"
    ]
  },
  {
    "text": "The lower limb of this patient was run over by a car. Identify the type of injury.",
    "choices": [
      {
        "id": 1,
        "text": "Degloving injury"
      },
      {
        "id": 2,
        "text": "Crush injury"
      },
      {
        "id": 3,
        "text": "Lacerated injury"
      },
      {
        "id": 4,
        "text": "Tidy wound"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Degloving injury occurs when the skin and subcutaneous fat are stripped by avulsion from its <strong>underlying fascia</strong>, leaving neurovascular structures, tendons, or bones exposed.</p>\n<p>It may be open or closed.</p>\n<p>A <strong>tidy wound </strong>is a clean incised wound with seldom tissue loss whereas an <strong>untidy wound </strong>is one that is crushed, avulsed, contaminated often with tissue loss.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/22ed05e62e1847ef8ac555f5033d495e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most likely diagnosis of the lesion shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Arterial insufficiency"
      },
      {
        "id": 2,
        "text": "Neuropathic ulcer"
      },
      {
        "id": 3,
        "text": "Venous ulcer"
      },
      {
        "id": 4,
        "text": "Tuberculous ulcer"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The following is a picture of a pressure ulcer.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f4011c8b5f5840908b38890213d75758.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/143d3bb7ca9c482fbe5fc15f4918d20dx1280x629.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c196b68fb0534025b7bd8a1042dc1cf6x1280x837.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb423d0a75384b5abb58e73e14aa7d0dx1084x756.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7da0086f5c44412b9ab9440e4258079x1018x796.PNG"
    ]
  },
  {
    "text": "A 68-year-old diabetic presented with a foot ulcer that he first noticed 1 month ago. The edges are irregular with sloped margins. The ulcer does not bleed to touch. Peripheral pulses are felt and an arterial doppler does not indicate a compromised blood flow. Which growth factor has been formulated and approved for treatment?",
    "choices": [
      {
        "id": 1,
        "text": "IGF-1"
      },
      {
        "id": 2,
        "text": "PDGF"
      },
      {
        "id": 3,
        "text": "EDGF"
      },
      {
        "id": 4,
        "text": "TGF-B"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario is suggestive of a diabetic foot ulcer. At present, &nbsp;<strong>PDGF (platelet-derived growth factor)-BB</strong> is currently approved by the FDA for the treatment of diabetic foot ulcers.</p>\n<p>Application of recombinant human PDGF-BB in a gel suspension to these wounds increases the incidence of total healing and decreases healing time.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following procedures leaves a clean-contaminated wound?",
    "choices": [
      {
        "id": 1,
        "text": "Thyroidectomy"
      },
      {
        "id": 2,
        "text": "Repair of an old duodenal perforation"
      },
      {
        "id": 3,
        "text": "Elective cholecystectomy"
      },
      {
        "id": 4,
        "text": "Emergency appendectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Elective procedures in uninfected respiratory, genital, urinary, and gastrointestinal tracts such as <strong>elective cholecystectomy</strong>\u00a0produce\u00a0<strong>clean-contaminated </strong>wounds<strong>.</strong></p>\n<p>Option A: <strong>T</strong><strong>hyroidectomy</strong>\u00a0leaves a\u00a0<strong>clean</strong> wound.</p>\n<p>Option B: Repair of an <strong>old duodenal perforation</strong> is a\u00a0<strong>contaminated </strong>wound<strong>.</strong></p>\n<p>Option D: <strong>E</strong><strong>mergency appendectomy</strong> is usually performed in the setting of an inflamed appendix and results in a <strong>dirty</strong> surgical wound.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ASEPSIS wound scoring takes all of the following into consideration except:",
    "choices": [
      {
        "id": 1,
        "text": "Wound swab from the site"
      },
      {
        "id": 2,
        "text": "Serous discharge"
      },
      {
        "id": 3,
        "text": "Erythema"
      },
      {
        "id": 4,
        "text": "Induration"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">ASEPSIS wound score <strong>does not</strong> take <strong>induration</strong> into consideration. Instead, the I in ASEPS<strong>I</strong>S stands for the&nbsp;<strong>isolation of bacteria from the wound</strong>.</p>\n<p class=\"p1\"><strong>ASEPSIS wound score</strong> and <strong>Southampton wound score</strong> are used to determine the&nbsp;<strong>severity</strong> of the <strong>surgical site wound infection (SSI)</strong>.</p>\n<p class=\"p1\">ASEPSIS score includes:</p>\n<ul>\n<li class=\"p1\"><strong>A</strong>dditional treatment\n<ul>\n<li class=\"p1\"><span style=\"font-size: 10pt;\">Antibiotics for wound infection</span></li>\n<li class=\"p1\"><span style=\"font-size: 10pt;\">Drainage of pus under local anesthesia</span></li>\n<li class=\"p1\"><span style=\"font-size: 10pt;\">Debridement of the wound under general anesthesia</span></li>\n</ul>\n</li>\n<li class=\"p1\"><strong>S</strong>erous discharge</li>\n<li class=\"p1\"><strong>E</strong>rythema</li>\n<li class=\"p1\"><strong>P</strong>urulent exudate</li>\n<li class=\"p1\"><strong>S</strong>eparation of deep tissue</li>\n<li class=\"p1\"><strong>I</strong>solation of bacteria from the wound</li>\n<li class=\"p1\"><strong>S</strong>tay as inpatient prolonged over 14 days as a result of wound infection</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is used for wound infection grading?",
    "choices": [
      {
        "id": 1,
        "text": "ASA classification"
      },
      {
        "id": 2,
        "text": "SIRS criteria"
      },
      {
        "id": 3,
        "text": "Southampton grading"
      },
      {
        "id": 4,
        "text": "APACHE II score"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Southampton</strong> <strong>wound</strong> <strong>grading</strong> system is used to score the <strong>severity</strong> of <strong>wound</strong> <strong>site</strong> <strong>infection</strong>.</p>\n<p>Southampton wound grading system:</p>\n<ul>\n<li>Grade 0 - Normal healing</li>\n<li>Grade I - Normal healing with different grades of erythema</li>\n<li>Grade II - Erythema with other signs of inflammation at different parts of the wound.</li>\n<li>Grade III - Clear or serosanguinous discharge at different sites</li>\n<li>Grade IV - Pus discharge</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: American Society of Anesthesiologists <strong>(ASA)&nbsp;</strong> grading is used in<strong> pre-anesthetic checkups</strong> to assess a patient's physical health and fitness for anesthesia and surgery.</p>\n<p>Option B: Systemic Inflammatory Response Syndrome <strong>(SIRS)</strong> is a set of clinical criteria used to<strong> identify and monitor critically ill patients</strong> with high-grade burns, severe trauma, and other major surgeries.</p>\n<p>Option D: Acute Physiology and Chronic Health Evaluation II <strong>(APACHE II)</strong>&nbsp; is a scoring system used to assess the <strong>severity</strong> and predict the <strong>outcome</strong> of <strong>pancreatitis</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '47 Wound Healing, Tissue Repair & Scar';
        const quizFilename = '47-wound-healing-tissue-repair-scar-f60edb56.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>