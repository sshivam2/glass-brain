<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>29  Histology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        DAMS / DQB / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "id": 50000,
    "choices": [
      {
        "id": 200000,
        "text": "Stratified squamous"
      },
      {
        "id": 200001,
        "text": "Columnar"
      },
      {
        "id": 200002,
        "text": "Simple squamous"
      },
      {
        "id": 200003,
        "text": "Cuboidal"
      }
    ],
    "text": "What is the histological appearance of vaginal mucosa",
    "unique_key": "Q3724407",
    "question_audio": null,
    "question_video": null,
    "map_id": 34656182,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Stratified Squamous The vaginal mucosa is lined by stratified squamous epithelium, which is designed to protect the underlying tissues from mechanical stress, infection, and the acidic environment of the vagina. This type of epithelium consists of several layers of cells, with the surface layers being flat and scaly. The stratified squamous epithelium is well-suited for the vaginal environment, as it helps to provide a barrier against friction during sexual intercourse and childbirth, as well as to resist the effects of acidic secretions and microorganisms. Why Other Options Are Incorrect (B) Columnar: Columnar epithelium, characterized by taller, rectangular cells, is typically found in mucous membranes such as the endocervix and the respiratory tract, but not in the vagina. The vagina\u2019s mucosa is specifically lined by stratified squamous epithelium to withstand the stresses it encounters. (C) Simple Squamous: Simple squamous epithelium consists of a single layer of flat cells, which is typically found in areas where passive diffusion occurs, such as in the lining of blood vessels or alveoli in the lungs. This type of epithelium is not suitable for the vagina, which requires multiple layers of cells for protection and durability, making stratified squamous epithelium more appropriate. (D) Cuboidal: Cuboidal epithelium, with cells that are roughly square in shape, is usually found in glandular tissues and parts of the kidney tubules. It is not the type of epithelium found in the vaginal mucosa, where the stratified squamous type provides greater protective capabilities.",
    "correct_choice_id": 200000,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/40457261697973774/40457261697973774.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/40457261697973774/40457261697973774.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50001,
    "choices": [
      {
        "id": 200004,
        "text": "Skin"
      },
      {
        "id": 200005,
        "text": "Vagina"
      },
      {
        "id": 200006,
        "text": "Esophagus"
      },
      {
        "id": 200007,
        "text": "Gallbladder"
      }
    ],
    "text": "Stratified squamous epithelium is seen at all the following sites except:",
    "unique_key": "Q1032570",
    "question_audio": null,
    "question_video": null,
    "map_id": 34597045,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Gallbladder Stratified squamous epithelium is not found in the gallbladder. The gallbladder is lined by a simple columnar epithelium, which is well-suited for its function of storing and concentrating bile. This type of epithelium is involved in secretion and absorption, which are important processes for the gallbladder's role in digestion. Stratified squamous epithelium, which is designed to resist abrasion, is not required in the gallbladder because it does not experience the same type of mechanical stress that areas like the skin, vagina, and esophagus do. Why Other Options Are Incorrect (A) Skin: The epidermis of the skin is composed of stratified squamous epithelium, which is well-equipped to handle abrasion and environmental stress. The outermost layers of the skin are constantly shed and replaced, and the stratified squamous epithelium helps provide a strong, protective barrier against physical damage and pathogens. (B) Vagina: The vaginal mucosa is also lined by stratified squamous epithelium. This epithelium provides protection against mechanical stress, sexual intercourse, and the acidic environment of the vagina. It is well-suited for areas that experience friction and need an effective barrier. (C) Esophagus: The esophagus is lined by stratified squamous epithelium, which helps protect the underlying tissues from abrasion caused by food passing through. The epithelium is thicker in areas subjected to more friction, ensuring that it can resist wear and tear during the process of swallowing food.",
    "correct_choice_id": 200007,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/73449431697960915/73449431697960915.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/73449431697960915/73449431697960915.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50002,
    "choices": [
      {
        "id": 200008,
        "text": "Serous glands"
      },
      {
        "id": 200009,
        "text": "Mucous glands"
      },
      {
        "id": 200010,
        "text": "Mixed glands"
      },
      {
        "id": 200011,
        "text": "All salivary glands"
      }
    ],
    "text": "Serous demilunes is present in?",
    "unique_key": "Q3310294",
    "question_audio": null,
    "question_video": null,
    "map_id": 34445796,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Mixed Glands Serous demilunes are crescent-shaped clusters of serous cells that cap mucous acini in mixed glands (glands that have both mucous and serous components). These structures are commonly found in mixed salivary glands, such as the submandibular and sublingual glands. The serous demilunes produce a watery, enzyme-rich secretion that supports the mucous secretion, helping to create a more effective mixture for lubrication and digestion. The combination of mucous and serous acini in these glands is critical for their function in producing both lubricating and enzymatic components of saliva. Why Other Options Are Incorrect (A) Serous Glands: Serous glands consist entirely of serous cells, which produce a watery, enzyme-laden secretion. They do not contain mucous cells, so serous demilunes do not appear in purely serous glands. The role of serous cells is to produce watery fluid, not to combine with mucous secretion, which is characteristic of mixed glands. (B) Mucous Glands: Mucous glands secrete a thick, mucous secretion that helps with lubrication, but they do not contain serous demilunes. The mucous cells are arranged in acini without the addition of serous cells, as seen in mixed glands. The presence of serous demilunes requires the coexistence of both mucous and serous cells, which is not the case in purely mucous glands. (D) All Salivary Glands: Not all salivary glands have serous demilunes. Mixed glands like the submandibular and sublingual glands contain serous demilunes, but serous-only glands (such as the parotid) and mucous-only glands do not. The presence of serous demilunes is specific to mixed glands, not a feature of all salivary glands.",
    "correct_choice_id": 200010,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/36646591697961126/36646591697961126.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/36646591697961126/36646591697961126.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50003,
    "choices": [
      {
        "id": 200012,
        "text": "Spleen"
      },
      {
        "id": 200013,
        "text": "Thymus"
      },
      {
        "id": 200014,
        "text": "Thyroid"
      },
      {
        "id": 200015,
        "text": "Lymph node"
      }
    ],
    "text": "Subcapsular sinuses are seen in",
    "unique_key": "Q9840224",
    "question_audio": null,
    "question_video": null,
    "map_id": 34346192,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Lymph Node Subcapsular sinuses are found in lymph nodes. These sinuses are located just beneath the capsule of the lymph node and serve as spaces for the movement of lymph and immune cells. The lymph enters the subcapsular sinus after being filtered through the afferent lymphatic vessels. These sinuses allow the lymph to flow through the lymph node, where it can be filtered and exposed to immune cells such as lymphocytes and macrophages. The subcapsular sinus plays an important role in the immune response, as it is where immune cells first interact with foreign particles or pathogens present in the lymph. Why Other Options Are Incorrect (A) Spleen: The spleen contains marginal zones and red pulp, but it does not have subcapsular sinuses in the same way that lymph nodes do. Instead, the spleen has sinusoids that serve different purposes related to filtering blood and immune response. These sinusoids are structurally different from the subcapsular sinuses found in lymph nodes. (B) Thymus: The thymus is involved in the development and maturation of T-lymphocytes but does not have subcapsular sinuses. The thymus consists of a cortex and medulla, but its architecture differs from that of lymph nodes. The thymus does not filter lymph and therefore lacks sinuses similar to those in the lymph node. (C) Thyroid: The thyroid gland is involved in hormone production (e.g., thyroxine) and has a structure that includes follicles, but it does not have subcapsular sinuses. The thyroid is not an organ involved in filtering lymph, so its tissue structure does not include the sinuses found in lymph nodes.",
    "correct_choice_id": 200015,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/4434091697974739/4434091697974739.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/4434091697974739/4434091697974739.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50004,
    "choices": [
      {
        "id": 200016,
        "text": "Type I"
      },
      {
        "id": 200017,
        "text": "Type II"
      },
      {
        "id": 200018,
        "text": "Type IV"
      },
      {
        "id": 200019,
        "text": "Type V"
      }
    ],
    "text": "Collagen found in hyaline cartilage is",
    "unique_key": "Q3015103",
    "question_audio": null,
    "question_video": null,
    "map_id": 34828399,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Type II The predominant collagen in hyaline cartilage is Type II collagen. This type of collagen is specifically designed to provide structural support and resilience to cartilage. Type II collagen fibers form a mesh-like structure that allows hyaline cartilage to withstand compressive forces while maintaining flexibility and strength. This collagen type is a critical component of cartilage, especially in articular cartilage, which covers the ends of bones in joints, as well as in the respiratory tract, nose, and ribs. Why Other Options Are Incorrect (A) Type I: Type I collagen is the most abundant collagen in the body and is found primarily in dense connective tissues such as tendons, ligaments, and bone. While it provides tensile strength to tissues, it is not the main collagen in hyaline cartilage, where Type II collagen predominates. (C) Type IV: Type IV collagen is a key component of basement membranes, such as the basement membrane of epithelial tissues. It forms a mesh-like structure at the base of epithelial layers but is not present in significant amounts in cartilage. Therefore, it does not play a role in the structure of hyaline cartilage. (D) Type V: Type V collagen is found in small amounts in tissues like the cornea, hair, and placenta, but it is not the primary collagen in hyaline cartilage. Type V collagen is often involved in regulating the assembly of Type I collagen fibers and is not the major collagen type present in cartilage.",
    "correct_choice_id": 200017,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/64460691697962091/64460691697962091.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/64460691697962091/64460691697962091.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50005,
    "choices": [
      {
        "id": 200020,
        "text": "Ligament"
      },
      {
        "id": 200021,
        "text": "Periosteum"
      },
      {
        "id": 200022,
        "text": "Aponeurosis"
      },
      {
        "id": 200023,
        "text": "Tendon"
      }
    ],
    "text": "Dense regular collagen is found in all except -",
    "unique_key": "Q1126582",
    "question_audio": null,
    "question_video": null,
    "map_id": 34778785,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Periosteum The periosteum is a dense layer of vascular connective tissue that surrounds the bones. While it is rich in collagen fibers, it does not primarily consist of dense regular collagen. The periosteum contains a mix of collagen fibers, but they are arranged in an irregular pattern, as the periosteum serves a protective function and provides a surface for muscle attachment. Dense regular collagen, characterized by tightly packed, parallel collagen fibers, is more commonly found in tissues that experience significant tensile stress along a specific direction, such as tendons, ligaments, and aponeuroses. Why Other Options Are Incorrect (A) Ligament: Ligaments are primarily composed of dense regular collagen fibers. These fibers are aligned in parallel bundles to withstand tensile forces that are applied in a consistent direction, such as those experienced during joint movement. Ligaments connect bones to other bones, and their collagen structure provides strength and flexibility. (C) Aponeurosis: Aponeuroses are flat, sheet-like tendons made up of dense regular collagen fibers. They function similarly to tendons, providing attachment points for muscles to bones or other structures. The regular arrangement of collagen fibers allows for efficient force transmission along the direction of muscle pull. (D) Tendon: Tendons are composed of dense regular collagen fibers as well. Tendons connect muscles to bones and are structured to withstand tensile stress in a specific direction, making the parallel alignment of collagen fibers crucial for their function.",
    "correct_choice_id": 200021,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/28498561697962452/28498561697962452.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/28498561697962452/28498561697962452.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50006,
    "choices": [
      {
        "id": 200024,
        "text": "Articular disc"
      },
      {
        "id": 200025,
        "text": "Pinna"
      },
      {
        "id": 200026,
        "text": "Epiphyseal plate"
      },
      {
        "id": 200027,
        "text": "Intervertebral disc"
      }
    ],
    "text": "The lower two thirds of the following hematoxylin and eosin stained specimen is similar in appearance to which of the following structures<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/course_file_meta/3801293q47gnrlantmy.jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q5308943",
    "question_audio": null,
    "question_video": null,
    "map_id": 34623119,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Epiphyseal Plate The lower two-thirds of the specimen in the hematoxylin and eosin (H&E) stained slide closely resemble the epiphyseal plate (growth plate). The epiphyseal plate is composed of hyaline cartilage and is organized into distinct layers, including the resting zone, proliferative zone, hypertrophic zone, and ossification zone. H&E staining typically highlights these zones with varying shades due to differences in cell types and tissue organization. This structured arrangement of cartilage cells is characteristic of the epiphyseal plate and is often evident in histological slides of growing bones. The two-thirds of the specimen described likely show this distinct layered cartilage pattern, which is a key feature of the epiphyseal plate during bone growth. Why Other Options Are Incorrect (A) Articular Disc: The articular disc is made of fibrocartilage, which differs significantly from the hyaline cartilage of the epiphyseal plate. Fibrocartilage has a denser collagen fiber arrangement and typically appears more fibrous in H&E staining, without the same organized layering seen in hyaline cartilage. Articular discs, such as those in the temporomandibular joint (TMJ), have a different structure compared to the epiphyseal plate and would not show the same histological pattern. (B) Pinna: The pinna (or external ear) consists of elastic cartilage, which also differs from the hyaline cartilage of the epiphyseal plate. Elastic cartilage contains a network of elastic fibers that make it more flexible, and this would appear different under H&E staining. The arrangement of collagen fibers in the pinna would be less organized compared to the orderly layers in the epiphyseal plate, which are characteristic of growing cartilage. (D) Intervertebral Disc: The intervertebral disc is composed of fibrocartilage, with an outer annulus fibrosus and an inner nucleus pulposus. The structure of the intervertebral disc in histological sections would be distinct from the epiphyseal plate, particularly due to its fibrocartilage composition. Fibrocartilage has more densely packed collagen fibers and lacks the characteristic layering found in the epiphyseal plate.",
    "correct_choice_id": 200026,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24184811697962509/24184811697962509.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24184811697962509/24184811697962509.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50007,
    "choices": [
      {
        "id": 200028,
        "text": "Cuboidal"
      },
      {
        "id": 200029,
        "text": "Columnar"
      },
      {
        "id": 200030,
        "text": "Stratified squamous non- keratinized"
      },
      {
        "id": 200031,
        "text": "Stratified squamous keratinized"
      }
    ],
    "text": "Epithelial lining of esophagus is",
    "unique_key": "Q2646113",
    "question_audio": null,
    "question_video": null,
    "map_id": 34831199,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Stratified Squamous Non-Keratinized The epithelial lining of the esophagus is primarily composed of stratified squamous non-keratinized epithelium. This type of epithelium is well-suited for the esophagus, which is exposed to mechanical stress and abrasion as food passes through. The stratified squamous structure allows for multiple layers of cells that can protect the underlying tissues from injury. In the non-keratinized form, the cells remain moist, which is important for facilitating the movement of food and preventing drying out of the esophageal lining. Why Other Options Are Incorrect (A) Cuboidal: Cuboidal epithelium typically lines glandular ducts and certain parts of the kidney. It is not found in the esophagus. The cuboidal shape provides a different function than the stratified squamous epithelium needed to protect the esophagus from abrasion and physical stress during swallowing. (B) Columnar: Columnar epithelium is typically found in organs involved in absorption and secretion, such as the intestines and the stomach. While the esophagus does have some regions of columnar epithelium, especially near the junction with the stomach (gastroesophageal junction), the primary epithelial lining throughout the esophagus is stratified squamous, not columnar. (D) Stratified Squamous Keratinized: While the keratinized version of stratified squamous epithelium is found in areas that are exposed to significant wear and tear (like the skin), the esophagus does not need this feature. The esophagus's lining is typically non-keratinized because it is a moist cavity, and keratinization would not be suitable for food passage. Keratinized epithelium is more common in areas like the skin that need additional protection against dehydration and environmental exposure.",
    "correct_choice_id": 200030,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/7630681697962610/7630681697962610.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/7630681697962610/7630681697962610.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50008,
    "choices": [
      {
        "id": 200032,
        "text": "Jejunum"
      },
      {
        "id": 200033,
        "text": "Duodenum"
      },
      {
        "id": 200034,
        "text": "Ileum"
      },
      {
        "id": 200035,
        "text": "All"
      }
    ],
    "text": "Gland of brunner\u2019s is found in :",
    "unique_key": "Q9687269",
    "question_audio": null,
    "question_video": null,
    "map_id": 34757562,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Duodenum The glands of Brunner are located in the duodenum, which is the first part of the small intestine. These glands are specialized for producing an alkaline mucus that helps protect the duodenal lining from the acidic chyme coming from the stomach. The alkaline secretion also helps to neutralize the acidity of the stomach contents, creating a more favorable pH for the digestive enzymes in the small intestine. These glands are particularly abundant in the proximal duodenum and are not found in other parts of the small intestine. Why Other Options Are Incorrect (A) Jejunum: The jejunum does not contain Brunner's glands. The jejunum is mainly involved in nutrient absorption, and while it has numerous villi to aid this process, it does not have the alkaline-secreting Brunner's glands, which are specific to the duodenum. Instead, it relies on other mechanisms for protection and neutralization of stomach acid. (C) Ileum: Similar to the jejunum, the ileum also does not contain Brunner's glands. The ileum is the last section of the small intestine, and while it plays a role in absorption and has lymphoid tissue (Peyer's patches), it does not have the Brunner's glands that are characteristic of the duodenum. (D) All: While Brunner's glands are a unique feature of the duodenum, they are not found in the jejunum or ileum. Therefore, the statement \"All\" is incorrect because these glands are restricted to the duodenum.",
    "correct_choice_id": 200033,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/35233091697962635/35233091697962635.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/35233091697962635/35233091697962635.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50009,
    "choices": [
      {
        "id": 200036,
        "text": "Cilia"
      },
      {
        "id": 200037,
        "text": "Goblet cells"
      },
      {
        "id": 200038,
        "text": "Mucous glands"
      },
      {
        "id": 200039,
        "text": "Serous glands"
      },
      {
        "id": 200040,
        "text": "Cartilage"
      }
    ],
    "text": "Bronchi are lined with pseudostratified epithelium. As the airways continue distally, the epithelium changes. Which of the following features is last to disappear as the epithelium changes along the respiratory tube?",
    "unique_key": "Q6026280",
    "question_audio": null,
    "question_video": null,
    "map_id": 34079745,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Cartilage is lost when there is transition from bronchus to bronchiole. Among remaining options, three are sectretory units and only clearing unit is cilia. Even logically Cilia should be last to disappear in order to clear all the secretions secreted.",
    "correct_choice_id": 200036,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/2316011698328375/2316011698328375.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/2316011698328375/2316011698328375.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50010,
    "choices": [
      {
        "id": 200041,
        "text": "Acetylcholine"
      },
      {
        "id": 200042,
        "text": "ACTH"
      },
      {
        "id": 200043,
        "text": "Angiotensin II"
      },
      {
        "id": 200044,
        "text": "Epinephrine"
      },
      {
        "id": 200045,
        "text": "Norepinephrine"
      }
    ],
    "text": "A researcher is investigating factors affecting adrenal hormone synthesis and release. Intact adrenal glands are obtained from several autopsy specimens.Cells from a specific part of the gland, indicated by the arrow on the image of a whole adrenal gland shown below, are extracted for further analysis.These cells are most likely to be directly activated by which of the following substances?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/image(356).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q9624212",
    "question_audio": null,
    "question_video": null,
    "map_id": 34776327,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Marked structure is adrenal medulla which gets directly activated by preganglionic cholinergic fibres.",
    "correct_choice_id": 200041,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/78778761698328501/78778761698328501.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/78778761698328501/78778761698328501.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50011,
    "choices": [
      {
        "id": 200046,
        "text": "Tight junctions"
      },
      {
        "id": 200047,
        "text": "Gap junctions"
      },
      {
        "id": 200048,
        "text": "Desmosomes"
      },
      {
        "id": 200049,
        "text": "Hemidesmosomes"
      },
      {
        "id": 200050,
        "text": "Fascia adherens"
      }
    ],
    "text": "A 3-year-old baby is brought to his pediatricianfor a well child checkup. he has met all of the appropriate developmental milestones. His height and weight are in normal range. Osteoblasts near the growth plates of her long bones secrete matrix material, and when they become trapped in the ossified matrix, they become known as osteocytes. These osteocytes remain connected to each other by:",
    "unique_key": "Q5956877",
    "question_audio": null,
    "question_video": null,
    "map_id": 34096476,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Osteocytes have long intracanalicular processes that extend through the ossified bone matrix. These cytoplasmic processes send signals to exchange nutrients and waste products with the osteocytes within neighboring lamellae via gap junctions. Osteocytes can sense mechanical stresses and send signals to modulate the activity of surface osteoblasts, thereby helping to regulate bony remodeling.",
    "correct_choice_id": 200047,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/4599421698328641/4599421698328641.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/4599421698328641/4599421698328641.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50012,
    "choices": [
      {
        "id": 200051,
        "text": "Keratinised squamous epithelium"
      },
      {
        "id": 200052,
        "text": "Non-keratinised squamous with submucosa and minor salivary glands"
      },
      {
        "id": 200053,
        "text": "Non-keratinised squamous without submucosa and minor salivary glands"
      },
      {
        "id": 200054,
        "text": "Non-keratinised cuboidal"
      }
    ],
    "text": "True about epithelium lining hard palate is-",
    "unique_key": "Q2323073",
    "question_audio": null,
    "question_video": null,
    "map_id": 34905231,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Hard palate is made of keratinized squamous epithelium.",
    "correct_choice_id": 200051,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/35020911698506619/35020911698506619.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/35020911698506619/35020911698506619.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50013,
    "choices": [
      {
        "id": 200055,
        "text": "Spleen"
      },
      {
        "id": 200056,
        "text": "Lymph node"
      },
      {
        "id": 200057,
        "text": "Liver"
      },
      {
        "id": 200058,
        "text": "Bone"
      }
    ],
    "text": "Space of disse is seen in",
    "unique_key": "Q3844328",
    "question_audio": null,
    "question_video": null,
    "map_id": 34766802,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A-Spleen has red and white pulp. Option B-Lymph node has subcapsular sinus. Option C-space of disse is seen in liver. Option D-Bone shows trabeculations.",
    "correct_choice_id": 200057,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50014,
    "choices": [
      {
        "id": 200059,
        "text": "Basket cells"
      },
      {
        "id": 200060,
        "text": "Purkinje cells"
      },
      {
        "id": 200061,
        "text": "Golgi cells"
      },
      {
        "id": 200062,
        "text": "Granular cell"
      }
    ],
    "text": "Identify the marked structure:<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/10(456).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q2991932",
    "question_audio": null,
    "question_video": null,
    "map_id": 34743226,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Option A-Molecular layer has basket and stellate cells. Option B-In the images cerebellum is shown and The marked structures are purkinje cells. Option C,D-granular cells and Golgi cells are located in granular layer.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/28(163).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200060,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/77862701698504226/77862701698504226.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/77862701698504226/77862701698504226.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50015,
    "choices": [
      {
        "id": 200063,
        "text": "Foliate papilla"
      },
      {
        "id": 200064,
        "text": "Filiform papilla"
      },
      {
        "id": 200065,
        "text": "Fungiform papilla"
      },
      {
        "id": 200066,
        "text": "Circumvallate papilla"
      }
    ],
    "text": "Which of the following papilla is marked in the given picture?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/8(468).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q8796055",
    "question_audio": null,
    "question_video": null,
    "map_id": 34110895,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Option A-Foliate papillae are small sized vertical folds located on the tongue's posterolateral sides, just anterior to the palatoglossal arch of fauces. Four or five in number, they are found in the lingual mucosa and have a covering layer of non-keratinized epithelium. Option B-Filiform papillae are abundant, conical in shape with the vertex pointed caudally, and are located on the rostral, dorsal, and lateral surfaces of the tongue. Option C-The dorsal surfaces of fungiform papillae have a single taste bud. Fungiform papillae are found on the dorsal rostral surface of the tongue. Option D-In the image,circumvallate papillae are shown. The very large circumvallate papillae reside at the base of your tongue near your throat and contain hundreds of taste buds. These papillae are so large they are visible to the naked eye.They have a cleft like space on both sides.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/18(302).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200066,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/74383791698504029/74383791698504029.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/74383791698504029/74383791698504029.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50016,
    "choices": [
      {
        "id": 200067,
        "text": "Elastic Cartilage"
      },
      {
        "id": 200068,
        "text": "Fibro Cartilage"
      },
      {
        "id": 200069,
        "text": "Articulating Hyaline Cartilage"
      },
      {
        "id": 200070,
        "text": "Non Articulating Hyaline Cartilage"
      }
    ],
    "text": "Given histology picture is of which of the following?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/5(634).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q3611725",
    "question_audio": null,
    "question_video": null,
    "map_id": 34305044,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Option A-ELASTIC CARTILAGE will have Big cells seen singly or in the form of the groups and long & short wavy fibers (known as elastic and collagen fibers ) present in between . Option B-In the Image Shown,There are parallel rows of nuclei and parallel fibers . Alternate rows of fibers and cells are present here.Therefore , it is FIBROCARTILAGE. Fibers contain both collagen type 1 & type 2 (i.e of both bone and cartilage). Option C,D-HYALINE CARTILAGE will have 1. Presence of perichondrium 2. Presence of cell nests 3. Absence of fibers in between the group of cells (cell nests ).",
    "correct_choice_id": 200068,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/60345341698502718/60345341698502718.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/60345341698502718/60345341698502718.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50017,
    "choices": [
      {
        "id": 200071,
        "text": "Islets of Langerhans"
      },
      {
        "id": 200072,
        "text": "Lymphatic nodules"
      },
      {
        "id": 200073,
        "text": "Demilunes"
      },
      {
        "id": 200074,
        "text": "Glomeruli"
      }
    ],
    "text": "Identify the marked structure in the given Picture ?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/6(521).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q3482865",
    "question_audio": null,
    "question_video": null,
    "map_id": 34054054,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Option A-Important features of Islets of Langerhans:- \u2022 Size of islet will be very huge when compared with the surrounding acini. \u2022 On the inside blood capillaries are seen. Islet part is the endocrine part of pancreas(endocrine =ductless),therefore hormones are directly released into blood via capillaries. Option B-Lymphatic nodules are round aggregates of small, dark staining inactive (na\u00efve) B lymphocytes, usually near the capsule, within a network of follicular dendritic cell processes. Option C-serous Demilunes are seen in sublingual glands. Option D-Glomeruli is seen in kidney with cut sections of tubules present in the surroundings.",
    "correct_choice_id": 200071,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/36402531698502755/36402531698502755.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/36402531698502755/36402531698502755.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50018,
    "choices": [
      {
        "id": 200075,
        "text": "Sinsuoids"
      },
      {
        "id": 200076,
        "text": "Space of disse"
      },
      {
        "id": 200077,
        "text": "Space of Mall"
      },
      {
        "id": 200078,
        "text": "Canaliculi"
      }
    ],
    "text": "Stellate cells in liver are seen at which location?",
    "unique_key": "Q4095916",
    "question_audio": null,
    "question_video": null,
    "map_id": 34308392,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Option A-Sinsuoids are filled with blood and lined by endothelium. Option B- stellate cells are present in Space of disse and their Role is fat storage [Physiological ] and fibrosis[Pathological role]. Option C-A periportal space (space of Mall), where lymph is produced, is sandwiched between the connective tissue of the portal canals and the hepatocytes. Option D-Bile Canaliculi are filled with bile.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/74_1(22).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200076,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/62347871701777448/62347871701777448.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/62347871701777448/62347871701777448.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50019,
    "choices": [
      {
        "id": 200079,
        "text": "Presence of Serous acini with Acidophilic tip"
      },
      {
        "id": 200080,
        "text": "Serous acinus supported by basal lamina"
      },
      {
        "id": 200081,
        "text": "Absence of striated duct"
      },
      {
        "id": 200082,
        "text": "Apical acinar villi"
      }
    ],
    "text": "Difference between Exocrine pancreas and parotid gland is:-",
    "unique_key": "Q6047589",
    "question_audio": null,
    "question_video": null,
    "map_id": 34673586,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A-Serous acini with Acidophilic tip is present in both pancreas as well as parotid gland. Option B-Serous acinus supported by basal lamina is also present in both pancreas as well as parotid gland. Option C-No striated ducts are present in pancreas,while they are present in parotid gland. Option D-Apical acinar villi is present in both pancreas as well as parotid gland.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/75_1(25).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200081,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/74350771701777470/74350771701777470.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/74350771701777470/74350771701777470.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50020,
    "choices": [
      {
        "id": 200083,
        "text": "Mucus Cells"
      },
      {
        "id": 200084,
        "text": "Chief Cells"
      },
      {
        "id": 200085,
        "text": "Parietal cells"
      },
      {
        "id": 200086,
        "text": "Stem cells"
      }
    ],
    "text": "Predominant cells present at the isthmus of Gastric pits are?",
    "unique_key": "Q5581424",
    "question_audio": null,
    "question_video": null,
    "map_id": 34725369,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Option A-Mucus Cells are found in surface epithelium. Option B,C-Chief Cells and Parietal cells are present deep within the gastric gland. Option D-Isthmus means junction and at the junction, stem cells are present which helps in regeneration of other cells.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/76_1(11).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200086,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/10654381701777486/10654381701777486.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/10654381701777486/10654381701777486.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50021,
    "choices": [
      {
        "id": 200087,
        "text": "Renal pelvis"
      },
      {
        "id": 200088,
        "text": "Ureter"
      },
      {
        "id": 200089,
        "text": "Membranous urethra"
      },
      {
        "id": 200090,
        "text": "Minor calyx"
      }
    ],
    "text": "Transitional epithelium is present in all of the following places except",
    "unique_key": "Q7652532",
    "question_audio": null,
    "question_video": null,
    "map_id": 34584672,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A,B,D-Minor calyx,Major calyx, Renal pelvis ,ureter,bladder and Prostatic urethra,all have transitional epithelium. Option C-Membranous urethra has columnar epithelium.",
    "correct_choice_id": 200089,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/14449331701777507/14449331701777507.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/14449331701777507/14449331701777507.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50022,
    "choices": [
      {
        "id": 200091,
        "text": "Leydig cells of testis"
      },
      {
        "id": 200092,
        "text": "Pancreatic islet cells"
      },
      {
        "id": 200093,
        "text": "Hassall\u2019s corpuscles"
      },
      {
        "id": 200094,
        "text": "Glomerulus"
      }
    ],
    "text": "Identify the structure in the following histological image-<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/3(23).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q7128114",
    "question_audio": null,
    "question_video": null,
    "map_id": 34299200,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) The structure shown in the following histological image is Glomerulus is a rounded tuft of anastomosing capillaries lined by fenestrated endothelium. It is supported by the mesangium. Other options-<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/3_1(5).png\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200094,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50023,
    "choices": [
      {
        "id": 200095,
        "text": "A-1, B-2, C-3, D-4"
      },
      {
        "id": 200096,
        "text": "A-1, B-4, C-3, D-2"
      },
      {
        "id": 200097,
        "text": "A-2, B-1, C-4, D-3"
      },
      {
        "id": 200098,
        "text": "A-3, B-2, C-1, D-4"
      }
    ],
    "text": "Which of the following is correct match? 1 \u2013Aldosterone 2 \u2013Epinephrine/Norepinephrine 3 \u2013Sex Steroid 4 \u2013Cortisol<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/7(186).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q7380469",
    "question_audio": null,
    "question_video": null,
    "map_id": 34502798,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Aldosterone is secreted by zona glomerulosa. Cortisol is secreted by zona fasciculata. Sex Steroid is secreted by zona reticularis. Epinephrine/Norepinephrine is secreted by adrenal medulla. therefore, answer is A-1, B-4, C-3, D-2 Zona Glomerulosa: \u2022 Present Immediately inside the capsule \u2022 Comprising about 15% of the cortex \u2022 Consists of closely packed, rounded or arched cords of columnar or pyramidal cells with many capillaries . \u2022 Aldosterone, the major regulator of salt balance which acts to stimulate Na + reabsorption in the distal convoluted tubules is principal product. Middle Zona Fasciculata: \u2022 Occupies 65% to 80% of the cortex. \u2022 Consists of long cords of large polyhedral cells \u2022 These cells secrete: Glucocorticoids, especially cortisol, which affect carbohydrate metabolism by stimulating gluconeogenesis in many cells and glycogen synthesis in the liver. Zona Reticularis: \u2022 The innermost Zona Reticularis comprises about 10% of the cortex. \u2022 Consists of smaller cells in a network of irregular cords interspersed with wide capillaries The cells are usually more heavily stained, than those of the other zones \u2022 Cells of the also produce cortisol, But primarily secrete the weak androgens, \u2022 Including dehydroepiandrosterone (DHEA) that is converted to testosterone in both men and women. Adrenal Medulla: \u2022 Is composed of large, pale-staining polyhedral cells arranged in cords or clumps and supported by a reticular fiber network. \u2022 For storage and secretion of catecholamines, Either Epinephrine or Norepinephrine.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/8(177).png\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200096,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/19808951721393194/19808951721393194.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/19808951721393194/19808951721393194.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50024,
    "choices": [
      {
        "id": 200099,
        "text": "Gluconeogenesis"
      },
      {
        "id": 200100,
        "text": "sex hormones secretion"
      },
      {
        "id": 200101,
        "text": "Immune cell modulation"
      },
      {
        "id": 200102,
        "text": "Sodium & water retention"
      }
    ],
    "text": "Which of the following is the function of marked layer?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/2(847).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q1100510",
    "question_audio": null,
    "question_video": null,
    "map_id": 34966724,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Option A-Gluconeogenesis is produced by cortisol,which is produced by zona fasciculata. Option B-sex hormones secretion is done by zona reticulata. Option C-Immune cell modulation is done by cortisol,which is produced by zona fasciculata. Option D-Sodium & water retention is done by aldosterone,which is produced by zona glomerulosa as marked in picture.",
    "correct_choice_id": 200102,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50025,
    "choices": [
      {
        "id": 200103,
        "text": "Primary oocyte arrested in prophase - I"
      },
      {
        "id": 200104,
        "text": "Primary oocyte arrested in prophase - II"
      },
      {
        "id": 200105,
        "text": "Secondary oocyte arrested in prophase - II"
      },
      {
        "id": 200106,
        "text": "Secondary oocyte arrested in metaphase - II"
      }
    ],
    "text": "Post ovulation the oocyte is",
    "unique_key": "Q8541025",
    "question_audio": null,
    "question_video": null,
    "map_id": 34170645,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Before ovulation,the oocyte is Primary oocyte arrested in prophase - I Post ovulation, the oocyte is Secondary oocyte arrested in metaphase - II",
    "correct_choice_id": 200106,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/74168211725256750/74168211725256750.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/74168211725256750/74168211725256750.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50026,
    "choices": [
      {
        "id": 200107,
        "text": "Epiphyseal plate"
      },
      {
        "id": 200108,
        "text": "Diaphysis"
      },
      {
        "id": 200109,
        "text": "Epiphysis"
      },
      {
        "id": 200110,
        "text": "Metaphysis"
      }
    ],
    "text": "Fracture at which of the following site affects the longitudinal growth of a bone",
    "unique_key": "Q6720169",
    "question_audio": null,
    "question_video": null,
    "map_id": 34311936,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Option A-Fracture at Epiphyseal plate site affects the longitudinal growth of a bone. Option B-The diaphysis is the hollow, tubular shaft that runs between the proximal and distal ends of the bone. Option C-The wider section at each end of the bone is called the epiphysis. Option D-Each epiphysis meets the diaphysis at the metaphysis.",
    "correct_choice_id": 200107,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/55527391725256765/55527391725256765.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/55527391725256765/55527391725256765.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50027,
    "choices": [
      {
        "id": 200111,
        "text": "A-3, B-1, C-2, D-4"
      },
      {
        "id": 200112,
        "text": "A-4, B-1, C-2, D-3"
      },
      {
        "id": 200113,
        "text": "A-3, B-2, C-1, D-4"
      },
      {
        "id": 200114,
        "text": "A-1, B-3, C-2, D-4"
      }
    ],
    "text": "Match the columns based on marked areas<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/2(872).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q4690906",
    "question_audio": null,
    "question_video": null,
    "map_id": 34323128,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) A-3, B-1, C-2, D-4",
    "correct_choice_id": 200111,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/27570911725256788/27570911725256788.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/27570911725256788/27570911725256788.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50028,
    "choices": [
      {
        "id": 200115,
        "text": "A,B"
      },
      {
        "id": 200116,
        "text": "B,C"
      },
      {
        "id": 200117,
        "text": "C,D"
      },
      {
        "id": 200118,
        "text": "B,C"
      }
    ],
    "text": "A neonate has presented with failure to pass the meconium. The structure absent in the pathology lie in which of the following layers. Choose the correct answer.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/7(273).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q5539885",
    "question_audio": null,
    "question_video": null,
    "map_id": 34956273,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) This is a case of Hirschsprung disease.It is a birth defect in which some nerve cells are missing in the large intestine, so a child\u2019s intestine can\u2019t move stool and becomes blocked. The nerve cells are located in Auerbach and meissner's plexus located in muscularis propria and submucosa respectively. Hence,from the given picture B and C are the answer. A-mucosa B-submucosa C-muscularis propria D-serosa.",
    "correct_choice_id": 200116,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/20034641725256806/20034641725256806.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/20034641725256806/20034641725256806.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50029,
    "choices": [
      {
        "id": 200119,
        "text": "Fungiform"
      },
      {
        "id": 200120,
        "text": "Filliform"
      },
      {
        "id": 200121,
        "text": "Circumvalate"
      },
      {
        "id": 200122,
        "text": "Foliate"
      }
    ],
    "text": "Which type of tongue papillae lacks taste buds",
    "unique_key": "Q4063835",
    "question_audio": null,
    "question_video": null,
    "map_id": 34857166,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Option A-Fungiform papillae are mushroom-shaped structures located on the dorsum of the anterior two-thirds of the tongue.Due to their rich capillary network, larger size and patchy distribution, fungiform papillae can be identified as reddish dots that contrast to the smaller and more numerous filiform papillae. Option B-Filliform papillae lacks taste buds. Option C-The very large circumvallate papillae reside at the base of your tongue near your throat and contain hundreds of taste buds. Option D-The foliate papillae appear as a series of red colored, leaf\u2013like ridges of mucosa. They are covered with epithelium, lack keratin and so are softer, and bear many taste buds.",
    "correct_choice_id": 200120,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/76506581725256822/76506581725256822.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/76506581725256822/76506581725256822.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50030,
    "choices": [
      {
        "id": 200123,
        "text": "Ureter"
      },
      {
        "id": 200124,
        "text": "Trachea"
      },
      {
        "id": 200125,
        "text": "Duodenum"
      },
      {
        "id": 200126,
        "text": "Gall bladder"
      }
    ],
    "text": "This type of epithelium is seen in<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/8(260).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q4110859",
    "question_audio": null,
    "question_video": null,
    "map_id": 34963561,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Option A-The given epithelium is transitional epithelium which is found in ureter. Option B-Trachea has pseudostratified columnar epithelium. Option C-Duodenum has simple columnar epithelium. Option D-Gall bladder has simple columnar epithelium.",
    "correct_choice_id": 200123,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/54784651725256833/54784651725256833.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/54784651725256833/54784651725256833.m3u8",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '29  Histology';
        const quizFilename = '29-histology-e6d8fb3e.html';
        let hierarchy = ["DAMS", "DQB", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on navigation
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>