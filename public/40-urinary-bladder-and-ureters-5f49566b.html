<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40 Urinary Bladder And Ureters - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The uterine artery crosses the ureter ______",
    "choices": [
      {
        "id": 1,
        "text": "Laterally"
      },
      {
        "id": 2,
        "text": "Medially"
      },
      {
        "id": 3,
        "text": "Anteriorly"
      },
      {
        "id": 4,
        "text": "Posteriorly"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The uterine artery crosses the ureter <strong>anteriorly&nbsp;</strong>(Water under the bridge). Damage to the ureter is more likely at this site (<strong>most dangerous</strong> site) during <strong>hysterectomy</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newborn child was noted to have a congenital anomaly as shown in the image below. All of the following  statements are true about this condition except:",
    "choices": [
      {
        "id": 1,
        "text": "Closure of abdominal wall should be done within the first year"
      },
      {
        "id": 2,
        "text": "Bilateral inguinal hernia is seen in males"
      },
      {
        "id": 3,
        "text": "It is associated with hypospadias"
      },
      {
        "id": 4,
        "text": "It predisposes to bladder cancer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The congenital anomaly seen in the above image is <strong>exstrophy of the bladder (ectopia vesicae)</strong>. It is associated with <strong>epispadias,</strong>&nbsp;not hypospadias.</p>\n<p>Bladder exstrophy refers to <strong>herniation of the urinary bladder</strong> through an anterior abdominal wall defect. The bladder is open and <strong>exposed on the outside</strong> of the abdomen. The male to female ratio is 4:1. Chronic exposure of the bladder to the external environment can lead to <strong>adenocarcinoma</strong> of the bladder.&nbsp;</p>\n<p>The clinical features of bladder exstrophy include:</p>\n<ul>\n<li>Separation of the pubic bones with non-united symphysis pubis</li>\n<li><strong>Epispadias</strong></li>\n<li>In males: Broad and short penis and <strong>bilateral inguinal hernia</strong>&nbsp;</li>\n<li>In females: Bifid clitoris&nbsp;</li>\n</ul>\n<p>Management involves a staged surgical reconstruction of the bladder and genitalia. <strong>Closure of the abdominal and bladder wall</strong>&nbsp;is done in the <strong>first year of life.</strong> This often requires an <strong>iliac osteotomy</strong>&nbsp;to&nbsp;relax the tension on&nbsp;the bladder and repair the abdominal wall during wound-healing.</p>\n<p>Later, <strong>reconstruction of the bladder</strong> neck, sphincters, epispadias, and other genital defects is done.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/592c0ed92c334e03999ed3630babb6a5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young girl presents with continuous dribbling of urine but she voids normally. Her parents tell you that she had never been totally dry since her birth. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ectopic ureter"
      },
      {
        "id": 2,
        "text": "Ureterocele"
      },
      {
        "id": 3,
        "text": "Congenital megaureter"
      },
      {
        "id": 4,
        "text": "Vesicoureteric reflux"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario with <strong>continuous dribbling of urine</strong>, in spite of <strong>regular voiding</strong>, is suggestive of an <strong>ectopic ureter.</strong></p>\n<p>Ectopic ureter&nbsp;is a congenital anomaly that occurs as a result of <strong>abnormal caudal migration</strong> of the <strong>ureteral bud</strong> during its insertion into the urinary bladder. They are usually associated with <strong>duplex ureters </strong>and drain from the <strong>upper pole of the kidney</strong>.</p>\n<p>It is more common in <strong>females</strong>. The ectopic ureter usually opens into the&nbsp;<strong>urethra, vagina, and perineum</strong>. Hence, female patients present with constant urinary dripping all day, even though the child voids regularly <strong>(Paradoxical incontinence). </strong>It can cause hydroureteronephrosis and recurrent UTI.</p>\n<p>In <strong>males</strong>, the ectopic ureter opens always <strong>above the external urethral sphincter.&nbsp;</strong> Hence they are <strong>usually continent. </strong>However, it can cause other complications such as <strong>orchitis and epididymitis.</strong></p>\n<p>Management involves <strong>re-implantation of the ureter into the bladder</strong> to treat incontinence and preserve renal functions.&nbsp;If the kidney is severely affected,&nbsp;<strong>partial nephrectomy</strong> is helpful.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During a cricket match, a batsman controls his urge to urinate as he is unable to take a break in-between. While batting, he suffers a sudden blow as the ball hits him in the suprapubic region. He presents to the emergency department with severe hypogastric pain and the inability to pass urine. He collapses suddenly during the examination. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Intraperitoneal rupture of the bladder"
      },
      {
        "id": 2,
        "text": "Extraperitoneal rupture of the bladder"
      },
      {
        "id": 3,
        "text": "Membranous urethra rupture"
      },
      {
        "id": 4,
        "text": "Pubic diastasis with bulbar urethra rupture"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario with a history of <strong>injury to a full bladder</strong>, inability to pass urine, and <strong>syncope</strong> are suggestive of <strong>intraperitoneal rupture of the bladder</strong>.</p>\n<p><strong>Bladder rupture&nbsp;</strong>can be of two types:</p>\n<table style=\"width: 865.953px;\">\n<tbody>\n<tr>\n<td style=\"width: 105px;\">&nbsp;</td>\n<td style=\"width: 204px;\"><strong>Extraperitoneal rupture</strong></td>\n<td style=\"width: 233.953px;\"><strong>Intraperitoneal rupture</strong></td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">&nbsp;</td>\n<td style=\"width: 204px;\"><strong>More common&nbsp;</strong>(80%)</td>\n<td style=\"width: 233.953px;\">&nbsp;Less common (20%)</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">Cause</td>\n<td style=\"width: 204px;\">\n<ul>\n<li>Penetrating trauma</li>\n<li>Pelvic fracture</li>\n<li>Surgical damage</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Associated with <strong>proximal urethral injury</strong></li>\n</ul>\n</td>\n<td style=\"width: 233.953px;\">&nbsp;\n<ul>\n<li>Direct blow or fall on a&nbsp;<strong>distended bladder</strong></li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">Clinical features</td>\n<td style=\"width: 204px;\">\n<ul>\n<li><strong>Pelvic urinoma</strong> (encapsulated collection of extravasated urine) is seen</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Blood at the tip of the meatus</li>\n</ul>\n</td>\n<td style=\"width: 233.953px;\">\n<ul>\n<li>Sudden severe pain in the hypogastrium</li>\n<li><strong>Syncope</strong></li>\n<li>Peritonitis</li>\n</ul>\n&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">Treatment</td>\n<td style=\"width: 204px;\">\n<ul>\n<li>Catheter drainage for 7&ndash;10 days</li>\n</ul>\n</td>\n<td style=\"width: 233.953px;\">\n<ul>\n<li>Laparotomy</li>\n<li>Repair of bladder</li>\n<li>Bladder drainage</li>\n</ul>\n&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p><strong><br />Pubic diastasis</strong> refers to the <strong>separation of the pubic symphysis</strong> without concomitant fracture. Pubic diastasis with <strong>bulbar urethra rupture</strong> usually occurs due to <strong>straddle injury</strong> and presents with <strong>blood at the tip of the meatus</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was rushed to the casualty after sustaining a suprapubic injury. On examination, no blood is seen at the meatus. On inserting Foley\u2019s catheter, gross hematuria is noted. His vitals are stable and his pelvic X-ray is given below. What will be the next step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Suprapubic catheterization"
      },
      {
        "id": 2,
        "text": "Urinary diversion"
      },
      {
        "id": 3,
        "text": "Exploratory laparotomy"
      },
      {
        "id": 4,
        "text": "CT cystogram"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Note: Closed book pelvic fractures are more commonly associated with urethral injuries than bladder injuries.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dfced570a30644ffaa9391171a62113c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bcea131273934a6086aba9e57d856d0ex1280x2018.JPEG"
    ]
  },
  {
    "text": "An elderly man was rushed to the casualty at midnight with complaints of severe suprapubic pain and inability to pass urine for the past 24 hours. The abdominal examination finding of the patient is given below. A smooth and enlarged prostate was felt in the per-rectal examination. While attempting to insert a 16-F Foley catheter in this patient, you feel resistance and fail to catheterize. What will be the next step in the management?",
    "choices": [
      {
        "id": 1,
        "text": "Insert an 18-Fr Coud\u00e9 catheter"
      },
      {
        "id": 2,
        "text": "Insert a smaller sized Foley catheter"
      },
      {
        "id": 3,
        "text": "Perform cystoscopy"
      },
      {
        "id": 4,
        "text": "Suprapubic catheterization"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>acute retention of urine,</strong>&nbsp;possibly because of&nbsp;<strong>benign prostatic hyperplasia</strong> (BPH). The next step would be to <strong>insert an 18-Fr Coud&eacute; catheter.</strong></p>\n<p>In men, the BPH especially the middle lobe enlargement obstructs the insertion of Foley's catherter. Hence, a Coude catheter is advised over suprapubic catetherization as the immediate next step as larger Fr Coude catheter is helpful in negotiating past the angulation in the prostatic urethra.&nbsp;</p>\n<p>(Note: In acute urine retention, urethral strictures should be suspected when there is resistance at the urethral meatus as the strictures are more common in distal urethra than proximal urethra)</p>\n<p><strong>Bladder outlet obstruction</strong>&nbsp;is usually the most common cause of&nbsp;acute retention of urine.&nbsp;Its clinical features include:</p>\n<ul>\n<li aria-level=\"1\">Inability to pass urine</li>\n<li aria-level=\"1\">Severe suprapubic pain</li>\n<li aria-level=\"1\">A <strong>distended</strong>, palpable, and tender bladder</li>\n</ul>\n<p>Acute urinary retention is managed by placing a <strong>urethral catheter</strong> as early as possible. Usually in BPH,&nbsp;<strong>smaller catheters will</strong> <strong>not pass</strong> through the angulation of the prostatic urethra as they are flexible and <strong>kink</strong>. Hence in BPH, the <strong>Coud&eacute;-tip catheter, </strong>which has a <strong>rigid and angulated tip</strong>, can be used to overcome the urethral obstruction.</p>\n<p>If urethral catheter placement is not successful, <strong>suprapubic catheterization</strong> should be done.&nbsp;</p>\n<p>If there is a <strong>urethral stricture</strong>, a <strong>council tip catheter</strong> is used to dilate it using a cystoscope, guide wires, and urethral dilators.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/99396e72a941428da521fb49a2f907ba.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4375bfcaeb3e43ada826f880a091adaex1280x1862.JPEG"
    ]
  },
  {
    "text": "You are asked to remove a Foley\u2019s catheter after a procedure but you are unable to deflate the balloon. The surgeon himself tries to remove it after cutting the sidearm but is unsuccessful as well. What should be the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "CT-guided rupture of bulb of Foley's"
      },
      {
        "id": 2,
        "text": "Inject ether to dissolve the balloon and pull it out"
      },
      {
        "id": 3,
        "text": "Inject water to over distend the balloon until it bursts and remove the catheter"
      },
      {
        "id": 4,
        "text": "Inflate with 20ml of water and under USG guidance, locate and prick the balloon"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>USG-guided rupture</strong> of the balloon percutaneously after inflating it with 20ml water should be the next step of management.</p>\n<p>The failure of the balloon to deflate may be caused by:</p>\n<ul>\n<li>Faulty valve mechanism&nbsp;</li>\n<li>Blockage of the inflation channel by debris</li>\n<li>Crystallization of the fluid within the balloon (when saline is used)</li>\n</ul>\n<p>The next best step in the management of a retained Foley's catheter is to further <strong>inflate</strong> the balloon with <strong>20mL</strong> <strong>of water</strong>, following which the inflated <strong>balloon is ruptured</strong> percutaneously with a needle under <strong>USG guidance</strong>.&nbsp;</p>\n<p>A suprapubic approach is used in males, while in females, either a transurethral or transvaginal route can be used. A&nbsp;<strong data-stringify-type=\"bold\">cystoscopy</strong>&nbsp;should be done to ensure that all fragments are removed.</p>\n<p>Other methods of approach include cutting<strong data-stringify-type=\"bold\">&nbsp;the sidearm</strong>&nbsp;of the catheter, thereby disabling the valve mechanism, or advancing a&nbsp;<strong data-stringify-type=\"bold\">ureteric stylet&nbsp;</strong>or<strong data-stringify-type=\"bold\">&nbsp;fine-gauge wire</strong>&nbsp;through the inflation port to dislodge debris or puncture the balloon. But these are often unsuccessful.</p>\n<p>Option A: CT is not routinely used in most settings with retained Foley's.</p>\n<p>Option B: Injection of <strong>ether</strong> through the balloon port causes the rupture of the balloon within seconds. But this technique causes significant <strong>bladder irritation.</strong></p>\n<p>Option C: Balloons should not be overinflated until they rupture. This may cause <strong>severe pain</strong> and could cause <strong>bladder rupture.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the given picture of a Foley\u2019s catheter, what is the function of the tube marked \u2018A\u2019?",
    "choices": [
      {
        "id": 1,
        "text": "Suction"
      },
      {
        "id": 2,
        "text": "Irrigation"
      },
      {
        "id": 3,
        "text": "BCG Instillation"
      },
      {
        "id": 4,
        "text": "Cystoscope"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a three-way Foley's catheter. The tube marked &lsquo;A&rsquo; is used for <strong>continuous irrigation of the bladder </strong>to remove debris &amp; blood clots<strong>.</strong> This is most commonly used after any prostate surgery or conditions with bleeding in the bladder.</p>\n<p>The <strong>central</strong> tube is used for the <strong>drainage</strong> of urine and the tube on the <strong>right</strong> is used for <strong>inflating</strong> the balloon.<span class=\"Apple-converted-space\">&nbsp;</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/870c1f72674944e6ae2ac6f32a564b21.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the earliest sign seen on cystoscopy in a patient suspected to have bladder tuberculosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tubercles at the ureteric orifice"
      },
      {
        "id": 2,
        "text": "Pallor around the ureteric orifices"
      },
      {
        "id": 3,
        "text": "Focal areas of hyperaemia"
      },
      {
        "id": 4,
        "text": "Hunner's patches"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><br />Ureteric lesions can also be seen in genitourinary tuberculosis. They include:</p>\n<ul>\n<li><strong>Kerr&rsquo;s kink</strong> - kinking of the ureteropelvic junction (UPJ)</li>\n<li>Ureteral stricture</li>\n<li>Beaded ureter</li>\n<li>Shortening of the ureter</li>\n<li><strong>Golf hole ureter</strong> - Longitudinal fibrosis leading to shortening of the ureter and pulling up the orifice as a gaping hole.&nbsp;<strong>Reimplantation of ureter</strong> is done.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e5c4b134b71c4d4babbf287b78afcc1ex720x503.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d451ff848c741d1bbb2a2acafee885bx1280x1663.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man comes with complaints of hematuria and difficulty in urination for the past few weeks. Microscopic examination of urine samples shows parasitic eggs as shown in the image. Which type of bladder carcinoma is the patient most likely to develop?",
    "choices": [
      {
        "id": 1,
        "text": "Transitional cell carcinoma"
      },
      {
        "id": 2,
        "text": "Squamous cell carcinoma"
      },
      {
        "id": 3,
        "text": "Adenocarcinoma"
      },
      {
        "id": 4,
        "text": "Uroepithelial carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>schistosomiasis</strong>. The patient is most likely to develop <strong>squamous cell carcinoma</strong>&nbsp;as it is associated with schistosomiasis. The image shows oval-shaped eggs with the terminal spine which is characteristic of <em>Schistosoma haematobium.&nbsp;</em></p>\n<p>Schistosomal bladder cancers can also be adenocarcinoma or transitional cell carcinoma (less frequently).</p>\n<p><strong>Primary bladder tumors</strong> usually originate from the <strong>transitional epithelium </strong>of the bladder (90%). Sometimes, they arise from connective tissue. Secondary tumors of the bladder arise from the sigmoid and rectum, the prostate, the uterus, or the ovaries.&nbsp;</p>\n<p>Carcinoma of the bladder &amp; associated risk factors:&nbsp;</p>\n<table style=\"height: 94px; width: 557px;\">\n<tbody>\n<tr>\n<td style=\"width: 265px;\"><strong>Histological subtype</strong></td>\n<td style=\"width: 280px;\"><strong>Risk factors</strong></td>\n</tr>\n<tr>\n<td style=\"width: 265px;\">Transitional cell carcinoma (urothelial)</td>\n<td style=\"width: 280px;\">\n<ul>\n<li><strong>Smoking</strong></li>\n<li>Exposure to aniline <strong>dyes</strong></li>\n<li><strong>Cyclophosphamide</strong></li>\n<li>Pelvic irradiation</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 265px;\">\n<p>Squamous cell carcinoma</p>\n</td>\n<td style=\"width: 280px;\">\n<ul>\n<li><strong>Schistosomiasis</strong></li>\n<li>Chronic irritation caused by stone disease</li>\n<li>Bladder diverticula</li>\n<li>Chronic UTI</li>\n<li>Smoking</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 265px;\">Adenocarcinoma</td>\n<td style=\"width: 280px;\">\n<ul>\n<li>Persistent urachus or trigone of the bladder</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a81c23fa831a495c889fb71814aadca8.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs causes carcinoma bladder?",
    "choices": [
      {
        "id": 1,
        "text": "Cyclophosphamide"
      },
      {
        "id": 2,
        "text": "Cisplatin"
      },
      {
        "id": 3,
        "text": "Taxane"
      },
      {
        "id": 4,
        "text": "Tamoxifen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cyclophosphamide</strong> (an alkylating agent) causes<strong> bladder cancer</strong></p>\n<p>The risk of bladder cancer with cyclophosphamide is directly proportional to the duration and intensity of cyclophosphamide treatment. <strong>Phosphoramide mustard</strong> is the<strong> primary mutagenic</strong> metabolite that causes bladder cancer in patients exposed to cyclophosphamide.</p>\n<p><strong>Painless, gross hematuria</strong> is the most common symptom that is indicative of a <strong>bladder carcinoma</strong> until proven otherwise.&nbsp;</p>\n<p>Depending upon the depth of invasion, bladder carcinoma can be divided into&nbsp;</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Flat, non-invasive carcinoma in situ (CIS)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Non-muscle invasive bladder cancer (70% of cases) - does not invade detrusor muscle but can invade lamina propria.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Muscle-invasive bladder cancer - invades the detrusor muscle.</li>\n</ol>\n<p>Diagnosis is by <strong>cystourethroscopy</strong> (directly visualizing the growth) and biopsy. Management is as follows:&nbsp;</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Non-muscle invasive</strong> bladder cancer:</li>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Transurethral resection of bladder tumor <strong>(TURBT)</strong> followed by <strong>intravesical</strong> chemotherapy with<strong> mitomycin C</strong> or epirubicin</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><strong>Immunotherapy</strong> with regular <strong>intravesical instillations</strong> of Bacille Calmette Guerin<strong> (BCG)</strong> in <strong>high-risk</strong> tumors.</li>\n</ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Muscle invasive</strong> bladder cancer: <strong>Radical cystectomy</strong> along with <strong>urinary diversion </strong>procedure and <strong>lymph node dissection</strong> +/- <strong>neoadjuvant chemotherapy</strong></li>\n</ol>\n<p>Other options:</p>\n<p>Option B: <strong>Cisplatin</strong> is an<strong> anticancer drug</strong> used to <strong>treat testicular cancer</strong>. It is associated with an increased risk for acute myeloid leukemia<strong> (AML)</strong>.</p>\n<p>Option C: <strong>Taxane</strong> is an <strong>anticancer</strong> <strong>drug</strong> and is the main component in the <strong>treatment</strong> regimens of <strong>metastatic cancers</strong>. Taxane's adverse effects are <strong>neutropenia</strong> and <strong>fluid retention</strong> (pulmonary edema).</p>\n<p>Option D: <strong>Tamoxifen</strong> is a selective estrogen receptor modulator <strong>(SERM)</strong> and is used in the <strong>treatment</strong> of <strong>estrogen-dependent breast cancer</strong>. Due to its partial agonistic activity, it is known to <strong>increase endometrial cancer</strong> in <strong>post-menopausal women</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the incorrect statement regarding bladder carcinoma.",
    "choices": [
      {
        "id": 1,
        "text": "Painless hematuria is the most common symptom"
      },
      {
        "id": 2,
        "text": "Inactivation of the Rb gene is implicated in the cancer formation"
      },
      {
        "id": 3,
        "text": "Urine cytology has low sensitivity"
      },
      {
        "id": 4,
        "text": "The most important prognostic factor is the size of the tumor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most important prognostic factor in <strong>bladder carcinoma</strong> is the <strong>depth of invasion</strong>.&nbsp;</p>\n<p>Activation of oncogenes such as <strong><em>ras, c-erbB, E2F3,</em></strong> and inactivation of tumor-suppressor genes such as <strong><em>p53, p21, p16,</em> and <em>Rb gene</em> </strong>is implicated in the cancer formation of the bladder.</p>\n<p>Clinical features of bladder carcinoma include:</p>\n<ul>\n<li><strong>Painless gross haematuria</strong>&nbsp;- Most common symptom and is indicative of a bladder carcinoma until proven otherwise</li>\n<li>Urinary retention</li>\n<li>Constant pelvic pain</li>\n<li>Increased urinary frequency</li>\n<li>Discomfort while urinating</li>\n<li>If there is nerve involvement, <strong>pain is referred</strong> to the suprapubic region, groins, perineum, and thighs.</li>\n</ul>\n<p>Investigations done for bladder cancer are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Urine cytology - Low sensitivity</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intravenous urography - Not frequently used nowadays. Replaced by non-contrast CT and MRI</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cystourethroscopy and biopsy</strong> - The <strong>best investigation</strong>&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the treatment of choice for a patient with non-invasive bladder carcinoma of stage pT1?",
    "choices": [
      {
        "id": 1,
        "text": "Intravesical BCG"
      },
      {
        "id": 2,
        "text": "Radical cystectomy"
      },
      {
        "id": 3,
        "text": "Transurethral resection of the bladder tumor"
      },
      {
        "id": 4,
        "text": "Chemotherapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Since the pathological staging of the tumor is given (pT1), it implies that transurethral resection of the bladder tumor (TURBT) has already been done. Therefore, this patient should be managed by&nbsp;<strong>instillation of intravesical BCG</strong>.</p>\n<p><strong>TURBT</strong> is done for the <strong>pathologic staging</strong> of the tumor. This staging helps us to decide the further plan of treatment. <strong>Intravesical therapy</strong> (using chemotherapy or immunotherapy) is done within 24hrs of TURBT in order to kill any residual cancer cells. It only affects the lining of the bladder and is not useful for cancers that have spread into the deeper layers.</p>\n<p>pT stage: Pathological stage</p>\n<table style=\"width: 490px; height: 473px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 18px;\"><strong>pT stage</strong></td>\n<td style=\"width: 399.601px; height: 18px;\"><strong>Extent of the tumor</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 18px;\"><strong>T<sub>x</sub></strong></td>\n<td style=\"width: 399.601px; height: 18px;\">Primary tumor cannot be assessed</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 17px;\"><strong>T<sub>0</sub></strong></td>\n<td style=\"width: 399.601px; height: 17px;\">No evidence of primary tumor</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 17px;\"><strong>T<sub>a</sub></strong></td>\n<td style=\"width: 399.601px; height: 17px;\">Noninvasive papillary carcinoma</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 17px;\"><strong>T<sub>is</sub></strong></td>\n<td style=\"width: 399.601px; height: 17px;\">Carcinoma in situ</td>\n</tr>\n<tr style=\"height: 4.04688px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 4.04688px;\"><strong>T<sub>1</sub></strong></td>\n<td style=\"width: 399.601px; height: 4.04688px;\">Tumor invades subepithelial connective tissue (lamina propria)</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 17px;\"><strong>T<sub>2</sub></strong></td>\n<td style=\"width: 399.601px; height: 17px;\">Tumor invades muscularis propria bladder wall</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 17px;\"><strong>T<sub>3</sub></strong></td>\n<td style=\"width: 399.601px; height: 17px;\">Tumor invades perivesical tissue</td>\n</tr>\n<tr style=\"height: 3px;\">\n<td style=\"width: 76.3993px; text-align: left; height: 3px;\"><strong>T<sub>4</sub></strong></td>\n<td style=\"width: 399.601px; height: 3px;\">Tumor invades any of the following: Prostate, uterus, vagina, pelvic wall and abdominal wall</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p><strong>Treatment of carcinoma bladder:</strong></p>\n<table style=\"width: 494.472px;\">\n<tbody>\n<tr>\n<td style=\"width: 173px; text-align: left;\"><strong>pT stage</strong></td>\n<td style=\"width: 307.472px;\"><strong>Treatment</strong></td>\n</tr>\n<tr>\n<td style=\"width: 173px; text-align: left;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Low-grade pT<sub>a</sub></li>\n</ul>\n</td>\n<td style=\"width: 307.472px;\"><strong>Intravesical chemotherapy</strong> with mitomycin, thiotepa, and adriamycin may be started after TURBT</td>\n</tr>\n<tr>\n<td style=\"width: 173px; text-align: left;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">High-grade pT<sub>a</sub></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">pT<sub>is</sub></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">pT<sub>1&nbsp;</sub></li>\n</ul>\n</td>\n<td style=\"width: 307.472px;\"><strong>Intravesical BCG</strong> is started after TURBT</td>\n</tr>\n<tr>\n<td style=\"width: 173px; text-align: left;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">pT<sub>2</sub></li>\n</ul>\n</td>\n<td style=\"width: 307.472px;\"><strong>Radical cystectomy</strong> followed by <strong>radiotherapy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 173px; text-align: left;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">pT<sub>3</sub></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">pT<sub>4</sub></li>\n</ul>\n</td>\n<td style=\"width: 307.472px;\">Neoadjuvant chemotherapy (M-VAC), radical cystectomy, and radiotherapy</td>\n</tr>\n</tbody>\n</table>\n<p><strong><br />M-VAC</strong> chemotherapy regime consists of:</p>\n<ul>\n<li>Methotrexate</li>\n<li>Vinblastine</li>\n<li>Adriamycin</li>\n<li>Cisplatin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with carcinoma in situ of the urinary bladder is posted for intravesical therapy. What is the strain of mycobacteria that will be used in this therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Mycobacterium bovis"
      },
      {
        "id": 2,
        "text": "Mycobacterium tuberculosis"
      },
      {
        "id": 3,
        "text": "Mycobacterium canettii"
      },
      {
        "id": 4,
        "text": "Mycobacterium indicus pranni"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An attenuated strain of <em><strong>Mycobacterium bovis</strong></em> is used in <strong>intravesical BCG therapy.</strong></p>\n<p>Intravesical BCG is used for the treatment of <strong>non-invasive</strong> (no invasion into the muscle layer) urinary <strong>bladder tumors</strong>. It induces a strong local <strong>inflammatory response</strong> against the attenuated bacteria, which helps in the destruction of the tumor cells.</p>\n<p>Option d:<strong> Mw vaccine</strong> for <strong>multibacillary leprosy</strong> patients and their contacts is extracted from <strong><em>Mycobacterium indicus pranii</em></strong>. It&nbsp;is also used as an adjunct to chemotherapy for category II tuberculosis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which laser is preferred for performing transurethral resection of the bladder tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Carbon dioxide laser"
      },
      {
        "id": 2,
        "text": "Nd-YAG laser"
      },
      {
        "id": 3,
        "text": "Ho-YAG laser"
      },
      {
        "id": 4,
        "text": "Argon laser"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>Nd: YAG&nbsp;</strong>laser is preferred for the resection of minimally invasive <strong>bladder tumors</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly man on follow-up for treatment of bladder cancer presents with painless hematuria. Which of the following assays should be done on this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CA 19-9"
      },
      {
        "id": 2,
        "text": "Carcinoembryonic antigen"
      },
      {
        "id": 3,
        "text": "Thymidine kinase"
      },
      {
        "id": 4,
        "text": "NMP 22"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>An<strong> NMP 22</strong>&nbsp;assay should be done in this patient to detect the <strong>recurrence of bladder carcinoma</strong>.&nbsp;</p>\n<p>NMP 22 is a nuclear matrix protein that is used to form cell nuclei. It is shed into the urine and has a higher concentration in the urine of bladder cancer patients.&nbsp;NMP-22 cutoff levels for bladder cancer detection is <strong><span style=\"text-decoration: underline;\">&gt;&nbsp;</span>10 units/mL.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Urinary diversion is indicated in all the following clinical conditions, except:",
    "choices": [
      {
        "id": 1,
        "text": "Ectopia vesicae"
      },
      {
        "id": 2,
        "text": "Carcinoma bladder"
      },
      {
        "id": 3,
        "text": "Neurogenic bladder"
      },
      {
        "id": 4,
        "text": "Bladder hematoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Urinary diversion is <strong>not</strong> done in cases of bladder hematoma.&nbsp;</p>\n<p><strong>Urinary diversion</strong> procedures are performed to divert urine from the bladder to a new exit site. It is of two types:</p>\n<ul>\n<li><strong>Cutaneous urinary diversion</strong> (External diversion): Urine drains through an opening created in the abdominal wall and skin\n<ul>\n<li><strong>Ileal conduit -&nbsp;</strong>urine is diverted by implanting ureters into a <strong>loop of ileum</strong> that is led out through the abdominal wall.</li>\n<li><strong>Cutaneous ureterostomy -</strong>&nbsp;ureters are directed through the abdominal wall and attached to an <strong>opening in the skin</strong>.</li>\n</ul>\n</li>\n<li><strong>Continent urinary diversion</strong> (Internal urinary diversion): A portion of the intestine is used to create a new reservoir for urine. The internal pouch is placed inside the abdomen. The ureters are attached to the internal pouch, and the internal pouch is attached to the urethra or to a stoma in the abdomen with a valve.</li>\n</ul>\n<p><strong>Indications</strong> of urinary diversion:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Post cystectomy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Carcinoma of the urinary bladder</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Distal obstruction</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Neurogenic bladder</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ectopia vesicae, Incurable fistula</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Irremovable obstruction</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Trauma to the ureters and urethra</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d7104355e2504f61be486886d460ce12x1280x2886.JPEG"
    ]
  },
  {
    "text": "A patient presents to the emergency department with confusion and drowsiness. He underwent cystectomy with urinary diversion for bladder carcinoma 8 weeks back. ABG analysis and electrolyte values are given below. Which of the following urinary diversion conduits was most likely done in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Stomach"
      },
      {
        "id": 2,
        "text": "Jejunum"
      },
      {
        "id": 3,
        "text": "Ileum"
      },
      {
        "id": 4,
        "text": "Sigmoid colon"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 1475\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>A <strong>uretero-sigmoid diversion</strong>\u00a0was most likely done in this patient as it frequently results in <strong>hyperchloremic hypokalemic acidosis. </strong>Hypokalemia is less common with ileal diversions because the ileum reabsorbs some of the potassium from the urine while the colon does not.</p>\n<p>The order in which the hyperchloraemic hypokalemic acidosis occurs is sigmoid colon &gt; colon/ileum.</p>\nElectrolyte abnormalities based on the part of intestine involved:</div>\n<div class=\"column\">\u00a0</div>\n<div class=\"column\">\n<table style=\"width: 515px; height: 118px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 171.406px; height: 36px;\"><strong>Stomach\u00a0\u00a0</strong></td>\n<td style=\"width: 207.594px; height: 36px;\"><strong>Jejunum</strong></td>\n<td style=\"width: 270px; height: 36px;\"><strong>Ileum/colon</strong></td>\n</tr>\n<tr style=\"height: 16.2396px;\">\n<td style=\"width: 171.406px; height: 16.2396px;\">Hypokalemia \u00a0</td>\n<td style=\"width: 207.594px; height: 16.2396px;\">Hyperkalemia</td>\n<td style=\"width: 270px; height: 16.2396px;\">Hypokalemia</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 171.406px; height: 18px;\">Hypochloremia</td>\n<td style=\"width: 207.594px; height: 18px;\">Hypochloremia</td>\n<td style=\"width: 270px; height: 18px;\">Hyperchloremia</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 171.406px; height: 18px;\">Metabolic alkalosis</td>\n<td style=\"width: 207.594px; height: 18px;\">Metabolic acidosis</td>\n<td style=\"width: 270px; height: 18px;\">Metabolic acidosis\u00a0</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df8b617cdec140d9bbdd3f8e3570e11ex1280x2886.JPEG"
    ]
  },
  {
    "text": "A 35-year-old lady experiences increased frequency of urination and lower abdominal pain which is relieved by micturition. Urinalysis is normal. Cystoscopy reveals fissures and punctate hemorrhages in the bladder mucosa. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Interstitial cystitis"
      },
      {
        "id": 2,
        "text": "Malakoplakia"
      },
      {
        "id": 3,
        "text": "Tuberculosis bladder"
      },
      {
        "id": 4,
        "text": "Cystitis cystica"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Treatment options include :</p>\n<ul>\n<li>Conservative - Patient education about the chronicity of the condition, <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>behavioral modification</strong> (timed voiding, bladder training), </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">stress reduction, dietary alteration (avoidance of caffeine and </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">spicy and acidic foods) and physical therapy should be the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">initial management for all patients.</span></li>\n<li>Pharmacological - Neuropathic analgesics (e.g. <strong>amitriptyline, pregabalin</strong>) are used for those with a significant pain component, whereas <strong>antimuscarinics</strong> and <strong>\u03b23-agonists</strong> are used for frequency, nocturia and urgency symptoms.</li>\n<li>Surgical -\u00a0For those with Hunner lesions, <strong>fulguration</strong> or <strong>laser</strong> to these lesions can be beneficial. <strong>Cystodistension</strong> as a treatment has variable evidence for success. If these options fail to improve symptoms major surgical reconstruction can be considered in selected cases.</li>\n</ul>\n<p>Option b: <strong>Malakoplakia</strong> is a distinct form of inflammatory reaction seen in <strong>chronic cystitis</strong>. It appears as soft, yellow, slightly raised mucosal plaques.</p>\n<p>Option d: <strong>Cystitis cystica</strong> occurs due to chronic irritation of the bladder mucosa. Cystoscopy reveals cystic lesions in the bladder.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e67a646b32a44f2c9d707ab182567c90x720x748.JPEG"
    ]
  },
  {
    "text": "A child with recurrent urinary tract infection undergoes voiding cystourethrogram. It shows reflux of urine into the pelvis and calyces, without dilation of the ureter. What is the grade of vesicoureteric reflux?",
    "choices": [
      {
        "id": 1,
        "text": "Grade II"
      },
      {
        "id": 2,
        "text": "Grade I"
      },
      {
        "id": 3,
        "text": "Grade III"
      },
      {
        "id": 4,
        "text": "Grade IV"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 4172\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Reflux of urine into pelvis and calyces without dilatation is<strong> Grade II</strong> vesicoureteric reflux (VUR).</p>\n<p>VUR is the retrograde flow of urine from the bladder to the upper urinary tract. VUR is a common clinical entity. The<strong> investigation of choice</strong> for VUR is<strong> micturating cystourethrogram (MCU)</strong>.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1425\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>VUR is graded as follows:</p>\n</div>\n</div>\n</div>\n</div>\n<table style=\"height: 212px; width: 387px;\">\n<tbody>\n<tr>\n<td style=\"width: 62px; text-align: center;\"><strong> &nbsp;GRADE</strong></td>\n<td style=\"width: 308px; text-align: center;\"><strong>DESCRIPTION</strong></td>\n</tr>\n<tr>\n<td style=\"width: 62px; text-align: left;\">I</td>\n<td style=\"width: 308px;\">Reflux into a non-dilated ureter</td>\n</tr>\n<tr>\n<td style=\"width: 62px; text-align: left;\">II</td>\n<td style=\"width: 308px;\">Reflux into the pelvis and calyces without dilatation of the ureter</td>\n</tr>\n<tr>\n<td style=\"width: 62px; text-align: left;\">III</td>\n<td style=\"width: 308px;\">Reflux is associated with mild to moderate dilatation of the ureter, renal pelvis,&nbsp;and calyces, with minimal blunting of the fornices</td>\n</tr>\n<tr>\n<td style=\"width: 62px; text-align: left;\">IV</td>\n<td style=\"width: 308px;\">Moderate ureteral tortuosity and dilatation of the pelvis and calyces</td>\n</tr>\n<tr>\n<td style=\"width: 62px; text-align: left;\">V</td>\n<td style=\"width: 308px;\">Gross dilatation of the&nbsp;ureter, pelvis,&nbsp;and calyses; loss of papillary impressions; ureteral&nbsp; tortuosity</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d076d2a289a47e0866fc5bca3fdd732x1064x2464.JPEG"
    ]
  },
  {
    "text": "Which of the following will be seen in a patient with Marion\u2019s disease?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertrophy of the internal sphincter of the bladder"
      },
      {
        "id": 2,
        "text": "Hypertrophy of the external sphincter of the bladder"
      },
      {
        "id": 3,
        "text": "Congenital obstruction of the prostatic urethra"
      },
      {
        "id": 4,
        "text": "Posterior urethral valve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hypertrophy of the internal sphincter of the bladder</strong> is seen in <strong>Marion&rsquo;s disease.</strong>&nbsp;This leads to bladder outlet obstruction. Its clinical features include voiding and storage symptoms (usually associated with BPH). Therefore it is also called prostatism sans prostate:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased urinary frequency</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Urgency</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dribbling of urine</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hesitancy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intermittent stream</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Nocturia</li>\n</ul>\n<p>It is commonly seen in young patients.</p>\n<p>Bladder outlet obstruction can occur due to 2 causes:</p>\n<ul>\n<li aria-level=\"1\"><strong>Muscular causes</strong>\n<ul>\n<li>Congenital hypertrophy of internal sphincter, i.e., Marion's disease</li>\n<li>Dyssynergic contraction of the smooth muscle of the bladder neck (bladder neck dyssynergia)</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Fibrosis</strong> of bladder neck following transurethral resection of the prostate (TURP)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true regarding the condition shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Bilateral in more than 50% of the cases"
      },
      {
        "id": 2,
        "text": "Associated with dysplastic renal tissue"
      },
      {
        "id": 3,
        "text": "Children usually present with stones"
      },
      {
        "id": 4,
        "text": "Affects males more often than females"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given&nbsp;intravenous urography (IVU) image depicts <strong>cobra head/adder head deformity</strong> which is a classic sign of ureterocele. It is associated with dysplastic renal tissue.</p>\n<p><strong>Ureterocele</strong>:</p>\n<p>A ureterocele is the cystic enlargement of the intramural ureter. It is thought to be caused due to ureteric orifice atresia. It is observed <strong>more in females </strong>than males in a 4:1 preponderance and is&nbsp;<strong>bilateral </strong>in about<strong> 10% </strong>of the cases. They are similar to ectopic ureters wherein the upper pole of the kidney is drained. This condition is typically <strong>associated with dysplastic and</strong> <strong>non-functional renal tissue</strong>.</p>\n<p>Clinical presentation:</p>\n<ul>\n<li><strong>Children</strong> with ureterocele usually present with <strong>infection.</strong></li>\n<li>Adults present with renal stones.</li>\n</ul>\n<p>Diagnosis:</p>\n<ul>\n<li>IVU shows a <strong>classical cobra head sign</strong> but is relatively infrequently performed these days.</li>\n<li>Cystoscopy shows a bulging, translucent swelling involving the ureteric orifice where there is urinary stasis. It is emptied by ureteric peristalsis.</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li>Surgical excision with re-implantation of the ureter is the treatment of choice for simple ureterocele.</li>\n<li>Renal stones associated with ureterocele are removed using an endoscopic incision</li>\n<li>An advanced disease that causes hydronephrosis or pyonephrosis is an indication for nephrectomy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b6ceffbeea1a438dabd3acd01d312c48.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding bladder stone is false?",
    "choices": [
      {
        "id": 1,
        "text": "Primary bladder stone develops in sterile urine"
      },
      {
        "id": 2,
        "text": "Cystine calculus  is radiolucent"
      },
      {
        "id": 3,
        "text": "Uric acid stones occur  in patients with ileostomies"
      },
      {
        "id": 4,
        "text": "Triple phosphate calculus  occurs in urine infected with urea-splitting organisms"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A<strong> cystine calculus</strong> occurs only in the<strong> presence of cystinuria</strong> and is<strong> radioopaque</strong> because of its high sulfur content.</p>\n<p><strong>Primary bladder stone</strong>:</p>\n<ul>\n<li>Develops in <strong>sterile urine</strong> in the absence of any known functional, anatomic, or infectious factors and does not necessarily imply that stones have formed de novo in the bladder.</li>\n<li><strong>Most common in children</strong> younger than 10 years of age</li>\n<li>Most vesical calculi are mixed</li>\n<li>Ammonium acid urate, calcium oxalate, uric acid, and calcium phosphate are the most common components of primary bladder calculi</li>\n</ul>\n<p><strong>Secondary bladder stone</strong>: Forms\u00a0during infection, due to bladder outflow obstruction, impaired bladder emptying, or the presence\u00a0of a foreign body.</p>\n<p><strong>Types:</strong></p>\n<ul>\n<li><strong>Calcium oxalate</strong> stones</li>\n<li><strong>Uric acid</strong> stones - occur in patients with<strong> gout</strong> but are also observed in patients with ileostomies or with bladder outlet obstruction</li>\n<li><strong>Cystine</strong> stones - in cystinuria</li>\n<li><strong>Triple phosphate</strong> stones - occur in urine infected with <strong>urea-splitting organisms</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '40 Urinary Bladder And Ureters';
        const quizFilename = '40-urinary-bladder-and-ureters-5f49566b.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>