<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 13- Ecgs Only - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is true about the heart rate in idioventricular rhythm?",
    "choices": [
      {
        "id": 1,
        "text": "More than 300 beats/minute"
      },
      {
        "id": 2,
        "text": "Less than 40 beats/minute"
      },
      {
        "id": 3,
        "text": "50 - 100 beats/minute"
      },
      {
        "id": 4,
        "text": "More than 100 beats/minute"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A heart rate of <strong>less than 40 beats/minute</strong> is consistent with <strong>idioventricular rhythm</strong>.\u00a0</p>\n<p><strong>Idioventricular rhythm</strong> occurs when <strong>both</strong> the <strong>sinoatrial</strong> node (SAN) and <strong>atrioventricular</strong> node (AVN) do not function. This leads to the <strong>Purkinje</strong> system taking over as a <strong>pacemaker</strong> to ensure ventricular contraction. The rate is usually less than 40 beats/minute.\u00a0</p>\n<p>Causes of idioventricular rhythm include electrolyte abnormalities, <strong>digitoxin</strong> toxicity, anesthetic agents, cocaine, and isoprenaline.\u00a0</p>\n<p>The usual findings of idioventricular rhythm include a heart rate of fewer than 40 beats per minute. The ECG may or may not have P waves. If there is a complete AVN block leading to sinus rhythm with idioventricular escape rhythm it will have P waves. Idioventricular rhythm without<strong>\u00a0P waves\u00a0</strong>is of poor prognosis. This usually proceeds a flat line.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option A - A heart rate of more than 300 beats/minute is seen in <strong>atrial flutter.</strong></p>\n<p>Option C - A heart rate of 50 - 100 beats per minute is seen in <strong>normal sinus rhythm</strong> and <strong>accelerated idioventricular rhythm</strong>.</p>\n<p>Option A - A heart rate of more than 100 beats/ minute is seen in <strong>sinus tachycardia</strong> and <strong>non-sustained ventricular tachycardia.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old female patient presents with palpitations, chest pain, and dizziness. Her heart rate is 135 beats/ minute. Her ECG strip is shown below. Which of the following treatment modalities is recommended for definitive treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Implantable cardioverter-defibrillator"
      },
      {
        "id": 2,
        "text": "Percutaneous coronary intervention"
      },
      {
        "id": 3,
        "text": "Radiofrequency catheter ablation"
      },
      {
        "id": 4,
        "text": "Coronary artery bypass grafting"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario and the ECG finding with delta waves suggest a diagnosis of&nbsp;<strong>Wolff-Parkinson-White syndrome (WPW)</strong>. The recommended treatment modality is <strong>radiofrequency catheter ablation </strong>of the accessory pathway.&nbsp;</p>\n<p>Wolf Parkinson White (WPW) is a type of <strong>preexcitation syndrome, i.e., </strong>abnormally early ventricular excitation, which in WPW, occurs via a <strong>bypass tract (Bundle of Kent)</strong>. Normally, there is a normal AV nodal delay to allow adequate ventricular filling. The bypass tract allows impulses to skip the nodal delay leading to preexcitation of the ventricles.&nbsp;In this syndrome, there is both <strong>preexcitation</strong> and <strong>delayed conduction</strong> leading to a <strong>shortened PR interval</strong> (&lt; 0.12 secs) and <strong>wide QRS</strong>. There is a characteristic <strong>delta</strong> <strong>wave</strong> notch in the QRS wave as seen in the picture.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a42f9de1ea649928de320a352274f13.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a54538a84204194805b28a6c94187a1x507x343.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/453384cea104422f97521f565676fd62x529x368.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male patient presented with severe retrosternal chest pain, sweating, and breathlessness for the last 20 minutes. His ECG is shown below. Which of the following treatment options is most appropriate for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Aspirin and ibuprofen"
      },
      {
        "id": 2,
        "text": "Cardioversion"
      },
      {
        "id": 3,
        "text": "Percutaneous coronary intervention"
      },
      {
        "id": 4,
        "text": "Coronary artery bypass grafting"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ECG with ST-segment elevation in leads II, III, and aVF is suggestive of an <strong>inferior wall myocardial infarction</strong>. The treatment option most appropriate for this patient is <strong>percutaneous coronary intervention</strong>\u00a0(PCI).</p>\n<p>Myocardial infarction (MI) occurs when there is an occlusion of one or more arteries supplying the heart. This leads to an imbalance between myocardial oxygen demand and supply, leading to myocardial ischemia and death.\u00a0</p>\n<p>Treatment of MI primarily involves <strong>control of discomfort</strong>, <strong>fibrinolysis</strong>, and <strong>reperfusion</strong> <strong>therapy</strong>. Reperfusion therapy includes both <strong>PCI</strong> and <strong>coronary artery bypass grafting</strong> (CABG).\u00a0</p>\n<p>In PCI, a <strong>stent</strong> or <strong>balloon</strong> is inserted into the occluded artery to restore blood flow. It is done under local anesthesia and mild sedation. In CABG, a <strong>vessel</strong> is <strong>grafted</strong> from a different part of the body and is used to restore blood flow by <strong>bypassing</strong> the <strong>occlusion</strong>. It is a <strong>surgical</strong> procedure. CABG is generally preferred for <strong>severe left main</strong> and <strong>three-vessel disease</strong>.\u00a0</p>\n<p>Reperfusion therapy should be done as soon as possible, within a few hours of the onset of symptoms. It has better short-term and long-term outcomes when compared to fibrinolysis alone.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option A - Aspirin and ibuprofen are given to patients with <strong>acute pericarditis</strong>.\u00a0</p>\n<p>Option B - Cardioversion is done in patients with <strong>atrial fibrillation.</strong></p>\n<p>Option D - Coronary artery bypass grafting is preferred in patients with\u00a0<strong>severe multivessel</strong><strong>\u00a0disease</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2920140e686b4d50b0493b62023d6c3f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The ECG of a 62-year-old hypertensive patient is as given below. What does his ECG show?",
    "choices": [
      {
        "id": 1,
        "text": "Left ventricular hypertrophy"
      },
      {
        "id": 2,
        "text": "Right ventricular hypertrophy"
      },
      {
        "id": 3,
        "text": "Acute myocardial infarction"
      },
      {
        "id": 4,
        "text": "Acute pericarditis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>His ECG shows<strong> left ventricular hypertrophy (LVH).\u00a0</strong></p>\n<p>In this patient, the height of the S wave in V1 is 25 and the R wave in V5 is 21. The sum of the two is 46.\u00a0</p>\n<p>ECG findings suggestive of LVH are as follows:\u00a0</p>\n<ul>\n<li>SV1 + [RV5 or RV6]\u00a0<strong>&gt;35mm</strong></li>\n<li>RaVL + SV3 <strong>&gt;20 mm</strong> in <strong>women</strong> and <strong>&gt;28 mm</strong> in <strong>men</strong></li>\n<li><strong>ST depression</strong> with <strong>T wave inversion\u00a0</strong></li>\n</ul>\n<p>The causes of LVH can be divided into <strong>pressure overload</strong> or <strong>volume overload</strong>. Examples of pressure overload are <strong>hypertension</strong> and <strong>aortic stenosis</strong> leading to <strong>concentric</strong> hypertrophy. Volume overload can occur due to <strong>valvular</strong>\u00a0<strong>regurgitation</strong> leading to <strong>ventricular</strong> <strong>dilation</strong>.\u00a0</p>\n<p>Pathological cardiac conditions leading to increased cardiac workload result in compensatory mechanisms to maintain perfusion and arterial pressure. They include <strong>increasing</strong> <strong>contractility</strong> and <strong>stroke</strong> <strong>volume</strong> (Frank-Starling law), <strong>activation</strong> of <strong>neurohormonal</strong> systems like the renin-angiotensin-aldosterone system, and release of hormones like norepinephrine and atrial natriuretic peptide. Myocardial adaptations can also occur resulting in <strong>cellular</strong> <strong>hypertrophy</strong> of the myocytes.\u00a0</p>\n<p>LVH occurs due to increased mechanical work. However, the increased muscle mass has <strong>increased</strong> <strong>metabolic</strong> <strong>demands</strong> as well leading to a further <strong>increase</strong> in <strong>oxygen</strong> <strong>demand</strong>. This makes patients with LVH susceptible to <strong>ischemia</strong> and <strong>heart</strong> <strong>failure</strong>.\u00a0</p>\n<p>Other options:</p>\n<p>Option B - Right ventricular hypertrophy is characterized by <strong>tall R waves</strong> in <strong>lead V1,</strong> where R is bigger than the S wave, right axis deviation. ST depression and T wave inversion in right to mid-precordial leads can be present.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2cbaa27a61f8420b94a04edfe1588182.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old unresponsive male patient is brought to the hospital. He is pulseless and is not breathing. His lead II ECG rhythm strip is shown in the image below. What is the treatment for the given ECG abnormality?",
    "choices": [
      {
        "id": 1,
        "text": "Defibrillation"
      },
      {
        "id": 2,
        "text": "Magnesium sulphate"
      },
      {
        "id": 3,
        "text": "Synchronised cardioversion"
      },
      {
        "id": 4,
        "text": "Rate control"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ECG with no identifiable P wave, QRS complexes, and irregular rhythm is\u00a0<strong>ventricular fibrillation </strong>(VF)\u00a0and the treatment is<strong> defibrillation.\u00a0</strong></p>\n<p>Ventricular fibrillation is a <strong>disorganized ventricular rhythm</strong>. In a heart with ventricular fibrillation, there is <strong>little to\u00a0no cardiac output </strong>as there is\u00a0irregular cardiac contraction. In patients outside the hospital, sustained ventricular tachycardias are a common cause leading to ventricular fibrillation.</p>\n<p>VF is a <strong>shockable</strong> <strong>rhythm.\u00a0</strong>Thus, defibrillation must be performed in order to restore normal sinus rhythm according to advanced cardiac life support (ACLS) guidelines.\u00a0In defibrillation, an electrical current is passed into the myocardium which 'resets' it by converting the dysrhythmia into a normal sinus rhythm.\u00a0</p>\n<p>When the timing of <strong>electric current</strong> is adjusted according to the<strong> R waves </strong>or the <strong>QRS complex</strong> of the cardiac cycle, it is known as <strong>synchronized shock</strong>, which is administered in\u00a0<strong>cardioversion</strong>. In <strong>ventricular fibrillation</strong>, because of irregular cardiac electrical activity, there are no R waves or QRS complexes to which the cardioversion can be synchronized. Hence, it is administered <strong>unsynchronized</strong> to the cardiac cycle.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/051018b6e7b54dd5bdbe869108b99453.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a5c6dc40249847619f591f4b73697477x1280x654.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3bd02263e48f4c4397dc8d9432d7e288x918x523.JPEG"
    ]
  },
  {
    "text": "ECG changes in which of the following leads is consistent with a lateral wall myocardial infarction?",
    "choices": [
      {
        "id": 1,
        "text": "V1 - V4"
      },
      {
        "id": 2,
        "text": "I, aVL, V5, V6"
      },
      {
        "id": 3,
        "text": "II, III, aVF"
      },
      {
        "id": 4,
        "text": "V7 - V9"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>ECG changes in\u00a0<strong>I, aVL, V5, V6</strong>\u00a0are consistent with <strong>lateral\u00a0wall</strong> myocardial infarction.</p>\n<p>Myocardial infarction (MI) occurs when there is severe cardiac muscle ischemia. Severe, acute ischemia causes a change in the <strong>membrane potential</strong> which <strong>shortens the duration </strong>of the<strong> action potential</strong>. This creates a voltage gradient between the normal myocardium and ischemic myocardium causing a flow of current between the two.\u00a0</p>\n<p>This altered flow of current manifests as <strong>changes in the ST segment</strong>, which represents ventricle repolarization. The change in the ST segment depends on the part of the myocardium involved. If it is confined to the <strong>endocardium</strong>, it results in <strong>ST-segment depression</strong> as the ST segment shifts towards the ventricle. If the ischemia is <strong>transmural</strong>, the <strong>ST segment</strong> is <strong>elevated</strong>. There are also <strong>hyperacute T waves</strong>. This is because the ST vector shifts towards the outer layers.\u00a0</p>\n<p>The ECG leads are position-specific and thus ST-segment changes in certain leads can help us <strong>localize the infarction</strong>.\u00a0</p>\n<table style=\"height: 24px; width: 333.891px;\">\n<tbody>\n<tr>\n<td style=\"width: 168px;\">Lead</td>\n<td style=\"width: 147.891px;\">Location</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\"><em>Standard leads</em></td>\n<td style=\"width: 147.891px;\">\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\">II, III, aVF</td>\n<td style=\"width: 147.891px;\">Inferior wall \u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\">V1 - V4</td>\n<td style=\"width: 147.891px;\">Anterior wall \u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\">I, aVL, V5, V6</td>\n<td style=\"width: 147.891px;\">Lateral wall</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\"><em>Non-standard leads</em></td>\n<td style=\"width: 147.891px;\">\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\">V1R - V6R</td>\n<td style=\"width: 147.891px;\">Right ventricle</td>\n</tr>\n<tr>\n<td style=\"width: 168px;\">V7 - V9</td>\n<td style=\"width: 147.891px;\">Posterior wall</td>\n</tr>\n</tbody>\n</table>\n<p>Other options:\u00a0</p>\n<p>Option A - Changes in\u00a0<strong>V1 - V4</strong> are seen in anterior wall MIs.</p>\n<p>Option C - Changes in\u00a0<strong>II, III, and aVF</strong>\u00a0are seen in inferior wall MIs.</p>\n<p>Option D - Changes in\u00a0<strong>V7 - V9</strong> are seen in posterior wall MIs. This is often missed as the standard ECGs do not have leads V7-V9.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old patient is assessed with an ECG during his wellness check-up visit. Calculate the heart rate from the ECG given below.",
    "choices": [
      {
        "id": 1,
        "text": "100/min"
      },
      {
        "id": 2,
        "text": "90/min"
      },
      {
        "id": 3,
        "text": "79/min"
      },
      {
        "id": 4,
        "text": "68/min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The RR interval has 19 small boxes in between, and hence the heart rate is 1500/19~<strong>79/min</strong>.</p>\n<p>The relationship between the heart rate and the RR interval is given by:\u00a0</p>\n<p>Heart rate = 1500/(number of small boxes in between successive R waves)\u00a0</p>\n<p>Methods to calculate heart rate from ECG:\u00a0</p>\n<p><strong>Box counting</strong> methods: This can be done via the number of small boxes or the large boxes between two successive R waves. If using the large boxes, the equation is \u00a0</p>\n<p>Heart rate = 300/(number of large boxes in between successive R waves)\u00a0</p>\n<p><strong>QRS counting</strong> methods: This is used when the heart rate is irregular. Thus there will be a variability in the RR intervals, making the box-counting method unreliable. Here, the number of QRS intervals in a set interval, for example, 10 seconds, is counted. This number is then multiplied by an appropriate factor to get an estimate for 60s. In this example, we would multiple the number of QRS complexes in 10s by 6.\u00a0</p>\n<p>Tachycardia is defined as a heart rate of more than 100 beats/minute and bradycardia is defined as a heart rate of less than 60 beats/minute.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68cccb471dc140e7ac2835a39586c201.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df69cba4696441aea55b5534366ea884x800x224.JPEG"
    ]
  },
  {
    "text": "The ECG given below shows:",
    "choices": [
      {
        "id": 1,
        "text": "A prolonged PR interval measuring 240 ms"
      },
      {
        "id": 2,
        "text": "A normal PR interval measuring 240 ms"
      },
      {
        "id": 3,
        "text": "A prolonged PR interval measuring 160 ms"
      },
      {
        "id": 4,
        "text": "A normal PR interval measuring 160 ms"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given ECG shows a\u00a0<strong>prolonged PR interval</strong> measuring <strong>240 msec</strong>.</p>\n<p>The given ECG shows a PR interval measuring 6 small boxes. One small box represents 0.04 sec. Therefore,\u00a06 boxes is 6*0.04 sec = 0.240 sec or 240 msec.\u00a0</p>\n<p>The PR interval is measured from the <strong>beginning</strong> of the <strong>P wave</strong> to the <strong>beginning</strong> of the <strong>QRS</strong> <strong>complex</strong>.\u00a0The normal PR interval is <strong>120-200ms</strong>.</p>\n<p>The image below represents the <strong>PR interval</strong>:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/632eb72a256b4e4d816dacf5cd3a21da.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd4026692f9c46439df32a139601af27x115x173.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man comes to the clinic with complaints of palpitations. He is diagnosed with tachyarrhythmia. He is started on a drug that resolves his arrhythmia. ECG taken 3 days after starting medication appears as below, with QTc = 477 ms. Which of the following drugs is the most likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Lignocaine"
      },
      {
        "id": 2,
        "text": "Procainamide"
      },
      {
        "id": 3,
        "text": "Magnesium sulfate"
      },
      {
        "id": 4,
        "text": "Propranolol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient has a QTc\u00a0of 477 ms which<strong>\u00a0</strong>indicates <strong>QT prolongation</strong> on taking the drug (normal QT- &lt; 440 ms in males). Among the given options, QT prolongation is seen with <strong>procainamide</strong>, a Class 1A anti-arrhythmic drug.</p>\n<p>A QT interval is slowed by a decreased heart rate. A QTc (corrected QT interval) is calculated as\u00a0<strong>QT/\u221aRR</strong>, to remove the effect of HR. Normal QTc is about 440 ms. Values of<strong>\u00a0more than</strong>\u00a0<strong>440 ms in males</strong>\u00a0and\u00a0<strong>450 ms in females</strong>\u00a0are considered to be prolonged.</p>\n<p>A QT prolongation can\u00a0<strong>present as syncope</strong>\u00a0or cardiac arrest. Prompt\u00a0<strong>intravenous</strong>\u00a0administration of\u00a0<strong>1-2mg magnesium sulfate</strong>\u00a0is needed. It gives time to correct electrolyte imbalances and<strong> remove the offending agent</strong>.</p>\n<p>Other anti-arrhythmic drugs associated with QT prolongation i.e (Class 1A and Class 3):</p>\n<ul>\n<li>Sotalol</li>\n<li>Amiodarone</li>\n<li>Quinidine</li>\n<li><strong>Procainamide</strong></li>\n<li>Dofetilide</li>\n<li>Ibutilide</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fd3009b84cec4f38ae75739412fd9c32.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is/are correct with respect to the cardiac cycle, heart sounds, and the waveforms seen on the ECG?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 3"
      },
      {
        "id": 2,
        "text": "1 and 4"
      },
      {
        "id": 3,
        "text": "1, 2, and 4"
      },
      {
        "id": 4,
        "text": "1, 2, and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The statements<strong>\u00a01, 2, and 3\u00a0</strong>are correct.</p>\n<p>As clear from Wigger's diagram below, S1 corresponds the timing of S1 heart sound corresponds temporally to the occurrence of QRS wave in ECG.</p>\n<p>Similarly, the timing of the S2 heart sound corresponds to the end of the T wave in ECG.\u00a0</p>\n<p>The statement D is incorrect as the\u00a0<strong>\u2018c\u2019 wave of JVP </strong>is seen during the<strong>\u00a0isovolumetric contraction </strong>(with all valves closed)<strong>\u00a0</strong>phase<strong>\u00a0</strong>when the ventricular muscle continues to contract.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c11ba5e94b749528b9e51f2fefad15ex783x600.PNG"
    ]
  },
  {
    "text": "A 45-year-old male patient presents with unresponsiveness, no breathing or palpable pulse. He has the following ECG findings.  Which is the next step of management indicated in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Chest compression"
      },
      {
        "id": 2,
        "text": "Defibrillation"
      },
      {
        "id": 3,
        "text": "Cardioversion"
      },
      {
        "id": 4,
        "text": "Adenosine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The next step of management indicated in this patient is <strong>chest compression</strong>.\u00a0</p>\n<p>Chest compressions are indicated in patients with asystole and pulseless electrical activity (PEA). PEA refers to any electrical activity on ECG in a patient without a pulse.</p>\n<p>This patient presented with cardiac arrest and the ECG shows asystole (flatline/ lack of electrical activity). This is not a shockable rhythm.\u00a0Management involves the initiation of chest compressions and administering epinephrine. Chest compression should be continued for two minutes, following which pulse is reassessed. If it is still not palpable, chest compressions should be continued again for another two minutes. Epinephrine can be administered every 3-5 minutes.</p>\n<p>It is important to confirm asystole on the ECG by monitoring other leads or changing the electrode panels by 90 degrees to look at the electrical activity on a different plane.\u00a0</p>\n<p>In most cases, asystole is irreversible.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5fb3472caa304a6bbf2a8501c35cf3a8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a784cf55926a47f881100de4ba60ed99x1280x3641.JPEG"
    ]
  },
  {
    "text": "Which of the following conditions is associated with the abnormality depicted in the given ECG?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Chronic obstructive pulmonary disease"
      },
      {
        "id": 3,
        "text": "Type-1 atrioventricular block"
      },
      {
        "id": 4,
        "text": "Dextrocardia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given ECG shows inverted P waves, negative QRS in lead I, and reversal of normal r wave progression. The condition associated with these findings is <strong>dextrocardia</strong>.\u00a0</p>\n<p>Dextrocardia is the<strong> </strong>abnormal position of the heart on the right side of the chest or in the midline. It may be seen as an isolated condition\u00a0or as a part of\u00a0<strong>situs inversus</strong>, where the other organs are also inverted in position. Situs inversus is associated with <strong>Kartagener's syndrome </strong>(a triad of situs inversus, chronic sinusitis, and bronchiectasis).\u00a0</p>\n<p>Findings suggestive of dextrocardia:</p>\n<ul>\n<li><strong>Inverted P waves</strong> in Lead I and aVL</li>\n<li><strong>Negative QRS complex</strong> and T wave in Lead I</li>\n<li>Lead I: inversion of all complexes, aka \u2018global negativity\u2019 i.e. inverted P wave, negative QRS, inverted T wave</li>\n<li><strong>Reversal of normal r-wave progression</strong> across the precordium</li>\n</ul>\n<p>Most patients are <strong>asymptomatic</strong>. Some may present with varying symptoms due to other coexisting congenital diseases.\u00a0</p>\n<p>Other options:</p>\n<p>Option A -\u00a0Cardiac tamponade would present with <strong>reduced amplitude </strong>of the<strong> QRS</strong> complexes and <strong>electrical alternans</strong> on the ECG.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aaafc8e65b7b4c888043ed6bf25503ee.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b302fa75a094caa993fab04263ec02dx1280x615.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c1a5170536d74c6eaf5467bbbb124efcx765x417.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b64a2f12a3e9488199dc6a12761aa4e1x1280x609.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a finding you would expect to see in a patient with a left bundle branch block?",
    "choices": [
      {
        "id": 1,
        "text": "RSR\u2019 pattern in V1-V2"
      },
      {
        "id": 2,
        "text": "QRS duration of\u00a0> 120ms"
      },
      {
        "id": 3,
        "text": "Dominant S wave in V1"
      },
      {
        "id": 4,
        "text": "Broad monophasic R wave in V5-V6"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>RSR</strong>\u2019 pattern in\u00a0<strong>V1-3\u00a0</strong>is seen in the case of the right bundle branch block <strong>(RBBB)</strong>, not the left bundle branch block (LBBB).\u00a0</p>\n<p><strong>ECG </strong>findings suggestive of<strong> LBBB:</strong></p>\n<ul>\n<li>QRS duration of &gt;120 ms\u00a0</li>\n<li>Dominant S wave in V1 with loss of R wave</li>\n<li>Notched R wave and no Q wave in V6</li>\n</ul>\n<p>The below image shows the characteristic changes in <strong>LBBB</strong>:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5416ed160a441af8eca9ffd4d1521c5x222x196.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d044a91a6135485899389f185248b6c5x218x200.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e56c0b5b545e4b3b9afc6c5d0fe2fdb1x1279x594.JPEG"
    ]
  },
  {
    "text": "A 57-year-old male patient presents with a heart rate of 45 beats/minute and blood pressure of 70/40 mmHg. According to the ACLS criteria, what is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "A single dose of atropine"
      },
      {
        "id": 2,
        "text": "Transcutaneous pacing"
      },
      {
        "id": 3,
        "text": "Dopamine infusion"
      },
      {
        "id": 4,
        "text": "Epinephrine infusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario is that of <strong>bradycardia</strong>&nbsp;and according to the ACLS criteria, the next best step in the management of this patient is the administration of&nbsp;<strong>a single dose of atropine</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 3217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Bradycardia</strong> is defined as a heart rate of less than 60 beats/ min. Those who present with bradycardia should be first <strong>stabilized</strong> with the following:</p>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li>Maintain patient airway and breathing</li>\n<li>Administer <strong>oxygen</strong> if breathlessness is present</li>\n<li><strong>Cardiac</strong> <strong>monitor</strong> and blood pressure to be monitored with oximetry</li>\n<li><strong>IV</strong> <strong>access</strong> to be placed</li>\n<li>12 lead ECG done&nbsp;</li>\n</ul>\n<p>Following the initial stabilization, the patient should be checked for <strong>hypotension</strong>, altered mental status, signs of shock, angina, and acute heart failure. If none are present, then the patient can be monitored. If any of the above are present, then <strong>atropine</strong> <strong>0.5 mg</strong> must be administered. This must be <strong>repeated</strong> <strong>every</strong> <strong>3-5 minutes</strong> up to a <strong>maximum</strong> dose of <strong>3mg</strong>.&nbsp;Atropine <strong>inhibits</strong> the <strong>muscarinic</strong> effects of the <strong>parasympathetic</strong> <strong>nervous system</strong>.</p>\n<p>If the maximum dose of atropine has been administered and there is no response, then the next step is to initiate <strong>one of the following</strong>:&nbsp;</p>\n<ul>\n<li><strong>Transcutaneous pacing</strong> (Option B) OR</li>\n<li><strong>Dopamine infusion</strong> at 5-20 mcg/minute (Option C) OR</li>\n<li><strong>Epinephrine infusion</strong> at 2-10 mcg/minute&nbsp;(Option D)</li>\n</ul>\n<p>If the patient is not responding to treatment then expert consultation and transvenous pacing must be done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 47-year-old male patient presents with retrosternal chest pain. On auscultation, a pericardial friction rub is present. Echocardiography reveals a small amount of pericardial fluid. The ECG is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Myocardial infarction"
      },
      {
        "id": 2,
        "text": "Acute pericarditis"
      },
      {
        "id": 3,
        "text": "Cardiac tamponade"
      },
      {
        "id": 4,
        "text": "Pulmonary embolism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely diagnosis in this patient with widespread ST elevation is\u00a0<strong>acute pericarditis.</strong></p>\n<p>Acute pericarditis is an inflammation of the pericardium characterized by <strong>retrosternal chest pain</strong> that is aggravated by deep inspiration and supine position and relieved by sitting and leaning forward. It can be attributed to various causes like infections or inflammatory conditions like RA and SLE, or miscellaneous causes like iatrogenic, neoplasms, drugs, etc.</p>\n<p>On auscultation, 85% of patients have a <strong>pericardial friction rub</strong>. This appears as a <strong>rough scratching sound</strong> at end of expiration when the patient is sitting and leaning forward.\u00a0</p>\n<p>ECG findings of acute pericarditis need to be differentiated from those of myocardial infarction as they are similar.</p>\n<p>There are four stages in the development of acute pericarditis ECG changes.</p>\n<ul>\n<li>Stage 1: <strong>Widespread elevation of ST segments</strong>; depression of PR segment below the TP segment</li>\n<li>Stage 2: ST segments return to normal after a few days</li>\n<li>Stage 3: T waves become inverted</li>\n<li>Stage 4: ECG returns to normal after weeks or months</li>\n</ul>\n<p>Echocardiography is diagnostic for acute pericarditis. It would reveal a small amount of pericardial fluid. It can also be confirmed by CT or MRI.\u00a0</p>\n<p>Treatment of acute pericarditis is nonspecific. Non-steroidal anti-inflammatory drugs\u00a0are recommended, along with bed rest.</p>\n<p>Other options:</p>\n<p>Option A - Myocardial infarction would not have a pericardial friction rub. In addition, the <strong>ST changes</strong> would be <strong>localized</strong> to a specific area but in pericarditis, there are widespread changes. They would also be more prominent elevations.</p>\n<p>Option C - Cardiac tamponade is characterized by <strong>Beck's triad</strong> of hypotension, jugulo-venous distension, and muffled heart sounds. None of these are present in this patient.\u00a0</p>\n<p>Option D - Pulmonary embolism would be characterized by <strong>tachycardia, inverted T waves </strong>(right ventricular overload) in leads V1 - V4, and <strong>S1Q3T3</strong> pattern would be seen.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b01b12d3b0644e3c9dbcc3a2d4045d22.JPG"
    ],
    "explanation_images": []
  },
  {
    "text": "In a normal ECG, which among the following leads would show R wave with maximal positive height?",
    "choices": [
      {
        "id": 1,
        "text": "V4"
      },
      {
        "id": 2,
        "text": "V1"
      },
      {
        "id": 3,
        "text": "aVR"
      },
      {
        "id": 4,
        "text": "V2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a normal ECG, an <strong>R wave</strong> of <strong>maximal positive height</strong> is seen in lead <strong>V4 or V5</strong>.\u00a0</p>\n<p>The QRS has different morphology across the chest leads because of their position on the chest wall. The relationship between the direction of vectors and the precordial leads determines the height of the R wave. This is characterized by an<strong> increase in the height of the R wave</strong> from V1 to V6.</p>\n<p>Ventricular depolarization consists of two phases of depolarization: <strong>\u00a0</strong></p>\n<p><strong>Interventricular septum</strong>-</p>\n<ul>\n<li>The first phase is a short (&lt; 0.04 s) depolarization of the interventricular septum. It begins with a branch of the bundle of His on the <strong>left</strong> side of the septum. This causes the vector to go from the <strong>left side to the right and anteriorly</strong>.\u00a0\u00a0</li>\n<li>During the first phase, there is a small R wave (positive deflection) in lead V1, gradually altering, across the precordial leads, to a small Q wave (negative deflection) in lead V6.</li>\n</ul>\n<p><strong>Ventricular mass</strong>-\u00a0</p>\n<ul>\n<li>The second wave involves <strong>simultaneous</strong> depolarization of <strong>both</strong> the <strong>ventricles</strong>. The left ventricle contains more muscle mass so the vector points towards the <strong>left and posteriorly</strong>.</li>\n<li>In the second phase, there is a deep S wave (negative deflection) in lead V1, gradually altering to an R wave (positive deflection) in lead V6.\u00a0</li>\n</ul>\n<p>This changing QRS morphology from lead V1 to V6 is termed <strong>R wave progression</strong>.</p>\n<p>R wave of maximal positive height in\u00a0<strong>lead V4 </strong>and<strong> V5</strong>, as seen in the image below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cceeaaa3debf474990e3d7f96258eaa0x1151x774.JPEG"
    ]
  },
  {
    "text": "A 70-year-old man with a history of ischemic heart disease presents with palpitations for the last 3 days. A transesophageal echo shows a thrombus in the left atrium. His ECG is shown below. Which of the following should be done to treat his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Initiate anticoagulation"
      },
      {
        "id": 2,
        "text": "Initiate beta blockers"
      },
      {
        "id": 3,
        "text": "Initiate digoxin"
      },
      {
        "id": 4,
        "text": "Initiate cardioversion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario along with ECG showing \u00a0<strong>irregular RR intervals </strong>with <strong>absent P waves</strong> is suggestive of <strong>atrial fibrillation</strong>. His <strong>CHA2DS2-VASc</strong> score is <strong>2</strong> (history of ischemic heart disease and age of 70), he is symptomatic for &gt; 48 hours, and there is presence of a left atrial thrombus thus requiring <strong>initiation</strong> <strong>of</strong> <strong>anticoagulation</strong>.\u00a0\u00a0</p>\n<div class=\"page\" title=\"Page 7041\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The major source of <strong>thromboembolism</strong> and <strong>stroke</strong> in AF is the formation of <strong>thrombus</strong> in the <strong>left atrial appendage</strong> due to stagnant flow. Hence thromboembolism must be prevented by giving anticoagulants, along with an appropriate rate/rhythm control strategy with the help of electrical or pharmacologic cardioversion.\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n<p>The treatment of atrial fibrillation depends on three things: the duration of symptoms, the severity of symptoms, and the risk of stroke. The patients who present <strong>within 48 hours</strong> of the onset of symptoms have a lower risk of an existing atrial thrombus and can be safely cardioverted. Those who present with unknown or known onset of <strong>more than 48 hours</strong> should ideally be <strong>anticoagulated before cardioversion</strong>. This can be done in 2 ways as shown below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d195546260114ee681acc883c2f8514b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d2aabb966631485da12618f45b0bdc8fx1280x2207.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65affbb2429a470b9d5ebb1469a0b9f0x1280x2221.JPEG"
    ]
  },
  {
    "text": "A 57-year-old female patient with end-stage kidney disease comes for a follow-up. An ECG is done which is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypokalemia"
      },
      {
        "id": 2,
        "text": "Hyperkalemia"
      },
      {
        "id": 3,
        "text": "Hypercalcemia"
      },
      {
        "id": 4,
        "text": "Hypocalcemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ECG shows tall, peaked T waves and loss of P waves. These findings and the clinical scenario suggest the likely diagnosis of\u00a0<strong>hyperkalemia</strong>.</p>\n<p>Hyperkalemia is defined as a serum potassium level of more than <strong>5.5 mEq/L.</strong>\u00a0</p>\n<p>Hyperkalemia is a dangerous electrolyte abnormality that can cause drastic conduction changes. It can be diagnosed by a sequence of changes affecting the <strong>ST-T segments</strong> and <strong>QRS complex</strong>. ST-T segment changes reflect a change in <strong>repolarization</strong> while QRS complex changes reflect a change in <strong>depolarization</strong>.</p>\n<p>The ECG changes that can be seen in hyperkalemia depend on the extent of hyperkalemia.\u00a0</p>\n<table style=\"height: 21px; width: 499px;\">\n<tbody>\n<tr>\n<td style=\"width: 45px;\">S. No.</td>\n<td style=\"width: 147px;\">Serum potassium level</td>\n<td style=\"width: 285px;\">ECG change</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">1</td>\n<td style=\"width: 147px;\">5.5 - 6.5 mEq/L</td>\n<td style=\"width: 285px;\">tall, peaked T waves with 'tented' or 'pinched' shape</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">2</td>\n<td style=\"width: 147px;\">6.5 - 7.5 mEq/L</td>\n<td style=\"width: 285px;\">loss of P waves</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">3</td>\n<td style=\"width: 147px;\">7.0 - 8.0 mEq/L</td>\n<td style=\"width: 285px;\">widened QRS complex</td>\n</tr>\n<tr>\n<td style=\"width: 45px;\">4</td>\n<td style=\"width: 147px;\">&gt; 8.0 mEq/L</td>\n<td style=\"width: 285px;\">sine wave</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>The <strong>most common cause</strong> of hyperkalemia is <strong>kidney failure</strong>. Drugs that cause hyperkalemia include angiotensin-converting enzyme inhibitors, angiotensin receptor blockers, potassium-sparing diuretics.\u00a0</p>\n<p>Treatment of hyperkalemia involves the following:</p>\n<ol>\n<li>Administer intravenous <strong>calcium gluconate</strong> which raises the threshold and reduces excitability. It is cardioprotective.</li>\n<li>Administer <strong>regular insulin with dextrose</strong>. Insulin reduces the serum potassium concentration by causing an intracellular shift. Dextrose counteracts the hypoglycemic effects of insulin.</li>\n<li>Remove potassium with calcium-based resins, diuretics, or hemodialysis.\u00a0</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7b8b346336864d208ae3448202f17fb4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbda02ee66a149babb636ab43176abc5x1280x1465.JPEG"
    ]
  },
  {
    "text": "Which of the following statements about pacemakers is correct?",
    "choices": [
      {
        "id": 1,
        "text": "A single chamber pacemaker is inserted in the left atrium"
      },
      {
        "id": 2,
        "text": "A single chamber pacemaker is inserted in the right atrium"
      },
      {
        "id": 3,
        "text": "A dual-chamber pacemaker is inserted in the left atrium and left ventricle"
      },
      {
        "id": 4,
        "text": "A dual-chamber pacemaker is inserted in the left atrium and right ventricle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The statement, <strong>a\u00a0single chamber pacemaker is inserted in the right atrium</strong>, is correct.\u00a0</p>\n<p>Pacemakers are inserted in the <strong>right-sided chambers</strong> of the heart.\u00a0</p>\n<p>A <strong>single chamber</strong> pacemaker is placed in the <strong>right atrium</strong> OR <strong>right</strong> <strong>ventricle</strong>.</p>\n<p>Those placed in the right atrium can be used in the treatment of <strong>sinoatrial node</strong> (SAN) <strong>dysfunction</strong> when the atrioventricular node (AVN) is functioning properly. However, they are rarely used presently as AVN dysfunction <strong>develops with age</strong>, making the patients eventually require a dual-chamber pacemaker.\u00a0</p>\n<p>Those placed in the right ventricle are used in <strong>chronic atrial fibrillation</strong> with a <strong>slow ventricular response</strong>.\u00a0</p>\n<p>Dual-chamber pacemakers are inserted into <strong>both</strong> the <strong>right atrium</strong> and <strong>right ventricle</strong>. This allows normal synchrony or a '<strong>physiologic delay</strong>' between atrial and ventricular contraction.\u00a0</p>\n<p>ECGs of those with pacemakers include a <strong>pacing spike</strong>. This is a sharp deflection whose amplitude depends on the pacing threshold. The pacing threshold is defined as the minimum amount of energy required to capture the myocardial tissue electrically.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4341df54fff745dd9259089e18ec772ex1280x688.JPEG"
    ]
  },
  {
    "text": "What is the diagnosis based on the given ECG?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial fibrillation"
      },
      {
        "id": 2,
        "text": "Second degree AV block"
      },
      {
        "id": 3,
        "text": "First degree AV block"
      },
      {
        "id": 4,
        "text": "Complete heart block"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given strip of ECG shows a <strong>Wenckebach/Mobitz type I block, </strong>a type of<strong>&nbsp;second-degree&nbsp;AV block.</strong></p>\n<p>In this type of heart block, there is a <strong>progressive lengthening</strong> of the <strong>PR interval</strong> with each beat, and then there is a loss of conduction which manifests as a <strong>dropped beat</strong>. This is characterized by a P wave <strong>without a QRS complex.</strong> Then the same pattern <strong>repeats</strong>.&nbsp;The <strong>PR interval immediately after</strong> a dropped wave is&nbsp;<strong>shorter</strong> than the PR interval immediately before it.</p>\n<p><strong>Types of Heart Block</strong></p>\n<p><strong>1. First-degree Heart Block: </strong>Prolonged <strong>PR interval, &gt; 0.2 s</strong>, RR interval equal and constant</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c607552e39b5470eb3aacb0ee7ee30a1.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d186409a1464c6d9d2db90d48ac7485x800x179.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/545c7590b3204dd9b810e973aba569a7x765x510.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/552b2cd8b6444313a5744f4e4d9ffe58x765x510.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bf8311f945ff43bbb2242fe6b5177799x800x180.PNG"
    ]
  }
];
        let quizName = 'Mini Test 13- Ecgs Only';
        const quizFilename = 'mini-test-13-ecgs-only-cc1d47f3.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>