<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10 Acls - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 45-year-old woman presented to the ER with dizziness. Her blood pressure is 80/60 mmHg, pulse rate is 45/minute. Her ECG is shown below. What is the next best step of management?",
    "choices": [
      {
        "id": 1,
        "text": "IV Epinephrine"
      },
      {
        "id": 2,
        "text": "IV Atropine"
      },
      {
        "id": 3,
        "text": "IV Amiodarone"
      },
      {
        "id": 4,
        "text": "IV Adenosine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ECG shown above is the <strong>second-degree atrioventricular block type 1 - Wenckebach phenomenon.</strong></p>\n<p>Treatment is indicated when bradycardia is accompanied by any one of the following:</p>\n<ul>\n<li>Hypotension</li>\n<li>Acutely altered mental status</li>\n<li>Signs of shock</li>\n<li>Ischemic chest discomfort</li>\n<li>Acute heart failure</li>\n</ul>\n<p>Treatment is initiated with <strong>1 mg atropine iv</strong> which may be <strong>repeated</strong> at <strong>3-5 minute intervals</strong> to a <strong>maximum</strong> <strong>dose</strong> of <strong>3 mg.</strong></p>\n<p>Along with atropine, <strong>transcutaneous pacing</strong> is to be done.</p>\n<p>If the bradycardia is <strong>refractory</strong> to both atropine and transcutaneous pacing, then <strong>IV infusions of dopamine </strong>(5 to 20 &mu;g/kg/min)<strong> or epinephrine </strong>(2 to 10 &mu;g/min) should be considered.</p>\n<p>If the patient still isn&rsquo;t responding, then<strong> transvenous pacing</strong> should be tried. If the patient is under spinal anesthesia, low-dose (0.2 mg) IV epinephrine can be given.</p>\n<p>Epinephrine is the drug of choice for treating bradyarrhythmias in infants and children.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/69dc56b785024b22b9b6b551cb9d74aa.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman with an acute altered mental state was brought to the ER. She had a history of hypothyroidism but was not on regular medication. On examination, her pulse rate was 40 beats per minute, BP was 80/60 mmHg. Which of the following cannot be used in the treatment of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Atropine"
      },
      {
        "id": 2,
        "text": "Dopamine"
      },
      {
        "id": 3,
        "text": "Transcutaneous pacing"
      },
      {
        "id": 4,
        "text": "Adenosine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Adenosine cannot be used in the treatment of this patient.&nbsp;It is used to treat&nbsp;supraventricular tachyarrhythmias, not bradyarrhythmias.&nbsp;</p>\n<p>The scenario depicts a patient with&nbsp;symptomatic bradycardia, marked by acute altered mental status and hypotension with hypothyroidism as the risk factor.</p>\n<p>Treatment is indicated when bradycardia is accompanied by any one of the following:</p>\n<ul>\n<li>Hypotension</li>\n<li>Acutely altered mental status</li>\n<li>Signs of shock</li>\n<li>Ischemic chest discomfort</li>\n<li>Acute heart failure</li>\n</ul>\n<p>Treatment is initiated with 1 mg <strong>atropine</strong> iv which may be repeated at 3-5 minute intervals to a maximum dose of 3 mg.</p>\n<p>Along with atropine, <strong>transcutaneous</strong> <strong>pacing</strong> is to be done.</p>\n<p>If the bradycardia is <strong>refractory</strong> to both atropine and transcutaneous pacing, then <strong>IV infusions of dopamine</strong> (5 to 20 &mu;g/kg/min) <strong>or epinephrine</strong> (2 to 10 &mu;g/min) should be considered.</p>\n<p>If the bradycardia is still not responding, then <strong>transvenous</strong> <strong>pacing</strong> should be tried. If the patient is under spinal anesthesia, low-dose (0.2 mg) IV epinephrine can be given.</p>\n<p>Epinephrine is the drug of choice for treating bradyarrhythmias in infants and children.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the maximum dose of IV atropine that can be given to treat a patient with symptomatic bradycardia?",
    "choices": [
      {
        "id": 1,
        "text": "0.5 mg"
      },
      {
        "id": 2,
        "text": "0.6 mg"
      },
      {
        "id": 3,
        "text": "3 mg"
      },
      {
        "id": 4,
        "text": "6 mg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>IV atropine is used in the treatment of symptomatic bradyarrhythmia starting at a dose of 1 mg, which can be repeated every 3-5 minutes to a <strong>maximum</strong> dose of <strong>3 mg</strong>.</p>\n<p>Along with atropine, <strong>transcutaneous pacing</strong> is to be done.</p>\n<p>If the bradycardia is refractory to both atropine and transcutaneous pacing, then <strong>IV infusions</strong> of <strong>dopamine</strong> (5 to 20 &mu;g/kg/min) <strong>or epinephrine</strong> (2 to 10 &mu;g/min) should be considered.</p>\n<p>If the bradycardia is still not responding, then <strong>transvenous pacing</strong> should be tried. If the patient is under spinal anesthesia, low-dose (0.2 mg) IV epinephrine can be given.</p>\n<p>Epinephrine is the drug of choice for treating bradyarrhythmias in infants and children.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old man was brought to the casualty with palpitations and dizziness. His heart rate was 160/min and blood pressure was 110/80 mm Hg. His ECG is given below. What is the first line of management?",
    "choices": [
      {
        "id": 1,
        "text": "Adenosine 6 mg"
      },
      {
        "id": 2,
        "text": "Adenosine 12 mg"
      },
      {
        "id": 3,
        "text": "Vagal manoeuvre"
      },
      {
        "id": 4,
        "text": "Amiodarone 300 mg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has&nbsp;<strong>paroxysmal supraventricular tachycardia</strong>. As the patient's&nbsp;<strong>blood pressure </strong>is <strong>normal</strong> and there is no evidence of hemodynamic deterioration, <strong>initial treatment </strong>consists of<strong> vagal maneuvers </strong>(Valsalva maneuver) in awake patients. This is because vagal maneuvers alone can terminate approximately 20% to 25% of reentry supraventricular tachycardias (SVTs).</p>\n<p>If this is <strong>unsuccessful</strong>, then IV <strong>adenosine 6 mg</strong> is given. If necessary another dose of adenosine 12 mg may be administered after 1-2 minutes.</p>\n<p>If the drug is administered via a central venous catheter, then these doses are reduced to 3 mg and 6 mg, respectively.</p>\n<p>If there is <strong>hemodynamic deterioration</strong>, then <strong>cardioversion</strong> is the treatment of choice.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66ae648faa824a7ebef13c06ebd06d1e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old man was brought to the casualty with palpitations and dizziness. His heart rate was 160/min and blood pressure was 110/80 mmHg. His ECG is given below. Vagal maneuver was found to be ineffective. What would your next line of management be?",
    "choices": [
      {
        "id": 1,
        "text": "Adenosine 0.6 mg"
      },
      {
        "id": 2,
        "text": "Adenosine 1.2 mg"
      },
      {
        "id": 3,
        "text": "Adenosine 6 mg"
      },
      {
        "id": 4,
        "text": "Adenosine 12 mg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has&nbsp;<strong>paroxysmal supraventricular tachycardia.</strong></p>\n<p>As <strong>vagal</strong> <strong>maneuver</strong> has been found <strong>ineffective</strong>, then the next best step is to administer <strong>adenosine 6 mg IV.</strong></p>\n<p>For treating supraventricular tachycardia, the hemodynamic status of the patient has to be assessed. In this patient, as his blood pressure is normal and&nbsp;there is no evidence of hemodynamic deterioration, initial treatment consists of vagal maneuvers (Valsalva maneuver) in awake patients.&nbsp;</p>\n<p>In this scenario, as this was unsuccessful, IV adenosine 6 mg had to be given. If necessary another dose of adenosine 12 mg may be administered after 1-2 minutes.</p>\n<p>If the drug is administered via a central venous catheter, then these doses are reduced to 3 mg and 6 mg, respectively.</p>\n<p>If there is hemodynamic deterioration, then cardioversion is the treatment of choice.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9b6e060eba614177a05becb1ac8b0a58.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old male was brought to the casualty with palpitations and dizziness. His heart rate is 170/min and his blood pressure was 70/40 mm Hg. His ECG is given below. What is the first line of management?",
    "choices": [
      {
        "id": 1,
        "text": "Vagal manoeuvre"
      },
      {
        "id": 2,
        "text": "Adenosine 6 mg IV"
      },
      {
        "id": 3,
        "text": "Adenosine 12 mg IV"
      },
      {
        "id": 4,
        "text": "Cardioversion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient has<strong>&nbsp;supraventricular tachycardia </strong>with evidence of<strong> hemodynamic deterioration. </strong>Immediate treatment would be <strong>cardioversion&nbsp;</strong>(50-100J).</p>\n<p>If the patient were&nbsp;<strong>hemodyamically stable,</strong> initial treatment would be&nbsp;<strong>vagal maneuvers</strong>&nbsp;(Valsalva maneuver) in awake patients. This is because vagal maneuvers alone can terminate approximately 20% to 25% of reentry supraventricular tachycardias (SVTs).</p>\n<p>If this is unsuccessful, then <strong>iv adenosine 6 mg</strong> is given. If necessary another dose of adenosine 12 mg may be administered after 1-2 minutes.</p>\n<p>If the drug is administered via a central venous catheter, then these doses are reduced to 3 mg and 6 mg respectively.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6c8c4f0a5f8f431aa1f01cb84c772132.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old patient with a history of hypertension and diabetes mellitus developed the following rhythm. His blood pressure was 90/40 mm Hg and he had a feeble pulse. What is the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "IV adenosine"
      },
      {
        "id": 2,
        "text": "IV diltiazem"
      },
      {
        "id": 3,
        "text": "DC cardioversion"
      },
      {
        "id": 4,
        "text": "Ibutilide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 1681\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The clinical scenario suggests<strong> supraventricular tachycardia</strong>\u00a0with hemodynamic instability and the next step of management is\u00a0<strong>DC cardioversion\u00a0</strong>(50-100J).</p>\n<div class=\"page\" title=\"Page 498\">If the patient was <strong>hemodyamically stable,</strong> initial treatment would be\u00a0<strong>vagal maneuvers</strong>\u00a0(Valsalva maneuver) in awake patients. This is because vagal maneuvers alone can terminate approximately 20% to 25% of reentry supraventricular tachycardias (SVTs).</div>\n<div class=\"page\" title=\"Page 498\">\u00a0</div>\n<div class=\"page\" title=\"Page 498\">If this is unsuccessful, then <strong>iv adenosine 6 mg</strong> is given. If necessary another dose of adenosine 12 mg may be administered after 1-2 minutes.</div>\n<p>If the drug is administered via a central venous catheter, then these doses are reduced to 3 mg and 6 mg respectively.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3bacde8f971141289ac5ee2ab015fce5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  58-year-old man presented to the casualty with complaints of increasing shortness of breath, lightheadedness, and palpitations. He had an irregularly irregular pulse and blood pressure was 120/70mm Hg. His ECG is given below. What is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Immediate defibrillation"
      },
      {
        "id": 2,
        "text": "Synchronized cardioversion"
      },
      {
        "id": 3,
        "text": "IV adenosine"
      },
      {
        "id": 4,
        "text": "IV ibutilide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient is in <strong>atrial fibrillation</strong> but his <strong>hemodynamic status is normal</strong>. So the <strong>treatment of choice </strong>is<strong> IV Ibutilide.</strong></p>\n<p>Ibutilide is a<strong> class III antiarrhythmic drug</strong> that has a rapid onset of action. It restores sinus rhythm by prolonging the action potential duration and effective refractory period.</p>\n<p>It is administered at a dose of <strong>1 mg over 10 minutes</strong>. If necessary, a second dose can be administered 10 minutes after the first.</p>\n<p>If there is evidence of <strong>hemodynamic</strong> <strong>deterioration</strong>, immediate <strong>cardioversion</strong> is the treatment of choice.</p>\n<p>Cardioversion is a <strong>synchronized</strong> administration of shock as the timing is typically synchronized with the&nbsp;<strong>R waves or QRS complex</strong> of a cardiac cycle. On the other hand,&nbsp;random administration of shock anywhere in between a cardiac cycle is termed as Defibrillation which is non-synchronized.</p>\n<p>However, the mechanism for both processes is quite similar. The electric current is made to travel from the negative to the positive electrode in such a way that it traverses the <strong>entire myocardium at once</strong> to conduct a simultaneous contraction of each cell of the heart muscle. It is made to interrupt any ongoing abnormal electrical activity by terminating it so that the sinus node can take back the charge and resume its normal pacemaker activity.</p>\n<table style=\"width: 642.671875px; height: 140px;\">\n<tbody>\n<tr>\n<td style=\"width: 323px;\">Indications for electrical cardioversion</td>\n<td style=\"width: 312.671875px;\">Indications for defibrillation</td>\n</tr>\n<tr>\n<td style=\"width: 323px;\">\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Supraventricular tachycardia</strong></span></p>\n<p><span style=\"color: #000000;\">(atrioventricular nodal reentrant tachycardia [AVNRT] and atrioventricular reentrant tachycardia [AVRT])</span></p>\n</div>\n<div class=\"topbullet\">\n<p><strong><span style=\"color: #000000;\">Atrial fibrillation</span></strong></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Atrial flutter</strong>&nbsp;(types I and II)</span></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Ventricular tachycardia</strong>&nbsp;</span><span style=\"color: #000000;\">(with a pulse)</span></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\">Any patient with<strong> re-entrant</strong> tachycardia with <strong>narrow or wide QRS</strong> complex (ventricular rate &gt;150 bpm) who is <strong>unstable</strong> (eg, ischemic chest pain, acute pulmonary edema, hypotension, acute altered mental status, signs of shock)</span></p>\n</div>\n</td>\n<td style=\"width: 312.671875px;\">\n<div class=\"topbullet\">\n<p><strong><span style=\"color: #000000;\">Pulseless ventricular tachycardia (VT)</span></strong></p>\n<p><strong><span style=\"color: #000000;\">Ventricular fibrillation (VF)</span></strong></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Cardiac arrest</strong> due to or resulting in VF</span></p>\n</div>\n<span style=\"color: #000000;\">&nbsp;</span></td>\n</tr>\n</tbody>\n</table>\n<p>Cardioversion is typically performed under <strong>induction or sedation</strong> using a short-acting agent such as midazolam, unless the patient is hemodynamically unstable or if cardiovascular collapse is imminent. Defibrillation is more of an emergent maneuver and, when necessary, should be preferably performed in conjunction with or prior to the administration of induction or sedative agents.</p>\n<div id=\"ads-pos-a4_1\" class=\"inContentAd\"></div>\n<div class=\"inContentAd\">Energy may be delivered through mainly two waveforms in defibrillators that are monophasic or biphasic.\n<div id=\"ads-pos-a7_8\" class=\"inContentAd\">\n<p>Monophasic defibrillation delivers a charge in only <strong>one direction</strong> as opposed to biphasic defibrillation delivering a charge in <strong>one direction for half </strong>of the shock and in the electrically <strong>opposite direction for the second half.</strong></p>\n<div id=\"ads-pos-a7_9\" class=\"inContentAd\">Biphasic waveforms are adopted in newer defibrillators as they deliver a more consistent magnitude of the current which successfully terminates arrhythmias at lower energies than monophasic waveform defibrillators.</div>\n<div class=\"inContentAd\">&nbsp;</div>\n<div class=\"inContentAd\">Energy selection for defibrillation or cardioversion.&nbsp;Following are the guidelines for&nbsp;<strong>initial&nbsp;</strong>energy requirements issued by the American Heart Association in 2010.</div>\n<p><strong>Atrial fibrillation</strong> energy requirements are as follows:</p>\n<ul>\n<li><strong>200</strong> Joules for monophasic devices</li>\n<li>120-200 Joules for biphasic devices</li>\n</ul>\n<p>Atrial flutter energy requirements are as follows:</p>\n<div class=\"topbullet\">\n<ul>\n<li>100 Joules for monophasic devices</li>\n<li>50-100 Joules for biphasic devices</li>\n</ul>\n</div>\n<div id=\"ads-pos-a7_13\" class=\"inContentAd\">Ventricular tachycardia with pulse energy requirements are as follows:</div>\n<div class=\"topbullet\">\n<ul>\n<li>200 Joules for monophasic devices</li>\n<li>100 Joules for biphasic devices</li>\n</ul>\n</div>\n<div id=\"ads-pos-a7_14\" class=\"inContentAd\">Ventricular fibrillation or pulseless ventricular tachycardia energy requirements are as follows:</div>\n<div class=\"topbullet\">\n<ul>\n<li>360 Joules for monomorphic devices</li>\n<li>120-200 Joules for biphasic devices</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/71941fcd59ea464ea79143a8111ed5e0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08ae6f62fa4e4ba8a3253dfa1301f8b1x1280x2567.JPEG"
    ]
  },
  {
    "text": "A young man was brought to the casualty with complaints of palpitations and dizziness. His pulse rate was 150/min and blood pressure 120/70 mm Hg. His ECG is shown below. What is the line of management?",
    "choices": [
      {
        "id": 1,
        "text": "IV procainamide"
      },
      {
        "id": 2,
        "text": "IV adenosine"
      },
      {
        "id": 3,
        "text": "IV lidocaine"
      },
      {
        "id": 4,
        "text": "Defibrillation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option B: Adenosine is used in&nbsp;regular narrow complex tachycardia.</p>\n<p>Option C: Lidocaine has limiting side effects and, increase the overall mortality risk.</p>\n<p>Option D: It is the treatment for immediately life-threatening arrhythmias with which the patient does not have a pulse, ie ventricular fibrillation (VF) or pulseless ventricular tachycardia (VT).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/002a6eca845041bc9b98cf992fc39b59.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ed9d8ff702f426cae109b1bd8fb0ec8x1280x2175.JPEG"
    ]
  },
  {
    "text": "A 70-year-old woman with chronic kidney disease on chronic therapy with a loop diuretic was brought to the ER. Her daughter says that she complained of palpitation, dizziness, and then suddenly collapsed. Her ECG is given below. Which electrolyte abnormality has to be considered in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hypermagnesemia"
      },
      {
        "id": 2,
        "text": "Hypomagnesemia"
      },
      {
        "id": 3,
        "text": "Hypernatremia"
      },
      {
        "id": 4,
        "text": "Hyponatremia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Chronic use of loop diuretics such as furosemide can predispose to <strong>hypomagnesemia</strong>.&nbsp;The given ECG classically depicts polymorphic ventricular tachycardia&mdash;torsades de pointes. Torsade rhythm is&nbsp;most commonly is seen in association with hypomagnesemia and hypokalemia.&nbsp;</p>\n<p><strong>Torsades de pointes</strong> is a polymorphic ventricular tachycardia meaning &ldquo;twisting of the points,&rdquo; characterized by twisting of the QRS axis around the baseline and a polymorphic appearance.</p>\n<p>There is QT interval prolongation in the ECG due to a non-uniform delay in repolarization.</p>\n<p>The other cause&nbsp;of torsades de pointes include:</p>\n<ul>\n<li>Drugs like <strong>quinidine, procainamide, disopyramide,&nbsp;</strong>and <strong>phenothiazine </strong>(amiodarone is rarely associated with torsades de pointes because the delay in repolarization induced by it is uniform).</li>\n<li>Bradycardia</li>\n<li>Acute ischemia or infarction</li>\n</ul>\n<p>Management:</p>\n<ul>\n<li>Discontinue the offending drug</li>\n<li>Correct electrolyte abnormalities, pH and hypoxia</li>\n<li>Magnesium sulphate infusion&nbsp;</li>\n<li>Increase the heart rate - electrical pacing, isoproterenol infusion, or intravenous atropine&nbsp;</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1792c4327b84466fa3112c8b3fc69a1f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the most common cause of pulseless electrical activity?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Pulmonary embolism"
      },
      {
        "id": 3,
        "text": "Tension pneumothorax"
      },
      {
        "id": 4,
        "text": "Hypovolemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hypovolemia</strong> and <strong>hypoxia</strong> are the two most <strong>common causes</strong> of <strong>pulseless electrical activity</strong> (PEA).</p>\n<p>Most likely causes of Pulseless electrical activity:</p>\n<ul>\n<li>In a trauma patient: hypovolemia, cardiac tamponade, and tension pneumothorax</li>\n<li>In the intraoperative or postoperative period: acute massive pulmonary thromboembolism or air embolism</li>\n<li>In pregnant women: uterine compression of the inferior vena cava, amniotic fluid embolism, or uterine rupture.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an incorrect statement concerning pulseless electrical activity (PEA)?",
    "choices": [
      {
        "id": 1,
        "text": "A pulselessness in the presence of organized electrical activity"
      },
      {
        "id": 2,
        "text": "Cardiac tamponade can lead to PEA"
      },
      {
        "id": 3,
        "text": "Immediate defibrillation is required"
      },
      {
        "id": 4,
        "text": "1mg of epinephrine is given immediately"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A pulseless electrical activity (PEA)&nbsp;is a <strong>non-shockable rhythm.</strong> Defibrillation is of no benefit.</p>\n<p>PEA involves a heterogeneous group of cardiac rhythms all without a pulse.</p>\n<p>The immediate <strong>treatment</strong> for this is giving <strong>chest compressions</strong> and <strong>1 mg</strong> <strong>epinephrine</strong> at the earliest until more definitive therapy to the cause can be instituted.</p>\n<p>It is essential to rule out the reversible causes of cardiac arrest because the treatment for each of them is different and PEA is likely to persist until the cause is treated.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the most common cardiac rhythm seen in adults experiencing sudden cardiac arrest?",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 2,
        "text": "Asystole"
      },
      {
        "id": 3,
        "text": "Atrial fibrillation"
      },
      {
        "id": 4,
        "text": "Paroxysmal supraventricular tachycardia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most common cardiac rhythm seen in adults experiencing sudden cardiac&nbsp;arrest is <strong>asystole,</strong> as&nbsp;recorded at initial contact in <strong>45&ndash;50% of cases.</strong></p>\n<p>Previously VF was thought to be the common rhythm, but its incidence has now been decreasing.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of cardiac arrest in children?",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 2,
        "text": "Myocardial infarction"
      },
      {
        "id": 3,
        "text": "Asphyxia"
      },
      {
        "id": 4,
        "text": "Congenital heart disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In children, the more common cause of cardiac arrest is <strong>asphyxia</strong> rather than ventricular fibrillation.</p>\n<p>Even though asphyxia is the more common cause, pediatric resuscitation starts with<strong> chest compressions </strong>rather than rescue breaths as in adults for simplicity in training.&nbsp;This is because the cycle of 30 chest compressions before rescue breathing <strong>delays ventilation</strong> for <strong>only 15 to 20 seconds</strong>.</p>\n<p>During cardiopulmonary resuscitation of infants and children, the ratio of chest compression to rescue breaths is <strong>30:2 </strong>for a<strong> single rescuer</strong> and <strong>15:2</strong> if <strong>2 or more rescuers</strong> are present.&nbsp;In adults, the ratio is<strong> 30:2</strong> irrespective of the number of rescuers.</p>\n<p>In infants and children, the depth of compression should be at least one-third of the anteroposterior diameter of the chest which is about 5 cm in children and 4 cm in infants.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man was brought to the ER in an unconscious state after having collapsed in a railway station. As there was no pulse, cardiopulmonary resuscitation was started, and the monitor showed asystole. What is the next step in the management?",
    "choices": [
      {
        "id": 1,
        "text": "Defibrillation"
      },
      {
        "id": 2,
        "text": "Synchronized cardioversion"
      },
      {
        "id": 3,
        "text": "0.5 mg atropine IV"
      },
      {
        "id": 4,
        "text": "1 mg epinephrine IV"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Asystole&nbsp;</strong>is a <strong>non-shockable</strong> rhythm.&nbsp;Treatment for both involves starting CPR immediately and <strong>administering 1 mg epinephrine IV.</strong></p>\n<p>Asystole is the complete and sustained absence of electrical activity. It is usually seen as a terminal rhythm in a resuscitation attempt that started with another rhythm, or in a patient with unwitnessed or prolonged cardiac arrest.&nbsp;The prognosis for persistent asystole is poor.</p>\n<p>Another example of a non-shockable rhythm is Pulseless electrical activity. It involves a heterogeneous group of cardiac rhythms, all without a pulse.</p>\n<p>It is essential to rule out the reversible causes of cardiac arrest because the treatment for each of them is different and PEA is likely to persist until the cause is treated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 47-year-old woman was brought to the casualty in an unconscious state after having suddenly collapsed. As there was no pulse, cardiopulmonary resuscitation was started and the monitor showed the following rhythm. What is the next step?",
    "choices": [
      {
        "id": 1,
        "text": "Defibrillation"
      },
      {
        "id": 2,
        "text": "Synchronized cardioversion"
      },
      {
        "id": 3,
        "text": "1 mg epinephrine IV"
      },
      {
        "id": 4,
        "text": "0.5 mg atropine IV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has an organized, apparently<strong> normal ECG without a pulse&nbsp;</strong>- i.e the patient has <strong>pulseless electrical activity</strong> (PEA). A pulseless electrical activity involves a heterogeneous group of cardiac rhythms, all without a pulse.</p>\n<p>The immediate treatment for this is giving <strong>chest compressions </strong>and<strong> 1 mg epinephrine</strong> at the <strong>earliest</strong> until definitive therapy to the cause can be instituted.</p>\n<p>It is essential to rule out the reversible causes of cardiac arrest because the treatment for each of them is different and PEA is likely to persist until the cause is treated.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/afcb5b8322cc4db9b71de1dcc76b45ee.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are performing cardiopulmonary resuscitation on a patient who had gone into cardiac arrest, and the monitor shows the following rhythm. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Defibrillation"
      },
      {
        "id": 2,
        "text": "Synchronized cardioversion"
      },
      {
        "id": 3,
        "text": "0.5 mg atropine IV"
      },
      {
        "id": 4,
        "text": "1 mg epinephrine IV"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ECG rhythm shown is <strong>ventricular fibrillation</strong>&nbsp;which is treated by&nbsp;<strong>immediate defibrillation.</strong></p>\n<p>The management of ventricular fibrillation and pulseless ventricular tachycardia (<strong>shockable</strong> <strong>rhythms</strong>) is the same. Immediate chest compression is to be started.</p>\n<p>It is of utmost necessity to <strong>defibrillate at the earliest</strong> because&nbsp;the chances of survival decrease by 7-10% every minute without defibrillation.</p>\n<p>Defibrillation involves delivering an electrical current between two pads placed on the chest so as to interrupt the disorganized cardiac activity and restore an organized cardiac rhythm or asystole for at least 5 seconds.</p>\n<p>The energy that must be applied is</p>\n<ul>\n<li>Monophasic defibrillator&ndash; 360 J</li>\n<li>Biphasic defibrillator- 120 J</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2cd1da254b744415baac5641d4306196.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "You have just performed defibrillation in a patient with ventricular fibrillation. According to the ACLS guidelines, what should be your next step?",
    "choices": [
      {
        "id": 1,
        "text": "Check for a pulse"
      },
      {
        "id": 2,
        "text": "Resume chest compression"
      },
      {
        "id": 3,
        "text": "Epinephrine 1 mg IV"
      },
      {
        "id": 4,
        "text": "Amiodarone 300 mg IV bolus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Chest</strong> <strong>compressions</strong> should be <strong>resumed immediately</strong> following shock delivery.</p>\n<p><strong>Pulse check </strong>and reanalysis of the cardiac rhythm is performed only <strong>after 2 minutes</strong> of <strong>chest compression and rescue breaths</strong>.&nbsp;This is because the heart is temporarily stunned by a defibrillator shock and so chest compressions would benefit the patient by providing coronary blood flow during this period.</p>\n<p>Defibrillation involves delivering an electrical current between two pads placed on the chest so as to interrupt disorganized cardiac activity and restore an organized cardiac rhythm or asystole for at least 5 seconds. It is of utmost necessity to defibrillate immediately because&nbsp;the chances of survival decrease by 7-10% every minute without defibrillation.</p>\n<p>If after 2 minutes, the rhythm remains the same, then another shock is delivered. Chest compression and rescue breaths are resumed and 1 mg epinephrine is administered. Consideration is given for an advanced airway placement.</p>\n<p>If after 2 minutes the rhythm still remains the same, the&nbsp;first dose of amiodarone 300mg bolus is given.</p>\n<p>With the next cycle of CPR, a shock is delivered and 1 mg of epinephrine is given. And with the cycle of CPR after that, shock is delivered and the second dose of amiodarone- 150mg is given</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs are not approved for resuscitation in a cardiac arrest victim?",
    "choices": [
      {
        "id": 1,
        "text": "Vasopressin"
      },
      {
        "id": 2,
        "text": "Epinephrine"
      },
      {
        "id": 3,
        "text": "Amiodarone"
      },
      {
        "id": 4,
        "text": "B and C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Vasopressin</strong> was a part of the resuscitation protocol in the 2010 American Heart Association (AHA) cardiac arrest algorithm but it has been <strong>removed from the 2015 guidelines</strong>.</p>\n<p>Vasopressin causes intense peripheral vasoconstriction due to stimulation of V1 receptors in the endothelium but it causes a limited increase in myocardial contractility, myocardial and cerebral oxygen consumption, and metabolic demands. Thus it doesn&rsquo;t have much of a survival benefit.</p>\n<p><strong>Epinephrine and amiodarone </strong>are the two main drugs <strong>approved </strong>by the AHA for <strong>resuscitation </strong>of a patient in&nbsp;<strong>cardiac arrest</strong><strong>.</strong></p>\n<p>The first dose of epinephrine,1 mg IV, is administered after the 2<sup>nd</sup> defibrillator shock is delivered and it is continued every 3-5 minutes.</p>\n<p>If this is not effective, 300 mg IV bolus dose of amiodarone can be given and another dose of 150 mg given if necessary</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about adrenaline in CPR?",
    "choices": [
      {
        "id": 1,
        "text": "Can be given intratracheally"
      },
      {
        "id": 2,
        "text": "Intracardiac route is better than IV"
      },
      {
        "id": 3,
        "text": "Converts coarse fibrillation into fine ones"
      },
      {
        "id": 4,
        "text": "The dose used is 2 ml containing 1 in 1000 concentration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Intravenous Adrenaline is the drug of choice for CPR. However, adrenaline can be given <strong>intratracheally</strong> also. The concentration required for intratracheal administration is <strong>2-2.5 times</strong> more than required for the IV route.</p>\n<p>Option B: <strong>Intracardiac injection</strong> is not recommended as it can cause <strong>myocardial damage.</strong> Recommended routes for adrenaline are intravenous, intraosseous (children), and intra-tracheal.</p>\n<p>Option C: <strong>Adrenaline</strong> converts <strong>fine</strong> fibrillation <strong>to coarse fibrillation</strong> which then responds well to defibrillation.</p>\n<p>Option D: Adrenaline is available as a <strong>1 mL injection</strong> containing 1 mg of adrenaline in 1:1000 concentration. The dose used in cardiac arrest is 1mg of adrenaline every 3-5 minutes, usually given as 1ml in 1:1000 concentration or 10ml in 1:10,000 concentration (more preferred since in cardiac arrest peripheral circulation is absent; hence larger volume is required for the drug to reach the central circulation).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In cardiac arrest patients, what is the dose of epinephrine you would prefer to use?",
    "choices": [
      {
        "id": 1,
        "text": "10 mL of 1:1000"
      },
      {
        "id": 2,
        "text": "10 mL of 1:10,000"
      },
      {
        "id": 3,
        "text": "10 mL of 1:1,00,000"
      },
      {
        "id": 4,
        "text": "1 mL of 1:1,00,000"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Epinephrine is used in<strong> cardiac arrest </strong>patients at a dose of<strong> 10 mL of 1: 10,000 solution (1 mg epinephrine).</strong></p>\n<p>Epinephrine is an adrenergic agonist: &alpha;-Adrenergic effects increase myocardial blood flow. &beta;-Adrenergic effects increases myocardial contractility.</p>\n<p>Indication<strong>:</strong> VF/VT, electromechanical dissociation, ventricular asystole, severe bradycardia unresponsive to atropine or pacing, severe hypotension.</p>\n<p>Dose: 1 mg IV. Repeat doses every 3&ndash;5 min as necessary. Administration down a tracheal tube requires higher doses (2&ndash;2.5 mg in adults).</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs cannot be administered via the endotracheal route?",
    "choices": [
      {
        "id": 1,
        "text": "Adrenaline"
      },
      {
        "id": 2,
        "text": "Vasopressin"
      },
      {
        "id": 3,
        "text": "Lignocaine"
      },
      {
        "id": 4,
        "text": "Sodium bicarbonate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sodium bicarbonate cannot be administered via the endotracheal route.</p>\n<p>The dosage for intratracheal route is 2-2.5 times higher than the intravenous dose. The drugs should be diluted in 10 ml of normal saline or distilled water for adults and 5 ml for children.</p>\n<p>When there is <strong>no intravenous access</strong>, the <strong>intraosseous</strong> route is <strong>preferred over</strong> the <strong>endotracheal</strong> route because the optimal dose via the endotracheal route is not known. Also,&nbsp;CPR needs to be stopped momentarily as the drug may be regurgitated up the endotracheal tube during chest compression.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What alternative drug would you use for cardiac arrest if epinephrine is not effective?",
    "choices": [
      {
        "id": 1,
        "text": "Vasopressin"
      },
      {
        "id": 2,
        "text": "Atropine"
      },
      {
        "id": 3,
        "text": "Amiodarone"
      },
      {
        "id": 4,
        "text": "Adenosine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Epinephrine and amiodarone </strong>are the two main drugs <strong>approved by the AHA </strong>for the resuscitation of a cardiac arrest patient.</p>\n<p>The first dose of epinephrine 1 mg IV is administered after the 2<sup>nd</sup>&nbsp;defibrillator shock is delivered and it is continued every 3-5 minutes.</p>\n<p>If this is not effective, 300 mg IV bolus dose of amiodarone can be given and another dose of 150 mg given if necessary</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A comatose patient is being shifted to the cardiac ICU after achieving return of spontaneous circulation (ROSC). What is the body temperature to be maintained in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "12-16\u00b0"
      },
      {
        "id": 2,
        "text": "20-24 \u00b0C"
      },
      {
        "id": 3,
        "text": "32-36\u00b0C"
      },
      {
        "id": 4,
        "text": "42- 45\u00b0 C"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the post-cardiac arrest care algorithm,<strong>&nbsp;targeted temperature management</strong> is the maintenance of a constant target temperature between <strong>32-36<sup>0</sup></strong>C for <strong>at least 24 hours. </strong></p>\n<p>This is done&nbsp;in post-cardiac resuscitation patients who have achieved return of spontaneous circulation (<strong>ROSC</strong>), but are <strong>still comatose.</strong></p>\n<p>The entire body is to be cooled using a combination of methods like fluid-filled cooling blankets, ice packs, forced air blankets, cold IV fluids, and/or invasive devices or catheters.</p>\n<p>It has been found to be the only intervention that can improve neurological recovery after cardiac arrest. It is most beneficial in ventricular fibrillation and pulseless ventricular tachycardia patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are performing CPR on a woman who is 38-weeks pregnant. She was admitted to the ER after a massive pulmonary embolism had lead to cardio-pulmonary arrest. Despite adequate resuscitative measures, there is no improvement. What is the cut-off time for perimortem cesarean delivery in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "1 minute"
      },
      {
        "id": 2,
        "text": "2 minutes"
      },
      {
        "id": 3,
        "text": "5 minutes"
      },
      {
        "id": 4,
        "text": "3 minutes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Perimortem cesarean delivery</strong> should be considered if there is <strong>no return of spontaneous circulation</strong> in <strong>5 minutes,</strong>&nbsp;according to the AHA 2020 Guidelines.</p>\n<p>When a pregnant woman is in cardiac arrest, <strong>high-quality CPR</strong> and <strong>defibrillation</strong> are performed and <strong>epinephrine</strong> is administered.&nbsp;The maternal cardiac arrest team is assembled to look for the etiology and perform the following interventions:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Maternal interventions</strong>:&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Airway management</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Administration of of 100% O2</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Placing the IV above the diaphragm</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">If the patient is on IV magnesium - stopping it and administering calcium chloride or gluconate</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Obstetric interventions</strong>:&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Continuous lateral uterine displacement</li>\n</ul>\n</ul>\n<p>After performing the above-mentioned interventions, if there is no return of spontaneous circulation (ROSC) in 5 minutes, a perimortem cesarean section is considered.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '10 Acls';
        let hierarchy = ["Marrow", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>