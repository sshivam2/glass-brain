<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02 Health Determinants And Indicators - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not included in the WHO definition of health?",
    "choices": [
      {
        "id": 1,
        "text": "Social well-being"
      },
      {
        "id": 2,
        "text": "Emotional well-being"
      },
      {
        "id": 3,
        "text": "Mental well-being"
      },
      {
        "id": 4,
        "text": "Physical well-being"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the WHO, health is &ldquo;a state of complete <strong>physical, mental</strong> and<strong> social</strong> well-being and not merely the absence of disease or infirmity&rdquo;.</p>\n<p>In recent years, the definition has been modified to also include the ability to lead a &ldquo;<strong>socially </strong>and<strong> economically</strong> productive life.&rdquo;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the biomedical concept of disease based upon?",
    "choices": [
      {
        "id": 1,
        "text": "Germ theory of disease"
      },
      {
        "id": 2,
        "text": "Combination of social, economic and political influences"
      },
      {
        "id": 3,
        "text": "Social and psychological factors"
      },
      {
        "id": 4,
        "text": "Equilibrium between man and environment"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>biomedical concept</strong> of disease is based on the&nbsp;<strong>germ theory </strong>of <strong>disease,</strong> which was postulated by <strong>Louis Pasteur.</strong></p>\n<p>The germ theory of disease states that microorganisms known as pathogens or germs can lead to disease. It was criticized that it did not include environmental, social, psychological, and cultural determinants of health. &nbsp;</p>\n<p>The <strong>ecological concept</strong>&nbsp;of disease states that disease is the<strong> maladjustment</strong> of the human organism <strong>to</strong> the<strong> environment</strong>.</p>\n<p>The <strong>psychosocial concept</strong>&nbsp;of disease hypothesised that health is also influenced by <strong>social</strong>, <strong>psychological</strong>, <strong>cultural</strong> and <strong>economic</strong> factors as well.</p>\n<p>The <strong>holistic concept</strong>&nbsp;of disease <strong>includes all</strong> the above concepts to describe health. &nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a mortality indicator?",
    "choices": [
      {
        "id": 1,
        "text": "Disability adjusted life years"
      },
      {
        "id": 2,
        "text": "Sullivan\u2019s Index"
      },
      {
        "id": 3,
        "text": "Life expectancy"
      },
      {
        "id": 4,
        "text": "Health adjusted life expectancy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Life expectancy</strong> is a positive <strong>mortality indicator.&nbsp;</strong></p>\n<p>A<strong>&nbsp;</strong>set of values that measure the rate of mortality or death is known as mortality indicators.</p>\n<p>Disability-adjusted life years (<strong>DALY</strong>), health adjusted life expectancy (<strong>HALE</strong>), and <strong>Sullivan&rsquo;s Index</strong> are <strong>disability rates</strong>. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An epidemiologist is tasked with measuring the overall health status of a community using a morbidity indicator. Which of the following indicators will she not use?",
    "choices": [
      {
        "id": 1,
        "text": "Duration of stay in hospital"
      },
      {
        "id": 2,
        "text": "Attendance rates at OPD"
      },
      {
        "id": 3,
        "text": "Number of days of restricted activity"
      },
      {
        "id": 4,
        "text": "Notification rates"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Number of days of <strong>restricted activity</strong>\u00a0is a<strong> disability indicator</strong>.\u00a0</p>\n<p><strong>Morbidity </strong>is defined as public health outcomes focusing on <strong>diseases</strong>, <strong>traumas</strong>, or injury. Morbidity indicators can be used to measure the overall health and extent of healthcare utilisation in a given population.</p>\n<p><strong>Disability\u00a0</strong>is defined as public health outcomes related to health conditions that include<strong> limitations</strong> in <strong>personal activities</strong> and societal participation. There are two types of disability indicators as follows:</p>\n<ul>\n<li><strong>Event type</strong> indicators-\n<ul>\n<li>Number of days of restricted activity</li>\n<li>Bed disability days</li>\n<li>Work loss days (or school loss days) within a specified period</li>\n</ul>\n</li>\n<li><strong>Person type</strong> indicators-\n<ul>\n<li>Limitation of mobility: e.g confined to bed</li>\n<li>Limitation of activity: e.g limitation to perform the basic activities of daily living such as eating and going to the toilet \u00a0\u00a0</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following indicators can be used to estimate the number of years a newborn would be expected to live in full health based on the current rates of ill health and mortality?",
    "choices": [
      {
        "id": 1,
        "text": "DALY"
      },
      {
        "id": 2,
        "text": "Sullivan's  index"
      },
      {
        "id": 3,
        "text": "HALE"
      },
      {
        "id": 4,
        "text": "Life expectancy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>HALE</strong> (Health Adjusted Life Expectancy) is an&nbsp;indicator that can be used to estimate the number of <strong>years</strong> a newborn is expected to live <strong>in full health</strong> based on the <strong>current rates</strong> of<strong> ill health</strong> and <strong>mortality</strong>.</p>\n<p>HALE&nbsp;is calculated using the <strong>life expectancy </strong>at<strong> birth</strong> with an <strong>adjustment </strong>for time spent in<strong> poor health</strong>. It&nbsp;captures both fatal and non-fatal health outcomes of average levels of population health. It is also <strong>sensitive</strong> to <strong>changes over time</strong> or differences between countries in the <strong>distribution of health states</strong>.</p>\n<p><strong>Sullivan's index</strong>&nbsp;is also known as disability-free life expectancy (DFLE) or&nbsp;active life expectancy.&nbsp;It is the average <strong>number of years</strong> an individual is expected to <strong>live free of disability</strong> if the current patterns of mortality and disability continue to apply.&nbsp;It doesn&rsquo;t take into account premature death. As HALE includes not just disability but the larger definition of poor health, it is a better option&nbsp;with respect to the question.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While assessing the health needs of a community, an epidemiologist is tasked with estimating the burden of cholera in the area. Which of the following is the simplest measure he can use?",
    "choices": [
      {
        "id": 1,
        "text": "Case fatality rate"
      },
      {
        "id": 2,
        "text": "Incidence"
      },
      {
        "id": 3,
        "text": "Crude death rate"
      },
      {
        "id": 4,
        "text": "Proportional mortality rate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong>&nbsp;proportional mortality rate</strong> is the <strong>simplest</strong> measure of estimating the <strong>burden of disease</strong> in the community. It signifies the proportion of all deaths that can be attributed to the disease.</p>\n<p>It is calculated as follows:</p>\n<p>Proportional mortality rate of a disease = (No. of deaths due to that disease in the year/ Total no. of deaths in the year) *100.</p>\n<p>Option A: <strong>Case fatality rate</strong>&nbsp;measures the risk of persons dying from a certain disease within a given time period. It measures the <strong>killing power</strong> of a disease.&nbsp;It is used to<strong> link</strong> mortality to <strong>morbidity</strong>.</p>\n<p>Option B: <strong>Incidence </strong>measures the <strong>rate</strong> at which <strong>new cases</strong> are occurring in a population. It is not influenced by the duration of the disease. The <strong>use</strong> of incidence is generally <strong>restricted to acute diseases</strong>.</p>\n<p>Option C: <strong>Crude death rate</strong>&nbsp;is considered a fair indicator of the comparative health of the people. It is the rate of <strong>total deaths in a year</strong> compared to the <strong>mid-year population</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are researching the overall burden of COVID on a given population. Which of the following disability indicators is the best measure of this?",
    "choices": [
      {
        "id": 1,
        "text": "Sullivan\u2019s index"
      },
      {
        "id": 2,
        "text": "DALY"
      },
      {
        "id": 3,
        "text": "QALY"
      },
      {
        "id": 4,
        "text": "YLL"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Disability adjusted life years (<strong>DALY</strong>) is the <strong>best</strong> measure of the&nbsp;<strong>overall burden </strong>of a <strong>disease</strong> in a defined population. It is also the best measure of the effectiveness of interventions.&nbsp;</p>\n<p>DALY is calculated as - Years of lost life prematurely&nbsp;(YLL) + Years lost to disability (YLD).<strong>&nbsp;</strong>It can <strong>measure</strong> both<strong> mortality</strong> and <strong>disability</strong> together.&nbsp;</p>\n<p>As DALY is affected by premature loss of life, <strong>conditions</strong> that <strong>affect younger individuals</strong> like road traffic accidents have a <strong>high DALY</strong>. In comparison to this, Alzheimer's disease has a lower DALY as it is a disease that mostly develops during old age and so has a lower YLL.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a health utilisation rate?",
    "choices": [
      {
        "id": 1,
        "text": "Bed occupancy rate"
      },
      {
        "id": 2,
        "text": "Bed turnover ratio"
      },
      {
        "id": 3,
        "text": "Bed disability days"
      },
      {
        "id": 4,
        "text": "Average length of stay in hospital"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Bed disability days</strong> is not a utilisation rate. It is an event-type <strong>disability indicator</strong>. It is&nbsp;defined as the number of days a person spent in a hospital bed due to illness or injury.</p>\n<p><strong>Health utilisation rate</strong> is defined as the <strong>number of people</strong> making <strong>use</strong> of the available <strong>health services</strong> to the total number of individuals in that population.&nbsp;</p>\n<p>Health utilisation rates&nbsp;include:&nbsp;</p>\n<ul>\n<li>Proportion of infants immunized against 9 diseases in the expanded program on immunization (EPI)</li>\n<li>Proportion of women receiving antenatal care and supervised delivery&nbsp;</li>\n<li>Percentage of population using family planning methods</li>\n<li><strong>Bed occupancy</strong> rate</li>\n<li>Average <strong>length of stay</strong> in the hospital</li>\n<li><strong>Bed turnover</strong> ratio&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As the medical superintendent of a hospital, you wish to optimise the utilization of health services. What bed turnover interval should you aim for?",
    "choices": [
      {
        "id": 1,
        "text": "Slightly positive"
      },
      {
        "id": 2,
        "text": "Slightly negative"
      },
      {
        "id": 3,
        "text": "Largely positive"
      },
      {
        "id": 4,
        "text": "Equal to zero"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>For <strong>optimum utilization</strong> of health services in a hospital, <strong>bed turnover</strong> <strong>interval</strong> must always be <strong>slightly positive</strong>.</p>\n<p>Bed turnover interval is defined as the <strong>time interval</strong> where a hospital <strong>bed</strong> is left&nbsp;<strong>unoccupied</strong>&nbsp;following a patient&rsquo;s discharge&nbsp;till the next patient occupies it after admission. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the best indicator of availability, utilization, and effectiveness of health services?",
    "choices": [
      {
        "id": 1,
        "text": "Infant mortality rate"
      },
      {
        "id": 2,
        "text": "Maternal mortality rate"
      },
      {
        "id": 3,
        "text": "Proportional mortality rate"
      },
      {
        "id": 4,
        "text": "Disability adjusted life expectancy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Infant mortality rate</strong> (IMR) is the <strong>best</strong>&nbsp;<strong>indicator</strong> of the&nbsp;availability, utilization, and effectiveness of health care. It is a very sensitive indicator.</p>\n<p>Infant mortality rate (IMR)= Number of deaths in the first year of life/Number of live births x 1000</p>\n<p>It is also one of the <strong>best indicators </strong>of<strong> state failure</strong>.&nbsp;It is the most <strong>universally accepted </strong>health status indicator of the whole population and of the socio-economic status in which they live.</p>\n<p>Note: The best indicator of <strong>socio-economic development</strong> is the<strong> under-5 mortality rate</strong>. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While reviewing a national health programme,  you are asked to assess the cost-effectiveness of the interventions provided under it. Which indicator will you use to measure this?",
    "choices": [
      {
        "id": 1,
        "text": "Admission, readmission and discharge rates"
      },
      {
        "id": 2,
        "text": "QALY"
      },
      {
        "id": 3,
        "text": "HALE"
      },
      {
        "id": 4,
        "text": "Bed turnover rates"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>QALY</strong>(Quality Adjusted Life Years) is used in assessing the <strong>cost-effectiveness</strong> (value of money) of a medical intervention. It is a measure of both the&nbsp;<strong>quality </strong>and<strong> quantity</strong> of life lived. It indicates the number of years of life that would be added by the intervention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a socio-economic determinant of health?",
    "choices": [
      {
        "id": 1,
        "text": "Lifestyle"
      },
      {
        "id": 2,
        "text": "Political system"
      },
      {
        "id": 3,
        "text": "Education"
      },
      {
        "id": 4,
        "text": "GNP per capita"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Lifestyle</strong> is a behavioural and\u00a0<strong>socio-cultural</strong> <strong>determinant</strong> of health. It is not a socio-economic determinant.</p>\n<p><strong>Socio-economic</strong> <strong>determinants</strong> of health are the following:</p>\n<ul>\n<li>Economic status (per capita GNP)</li>\n<li>Education</li>\n<li>Occupation</li>\n<li>Political system \u00a0</li>\n</ul>\n<p><strong>Lifestyle</strong> is simply the way people live. It reflects our social values, attitudes, and activities. It is <strong>composed of</strong>:\u00a0</p>\n<ul>\n<li>Cultural patterns (daily nutrition, superstitions)</li>\n<li>Behavioral patterns (personal hygiene, sedentary life)</li>\n<li>Lifelong personal habits (e.g. smoking, alcoholism)\u00a0</li>\n</ul>\n<p>Lifestyle is learned by <strong>social interaction</strong> with parents, siblings, friends, school, and mass media. \u00a0</p>\n<p>Our <strong>political system</strong> determines our health. It can help shape community health services with regards to resource allocation, manpower policy, choice of technology, and the degree to which these services are made available &amp; accessible to all segments of the society.</p>\n<p>The percentage of <strong>GDP</strong> spent on <strong>health</strong> is an indicator of political commitment. <strong>WHO</strong> recommends at least <strong>5%</strong> of GDP to be spent on health care.\u00a0<strong>India</strong> spends about <strong>2.1 % </strong>of its GDP on health(budget 2022-23). \u00a0\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a socio-economic indicator of health?",
    "choices": [
      {
        "id": 1,
        "text": "Per capita GNP"
      },
      {
        "id": 2,
        "text": "Family size"
      },
      {
        "id": 3,
        "text": "Literacy rate"
      },
      {
        "id": 4,
        "text": "Annual family income"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Annual family income is not a socioeconomic indicator of health.&nbsp;</p>\n<p><strong class=\"ng-binding\">Socio-economic indicators of health </strong>(mnemonic:&nbsp;H &ndash; FLAGGED):</p>\n<ul>\n<li><strong>H</strong>ousing (number of persons per room)</li>\n<li><strong>F</strong>amily size</li>\n<li><strong>L</strong>iteracy rate (especially female literacy rate)</li>\n<li><strong>A</strong>vailability of per capita calorie</li>\n<li><strong>G</strong>NP per capita</li>\n<li><strong>G</strong>rowth rate of population</li>\n<li>Un<strong>E</strong>mployment level</li>\n<li><strong>D</strong>ependency ratio&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding positive health in today\u2019s world?",
    "choices": [
      {
        "id": 1,
        "text": "It is dependent on social, economic, and cultural determinants"
      },
      {
        "id": 2,
        "text": "It is a mirage because of changing environment"
      },
      {
        "id": 3,
        "text": "It means that the body and mind are at peace"
      },
      {
        "id": 4,
        "text": "It includes provision of free health camps by the government"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The provision of <strong>free health camps</strong> by the government&nbsp;is a<strong>&nbsp;</strong>concept of<strong>&nbsp;state medicine</strong>.</p>\n<p>Health does not merely mean the absence of disease or provision of diagnostic, curative, and preventive services. It is a state&nbsp;of physical, mental, and social well-being.&nbsp;</p>\n<p>The state of<strong> positive health</strong> is based on the&nbsp;idea of<strong> perfect functioning</strong> of the body and mind. According to this concept, health is:</p>\n<ul>\n<li><strong>Biologically</strong> a state in which<strong> every cell</strong> and organ in the body is functioning at <strong>optimum capacity</strong></li>\n<li><strong>Psychologically</strong> a state in which the individual feels a sense of <strong>perfect well-being</strong> and mastery over his environment</li>\n<li><strong>Socially</strong> a state in which the individual's capacities for <strong>participation</strong> in the <strong>social system</strong> are <strong>optimal</strong></li>\n</ul>\n<p>This concept is<strong> too idealistic</strong> and can never become a reality.&nbsp;Humans can never be so perfectly adapted to the environment&nbsp;because everything in our life is subject to change.</p>\n<p>As the goal of positive health is unattainable, a&nbsp;broader concept of <strong>improving</strong> the<strong> quality</strong> <strong>of</strong> <strong>life</strong> has emerged.&nbsp;This highlights that positive health depends on medical action and also on economic, cultural, and social factors in the community.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As per the WHO, which of the following is not included in the standard of living?",
    "choices": [
      {
        "id": 1,
        "text": "Income"
      },
      {
        "id": 2,
        "text": "Occupation"
      },
      {
        "id": 3,
        "text": "Sanitation"
      },
      {
        "id": 4,
        "text": "Social security"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Social security</strong> is a component of the&nbsp;<strong>level of living</strong> as per the United Nations and not standard of living.</p>\n<p>According to the WHO, the<strong> standard</strong> of<strong> living</strong> includes:</p>\n<ul>\n<li>Income and occupation</li>\n<li>Standards of housing, sanitation, and nutrition</li>\n<li>Level of provision of health, educational, and recreational services</li>\n</ul>\n<p>It depends on <strong>per capita GNP</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are components of the physical quality of life index (PQLI)?",
    "choices": [
      {
        "id": 1,
        "text": "1,3 and 5"
      },
      {
        "id": 2,
        "text": "2 and 5"
      },
      {
        "id": 3,
        "text": "1,2 and 4"
      },
      {
        "id": 4,
        "text": "1,3 and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Infant mortality rate, literacy rate, and life expectancy at 1 year of age\u00a0are the\u00a0components of the <strong>physical quality of life index</strong>\u00a0(PQLI).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the best measure of the standard of living?",
    "choices": [
      {
        "id": 1,
        "text": "Under 5 mortality rate"
      },
      {
        "id": 2,
        "text": "Sullivan index"
      },
      {
        "id": 3,
        "text": "HDI"
      },
      {
        "id": 4,
        "text": "PQLI"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Human development index </strong>(HDI) is the <strong>best</strong>&nbsp;measure of the<strong>&nbsp;standard of living</strong>&nbsp;of a population.</p>\n<p>Physical quality of life index (<strong>PQLI</strong>) measures the <strong>quality of life</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a component of the human development index (HDI)?",
    "choices": [
      {
        "id": 1,
        "text": "Infant Mortality Rate"
      },
      {
        "id": 2,
        "text": "Income"
      },
      {
        "id": 3,
        "text": "Longevity"
      },
      {
        "id": 4,
        "text": "Knowledge"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Infant mortality rate</strong> (IMR) is not a component of HDI. It is a component of the physical quality of life index (<strong>PQLI</strong>).\u00a0</p>\n<p>The\u00a0<strong>human development index </strong>(HDI)<strong>\u00a0</strong>is used to compare <strong>living standards</strong> in different countries. It\u00a0includes the following dimensions or components:</p>\n<table style=\"width: 438px;\">\n<tbody>\n<tr>\n<td style=\"width: 25px;\"><strong>Component\u00a0</strong></td>\n<td style=\"width: 123.04168701171875px;\"><strong>Indicator\u00a0</strong></td>\n<td style=\"width: 146.95831298828125px;\"><strong>Index</strong></td>\n</tr>\n<tr>\n<td style=\"width: 25px;\"><strong>Longevity</strong></td>\n<td style=\"width: 123.04168701171875px;\">Life expectancy at birth</td>\n<td style=\"width: 146.95831298828125px;\">Life expectancy index</td>\n</tr>\n<tr>\n<td style=\"width: 25px;\"><strong>Knowledge</strong></td>\n<td style=\"width: 123.04168701171875px;\">Literacy and enrolment</td>\n<td style=\"width: 146.95831298828125px;\">Education index</td>\n</tr>\n<tr>\n<td style=\"width: 25px;\"><strong>Income</strong></td>\n<td style=\"width: 123.04168701171875px;\">GNI per capita US$ (purchasing power parity-PPP)</td>\n<td style=\"width: 146.95831298828125px;\">GNI index<strong>\u00a0</strong>(income index)</td>\n</tr>\n</tbody>\n</table>\n<p>Each dimension index is calculated using the formula: <strong>Dimension Index</strong> = (Actual Value - Minimum Value)<strong>/</strong>(Maximum Value - Minimum Value)</p>\n<p>HDI is the geometric mean of the three indices:\u00a0I<sub>Life</sub><sup>1/3</sup> x\u00a0\u00a0\u00a0 I<sub>Education</sub><sup>1/3</sup>\u00a0\u00a0\u00a0 x\u00a0\u00a0\u00a0 I<sub>Income</sub><sup>1/3.\u00a0</sup>\u00a0</p>\n<p>As per the <strong>Human Development Report 2023-2024</strong>, India's Human Development Index (HDI) value is <strong>0.644</strong>. This places India at <strong>134th</strong> out of 193 countries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What are the minimum and maximum values established for the calculation of the life expectancy index in HDI?",
    "choices": [
      {
        "id": 1,
        "text": "0 years and 65 years"
      },
      {
        "id": 2,
        "text": "20 years and 85 years"
      },
      {
        "id": 3,
        "text": "25 years and 75 years"
      },
      {
        "id": 4,
        "text": "0 years and 100 years"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>minimum</strong> value established for the calculation of the<strong> life expectancy index</strong> in HDI is&nbsp;<strong>20 years</strong> and the <strong>maximum</strong> is<strong> 85 years</strong>.</p>\n<p>These minimum and maximum values are used to calculate the dimension indices in HDI and are called <strong>goalposts</strong>.</p>\n<p>Each dimension index is calculated using the formula:</p>\n<p>Dimension Index = (Actual Value - Minimum Value)/(Maximum Value - Minimum Value). &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true regarding the education index used for calculating the HDI?",
    "choices": [
      {
        "id": 1,
        "text": "It includes expected years of schooling"
      },
      {
        "id": 2,
        "text": "Gross enrollment ratio is  considered"
      },
      {
        "id": 3,
        "text": "Adult literacy rate is not considered"
      },
      {
        "id": 4,
        "text": "Minimum and maximum values are based on global data"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>gross enrollment ratio</strong> is no longer used in obtaining the education index in HDI. It was <strong>used</strong> as an indicator <strong>earlier</strong>.</p>\n<p>The <strong>education index</strong> is calculated by taking into account the\u00a0<strong>mean years </strong>of<strong> schooling </strong>and<strong> expected years </strong>of <strong>schooling</strong><strong>.\u00a0</strong>Maximum and minimum values are based on global data.</p>\n<p>Adult literacy rate and gross enrollment ratio were used as indicators before 2009. \u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following indices measures the deprivation in basic dimensions of the country in human development?",
    "choices": [
      {
        "id": 1,
        "text": "HDI"
      },
      {
        "id": 2,
        "text": "PQLI"
      },
      {
        "id": 3,
        "text": "HPI"
      },
      {
        "id": 4,
        "text": "DALY"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Human poverty index</strong> (HPI) measures <strong>deprivation </strong>in<strong> basic dimensions</strong> of human development.</p>\n<p><strong>HPI-1 </strong>is used for <strong>developing </strong>countries and <strong>HPI-2</strong> is used for <strong>developed </strong>countries.&nbsp;It is based upon the following indicators:</p>\n<table style=\"height: 142px; width: 430.75px;\">\n<tbody>\n<tr>\n<td style=\"width: 115px;\">&nbsp;</td>\n<td style=\"width: 156px;\">\n<p><strong>Human Poverty Index </strong>(HPI-1) for <strong>developing countries&nbsp;</strong></p>\n</td>\n<td style=\"width: 144.75px;\"><strong>Human Poverty Index </strong>(HPI-2) for<strong> selected OECD countries&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 115px;\">A long and healthy life&nbsp;</td>\n<td style=\"width: 156px;\">\n<p>Probability at birth&nbsp;of not surviving to age 40</p>\n</td>\n<td style=\"width: 144.75px;\">Probability at birth of not surviving to age 60</td>\n</tr>\n<tr>\n<td style=\"width: 115px;\">Knowledge</td>\n<td style=\"width: 156px;\">Adult illiteracy rate</td>\n<td style=\"width: 144.75px;\">Percentage of adults lacking functional literacy skills</td>\n</tr>\n<tr>\n<td style=\"width: 115px;\">A decent standard of living</td>\n<td style=\"width: 156px;\">\n<p>Percentage of the population not using an improved water source&nbsp;</p>\n<p>Percentage of children underweight for age</p>\n<p>Deprivation of a decent standard of living</p>\n</td>\n<td style=\"width: 144.75px;\">Percentage of people living below the poverty line&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 115px;\">Social exclusion</td>\n<td style=\"width: 156px;\">Not included as a dimension</td>\n<td style=\"width: 144.75px;\">Long term unemployment rate</td>\n</tr>\n</tbody>\n</table>\n<p>The <strong>range</strong> of HPI is from <strong>0 to 100</strong>. The term HPI has now been replaced with <strong>multidimensional poverty index</strong> (MPI).<strong>&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not included in the Ottawa charter for health promotion?",
    "choices": [
      {
        "id": 1,
        "text": "Develop personal skills"
      },
      {
        "id": 2,
        "text": "Strengthen community action for health"
      },
      {
        "id": 3,
        "text": "Build social security system"
      },
      {
        "id": 4,
        "text": "Reorient health services"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Building social security is not included in the Ottawa charter for health promotion.&nbsp;</p>\n<p>The <strong>first</strong> international <strong>conference</strong>&nbsp;for <strong>health promotion </strong>was held in Ottawa&nbsp;on 21st Nov 1986. It produced a charter known as the&nbsp;<strong>Ottawa charter.</strong></p>\n<p>The charter identified five key action areas as given below:</p>\n<ul>\n<li>Build healthy <strong>public policy</strong></li>\n<li>Create <strong>supportive environment</strong> for health</li>\n<li>Strengthen <strong>community action</strong> for health</li>\n<li>Develop <strong>personal skills</strong></li>\n<li><strong>Reorient</strong> health services &nbsp; &nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cfffad250fb74412b8cf43a7d03ba8f5x1280x1339.JPEG"
    ]
  }
];
        let quizName = '02 Health Determinants And Indicators';
        const quizFilename = '02-health-determinants-and-indicators-aef29102.html';
        let hierarchy = ["Marrow", "qBank", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>