<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28 Molecular Genetics, Recombinant Dna & Genomic Technology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Biochemistry
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Enzymes that cut DNA at specific DNA sequences within the molecule are _____",
    "choices": [
      {
        "id": 1,
        "text": "Helicase enzyme"
      },
      {
        "id": 2,
        "text": "Polymerase enzyme"
      },
      {
        "id": 3,
        "text": "Restriction enzyme"
      },
      {
        "id": 4,
        "text": "Gyrase enzyme"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Enzymes that cut DNA at specific DNA sequences within the molecule are called <strong>restriction enzymes.</strong></p>\n<p>These defensive enzymes protect the host bacterial DNA from the DNA genome of foreign organisms (primarily infective phages) by specifically inactivating the invading phage DNA by digestion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Restriction enzymes are found with ______",
    "choices": [
      {
        "id": 1,
        "text": "Site-specific DNA methylases"
      },
      {
        "id": 2,
        "text": "RNA-inducible interferon system"
      },
      {
        "id": 3,
        "text": "Thermostable DNA polymerases"
      },
      {
        "id": 4,
        "text": "Terminal transferase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Restriction enzymes</strong> are found with <strong>site-specific DNA methylases.</strong></p>\n<p>Restriction endonucleases are present in cells that also have a companion enzyme that site-specifically methylates the host DNA, thus rendering it an unsuitable substrate for digestion by that particular restriction enzyme.</p>\n<p>Thus, <strong>site-specific DNA</strong> <strong>methylases </strong>and restriction enzymes that target the same sites always exist in pairs in a bacterium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Restriction endonuclease will act on which of the following:",
    "choices": [
      {
        "id": 1,
        "text": "AAGAAG"
      },
      {
        "id": 2,
        "text": "GAGAGG"
      },
      {
        "id": 3,
        "text": "AAGCTT"
      },
      {
        "id": 4,
        "text": "TACGAG"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Restriction endonucleases can act on <strong>AAGCTT.</strong>\u00a0</p>\n<p>Restriction endonucleases act and cleave at the site of a\u00a0<strong>palindromic</strong> sequence. A palindromic sequence is a sequence that reads the same backward and forward. An example is listed below.</p>\n<p>5' --AAGCTT-- 3'<br />3' --TTCGAA-- 5'</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tools of recombinant DNA technology is incorrectly paired with its use?",
    "choices": [
      {
        "id": 1,
        "text": "DNA polymerase - copies DNA sequences in the polymerase chain reaction"
      },
      {
        "id": 2,
        "text": "DNA ligase - enzyme that cuts DNA, creating sticky ends"
      },
      {
        "id": 3,
        "text": "Reverse transcriptase - production of cDNA from mRNA"
      },
      {
        "id": 4,
        "text": "Electrophoresis - RFLP analysis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>DNA <strong>ligase</strong> is<strong> not </strong>paired correctly with its use for cutting DNA and creating sticky ends. DNA ligase <strong>joins </strong>the <strong>adjacent nucleotides</strong> in a <strong>covalent</strong> linkage.</p>\n<p><strong>Restriction endonucleases</strong> cut DNA at specific sites creating sticky ends.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Gene cloning uses _____.",
    "choices": [
      {
        "id": 1,
        "text": "Plasmids"
      },
      {
        "id": 2,
        "text": "Noncoding nucleotide sequences"
      },
      {
        "id": 3,
        "text": "Bacteriophage"
      },
      {
        "id": 4,
        "text": "A & C"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Gene cloning\u00a0</strong>uses both <strong>plasmids</strong> and <strong>bacteriophages</strong>.</p>\n<p><strong>Hybrid</strong> <strong>DNA</strong> molecules can be <strong>constructed</strong> in <strong>cloning</strong> vectors typically using<strong> bacterial plasmids, phages</strong>, or cosmids. A <strong>clone </strong>is a large population of identical molecules, bacteria, or cells that arise from a common ancestor. Molecular cloning allows for the production of a large number of identical DNA molecules, which can then be characterized or used for other purposes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cloning vectors has linear DNA?",
    "choices": [
      {
        "id": 1,
        "text": "Phages"
      },
      {
        "id": 2,
        "text": "Plasmid"
      },
      {
        "id": 3,
        "text": "Cosmid"
      },
      {
        "id": 4,
        "text": "All of above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Phages</strong> have <strong>linear </strong>DNA into which <strong>foreign DNA</strong> can be inserted at several <strong>restriction enzyme sites.</strong></p>\n<p>Amplification of DNA (cloning) is done using cloning vectors - bacterial <strong>plasmids, phages,</strong> or <strong>cosmids.</strong></p>\n<p><strong>Bacterial plasmids</strong> are small, <strong>circular,</strong> duplex DNA molecules whose natural function is to confer <strong>antibiotic resistance</strong> to the host cell. <strong>Cosmid</strong> is a plasmid into which the DNA sequences from <strong>bacteriophage lambda</strong> (\u03bb <em>cos</em> sites) have been inserted. This enables the packaging of plasmid DNA in vitro. They have a small, <strong>circular,</strong> duplex DNA. (Options B and C)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Genomic library is a term used to describe ______",
    "choices": [
      {
        "id": 1,
        "text": "A computerized listing of known DNA sequences"
      },
      {
        "id": 2,
        "text": "Bacterial plasmids containing DNA fragments representing the majority of the genetic information from a plant or animal"
      },
      {
        "id": 3,
        "text": "A library of complementary DNA copies of the population of mRNAs in a tissue"
      },
      {
        "id": 4,
        "text": "A compilation of the amino acid sequences of protein coding genes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A genomic library is <strong>bacteria</strong> with <strong>plasmids</strong> containing DNA fragments representing the majority of the genetic information from a plant or animal.</p>\n<p><strong>Gene library </strong>describes the combination of restriction enzymes and various cloning vectors allows the entire genome of an organism to be individually packed into a vector. A collection of these different <strong>recombinant clones</strong> is called a library.</p>\n<p><strong>A genomic library </strong>is prepared from the total DNA of a cell line or tissue. <strong>A cDNA library</strong> comprises complementary DNA copies of the population of mRNAs in a tissue. (option C)</p>\n<p>Genomic DNA libraries are often prepared by performing partial digestion of total DNA with a restriction enzyme that cuts DNA frequently.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Northern blotting is used for detection of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "DNA"
      },
      {
        "id": 2,
        "text": "RNA"
      },
      {
        "id": 3,
        "text": "Proteins"
      },
      {
        "id": 4,
        "text": "None"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Northern</strong> <strong>blotting</strong> is used for the detection of RNA.</p>\n<p><strong>Southern</strong> <strong>blotting</strong> is used for the detection of DNA and <strong>Western</strong> <strong>blotting</strong> is used for the detection of protein.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4f45aa909d44abd8abf483d6fee594bx1196x998.PNG"
    ]
  },
  {
    "text": "What is the correct sequence of events in Southern blotting?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "2, 1, 3"
      },
      {
        "id": 3,
        "text": "3, 1, 2"
      },
      {
        "id": 4,
        "text": "2, 3, 1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In Southern blotting<strong> DNA fragments </strong>are first separated by<strong> electrophoresis.</strong></p>\n<ul>\n<li>The DNA in the gel is then made single-stranded by exposure to dilute alkali, and transferred by capillary action to the nylon membrane, which is laid over it. The relative positions of the different DNA fragments are thus preserved on the membrane.</li>\n<li>The membrane is then soaked in buffer containing the labelled probe, which base pairs with the DNA fragment of interest.</li>\n<li>The position of that fragment is then determined by autoradiographic (exposure of the membrane to X-ray film), or fluorescent detection of the hybridized probe.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7a976265f58f462db822daefeb3bf6a9x800x494.JPEG"
    ]
  },
  {
    "text": "Approximately how many polymerase chain reaction (PCR) products are produced from a single template DNA molecule in a PCR reaction that continues for 30 cycles?",
    "choices": [
      {
        "id": 1,
        "text": "64"
      },
      {
        "id": 2,
        "text": "128,000"
      },
      {
        "id": 3,
        "text": "Approximately 1 million"
      },
      {
        "id": 4,
        "text": "Approximately 1 billion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A <strong>PCR reaction</strong> that continues for <strong>30 cycles</strong> will produce <strong>approximately </strong><strong>1 billion</strong> PCR products <strong>from a single template DNA molecule.</strong></p>\n<p>Polymerase chain reaction (<strong>PCR)\u00a0</strong>is a method of amplifying a target sequence of DNA. DNA sequences as short as 50 to 100 bp and as long as 10 kb can be amplified by PCR. The amplification is exponential.</p>\n<ul>\n<li>20 cycles provide amplification of 2<sup>20 </sup>=\u00a010<sup>6</sup>\u00a0 or 1 million copies</li>\n<li><strong>30 cycles </strong>provide an amplification\u00a0of<strong> 2<sup>30 </sup>=10<sup>9</sup>\u00a0or 1 billion copies</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is NOT required for a PCR reaction?",
    "choices": [
      {
        "id": 1,
        "text": "A thermostable DNA polymerase"
      },
      {
        "id": 2,
        "text": "Dideoxy-dNTPs (ddNTPs)"
      },
      {
        "id": 3,
        "text": "Primers"
      },
      {
        "id": 4,
        "text": "Template DNA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Dideoxy-dNTPs (ddNTPs)</strong> is <strong>not required in PCR reaction.</strong></p>\n<p>In a PCR reaction, the DNA sample is first <strong>heat-denatured</strong> (&gt;90\u00b0C) to separate the two strands of the template DNA containing the target sequence. The primers, added in excess, are allowed to <strong>anneal</strong> to the DNA (typically 50\u201375\u00b0C); and each strand is copied by a <strong>DNA polymerase,</strong> starting at the <strong>primer</strong> sites in the presence of all four dNTPs(again in vast excess).</p>\n<p>DNA synthesis is catalyzed by a heat-stable DNA polymerase purified from one of a number of different thermophilic bacteria, organisms that grow at 70\u201380\u00b0C.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a function of PCR?",
    "choices": [
      {
        "id": 1,
        "text": "To detect infectious agents, especially latent viruses"
      },
      {
        "id": 2,
        "text": "Make prenatal genetic diagnoses"
      },
      {
        "id": 3,
        "text": "Detect allelic polymorphisms"
      },
      {
        "id": 4,
        "text": "All"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All of the listed options are applications of PCR.</p>\n<p>The <strong>applications of PCR</strong> to forensic medicine are as follows:</p>\n<ul>\n<li>To detect <strong>infectious agents,</strong> especially latent viruses</li>\n<li>Make <strong>prenatal genetic</strong> diagnoses</li>\n<li>Detect <strong>allelic polymorphisms</strong></li>\n<li>Establish precise tissue types for transplants</li>\n<li>To study evolution, using DNA from archeological samples</li>\n<li>For quantitative RNA analyses after RNA copying and mRNA quantitation by the so-called RT-PCR method (cDNA copies of mRNA generated by a retroviral reverse transcriptase)</li>\n<li>To score in vivo protein-DNA occupancy using chromatin immunoprecipitation assays</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "RT-PCR is a method that is used for _____",
    "choices": [
      {
        "id": 1,
        "text": "Forensic analysis of DNA"
      },
      {
        "id": 2,
        "text": "Amplification of genomic DNA sequences"
      },
      {
        "id": 3,
        "text": "Amplification of mRNA sequences only"
      },
      {
        "id": 4,
        "text": "Analysis of mRNA expression and its amplification"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>RT-PCR is a method that is used for analysis of <strong>mRNA expression</strong> and its <strong>amplification</strong>.</p>\n<p>Reverse transcriptase polymerase chain reaction (RT-PCR) is a variant of PCR and includes 2 steps:</p>\n<ul>\n<li>Generation of complementary DNA (cDNA copies) from mRNA using reverse transcriptase - used to qualitatively detect gene expression</li>\n<li>Amplification of newly synthesized cDNA by traditional PCR -This can be quantitatively measured by using fluorescent dyes (qRT-PCR).</li>\n</ul>\n<p>Uses:\u00a0</p>\n<ul>\n<li>Determination of viral load in disease</li>\n<li>Screening of genetic diseases and cancers</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33a13042b6fd4728823907ff940fdcddx335x424.JPEG"
    ]
  },
  {
    "text": "Which of the following statements about forensic analysis of DNA is correct?",
    "choices": [
      {
        "id": 1,
        "text": "A DNA profile using short tandem repeats is  not unique to an individual"
      },
      {
        "id": 2,
        "text": "Forensic analysis makes use of SNPs in coding sequences to distinguish between individuals"
      },
      {
        "id": 3,
        "text": "PCR is used for DNA profiling (DNA fingerprinting)"
      },
      {
        "id": 4,
        "text": "DNA fingerprinting cannot be used for paternity testing"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>PCR </strong>is used for<strong> DNA profiling </strong>(DNA fingerprinting).</p>\n<p>The <strong>PCR</strong> allows the DNA in a single cell, hair follicle, or spermatozoon to be amplified and analyzed. Thus, the applications of PCR to forensic medicine are obvious. <strong>DNA fingerprinting</strong>, or DNA profiling, is used for forensic analysis of crime scenes and paternity testing (Option D).\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Short Tandem Repeat</strong> <strong>(STR)</strong> are short sequences of DNA at scattered locations in the genome, repeated in tandem (one after the other). E.g., CG-CG-CG-CG-CG. The number of these repeat units varies from person to person but is unique for any given individual and, therefore, serves as a molecular fingerprint.</p>\n<p>Option B:<strong> Single Nucleotide Polymorphism(SNP)</strong>\u00a0refers to variations that involve just one base at a given locus (Eg., base C replaced by base A), which can occur within exons, introns, intergenic or coding regions. They are almost always biallelic and are majorly used in the definition of inherited diseases where the functional deficit is unknown. Each of these variations is present to some appreciable degree within a population and hence not unique to an individual.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which technique of gene localization is a radioactive probe used?",
    "choices": [
      {
        "id": 1,
        "text": "Somatic cell hybridization"
      },
      {
        "id": 2,
        "text": "In situ hybridization"
      },
      {
        "id": 3,
        "text": "Fluorescence in situ hybridization (FISH)"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>In situ hybridization </strong>uses<strong>\u00a0</strong>a <strong>radioactive probe</strong>\u00a0for gene localization.</p>\n<p>It is added to a metaphase spread of chromosomes on a glass slide. The exact area of hybridization is localized by layering photographic emulsion over the slide and after exposure, lining up the grains with some histologic identification of the chromosome.</p>\n<p>Fluorescence in situ hybridization (FISH) utilizes <strong>fluorescent probes</strong>, not radioactive probes. Fluorescent probes have greater safety, stability, and ease of detection (Option C).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following diseases is an example of point mutation?",
    "choices": [
      {
        "id": 1,
        "text": "Hemoglobin Lepore"
      },
      {
        "id": 2,
        "text": "\u03b2-Thalassemia type III"
      },
      {
        "id": 3,
        "text": "Diabetes"
      },
      {
        "id": 4,
        "text": "Sickle cell disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sickle cell disease</strong> is caused by a point mutation.\u00a0</p>\n<p>This is caused by mutation of a single base out of the 3 \u00d7 10<sup>9</sup> in the genome, a <strong>T-to-A</strong> DNA substitution, resulting in an <strong>A-to-U</strong> change in the <strong>mRNA</strong> corresponding to the <strong>sixth codon</strong> of the \u03b2-globin gene.</p>\n<p>Defective production of \u03b2-globin results in a variety of diseases and is due to many different lesions in and around the \u03b2-globin gene.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Restriction fragment length polymorphism (RFLP) is used to ______",
    "choices": [
      {
        "id": 1,
        "text": "Construct high resolution linkage map"
      },
      {
        "id": 2,
        "text": "Identify single gene disease"
      },
      {
        "id": 3,
        "text": "Construct QTL maps"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Restriction fragment length polymorphism (<strong>RFLP</strong>) is used to construct a <strong>high-resolution linkage map</strong>, <strong>QTL maps</strong>, and <strong>identify single gene-disease</strong>.</p>\n<p>An<strong> inherited difference </strong>in the <strong>pattern</strong> of <strong>restriction enzyme digestion</strong> (e.g., a DNA variation occurring in more than 1% of the general population) is known as a restriction fragment length polymorphism (RFLP). RFLPs result from single-base changes (e.g., sickle-cell disease) or from deletions or insertions (CNVs) of DNA into a restriction fragment (eg, the thalassemias) and have proved to be useful diagnostic tools.</p>\n<p>SNPs(single nucleotide polymorphisms)/RFLPs can be used to establish linkage groups, which in turn, by the process of chromosome walking<strong>,</strong> will eventually define the disease locus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is correct regarding CRISPR-Cas9?",
    "choices": [
      {
        "id": 1,
        "text": "It is a system used by bacterial cells to recognise and destroy viral DNA as a form of adaptive immunity"
      },
      {
        "id": 2,
        "text": "It is a tool which is designed to detect TB"
      },
      {
        "id": 3,
        "text": "It is tool designed to test air pollution"
      },
      {
        "id": 4,
        "text": "It is a tool used in DNA sequencing"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>CRISPR-Cas9</strong> <strong>system</strong>, found in many <strong>bacteria</strong>, represents a form of <strong>acquired, or adaptive immunity</strong> <strong>to infection by bacteriophages</strong>, which complements the system of restriction endonucleases and methylases.</p>\n<p>In recent years, a novel DNA editing/gene regulatory system termed Clustered Regularly Interspersed Short Palindromic Repeats- CRISPR-associated gene 9 (CRISPR-Cas9) has been developed. CRISPR uses RNA-based targeting to bring the Cas9 nuclease to foreign (or any complementary) DNA.</p>\n<p>Within bacteria, this CRISPR-RNA-Cas9 complex then <strong>degrades</strong> and inactivates the <strong>targeted DNA.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following site does the restriction enzyme act when RFLP is used in-order to identify the five different species of staphylococci in a surgical ICU?",
    "choices": [
      {
        "id": 1,
        "text": "ATGGAC-TACGTG"
      },
      {
        "id": 2,
        "text": "GATATC- CTATAG"
      },
      {
        "id": 3,
        "text": "TAGATA-ATCTCT"
      },
      {
        "id": 4,
        "text": "AATATA-TATAAT"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Restriction endonuclease </strong>enzymes act at <strong>specific palindromic sequences</strong> that create DNA fragments of different lengths. By analyzing the fragments, specific species of bacteria can be identified. Option B is the only palindromic sequence here, hence it is the answer.</p>\n<p>RFLP is a restriction fragment length polymorphism (RFLP) analysis technique that involves cutting a particular region of DNA with known variability, with restriction enzymes, then separating the DNA fragments by agarose gel electrophoresis and determining the number of fragments and relative sizes.\u00a0</p>\n<p><strong>Cleavage</strong> of a <strong>sample</strong> of <strong>DNA</strong>\u00a0with a\u00a0<strong>restriction enzyme</strong>\u00a0produces a\u00a0characteristic set of <strong>smaller DNA fragments</strong>. Deviations in the normal product pattern, produce RFLPs that occur if a mutation renders a restriction site unrecognizable and alternatively, generates a new recognition site.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the best screening investigation for metabolic disorders?",
    "choices": [
      {
        "id": 1,
        "text": "Western blot"
      },
      {
        "id": 2,
        "text": "Tandem mass spectrometry"
      },
      {
        "id": 3,
        "text": "PCR"
      },
      {
        "id": 4,
        "text": "Gel electrophoresis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tandem mass spectrometry</strong>\u00a0(MS) is the technique of choice for <strong>screening neonates</strong> for <strong>inherited metabolic diseases.</strong></p>\n<p>Tandem MS employs the equivalent of two mass spectrometers linked in series (MS-MS or MS2). It can be used to screen blood samples from newborns for the presence and concentrations of amino acids, fatty acids, and other metabolites.</p>\n<p><strong>Abnormalities in metabolite levels</strong>\u00a0indicate inherited<strong> metabolic diseases</strong>, such as phenylketonuria, ethylmalonic encephalopathy, and glutaric acidemia type 1.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The best method to measure HbA1C is ________",
    "choices": [
      {
        "id": 1,
        "text": "Isoelectric focusing"
      },
      {
        "id": 2,
        "text": "Affinity chromatography"
      },
      {
        "id": 3,
        "text": "Ion exchange chromatography"
      },
      {
        "id": 4,
        "text": "Electrophoresis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The best method to measure <strong>HBA1C</strong> is<strong>\u00a0ion-exchange chromatography</strong>.</p>\n<p>In ion-exchange chromatography:</p>\n<ul>\n<li>Proteins interact with the <strong>stationary phase</strong> by <strong>charge-charge interactions.</strong></li>\n<li>Proteins with a net positive charge at a given pH will tightly adhere to beads with negatively charged functional groups such as carboxylates or sulfates (<strong>cation exchangers</strong>).</li>\n<li>Proteins with a net negative charge adhere to beads with positively charged functional groups, typically tertiary or quaternary amines (<strong>anion exchangers</strong>).</li>\n<li><strong>Non-adherent proteins</strong> flow through the matrix and are <strong>washed away</strong>.</li>\n<li>Proteins elute in inverse order of the strength of their interactions with the stationary phase.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the phenomenon shown below.",
    "choices": [
      {
        "id": 1,
        "text": "Translation"
      },
      {
        "id": 2,
        "text": "Transformation"
      },
      {
        "id": 3,
        "text": "Complementation"
      },
      {
        "id": 4,
        "text": "Conjugation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows a schematic representation of the <strong>blue-white assay</strong> used in the <strong>screening of recombinant vectors\u00a0for inserted DNA fragments</strong>. It uses the phenomenon of <strong>complementation\u00a0</strong>(\u03b1lpha-complementation of the \u03b2-galactosidase gene).</p>\n<p>Blue white assay: The DNA of interest is ligated into a vector. The vector is then inserted into a competent host cell viable for transformation, which is then grown in the presence of X-gal (X-gal detects active \u03b2-galactosidase). Cells transformed with vectors containing <strong>recombinant DNA </strong>will produce<strong> white colonies </strong>whereas\u00a0cells transformed with non-recombinant plasmids (i.e. only the vector) grow into blue colonies.</p>\n<p>The image below shows the result of a blue-white assay.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e3cfb150996e46179163a897cd3823ca.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53a706e417e4439889c4fec0a2189b5ex600x600.JPEG"
    ]
  },
  {
    "text": "In a patient with chronic myeloid leukemia, the translocation in Philadelphia chromosome is best studied by",
    "choices": [
      {
        "id": 1,
        "text": "G banding"
      },
      {
        "id": 2,
        "text": "SKY"
      },
      {
        "id": 3,
        "text": "Southern blotting"
      },
      {
        "id": 4,
        "text": "DNA sequencing"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>\u00a0Translocation in the <strong>Philadelphia chromosome</strong> (a reciprocal translocation between chromosomes 9 and 22) is best studied by <strong>SKY</strong>.</p>\n<p>SKY stands for spectral karyotyping or multicolor FISH (M Fish). This technique allows one to display all the chromosomes together and thus help identify chromosomal defects in conditions such as chronic myeloid leukemia.</p>\n<p>Other options:</p>\n<p>Option A: G banding is also a karyotyping technique but SKY is a better option between the two.</p>\n<p>Option C: Southern blotting is a technique used to detect a specific DNA sequence in a tissue sample.\u00a0</p>\n<p>Option D: DNA sequencing cannot detect structural abnormality in a chromosome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/946f4259ae2246a78788d68a618cd237x432x342.PNG"
    ]
  },
  {
    "text": "Which of the following techniques is used for the detection of variations in DNA sequences and gene expression?",
    "choices": [
      {
        "id": 1,
        "text": "Microarray technique"
      },
      {
        "id": 2,
        "text": "Northern blot"
      },
      {
        "id": 3,
        "text": "Southern blot"
      },
      {
        "id": 4,
        "text": "South western blot"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>DNA microarray</strong> can be used to detect DNA sequence variations.</p>\n<p>There are various microarray techniques used in clinical practice which are described below:</p>\n<p><strong>DNA Microarray</strong> technique or <strong>DNA chip:</strong></p>\n<ul>\n<li>To the DNA chip containing <strong>known </strong>oligonucleotide sequence, flourescent labelled unknown oligonucleotide is added.</li>\n<li>The computerised algorithms can decode the unknown oligonucleotide, by detecting the location of flourescent hybridization pattern on the chip.</li>\n<li>This technique is used for genotyping or genome sequencing.</li>\n</ul>\n<p><strong>RNA microarray:\u00a0</strong>RNA microarray can detect gene expression.</p>\n<ul>\n<li>To the known array of oligonucleotide, flourecently labelled cDNA prepared from unknown mRNA is added, and the unknown cDNA is decoded</li>\n<li>This technique is used for gene expression studies</li>\n</ul>\n<p><strong>Protein microarray:</strong></p>\n<ul>\n<li>Known antibodies placed on glass slide and flourescently tagged target protein added. Target protein is detected by antigen antibody interaction.</li>\n<li>This technique is used in study of proteomics</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/85ab52626cc341b3ac7992df6167bffex436x258.PNG"
    ]
  },
  {
    "text": "Array CGH can detect all except?",
    "choices": [
      {
        "id": 1,
        "text": "Mutation in cancers"
      },
      {
        "id": 2,
        "text": "Subtelomeric deletion"
      },
      {
        "id": 3,
        "text": "Balanced translocation"
      },
      {
        "id": 4,
        "text": "Aneuploidy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Array CGH cannot detect <strong>balanced translocation.</strong></p>\n<p>In Array-based CGH, two genomes are compared. The test DNA and the reference DNA are labelled with <strong>two different flourescent dyes</strong> (red and green respectively) and are added to a DNA chip spotted with entire human genome.</p>\n<ul>\n<li>If the contribution of both sample are <strong>equal</strong> for a given chromosomal region, then all spots on the array will flouresce <strong>yellow.</strong></li>\n<li>If the test sample has <strong>amplification,</strong> that spot will fluoresce <strong>red</strong></li>\n<li>If the test sample has a <strong>deletion,</strong> that spot will fluoresce <strong>green</strong></li>\n</ul>\n<p>Uses of Array CGH:</p>\n<ul>\n<li>To detect gene amplification</li>\n<li>To detect gene deletion\u00a0</li>\n<li>To detect copy number variations</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The correct order of steps in Polymerase Chain Reaction (PCR) is:",
    "choices": [
      {
        "id": 1,
        "text": "Hybridisation,  Annealing, Elongation, Denaturation"
      },
      {
        "id": 2,
        "text": "Elongation, Denaturation, Hybridisation, Annealing"
      },
      {
        "id": 3,
        "text": "Denaturation, Annealing, Extension"
      },
      {
        "id": 4,
        "text": "Annealing, Extension, Denaturation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct sequence of events for PCR among the given options is <strong>denaturation, annealing,</strong> and <strong>extension.</strong></p>\n<p>The process of PCR is as follows:</p>\n<p>The DNA sample is\u00a0<strong>first heat-denatured at &gt;90\u00b0C</strong> (90-96 degrees Celsius for 3 minutes) to separate the two strands of the template DNA containing the target sequence; the primers (which <strong>attach to the 3' end</strong>\u00a0of the flanking sequence) are added in excess, are allowed<strong> to anneal</strong>\u00a0to the DNA (typically at 50-75\u00b0C) in order to generate the required template-primer <strong>hybridization</strong> complex. Under suitable conditions and presence of deoxynucleotides, elongation of the DNA stand occurs.\u00a0</p>\n<p>The number of copies produced in the presence of an unlimited supply of deoxynucleotides and enzymes is given by - 2 to the power n (where n is the number of PCR cycles)</p>\n<ul>\n<li>20 cycles provide an amplification of 2<sup>20\u00a0</sup>=\u00a010<sup>6</sup>\u00a0 or 1 million copies</li>\n<li><strong>30 cycles</strong> provides an <strong>amplification</strong>\u00a0of <strong>2<sup>30\u00a0</sup>=10<sup>9</sup></strong>\u00a0or <strong>1 billion copies</strong></li>\n</ul>\n<p>Below is an image showing the various ingredients for carrying out PCR.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00259612bf874a4689f10de608ce3e3dx1280x2299.JPEG"
    ]
  },
  {
    "text": "Wobble hypothesis explains which of the following concepts of the genetic code?",
    "choices": [
      {
        "id": 1,
        "text": "Universal"
      },
      {
        "id": 2,
        "text": "Unambiguous"
      },
      {
        "id": 3,
        "text": "Degeneracy"
      },
      {
        "id": 4,
        "text": "Non-punctuated"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The wobble hypothesis explains the <strong>degeneracy</strong> of the genetic code.</p>\n<p>The <strong>wobble hypothesis</strong> states that codon-anticodon pairing follows the traditional<strong> Watson\u2013Crick </strong>rules (G pairs with C and A pairs with U) for the <strong>first two bases</strong> of the codon but can be less stringent for the third/last base. It has been observed that a tRNA can recognize more than one codon for a specific amino acid, especially in the last nucleotide of the codon triplet. This is referred to as degeneracy and its mechanism can be explained by the wobble hypothesis.</p>\n<p>The first base of the anticodon moves to permit\u00a0<strong>nontraditional pairing </strong>with the last base of the codon. This movement is called <strong>wobble</strong> and is possible because the first base of the anticodon is not as spatially defined as the other two bases. Due to the wobbling, 61 tRNA species are not required to read the 61 codons.</p>\n<p>For example, three codons for glycine\u2014GGU, GGC, and GGA\u2014can form a base pair from one anticodon, 3\u2032 CCI 5\u2032 ie, I, inosine, can base pair with U, C, and A, as shown in the diagram below.</p>\n<p>Other options:</p>\n<p>Option A: The genetic code is <strong>universal</strong> because it is the same for all living organisms.</p>\n<p>Option B: The genetic code is <strong>unambiguous</strong> because each codon is specific for only one amino acid. Example: GGA only codes for Glycine.</p>\n<p>Option D: The genetic code is <strong>non-punctuated. </strong>This means that once the reading commences at a specific start codon, it is continuous and is read continuously as triplets until a stop codon is reached without stopping.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e2ad80f76c940efad91da49b943c477x562x1198.PNG"
    ]
  }
];
        let quizName = '28 Molecular Genetics, Recombinant Dna & Genomic Technology';
        let hierarchy = ["Marrow", "qBank", "Biochemistry"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>