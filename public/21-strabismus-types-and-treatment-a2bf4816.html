<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21 Strabismus - Types And Treatment - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A child is brought by her parents to the OPD with complaints of crossed eyes as shown below. By doing a simple torchlight test you conclude that the child has pseudostrabismus and the inter-pupillary distance is normal. Which of the following can be associated with the child's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Negative angle kappa"
      },
      {
        "id": 2,
        "text": "Hypertelorism"
      },
      {
        "id": 3,
        "text": "Hypermetropia"
      },
      {
        "id": 4,
        "text": "History of retinopathy of prematurity"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;</p>\n<p>Few definitions:&nbsp;</p>\n<ul>\n<li><strong>Orthophoria-</strong> implies perfect ocular alignment in the absence of any stimulus for fusion</li>\n<li><strong>Heterophoria</strong> (\"phoria\")- implies a tendency of the eyes to deviate when fusion is blocked <strong>(latent squint)</strong></li>\n<li><strong>Heterotropia</strong> (\"tropia\")- implies a <strong>manifest deviation</strong> in which the visual axes do not intersect at the point of fixation</li>\n<li><strong>Hypertropia- upward displacement</strong> of one eye relative to the other is termed as hypertropia and a latent upward imbalance, a hyperphoria</li>\n<li><strong>Hypotropia- downward displacement</strong> is termed a hypotropia and a latent imbalance, a hypophoria</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed356eb74ef14ae7a301d7c9c51caee0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5de7d8f605da4180919804bea79e194dx1280x3637.JPEG"
    ]
  },
  {
    "text": "A child presents to the OPD with a mild squint. The rest of the history is quite insignificant. On examination, Hirschberg's corneal reflex test is found to be normal. All other eye parameters are also normal except for hypertelorism. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudoesotropia"
      },
      {
        "id": 2,
        "text": "Exophoria"
      },
      {
        "id": 3,
        "text": "Esophoria"
      },
      {
        "id": 4,
        "text": "Psuedoexotropia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>pseudoexotropia.</strong></p>\n<p><strong>Features of Pseudoexotropia:</strong></p>\n<ul>\n<li>Normal Hirschberg's corneal reflex test</li>\n<li>Apparent <strong>divergent</strong> squint</li>\n<li>Associated with hypertelorism/a <strong>positive</strong> angle kappa.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61695a88dfd24e7f8c450ea8f7eb36d0x1280x3637.JPEG"
    ]
  },
  {
    "text": "Which of the following conditions is least likely to present with diplopia?",
    "choices": [
      {
        "id": 1,
        "text": "Manifest squint"
      },
      {
        "id": 2,
        "text": "Paralytic squint"
      },
      {
        "id": 3,
        "text": "Latent squint"
      },
      {
        "id": 4,
        "text": "Restrictive squint"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Latent squint <strong>does not always</strong> present with <strong>diplopia.</strong></p>\n<p><strong>Heterophoria </strong>(Latent squint)&nbsp;is a condition in which the tendency of the eyes to deviate is kept <strong>latent </strong>by <strong>fusion</strong>. When the influence of fusion is removed, the visual axis of one eye deviates away.</p>\n<p><strong>Types:</strong></p>\n<ul>\n<li><strong>Esophoria-</strong>convergent</li>\n<li><strong>Exophoria-</strong>divergent</li>\n<li>Hyperphoria-deviation upwards</li>\n<li>Hypophoria-deviation downwards</li>\n<li>Cyclophoria-rotation around AP axis</li>\n</ul>\n<p><strong>Symptoms:</strong></p>\n<ul>\n<li>Usually <strong>asymptomatic-</strong>compensated type.</li>\n<li>In cases where there are symptoms-decompensated type\n<ul>\n<li>Headache</li>\n<li>Eye ache</li>\n<li>Photophobia</li>\n<li>Intermittent diplopia (only under fatigue &ndash; temporarily)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common type of squint seen in children?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital esotropia"
      },
      {
        "id": 2,
        "text": "Congenital exotropia"
      },
      {
        "id": 3,
        "text": "Accommodative esotropia"
      },
      {
        "id": 4,
        "text": "Primary exotropia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Accommodative </strong>esotropia is the <strong>most common</strong> type of squint seen in children.</p>\n<p><strong>Most common</strong> type of squint <strong>overall</strong>:&nbsp;<strong>a</strong><strong>ccommodative </strong>esotropia</p>\n<p><strong>Second</strong> most common <strong>overall:</strong>&nbsp;<strong>co</strong><strong>ngenital</strong>/<strong>Infantile </strong>esotropia</p>\n<p>Most common type of <strong>exotropia:</strong>&nbsp;<strong>primary</strong> exotropia</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true regarding comitant squint?",
    "choices": [
      {
        "id": 1,
        "text": "Primary deviation > Secondary deviation"
      },
      {
        "id": 2,
        "text": "Primary deviation < Secondary deviation"
      },
      {
        "id": 3,
        "text": "Primary deviation = Secondary deviation"
      },
      {
        "id": 4,
        "text": "No co-relation between primary and secondary deviations"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In&nbsp;<strong>comitant squint (concomitant)</strong>, the primary deviation is <strong>equal to</strong>&nbsp;the secondary deviation.</p>\n<p>Primary deviation = Deviation of the&nbsp;<strong>squinting</strong> eye</p>\n<p>Secondary deviation = Deviation of the&nbsp;<strong>normal</strong> eye under cover when the patient fixes with the&nbsp;squinting eye.</p>\n<p>In <strong>incomitant</strong> (paralytic and restrictive squint),<strong> secondary deviation &gt; primary deviation</strong> due to <strong>Herring's Law of equal innervation.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother noticed that her child has had malaligned eyes since birth but she couldn't afford treatment due to financial constraints.  She now presents at 2-months of age and the child has the following finding on examination. An ophthalmoscopic examination under full cycloplegia reveals no abnormalities in refraction and media. Cranial nerves are intact. Which of the following statements is true regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Angle of deviation is large and constant."
      },
      {
        "id": 2,
        "text": "Amblyopia develops in 90 % of the cases."
      },
      {
        "id": 3,
        "text": "It is associated with latent vertical nystagmus."
      },
      {
        "id": 4,
        "text": "Correction by spectacles is the treatment of choice."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The age at presentation, esotropia, no refractory error, no media opacities, and no cranial nerve palsies suggest a diagnosis of<strong> essential infantile esotropia</strong>. The<strong>&nbsp;angle of deviation</strong> in infantile esotropia is fairly <strong>large (&gt; 30&deg;) and constant.</strong></p>\n<p>Infantile esotropia, also known as non-accommodative esotropia is the <strong>most common type of congenital esotropia</strong>.</p>\n<p>Clinical features:</p>\n<ul>\n<li>Comitant convergent squint</li>\n<li>Age of onset-&nbsp;<strong>1 to 2</strong> months</li>\n<li>Angle of <strong>deviation</strong>-<strong>&nbsp;large</strong> and constant</li>\n<li><strong>Amblyopia-</strong>&nbsp;develops in<strong> 25&ndash;40% </strong>of cases</li>\n<li><strong>Associations include:</strong>\n<ul>\n<li>Inferior oblique <strong>overaction</strong></li>\n<li><strong>Dissociated vertical deviation</strong> (70%)</li>\n<li><strong>Latent horizontal nystagmus</strong></li>\n</ul>\n</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li><strong>Surgery-</strong>&nbsp;treatment of choice</li>\n<li>Amblyopia correction measures: Patching of normal eye</li>\n<li><strong>Recession </strong>of both <strong>medial recti</strong></li>\n<li>Timing: Preferably <strong>before 1 year</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b7a64f752ead4f37943f43d2659af0f5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A surgeon decides to resect a part of a muscle while operating on a case of strabismus. This action would lead to which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Weakening of the muscle"
      },
      {
        "id": 2,
        "text": "Strengthening of the muscle"
      },
      {
        "id": 3,
        "text": "Paralysis of the muscle"
      },
      {
        "id": 4,
        "text": "No change in strength of the muscle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In squint surgery, <strong>muscle resection</strong> leads to the&nbsp;<strong>strengthening</strong> of the&nbsp;<strong>muscle.</strong></p>\n<p>The main types of procedure in<strong> squint surgery</strong> are as follows:</p>\n<ol>\n<li><strong>Weakening</strong> to decrease the effective strength of action of a muscle.\n<ul>\n<li><strong>Recession</strong> slackens a muscle by moving it away from its insertion. It can be performed on any muscle <strong>except</strong> the <strong>superior oblique.</strong></li>\n<li><strong>Disinsertion</strong> (or <strong>myectomy)</strong> involves detaching a muscle from its insertion without reattachment. It is most commonly used to weaken an overacting <strong>inferior oblique</strong> muscle.</li>\n<li><strong>Posterior fixation suture:&nbsp;</strong>The principle of this <strong>(Faden) procedure</strong> is to suture the muscle belly to the sclera posteriorly so as to decrease the pull of the muscle in its field of action without affecting the eye in the primary position.</li>\n</ul>\n</li>\n<li><strong>Strengthening,</strong> to enhance the pull of a muscle.\n<ul>\n<li><strong>Resection</strong> shortens a muscle to enhance its effective pull. It is suitable <strong>only for</strong>&nbsp;the&nbsp;<strong>rectus muscle.</strong></li>\n<li><strong>Tucking</strong> of a muscle or its tendon is usually confined to the enhancement of the action of the <strong>superior oblique muscle.</strong></li>\n<li><strong>Advancement</strong> of the muscle nearer to the limbus can be used to enhance the action of a previously recessed <strong>rectus muscle.</strong></li>\n</ul>\n</li>\n<li><strong>Vector adjustment procedures</strong>&nbsp;have the primary aim of altering the direction of muscle action.</li>\n<li><strong>Transposition</strong>&nbsp;refers to the <strong>relocation</strong> of one or more extraocular muscles to substitute for the action of an absent or severely deficient muscle. The <strong>most common indication</strong> is severe <strong>lateral rectus weakness</strong> due to acquired palsy of the 6<sup>th</sup> cranial nerve palsy.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding accommodative esotropia?",
    "choices": [
      {
        "id": 1,
        "text": "It is the most common type of squint."
      },
      {
        "id": 2,
        "text": "Miotics are used as the treatment strategy in the high AC/A ratio"
      },
      {
        "id": 3,
        "text": "It is associated with high myopia."
      },
      {
        "id": 4,
        "text": "Refractive type can be fully corrected by use of spectacles."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Accommodative esotropia</strong> is associated with a high degree of <strong>hypermetropia</strong> (+4 to +7 D).</p>\n<p><strong>Accommodative esotropia </strong>is the<strong> m</strong><strong>ost common</strong> type of squint. Typically presents around <strong>2 to 3</strong> years of age.</p>\n<p>Types:</p>\n<ol>\n<li><strong>Refractive</strong>\n<ul>\n<li>Associated with <strong>high hypermetropia</strong></li>\n<li><strong>Fully correctable</strong> by <strong>spectacles</strong></li>\n</ul>\n</li>\n<li><strong>Non-refractive type </strong>\n<ul>\n<li><strong>Abnormal accommodative convergence/accommodation (AC/A)</strong> ratio</li>\n<li>Fully corrected by bifocal glasses</li>\n<li><strong>Miotics </strong>useful in cases where glasses are unsuitable\n<ul>\n<li><strong>Echothiophate </strong>causes<strong>&nbsp;iris cyst</strong></li>\n<li><strong>Prevention </strong>of iris cysts-<strong>&nbsp;Phenylephrine </strong>drops</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Mixed type</strong></li>\n</ol>\n<p>The accommodative convergence/accommodation <strong>(AC/A) ratio</strong> is defined as the amount of convergence measured in prism diopters per unit (diopter) change in accommodation.</p>\n<p>The image below shows accommodative esotropia with and without correction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd54b64d92e248f7b6dd196a15c638c6x653x266.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/133525488fab43dd89dbecdc925d96e4x491x170.PNG"
    ]
  },
  {
    "text": "Which of the following is the best line of treatment in a 3-year-old child presenting with a recent onset of 15-degree accommodative esotropia?",
    "choices": [
      {
        "id": 1,
        "text": "Orthoptic exercise"
      },
      {
        "id": 2,
        "text": "Surgery"
      },
      {
        "id": 3,
        "text": "Relieving prism"
      },
      {
        "id": 4,
        "text": "Refractive correction"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>best line of treatment</strong> in <strong>accommodative esotropia</strong> is a&nbsp;<strong>refractive correction</strong>.</p>\n<p>Esotropia for distance is corrected by the treatment of hypermetropia: convex glasses</p>\n<p>Esotropia for near is corrected by +3DS lens.</p>\n<p>Algorithm for the management of accommodative <strong>esotropia </strong>is as follows:</p>\n<ul>\n<li><strong>R</strong>:&nbsp;<strong>R</strong>efractive correction: Glasses/Miotics</li>\n<li><strong>O</strong>:<strong> O</strong>rthoptics/<strong>O</strong>cclusion: for amblyopia</li>\n<li><strong>O</strong>:<strong>&nbsp;</strong><strong>O</strong>perative correction: for non-accommodative component</li>\n<li><strong>P</strong>:&nbsp;<strong>P</strong>rism correction: for remaining error</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Charlie, a 5-year-old boy with crossed eyes received his first eye exam from a primary care ophthalmologist. Examination, including cycloplegic refraction and dilated fundus exam, resulted in diagnoses of constant right esotropia, and amblyopia in the right eye. By what age should his amblyopia be corrected?",
    "choices": [
      {
        "id": 1,
        "text": "10 years"
      },
      {
        "id": 2,
        "text": "8 years"
      },
      {
        "id": 3,
        "text": "12 years"
      },
      {
        "id": 4,
        "text": "14 years"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Strabismic amblyopia</strong>&nbsp;should be<strong>&nbsp;corrected</strong> before<strong> 8 years</strong> of age.</p>\n<p>The <strong>sensitive period</strong> during which acuity of an amblyopic eye can be improved is <strong>usually up to 7&ndash;8 years</strong> <strong>in strabismic amblyopia</strong> and maybe <strong>longer (into the teens) for anisometropic amblyopia</strong> when a good binocular function is present.</p>\n<p>In the absence of an organic lesion, a <strong>difference</strong> in best-corrected visual acuity (VA) of <strong>two Snellen lines</strong> or more (or &gt;1 log unit) is indicative of amblyopia.</p>\n<p>Treatment of amblyopia:</p>\n<ol>\n<li>Occlusion of the normal eye, to encourage the&nbsp;use of the amblyopic eye, is the most effective treatment.</li>\n<li>Penalization, in which vision in the normal eye is blurred with atropine, is an alternative method.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old female patient presented for her first complete eye examination after a school vision screening found unequal visual acuity. Her parents have not noted any eye problems. Visual acuity in the right eye was 20/20 and the left eye is 20/80. The rest of the examination was unremarkable and glasses were prescribed. She was diagnosed with anisometric hyperopia and amblyopia of the left eye when her visual acuity at a return appointment was found to be 20/20 RE  and 20/60 LE at a distance while wearing her new glasses.  What is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Convergent exercises"
      },
      {
        "id": 2,
        "text": "Prism correction"
      },
      {
        "id": 3,
        "text": "Surgery"
      },
      {
        "id": 4,
        "text": "Conventional occlusion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Occlusion</strong> of the&nbsp;<strong>normal</strong> eye is the treatment of choice for amblyopia.</p>\n<p><strong>Amblyopia</strong> is an uncorrectable decrease in vision in one or both eyes with no apparent structural abnormality seen to explain it. It is a diagnosis of exclusion. Generally, a difference of two lines or more on an eye chart test of visual acuity between the two eyes or a best-corrected vision of 20/30 or worse would be defined as amblyopia. For example, our patient has 20/20 vision with the right eye and only 20/80 with the left and the left eye even after best-corrected vision couldn't achieve &lt;20/30 vision, the left eye is said to be amblyopic.</p>\n<p><strong>Clinical features:</strong></p>\n<ul>\n<li>Decreased contrast sensitivity</li>\n<li>Diminution of vision</li>\n<li>Sunglass effect- brightness is less compared to the normal eye</li>\n<li>Crowding phenomenon- slipping of images</li>\n</ul>\n<p><strong>Treatment of choice:</strong></p>\n<ul>\n<li><strong>Occlusion</strong> of the<strong> normal eye</strong> (4 to 6 hours/day) using patches.</li>\n<li><strong>Penalization:&nbsp;</strong>Blurring of vision using<strong> atropine.</strong></li>\n</ul>\n<p>Prism correction is not the right treatment as the child doesn't have strabismus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old child presents with a right convergent squint of 6 months duration. Choose the most appropriate treatment strategy.",
    "choices": [
      {
        "id": 1,
        "text": "Immediate surgical correction followed by amblyopia therapy"
      },
      {
        "id": 2,
        "text": "Proper refractive correction, amblyopia therapy followed by surgical correction"
      },
      {
        "id": 3,
        "text": "Prescription of spectacles and defer surgery until 5 years"
      },
      {
        "id": 4,
        "text": "Botulinum toxin injection followed by occlusion therapy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The appropriate management in this case would be proper refractive correction, amblyopia therapy followed by surgical correction</p>\n<p>The algorithm for management of accommodative squint is as follows:</p>\n<ul>\n<li><strong>R</strong>:&nbsp;<strong>R</strong>efractive correction: Glasses/Miotics</li>\n<li><strong>O</strong>:&nbsp;<strong>O</strong>rthoptics/<strong>O</strong>cclusion: For amblyopia</li>\n<li><strong>O</strong>:<strong> O</strong>perative correction: For non-accommodative component</li>\n<li><strong>P</strong>:&nbsp;<strong>P</strong>rism correction: For remaining error</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions should an ophthalmologist prescribe miotics?",
    "choices": [
      {
        "id": 1,
        "text": "Accommodative esotropia"
      },
      {
        "id": 2,
        "text": "Intermittent exotropia"
      },
      {
        "id": 3,
        "text": "Paralytic esotropia"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Miotics are used in the management of <strong>accommodative esotropia.</strong></p>\n<p>The use of&nbsp;<strong>miotics </strong>in<strong> convergent strabismus</strong>&nbsp;is based on the peripheral spasm of accommodation caused by the drug. The accommodation triad involves <strong>convergence</strong>. An increased accommodative effort increases the amount of&nbsp;<strong>convergence</strong>. Pilocarpine would produce accommodation spasm and eliminate the accommodative convergence that would otherwise occur when the patient looks at a near object. It is<strong> useful in </strong>cases of an<strong> abnormal AC/A ratio </strong>as in, accommodative esotropia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Paralytic squint presents with all except",
    "choices": [
      {
        "id": 1,
        "text": "Deviation"
      },
      {
        "id": 2,
        "text": "Confusion"
      },
      {
        "id": 3,
        "text": "Diplopia"
      },
      {
        "id": 4,
        "text": "Stereopsis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In squint, the <strong>deviation of the eye</strong> results in two vastly different images. The brain is <strong>unable to fuse</strong> them. Hence, there is <strong>no stereopsis.</strong></p>\n<p><strong>Features of paralytic squint:</strong></p>\n<p><strong>Symptoms:</strong></p>\n<ul>\n<li>Diplopia</li>\n<li>Confusion</li>\n<li>Nausea, Vertigo</li>\n<li>Ocular deviation</li>\n</ul>\n<p><strong>Signs:</strong></p>\n<ul>\n<li><strong>Primary deviation &lt; Secondary deviation</strong></li>\n<li>Compensatory head posture&ndash;<strong>Ocular torticollis</strong></li>\n<li>False projection or orientation</li>\n</ul>\n<p>In adults- no amblyopia</p>\n<p>In children &lt;6 years- amblyopia can occur</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old diabetic patient presented with the \u200bsquint. On examination, the secondary deviation was found to be more than the primary deviation. Forced duction test is negative. Which of the following types of squint is most likely to be present in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Comitant squint"
      },
      {
        "id": 2,
        "text": "Restrictive squint"
      },
      {
        "id": 3,
        "text": "Paralytic squint"
      },
      {
        "id": 4,
        "text": "Pseudosquint"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of<strong> paralytic squint. </strong>It is characterized by the presence of secondary deviation more than the primary deviation and a <strong>negative</strong> <strong>forced</strong> <strong>duction</strong> <strong>test</strong>.</p>\n<p>The squint may be either comitant or incomitant.</p>\n<ul>\n<li>Comitant squint: The angle of squint measured is same in all gazes.\u00a0</li>\n<li>Incomitant squint: The angle of squint measured is different in different gazes.\u00a0</li>\n</ul>\n<p>The differences between comitant and incomitant squint are shown in the table below:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Features</strong></td>\n<td><strong>Comitant</strong> <strong>squint</strong></td>\n<td><strong>Incomitant</strong> <strong>squint</strong></td>\n</tr>\n<tr>\n<td>Magnitude of squint</td>\n<td>Same in all gazes</td>\n<td>Varies with the gaze</td>\n</tr>\n<tr>\n<td>Diplopia</td>\n<td>Absent</td>\n<td>Present</td>\n</tr>\n<tr>\n<td>Ocular movements</td>\n<td>Full</td>\n<td>Restricted</td>\n</tr>\n<tr>\n<td>False projection</td>\n<td>Absent</td>\n<td>Present</td>\n</tr>\n<tr>\n<td>Abnormal head posture</td>\n<td>Absent</td>\n<td>Present</td>\n</tr>\n<tr>\n<td><strong>Secondary deviation</strong></td>\n<td>Equal to primary deviation</td>\n<td><strong>More than primary deviation</strong></td>\n</tr>\n</tbody>\n</table>\n<p>The incomitant squint is further divided into two main types: Paralytic and restrictive.</p>\n<p><strong>Paralytic squint</strong> occurs due to the paralysis of extraocular muscle while <strong>restrictive</strong> <strong>squint</strong> is due to the mechanical restriction caused by tight or fibrosed muscle.</p>\n<p><strong>Forced duction test(FDT)</strong> differentiates between these two types. In this test, the eye is moved mechanically with the help of a forceps.</p>\n<ul>\n<li>The test is <strong>negative</strong> if there is no resistance to the movement. It is seen in a\u00a0<strong>paralytic</strong> squint.</li>\n<li>The test is <strong>positive</strong> if there is resistance to the movement. It is seen in a\u00a0<strong>restrictive</strong> squint.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Left 3rd nerve palsy"
      },
      {
        "id": 2,
        "text": "Right 6th nerve palsy"
      },
      {
        "id": 3,
        "text": "Left 6th nerve palsy"
      },
      {
        "id": 4,
        "text": "Right 3rd nerve palsy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has <strong>left eye esotropia</strong>&nbsp;in primary gaze which is suggestive of<strong> left abducent (6th) nerve palsy</strong> which innervates the left lateral rectus muscle.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bb2915b820b544519fda81ecf8ea4ded.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aef505ce112841d4988eed93b8afa779x1280x2905.726375176305.JPEG"
    ]
  },
  {
    "text": "A patient complains of difficulty in climbing down the stairs due to double vision. On examination, you notice his right eye has deviated upward and the deviation becomes more pronounced on the left gaze. The remaining extraocular movements are intact. Which nerve is most likely involved?",
    "choices": [
      {
        "id": 1,
        "text": "Right oculomotor nerve"
      },
      {
        "id": 2,
        "text": "Right trochlear nerve"
      },
      {
        "id": 3,
        "text": "Left trochlear nerve"
      },
      {
        "id": 4,
        "text": "Left oculomotor nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The affected nerve in the given clinical scenario is the&nbsp;<strong>right trochlear nerve.&nbsp;</strong></p>\n<p>The<strong>&nbsp;right trochlear</strong>&nbsp;<strong>nucleus</strong> actually innervates the<strong> left superior oblique</strong> and vice versa. However, the nerve decussates at the midbrain at the level of the <strong>inferior colliculus.</strong>&nbsp;So, lesions of the&nbsp;<strong>trochlear nucleus</strong> lead to <strong>contralateral</strong> palsy. While that of&nbsp;<strong>trochlear nerve</strong>&nbsp;peripherally lead to <strong>ipsilateral</strong> palsy.</p>\n<p>In this patient, the right-sided symptoms could be due to a lesion in the&nbsp;<strong>right trochlear nerve</strong>&nbsp;(ipsilateral) or <strong>left trochlear nucleus</strong> (contralateral). He&nbsp;complains of <strong>diplopia</strong> while climbing down the stairs because the normal eye can look down but the paralytic eye has deviated. There is also a <strong>limitation of depression</strong> due to superior oblique palsy, and hence the eye is deviated upward due to<strong> overaction</strong> of the <strong>inferior oblique</strong>. The obliques exert maximum force in an <strong>adducted position</strong> and hence the deviation becomes <strong>more prominent</strong> on the left gaze when the right eye is adducted.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient suffers head trauma following which he complains of diplopia. His extraocular motility testing in the 9 gazes is as shown in the image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Internuclear ophthalmoplegia"
      },
      {
        "id": 2,
        "text": "One and a half syndrome"
      },
      {
        "id": 3,
        "text": "Trochlear nerve palsy"
      },
      {
        "id": 4,
        "text": "Oculomotor nerve palsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario suggests a&nbsp;<strong>left oculomotor nerve palsy.</strong></p>\n<p>It is evident by the upper lid ptosis and down and out deviation of the left eye, as seen in the primary position of gaze (central image).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d6a43941cf0c486a8ca587b926094434.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6fb72e216d2b48eebc1da105cbce1c31x1280x735.JPEG"
    ]
  },
  {
    "text": "An 18-year-old destitute woman reports to a free eye camp with vision problems. Best-corrected visual acuity was 6/12 in the right eye and 6/6 in the left eye. Elevation in the right eye was absent. Her right eye showed 14\u201316 prism diopter (PD) hypotropia. Bell's phenomenon was absent in the right eye. Diagnosis of right eye double elevator palsy was made. Which of the following muscles are affected in her?",
    "choices": [
      {
        "id": 1,
        "text": "Levator palpebrae superioris and Muller muscle"
      },
      {
        "id": 2,
        "text": "Levator palpebrae superioris and superior rectus"
      },
      {
        "id": 3,
        "text": "Muller muscle and Inferior oblique"
      },
      {
        "id": 4,
        "text": "Superior rectus and Inferior oblique"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In <strong>double-elevator palsy</strong>, the muscles involved are <strong>superior rectus and inferior oblique.</strong></p>\n<p>It is commonly associated with ptosis or pseudoptosis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient reports to the OPD with complaints that he feels dizzy on lateral gaze. His range of movements is shown below. Jerky movements are also observed in the left eye on the left gaze however convergence is normal. Which of the following structures is most likely affected?",
    "choices": [
      {
        "id": 1,
        "text": "Occipital lobe"
      },
      {
        "id": 2,
        "text": "Paramedian pontine reticular formation (PPRF)"
      },
      {
        "id": 3,
        "text": "Medial longitudinal fasciculus"
      },
      {
        "id": 4,
        "text": "Pretectal fibres"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>\u00a0</p>\n<p><strong>Total ophthalmoplegia</strong></p>\n<ul>\n<li>All <strong>extraocular and intraocular</strong> muscles are <strong>paralyzed</strong>.</li>\n<li>Paralysis of 3<sup>rd</sup>, 4<sup>th</sup>, and 6<sup>th</sup> nerve</li>\n<li>Seen in orbital apex syndrome, cavernous sinus thrombosis</li>\n</ul>\n<p><strong>External ophthalmoplegia</strong></p>\n<ul>\n<li>All <strong>extraocular muscles</strong> are <strong>paralyzed</strong></li>\n<li>Lesions at the level of motor nuclei</li>\n<li>Sparing of Edinger Westphal nucleus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4cc1a21cd5eb451ebd592ac2b7f03758.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e30633b62d2548f1a41c0892ff22ae4dx1280x2317.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d52bf75a00e844f39d460908be111c36x1280x2259.JPEG"
    ]
  },
  {
    "text": "Identify the condition",
    "choices": [
      {
        "id": 1,
        "text": "Duane\u2019s retraction syndrome type 2"
      },
      {
        "id": 2,
        "text": "Duane\u2019s retraction syndrome type 3"
      },
      {
        "id": 3,
        "text": "Duane\u2019s retraction syndrome type 1"
      },
      {
        "id": 4,
        "text": "Duane's restriction syndrome type 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Duane&rsquo;s retraction syndrome (DRS) </strong>is a cause of <strong>restrictive squint</strong></p>\n<p>There is a failure of innervation of the lateral rectus by a <strong>hypoplastic sixth nerve nucleus,</strong> with anomalous innervation of the lateral rectus by fibers from the third nerve.&nbsp;<strong>Retraction of the globe</strong> on attempted <strong>adduction.&nbsp;</strong>Widening of palpebral fissure on attempted abduction</p>\n<p><strong>Classification</strong> by <strong>Huber:</strong></p>\n<ul>\n<li>Limitation of abduction- type 1</li>\n<li>Limitation of adduction- type 2</li>\n<li>Limitation of both- type 3</li>\n</ul>\n<p>Note: DRS is an<strong> exception</strong> to <strong>Sherrington's law</strong> of reciprocal innervation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b6cc950ed38e4838b9ef49f829845766.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/81d8461813b44b1b84ec41929150e1b9x1280x1949.7884344146685.JPEG"
    ]
  },
  {
    "text": "An eleven-year-old girl presented with a history of squint and poor vision. She had visual acuities of 6/24 and counting fingers in her right and left eyes respectively. There was a left hypotropia in the primary position of gaze with associated marked restriction of elevation in adduction and a positive forced duction test. A diagnosis of Brown syndrome was made. The pathology involves which of the following muscles?",
    "choices": [
      {
        "id": 1,
        "text": "Superior oblique"
      },
      {
        "id": 2,
        "text": "Superior rectus"
      },
      {
        "id": 3,
        "text": "Levator palpebrae superioris"
      },
      {
        "id": 4,
        "text": "Inferior oblique"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Brown syndrome</strong>&nbsp;occurs due to mechanical restriction caused by a congenitally<strong> tight superior oblique sheath</strong> or by the impaired movement of the <strong>superior oblique tendon</strong> through the trochlea. It may be acquired in some cases.</p>\n<p><strong>Contracture of the superior oblique</strong> leads to <strong>restriction</strong> of its antagonistic muscle, the<strong> inferior oblique</strong> and that is why the patient presents with absence of elevation in adduction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Brown\u2019s syndrome simulates which muscle palsy?",
    "choices": [
      {
        "id": 1,
        "text": "Superior oblique"
      },
      {
        "id": 2,
        "text": "Superior rectus"
      },
      {
        "id": 3,
        "text": "Inferior oblique"
      },
      {
        "id": 4,
        "text": "Inferior rectus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Brown&rsquo;s superior oblique tendon sheath syndrome</strong> simulates palsy of <strong>inferior oblique muscle.&nbsp;</strong>In both of these cases, there is a limited elevation of the eye in adduction.&nbsp;</p>\n<p>Brown&rsquo;s superior oblique tendon sheath syndrome is a cause of&nbsp;restrictive squint.The&nbsp;forced duction test is positive.</p>\n<p><strong>Differential diagnoses</strong> of Brown's syndrome:</p>\n<ol>\n<li><strong>Inferior oblique palsy</strong>- differentiated by a <strong>positive head-tilt test</strong> (negative in Brown's syndrome) and a <strong>negative forced duction test</strong> (positive in Brown's syndrome)</li>\n<li><strong>Primary superior oblique overaction</strong>- differentiated by <strong>negative forced duction test</strong> (Positive in Brown's syndrome)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "V pattern exotropia"
      },
      {
        "id": 2,
        "text": "A pattern esotropia"
      },
      {
        "id": 3,
        "text": "V pattern esotropia"
      },
      {
        "id": 4,
        "text": "A pattern exotropia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image classically depicts an <strong>A pattern esotropia.</strong> <strong>Relative convergence on upgaze</strong> (esotropia increases on upgaze) is a feature of A-pattern esotropia.</p>\n<p><strong>A or V pattern heterotropia:</strong></p>\n<ul>\n<li>\"V\" or \"A\" patterns occur when the relative contributions of the superior rectus and inferior oblique to elevation, or of the inferior rectus and superior oblique to depression, are abnormal, resulting in the derangement of the balance of their horizontal vectors in up and downgaze.</li>\n<li><strong>Oblique muscle dysfunction</strong> is the <strong>commonest</strong></li>\n<li>\"V\" pattern&nbsp;is said to be significant when the difference between upgaze and downgaze is <strong>&ge;15 &Delta;.</strong></li>\n<li>\"A\" pattern&nbsp;is considered significant if the difference between upgaze and downgaze is <strong>&ge;10 &Delta;.</strong></li>\n</ul>\n<p>The image below shows&nbsp;A and V pattern heterotropia</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ae1253020ae641548054edf74877b0a3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/56ac3c8c01474104ae573d2bd26c75efx1200x894.JPEG"
    ]
  },
  {
    "text": "A patient presents with left-sided head tilt which on straightening leads to right hypotropia. This increases on dextroversion and right head tilt. Paralysis of which of the following muscles is involved?",
    "choices": [
      {
        "id": 1,
        "text": "Right superior oblique"
      },
      {
        "id": 2,
        "text": "Right superior rectus"
      },
      {
        "id": 3,
        "text": "Right inferior oblique"
      },
      {
        "id": 4,
        "text": "Left inferior oblique"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Right superior rectus palsy</strong> is the cause for the given clinical scenario.</p>\n<p>The three-step test, also known as the <strong>Parks-Bielschowsky three-step test</strong>, is a diagnostic test used to identify which muscle is paralyzed in the case of an acquired hypertropia. This method uses the cover-uncover test, with or without the Maddox rod to measure the amount of deviation in different head positions.<sup id=\"cite_ref-bielschowsky5_5-0\" class=\"reference\"></sup></p>\n<p>The three-step test may also be used to diagnose the less common inferior oblique or vertical rectus muscle palsy. It is designed for the diagnosis of a single paretic vertical muscle and is unreliable when there are multiple paretic muscles or in restrictive strabismus. This test may also help in identifying if a superior rectus palsy is true or simulated in a patient with an inhibitional palsy of the contralateral antagonist.</p>\n<p>Using the three-step test in the above clinical scenario:</p>\n<p>Step 1. Which eye is hypotrophic?</p>\n<p>The eye hypotrophic in the primary position is the right eye. The paretic muscles can be right eye elevator or left eye depressor.</p>\n<ul>\n<li>Right superior rectus</li>\n<li>Right inferior oblique</li>\n<li>Left inferior rectus</li>\n<li>Left superior oblique</li>\n</ul>\n<p>Step 2.<span id=\"Step_2._Does_the_hypertropia_increase_in_right_gaze_or_left_gaze.3F\" class=\"mw-headline\" style=\"font-size: 10pt;\">Does the hypotropia increase in the right gaze or left gaze?</span></p>\n<p><span class=\"mw-headline\" style=\"font-size: 10pt;\">The hypotropia increases in right gaze.</span></p>\n<p>Therefore, the paretic muscle must be either (1) one of the muscles whose primary action is elevating the right eye on the right gaze, or (2) one of the muscles whose primary action is depressing the left eye in the right gaze. The left inferior oblique and the right superior rectus both have a primary action of elevation in right gaze. Therefore, one of these muscles could be the paretic muscle. Likewise, the left superior oblique and the right inferior rectus have a primary action of depression in the right gaze and could be paretic. But since&nbsp;the left inferior oblique and the right inferior rectus did not meet step 1, they can be eliminated from the possible paretic muscles. This leaves us:</p>\n<ul>\n<li>Left superior oblique&nbsp;</li>\n<li>Right superior rectus</li>\n</ul>\n<p>Step 3. Does the hypotropia increase in the right head tilt or left head tilt?</p>\n<p>The hypotropia increases in the right head tilt. If the deviation increases on right head tilt and decreases on left head tilt, as it does in this example patient, then the right superior rectus is implicated as the paretic culprit.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '21 Strabismus - Types And Treatment';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>