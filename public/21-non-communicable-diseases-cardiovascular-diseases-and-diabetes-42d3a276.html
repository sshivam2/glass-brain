<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21 Non-Communicable Diseases - Cardiovascular Diseases And Diabetes - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The WHO has formulated a Global Action Plan for the prevention and control of non-communicable diseases. Which of the following is not a voluntary global target under this initiative?",
    "choices": [
      {
        "id": 1,
        "text": "10% relative reduction in harmful use of alcohol"
      },
      {
        "id": 2,
        "text": "30% relative reduction in mean population intake of sodium"
      },
      {
        "id": 3,
        "text": "10% relative reduction in prevalence of insufficient physical activity"
      },
      {
        "id": 4,
        "text": "10% relative  reduction in use of trans-fat for cooking"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A 10 percent relative reduction in the use of trans-fat for cooking is not a voluntary global target under the WHO Global Action Plan for prevention and control of non-communicable diseases.</p>\n<p>There are 9 targets under this plan which are to be achieved by 2025. These are shown in the image below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7ca38c76619e411c83c812ec2a80e4aex691x481.PNG"
    ]
  },
  {
    "text": "Project MONICA is related to:",
    "choices": [
      {
        "id": 1,
        "text": "Cardiovascular diseases"
      },
      {
        "id": 2,
        "text": "Cervical Cancer"
      },
      {
        "id": 3,
        "text": "Breast Cancer"
      },
      {
        "id": 4,
        "text": "Road Traffic Accidents"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Project MONICA</strong>\u00a0is related to <strong>cardiovascular diseases</strong>.</p>\n<p>It stands for <strong>multinational monitoring</strong> of <strong>trends</strong> and <strong>determinants</strong> in cardiovascular diseases.\u00a0It was done to study the reasons for the changes in the trends of cardiovascular diseases in different countries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding the relationship between smoking and coronary heart disease (CHD)?",
    "choices": [
      {
        "id": 1,
        "text": "Smoking can cause sudden death from CHD."
      },
      {
        "id": 2,
        "text": "Filters in cigarettes are protective against the development of CHD."
      },
      {
        "id": 3,
        "text": "Risk of developing CHD 10-20 years after the cessation of smoking is equal in smokers and non smokers."
      },
      {
        "id": 4,
        "text": "Degree of risk of developing CHD is directly related to the number of cigarettes smoked per day."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Filters are probably not protective against the\u00a0development of coronary heart disease in smokers.</p>\n<p><strong>Smoking</strong> is a <strong>modifiable risk factor</strong> for coronary heart disease (<strong>CHD</strong>). The degree of risk is <strong>directly related</strong> to the <strong>number of cigarettes</strong> smoked per day. Several mechanisms have been suggested for this:</p>\n<ul>\n<li>Carbon monoxide induced atherogenesis</li>\n<li>Nicotine stimulation of adrenergic drive</li>\n<li>Lipid metabolism with fall in levels of HDL</li>\n</ul>\n<p>Cigarettes also<strong> increase </strong>the<strong> risk of sudden death</strong> in patients with CHD who are<strong> below 50 years</strong> of age.\u00a0The<strong> risk</strong> of death from CHD <strong>decreases</strong> with the<strong> cessation of smoking</strong>. The risk declines quite substantially within one year of stopping smoking and more gradually thereafter until, after 10- 20 years, it is the same as that of non-smokers.</p>\n<p><strong>Risk factors</strong> for coronary heart disease are:</p>\n<ul>\n<li><strong>Modifiable</strong>:\n<ul>\n<li>Cigarette smoking</li>\n<li>High blood pressure</li>\n<li>Elevated serum cholesterol</li>\n<li>Diabetes</li>\n<li>Obesity</li>\n<li>Sedentary habits</li>\n<li>Stress</li>\n</ul>\n</li>\n<li><strong>Non-modifiable</strong>:\n<ul>\n<li>Age</li>\n<li>Sex</li>\n<li>Family history</li>\n<li>Genetic factors</li>\n<li>Personality\u00a0</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A chronic smoker was found to have a deranged lipid profile during his annual health checkup. Which of the following variables tested is most directly associated with the risk of developing coronary heart disease?",
    "choices": [
      {
        "id": 1,
        "text": "HDL level"
      },
      {
        "id": 2,
        "text": "VLDL level"
      },
      {
        "id": 3,
        "text": "LDL level"
      },
      {
        "id": 4,
        "text": "IDL level"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The plasma <strong>LDL</strong> level&nbsp;is<strong> most directly associated</strong> with the risk of developing coronary heart disease (<strong>CHD</strong>).</p>\n<p><strong>HDL</strong> is <strong>protective</strong> against the development of CHD. Its levels should ideally be more than 40 mg/dl.</p>\n<p>Recent evidence shows that levels of&nbsp;<strong>Apolipoprotein-A-1</strong> and <strong>Apolipoprotein-B</strong> are <strong>better predictors</strong> of CHD than HDL or LDL.</p>\n<p><strong>VLDL</strong> is more strongly associated with the risk of developing <strong>peripheral vascular disease</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old diabetic male is concerned about his risk of developing coronary heart disease. What cholesterol/HDL ratio would you aim to achieve in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Cholesterol/HDL ratio> 2.5"
      },
      {
        "id": 2,
        "text": "Cholesterol/HDL ratio< 2.5"
      },
      {
        "id": 3,
        "text": "Cholesterol/HDL ratio> 3.5"
      },
      {
        "id": 4,
        "text": "Cholesterol/HDL ratio< 3.5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A <strong>cholesterol/HDL ratio &lt;3.5</strong> is recommended for the<strong> prevention</strong> of coronary heart disease (<strong>CHD</strong>).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While conducting a screening camp for coronary heart disease, you encounter the following people. Who among them is at the highest risk for developing this disease?",
    "choices": [
      {
        "id": 1,
        "text": "A person who is competitive and ambitious"
      },
      {
        "id": 2,
        "text": "A person who is calm and relaxed"
      },
      {
        "id": 3,
        "text": "A person who tends to suppress their emotions"
      },
      {
        "id": 4,
        "text": "An introverted person with negative affectivity"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A person who is <strong>competitive</strong> and <strong>ambitious</strong>\u00a0is said to have a<strong> type A</strong> <strong>personality</strong>. Such people are more prone to <strong>develop</strong> <strong>coronary heart disease</strong>\u00a0(CHD).\u00a0Personality type is a <strong>non-modifiable risk factor</strong> for CHD.</p>\n<p><strong>Risk factors</strong>\u00a0for coronary heart disease are:</p>\n<ul>\n<li><strong>Modifiable</strong>:\n<ul>\n<li>Cigarette smoking</li>\n<li>High blood pressure</li>\n<li>Elevated serum cholesterol</li>\n<li>Diabetes</li>\n<li>Obesity</li>\n<li>Sedentary habits</li>\n<li>Stress</li>\n</ul>\n</li>\n<li><strong>Non-modifiable</strong>:\n<ul>\n<li>Age</li>\n<li>Sex</li>\n<li>Family history</li>\n<li>Genetic factors</li>\n<li>Personality\u00a0</li>\n</ul>\n</li>\n</ul>\n<p>Option B:\u00a0A calm and relaxed person is said to have a type B personality.</p>\n<p>Option C: A person who tends to suppress their emotions, especially negative emotions, is said to have a type C personality.</p>\n<p>Option D: A person with\u00a0negative affectivity and social inhibition is said to have a type D personality.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old obese woman enquires about ways she can reduce her risk of coronary artery disease. Which of the following dietary modifications would you suggest?",
    "choices": [
      {
        "id": 1,
        "text": "Reduction of salt intake to less than 10g per day"
      },
      {
        "id": 2,
        "text": "Consumption of saturated fats limited to less than 10% of the total energy intake"
      },
      {
        "id": 3,
        "text": "Reduction of total fat intake to less than 5% of total energy intake"
      },
      {
        "id": 4,
        "text": "Dietary cholesterol increased to above 100 mg/1000 kcal energy intake"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Limiting the consumption of<strong> saturated fats</strong> to <strong>less than</strong> <strong>10%</strong> of total energy intake is recommended for the <strong>prevention</strong> of <strong>coronary artery disease</strong>.</p>\n<p>The WHO'S Expert Committee suggested certain <strong>dietary modifications</strong> for the prevention of coronary artery disease. These include:</p>\n<ul>\n<li>Reduction of the total<strong> fat intake</strong> to <strong>20&ndash;30%</strong> of <strong>total energy</strong> intake</li>\n<li>Consumption of saturated fats must be limited to less than 10% of total energy intake</li>\n<li>A reduction of <strong>dietary cholesterol</strong> to <strong>below 100mg</strong> per 1000 kcal per day</li>\n<li>Increase in the complex carbohydrate consumption (i.e vegetables, fruits, whole grains and legumes)</li>\n<li>Avoidance of alcohol consumption and reduction of <strong>salt intake</strong> to <strong>5g daily</strong> or less</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following studies is not related to coronary heart disease?",
    "choices": [
      {
        "id": 1,
        "text": "Stanford 3 community study"
      },
      {
        "id": 2,
        "text": "Framingham study"
      },
      {
        "id": 3,
        "text": "CATIE trial"
      },
      {
        "id": 4,
        "text": "MRFIT"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> CATIE trial</strong> is related to the study of <strong>antipsychotics </strong>and their effectiveness.</p>\n<p>The <strong>trials</strong> related to<strong> coronary heart disease</strong> and their subject of study include:</p>\n<table style=\"height: 179px; width: 895px;\">\n<tbody>\n<tr>\n<td style=\"width: 271.46875px;\">Name of Study</td>\n<td style=\"width: 608.53125px;\">Factors affecting CHD Studied</td>\n</tr>\n<tr>\n<td style=\"width: 271.46875px;\">Oslo diet/Smoking intervention study</td>\n<td style=\"width: 608.53125px;\">Effect of lowering serum lipids and smoking cessation</td>\n</tr>\n<tr>\n<td style=\"width: 271.46875px;\">MRFIT trial</td>\n<td style=\"width: 608.53125px;\">Effect of smoking cessation, blood pressure control and diet alteration in reduction of serum cholesterol</td>\n</tr>\n<tr>\n<td style=\"width: 271.46875px;\">The North Karelia project</td>\n<td style=\"width: 608.53125px;\">\n<p>1. Effect of reduction of risk factors like smoking, blood pressure and serum cholesterol.</p>\n<p>2. Promotion of early diagnosis, treatment and rehabilitation of patients</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 271.46875px;\">The Stanford-Three-Community trial</td>\n<td style=\"width: 608.53125px;\">Effects of community health education</td>\n</tr>\n<tr>\n<td style=\"width: 271.46875px;\">Lipid Research Clinics study</td>\n<td style=\"width: 608.53125px;\">Effect of reducing serum cholesterol in type II hyperlipidemics</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man, under treatment for hypertension for the past two months, is found to have a blood pressure of 144/96 mmHg. How will you grade it according to the European society of cardiology guidelines-2018?",
    "choices": [
      {
        "id": 1,
        "text": "Normal"
      },
      {
        "id": 2,
        "text": "High Normal"
      },
      {
        "id": 3,
        "text": "Grade 1 hypertension"
      },
      {
        "id": 4,
        "text": "Grade 2 hypertension"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the European society of cardiology guidelines-2018, a patient having a <strong>systolic BP&ge;140</strong> and a <strong>diastolic BP&ge;90</strong> mmHg is classified as having <strong>grade 1 hypertension</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A doctor records the BP of a patient as 142/90mmHg. One hour later, another doctor records the BP of the same patient as 160/98 mmHg. Both the readings are measured with the same apparatus under the same emotional and physical state of the patient. What type of error is seen here?",
    "choices": [
      {
        "id": 1,
        "text": "Subject error"
      },
      {
        "id": 2,
        "text": "Observer error"
      },
      {
        "id": 3,
        "text": "Instrument error"
      },
      {
        "id": 4,
        "text": "Recording error"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Such errors&nbsp;can arise due to <strong>differences</strong> in <strong>hearing acuity</strong> and interpretation of <strong>Korotkoff sounds</strong>.</p>\n<p>The types of errors that can occur during the measurement of blood pressure include:</p>\n<ul>\n<li><strong>Observer </strong>errors&nbsp;- due to difference in hearing acuity and interpretation of Korotkoff sounds</li>\n<li><strong>Instrumental </strong>errors -&nbsp;due to a leaking valve or cuffs that do not encircle the arm completely</li>\n<li><strong>Subject </strong>errors&nbsp;- due to anxiety, fear, etc. of the patient</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What does number 2 in the given diagram related to hypertension denote?",
    "choices": [
      {
        "id": 1,
        "text": "Normotensive individuals"
      },
      {
        "id": 2,
        "text": "Undiagnosed hypertensive subjects"
      },
      {
        "id": 3,
        "text": "Diagnosed hypertensive subjects not on treatment"
      },
      {
        "id": 4,
        "text": "Whole community"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above diagram depicts the \"<strong>rule of halves</strong>\",<strong>&nbsp;</strong>which shows the <strong>distribution of hypertension</strong> in the community. The number<strong> 2</strong>&nbsp;in this diagram denotes<strong> normotensive subjects</strong>.</p>\n<p>The rule of halves is a way of depicting the<strong> iceberg phenomenon</strong> seen in hypertension. It depicts that only about half of the hypertensive subjects in the general population of most developed countries are aware of the condition and only half of those aware are being treated and only half of those being treated are considered to be adequately treated.&nbsp;</p>\n<p>The circles marked by numbers in the given diagram correspond to the following parts of the population:</p>\n<ol>\n<li>Whole community</li>\n<li>Normotensive subjects</li>\n<li>Hypertensive subjects</li>\n<li>Undiagnosed hypertension</li>\n<li>Diagnosed hypertension</li>\n<li>Diagnosed but untreated</li>\n<li>Diagnosed and treated</li>\n<li>Inadequately treated</li>\n<li>Adequately treated</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aa2aa5ee4fcd41d397113675efd9a9f3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding tracking of blood pressure?",
    "choices": [
      {
        "id": 1,
        "text": "BP increases with age in all individuals"
      },
      {
        "id": 2,
        "text": "BP falls steadily in the elderly"
      },
      {
        "id": 3,
        "text": "Hypertensive children become hypotensive as they grow"
      },
      {
        "id": 4,
        "text": "BP of hypotensive children tends to remain low in adult life"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>If the blood pressure of individuals is followed up over years from early childhood to adult life,<strong> low blood pressures </strong>tend to <strong>remain low </strong>and<strong> high blood pressures </strong>become<strong> higher</strong> as the individuals grow older. This phenomenon of <strong>persistence </strong>of the<strong> rank order </strong>of blood pressure is described as <strong>tracking.</strong></p>\n<p>This is helpful in<strong> identifying children</strong> and adolescents who are <strong>at risk</strong> of developing <strong>hypertension</strong> in the future.</p>\n<p>Although blood pressure is known to increase with age in both sexes, <strong>some communities</strong> have been identified whose <strong>mean blood pressure</strong> does <strong>not rise</strong> with age. This is because their salt intake and calorie consumption are at a subsistence level.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While formulating a diet plan for a  hypertensive patient, you advise salt restriction. How much reduction in systolic blood pressure is expected by this intervention?",
    "choices": [
      {
        "id": 1,
        "text": "8-14 mm of Hg"
      },
      {
        "id": 2,
        "text": "2-8 mm of Hg"
      },
      {
        "id": 3,
        "text": "4-9 mm of Hg"
      },
      {
        "id": 4,
        "text": "5-20 mm of Hg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Salt restriction</strong> or decreasing dietary sodium intake <strong>decreases</strong> the <strong>systolic blood pressure</strong> by<strong> 2-8 mmHg</strong> approximately.</p>\n<p><strong>Lifestyle modifications </strong>to manage hypertension:</p>\n<table style=\"width: 502px; height: 678px;\">\n<tbody>\n<tr>\n<td style=\"width: 228.78125px;\">\n<p><strong>Recommendation</strong></p>\n</td>\n<td style=\"width: 257.234375px;\">\n<p><strong>Reduction in systolic blood pressure(approximate range)</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 228.78125px;\">\n<p>Weight reduction (Target BMI:18.5-24.9)</p>\n</td>\n<td style=\"width: 257.234375px;\">\n<p>&nbsp;5&ndash;20 mm Hg /10 kg weight loss</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 228.78125px;\">\n<p>Consume diet rich in fruits, vegetables and low fat dairy products with decreased saturated fats and total fat (DASH diet)</p>\n</td>\n<td style=\"width: 257.234375px;\">\n<p>8&ndash;14 mm Hg</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 228.78125px;\">\n<p>Reducing intake of dietary Sodium to no more than 100mEq/day(&lt; 6 g of sodium chloride)</p>\n</td>\n<td style=\"width: 257.234375px;\">\n<p>2&ndash;8 mm Hg</p>\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 228.78125px;\">\n<p>Physical activity like brisk walk (at least 30 min per day), most days of week.</p>\n</td>\n<td style=\"width: 257.234375px;\">\n<p>4&ndash;9 mm Hg</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 228.78125px;\">\n<p>Limit consumption of alcohol to no more than two drinks per day</p>\n</td>\n<td style=\"width: 257.234375px;\">\n<p>2&ndash;4 mm Hg</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Note: DASH stands for dietary approaches to stop hypertension.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following interventions will cause the maximum decrease in systolic blood pressure in a hypertensive patient?",
    "choices": [
      {
        "id": 1,
        "text": "Restricting intake of animal products"
      },
      {
        "id": 2,
        "text": "Taking a brisk walk for at least 30 minutes  a day"
      },
      {
        "id": 3,
        "text": "Adopting the DASH eating plan"
      },
      {
        "id": 4,
        "text": "Restricting sodium intake to less than 6g per day"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the above options, adopting the dietary approaches to stop hypertension (<strong>DASH</strong>) eating plan&nbsp;causes<strong> maximum decrease</strong> in <strong>systolic BP</strong>. It<strong>&nbsp;</strong>decreases the systolic BP by<strong> 8-14 mm Hg</strong>.</p>\n<p><strong>Lifestyle modifications&nbsp;</strong>to manage hypertension:</p>\n<table>\n<tbody>\n<tr>\n<td>\n<p><strong>Recommendation</strong></p>\n</td>\n<td>\n<p><strong>Reduction in systolic blood pressure(approximate range)</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Weight reduction (Target BMI:18.5-24.9)</p>\n</td>\n<td>\n<p>&nbsp;5&ndash;20 mm Hg /10 kg weight loss</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Consume diet rich in fruits, vegetables and low fat dairy products with decreased saturated fats and total fat (DASH diet)</p>\n</td>\n<td>\n<p>8&ndash;14 mm Hg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Reducing intake of dietary sodium to no more than 100mEq/day(&lt; 6 g of sodium chloride)</p>\n</td>\n<td>\n<p>2&ndash;8 mm Hg</p>\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Physical activity like brisk walk (at least 30 min per day), most days of week.</p>\n</td>\n<td>\n<p>4&ndash;9 mm Hg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Limit consumption of alcohol to no more than two drinks per day</p>\n</td>\n<td>\n<p>2&ndash;4 mm Hg</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a minor criterion for the diagnosis of rheumatic fever in a low risk population?",
    "choices": [
      {
        "id": 1,
        "text": "Carditis"
      },
      {
        "id": 2,
        "text": "Erythema marginatum"
      },
      {
        "id": 3,
        "text": "Subcutaneous nodules"
      },
      {
        "id": 4,
        "text": "Polyarthralgia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Polyarthralgia</strong> is a <strong>minor criterion</strong> for the diagnosis of rheumatic fever in a <strong>low risk population</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child having strep throat is being prescribed benzathine penicillin G. Which level of prevention of rheumatic fever does this intervention fall under?",
    "choices": [
      {
        "id": 1,
        "text": "Primary prevention"
      },
      {
        "id": 2,
        "text": "Primordial prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is an example of <strong>primary</strong> <strong>mode of prevention</strong> of rheumatic fever. This is because the patient only has strep throat and rheumatic fever has not developed yet.</p>\n<p>In case benzathine penicillin G is given to a patient<strong>&nbsp;</strong>with rheumatic fever to prevent further complications, then it becomes secondary level of prevention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy with rheumatic fever developed carditis which subsequently healed in a couple of weeks. How long will you administer benzathine penicillin G for secondary prophylaxis to him?",
    "choices": [
      {
        "id": 1,
        "text": "Till 21 years of age"
      },
      {
        "id": 2,
        "text": "Till 24 years of age"
      },
      {
        "id": 3,
        "text": "Till 26 years of age"
      },
      {
        "id": 4,
        "text": "Lifelong"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given scenario, benzathine penicillin G for <strong>secondary prophylaxis</strong> should be given for <strong>10 years</strong> <strong>from</strong> the <strong>last attack</strong> i.e,&nbsp;till<strong> 26 years</strong> <strong>of age</strong>. The given case is of rheumatic fever with carditis but with no residual valvular disease,&nbsp;for which secondary prophylaxis is given for 10 years from the last attack or till 21 years of age, whichever is longer.&nbsp;</p>\n<p>Recommendations for the<strong> duration of secondary prophylaxis </strong>with penicillin:</p>\n<table>\n<tbody>\n<tr>\n<td width=\"319\">\n<p><strong>Category of the patient</strong></p>\n</td>\n<td width=\"319\">\n<p><strong>Duration of prophylaxis</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p>Rheumatic fever without carditis</p>\n</td>\n<td width=\"319\">\n<p>For 5 years after the last attack or until 21 years of age ( whichever is longer)</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p>Rheumatic fever with carditis but with no residual valvular disease</p>\n</td>\n<td width=\"319\">\n<p>For 10 years after the last attack or until 21 yrs of age (whichever is longer)</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p>Rheumatic fever with persistent valvular disease evident clinically or on echo</p>\n</td>\n<td width=\"319\">\n<p>For 10 years after the last attack or until 40 years of age, or sometimes lifelong prophylaxis</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a protective factor for diabetes mellitus?",
    "choices": [
      {
        "id": 1,
        "text": "Intake of PUFAs"
      },
      {
        "id": 2,
        "text": "Intake of non-starch polysaccharides"
      },
      {
        "id": 3,
        "text": "Exclusive breastfeeding"
      },
      {
        "id": 4,
        "text": "Intake of saturated fats"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A<strong> higher</strong>&nbsp;intake of<strong>&nbsp;saturated fats&nbsp;</strong>is associated with an increased risk of <strong>diabetes mellitus</strong>.</p>\n<p>Dietary <strong>factors</strong> that are <strong>protective</strong> for diabetes mellitus are:</p>\n<ul>\n<li>Higher intake of<strong> unsaturated fatty acids</strong></li>\n<li>A minimum daily intake of 20g of <strong>dietary fibre</strong></li>\n<li>Exclusive <strong>breastfeeding</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient's fasting plasma glucose is 122 mg/dl and postprandial plasma glucose is 138 mg/dl. According to the WHO diagnostic criteria for diabetes, which category does this patient fall under?",
    "choices": [
      {
        "id": 1,
        "text": "Isolated post prandial hyperglycemia"
      },
      {
        "id": 2,
        "text": "Impaired glucose tolerance"
      },
      {
        "id": 3,
        "text": "Impaired fasting glucose"
      },
      {
        "id": 4,
        "text": "Overt diabetes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fasting blood glucose of 122 mg/dl with a postprandial value of 138 mg/dl indicates the patient falls under the criteria for <strong>impaired fasting glucose.</strong></p>\n<p>The<strong> WHO</strong> <strong>diagnostic criteria</strong> for diabetes and intermediate hyperglycemia is as follows:</p>\n<table style=\"height: 204px;\" width=\"408\">\n<tbody>\n<tr>\n<td style=\"width: 129.333px;\"><strong>Fasting plasma glucose</strong></td>\n<td style=\"width: 130.667px;\"><strong>Post prandial plasma glucose</strong></td>\n<td style=\"width: 130.667px;\"><strong>Diagnosis</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.333px;\">&ge; 126 mg/dl</td>\n<td style=\"width: 130.667px;\">&gt; 200 mg/dl</td>\n<td style=\"width: 130.667px;\">Diabetes</td>\n</tr>\n<tr>\n<td style=\"width: 129.333px;\">&lt; 126 mg/dl</td>\n<td style=\"width: 130.667px;\">140-200 mg/dl</td>\n<td style=\"width: 130.667px;\">Impaired glucose tolerance</td>\n</tr>\n<tr>\n<td style=\"width: 129.333px;\">110-125 mg/dl</td>\n<td style=\"width: 130.667px;\">&lt; 140 mg/dl</td>\n<td style=\"width: 130.667px;\">Impaired fasting glucose</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements are incorrect regarding the benefits of various interventions in diabetes?",
    "choices": [
      {
        "id": 1,
        "text": "1 & 2"
      },
      {
        "id": 2,
        "text": "2, 3 & 4"
      },
      {
        "id": 3,
        "text": "3 & 5"
      },
      {
        "id": 4,
        "text": "1, 2 & 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The use of <strong>ACE inhibitors</strong> in diabetics<strong> reduces</strong> the risk of <strong>nephropathy</strong> by <strong>42%</strong> and cardiovascular risk by 22%.\u00a0<strong>Annual eye examination</strong> in diabetics <strong>reduces</strong> the incidence of serious <strong>visual loss</strong> by <strong>60-70%.</strong></p>\n<p><strong>Interventions in diabetes:</strong></p>\n<ul>\n<li style=\"text-align: left;\">Glycaemic control\u00a0in diabetics with HbA1C &gt; 9% reduces microvascular disease risk by 30% per 1% drop in HbA1c.</li>\n<li>Blood pressure control in patients with BP &gt; 130/80 mmHg reduces microvascular and macrovascular disease risk by 35% per 10 mmHg drop in blood pressure.</li>\n<li>Lifestyle modification reduces the incidence of diabetes by 35-58%.</li>\n<li>Metformin administered as a preventive therapy reduces the incidence of diabetes by 25-31%.</li>\n<li>Proper foot care reduces the risk of serious foot disease by 50-60%.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The community health officer of an area is instructed to assess the population for the risk factors of Non-alcoholic Fatty Liver Disease under NP-NCD. Which of the following will not be a risk factor?",
    "choices": [
      {
        "id": 1,
        "text": "Pedal edema"
      },
      {
        "id": 2,
        "text": "Abdominal obesity"
      },
      {
        "id": 3,
        "text": "History of cancer"
      },
      {
        "id": 4,
        "text": "Low blood pressure"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Low blood pressure is not a risk factor for NAFLD according to the NP-NCD.</p>\n<p>The National Programme for Prevention &amp; Control of Non-Communicable Diseases (<strong>NP-NCD</strong>), which was earlier NPCDCS, has&nbsp;<strong>integrated guidelines</strong> for the management of <strong>Non-alcoholic Fatty Liver disease (NAFLD)</strong> into its framework. Through a community-based assessment checklist, the <strong>community health officer</strong> along with <strong>ASHA workers</strong> will assess for the presence of the following <strong>risk factors</strong>:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abdominal obesity (waist circumference of &gt;90cm in men and &gt;80cm in women)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Personal or family history of diabetes, hypertension, cancers, heart diseases, liver diseases or gallstones</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Obesity (BMI &gt;23 kg/m<sup>2</sup>)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Presence of pedal edema</li>\n</ol>\n<table>\n<tbody>\n<tr>\n<td>Level of healthcare</td>\n<td>Provisions</td>\n</tr>\n<tr>\n<td>Community level</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">ASHA workers assess for abdominal obesity, relevant personal or family history.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Refer to the sub-health centre.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Sub-Health Centre</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Validate ASHA workers&rsquo; referrals.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Further assess for <strong>pedal edema</strong>, <strong>BMI</strong>, and screen for <strong>other NCDs</strong>.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Primary Health Centre</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Assessment of SHC referrals for <strong>signs of chronic liver disease</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Basic treatment</strong> for DM/HTN.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Community Health Centre</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Rule out other causes of liver disease, and perform <strong>CBC</strong> and<strong> LFT</strong>. Calculate <strong>FIB4</strong> or <strong>NFS score</strong>.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">If l<strong>ow risk</strong> of fibrosis - Refer back to the PHC for <strong>conservative management</strong>, weight reduction etc. Reassess in 3 years.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">If <strong>indeterminate</strong>, or high risk of fibrosis - Refer to a <strong>higher centre</strong>.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>District level</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Perform <strong>Fibroscan</strong> for <strong>indeterminate risk</strong> of fibrosis.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">In case of <strong>low risk</strong> of fibrosis - Refer back to the PHC for <strong>conservative management</strong>, weight reduction, etc. Reassess in 3 years.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">In case of <strong>high risk</strong> of fibrosis - Management of fibrosis, screening for <strong>HCC</strong> and <strong>portal hypertension</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Refer complicated cases to tertiary level.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td>Tertiary level</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Management of <strong>complicated cases.</strong></li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><br /><br /><br /><br /><br /><br /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '21 Non-Communicable Diseases - Cardiovascular Diseases And Diabetes';
        let hierarchy = ["Marrow", "qBank", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>