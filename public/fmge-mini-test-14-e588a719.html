<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 14 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the accommodative amplitude of a patient with a near point at 20 cm and a far point at infinity?",
    "choices": [
      {
        "id": 1,
        "text": "5 D"
      },
      {
        "id": 2,
        "text": "1 D"
      },
      {
        "id": 3,
        "text": "4 D"
      },
      {
        "id": 4,
        "text": "2.5 D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The amplitude of accommodation for the above patient would be <strong>5 dioptres.</strong></p>\n<p><strong>Near point of accommodation (NPA) </strong>is the closest distance at which the near object is clearly focussed without blur.</p>\n<p><strong>Amplitude of accommodation</strong> is the maximum power of the lens that permits clear near vision without blur. Its unit is <strong>dioptre (D). </strong>The amplitude of accommodation is the <strong>reciprocal of near point of accommodation (NPA)</strong> in meters.</p>\n<p><strong>20 cm is 1/5<sup>th</sup> of a metre.</strong> Therefore, the accommodative amplitude is its inverse, that is, 5D.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f427823ff7a4495b6ff8a4d582cd441x451x74.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00e3a8fb61894eca84a5ba5a0212d7b2x1280x1607.672778561354.JPEG"
    ]
  },
  {
    "text": "Which of the following is not true regarding Bowen\u2019s disease?",
    "choices": [
      {
        "id": 1,
        "text": "Intraepidermal squamous cell carcinoma"
      },
      {
        "id": 2,
        "text": "Red scaly plaque is present"
      },
      {
        "id": 3,
        "text": "High potential for invasive malignancy"
      },
      {
        "id": 4,
        "text": "Size remains consistent throughout"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Bowen's disease </strong>has&nbsp;a <strong>low potential </strong>for invasive<strong> malignancy.&nbsp;</strong></p>\n<p>It is an <strong>intraepidermal</strong> squamous cell carcinoma<strong>&nbsp;</strong>that<strong>&nbsp;</strong>is characterized by a&nbsp;persistent, non\u2010elevated, <strong>red</strong>, <strong>scaly</strong>, or crusted plaque with a <strong>small potential</strong> for invasive malignancy. Histologically, it is characterized by <strong>full-thickness epidermal dysplasia</strong>.</p>\n<p>It usually grows progressively but sometimes undergoes&nbsp;<strong>spontaneous</strong> <strong>partial</strong> <strong>resolution</strong>. It can occur anywhere, but it occurs more in the <strong>head and neck</strong> region.</p>\n<p><strong>Human papilloma virus&nbsp;</strong>infection is associated with it.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b3ceae757274e5bbb82ee20a70840f8x1280x1216.8124118476728.JPEG"
    ]
  },
  {
    "text": "Which of the following is false according to Caldwell and Moloy classification of pelvis:",
    "choices": [
      {
        "id": 1,
        "text": "Android pelvis:  prominent ischial spines"
      },
      {
        "id": 2,
        "text": "Platypelloid pelvis: has AP diameter > transverse diameter"
      },
      {
        "id": 3,
        "text": "Gynecoid pelvis:  sacral angle greater than 90 degree"
      },
      {
        "id": 4,
        "text": "Anthropoid pelvis: high incidence of face to pubis delivery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Platypelloid pelvis has a <strong>transverse diameter much larger than the anteroposterior diameter.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/011535fbaaf341d3a6d75538abb0d91dx1280x1638.JPEG"
    ]
  },
  {
    "text": "In which of the following conditions will you perform the Kasai procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Extrahepatic biliary atresia"
      },
      {
        "id": 2,
        "text": "Type 1 choledochal cyst"
      },
      {
        "id": 3,
        "text": "Caroli disease"
      },
      {
        "id": 4,
        "text": "Cholangiocarcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Kasai procedure</strong> (<strong>Roux-en-Y hepatoportoenterostomy</strong>) is done for <strong>extrahepatic biliary atresia.</strong>&nbsp;In the Kasai procedure, the occluded extrahepatic bile ducts are excised and a jejunal Roux loop is anastomosed to the hepatic hilum.</p>\n<p>Extrahepatic biliary atresia&nbsp;(EHBA) is defined as a partial or total <strong>absence </strong>of permeable<strong> bile duct </strong>between porta hepatis and the duodenum. It is due to <strong>inflammatory fibrosis</strong> of the biliary tree.&nbsp;It leads to obstruction to bile flow thereby causing leaking of <strong>conjugated bilirubin</strong> into the circulation.</p>\n<p>Associated anomalies include cardiac lesions, <strong>polysplenia</strong>, <strong>situs inversus</strong>, <strong>absent vena cava</strong>, and a preduodenal portal vein.</p>\n<p><strong>HIDA scan</strong>&nbsp;is the <strong>investigation of choice</strong> for EHBA. <strong>Intraoperative cholangiogram</strong> is the&nbsp;<strong>gold standard</strong> for diagnosis.</p>\n<table style=\"height: 261px; width: 496.6875px;\">\n<tbody>\n<tr style=\"height: 29.7656px;\">\n<td style=\"width: 754.6875px; text-align: center; height: 29.7656px;\" colspan=\"3\"><strong>Management of extrahepatic biliary atresia</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">Type I</td>\n<td style=\"width: 295px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Atresia restricted to the common bile duct</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 355.6875px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Roux-en-Y hepaticojejunostomy</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">Type II</td>\n<td style=\"width: 295px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Atresia of the common hepatic duct</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 355.6875px; height: 54px;\" rowspan=\"2\"><strong>Kasai procedure</strong> (Roux-en-Y hepatoportoenterostomy)</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">Type III</td>\n<td style=\"width: 295px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Atresia of the right and left hepatic duct</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Infants</strong> with biliary atresia, who do not achieve successful drainage after Kasai's procedure, require<strong> liver transplantation</strong> within the first year of life. It is the most common reason for liver transplantation in children.</p>\n<p>Kasai procedure:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a5dea0598624632a466b5cbb4eda70cx720x866.PNG"
    ]
  },
  {
    "text": "A 45-year-old  chronic alcoholic with liver disease came to the hospital with complaints of distension of the abdomen. On per abdominal examination shifting dullness was positive. Which of the following is the diuretic of choice in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Chlorthiazide"
      },
      {
        "id": 2,
        "text": "Acetazolamide"
      },
      {
        "id": 3,
        "text": "Spironolactone"
      },
      {
        "id": 4,
        "text": "Mannitol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical feature and the <strong>positive shifting dullness</strong> indicate <strong>ascites&nbsp;</strong>probably&nbsp;due to liver cirrhosis in alcoholic liver disease. Spironolactone is used in the treatment of ascites due to cirrhosis. The diuretic of choice in a patient with<strong> cirrhotic ascites&nbsp;</strong>is <strong>spironolactone.</strong></p>\n<p><strong>Spironolactone</strong> is a <strong>competitive inhibitor</strong> of the <strong>mineralocorticoid receptor</strong> in the <strong>late distal tubule and collecting duct</strong> of the kidneys. It causes a decrease in sodium reabsorption and potassium excretion in the distal tubule. As a result, spironolactone <strong>promotes sodium diuresis</strong> but <strong>maintains body potassium levels</strong>. Spironolactone is particularly helpful in edematous states caused or exacerbated by hyperaldosteronism such as in cirrhotic ascites.</p>\n<div class=\"page\" title=\"Page 2458\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Furosemide</strong> may be added particularly in patients of ascites who have<strong> peripheral edema</strong> and non responsive to spironolactone.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The image given below is used for the depiction of _______ of a disease in epidemiology.",
    "choices": [
      {
        "id": 1,
        "text": "International variations"
      },
      {
        "id": 2,
        "text": "Local distributions"
      },
      {
        "id": 3,
        "text": "Rural \u2013 urban distributions"
      },
      {
        "id": 4,
        "text": "National variation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Spot maps are used to understand the local distributions of a disease.</p>\n<p>Spot maps:</p>\n<ul>\n<li>They are also called <strong>shaded maps</strong>.</li>\n<li>They depict areas of high or low frequency, the boundaries, and patterns of disease distribution.</li>\n<li>This method was used by <strong>John Snow</strong> to investigate the epidemic of cholera in London in 1854.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4677a8249d394b12b81421f8a77942ba.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient, known case of osteoarthritis is keen on taking the Kellgren and Lawrence scoring test. This scoring system is based on which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Pathological features"
      },
      {
        "id": 2,
        "text": "Radiological features"
      },
      {
        "id": 3,
        "text": "Arthroscopic features"
      },
      {
        "id": 4,
        "text": "Clinical features"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Kellgren and Lawrence scoring system uses <strong>radiographic changes&nbsp;</strong>(X-rays) to divide OA into five categories.</p>\n<p>It is the most commonly used system.</p>\n<ul>\n<li><strong>Grade 0</strong>:&nbsp;no radiographic features of OA are present</li>\n<li><strong>Grade 1</strong>:&nbsp;doubtful joint space narrowing (JSN) and possible osteophytic lipping</li>\n<li><strong>Grade 2</strong>:&nbsp;definite osteophytes and possible JSN on anteroposterior weight-bearing radiograph</li>\n<li><strong>Grade 3</strong>:&nbsp;multiple osteophytes, definite JSN, sclerosis, possible bony deformity</li>\n<li><strong>Grade 4</strong>:&nbsp;large osteophytes, marked JSN, severe sclerosis and definite bony deformity&nbsp;</li>\n</ul>\n<p>Other radiological classification systems include Ahlb&auml;ck radiographic classification for knee OA.</p>\n<p><strong>The Outerbridge classification</strong> is based on cartilage damage as observed by arthroscopy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a part of levator ani?",
    "choices": [
      {
        "id": 1,
        "text": "Puborectalis"
      },
      {
        "id": 2,
        "text": "Pubococcygeus"
      },
      {
        "id": 3,
        "text": "Ischiococcygeus"
      },
      {
        "id": 4,
        "text": "Iliococcygeus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ischiococcygeus</strong> is not a part of levator ani muscle.</p>\n<p>Ischiococcygeus&nbsp;<strong>(coccygeus) is a separate muscle,&nbsp;</strong>and lies at the posterosuperior part of the levator ani.</p>\n<p>The levator ani forms a large portion of the pelvic floor. It is composed of<strong> three separate paired muscles:</strong></p>\n<ul>\n<li>Pubococcygeus</li>\n<li>Puborectalis</li>\n<li>Iliococcygeus</li>\n</ul>\n<p>The pelvic floor has two hiatuses:</p>\n<ul>\n<li>The urogenital hiatus &ndash; An anteriorly situated gap, which allows passage of the urethra (and the vagina in females).</li>\n<li>The rectal hiatus &ndash; A centrally positioned gap, which allows passage of the anal canal.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11e139602f4e4906b52a76536cc175c7x1280x2558.JPEG"
    ]
  },
  {
    "text": "The image given below represents ______",
    "choices": [
      {
        "id": 1,
        "text": "Pratt\u2019s sign"
      },
      {
        "id": 2,
        "text": "Moses sign"
      },
      {
        "id": 3,
        "text": "Homan\u2019s sign"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Image shows eliciting \"Homan&rsquo;s sign\" i.e. calf tenderness on forced ankle dorsiflexion seen in DVT(deep venous thrombosis)</p>\n<p>Other signs are:</p>\n<ul>\n<li>Moses Sign - Calf tenderness on direct pressure on calf.</li>\n<li>Pratt&rsquo;s Sign - Calf tenderness on squeezing the calf from sides.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/479d74c727c24571b425e3b57b0b61a3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A capnograph obtained from an intubated patient undergoing controlled ventilation is given below. Which of the following is a likely cause of the finding seen?",
    "choices": [
      {
        "id": 1,
        "text": "Esophageal intubation"
      },
      {
        "id": 2,
        "text": "Inspiration with cardiac oscillations"
      },
      {
        "id": 3,
        "text": "Bronchospasm"
      },
      {
        "id": 4,
        "text": "Spontaneous respiratory effort"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>curare notch</strong> in the plateau phase of the capnograph indicates that the <strong>patient is trying to breathe spontaneously</strong>. The patient's inspiratory effort causes some fresh gas to be sucked in the capnometer, resulting in a lower carbon dioxide concentration and a notch.</p>\n<p>Image below shows a capnograph with clefts during phase III\u00a0which indicates <strong>spontaneous breathing</strong> efforts by the patient during controlled mechanical ventilation. It is also known as a\u00a0<strong>curare notch or cleft.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c61ec4275cc24d79888d2e236f9e52ac.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4593cdc76ff47e7b1c27cfd8868f381x1279x904.JPEG"
    ]
  },
  {
    "text": "Which of the following GAG is responsible for the charge selectiveness of the renal glomerular basement membrane?",
    "choices": [
      {
        "id": 1,
        "text": "Heparan sulfate"
      },
      {
        "id": 2,
        "text": "Heparin"
      },
      {
        "id": 3,
        "text": "Dermatan sulfate"
      },
      {
        "id": 4,
        "text": "Hyaluronic acid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Heparan sulfate</strong> is the GAG involved in the charge selectiveness of renal glomerular basement membrane.</p>\n<p>Heparan sulfate is a GAG made up of repeating units of <strong>glucosamine</strong> and <strong>glucuronic acid</strong>.</p>\n<p><strong>Functions:</strong></p>\n<ul>\n<li><strong>Mediation of cell growth</strong> and <strong>cell-cell communicatio</strong>n by acting as receptors on the cell membrane</li>\n<li>Charge selectiveness of glomerular filtration: Since heparan sulfate contains a lot of <strong>negative charges</strong>, its ability to <strong>repel proteins</strong> is important in glomerular filtration.</li>\n<li><strong>Lipoprotein lipase</strong> is anchored by heparan sulfate.</li>\n</ul>\n<p><strong>Note :</strong>&nbsp;</p>\n<ul>\n<li>The only <strong>intracellular GAG</strong> is <strong>heparin.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which one of the following is not a feature in cerebral palsy?",
    "choices": [
      {
        "id": 1,
        "text": "Hypotonia"
      },
      {
        "id": 2,
        "text": "Microcephaly"
      },
      {
        "id": 3,
        "text": "Ataxia"
      },
      {
        "id": 4,
        "text": "Flaccid paralysis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Flaccid paralysis </strong>is <strong>not</strong> a feature of cerebral palsy (CP). It is a feature of <strong>lower motor neuron disease</strong>.</p>\n<p>CP is a <strong>static encephalopathy</strong> and a disorder of posture and movement often associated with:</p>\n<ul>\n<li>A deficit in the motor, language, and social milestones</li>\n<li><strong>Microcephaly</strong> is a feature of cerebral palsy because of the insult to the developing brain.</li>\n<li>Dystonic CP is associated with <strong>hypotonia</strong></li>\n<li>Extrapyramidal CP is associated with <strong>ataxia</strong></li>\n<li>It is an <strong>upper motor neuron disease </strong>characterized by rigidity and scissoring gait.</li>\n<li>Spastic CP is the<strong> commonest</strong> type (65%)</li>\n</ul>\n<p>Scissoring gait is a characteristic feature of cerebral palsy as shown in the GIF below-</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cd480ee47cc947ccb1c31d18bad0e6aax510x520.GIF"
    ]
  },
  {
    "text": "A 35-year-old lady who had tested positive for HPV  is undergoing an investigation where the following device is used. Which of the following statements is false about this investigation?",
    "choices": [
      {
        "id": 1,
        "text": "This device provides binocular vision"
      },
      {
        "id": 2,
        "text": "It is used in lithotomy position"
      },
      {
        "id": 3,
        "text": "Green filter is used to study vascular pattern"
      },
      {
        "id": 4,
        "text": "External os is visualised at a distance of 50 cm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">The device shown in the image is a <strong>colposcope. </strong>It is used to perform colposcopy where&nbsp;the <strong>cervix </strong>is<strong>&nbsp;visualized&nbsp;</strong>at a <strong>distance</strong> <strong>of</strong> around <strong>20 cm</strong>&nbsp;with the patient in the&nbsp;lithotomy position.</p>\n<p>This instrument provides <strong>binocular vision</strong> with a <strong>magnification</strong> of 6x-15x. A green filter is used to study <strong>vascular pattern</strong> as the vessels appear black. <strong>Abnormal</strong> areas can be identified by their peculiar vascular pattern such as <strong>mosaic, reticular</strong>, and<strong> punctate</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/89fe9e0ed3e34863a0758e2e18e49efe.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents with loss of taste from anterior 2/3rd of tongue, hyperacusis, loss of lacrimation. Injury is at_____.",
    "choices": [
      {
        "id": 1,
        "text": "Tympanic segment"
      },
      {
        "id": 2,
        "text": "Mastoid segment"
      },
      {
        "id": 3,
        "text": "Proximal to geniculate ganglion"
      },
      {
        "id": 4,
        "text": "Chorda tympani"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The location of the injury is proximal to the geniculate ganglion.</p>\n<p>Injury to <strong>greater superficial petrosal nerve </strong>leads to <strong>loss of lacrimation </strong>which is detected by the Schirmer test. It is the first branch given at the level of the geniculate ganglion.</p>\n<p>Injury to <strong>nerve to stapedius </strong>which is the<strong> first motor branch of the facial nerve </strong>leads to<strong> loss of stapedial reflex </strong>and<strong> hyperacusis</strong> which can be detected by tympanometry.</p>\n<p>Injury to <strong>chorda tympani </strong>leads to <strong>loss of taste from anterior 2/3<sup>rd</sup> of the tongue</strong> which is detected by electrogustometry and <strong>reduced submandibular and sublingual salivary flow</strong> detected by salivary flow test.</p>\n<p>Since this patient has symptoms of involvement of all 3 nerves the lesion is proximal to the first branch. Hence proximal to the geniculate ganglion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with recurrent UTIs is suspected to have a congenital renal anomaly. The following picture is seen on IV urography. Based on these findings, which of the following would you suspect?",
    "choices": [
      {
        "id": 1,
        "text": "Retrocaval ureter"
      },
      {
        "id": 2,
        "text": "Vesicoureteric reflux"
      },
      {
        "id": 3,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 4,
        "text": "Multicystic dysplastic kidney"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a right-sided<strong> fish hook&nbsp;</strong>or <strong>S-shaped&nbsp;</strong>ureter. It describes the appearance of a&nbsp;<strong>retrocaval ureter</strong> as the right ureter hooks behind the IVC.</p>\n<p><strong>Circumcaval </strong>or retrocaval ureter is a developmental anomaly of the inferior vena cava (<strong>IVC</strong>). It is due to abnormal development of the right supracardinal system. There is a <strong>persistent</strong>&nbsp;right posterior<strong> cardinal vein&nbsp;</strong>that ends up passing in front of the ureter. The anomaly <strong>always</strong> occurs on the <strong>right side</strong>, as this is the side of the normal IVC.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c8c0a53b31d04449aeaaa97e79409dbe.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2cac9fcfb46e4d52af3e55a449bd518fx1280x1587.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a8813ec2e13487c894176ae6f3f7c31x1280x1587.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c63b681645c34d5e903aaa36fc14e9cax1280x1535.JPEG"
    ]
  },
  {
    "text": "All of the following belong to secretin family except____",
    "choices": [
      {
        "id": 1,
        "text": "GIP"
      },
      {
        "id": 2,
        "text": "Glucagon"
      },
      {
        "id": 3,
        "text": "CCK"
      },
      {
        "id": 4,
        "text": "VIP"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>CCK (Cholecystokinin) </strong>belongs to<strong>&nbsp;</strong>the<strong> gastrin </strong>family, not the secretin family.</p>\n<p><strong>Classification of GI hormones based on structure and function:</strong></p>\n<ul>\n<li>Gastrin family - Gastrin,&nbsp;Cholecystokinin.</li>\n<li>Secretin family - Secretin, Glucagon, VIP, GIP.</li>\n<li>Others - Motilin, Ghrelin, Somatostatin, etc.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 41-year-old female patient presented with a tortuous swelling over the left side of the scalp and face as shown in the image given below. On local examination, the swelling was pulsatile. On auscultation, a bruit was heard. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Neurofibromatosis"
      },
      {
        "id": 2,
        "text": "Liposarcoma"
      },
      {
        "id": 3,
        "text": "Cirsoid Aneurysm"
      },
      {
        "id": 4,
        "text": "Varicocele"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image showing tortuous swelling over the scalp and the clinical findings are suggestive of a&nbsp;<strong>cirsoid aneurysm.</strong></p>\n<p><strong>Cirsoid aneurysm&nbsp;</strong>is a slow-growing, tortuous swelling that develops due to<strong> abnormal arteriovenous connections</strong>&nbsp;among the subcutaneous blood vessels. They are usually <strong>congenital. </strong>However, in some cases, they may be traumatic. Patients present with a <strong>tortuous, pulsatile swelling</strong> over the <strong>scalp</strong> or <strong>face.&nbsp;</strong>They are usually asymptomatic and present to the clinic due to cosmetic deformity. However, some patients may have headache, tinnitus, and/or bleeding. A loud <strong>bruit</strong> is heard on auscultation.</p>\n<p><strong>Angiography</strong> is the investigation of choice.</p>\n<p><strong>Treatment</strong> includes <strong>surgical resection, endovascuar occlusion&nbsp;</strong>or injection of <strong>percutaneous sclerosing agents.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/62742f03effd463bbebc2af8a2f917c8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male presents with painless cervical lymphadenopathy. On examination, the right ear reveals conductive hearing loss with a dull tympanic membrane. Moreover, decreased mobility of the soft palate was also noted.  Treatment of choice for this patient's condition is?",
    "choices": [
      {
        "id": 1,
        "text": "Surgery"
      },
      {
        "id": 2,
        "text": "Radiotherapy"
      },
      {
        "id": 3,
        "text": "Chemotherapy"
      },
      {
        "id": 4,
        "text": "Surgery and radiotherapy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient most likely has<strong> nasopharyngeal carcinoma. Radiotherapy</strong>&nbsp;is the <strong>treatment of choice</strong> for nasopharyngeal cancer.</p>\n<p><strong>Nasopharyngeal carcinoma:</strong></p>\n<ul>\n<li>Nasopharyngeal carcinoma is also called&nbsp;Guangdong tumor.</li>\n<li>Commonest site of origin of nasopharyngeal carcinoma is the<strong>&nbsp;</strong>fossa of Rosenm&uuml;ller.</li>\n<li>Epstein&ndash;Barr Virus (EBV)&nbsp;is closely associated with nasopharyngeal cancer.</li>\n<li>Presenting symptoms and signs of nasopharyngeal cancer in order of frequency are:\n<ul>\n<li><strong>Cervical lymphadenopathy (most common) (60&ndash;90%)</strong></li>\n<li>Hearing loss</li>\n<li>Nasal obstruction</li>\n<li>Epistaxis</li>\n<li>Cranial nerve palsies -Cranial nerves V and VI are the most commonly involved among all the cranial nerves. (V more than VI)</li>\n<li>Headache</li>\n<li>Earache</li>\n<li>Neck pain</li>\n<li>Weight loss</li>\n</ul>\n</li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">&nbsp;Nasopharyngeal cancer can cause:</p>\n<ul>\n<li>Conductive deafness (<strong>eustachian tube block</strong>)</li>\n<li>Ipsilateral temporoparietal/facial neuralgia (involvement of&nbsp;<strong>CN V</strong>) and</li>\n<li>Palatal paralysis (<strong>CN X</strong>)</li>\n</ul>\n<p>This is collectively called&nbsp;<strong>Trotter&rsquo;s triad</strong>.</p>\n<p>Radiotherapy&nbsp;is the&nbsp;treatment of choice&nbsp;for nasopharyngeal cancer.</p>\n<ul>\n<li>Stage I and II&nbsp;are treated by&nbsp;radiotherapy alone.</li>\n<li>Stage III and IV require concomitant radiation and chemotherapy&nbsp;or radiation followed by chemotherapy.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the ideal time for nuchal translucency evaluation?",
    "choices": [
      {
        "id": 1,
        "text": "6-8 weeks"
      },
      {
        "id": 2,
        "text": "11-14 weeks"
      },
      {
        "id": 3,
        "text": "14-16 weeks"
      },
      {
        "id": 4,
        "text": "16-20 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 215\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Nuchal translucency</strong> evaluation, a component of <strong>first-trimester</strong> aneuploidy screening, is done between <strong>11-14 weeks.</strong></p>\n<div class=\"page\" title=\"Page 215\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>It represents the maximum thickness of the subcutaneous translucent area between the skin and soft tissue, overlying the fetal spine, at the back of the neck. When the nuchal translucency is <strong>increased</strong>, the <strong>risk of fetal aneuploidy</strong> and structural anomalies such as&nbsp;heart defects is significantly <strong>elevated</strong>.</p>\n<div class=\"page\" title=\"Page 215\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>First trimester aneuploidy screening</strong>&nbsp;combines two maternal serum analytes and a sonographic measurement:</p>\n<ol>\n<li>Human chorionic gonadotropin&nbsp;<strong>(hCG)</strong></li>\n<li>Pregnancy-associated plasma protein A (<strong>PAPP-A</strong>)</li>\n<li>Nuchal translucency (<strong>NT</strong>)</li>\n</ol>\n<p>It is performed between&nbsp;<strong>11 and 14 weeks&nbsp;</strong>of&nbsp;gestation.&nbsp;In cases of fetal Down syndrome, the first-trimester serum-free&nbsp;<strong>&beta;-hCG&nbsp;</strong>level is<strong>&nbsp;higher&nbsp;</strong>and the&nbsp;<strong>PAPP-A&nbsp;</strong>level is<strong>&nbsp;lower</strong>.&nbsp;With trisomy 18 and trisomy 13, levels of both analytes are lower.</p>\n<p>Note: <strong>Nuchal fold</strong>&nbsp;is a normal fold of skin seen at the back of the fetal neck during the <strong>second trimester</strong> of pregnancy. <strong>Increased</strong> nuchal fold <strong>thickness</strong> is associated with <strong>fetal aneuploidy.</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/80eecda627d649f88eabb4729ca2c85ax796x599.JPEG"
    ]
  },
  {
    "text": "A patient presents with fever, productive cough, and weight loss. He gives a history of not having completed treatment for tuberculosis thrice in the past. Extensively drug-resistant TB is suspected. How is this entity defined?",
    "choices": [
      {
        "id": 1,
        "text": "Resistance to INH + Amikacin + Ofloxacin + Ethambutol"
      },
      {
        "id": 2,
        "text": "Resistance to INH + Rifampicin + Amikacin"
      },
      {
        "id": 3,
        "text": "Resistance to Rifampicin + Amikacin+ Ofloxacin"
      },
      {
        "id": 4,
        "text": "Resistance to INH + Rifampicin + Ofloxacin + Linezolid"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong> XDR-TB</strong> (<strong>extensively drug-resistant&nbsp;TB</strong>) is defined as <strong>multi-drug resistant&nbsp; TB</strong> (resistant to rifampicin and isoniazid) which is also<strong>&nbsp;</strong>resistant to one <strong>fluoroquinolone</strong> (eg. ofloxacin) AND&nbsp;resistant to atleast one additional group A drug (as of 2021, these are&nbsp;<a href=\"https://www.uptodate.com/contents/bedaquiline-drug-information?search=xdr+tb&amp;topicRef=8028&amp;source=see_link\" target=\"_blank\" data-topicid=\"87509\" rel=\"noopener\">bedaquiline</a>&nbsp;and&nbsp;<a href=\"https://www.uptodate.com/contents/linezolid-drug-information?search=xdr+tb&amp;topicRef=8028&amp;source=see_link\" target=\"_blank\" data-topicid=\"10283\" rel=\"noopener\">linezolid)</a></p>\n<p>It is usually seen in patients who have previously received treatment for TB and have either failed to complete treatment or relapsed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of these are antigen presenting cells (APC\u2019s) except _____",
    "choices": [
      {
        "id": 1,
        "text": "Helper T cells"
      },
      {
        "id": 2,
        "text": "Macrophages"
      },
      {
        "id": 3,
        "text": "Fibroblasts"
      },
      {
        "id": 4,
        "text": "Dendritic cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>T cell</strong> is not an antigen-presenting cell. The antigens are presented by antigen presenting cells to T-cell.</p>\n<p>Examples of antigen presenting cells:&nbsp;</p>\n<ul>\n<li>Dendritic cells</li>\n<li>Macrophage</li>\n<li>B cells</li>\n<li>Glial cells (brain)</li>\n<li>Fibroblasts (skin)</li>\n<li>Pancreatic beta-cell</li>\n<li>Thymic epithelial cells</li>\n<li>Vascular endothelial cells</li>\n<li>Thyroid epithelial cells</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old man presents to the clinic with a non-specific history of malaise. Mild sensorineural hearing loss had been diagnosed during his early education, although hearing aids were not required. He gives a history of recurrent hematuria and current investigations reveal the same. What is the most likely diagnosis among the following?",
    "choices": [
      {
        "id": 1,
        "text": "Fanconi\u2019s anemia"
      },
      {
        "id": 2,
        "text": "Alport syndrome"
      },
      {
        "id": 3,
        "text": "Autosomal dominant polycystic kidney disease"
      },
      {
        "id": 4,
        "text": "IgA nephropathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Alport syndrome</strong> is the most likely diagnosis. Alport syndrome is a cause of <strong>recurrent hematuria</strong>, which is associated with <strong>sensorineural hearing loss.</strong></p>\n<p>A&nbsp;<strong>defect in type IV collagen</strong>, a major component of the basement membrane, is responsible for&nbsp;<strong>Alport syndrome.</strong></p>\n<p>Alport syndrome&nbsp;is a genetically heterogeneous disease,&nbsp;<strong>85% is X-linked</strong>&nbsp;and the rest may be autosomal recessive or autosomal dominant.</p>\n<p><strong>&nbsp;Other causes of recurrent hematuria</strong></p>\n<ul>\n<li>Alport syndrome</li>\n<li>IgA nephropathy</li>\n<li>Autosomal dominant polycystic kidney disease (ADPKD)</li>\n<li>Papillary necrosis</li>\n<li>Renal cell carcinoma&nbsp; &nbsp; &nbsp;&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the sign represented by the image below called?",
    "choices": [
      {
        "id": 1,
        "text": "Chvostek\u2019s sign"
      },
      {
        "id": 2,
        "text": "Trousseau's sign"
      },
      {
        "id": 3,
        "text": "Lhermitte's sign"
      },
      {
        "id": 4,
        "text": "Troisier\u2019s sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image indicates the presence of <strong>Trousseau's sign or carpopedal spasm</strong> in patients experiencing <strong>hypocalcemia</strong>.</p>\n<ul>\n<li>To elicit the sign, a <strong>blood pressure cuff</strong> is placed around the arm, inflated to a pressure greater than the systolic blood pressure, and held in <strong>place for 3 minutes</strong>.</li>\n<li>This will <strong>occlude</strong> the <strong>brachial artery</strong>.</li>\n<li>In the absence of blood flow, the patient's condition of\u00a0<strong>hypocalcemia</strong> and subsequent neuromuscular irritability will <strong>induce spasm of the muscles of the hand and forearm</strong>.</li>\n<li>This sign is also known as <strong>main d'accoucheur</strong> (French word for \"<strong>hand of the obstetrician</strong>\") because it supposedly resembles the position of an obstetrician's hand while delivering a baby.</li>\n</ul>\n<p><strong>Other options</strong></p>\n<p><strong>Chvostek's sign</strong></p>\n<ul>\n<li>Seen in hypocalcemia</li>\n<li>When the facial nerve is <strong>tapped in front of the tragus,</strong> the facial muscles on the same side of the face will <strong>contract momentarily</strong> (typically a twitch of the nose or lips) because of hypocalcemia.</li>\n</ul>\n<p><strong>Troisier's sign </strong></p>\n<ul>\n<li>Associated with left supraclavicular lymphadenopathy in metastatic abdominal malignancy.</li>\n</ul>\n<p><strong>Lhermitte\u2019s sign</strong></p>\n<ul>\n<li><strong>Barber chair phenomenon</strong> - Electric shock-like sensation upon flexion of the neck observed, involving the <strong>posterior column</strong>.</li>\n<li>Classically seen in association with\u00a0<strong>multiple sclerosis.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/14ae8a110963409f95685da4ea98797e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male smoker develops severe chest pain. He is diagnosed with MI based on his electrocardiogram and serial CK-MB levels. One week later, he again experiences precordial pain and develops a fever of 101.5\u00b0F. Physical examination is remarkable for a loud friction rub. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Caseous pericarditis"
      },
      {
        "id": 2,
        "text": "Fibrinous pericarditis"
      },
      {
        "id": 3,
        "text": "Hemorrhagic pericarditis"
      },
      {
        "id": 4,
        "text": "Purulent pericarditis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario suggests post-myocardial infarction <strong>fibrinous pericarditis</strong>.</p>\n<p><strong>Fibrinous Pericarditis:</strong></p>\n<ul>\n<li>Most frequent type of pericarditis</li>\n<li>Seen following <strong>myocardial infarct, rheumatic fever, trauma, uremia, radiation, systemic lupus erythematosus\u00a0(SLE), severe pneumonia</strong></li>\n<li>Clinically:\u00a0<strong>loud pericardial friction rub</strong></li>\n<li>Rubbery fibrin mass loosely glueing the parietal and visceral pericardium together (\u201c<strong>bread and butter</strong>\u201d)</li>\n<li>May resolve or become organized to produce an <strong>adhesive pericarditis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old chronic smoker is being evaluated for chronic diarrhea, steatorrhea, and weight loss. On examination, pallor was noted. Peripheral smear revealed macrocytes and hypersegmented neutrophils. Stool examination showed elevated calprotectin and a positive guaiac test. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ulcerative colitis"
      },
      {
        "id": 2,
        "text": "Diverticulitis"
      },
      {
        "id": 3,
        "text": "Crohn\u2019s disease"
      },
      {
        "id": 4,
        "text": "Irritable bowel syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario is suggestive of <strong>Crohn's </strong>disease<strong>&nbsp;</strong>presenting as <strong>jejunoileitis</strong>. This is evidenced by the presence of features of <strong>malabsorption</strong> such as steatorrhea, chronic diarrhea, and vitamin B12 deficiency anemia.</p>\n<p>The&nbsp;<strong>fecal calprotectin</strong>&nbsp;and&nbsp;<strong>lactoferrin</strong>&nbsp;are elevated in&nbsp;<strong>inflammatory conditions</strong>&nbsp;like inflammatory bowel disease, but not in irritable bowel syndrome.&nbsp;</p>\n<p>The&nbsp;<strong>stool</strong> <strong>guaiac test</strong>&nbsp;or&nbsp;guaiac fecal occult blood test&nbsp;(gFOBT) reveals the presence of microscopic levels of blood suggesting <strong>Crohn's</strong> disease. <strong>Gross bleeding</strong> per rectum is more characteristic of <strong>ulcerative colitis.</strong>&nbsp;&nbsp;</p>\n<p>Additionally, <strong>smoking</strong> is a risk factor for Crohn's disease. However, it is a<strong> protective </strong>factor<strong>&nbsp;</strong>in<strong>&nbsp;ulcerative colitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the instrument commonly used in obstetrics?",
    "choices": [
      {
        "id": 1,
        "text": "Mayo scissors"
      },
      {
        "id": 2,
        "text": "Curved scissors"
      },
      {
        "id": 3,
        "text": "Suture remover"
      },
      {
        "id": 4,
        "text": "Episiotomy scissors"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Episiotomy scissor</strong></p>\n<p>The angulation in the scissor is to prevent extension of pelvic tear into the anal margins and obstetretic anal sphincter injuries / complete perineal tear.</p>\n<p><strong>Structures cut</strong> in episiotomy:</p>\n<ul>\n<li>Vaginal mucosa</li>\n<li>Superficial and deep transverse perineal muscles, bulbospongiosus, levator ani muscles.</li>\n<li>Internal pudendal blood vessels</li>\n<li>Subcutaneous tissue and perineal skin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a402a8bc6f974f8e85ac9420690c1e9a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/015134ab07b14d9eb884ed9294cdbe51x1200x916.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/abe30855adf844ca8d7ff8e9ee16f4e1x1280x753.JPEG"
    ]
  },
  {
    "text": "A 24-year-old pregnant woman has completed her 1st antenatal visit under the maternal and child health program (MCH). Now she is 14 weeks pregnant. How many more antenatal visits does she need to complete to fulfill the minimum requirement for antenatal visits under the MCH?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario, the lady should complete 3 more visits to fulfill the minimum requirement of antenatal visits under MCH.</p>\n<p>The <strong>minimum number</strong> of<strong> antenatal visits</strong> according to <strong>MCH</strong> is <strong>4</strong>.</p>\n<ul>\n<li><strong>1st visit&nbsp;</strong>&ndash; within 12 weeks, preferably as soon as the pregnancy is suspected.</li>\n<li><strong>2nd visit&nbsp;</strong>&ndash; between 14 and 26 weeks</li>\n<li><strong>3rd visit&nbsp;</strong>&ndash; between 28 and 34 weeks</li>\n<li><strong>4th visit&nbsp;</strong>&ndash; between 36 weeks and term</li>\n</ul>\n<p>It is advised that the woman should visit the medical officer at the PHC for an antenatal check-up during 3rd visit.</p>\n<p>The minimum number of antenatal visits according to the WHO (not MCH), is 8.</p>\n<p>The <strong>ideal number</strong> of <strong>antenatal</strong> <strong>visits</strong> a mother should take to the antenatal clinic is:</p>\n<ul>\n<li><strong>Once a month</strong> during the<strong> first 7 months</strong></li>\n<li><strong>Twice a month</strong> during the <strong>next&nbsp;month </strong></li>\n<li><strong>Once a week</strong>, thereafter if everything is normal.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes to the OPD with a history significant of a mood disorder. Her moods can be charted as shown in the image. What will be the best drug for her?",
    "choices": [
      {
        "id": 1,
        "text": "Lamotrigine"
      },
      {
        "id": 2,
        "text": "Lithium"
      },
      {
        "id": 3,
        "text": "Carbamazepine"
      },
      {
        "id": 4,
        "text": "Escitalopram"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient is suffering from <strong>rapid cycling bipolar disorder. Lithium </strong>is used to treat this condition.</p>\n<p>Diagnosis of rapid cycling bipolar disorder:</p>\n<ul>\n<li><strong>4 or more</strong> mood disturbances in a year</li>\n<li>Episodes either have a partial or full <strong>remission</strong> for atleast 2 months <strong>or switch</strong> to the opposite <strong>polarity</strong></li>\n</ul>\n<p><strong>Lithium</strong>&nbsp;is a mood stabilizer with a very narrow therapeutic index and is the first line of management in bipolar disorder.<strong>&nbsp;</strong>It&nbsp;<strong>decreases&nbsp;</strong>the rate of&nbsp;<strong>suicide</strong>&nbsp;and is also used in&nbsp;depression with inadequate response to monotherapy&nbsp;and cases of recurrent depression.</p>\n<p>Lithium has a very narrow therapeutic index of&nbsp;<strong>0.8-1.2 mEq/L.</strong>&nbsp;The severity of lithium toxicity is often divided into the following three grades:&nbsp;</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Grade</strong></td>\n<td>\n<p><strong>Sr. lithium concentration&nbsp;</strong>(in mEq/L)</p>\n</td>\n<td><strong>Symptoms</strong></td>\n</tr>\n<tr>\n<td><strong>Mild symptoms</strong></td>\n<td><strong>1.5-2.5&nbsp;</strong></td>\n<td>nausea, vomiting, tremor, and fatigue</td>\n</tr>\n<tr>\n<td><strong>Moderate intoxication</strong></td>\n<td><strong>2.5-3.5&nbsp;</strong></td>\n<td>confusion, agitation, delirium, tachycardia, and hypertonia</td>\n</tr>\n<tr>\n<td><strong>Severe intoxication</strong></td>\n<td><strong>&gt;3.5&nbsp;</strong></td>\n<td>coma, seizures, hyperthermia, and hypotension</td>\n</tr>\n</tbody>\n</table>\n<p>Treatment options include&nbsp;<strong>gastric lavage and w</strong><strong>hole bowel irrigation</strong>&nbsp;for patients presenting early to the emergency department.&nbsp;<strong>Hemodialysis</strong>&nbsp;is done<strong>&nbsp;</strong>for patients demonstrating any signs and symptoms of severe lithium poisoning.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d7eb1c5907c2438aaecf4a5c2f537e81.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You receive a dental report from an autopsy of a homicide case, stating that FDI notation tooth number '43' is missing. Which tooth is missing in the victim?",
    "choices": [
      {
        "id": 1,
        "text": "Lower right canine"
      },
      {
        "id": 2,
        "text": "Lower left canine"
      },
      {
        "id": 3,
        "text": "Upper right first molar"
      },
      {
        "id": 4,
        "text": "Upper left first molar"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In FDI notation 43, the number <strong>4 </strong>indicates the<strong> lower right quadrant</strong> and the number <strong>3 </strong>indicates<strong> canine tooth</strong>. Hence 43 indicates the <strong>lower right canine.</strong></p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\"><strong>FDI </strong>(Federation Dentaire Internationale) represents a number is assigned to each quadrant and that number is placed before tooth's number.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b8db47583b144792b706e2b075451da6x627x431.JPEG"
    ]
  },
  {
    "text": "Investigation of choice for acute pancreatitis is_______",
    "choices": [
      {
        "id": 1,
        "text": "Plain X-ray abdomen"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "USG"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Contrast-enhanced CT scan</strong> is the <strong>investigation of choice</strong>.</li>\n<li>The <strong>optimal time</strong> for performing CECT is <strong>more\u00a0than 72 h after the onset of symptoms\u00a0</strong>(In the first 72 hours, CT may underestimate the extent of necrosis).</li>\n</ul>\n<p>Acute pancreatitis is a condition characterized by inflammatory damage to the pancreas. Various causes of acute pancreatitis are:</p>\n<ul>\n<li aria-level=\"1\"><strong>Gall stone induced</strong>\u00a0(most common cause)</li>\n<li aria-level=\"1\"><strong>Alcohol</strong>\u00a0(2nd most common cause)</li>\n<li aria-level=\"1\"><strong>Trauma</strong>\u00a0(most common cause in children)</li>\n<li aria-level=\"1\">Iatrogenic- Post endoscopic retrograde cholangiopancreatography\u00a0(ERCP)</li>\n<li aria-level=\"1\">Drug-induced pancreatitis (Thiazides, Azathioprine, Anti-cancer drugs, etc)</li>\n<li aria-level=\"1\">Hypertriglyceridemia</li>\n<li aria-level=\"1\">Hypercalcemia</li>\n<li aria-level=\"1\">Scorpion bite</li>\n<li aria-level=\"1\">Idiopathic</li>\n</ul>\n<p>Clinical presentation of acute pancreatitis is characterized by\u00a0<strong>epigastric pain radiating</strong>\u00a0to the\u00a0<strong>back</strong>\u00a0which is<strong>\u00a0relieved by bending forward</strong>, nausea, and vomiting. Acute hemorrhagic pancreatitis can present with certain named signs like:</p>\n<ul>\n<li aria-level=\"1\"><strong>Cullen\u2019s sign</strong>: Discoloration around the umbilicus</li>\n<li aria-level=\"1\"><strong>Grey Turner\u2019s sign</strong>: Discoloration in the flanks</li>\n<li aria-level=\"1\"><strong>Fox sign</strong>: Discoloration in the inguinal region</li>\n<li aria-level=\"1\"><strong>Bryant\u2019s sign</strong>: Discoloration on the scrotum</li>\n</ul>\n<p>Blood investigations show\u00a0<strong>increased serum amylase\u00a0</strong>and<strong>\u00a0lipase levels</strong>. Serum lipase is more sensitive and specific than serum amylase but it rises late. Contrast-enhanced computed tomography (<strong>CECT</strong>) is the investigation of choice. Various scoring systems are used to grade the severity of acute pancreatitis based on blood investigations and radiographic findings.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 14';
        const quizFilename = 'fmge-mini-test-14-e588a719.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>