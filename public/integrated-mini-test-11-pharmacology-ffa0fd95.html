<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 11 - Pharmacology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A woman with persistent asthma, comes to establish antenatal care after positive pregnancy test. For adequate control, her regimen was increased to daily medium dose ICS and as-needed salbutamol last month. What should she be advised regarding asthma management during pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Discontinue ICS, restart in 2nd trimester"
      },
      {
        "id": 2,
        "text": "Discontinue ICS, restart after delivery"
      },
      {
        "id": 3,
        "text": "Decrease dose to low dose ICS"
      },
      {
        "id": 4,
        "text": "Continue same treatment"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Drugs such as <strong>inhaled corticosteroids (ICS)</strong> and <strong>short acting beta-2 adrenergic agonists</strong> (<strong>SABAs</strong>) are <strong>safe to use</strong> in <strong>pregnancy</strong> and can be <strong>continued</strong> without any modification.</p>\n<p><strong>Poor asthma control</strong> may have <strong>adverse effects on fetal development</strong>. <strong>SABAs</strong>, <strong>ICS</strong> and <strong>theophylline</strong> have been shown to be <strong>safe</strong>, and are <strong>not</strong> <strong>teratogenic</strong>. Although, safety information concerning newer classes of drugs (LABAs, antileukotriene inhibitors and anti-IgE antibodies) are lacking they are recommended for use. There is also <strong>no contraindication during breastfeeding</strong>.</p>\n<p><strong>Early asthma stages</strong> are <strong>well tolerated</strong> by <strong>healthy non-pregnant</strong> women but may be <strong>dangerous for pregnant</strong> <strong>women</strong> and the <strong>fetus</strong>, as the <strong>diminished functional residual capacity</strong> and <strong>greater pulmonary shunting</strong> makes the mother susceptible to hypoxia and hypoxemia.\u00a0</p>\n<p>If the patient has <strong>daytime symptoms</strong> up to <strong>2 times per week</strong>, and <strong>nighttime awakenings</strong>\u00a0up to <strong>2 times per month</strong> it is called <strong>intermittent asthma</strong>. If the symptoms are <strong>more severe</strong>, then the patient has <strong>persistent asthma</strong>. Persistent asthma is further classified based on symptom severity:</p>\n<table style=\"border-collapse: collapse; width: 42.0145%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 24.9773%; text-align: center;\"><strong>Category</strong></td>\n<td style=\"width: 24.9773%; text-align: center;\"><strong>Daytime symptoms</strong></td>\n<td style=\"width: 24.9773%; text-align: center;\"><strong>Nighttime awakening</strong></td>\n<td style=\"width: 24.9773%; text-align: center;\"><strong>Treatment</strong></td>\n</tr>\n<tr>\n<td style=\"width: 24.9773%; text-align: center;\">\u00a0 \u00a0 Mild persistent</td>\n<td style=\"width: 24.9773%; text-align: center;\">\u00a0 \u00a0 More than 2 times per week but less than daily</td>\n<td style=\"width: 24.9773%; text-align: center;\">3-4 times a month but not every week</td>\n<td style=\"width: 24.9773%; text-align: center;\">Low dose ICS + formoterol as needed</td>\n</tr>\n<tr>\n<td style=\"width: 24.9773%; text-align: center;\">Moderate persistent</td>\n<td style=\"width: 24.9773%; text-align: center;\">Daily</td>\n<td style=\"width: 24.9773%; text-align: center;\">Once per week</td>\n<td style=\"width: 24.9773%; text-align: center;\">Low dose ICS + formoterol daily</td>\n</tr>\n<tr>\n<td style=\"width: 24.9773%; text-align: center;\">Severe persistent</td>\n<td style=\"width: 24.9773%; text-align: center;\">Present throughout the day along with severe restriction of daily activities</td>\n<td style=\"width: 24.9773%; text-align: center;\">Almost every night</td>\n<td style=\"width: 24.9773%; text-align: center;\">Medium to high dose ICS + formoterol/LABA daily + add-on drugs</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Inhaled corticosteroid</strong> is the <strong>first line of treatment</strong> in patients with <strong>persistent asthma</strong>. As per Global Initiative for Asthma (<strong>GINA) guidelines</strong>, <strong>formoterol + low-dose ICS</strong> is the <strong>preferred reliever</strong> in <strong>all cases of asthma</strong>. <strong>SABAs</strong> are <strong>alternative relievers</strong> to manage all cases of asthma.</p>\n<p>Other options:</p>\n<p>Option C: The dosage of ICS should be <strong>decreased</strong> if <strong>symptoms</strong> are <strong>controlled after 3 months</strong>. This patient\u2019s dosage was recently increased 1 month ago.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was treated with an intravenous antimalarial drug following which he developed tinnitus, headache, nausea, and visual disturbances. Examination revealed hypotension and lab reports revealed hypoglycemia. Which of the following drugs is most likely to cause these adverse effects?",
    "choices": [
      {
        "id": 1,
        "text": "Artemether"
      },
      {
        "id": 2,
        "text": "Artesunate"
      },
      {
        "id": 3,
        "text": "Quinine"
      },
      {
        "id": 4,
        "text": "Atovaquone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The above clinical scenario is suggestive of the adverse effects of <strong>quinine</strong>. It is an <strong>antimalarial</strong> used to treat severe malaria.</p>\n<p class=\"p1\">Quinine is used in the treatment of drug-resistant and severe <em>P. falciparum</em> malaria. It acts against asexual erythrocytic forms of malarial parasites.\u00a0</p>\n<p class=\"p1\">Quinine is most commonly associated with a <strong>triad</strong> of adverse effects which includes:</p>\n<ul>\n<li class=\"p1\"><strong>Cinchonism </strong>- headache, tinnitus, high-tone deafness, visual disturbances, vomiting, and postural hypotension.</li>\n<li class=\"p1\"><strong>Hypoglycemia </strong>- results due to hyperinsulinemia secondary to stimulation of pancreatic beta cells by quinine.</li>\n<li class=\"p1\"><strong>Hypotension.</strong></li>\n</ul>\n<p>Other adverse effects of quinine include gastrointestinal disturbance, skin manifestations (sweating, flushing, rash, and angioedema), QTc prolongation, and <strong>bla</strong><strong>ckwater fever.</strong></p>\n<p>Blackwater fever is a <strong>hypersensitivity reaction</strong>\u00a0associated with the use of\u00a0quinine. It presents with a triad of <strong>severe hemolysis, hemoglobinemia, </strong>and <strong>hemoglobinuria.</strong></p>\n<p>Other options:</p>\n<p class=\"p1\">Options A and B: <strong>Artemether</strong> and <strong>artesunate</strong> cause gastrointestinal disturbances, itching, drug fever, and hypersensitivity reactions. Minor adverse effects include headache, dizziness, and dark urine.</p>\n<p class=\"p1\">Option D: <strong>Atovaquone</strong> can cause gastrointestinal side effects like abdominal pain, vomiting, and diarrhea. It can also cause transient elevation of serum amylase or transaminase.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old girl was brought with complaints of vomiting and altered consciousness. She was recently diagnosed with an influenza infection and was started on an antipyretic for fever. Laboratory tests showed increased levels of liver enzymes but normal serum bilirubin levels. What could have been the prescribed antipyretic in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Mefenamic acid"
      },
      {
        "id": 2,
        "text": "Aspirin"
      },
      {
        "id": 3,
        "text": "Ibuprofen"
      },
      {
        "id": 4,
        "text": "Acetaminophen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The clinical history suggests an<strong> adverse reaction</strong> to the given antipyretic medication and describes <strong>Reye's syndrome</strong>. Reye's syndrome can be precipitated in children with <strong>viral infection</strong> and concomitant use of <strong>salicylates</strong> like <strong>aspirin</strong>.</p>\n<p class=\"p1\">Reye syndrome is an <strong>acute encephalopathy</strong> that may follow a viral upper respiratory tract infection (influenza or varicella). It is precipitated in a genetically susceptible person by the interaction between viral infection and exposure to&nbsp;<strong>salicylates</strong> and/or antiemetics.</p>\n<p class=\"p1\">Clinically children present with acute onset <strong>vomiting</strong> and features of <strong>encephalopathy</strong> like delirium, altered consciousness, confusion, and lethargy.</p>\n<p class=\"p1\"><strong>Liver dysfunction</strong> is present in all cases and presents with coagulopathy and laboratory evidence of elevated serum levels of aspartate aminotransferase, alanine aminotransferase, and ammonia. But, <strong>bilirubin</strong> levels remain <strong>normal</strong> and the patient does not develop jaundice.</p>\n<p class=\"p1\">A <strong>biopsy</strong> of the liver in a patient with Reye's syndrome shows <strong>microvesicular infiltration</strong> of <strong>fat</strong> in the <strong>hepatocytes.&nbsp;</strong>Reye syndrome is a life-threatening adverse effect, and patients must also be screened for fatty acid oxidation and fatty acid transport defects.</p>\n<p>Another salicylate medication that risks the development of Reye's syndrome is&nbsp;<strong>bismuth subsalicylate</strong>.</p>\n<p>Other options:</p>\n<p><strong>Mefenamic acid</strong>, <strong>ibuprofen</strong>, and <strong>acetaminophen </strong>are non-steroidal anti-inflammatory drugs that can be used as antipyretics in children and are not associated with the development of Reye's syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are posted as an intern in the medicine ward where your consultant asks you to make a list of all the patients who require strict therapeutic drug monitoring. All the following patients will be included in your list, except ______.",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 3"
      },
      {
        "id": 2,
        "text": "2, 4 and 5"
      },
      {
        "id": 3,
        "text": "4 and 5"
      },
      {
        "id": 4,
        "text": "5 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option B is correct. Thiazide, levodopa, and metformin do not require therapeutic drug monitoring. However, phenytoin and lithium will require strict&nbsp;therapeutic drug monitoring because of their narrow therapeutic window.</p>\n<p><strong>Therapeutic drug monitoring (TDM)</strong> is individualizing drug dosage by maintaining plasma or blood drug concentrations within a targeted therapeutic range or window.</p>\n<p>Indications for TDM:</p>\n<ol>\n<li>Drugs with low safety margins i.e. narrow therapeutic window (e.g. digoxin, <strong>anticonvulsants</strong>, antiarrhythmics, theophylline, aminoglycosides, lithium, TCAs, immunomodulators)</li>\n<li>Drugs with high individual variations (e.g. <strong>lithium</strong>, antidepressants)</li>\n<li>Drugs with potential toxicity used in renal failure patients (e.g. aminoglycosides, vancomycin)</li>\n<li>Poisoning</li>\n<li>Drug therapy failure (e.g. failure of response to antibiotics)</li>\n<li>To check patient compliance (e.g. psycho-pharmacological agents)</li>\n</ol>\n<p>TDM is<strong> not necessary</strong> for</p>\n<ol>\n<li>Drugs whose response is easily measured (eg. <strong>antihypertensives</strong>, <strong>anti-diabetic agents</strong>, oral anticoagulants, inhalational general anesthesia)</li>\n<li>Prodrugs (e.g.<strong> levodopa</strong>)</li>\n<li>Drugs that have long-lasting effects -Hit and run drugs e.g. reserpine, guanethidine, monoamine oxidase inhibitors, omeprazole)</li>\n<li>Irreversible action of drugs (eg. organophosphates, phenoxybenzamine)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is prescribed dextromethorphan for cough. Which of the following is mechanism by which it exerts its actions and its adverse effects?",
    "choices": [
      {
        "id": 1,
        "text": "Medullary opioid receptor agonist, Hallucinations"
      },
      {
        "id": 2,
        "text": "Central NMDA receptor antagonism, Constipation"
      },
      {
        "id": 3,
        "text": "Medullary opioid receptor agonist, Constipation"
      },
      {
        "id": 4,
        "text": "Central NMDA receptor antagonism, Hallucinations"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Dextromethorphan\u00a0</strong>is a<strong> centrally-acting NMDA\u00a0receptor antagonist </strong>that is used as an antitussive. One of its major side effects is <strong>hallucinations</strong> at high doses.</p>\n<p>Antitussives are a group of drugs that acts centrally to raise the threshold of the cough center or peripherally on the respiratory tract to reduce the tussal impulse or both.</p>\n<p>The antitussive action of dextromethorphan is due to the <em>d</em>-isomer form. It is used in children above the age of 6 and in adults for cough suppression. It also <strong>antagonizes</strong> opioid receptors. (Option A and C)</p>\n<p>Hallucinations at higher doses as well as abuse potential are its side effects. It has very little associated <strong>constipation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman gave birth to a child with the features shown in the given image. On examination, the child had brittle bones, and x-ray scans revealed stippled epiphyses. Which of the following drugs is most likely to be implicated in causing this teratogenic condition?",
    "choices": [
      {
        "id": 1,
        "text": "Alcohol"
      },
      {
        "id": 2,
        "text": "Topiramate"
      },
      {
        "id": 3,
        "text": "Warfarin"
      },
      {
        "id": 4,
        "text": "Lithium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The given image shows a depressed nasal bridge (saddle nose). This image along with the stippling of bone epiphyses points to <strong>fetal warfarin syndrome </strong>or<strong> warfarin embryopathy</strong>.\u00a0</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Features:</span></strong></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Repeated abortions</span></li>\n<li><span data-preserver-spaces=\"true\">CNS abnormalities</span></li>\n<li><span data-preserver-spaces=\"true\">Depressed nasal bridge/absent nasal bone/saddle nose at birth</span></li>\n<li><span data-preserver-spaces=\"true\">Bleeding diathesis at birth</span></li>\n<li><span data-preserver-spaces=\"true\">Growth retardation - hypoplasia of nose, eye sockets, and long bones with stippling of epiphyses\u00a0</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\"><strong>Anticoagulation in pregnancy:</strong></span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Warfarin: Although safe for the mother, it can lead to\u00a0</span><strong><span data-preserver-spaces=\"true\">warfarin embryopathy</span></strong><span data-preserver-spaces=\"true\">, miscarriage, IUGR, and stillbirths.</span></li>\n<li><span data-preserver-spaces=\"true\">Heparin: It is safe for the fetus</span><span data-preserver-spaces=\"true\">\u00a0but is less effective than warfarin.</span></li>\n<li><span data-preserver-spaces=\"true\">LMWH: It is inadequate, and ACOG does not recommend its use in pregnant women with prosthetic heart valves.</span></li>\n</ul>\n<table class=\"t1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\"><strong>Period of gestation</strong></p>\n</td>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\"><strong>Anticoagulant</strong></p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">Till 12 completed weeks</p>\n</td>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">LMWH or UFH</p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">13 to 36 weeks</p>\n</td>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">Warfarin</p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">36 weeks to 6 hours before delivery</p>\n</td>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">LMWH or UFH</p>\n</td>\n</tr>\n<tr>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">6 hours after vaginal and 24 hours after cesarian section</p>\n</td>\n<td class=\"td1\" valign=\"top\">\n<p class=\"p1\">LMWH or UFH (ACOG recommendation)</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><span data-preserver-spaces=\"true\">If delivery occurs while the anticoagulant is still effective, and excessive bleeding happens, then <strong>protamine sulfate</strong> is given intravenously.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Anticoagulation of pregnant women:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">The patient taking warfarin should discontinue it as soon as pregnancy is diagnosed and replace it with\u00a0</span><strong><span data-preserver-spaces=\"true\">heparin 5,000 units twice daily subcutaneously up to the 12th week of gestation</span></strong><span data-preserver-spaces=\"true\">.\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Heparin is then replaced by\u00a0</span><strong><span data-preserver-spaces=\"true\">a warfarin tablet of 3 mg daily</span></strong><span data-preserver-spaces=\"true\">\u00a0to be taken at the same time each day and continued\u00a0</span><strong><span data-preserver-spaces=\"true\">up to 36 weeks </span></strong>in patients with a high risk of thrombosis.</li>\n<li><span data-preserver-spaces=\"true\">Thereafter, warfarin is replaced by\u00a0</span><strong><span data-preserver-spaces=\"true\">heparin, which is discontinued 6 hours</span></strong><span data-preserver-spaces=\"true\">\u00a0just before delivery.</span></li>\n<li><span data-preserver-spaces=\"true\">Heparin (unfractionated or LMWH) is restarted 6 hours after vaginal delivery and 24 hours after the cesarean section.</span></li>\n<li><span data-preserver-spaces=\"true\">Unfractionated heparin (UFH), LMWH, and warfarin therapy are\u00a0</span><strong><span data-preserver-spaces=\"true\">not contraindicated</span></strong><span data-preserver-spaces=\"true\">\u00a0in breastfeeding.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/21168bb11bea4a9e9e9a38278b618a9f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d669e35bc1e4139bd255e4387c48c61x1280x1476.JPEG"
    ]
  },
  {
    "text": "A patient with rheumatoid arthritis is started on tofacitinib. What is the mechanism of action for this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Interleukin receptor antagonist"
      },
      {
        "id": 2,
        "text": "VEGF inhibitor"
      },
      {
        "id": 3,
        "text": "Anti-CD20 antibody"
      },
      {
        "id": 4,
        "text": "Janus kinase inhibitor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Tofacitinib</strong>&nbsp;is a novel,&nbsp;<strong>oral</strong>&nbsp;<strong>JAK 1/3 - Inhibitor</strong>&nbsp;which will inhibit the&nbsp;<strong>JAK-STAT pathway</strong>&nbsp;responsible for the production of cytokines and chemokines. It has been approved for the treatment of&nbsp;<strong>psoriatic arthritis</strong>, and is also used in <strong>rheumatoid arthritis</strong> and <strong>ulcerative colitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old male patient presented with complaints of a runny nose and multiple bouts of sneezing. He has had such symptoms on and off since childhood and his symptoms worsen in the spring and when he goes out of the house. He is given a drug that has the action of leukotriene receptor antagonism for his condition. Which among the following drugs is the drug given to the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ketotifen"
      },
      {
        "id": 2,
        "text": "Cromolyn sodium"
      },
      {
        "id": 3,
        "text": "Zafirlukast"
      },
      {
        "id": 4,
        "text": "Zileuton"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Zafirlukast </strong>and<strong> montelukast </strong>are <strong>leukotriene receptor antagonists</strong>.&nbsp;</p>\n<p>The leukotrienes are proinflammatory mediators produced from arachidonic acid via the 5-lipoxygenase (5-LO) pathway.&nbsp;These drugs are <strong>competitive antagonists of the cys LT1 receptor</strong> and hence decrease bronchoconstriction, airway mucus secretion, increased vascular permeability, and recruitment of eosinophil.</p>\n<p>This patient with symptoms of runny nose&nbsp;and multiple bouts of sneezing along with worsening of his symptoms in spring and outside environment strongly suggests <strong>allergic rhinitis </strong>as the diagnosis.</p>\n<p>Uses:&nbsp;</p>\n<p><strong>Montelukast and Zafirlukast</strong>&nbsp;are&nbsp;indicated for the treatment of&nbsp;<strong>allergic rhinitis.&nbsp;</strong>Antileukotrienes are useful in preventing <strong>exercise-induced asthma</strong>. They act mainly by inhibiting bronchoconstriction.</p>\n<p>In some patients, anti leukotriene agents are effective as monotherapy in the treatment of mild to moderate persistent asthma, although the mean efficacy of anti leukotriene agents is<strong> lower than that of inhaled glucocorticoids</strong> (IGCs). Thus, IGCs are preferred first-line controller agents, and anti leukotriene agents are considered <strong>alternatives</strong>, particularly in patients who have difficulty with adherence or inhaler technique.</p>\n<p>Adverse effects:</p>\n<ul>\n<li><strong>Zileuton, montelukast,&nbsp;</strong>and<strong>&nbsp;zafirlukast&nbsp;</strong>are all<strong>&nbsp;</strong>associated with&nbsp;<strong>rare</strong> cases of<strong>&nbsp;hepatic dysfunction. </strong>Hence, liver function tests should be monitored during the course of their therapy.</li>\n<li><strong>Churg-Strauss syndrome&nbsp;</strong>consisting of vasculitis with eosinophilia is associated with the use of&nbsp;<strong>montelukast and zafirlukast.&nbsp;</strong></li>\n</ul>\n<p>Other options:</p>\n<p>Option A- <strong>Ketotifen</strong>&nbsp;is a&nbsp;<strong>mast cell stabilizer</strong>&nbsp;used for the management of bronchial asthma and allergic disorders such as atopic dermatitis, allergic rhinitis/conjunctivitis, and chronic urticaria. Oral&nbsp;ketotifen&nbsp;possesses both anti-mediator and&nbsp;mast cell-stabilizing&nbsp;properties.</p>\n<p>Option B-<strong> Cromolyn sodium</strong>&nbsp;is a <strong>mast cell stabilizer</strong>.&nbsp;It&nbsp;inhibits the release of mediators of inflammation, including histamine and leukotrienes, from the mast cells that are induced by reactive antigens that result in allergic symptoms and bronchoconstriction.</p>\n<p>Option D- <strong>Zileuton</strong> is a <strong>5-lipoxygenase inhibitor</strong>&nbsp;and helps to reduce inflammation, edema, mucus secretion, and bronchoconstriction in the airways.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient develops a postoperative wound discharge. The culture of the discharge reveals infection with methicillin-resistant Staphylococcus aureus (MRSA). Which of the following cephalosporins can be used in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ceftizoxime"
      },
      {
        "id": 2,
        "text": "Cefpirome"
      },
      {
        "id": 3,
        "text": "Ceftolozane"
      },
      {
        "id": 4,
        "text": "Ceftaroline"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ceftaroline</strong>, which is&nbsp;considered as <strong>anti-MRSA cephalosporin</strong>, is indicated for MRSA infections and can, therefore, be used in this patient. It is grouped as <strong>fifth-generation cephalosporins&nbsp;</strong>along with ceftobiprole.</p>\n<p>Ceftaroline has gram-negative and also enhanced gram-positive coverage. It is effective against&nbsp;<strong>MRSA</strong> and<strong> penicillin-resistant<em> Streptococcus pneumoniae</em>.</strong></p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Ceftizoxime</strong> is a third-generation cephalosporin that is less active against <em>S. pneumoniae</em> and more active against <em>Bacteroides fragilis</em>. It has no action on MRSA.</p>\n<p>Option B: <strong>Cefpirome</strong> is a fourth-generation cephalosporin that has <strong>antipseudomonal</strong> activity and activity against&nbsp;many organisms, such as<em> Enterobacter</em> and <em>Pseudomonas</em>, that are resistant to other cephalosporins, with no significant action on MRSA.</p>\n<p>Option C: <strong>Ceftolozane</strong> is an <strong>anti-pseudomonal</strong> cephalosporin that is a structural analog of ceftazidime. It has enhanced activity against <em>Pseudomonas</em>, including activity against strains resistant to ceftazidime through &beta;-lactamase overexpression, with no action on MRSA.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has been taking ramipril to control his hypertension for the past 10 years. On a recent follow-up visit, the doctor advised the addition of one more antihypertensive drug to his regimen. Which of the following drugs cannot be prescribed to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 5"
      },
      {
        "id": 2,
        "text": "1, 3, 4"
      },
      {
        "id": 3,
        "text": "2, 4"
      },
      {
        "id": 4,
        "text": "3, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Spironolactone, triamterene,</strong> and <strong>amiloride</strong> (1, 3, and 4) should not be prescribed to patients taking ramipril. Ramipril is an <strong>ACE inhibitor, </strong>and if it is taken along with <strong>potassium-sparing diuretics,</strong>\u00a0it may lead to <strong>hyperkalemia.\u00a0</strong></p>\n<p>K<sup>+</sup>\u00a0sparing diuretics work by 2 mechanisms:</p>\n<ul>\n<li><strong>Blocking</strong>\u00a0the\u00a0<strong>ENaC</strong>\u00a0(epithelial sodium channel) in the late distal tubules.\n<ul>\n<li>Triamterene</li>\n<li>Amiloride</li>\n</ul>\n</li>\n<li><strong>Aldosterone</strong>\u00a0receptor\u00a0<strong>antagonist</strong>\n<ul>\n<li>Spironolactone</li>\n<li>Eplerenone</li>\n<li>Canrenone</li>\n</ul>\n</li>\n</ul>\n<p>Thiazides and loop diuretics may lead to loss of potassium and cause hypokalemia. Metolazone and chlorthalidone are thiazides and\u00a0can be given along with ACE inhibitors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old female who was on a antihypertensive now came with complaints of swelling and redness of her great toe. Lab investigations show hyperuricemia along with hypokalemia and hypocalcemia. What could be the drug leading to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Furosemide"
      },
      {
        "id": 2,
        "text": "Hydrochlorothiazide"
      },
      {
        "id": 3,
        "text": "Losartan"
      },
      {
        "id": 4,
        "text": "Spironolactone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario along with lab findings of hypokalemia and hypocalcemia is suggestive of gout secondary to the use of <strong>furosemide.</strong></p>\n<p>Furosemide is a <strong>loop diuretic</strong>. It acts by <strong>inhibiting</strong> the <strong>Na+-K+-2Cl- symporter</strong> in the thick ascending limb of the loop of Henle, resulting in increased excretion of sodium, potassium, and chloride. <strong>Hypokalemia</strong>, <strong>hypocalcemia, hyperuricemia,</strong>\u00a0and <strong>hypomagnesemia</strong> are the important side effects.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>Hydrochlorothiazide </strong>is a thiazide diuretic that acts by inhibiting the <strong>Na-Cl symporter</strong> in the distal convoluted tubule resulting in increased excretion of sodium and chloride. Hydrochlorothiazide results in<strong>\u00a0hypokalemia</strong> and <strong>hypercalcemia</strong>, whereas this patient presents with hypocalcemia. Other findings include hyperuricemia and hypomagnesemia.</p>\n<p>Option C: \u00a0<strong>Losartan</strong> is the <strong>angiotensin receptor blocker</strong> used for the treatment of <strong>hypertension</strong>. <strong>Hyperkalemia</strong> is an important side effect of ARBs. Losartan appears to be a safe and efficacious agent to lower serum uric acid levels in patients with hyperuricemia.</p>\n<p>Option D: <strong>Spironolactone</strong> belongs to <strong>potassium-sparing</strong> diuretics and causes <strong>hyperkalemia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A schizophrenia patient is being delivered olanzapine by a Z-track technique. From the given images, identify the route of injection in which the Z-track technique is used.",
    "choices": [
      {
        "id": 1,
        "text": "Route B"
      },
      {
        "id": 2,
        "text": "Route A"
      },
      {
        "id": 3,
        "text": "Route D"
      },
      {
        "id": 4,
        "text": "Route C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\"><strong>Route A</strong> shows the\u00a0<strong>intramuscular administration</strong> of medication and the <strong>Z track technique</strong> is used for this route of administration.</span></p>\n<p><strong>Procedure:</strong></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Stretch the skin by pulling it laterally away from the intended point of injection.</span></li>\n<li><span data-preserver-spaces=\"true\">Insert the needle into the site at a 90\u02daangle, aspirate by pulling back to see if the needle has a penetrated vessel.</span></li>\n<li><span data-preserver-spaces=\"true\">If blood is aspirated withdraw the needle, and repeat the procedure at another site with new equipment and medication.</span></li>\n<li><span data-preserver-spaces=\"true\">If no blood is aspirated administer the injection.</span></li>\n<li><span data-preserver-spaces=\"true\">Wait for 10 seconds and then withdraw the needle, and release the skin allowing the displaced tissue to seal the needle track.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b9c0210b853b492794974b7109fe0fb3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67f7d066aced4ce7a8eb15da3b994253x1280x2849.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1b69028eb3fe4acc971ebb37e4cf0d4bx1280x4914.JPEG"
    ]
  },
  {
    "text": "A 50-year-old patient with hypertension, diabetes, and ischemic heart disease undergoes percutaneous coronary intervention with the placement of a drug-eluting stent in order to reduce restenosis. Which of the following is involved in the further care of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Direct oral anticoagulants for 6 months"
      },
      {
        "id": 2,
        "text": "Daily aspirin for 6 months then daily clopidogrel for 6 months"
      },
      {
        "id": 3,
        "text": "Daily aspirin indefinitely and clopidogrel for at least 1 year"
      },
      {
        "id": 4,
        "text": "Daily aspirin for 1 year and clopidogrel for 6 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Clopidogrel</strong>, a P2Y12 receptor blocker, along with <strong>aspirin</strong> is called <strong>dual antiplatelet therapy</strong> (DAPT). <strong>DAPT</strong> should be continued for at least <strong>1 year</strong> following stent placement to prevent stent thrombosis, with&nbsp;<strong>aspirin</strong> being continued <strong>indefinitely</strong>.&nbsp;</p>\n<p>Drug-eluting stents (DES) are coronary stents that locally release antiproliferative agents that can reduce restenosis. However, the <strong>delayed endothelial healing</strong> in the region of the stent can increase the acute risk of thrombosis during the period after placement. This increased risk calls for the use of dual antiplatelet therapy for at least a year. The commonly used antiproliferative drugs in DES are&nbsp;everolimus, tacrolimus, sirolimus, paclitaxel, etc.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female patient on oral contraceptive pills (OCPs) was prescribed phenytoin after she developed seizures. What is the main concern here?",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin is an enzyme inducer and causes failure of OCPs."
      },
      {
        "id": 2,
        "text": "Phenytoin is an enzyme inhibitor and causes failure of OCPs."
      },
      {
        "id": 3,
        "text": "Phenytoin is an enzyme inducer and causes OCP toxicity."
      },
      {
        "id": 4,
        "text": "Phenytoin is an enzyme inhibitor and causes OCP toxicity."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Phenytoin </strong>is&nbsp;an<strong> enzyme inducer </strong>and&nbsp;can cause<strong>&nbsp;</strong>the<strong> failure </strong>of <strong>oral contraceptive pills (OCPs).</strong></p>\n<p>Phenytoin can induce various hepatic CYPs. OCPs are metabolized by CYP3A4. Hence, the administration of phenytoin in a patient who is on OCPs results in enhanced metabolism of OCPs. This may lead to an unplanned pregnancy.</p>\n<table style=\"height: 150px;\" width=\"453\">\n<tbody>\n<tr>\n<td style=\"width: 180.547px; text-align: center;\"><strong>Enzyme inducers</strong></td>\n<td style=\"width: 256.453px; text-align: center;\"><strong>Enzyme inhibitors</strong></td>\n</tr>\n<tr>\n<td style=\"width: 180.547px;\">\n<p>Mnemonic: CRAP GPS</p>\n<ul>\n<li><strong>C</strong>arbamazepine</li>\n<li><strong>R</strong>ifampicin</li>\n<li><strong>A</strong>lcohol (chronic)</li>\n<li><strong>P</strong>henytoin</li>\n<li><strong>G</strong>riseofulvin</li>\n<li><strong>P</strong>henobarbitone</li>\n<li><strong>S</strong>ulfonylureas</li>\n</ul>\n</td>\n<td style=\"width: 256.453px;\">\n<p>Mnemonic:&nbsp;RED VICK</p>\n<ul>\n<li><strong>R</strong>itonavir</li>\n<li><strong>E</strong>rythromycin</li>\n<li><strong>D</strong>iltiazem</li>\n<li><strong>V</strong>erapamil,&nbsp;Valproate</li>\n<li><strong>I</strong>traconazole</li>\n<li><strong>C</strong>larithromycin,&nbsp;Cimetidine</li>\n<li><strong>K</strong>etoconazole</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented to the primary health center with symptoms of sneezing, runny nose, and red, itchy, watery eyes. He was prescribed azelastine after being diagnosed with allergic rhinitis. Select the preferred formulation of the drug in this patient.",
    "choices": [
      {
        "id": 1,
        "text": "Intranasal spray"
      },
      {
        "id": 2,
        "text": "Tablets"
      },
      {
        "id": 3,
        "text": "Transdermal patch"
      },
      {
        "id": 4,
        "text": "Intramuscular injection"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The preferred formulation of azelastine in this patient would be an <strong>intranasal spray</strong>.&nbsp;</p>\n<p>Azelastine is a <strong>second-generation antihistamine</strong> that has good topical activity. It is available as a nasal spray for treating symptoms of allergic or vasomotor rhinitis and is also available as an ophthalmic solution for allergic conjunctivitis.</p>\n<div class=\"page\" title=\"Page 725\">On intranasal application, it <strong>downregulates ICAM-1 expression</strong> on the nasal mucosa.&nbsp;It has a long duration of action and is administered as a <strong>nasal spray</strong> to provide relief in cases of allergic rhinitis, with its effect lasting for up to 12 hours.<br /><br />On local application, it can cause <strong>altered taste perception</strong> and stinging in the nose while oral administration can also result in <strong>weight gain</strong>.&nbsp;The metabolism of azelastine is <strong>inhibited</strong> by <strong>CYP3A4 inhibitors.</strong></div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old female patient, who is a known case of chronic hypertension, delivers a male baby by vaginal delivery. Following the delivery, she starts to bleed profusely. All of the following medications can be used to control hemorrhage in this patient, except:",
    "choices": [
      {
        "id": 1,
        "text": "Oxytocin"
      },
      {
        "id": 2,
        "text": "Methergine"
      },
      {
        "id": 3,
        "text": "Tranexamic acid"
      },
      {
        "id": 4,
        "text": "Misoprostol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario indicates <strong>postpartum hemorrhage</strong> (PPH) in this patient following vaginal delivery. All of the listed medications can be used for management, except methylergonovine. <strong>Methergine </strong>(methylergonovine) is <strong>contraindicated</strong> in a patient with a history of <strong>chronic hypertension</strong>.\u00a0\u00a0</p>\n<p>Ergot alkaloids (ergonovine and methylergonovine) are commonly used <strong>second-line agents</strong> to <strong>treat uterine atony</strong> if atony persists despite oxytocin and other preventive measures. Given oral or parenterally, these drugs act rapidly and cause strong uterine contraction. However, ergot agents may cause dangerous hypertension, which is more likely in women with <strong>preeclampsia</strong> or <strong>chronic hypertension</strong>. Other contraindications include organic heart disease, multifetal pregnancy after delivery of the first twin, and sepsis.\u00a0</p>\n<p><strong>Oxytocin</strong> is used as the <strong>first-line agent</strong> in preventing postpartum hemorrhage. If bleeding and atony are refractory, a second-line agent can be added. These include:</p>\n<ul>\n<li>Ergot alkaloids, namely methylergonovine and ergonovine</li>\n<li><strong>Carboprost tromethamine</strong>, the 15-methyl derivative of prostaglandin F2\u03b1. However, it is <strong>contraindicated</strong> in <strong>asthmatics</strong> and patients with <strong>pulmonary hypertension</strong>. It can also cause systemic hypertension as a side effect and should be used with caution in hypertensive patients.</li>\n<li><strong>Misoprostol</strong>, a synthetic prostaglandin E1 analogue. It is <strong>contraindicated</strong> in patients with previous <strong>cesarean section</strong>.\u00a0</li>\n<li>Inj. <strong>tranexamic acid</strong>, an antifibrinolytic agent</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newborn cannot breastfeed as he vomits and chokes each time he attempts to feed. He also has other anomalies including radial aplasia, vertebral anomalies and anal defects. An NG tube is attempted to be pushed in and an X-ray of the same is seen below. Which of the following drugs is likely to have been taken by the mother during pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Warfarin"
      },
      {
        "id": 2,
        "text": "Statins"
      },
      {
        "id": 3,
        "text": "ACE inhibitors"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The x-ray in the question shows that the <strong>NG tube</strong> cannot pass through to the <strong>stomach.</strong> This along with the other anomalies mentioned makes a diagnosis of <strong>Tracheoesophageal fistula</strong> the likely diagnosis. This child has <strong>VACTERL</strong> deformities. The <strong>drug</strong> group associated with this is the <strong>statin</strong> group of drugs.\u00a0</p>\n<p>VACTERL defect is an acronym for a group of congenital malformations that characteristically include:</p>\n<ul>\n<li><strong>V</strong>ertebral defects</li>\n<li><strong>A</strong>nal atresia</li>\n<li><strong>C</strong>ardiovascular malformation</li>\n<li><strong>T</strong>racheoesophageal fistula with esophageal atresia</li>\n<li><strong>R</strong>adial/<strong>R</strong>enal dysplasia</li>\n<li><strong>L</strong>imb anomalies</li>\n</ul>\n<p>Genito-urinary anomalies (ambiguous genitalia, genitourinary fistula, cryptorchidism) and other system anomalies, such as facial asymmetry and external ear malformation, can also be found in these patients.</p>\n<p><strong>VACTERL defects</strong> have been associated with maternal exposure to <strong>statins</strong>, doxorubicin, and lead. They are also associated with maternal diabetes.</p>\n<p>Other options</p>\n<p>Option A: <strong>Warfarin</strong> is safe and effective in preventing thromboembolism in the mother during the 2nd trimester. However, it is <strong>teratogenic</strong> and can lead to miscarriage, stillbirths, fetal anticoagulation, hypoplastic nasal structures and fetal embryopathy if used in the <strong>1st trimester</strong>.</p>\n<p>Option C: <strong>Hypoplasia</strong> of organs, <strong>anuria</strong>, and irreversible <strong>renal failure</strong> are associated with <strong>ACE inhibitor</strong> intake during pregnancy.</p>\n<p>Option D: The fetus of a pregnant woman who is on <strong>phenytoin</strong> is at the greatest risk of developing fetal hydantoin syndrome.\u00a0Features of <strong>fetal hydantoin syndrome</strong> include:</p>\n<ul>\n<li>Craniofacial anomalies (such as upturned nose, midfacial hypoplasia, and long upper lip with thin vermilion border)</li>\n<li>Fingernail hypoplasia</li>\n<li>Developmental delay</li>\n<li>Orofacial clefts</li>\n<li>Cardiac anomalies</li>\n<li>Growth deficiency</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7c9e6640edf745e8b390e162d44bd39c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents with fever, abdominal pain, and a recent history of diarrhea. He has associated tenderness over the right upper quadrant of the abdomen. Abdominal CT is shown below. Which of the following drugs is indicated for the management of the CT finding?",
    "choices": [
      {
        "id": 1,
        "text": "Metronidazole"
      },
      {
        "id": 2,
        "text": "Iodoquinol"
      },
      {
        "id": 3,
        "text": "Paromomycin"
      },
      {
        "id": 4,
        "text": "Diloxanide furoate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario of a patient presenting with <strong>fever</strong>, <strong>abdominal pain</strong>, a <strong>recent history of diarrhea,</strong> and an <strong>abdominal CT</strong> showing a moderate-sized <strong>abscess in the right liver lobe</strong> is suggestive of an <strong>amebic liver abscess</strong>. It is an <strong>extra-intestinal infection</strong> caused by <strong><em>Entamoeba histolytica</em></strong> and\u00a0<strong>metronidazole</strong> is the <strong>drug of choice</strong> for treating this condition.\u00a0</p>\n<p>Amebic liver abscess <strong>follows intestinal amebiasis</strong>. However, a history of diarrhea may not always be present as most patients remain asymptomatic carriers. In patients presenting with the above symptoms, <strong>stool examination</strong>, <strong>serological tests</strong>, and <strong>radiological imaging</strong> help to confirm the diagnosis.\u00a0</p>\n<p>Metronidazole is\u00a0the <strong>drug of choice</strong> for treating <strong>invasive amebiasis</strong> like an amebic liver abscess. It is a <strong>nitroimidazole</strong> compound and is a highly <strong>active tissue amebicide. </strong><strong>Tinidazole</strong>, which is another longer-acting imidazole, is also highly effective for the management of this condition. Other tissue amebicides include secnidazole, satranidazole and ornidazole.</p>\n<p>Metronidazole is also effective against <strong>other anaerobic</strong> and <strong>microaerophilic</strong> organisms. It is used in the management of <strong>giardiasis</strong>, <strong>trichomoniasis</strong>, anaerobic bacterial infections (e.g., pelvic or abdominal abscesses following surgery), <strong>pseudomembranous enterocolitis, </strong>and <strong><em>Helicobacter pylori</em> gastritis</strong>.</p>\n<p>Adverse effects include <strong>gastrointestinal manifestations</strong> like anorexia, nausea, and a metallic taste. It is known for its ability to produce a <strong>disulfiram-like reaction</strong> when taken with alcohol. Metronidazole can <strong>decrease the renal elimination of lithium</strong> and potentiate its toxicity. It may also cause significant bleeding in patients on <strong>warfarin therapy</strong>.</p>\n<p>Other options:<br /><br /><strong>Iodoquinol </strong>(Option B), <strong>paromomycin </strong>(Option C), and <strong>diloxanide furoate\u00a0</strong>(Option D) are<strong> luminal amebicides</strong>. They are poorly absorbed and thus reach high concentrations in the bowel and are used in the management of <strong>intestinal amebiasis</strong>. They are also indicated for invasive amebiasis. However, <strong>their role is to eradicate cysts</strong> and <strong>prevent further transmission.</strong> They <strong>would not have any direct effect</strong> on the <strong>extraintestinal liver abscess</strong> as seen in this case.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2863a47642994f5f876865075adb5f88.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient is brought to the emergency for the alleged consumption of an organophosphate compound. He is being treated with atropine and develops palpitations, blurring of vision, dryness of mouth, difficulty in speaking and swallowing, and difficulty in micturition. All of the following antihistamines can safely administered in this patient except:",
    "choices": [
      {
        "id": 1,
        "text": "Fexofenadine"
      },
      {
        "id": 2,
        "text": "Loratadine"
      },
      {
        "id": 3,
        "text": "Promethazine"
      },
      {
        "id": 4,
        "text": "Levocetrizine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of a patient being treated with atropine developing palpitations, blurring or vision and dryness of mouth,&nbsp; difficulty in speaking and swallowing, and difficulty in micturition are indicative of <strong>atropine toxicity</strong>. <strong>Promethazine</strong> should be <strong>avoided</strong> in this case.</p>\n<p>Promethazine is a <strong>first-generation antihistamine</strong> that has the <strong>strongest antimuscarinic activity</strong> amongst all antihistamines and therefore can <strong>potentiate atropine toxicity</strong>. Therefore, it has to be avoided in this patient.</p>\n<div class=\"page\" title=\"Page 148\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">A few important symptoms of <strong>atropine toxicity</strong> are shown in the diagram below.</span></p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/24d82682b6bf46c78807d34de23212e6x1280x2559.JPEG"
    ]
  },
  {
    "text": "A 38-year-old man develops pulmonary tuberculosis and is started on ATT. After a year, he develops a sudden decrease in vision of both eyes. On examination, vision in both eyes is 3/60. He finds it difficult to read Ishihara\u2019s chart. He also has pain while moving his eyeballs. On fundus examination, the discs and vessels were normal. What is the most probable drug which can be implicated in this complication?",
    "choices": [
      {
        "id": 1,
        "text": "Ethambutol"
      },
      {
        "id": 2,
        "text": "Isoniazid"
      },
      {
        "id": 3,
        "text": "Pyrazinamide"
      },
      {
        "id": 4,
        "text": "Rifampicin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario is suggestive of&nbsp;<strong>retrobulbar neuritis,&nbsp;</strong>as the patient has a sudden deterioration in his vision, painful extraocular movements, and poor color discrimination.&nbsp;<span data-preserver-spaces=\"true\">The antitubercular drug,</span><strong><span data-preserver-spaces=\"true\">&nbsp;ethambutol</span></strong><span data-preserver-spaces=\"true\">&nbsp;can cause retrobulbar neuritis and red-green color blindness.</span></p>\n<p><strong>Optic neuritis</strong>&nbsp;resulting in decreased visual acuity and loss of ability to differentiate red from green is the most serious adverse effect of ethambutol.&nbsp;It is a&nbsp;<strong>dose-dependent</strong>&nbsp;adverse effect that can be unilateral or bilateral.&nbsp;The intensity of the visual difficulty is related to the duration of therapy.</p>\n<p><strong>Tests of visual acuity</strong> and<strong> red-green discrimination</strong>&nbsp;before the start of therapy and periodically thereafter are recommended.</p>\n<p><span data-preserver-spaces=\"true\"><strong>Ethambutol&nbsp;</strong>is used for the treatment of tuberculosis, disseminated <em>Mycobacterium avium</em> complex, and <em>Mycobacterium kansasii</em> infection. It<strong> inhibits arabinosyl transferase III,&nbsp;</strong>thereby disrupting the transfer of arabinose into arabinogalactan biosynthesis. This disrupts the&nbsp;assembly of the<strong>&nbsp;mycobacterial cell wall.&nbsp;</strong>Resistance occurs due to mutations in the<strong>&nbsp;<em>embB</em>&nbsp;gene.</strong></span></p>\n<p>Since 80% of the drug is eliminated through the kidney unchanged, its dosing should be decreased in renal failure to avoid toxicity. Ethambutol should be given 15-25 mg/kg <strong>three times a week</strong>, instead of daily in patients with renal failure.</p>\n<p>Other side effects are pruritus, joint pain, GI upset, abdominal pain, malaise, headache, dizziness, mental confusion, disorientation, possible hallucinations, and&nbsp;decreased renal excretion of uric acid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Integrated Mini Test 11 - Pharmacology';
        const quizFilename = 'integrated-mini-test-11-pharmacology-ffa0fd95.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>