<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02 Components Of Immune System - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What type of immunity is being conferred to a neonate receiving the BCG vaccine?",
    "choices": [
      {
        "id": 1,
        "text": "Natural active immunity"
      },
      {
        "id": 2,
        "text": "Natural passive immunity"
      },
      {
        "id": 3,
        "text": "Artificial active immunity"
      },
      {
        "id": 4,
        "text": "Artificial passive immunity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The immunity conferred to a neonate receiving the BCG vaccine is<strong> artificial active immunity</strong>, as it involves administering a live attenuated vaccine form of<strong> </strong><em>Mycobacterium bovis</em><strong> </strong>to stimulate an adaptive immune response and develop antibodies, establishing long-term immunity.\u00a0</p>\n<p>Types of adaptive immunity:\u00a0</p>\n<ul>\n<li><strong>Natural active immunity</strong>: It results from either a clinical or an inapparent infection by a microbe.</li>\n<li><strong>Artificial active immunity</strong>: It is the resistance induced by vaccines which are preparations of killed or attenuated microorganisms or their products.</li>\n<li><strong>Natural passive immunity</strong>: It is the immunity passively transferred from mother to baby. In human infants, maternal antibodies are transmitted predominantly through the placenta, while in animals such as pigs, the transfer of antibodies occurs mainly through the colostrum.</li>\n<li><strong>Artificial passive immunity</strong>: It is the resistance passively transferred to a recipient by the administration of antibodies. Hyperimmune sera of animal or human origin, convalescent sera, and pooled human immunoglobulin are used for this purpose.</li>\n<li><strong>Combined immunization</strong>: A combination of the active and passive methods of immunization is used.</li>\n</ul>\n<p>Examples of the above types of immunity:\u00a0</p>\n<table style=\"height: 342px; width: 492px;\">\n<tbody>\n<tr>\n<td style=\"width: 213px; text-align: center;\"><strong>Immunity</strong></td>\n<td style=\"width: 263px; text-align: center;\"><strong>Description\u00a0</strong></td>\n</tr>\n<tr>\n<td style=\"width: 213px; text-align: left;\">Natural active</td>\n<td style=\"width: 263px;\">Clinical or subclinical\u00a0<strong>infection</strong></td>\n</tr>\n<tr>\n<td style=\"width: 213px; text-align: left;\">Artificial active</td>\n<td style=\"width: 263px;\"><strong>Vaccination</strong></td>\n</tr>\n<tr>\n<td style=\"width: 213px; text-align: left;\">Natural passive</td>\n<td style=\"width: 263px;\">Transplacental<strong>\u00a0</strong>transfer of\u00a0antibody, <strong>colostrum</strong></td>\n</tr>\n<tr>\n<td style=\"width: 213px; text-align: left;\">Artificial passive</td>\n<td style=\"width: 263px;\"><strong>Anti-tetanus serum</strong>, anti-diphtherial serum</td>\n</tr>\n<tr>\n<td style=\"width: 213px; text-align: left;\">Combined\u00a0immunization</td>\n<td style=\"width: 263px;\">Antisera and vaccine are given at the\u00a0<strong>same time, </strong>e.g- post-exposure prophylaxis for rabies</td>\n</tr>\n</tbody>\n</table>\n<p>Note: <strong>Adoptive immunity</strong> is immunity in which immunologically competent lymphocytes are injected. The transfer factor is composed of these immunologically competent lymphocytes. It can passively transfer cell-mediated immunity against those antigens to which the donor is sensitive.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old with a large dirty wound on his knee and abrasions on his palms presents to the casualty. He does not remember the last time he received a TT injection and was thus given tetanus immunoglobulin. Which of the following is false about this type of immunity?",
    "choices": [
      {
        "id": 1,
        "text": "Acquired immediately"
      },
      {
        "id": 2,
        "text": "Memory is absent"
      },
      {
        "id": 3,
        "text": "Long lasting"
      },
      {
        "id": 4,
        "text": "No negative phase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Giving <strong>pre-formed immunoglobulin </strong>(e.g. Tetanus immunoglobulin) directly is an example of <strong>passive immunity,</strong> which is <strong>not long-lasting</strong>.\u00a0</p>\n<p>The differentiating features between active and passive immunity:</p>\n<table style=\"width: 358px; height: 859.766px;\">\n<tbody>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px; text-align: center;\">\n<p><strong>Active Immunity</strong></p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px; text-align: center;\">\n<p><strong>Passive Immunity</strong></p>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px;\">\n<p>Actively produced by the host\u2019s immune system</p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px;\">\n<p>Passively received by the host</p>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px;\">\n<p>Induced by infection or immunogens</p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px;\">\n<p>Readymade antibody is transferred</p>\n</td>\n</tr>\n<tr style=\"height: 59.7969px;\">\n<td style=\"width: 164.516px; height: 59.7969px;\">\n<p>Immunological memory present</p>\n</td>\n<td style=\"width: 164.891px; height: 59.7969px;\">\n<p>No\u00a0memory\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 99.1953px;\">\n<td style=\"width: 164.516px; height: 99.1953px;\">\n<p>Immunity is effective after a lag period or latent period</p>\n</td>\n<td style=\"width: 164.891px; height: 99.1953px;\">\n<p>Immediate immunity</p>\n</td>\n</tr>\n<tr style=\"height: 54.3984px;\">\n<td style=\"width: 164.516px; height: 54.3984px;\">\n<div class=\"page\" title=\"Page 93\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Broad specificity</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 164.891px; height: 54.3984px;\">\n<p>Narrow\u00a0specificity</p>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px;\">\n<p>A negative phase may occur\u00a0</p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px;\">\n<p>No negative phase.\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px;\">\n<p>Booster effect on subsequent dose</p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px;\">\n<p>The subsequent dose is less effective</p>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px;\">\n<p>Secondary type response seen\u00a0</p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px;\">\n<p>No secondary type of response</p>\n</td>\n</tr>\n<tr style=\"height: 54.3984px;\">\n<td style=\"width: 164.516px; height: 54.3984px;\">\n<p>More effective</p>\n</td>\n<td style=\"width: 164.891px; height: 54.3984px;\">\n<p>Less effective\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td style=\"width: 164.516px; height: 76.7969px;\">\n<p>Long-lasting (Years)</p>\n</td>\n<td style=\"width: 164.891px; height: 76.7969px;\">\n<p>Short-lasting (Days to weeks)</p>\n</td>\n</tr>\n<tr style=\"height: 54.3984px;\">\n<td style=\"width: 164.516px; height: 54.3984px;\">\n<p>Example: Vaccines</p>\n</td>\n<td style=\"width: 164.891px; height: 54.3984px;\">\n<p>Example: Antisera\u00a0</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Negative phase:</strong>\u00a0It<strong>\u00a0</strong>is the time period during which the level of <strong>measurable immunity</strong>\u00a0is\u00a0<strong>lower</strong> than it was before the antigenic stimulus. This is because the antigen combines with any pre-existing antibody and lowers its level in circulation. It is seen at the beginning of the active immune response.</p>\n<p><strong>Secondary type response:</strong>\u00a0If an individual who has been actively immunized against an antigen experiences the same antigen subsequently, the immune response occurs more quickly and abundantly than during the first encounter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f468a9a26c494a9a81f754306e5a6defx1280x1564.JPEG"
    ]
  },
  {
    "text": "A patient with chronic mucocutaneous candidiasis was administered transfer factor as treatment. What type of immunity does this result in?",
    "choices": [
      {
        "id": 1,
        "text": "Active immunity"
      },
      {
        "id": 2,
        "text": "Passive immunity"
      },
      {
        "id": 3,
        "text": "Combined immunity"
      },
      {
        "id": 4,
        "text": "Adoptive immunity"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Adoptive immunity</strong> occurs when <strong>transfer</strong> <strong>factor</strong> is given.</p>\n<p>Transfer factor is composed of an extract of\u00a0<strong>immunologically competent lymphocytes</strong>\u00a0such as<strong>\u00a0</strong>T lymphocytes,\u00a0NK cells, macrophages, or B cells.\u00a0It has the ability to <strong>passively</strong> transfer <strong>cell-mediated immunity</strong> against antigens to which the donor is sensitive.</p>\n<p>It has been attempted in the treatment of lepromatous leprosy and chronic mucocutaneous candidiasis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a pattern recognition receptor?",
    "choices": [
      {
        "id": 1,
        "text": "NOD-like receptors"
      },
      {
        "id": 2,
        "text": "Toll-like receptors"
      },
      {
        "id": 3,
        "text": "RIG-like receptors"
      },
      {
        "id": 4,
        "text": "BMP-like receptors"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Bone morphogenetic protein</strong>-<strong>like receptors</strong> are <strong>not</strong> pattern-recognition receptors.\u00a0</p>\n<p><strong>Pattern recognition receptors</strong> (PRRs) are essential for the<strong> innate immune system. </strong>They identify pathogen-associated molecular patterns (<strong>PAMPs</strong>) common to classes of microbes and trigger immune responses. These receptors can be found on the cell surface, detecting\u00a0extracellular pathogens, or within the endosomes and cellular matrix, detecting intracellular invading viruses.\u00a0</p>\n<p>PRRs activate<strong> pro-inflammatory pathways</strong>, promote phagocytosis in cells like macrophages, neutrophils and dendritic cells, and may act as secreted proteins binding directly to pathogens. Based on the localization and functional characteristics, PRRs are classified as:</p>\n<ul>\n<li>Membrane-bound PRRs:<strong>\u00a0</strong>\n<ul>\n<li><strong>Toll-like receptors </strong>(TLR)<strong>-</strong> detect microbial carbohydrates and lipoproteins (Option B)</li>\n</ul>\n<ul>\n<li>C-type lectin receptors (CLR)- detect mannose residues</li>\n</ul>\n</li>\n<li>Cytoplasmic (intracellular) PRRs:\n<ul>\n<li>Nucleotide oligomerization <strong>(NOD</strong>)<strong>-like receptors</strong> (NLR) - NOD1 and NOD2 - Detects bacterial cell wall peptidoglycans (Option A)</li>\n<li><strong>RIG-I-like receptors</strong> (RLRs) - detect viral RNA (Option C)</li>\n</ul>\n</li>\n<li>Secreted PRRs</li>\n</ul>\n<p>On the contrary, BMP receptors are multifunctional transmembrane serine-threonine kinase receptors that belong to the transforming growth factor \u03b2 (TGF-\u03b2) superfamily, regulating <strong>cell growth, differentiation, </strong>and<strong> apoptosis </strong>with no role in pattern recognition. Also, there are no receptors termed \"BMP-like receptors\".\u00a0</p>\n<p><strong>Note:</strong> A mutation in the Bone morphogenetic protein receptor 2 (<strong>BMPR2</strong>) gene enhances the proliferation and reduces the apoptosis of pulmonary vascular endothelial and smooth muscle cells, leading to <strong>hereditary pulmonary arterial hypertension </strong>(PAH).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old presents with diarrhea, fever, and vomiting. The given bacteria is implicated. Which toll-like receptor binds to the structure of the bacteria marked A?",
    "choices": [
      {
        "id": 1,
        "text": "TLR 2"
      },
      {
        "id": 2,
        "text": "TLR 4"
      },
      {
        "id": 3,
        "text": "TLR 5"
      },
      {
        "id": 4,
        "text": "TLR 9"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image and clinical history suggest a <strong>typhoid</strong> infection. The structure marked A is the <strong>flagella</strong> of bacteria.\u00a0<strong>Toll-like receptor</strong> (TLR) <strong>5</strong> binds to the <strong>flagella</strong> of bacteria.</p>\n<p>Toll-like receptors (TLRs) are\u00a0<strong>transmembrane receptors</strong> that have an <strong>extracellular</strong> domain, that detect infecting pathogens.</p>\n<ul>\n<li>TLR 1 - Mycobacteria and Gram-negative bacteria\u00a0\u00a0</li>\n<li>TLR 2 - Mycobacteria and Gram-positive bacteria</li>\n<li>TLR 3 - Viral RNA\u00a0</li>\n<li>TLR 4 - Gram-negative bacteria</li>\n<li>TLR 5 - Flagella</li>\n<li>TLR 9 - Bacterial DNA, some herpes viruses, malarial parasite\u00a0</li>\n</ul>\n<p>TLRs act through the NF-KB pathway and initiate inflammation.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf1f860f3d7549688ffe115b557d7f7f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about T cell dependent antigens?",
    "choices": [
      {
        "id": 1,
        "text": "Their response doesn't show immunological memory"
      },
      {
        "id": 2,
        "text": "They activate only mature B cells"
      },
      {
        "id": 3,
        "text": "They activate B cells polyclonally"
      },
      {
        "id": 4,
        "text": "They activate only IgG antibodies"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>T cell-dependent antigens activate</strong> only <strong>mature</strong> <strong>B cells</strong>.</p>\n<p>Depending on their ability to <strong>induce</strong> the <strong>formation</strong> of <strong>antibodies,</strong> antigens are classified as T-cell dependent and T-cell independent antigens.&nbsp;</p>\n<table style=\"height: 344px; width: 535px;\">\n<tbody>\n<tr style=\"height: 37px;\">\n<td style=\"width: 251px; height: 37px; text-align: center;\"><strong>T cell-dependent antigens (TD)</strong></td>\n<td style=\"width: 268px; height: 37px; text-align: center;\"><strong>T cell-independent antigens (TI)</strong></td>\n</tr>\n<tr style=\"height: 57px;\">\n<td style=\"width: 251px; height: 57px;\">Require helper&nbsp;T cell participation for the production of immune response</td>\n<td style=\"width: 268px; height: 57px;\">Directly stimulate antibody production by B cells</td>\n</tr>\n<tr style=\"height: 24px;\">\n<td style=\"width: 251px; height: 24px;\">Structurally complex</td>\n<td style=\"width: 268px; height: 24px;\">Structurally simple</td>\n</tr>\n<tr style=\"height: 45px;\">\n<td style=\"width: 251px; height: 45px;\">Activate only mature B cells monoclonally</td>\n<td style=\"width: 268px; height: 45px;\">Activate both mature and immature B cells polyclonally</td>\n</tr>\n<tr style=\"height: 22px;\">\n<td style=\"width: 251px; height: 22px;\">B cells undergo affinity maturation and class switch over</td>\n<td style=\"width: 268px; height: 22px;\">B cells do not undergo affinity maturation and class switch over</td>\n</tr>\n<tr style=\"height: 5px;\">\n<td style=\"width: 251px; height: 5px;\">\n<p>All classes of antibodies are activated</p>\n</td>\n<td style=\"width: 268px; height: 5px;\">Antibody response is restricted to IgM and IgG3</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 251px; height: 17px;\">Rapidly metabolized</td>\n<td style=\"width: 268px; height: 17px;\">Slowly metabolized</td>\n</tr>\n<tr style=\"height: 20px;\">\n<td style=\"width: 251px; height: 20px;\">Immunological memory present</td>\n<td style=\"width: 268px; height: 20px;\">No immunological memory</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman presents with a fever of 103\u00b0F, hypotension, confusion, and a diffuse rash as shown below. 3 days back, she had uncontrollable epistaxis for which a nasal pack was placed. What is the likely mechanism of action of the microbial toxin that has caused her current illness?",
    "choices": [
      {
        "id": 1,
        "text": "Enhancement of phagocytosis"
      },
      {
        "id": 2,
        "text": "Increased antigen presentation by macrophages"
      },
      {
        "id": 3,
        "text": "Polyclonal activation of T cells"
      },
      {
        "id": 4,
        "text": "Uncontrolled activation of complement"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Examples of organisms that produce superantigens:</p>\n<ol>\n<li><strong>Bacterial</strong>\n<ul>\n<li><em>Staphylococcus aureus</em>- Enterotoxins</li>\n<li>Group A streptococci - Pyrogenic exotoxin</li>\n<li><em>Mycoplasma\u00a0arthritidis</em>- mitogen 1</li>\n<li><em>Yersinia enterocolitica</em></li>\n<li><em>Yersinia pseudotuberculosis</em></li>\n</ul>\n</li>\n<li><strong>Viral</strong>\n<ul>\n<li>Epstein\u2013Barr virus (EBV)</li>\n<li>Cytomegalovirus (CMV)</li>\n<li>Rabies nucleocapsid</li>\n<li>HIV-encoded negative regulatory factor.</li>\n</ul>\n</li>\n<li><strong>Fungal-</strong>\u00a0<em>Malassezia furfur</em></li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8f4b102a11c94793aff80d581eac214d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9f9aca6adbc483daa63cbad5b7ad2fax1280x1233.JPEG"
    ]
  },
  {
    "text": "What are the changes in the variable regions of an immunoglobulin known as?",
    "choices": [
      {
        "id": 1,
        "text": "Idiotype"
      },
      {
        "id": 2,
        "text": "Isotype"
      },
      {
        "id": 3,
        "text": "Allotype"
      },
      {
        "id": 4,
        "text": "Epitope"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Changes in the<strong> variable regions </strong>of heavy and light chains of an immunoglobulin are called an<strong> idiotype.\u00a0</strong></p>\n<p>Other options:</p>\n<p>Option B:\u00a0<strong>Isotypes </strong>are the changes in the <strong>constant regions</strong> of the heavy chain of the immunoglobulin.\u00a0</p>\n<p>Option C:<strong> Allotypes\u00a0</strong>refer to <strong>multiple alleles</strong> that exist for some genes. This leads to subtle amino acid differences that occur in <strong>some but not all members</strong> of the <strong>same species.</strong>\u00a0</p>\n<p>Option D: An<strong> epitope\u00a0</strong>is the <strong>smallest unit of antigenicity</strong> and it is an antigenic determinant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about immunoglobulins is false?",
    "choices": [
      {
        "id": 1,
        "text": "IgG is used to diagnose fetal infection"
      },
      {
        "id": 2,
        "text": "IgM has weak precipitation activity"
      },
      {
        "id": 3,
        "text": "IgG has four subclasses"
      },
      {
        "id": 4,
        "text": "IgM is mainly intravascular"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>IgG cannot detect fetal infections&nbsp;</strong>because it is not produced by the fetus in significant amounts.&nbsp;</p>\n<p>IgG is the only maternal immunoglobulin that is normally transported across the placenta and provides <strong>natural passive immunity</strong> to the newborn.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following immunoglobulins acts as surface immunoglobulin on B cells?",
    "choices": [
      {
        "id": 1,
        "text": "Ig G"
      },
      {
        "id": 2,
        "text": "Ig A"
      },
      {
        "id": 3,
        "text": "Ig M"
      },
      {
        "id": 4,
        "text": "Ig E"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Monomeric IgM</strong> is the major antibody receptor on the surface of B lymphocytes for antigen recognition.</p>\n<p><strong>IgD</strong> is the other class of antibodies which acts as the B cell receptors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old child presents with a history of repeated sinopulmonary infections caused by encapsulated organisms. Which of the following is most likely to be deficient in this case?",
    "choices": [
      {
        "id": 1,
        "text": "IgG1"
      },
      {
        "id": 2,
        "text": "IgG2"
      },
      {
        "id": 3,
        "text": "IgG3"
      },
      {
        "id": 4,
        "text": "IgG4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Deficiency</strong> of<strong> IgG2</strong> results in <strong>recurrent sinopulmonary</strong> infections with encapsulated organisms.</p>\n<p>IgG is the only maternal immunoglobulin that is normally transported across the placenta and provides natural passive immunity to the newborn. <strong>IgG1</strong> is the antibody maximally transported across the placenta<strong>,</strong> whereas <strong>IgG2</strong> has the <strong>least transplacental</strong> movement.\u00a0</p>\n<p>Deficiencies of other IgG:\u00a0</p>\n<ul>\n<li>IgG1- bacterial infections (diphtheria, tetanus)(Option A)</li>\n<li>IgG3- viral infections (Option C)</li>\n<li>IgG4- parasitic infections (Option D)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the class of immunoglobulin\u200b shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Ig A"
      },
      {
        "id": 2,
        "text": "Ig G"
      },
      {
        "id": 3,
        "text": "Ig M"
      },
      {
        "id": 4,
        "text": "Ig E"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a <strong>dimeric</strong> <strong>structure,&nbsp;</strong>characteristic of <strong>secretory</strong>&nbsp;<strong>IgA.</strong></p>\n<p><strong>IgA</strong> immunoglobulin&nbsp;is the major antibody responsible for <strong>mucosal</strong> immunity. Its serum levels are usually&nbsp;low. It is predominantly present in the <strong>extravascular secretions.</strong> It is present in <strong>secretions</strong> such as milk, saliva, and tears, and in secretions of the respiratory, intestinal, and genital tracts.</p>\n<p>When present in the<strong> serum</strong>, it exists as a <strong>monomer</strong> similar to IgG. However, when it is <strong>secreted,</strong>&nbsp;it exists as a <strong>dimer</strong>. The dimeric structure consists of two monomers, which are stabilized by two additional polypeptides:</p>\n<ul>\n<li>J chain,&nbsp;which stabilizes the molecule.</li>\n<li><strong>Secretory component</strong>,&nbsp;which is incorporated into the IgA when transported through the epithelial cell.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e981e14c7dbc4845b2ca7646872fc9fa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/286886ccd1b44f4197c7951c3dfc3e2ax1280x2093.JPEG"
    ]
  },
  {
    "text": "Which immunoglobulin is majorly responsible for the reaction demonstrated below?",
    "choices": [
      {
        "id": 1,
        "text": "Ig G"
      },
      {
        "id": 2,
        "text": "Ig A"
      },
      {
        "id": 3,
        "text": "Ig M"
      },
      {
        "id": 4,
        "text": "Ig E"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows <strong>blood typing,</strong> which works on the principle of <strong>agglutination.</strong>\u00a0<strong>IgM </strong>is mainly responsible for agglutination.\u00a0</p>\n<p>It is the most\u00a0efficient immunoglobulin in agglutination, complement fixation,\u00a0and other antigen\u2013antibody reactions and is important also in\u00a0defense against bacteria and viruses.\u00a0</p>\n<p>It is a <strong>pentamer,</strong> and hence is <strong>more effective</strong> than IgG in opsonization (C3b mediated), bactericidal action and bacterial agglutination but less effective in neutralization of toxins and viruses.\u00a0</p>\n<table style=\"height: 181px;\" width=\"211\">\n<tbody>\n<tr>\n<td style=\"width: 93.2955px;\">\n<p style=\"text-align: center;\"><strong>Reaction</strong></p>\n</td>\n<td style=\"width: 66.0227px; text-align: center;\">\n<p><strong>IgG</strong></p>\n</td>\n<td style=\"width: 47.8409px; text-align: center;\">\n<p><strong>IgM</strong></p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 93.2955px;\">\n<p>Precipitation</p>\n</td>\n<td style=\"width: 66.0227px;\">\n<p>Strong</p>\n</td>\n<td style=\"width: 47.8409px;\">\n<p>Weak</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 93.2955px;\">\n<p>Agglutination</p>\n</td>\n<td style=\"width: 66.0227px;\">\n<p>Weak</p>\n</td>\n<td style=\"width: 47.8409px;\">\n<p>Strong</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 93.2955px;\">\n<p>Complement fixation</p>\n</td>\n<td style=\"width: 66.0227px;\">\n<p>Moderate</p>\n</td>\n<td style=\"width: 47.8409px;\">\n<p>Strong</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 93.2955px;\">\n<p>Lysis</p>\n</td>\n<td style=\"width: 66.0227px;\">\n<p>Weak</p>\n</td>\n<td style=\"width: 47.8409px;\">\n<p>Strong</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ea1381e345d942bea18cf82d0303c75c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are counseling a new mother about the importance of breastfeeding. What forms the secretory component of the antibody that is maximally present in breast milk?",
    "choices": [
      {
        "id": 1,
        "text": "Plasma cell only"
      },
      {
        "id": 2,
        "text": "Epithelial cells of lining mucosa only"
      },
      {
        "id": 3,
        "text": "Plasma cell and oligosaccharides"
      },
      {
        "id": 4,
        "text": "Oligosaccharides and epithelial cells"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The antibody <strong>maximally</strong> present in <strong>breast milk</strong> is <strong>IgA.</strong> The <strong>secretory component</strong> of IgA is formed by <strong>epithelial cells</strong> of<strong> lining mucosa.</strong></p>\n<p><strong>IgA</strong> occurs in two forms- <strong>serum</strong> IgA (monomer)\u00a0and <strong>secretory</strong> IgA.<strong>\u00a0</strong></p>\n<p><strong>Secretory</strong> IgA is a <strong>dimer</strong> formed by two monomer units joined together by a <strong>J-chain </strong>and a\u00a0<strong>secretory component</strong> (secretory piece).<strong>\u00a0</strong>Secretory IgA along with the J chain is synthesized by the plasma cells situated near the\u00a0mucosal or\u00a0glandular epithelium. The\u00a0secretory component\u00a0is synthesized by <strong>epithelial cells,</strong> not by plasma cells.\u00a0</p>\n<p>It is believed to protect IgA from denaturation by bacterial proteases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5be174dabbe84aaeb69db589f78c17e5x1280x2093.JPEG"
    ]
  },
  {
    "text": "When papain acts on a molecule of immunoglobulin, which of the following are the end products?",
    "choices": [
      {
        "id": 1,
        "text": "2 Fc and 1 Fab fragments"
      },
      {
        "id": 2,
        "text": "1 variable chain and 1 constant chain"
      },
      {
        "id": 3,
        "text": "1 Fc and 2 Fab fragments"
      },
      {
        "id": 4,
        "text": "1 Fab and 1 hypervariable region"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>When <strong>papain</strong> acts on a molecule of <strong>immunoglobulin,</strong> the end products are <strong>1 Fc</strong> and <strong>2 Fab</strong> fragments.\u00a0</p>\n<p><strong>Enzymatic digestion</strong> of antibody:</p>\n<ul>\n<li><strong>Papain-\u00a0</strong>2 Fab fragments and one Fc fragment</li>\n<li><strong>Pepsin-</strong>\u00a0One F(ab\u2019)<sub>2</sub>\u00a0fragment and many smaller fragments</li>\n<li><strong>Mercaptoethanol-</strong>\u00a02 H and 2 L chains</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/88b443aa9eb9417dbba0cfc2e4666777x1280x1049.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b62f5e0cfb4407b891e14bfd71c7e44x1280x1049.JPEG"
    ]
  },
  {
    "text": "Affinity maturation is due to:",
    "choices": [
      {
        "id": 1,
        "text": "Isotype switching"
      },
      {
        "id": 2,
        "text": "Somatic hypermutation"
      },
      {
        "id": 3,
        "text": "mRNA splicing"
      },
      {
        "id": 4,
        "text": "VDJ rearrangement"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Affinity maturation is due to\u00a0<strong>s</strong><strong>omatic hypermutation</strong>.</p>\n<p><strong>Affinity maturation</strong>\u00a0is the process by which <strong>antibodies gain increased</strong>\u00a0<strong>affinity</strong>, <strong>avidity,</strong> and<strong> anti-pathogen activity. </strong>It is a\u00a0result of somatic hypermutation (SHM) of immunoglobulin genes in B cells, coupled to selection for antigen binding.</p>\n<p>This process occurs in the <strong>germinal centers</strong>\u00a0and proceeds for weeks after acute infection or vaccination, or for many cycles during chronic infection. The resulting antibodies can be <strong>highly mutated</strong> from their germline-encoded counterparts, with increases of several orders of magnitude in affinity for antigen compared to the corresponding na\u00efve B cell receptors (BCRs).</p>\n<p>Other options:</p>\n<p>Option A: <strong>Isotype switching</strong>, also known as class switch recombination, is a process where the constant region of the antibody heavy chain is changed, leading to a switch in the antibody isotype (e.g., from IgM to IgG). This process is crucial for the functional properties of antibodies but is not directly involved in affinity maturation.</p>\n<p>Option C: <strong>mRNA splicing</strong> is a cellular process that involves the removal of introns and the joining of exons to generate mature mRNA. While this process is essential for the production of functional antibodies, it is not specifically associated with affinity maturation. Affinity maturation primarily occurs through somatic hypermutation.</p>\n<p>Option D: <strong>VDJ rearrangement</strong> is the process by which the variable regions of immunoglobulin genes are assembled from gene segments (V, D, and J segments). This process contributes to the diversity of antibodies but is distinct from affinity maturation. Affinity maturation occurs after VDJ rearrangement and is driven by somatic hypermutation in the variable regions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An immunologist is conducting an experiment to understand precipitation reactions. He notes that on adding excessive amount of antigen to a serum sample containing small amount of antibodies, the amount of precipitate formed is less, compared to adding smaller amount of antigen to the same sample. What is this phenomenon called?",
    "choices": [
      {
        "id": 1,
        "text": "Pro\u2013zone phenomenon"
      },
      {
        "id": 2,
        "text": "Zone of equivalence"
      },
      {
        "id": 3,
        "text": "Post\u2013zone phenomenon"
      },
      {
        "id": 4,
        "text": "Flocculation phenomenon"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>&nbsp;</p>\n<p>Flocculation: Instead of sedimenting, precipitate remains suspended as floculus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/817d0f1e97104caca8c0a13d9ae48795x1280x1481.JPEG"
    ]
  },
  {
    "text": "Double diffusion in two dimensions is called as ___________.",
    "choices": [
      {
        "id": 1,
        "text": "Oudin procedure"
      },
      {
        "id": 2,
        "text": "Oakley \u2013 Fulthrope procedure"
      },
      {
        "id": 3,
        "text": "Radial immunodiffusion"
      },
      {
        "id": 4,
        "text": "Ouchterlony procedure"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Double diffusion in two dimensions</strong> is called the&nbsp;<strong>Ouchterlony</strong> procedure. Ex:&nbsp;<strong>Elek&rsquo;s test</strong> for testing toxigenicity in <strong>diphtheria</strong> bacilli.&nbsp;</p>\n<p>The images below show the different types of immunodiffusion.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e85d77c51c14ac89a60add8f9a8305cx1280x1437.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38fc016cd4784c4fb21edf2582e71b5bx1280x1437.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f391f765364f4ec39f78f8064e003af8x600x574.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87b4065a071a4713a624bf5bb43d1727x600x1567.JPEG"
    ]
  },
  {
    "text": "A patient presented to the casualty with the following finding. A positive Nagler's reaction confirmed the presence of lecithinase-producing organisms. What is the principle behind this test?",
    "choices": [
      {
        "id": 1,
        "text": "Precipitation"
      },
      {
        "id": 2,
        "text": "Complement fixation test"
      },
      {
        "id": 3,
        "text": "Agglutination"
      },
      {
        "id": 4,
        "text": "Neutralisation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Nagler\u2019s reaction</strong> is an example of a <strong>neutralization</strong> test.\u00a0It is done for the detection of lecithinase\u00a0toxin produced by <strong><em>C. perfringens.</em></strong></p>\n<p>The <strong>alpha-toxin</strong> of <em>C. perfringens</em>\u00a0has <strong>phospholipase</strong> activity. When grown on a medium containing egg yolk phospholipid, an area of opacity around the bacterial colonies is seen (Nagler's positive). The presence of <strong>antitoxin</strong> can <strong>inhibit</strong> this.</p>\n<p>Other examples of neutralization tests are:</p>\n<ul>\n<li>Plaque inhibition test- neutralization of bacteriophages\u00a0</li>\n<li>Schick test- neutralization of diphtheria toxin by antitoxin</li>\n<li>Anti-streptolysin O test- for beta-hemolytic S<em>treptococci.</em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43737ca9c1604b14af0f44b94b1c8674.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0da4e13c9cdc4cb5add9d9b7762810b8x600x553.JPEG"
    ]
  },
  {
    "text": "A patient presents with a painless ulcer on his penis. A Wasserman test is done and is reactive. What is the principle of this test?",
    "choices": [
      {
        "id": 1,
        "text": "Precipitation"
      },
      {
        "id": 2,
        "text": "Complement fixation"
      },
      {
        "id": 3,
        "text": "Agglutination"
      },
      {
        "id": 4,
        "text": "Neutralisation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Wassermann's</strong> <strong>reaction\u00a0</strong>is an example of a\u00a0<strong>complement</strong> <strong>fixation</strong> <strong>test</strong>. It is a non-specific test for the <strong>diagnosis of syphilis.\u00a0</strong></p>\n<p>An antigen combines with its (specific) antibody in the presence\u00a0of complement, and the <strong>antigen-antibody complex adsorbs</strong> the <strong>complement.</strong> This reaction is not\u00a0visible and requires the use of an indicator (sheep erythrocytes and the specific anti-erythrocyte\u00a0antibody).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/881f5649dc15483d8e26e5e4c4a53297x1280x4005.JPEG"
    ]
  },
  {
    "text": "Which of the following activates the classical complement pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Immune complexes"
      },
      {
        "id": 2,
        "text": "Mannose residues"
      },
      {
        "id": 3,
        "text": "Hydrolysis of C3"
      },
      {
        "id": 4,
        "text": "Endotoxins"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>classical pathway</strong> of complement is activated by <strong>immune complexes </strong>or&nbsp;antigen-antibody complexes. (antigen bound to IgM or IgG).</p>\n<p><strong>Lipopolysaccharide</strong> of gram-negative bacteria activates the <strong>alternative</strong> complement pathway.</p>\n<p>The binding of <strong>mannose-binding</strong>&nbsp;lectin to mannose residues (on the surfaces of Salmonella, Neisseria, and Listeria) activates the<strong> lectin</strong> complement pathway.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd065f0590404bb3b7f00a67bf1a25b4x600x1116.JPEG"
    ]
  },
  {
    "text": "In the alternate complement pathway, which of the following functions as C3 convertase?",
    "choices": [
      {
        "id": 1,
        "text": "C4b2b"
      },
      {
        "id": 2,
        "text": "C3bB"
      },
      {
        "id": 3,
        "text": "C3bBb"
      },
      {
        "id": 4,
        "text": "C4b2a"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>C3 convertase</strong> in the <strong>alternate </strong>pathway&nbsp;is <strong>C3bBb.&nbsp;</strong></p>\n<p>In the&nbsp;<strong>classical</strong> pathway<strong> and lectin </strong>pathway, the C3 convertase is<strong> C4b2a.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1a406c0e380a4fb390216e06b609388ex600x1116.JPEG"
    ]
  },
  {
    "text": "A 23-year-old girl presents with the finding shown below. She has a history of multiple similar episodes in the past and reports that some of her family members have similar complaints. She has no itching. Which of the following is deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "C3b inactivator"
      },
      {
        "id": 2,
        "text": "C1, C2, C4"
      },
      {
        "id": 3,
        "text": "C1 inhibitor"
      },
      {
        "id": 4,
        "text": "C5-C8"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This girl presents with features of <strong>hereditary angioneurotic edema</strong>, which is due to a&nbsp;<strong>deficiency</strong> of<strong> C1 inhibitor</strong>.&nbsp;</p>\n<p>Hereditary angioneurotic edema is an<strong>&nbsp;autosomal dominant&nbsp;</strong>disorder<strong>&nbsp;</strong>that is more common than complement deficiency states. <strong>A deficiency</strong>&nbsp;of&nbsp;<strong>C1 inhibitor</strong>&nbsp;leads to&nbsp;<strong>unregulated</strong>&nbsp;<strong>activation</strong>&nbsp;of&nbsp;<strong>kallikrein</strong>. This increases the production of vasoactive peptides such as&nbsp;<strong>bradykinin</strong>. It causes episodes of&nbsp;<strong>edema</strong>&nbsp;affecting the skin and mucosal surfaces such as the larynx and the gastrointestinal tract. This may result in life-threatening&nbsp;<strong>asphyxia</strong>&nbsp;or nausea, vomiting, and diarrhea after minor trauma or emotional stress.</p>\n<p>Note -</p>\n<ul>\n<li><strong>C1, C2, C4</strong> deficiency - collagen vascular disorders.</li>\n<li><strong>C5-C8</strong> deficiency - recurrent bacteremia with <em>Neisseria</em>&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0ecdb416e66d49fd80006a9523c0da94.PNG"
    ],
    "explanation_images": []
  }
];
        let quizName = '02 Components Of Immune System';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>