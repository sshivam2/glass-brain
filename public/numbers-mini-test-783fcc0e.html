<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numbers Mini Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the oxygen delivery rate of the device shown below?",
    "choices": [
      {
        "id": 1,
        "text": "40-60 L/min"
      },
      {
        "id": 2,
        "text": "2-15 L/min"
      },
      {
        "id": 3,
        "text": "10-15 L/min"
      },
      {
        "id": 4,
        "text": "1-6 L/min"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The equipment shown in the image is a nasal cannula. It delivers oxygen at <strong>1-6 L/min.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/af8c7326959b4b3f9c0e8703ce6c82e6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/399d47d214fc47bfb5feda0bc039f514x1280x1280.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f1ae8ce289a41b794a6e7e5ed930821x512x525.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d9a526f186649dabbf96fed3f12c658x720x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9e6523971b7493b9ef0d7937aec36c9x1279x1173.JPEG"
    ]
  },
  {
    "text": "You are encountering a case at the forensics department where the victim's body had an entry wound from a shotgun as shown below. You would suspect that it was most likely shot at a distance range of ____.",
    "choices": [
      {
        "id": 1,
        "text": "Contact shot"
      },
      {
        "id": 2,
        "text": "More than 5 metres"
      },
      {
        "id": 3,
        "text": "15-30 cm"
      },
      {
        "id": 4,
        "text": "1- 5 metres"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows a <strong>central 'rat-hole'</strong> appearance of the entry wound of a shotgun which can be seen from <strong>1 to 5</strong> <strong>meters</strong> of range.</p>\n<p><strong>Circular rat-hole</strong> wound without peripheral satellite pellet holes is seen in the <strong>30 cm to 1 m range</strong>.</p>\n<p>Central rat-hole wound with peripheral satellite pellet holes is seen in the 1 m to 5 m range.</p>\n<p>The rat-hole appearance of the entry wound:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e1d3adc897bd4e948eda21ac210072d6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9b17623574674ff383589691164f0601x111x106.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d6a1a59112644fdb34fe5de9161db8dx1280x1246.JPEG"
    ]
  },
  {
    "text": "A 32-year-old man met with a road traffic accident and caused damage to public property while being drunk due to forced intoxication by his colleagues. In court, he can plead innocence based on which of the following sections?",
    "choices": [
      {
        "id": 1,
        "text": "BNS Sec 21 (83 IPC)"
      },
      {
        "id": 2,
        "text": "BNS Sec 22 (84 IPC)"
      },
      {
        "id": 3,
        "text": "BNS Sec 23 (85 IPC)"
      },
      {
        "id": 4,
        "text": "BNS Sec 24 (86 IPC)"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Baseed on the vignette, he can plead innocence under BNS sec 23 (<strong>85 IPC) <br /></strong></p>\n<p>It talks about the <strong>criminal responsibility of forceful intoxication</strong>, against a person's will or knowledge. It states that:</p>\n<p>Nothing is an offense which is done by a person who, at the time of doing it, is by reason of intoxication, incapable of knowing the nature of the act, or that he is doing what is either wrong, or contrary to law; provided that the thing which intoxicated him was administered to him without his knowledge or against his will.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man comes to the emergency with a 0.5 cm deep clean lacerated wound on his forearm.  The suture technique shown below was used to close the wound. What should be the ideal distance between 2 consecutive sutures in this method?",
    "choices": [
      {
        "id": 1,
        "text": "2 cm"
      },
      {
        "id": 2,
        "text": "1 cm"
      },
      {
        "id": 3,
        "text": "0.5 cm"
      },
      {
        "id": 4,
        "text": "0.25 cm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows\u00a0<strong>simple interrupted sutures.\u00a0</strong>While using this method,\u00a0if\u00a0'x' is the <strong>depth</strong> of the wound, then the <strong>bite distance</strong>\u00a0on each side of the incision must be <strong>'x'</strong>, while the distance between 2 <strong>consecutive sutures</strong> must be <strong>'2x'</strong>. Therefore, the distance between two consecutive sutures in this patient would be 2 * depth of the wound = 2 * 0.5 cm = <strong>1 cm</strong>.</p>\n<p>In\u00a0<strong>interrupted sutures,\u00a0</strong>the needle should enter and exit at <strong>right angles.</strong>\u00a0The needle should be rotated through the tissue and should not be dragged through to avoid enlargement of the needle holes.</p>\n<p>The image below shows the interrupted suturing technique.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/570fcd5e7092466f82d92be03764b6be.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e98fc60a1514fadbe5677f6f3ce7681x1120x880.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0370d7b3d54843b1a71e69a2e30c18adx1120x880.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/210b4c5459aa46a8bdff20756d105194x1120x880.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae924ff664594fbaafa8faabe7034e94x1280x1143.JPEG"
    ]
  },
  {
    "text": "According to the National Immunization Schedule, what is the dose of vitamin A that should be administered with the first dose of the vaccine shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "1.5 lakh IU"
      },
      {
        "id": 2,
        "text": "0.5 lakh IU"
      },
      {
        "id": 3,
        "text": "1 lakh IU"
      },
      {
        "id": 4,
        "text": "2 lakh IU"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the national immunization schedule, <strong>1 lakh IU </strong>of <strong>vitamin A</strong> should be given orally along with the first dose of the <strong>measles-rubella</strong>\u00a0vaccine, which is shown in the image.</p>\n<p>The\u00a0first dose of the vaccine is given at <strong>9</strong>\u00a0<strong>months</strong> of age. It can be given up to a <strong>maximum age</strong> of <strong>5 years</strong>. It is given along with the measles vaccine as it <strong>enhances antibody production</strong> and confers sustained immunity against measles.</p>\n<p>Vitamin A deficiency arises mostly due to its inadequate amounts in the diet. It can present as\u00a0<strong>night blindness</strong>, conjunctival xerosis, Bitot's spots, and\u00a0<strong>keratomalacia</strong>. At later stages, it can lead to\u00a0<strong>xerophthalmia</strong>.</p>\n<p>The image below shows Bitot's spots.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ac16aa6a55e04dc38a32ab33356a2159.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c175e532a7f64b8ba5c826f56d20ec18x720x561.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4468d9d53ae44a1b1a8e4a3d9ac50a7x720x434.PNG"
    ]
  },
  {
    "text": "Common carotid artery bifurcates at the level of _______.",
    "choices": [
      {
        "id": 1,
        "text": "C4-C5"
      },
      {
        "id": 2,
        "text": "C3-C4"
      },
      {
        "id": 3,
        "text": "C2-C3"
      },
      {
        "id": 4,
        "text": "C5-C6"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The bifurcation of the <strong>common carotid artery\u00a0</strong>is at the\u00a0<strong>upper border </strong>of the<strong> thyroid cartilage, </strong>at the<strong> level </strong>of the <strong>C3-C4 junction</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0f7c3957aec54f1ea769ee8670845b8e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c6c5e9b4f159449aab73c3848b0b7a1fx510x618.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f5a1ac2d5da4ab080e521b5f7ee0092x600x628.JPEG"
    ]
  },
  {
    "text": "Which of the following coagulation factors is directly responsible for the conversion of factor II to IIa in the extrinsic pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Factor IXa"
      },
      {
        "id": 2,
        "text": "Factor Xa"
      },
      {
        "id": 3,
        "text": "Factor VIIa"
      },
      {
        "id": 4,
        "text": "Factor VIIIa"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>both the intrinsic and the extrinsic pathways</strong>,\u00a0<strong>factor Xa</strong> is responsible for the conversion of <strong>prothrombin (factor II) to thrombin (factor IIa).</strong></p>\n<p>Tissue factor is expressed on the surfaces of the subendothelial cellular components of the vessel wall, such as smooth muscle cells and fibroblasts. This tissue factor is exposed to blood when there is vascular damage. This activates the extrinsic pathway of the coagulation cascade, which is as follows:</p>\n<ul>\n<li>Tissue factor binds with serine protease factor VIIa</li>\n<li>This complex then activates factor IX to factor IXa</li>\n<li>Factor IXa then activates factor X to factor Xa</li>\n<li>Factor Xa can be formed through the actions of either the tissue factor-factor VIIa complex of factor IXa (with factor VIIIa as cofactor)</li>\n<li>Factor Xa then converts prothrombin to thrombin, which is the pivotal protease of the coagulation cascade.</li>\n<li>The cofactor essential for this conversion is factor Va.</li>\n<li>The thrombin then formed converts the soluble plasma fibrinogen to an insoluble fibrin matrix.</li>\n<li>Thrombin also activates factor XIII, which is the fibrin-stabilizing factor to factor XIIIa. This factor XIIIa forms covalent cross-links and thereby stabilizes the fibrin clot.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e166fa76bdd646689e605a2eaae2ed57x1280x1711.JPEG"
    ]
  },
  {
    "text": "An autopsy of a 65-year old man who passed away from complications due to myocardial infarction was conducted. The histopathological examination of the infarcted area of the heart revealed contraction band necrosis, nuclear pyknosis, and hypereosinophilia. After how much time will these findings occur after a myocardial infarction?",
    "choices": [
      {
        "id": 1,
        "text": "7-10 days"
      },
      {
        "id": 2,
        "text": "10-14 days"
      },
      {
        "id": 3,
        "text": "4-12 hours"
      },
      {
        "id": 4,
        "text": "12-24 hours"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The histopathological findings of\u00a0<strong>contraction band necrosis,\u00a0nuclear pyknosis,</strong> and<strong> hypereosinophilia\u00a0\u00a0</strong>are seen\u00a0<strong>12-24 hours</strong> after myocardial infarction.</p>\n<p>Pathological contraction bands, also known as <strong>Zenker's necrosis</strong>, are a type of necrosis pattern found in the myocardium. Histologically, the pattern seen is <strong>hyper contraction\u00a0</strong>and<strong> lysis</strong> of<strong> small groups</strong> of myocardial cells. Contraction bands are seen surrounding an <strong>acute myocardial infarction</strong>.</p>\n<p>Other causes of contraction bands are:</p>\n<ul>\n<li>Coronary occlusion</li>\n<li>Resuscitation attempts</li>\n<li>Drowning</li>\n<li>Burning</li>\n<li>Hypothermia.</li>\n</ul>\n<p>Other changes that occur ar <strong>12-24 hours</strong> are the gross appearance of <strong>dark mottling</strong> and microscopic features such as ongoing coagulative necrosis, and early neutrophilic infiltrate.</p>\n<p>Other options:</p>\n<p>Option A -\u00a0Histopathological changes occurring by <strong>7-10 days</strong> are <strong>well-developed phagocytosis</strong> of dead cells and the presence of <strong>granulation tissue</strong> at<strong> margins</strong>. On gross examination, it appears maximally yellow-tan and soft,\u00a0with depressed red-tan margins.</p>\n<p>Option B -Histopathological changes occurring by <strong>10-14 days</strong> are <strong>well-established granulation tissue</strong> with <strong>new blood vessels</strong> and <strong>collagen deposition</strong>. On gross examination, it appears as red-gray depressed infarct borders<strong>.</strong></p>\n<p>Option C -Histopathological changes occurring by <strong>4-12 hours</strong> are <strong>early coagulative necrosis, edema,</strong> and<strong> hemorrhage</strong>. On gross examination, there is occasional dark mottling.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an indication for mechanical ventilation?",
    "choices": [
      {
        "id": 1,
        "text": "Arterial oxygen tension < 50 mm Hg"
      },
      {
        "id": 2,
        "text": "PaO2 /FiO2 ratio < 375 mm Hg"
      },
      {
        "id": 3,
        "text": "Tidal volume < 5 mL/kg"
      },
      {
        "id": 4,
        "text": "Vital capacity < 15 mL/kg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>PaO<sub>2</sub> /FiO<sub>2</sub> ratio &lt;300 mm Hg (not &lt;375) is an indication of mechanical ventilation.</p>\n<p><strong>Indications of mechanical ventilation:</strong></p>\n<p>Directly measured indices</p>\n<ul>\n<li><strong>Arterial oxygen</strong> tension <strong>&lt;50</strong> <strong>mmHg</strong> on room air</li>\n<li><strong>Arterial CO<sub>2</sub></strong> tension <strong>&gt;50 mmHg</strong> in the absence of metabolic alkalosis</li>\n</ul>\n<p>Derived indices</p>\n<ul>\n<li><strong>PaO<sub>2 </sub>/FiO<sub>2</sub> ratio &lt;300 mm Hg</strong></li>\n<li>PA\u2013aO<sub>2</sub> gradient &gt;350 mm Hg</li>\n<li>V<span style=\"font-size: xx-small;\">d</span>/V<span style=\"font-size: xx-small;\">t</span>\u00a0&gt;0.6 (Ratio of physiologic dead space over tidal volume)</li>\n</ul>\n<p>Clinical indices</p>\n<ul>\n<li>Respiratory rate &gt;35 breaths/min</li>\n</ul>\n<p>Mechanical indices</p>\n<ul>\n<li><strong>Tidal volume &lt;5 mL/kg</strong></li>\n<li><strong>Vital capacity &lt;15 mL/kg</strong></li>\n<li>Maximum inspiratory force &gt; \u221225 cm H<sub>2</sub>O</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A researcher was conducting a study on the relationship between the bladder volume and perception of bladder fullness.  What quantity of urine is required to cause this marked sense of fullness?",
    "choices": [
      {
        "id": 1,
        "text": "400 mL"
      },
      {
        "id": 2,
        "text": "350 mL"
      },
      {
        "id": 3,
        "text": "250 mL"
      },
      {
        "id": 4,
        "text": "150 mL"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>400 mL </strong>of urine in the bladder is required to cause this marked&nbsp;<strong>sense </strong>of<strong> fullness.</strong></p>\n<p>The&nbsp;<strong>first urge</strong> to <strong>void</strong> is felt at a bladder volume of about <strong>150 mL </strong>(option D).</p>\n<p>The relationship between the intravesical pressure and volume of fluid in the bladder can be plotted in a graph and is studied by the&nbsp;<strong>cystometrogram.</strong></p>\n<p>The curve shows</p>\n<ul>\n<li>An initial increase in pressure when there is a first increase in volume (Ia)</li>\n<li>A long and flat portion which is produced with a further increase in volume (Ib);</li>\n<li>A sudden, sharp increase in pressure as the micturition reflex is triggered(II).</li>\n<li>The law of Laplace explains the flatness of segment Ib. It states that the pressure in a spherical viscus is equal to twice the wall tension divided by the radius,&nbsp;<strong>P= 2T/R</strong></li>\n<li>In case of the blad&shy;der, the filling of the bladder and the radius increases with increase in the tension. Therefore, there is slight increase in pressure increase until the organ is relatively full.</li>\n</ul>\n<p>The below curve shows a cystometrogram.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd8f741ec1a4426085415c815df26a7fx1020x1050.JPEG"
    ]
  },
  {
    "text": "A 26-year-old woman doing heavy work,  asks for your advice regarding the additional energy requirement while breastfeeding her 8-month-old child. What is the total calorie requirement per day in her case?",
    "choices": [
      {
        "id": 1,
        "text": "3040 Kcal/day"
      },
      {
        "id": 2,
        "text": "3240 Kcal/day"
      },
      {
        "id": 3,
        "text": "3440 Kcal/day"
      },
      {
        "id": 4,
        "text": "3640 Kcal/day"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>total</strong> <strong>calorie</strong> requirement per day for the woman is <strong>3240 Kcal/day.</strong></p>\n<p>In the given scenario, the <strong>basal</strong> <strong>energy</strong> <strong>requirement</strong> for a <strong>woman</strong> doing <strong>heavy work</strong> is <strong>2720\u00a0Kcal/day</strong>. When the woman is <strong>lactating</strong> the additional requirements per day are:</p>\n<ul>\n<li>Lactation for <strong>0-6 months </strong>=<strong> + 600 Kcal/day</strong></li>\n<li>Lactation for <strong>7-12 months </strong>=<strong> + 520 Kcal/day</strong></li>\n</ul>\n<p>In this scenario, a heavy working woman is breastfeeding her <strong>8 month</strong> old child, therefore an <strong>additional</strong> <strong>520Kcal/day</strong> is required to the basal requirement of\u00a02720\u00a0Kcal/day. This adds up to 3240\u00a0Kcal/day.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman was brought to the emergency department after a road traffic accident. She opens her eyes to painful stimuli, but her speech is confused. She can localize pain on the right side, but withdraws from pain on the left side. What is her Glasgow Coma Scale score?",
    "choices": [
      {
        "id": 1,
        "text": "9"
      },
      {
        "id": 2,
        "text": "11"
      },
      {
        "id": 3,
        "text": "7"
      },
      {
        "id": 4,
        "text": "13"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>From the given clinical scenario, the <strong>Glasgow Coma Scale</strong> (GCS) score of the patient is <strong>11 </strong>and her component score is<strong>\u00a0E<sub>2</sub>V<sub>4</sub>M<sub>5</sub>.<br /></strong></p>\n<p><strong>Glasgow Coma Scale\u00a0</strong>(GCS)\u00a0is used in the assessment of patients with a\u00a0<strong>head injury</strong>. It has three components:\u00a0<strong>eye-opening, verbal, </strong>and<strong> motor abilities</strong>. Each component is assigned a score, and the total score is presented as a sum of three.</p>\n<ul>\n<li>Eye-opening: To painful stimulus = 2\u00a0</li>\n<li>Verbal response:\u00a0Confused = 4</li>\n<li>Motor response: Localize the pain on the right side = 5</li>\n</ul>\n<p>In GCS, the\u00a0<strong>best motor response</strong>\u00a0elicited is considered for scoring.\u00a0As seen in this patient, if she can <strong>localize</strong> the <strong>pain</strong> on the <strong>right</strong> side but <strong>withdraws</strong> from pain on the<strong> left</strong> side, then the motor component of the <strong>right</strong> side would be considered, and the score would be <strong>5</strong>. Therefore, her component score would be <strong>E<sub>2</sub>V<sub>4</sub>M<sub>5\u00a0</sub></strong>and adding 2+4+5 gives a score of 11.</p>\n<p>A GCS score of<strong>\u00a0&lt;8</strong> denotes <strong>severe brain injury</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a resident doctor in the intensive care unit. You administer a drug 'X' to a patient. The plasma concentration of the drug reaches 500 mg/L. The drug follows zero-order kinetics. 200 mg of the drug 'X' is eliminated in 4 hours. What is the clearance of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "1 L/h"
      },
      {
        "id": 2,
        "text": "1.66 L/h"
      },
      {
        "id": 3,
        "text": "1.66 mL/min"
      },
      {
        "id": 4,
        "text": "0.1 mL/min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clearance of drug X is <strong>1.66 mL/min.</strong></p>\n<p>Since drug X follows zero-order kinetics, the\u00a0<strong>elimination rate </strong>(amount of drug eliminated in unit time) is<strong> constant.</strong></p>\n<p>200 mg is eliminated in 4 hours. Therefore, 50 mg is eliminated in 1 hour as it follows zero-order kinetics.</p>\n<p><strong>Clearance = Rate of elimination/Plasma concentration</strong></p>\n<p>Rate of elimintation= 50 mg/h<br />Plasma concentration= 500 mg/L</p>\n<p>Clearance = (50 mg/hr)/(500 mg/L)= <strong>0.1 L/h</strong></p>\n<p>To convert L/h to mL/min, multiply by 1000 and divide by 60.</p>\n<p>\u2234 Clearance = 0.1 x 1000 ml/60 min= <strong>1.66 mL/min</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about the heart rate in idioventricular rhythm?",
    "choices": [
      {
        "id": 1,
        "text": "More than 300 beats/minute"
      },
      {
        "id": 2,
        "text": "Less than 40 beats/minute"
      },
      {
        "id": 3,
        "text": "50 - 100 beats/minute"
      },
      {
        "id": 4,
        "text": "More than 100 beats/minute"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A heart rate of <strong>less than 40 beats/minute</strong> is consistent with <strong>idioventricular rhythm</strong>.\u00a0</p>\n<p><strong>Idioventricular rhythm</strong> occurs when <strong>both</strong> the <strong>sinoatrial</strong> node (SAN) and <strong>atrioventricular</strong> node (AVN) do not function. This leads to the <strong>Purkinje</strong> system taking over as a <strong>pacemaker</strong> to ensure ventricular contraction. The rate is usually less than 40 beats/minute.\u00a0</p>\n<p>Causes of idioventricular rhythm include electrolyte abnormalities, <strong>digitoxin</strong> toxicity, anesthetic agents, cocaine, and isoprenaline.\u00a0</p>\n<p>The usual findings of idioventricular rhythm include a heart rate of fewer than 40 beats per minute. The ECG may or may not have P waves. If there is a complete AVN block leading to sinus rhythm with idioventricular escape rhythm it will have P waves. Idioventricular rhythm without<strong>\u00a0P waves\u00a0</strong>is of poor prognosis. This usually proceeds a flat line.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option A - A heart rate of more than 300 beats/minute is seen in <strong>atrial flutter.</strong></p>\n<p>Option C - A heart rate of 50 - 100 beats per minute is seen in <strong>normal sinus rhythm</strong> and <strong>accelerated idioventricular rhythm</strong>.</p>\n<p>Option A - A heart rate of more than 100 beats/ minute is seen in <strong>sinus tachycardia</strong> and <strong>non-sustained ventricular tachycardia.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient of a road traffic accident needs blood transfusion. The doctor administers the blood brought by the nurse without verifying the blood group. The patient dies of transfusion reaction due to blood group incompatibility. The punishment for this act is described under which section of the BNS (IPC)?",
    "choices": [
      {
        "id": 1,
        "text": "BNS Sec 102 (IPC 301)"
      },
      {
        "id": 2,
        "text": "BNS Sec 80 (IPC 304 B)"
      },
      {
        "id": 3,
        "text": "BNS Sec 106 (IPC 304 A)"
      },
      {
        "id": 4,
        "text": "BNS Sec 103 (IPC 302)"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given scenario, the doctor fails to verify the blood group of the blood to be administered. This amounts to\u00a0<strong>causing death by rash or negligent act</strong> which is defined under <strong>BNS Sec 106</strong> (304A IPC). This act can lead to a punishment of imprisonment of up to 2 years and a fine.</p>\n<p><strong>Offences affecting life</strong></p>\n<table style=\"width: 338px;\">\n<tbody>\n<tr>\n<td style=\"width: 57.1px; text-align: center;\">\n<p><strong>IPC section</strong></p>\n</td>\n<td style=\"width: 30.4167px; text-align: center;\">\n<p><strong>BNS section<br /></strong></p>\n</td>\n<td style=\"width: 208.083px; text-align: center;\">\n<p><strong>Section it deals with</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>299</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>100</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Culpable homicide</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>300</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>101</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Murder (culpable homicide not amounting to murder is also explained under this section)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>301</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>102</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Culpable homicide by causing the death of a person\u00a0other than the person whose death was intended</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>302</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>103</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Punishment for murder</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>303</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>104</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Punishment for murder by life convict (compulsory death sentence)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>304</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>105</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Punishment for culpable homicide not amounting to murder</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p><strong>304A</strong></p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p><strong>106<br /></strong></p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Causing death by negligence</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>304B</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>80</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Dowry death</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>305</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>107</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Abetment of suicide of child or insane person</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>306</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>108</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Abetment of suicide\u2014If any person commits suicide, whoever abets the commission of such suicide, shall be punished with imprisonment of either description for a term which may extend to ten years, and shall also be liable to fine.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 57.1px;\">\n<p>307</p>\n</td>\n<td style=\"width: 30.4167px;\">\n<p>109</p>\n</td>\n<td style=\"width: 208.083px;\">\n<p>Attempt to Murder</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Detection of products of dead cells by inflammasome induces secretion of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "IL-4"
      },
      {
        "id": 2,
        "text": "IL-3"
      },
      {
        "id": 3,
        "text": "IL-2"
      },
      {
        "id": 4,
        "text": "IL-1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Detection of products of dead cells by inflammasome induces secretion of interleukin-1 (IL-1).</p>\n<p>Cytoplasmic innate immune receptors recognize <strong>microbial products</strong> that entered the infected cells and activate the multiprotein complex called the <strong>inflammasome</strong>. Inflammasome activates <strong>caspase 1</strong> and helps in the release of the biologically activated forms of <strong>IL-1</strong>.\u00a0Along with caspase 1, caspases 4 and 5 also induce cell death. Unlike classical apoptosis, pyroptosis is characterized by the release of inflammatory mediators.\u00a0</p>\n<p><strong>Apoptosis</strong>: The intrinsic mitochondrial and extrinsic death receptor-initiated pathways converge to activate a caspase cascade that mediates the final phase of apoptosis. The <strong>intrinsic pathway </strong>activates<strong> caspase 9</strong>, whereas the <strong>extrinsic pathway</strong> activates <strong>caspases 8 </strong>and<strong> 10</strong>. These caspases then activate<strong>\u00a0caspase 3\u00a0</strong>and<strong> caspase 6</strong>.\u00a0Activated caspases cause DNA degradation and nuclei fragmentation.</p>\n<p><strong>Ferroptosis</strong> is an <strong>iron-dependent</strong> distinct pathway of <strong>cell death</strong> induced<strong> by</strong> <strong>lipid peroxidation</strong>. The widespread peroxidation disrupts membrane function, which leads to the loss of plasma membrane permeability and results in cell death resembling necrosis.\u00a0</p>\n<p><strong>Necroptosis</strong>, as the name suggests, has features similar to necrosis and apoptosis. Like necrosis,\u00a0it is characterized by loss of ATP, cellular and organelle swelling, the release of lysosomal enzymes, and rupture of the plasma membrane. However, like apoptosis, this is programmed cell death. Ligation of <strong>TNFR1</strong> initiates necroptosis. This is a <strong>caspase-independent</strong> programmed cell death.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1d5db45c941e48e1bbc30d25455b7e08x680x599.PNG"
    ]
  },
  {
    "text": "What is the qSOFA score in a patient whose examination findings are as shown below?",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p2\"><span class=\"s3\">qSOFA score for this patient would be 3.\u00a0</span><span class=\"s3\">Only 3 parameters are considered for its calculation, and the respective scores are as follows:</span></p>\n<ul>\n<li class=\"p2\"><span class=\"s3\">BP: 96/62 mmHg\u00a0\u2192 Low blood pressure (SBP \u2264100 mmHg) \u2192 Score 1</span></li>\n<li class=\"p2\"><span class=\"s3\">Respiratory rate: 26 breaths/min\u00a0\u2192 High (\u226522 breaths/min) \u2192 Score 1</span></li>\n<li class=\"p2\"><span class=\"s3\">Glasgow Coma Scale (GCS) score: 13/15\u00a0\u2192 Altered mentation (GCS score, &lt;15) \u2192 Score 1</span></li>\n</ul>\n<p class=\"p2\"><strong>qSOFA</strong>\u00a0score (quickSOFA) is a bedside prompt that may identify patients with suspected infection who are at greater risk for a poor outcome outside the intensive care unit (ICU). It uses three criteria, assigning one point each for</p>\n<ul>\n<li>low blood pressure (SBP\u2264100 mmHg),</li>\n<li>high respiratory rate (\u226522 breaths/min)</li>\n<li>altered mentation (Glasgow Coma Scale score, &lt;15).</li>\n</ul>\n<p>The score ranges from 0 to 3 points. The presence of 2 or more qSOFA points is a simple prompt to identify infected patients outside the ICU who are likely to develop sepsis. This is a simplified derivative of SOFA score. The primary method to evaluate the risk of organ dysfunction (sepsis) in patients with suspected infection is by determining the \u00a0<strong>Sequential</strong>\u00a0(<strong>sepsis-related) organ failure assessment (SOFA) score</strong>; which includes assessment of:</p>\n<ul>\n<li>Circulation - Systolic BP &amp; need for vasopressors; platelet count</li>\n<li>Respiration - PaO<sub>2</sub>/FiO<sub>2</sub> &amp; need for mechanical ventilation</li>\n<li>Mentation - Glasgow Coma Scale score\u00a0</li>\n<li>Hepatic function - Bilirubin level</li>\n<li>Renal function - Creatinine level</li>\n</ul>\n<p><strong>Organ dysfunction</strong>\u00a0is defined by a\u00a0<strong>SOFA score of\u00a0\u22652</strong>.</p>\n<p>The SOFA score is limited by its requirement of multiple laboratory tests which makes it complex and time-consuming. In order to simplify the scoring process, the \"Sepsis - 3\" task force recommended the<strong>\u00a0quick sepsis-related organ dysfunction assessment \"qSOFA\" score</strong>.</p>\n<p><strong>SOFA vs. qSOFA:</strong></p>\n<ul>\n<li><strong>SOFA</strong>\u00a0is a more comprehensive and accurate scoring system, which is\u00a0<strong>particulary superior to\u00a0qSOFA in the ICU setting.</strong>\u00a0</li>\n<li><strong>qSOFA</strong>\u00a0is a simplified derivative of SOFA for bedside assessment of individuals at risk for sepsis\u00a0<strong>particularly useful outside the ICU. setting\u00a0</strong>(i.e. ward / emergency department). However, note that it was originally designed as predictive tool that calculates the risk of death from sepsis rather than a diagnostic tool.</li>\n</ul>\n<p>Thereby, the best description of sepsis based on \"Sepsis -3\" task force recommendations would be as follows:</p>\n<ul>\n<li>Suspected or documented infection with SOFA score of \u22652\u00a0\u00a0<strong>Or</strong></li>\n<li>Suspected or documented infection with qSOFA score of \u22652</li>\n</ul>\n<p>Another score that has been used is the National Early Warning Score (NEWS). It ranges from 0 to 20 and is based on respiratory rate, oxygen saturation, use of supplemental O<sub>2</sub>, temperature, systolic blood pressure, pulse rate, and level of consciousness.\u00a0\u22655 out of 20 is considered a positive score.\u00a0</p>\n<p><span class=\"s3\">Other scoring systems for sepsis:</span></p>\n<p class=\"p2\"><span class=\"s3\">The </span><span class=\"s4\">Systemic Inflammatory Response Syndrome (<strong>SIRS</strong>)</span><span class=\"s3\"> score is no longer recommended as is it <strong>not specific to infection.</strong></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is brought to a pediatrician for a regular check-up. He observed that the child could run stiffly, crawl up or downstairs, scribble, and build a tower of 3 blocks. What could be the possible age of the child?",
    "choices": [
      {
        "id": 1,
        "text": "18 months"
      },
      {
        "id": 2,
        "text": "24 months"
      },
      {
        "id": 3,
        "text": "12 months"
      },
      {
        "id": 4,
        "text": "30 months"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The child is possibly <strong>18 months old</strong>.</p>\n<p>At age 18 months, the child the milestones attained by the child are:</p>\n<ul>\n<li>Motor:\n<ul>\n<li>Run</li>\n<li>Crawl up and downstairs</li>\n<li>Explore drawers and wastebasket</li>\n</ul>\n</li>\n<li>Adaptive:\n<ul>\n<li>Make a tower of 3-4 blocks</li>\n<li>Can scribble</li>\n</ul>\n</li>\n<li>Language:\n<ul>\n<li>Name pictures</li>\n<li>Identify 1 or more parts of the body</li>\n<li>A vocabulary of around 10 words</li>\n</ul>\n</li>\n<li>Social:\n<ul>\n<li>Feed themselves</li>\n<li>Seek help when in trouble</li>\n<li>May complain when wet or soiled</li>\n</ul>\n</li>\n</ul>\n<p>Other options:</p>\n<p>Option B- At <strong>24 months of age</strong>, the child can <strong>run well</strong>, <strong>walk up and down the stairs</strong> one step at a time, jump. He would be able to build a tower of <strong>6-7 cubes</strong> and make circular strokes. He can make 3-word sentences.\u00a0</p>\n<p>Option C- At <strong>12 months</strong>, the child <strong>walks</strong> with one hand-held, has a mature <strong>pincer grasp</strong>, and can say 1-2 words with meaning. He may be able to play a <strong>simple ball game</strong>.</p>\n<p>Option D- At <strong>30 months</strong>, the child can <strong>climb stairs with alternating feet</strong>, and build a tower of <strong>9 cubes</strong>. He can copy a <strong>circle</strong>. He knows his full name, and refers to himself as \"I\".\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following pharyngeal arches gives rise to paired hyaline laryngeal cartilage?",
    "choices": [
      {
        "id": 1,
        "text": "1st arch"
      },
      {
        "id": 2,
        "text": "4th arch"
      },
      {
        "id": 3,
        "text": "6th arch"
      },
      {
        "id": 4,
        "text": "3rd arch"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The 6th pharyngeal arch gives rise to the arytenoid cartilage which is a hyaline type of paired laryngeal cartilage.\u00a0</p>\n<p>The laryngeal cavity consists of <strong>6 cartilages,</strong> which are classified into two types: <strong>paired </strong>and <strong>unpaired.</strong> The <strong>paired</strong> cartilages include <strong>arytenoid, corniculate and cuneiform.</strong> Among these, <strong>only arytenoid is the hyaline type,</strong> while corniculate and cuneiform are the elastic types.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "At what age of gestation is an amniocentesis generally done?",
    "choices": [
      {
        "id": 1,
        "text": "Before 12 weeks of gestation"
      },
      {
        "id": 2,
        "text": "15-20 weeks of gestation"
      },
      {
        "id": 3,
        "text": "Before 16 weeks of gestation"
      },
      {
        "id": 4,
        "text": "20-24 weeks of gestation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>The best time</strong> for performing amniocentesis is\u00a0<strong>15-20 weeks of gestation</strong></p>\n<p style=\"text-align: left;\"><strong>Amniocentesis </strong>is the <strong>most common</strong> prenatal diagnostic procedure. It\u00a0is performed using an\u00a0<strong>aseptic technique, </strong>under direct<strong> sonographic guidance</strong>, using a <strong>20\u201322 gauge spinal needle</strong>. The needle is directed perpendicularly into a clear pocket of amniotic fluid while avoiding the fetus and umbilical cord. Sonography is used to observe the uterine puncture site for bleeding and fetal cardiac motion is documented at the end of the procedure. Approximately <strong>20 to 30 mL</strong> <strong>of fluid</strong> is collected for <strong>fetal karyotyping</strong> or chromosomal microarray analysis.\u00a0</p>\n<table style=\"height: 550px; width: 426.734375px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 166px; text-align: center;\">\n<p>Study material</p>\n</td>\n<td style=\"width: 247.734375px; text-align: center;\">\n<p>Amniotic fluid with amniocytes</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 166px; text-align: center;\">\n<p>Time</p>\n</td>\n<td style=\"width: 247.734375px; text-align: center;\">\n<p><strong>15-20 weeks</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 166px; text-align: center;\">\n<p>Early amniocentesis</p>\n</td>\n<td style=\"width: 247.734375px; text-align: center;\">\n<p>11-14 weeks (associated with increased fetal loss, foot deformities)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 166px; text-align: center;\">\n<p>Indications</p>\n</td>\n<td style=\"width: 247.734375px; text-align: center;\">\n<ul>\n<li>Congenital infections</li>\n<li><strong>Fetal genetic disorders</strong></li>\n<li>Alloimmunization</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 166px; text-align: center;\">Complications</td>\n<td style=\"width: 247.734375px; text-align: center;\">\n<ul>\n<li>Fetal loss</li>\n<li>Amniotic fluid leakage</li>\n<li>Transvaginal spotting</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Below is an image showing the procedure of amniocentesis vs chorionic villus sampling.</p>\n<p>Note:</p>\n<p>Amniocentesis is generally done between 15-20 weeks but may be performed at any point later in gestation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b254bbad07f04e35bfd9db5d9c9acdecx1280x3002.JPEG"
    ]
  }
];
        let quizName = 'Numbers Mini Test';
        const quizFilename = 'numbers-mini-test-783fcc0e.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>