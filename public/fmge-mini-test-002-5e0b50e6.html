<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 002 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 36-year-old man presented with complaints of bluish-black discolouration of sclera and pinna for last 6 months. Since childhood, his urine turns black on standing as shown in the image below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylketonuria"
      },
      {
        "id": 2,
        "text": "Alkaptonuria"
      },
      {
        "id": 3,
        "text": "Tyrosinemia"
      },
      {
        "id": 4,
        "text": "Maple syrup urine disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Blackening</strong> <strong>of urine</strong> on standing is characteristic of <strong>alkaptonuria</strong>&nbsp;and results due to excretion of <strong>homogentisic acid</strong> in the urine.</p>\n<p>It is an autosomal recessive condition due to <strong>deficiency</strong> of <strong>homogentisate oxidase&nbsp;</strong>(also called<strong>&nbsp;</strong>homogentisate 1,2-dioxygenase).</p>\n<p>The homogentisic acid is then oxidized to benzoquinone acetate and polymerized to form <strong>black-coloured alkapton bodies</strong>, which deposits in soft tissues like cartilage and is called as <strong>ochronosis.</strong></p>\n<p>Image A - Normal urine<br />Image B - Alkaptonuria</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ecedf333418b4067a6b50a5964a85aa7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c4298c90589b42caa94eb67da6696ea0x1280x950.JPEG"
    ]
  },
  {
    "text": "Which of the following is used to estimate the visual field?",
    "choices": [
      {
        "id": 1,
        "text": "Confrontation method"
      },
      {
        "id": 2,
        "text": "Campimetry"
      },
      {
        "id": 3,
        "text": "Octopus Fieldmaster"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>All the options are used to estimate the visual field.</li>\n<li><strong>Types:</strong>\n<ul>\n<li>Manual perimetry:<strong>&nbsp;Confrontation method, Lister&rsquo;s perimeter, Campimetry (Scotometry), Goldmann&rsquo;s perimeter</strong></li>\n<li>Automated perimetry:<strong>&nbsp;Octopus Fieldmaster, Humphrey Field Analyzer</strong></li>\n</ul>\n</li>\n</ul>\n<p>The image given below shows Lister's perimeter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d3425a4c368461f87164bdd477f4ca8x1280x1707.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c84e667bdbd48ac909f1b4dc06226e9x500x390.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cddd387ab1e84a9f9be9829352d3c7abx311x244.JPEG"
    ]
  },
  {
    "text": "The police hands over the body of a person who died due to hanging to you for an autopsy. Which of the following incisions is preferred in this case?",
    "choices": [
      {
        "id": 1,
        "text": "I shaped incision"
      },
      {
        "id": 2,
        "text": "Modified Y shaped incision"
      },
      {
        "id": 3,
        "text": "Y shaped incision"
      },
      {
        "id": 4,
        "text": "Elongated X shaped incision"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;<strong>incision</strong>&nbsp;preferred in the case of&nbsp;<strong>asphyxial death</strong>&nbsp;due to&nbsp;<strong>neck compression</strong>&nbsp;(as in hanging) is the<strong>&nbsp;modified Y-shaped incision.</strong></p>\n<p>In strangulation, hanging, and any condition where the<strong>&nbsp;larynx&nbsp;</strong>might be&nbsp;<strong>damaged</strong>, a<strong>&nbsp;modified Y-shaped</strong>&nbsp;incision is to be preferred. This incision is used because the skin of the upper neck can then be dissected off the mandible and raised to give a wide approach to the neck structures.</p>\n<p>Given below are types of incisions done for an autopsy:</p>\n<p><strong>Y-Shaped Incision</strong>: Commences at the&nbsp;<strong>acromial process&nbsp;</strong>on the shoulder on either side. It runs downwards and anteriorly&nbsp;<strong>beneath the breasts</strong>&nbsp;as to meet at the xiphisternum in the midline. It then runs downwards as in an I-shaped incision to the symphysis pubis. It is&nbsp;<strong>preferred in females</strong>. It is more cosmetically accepted as the incision and the stitches are minimally seen after the autopsy. </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7936d1aa390e490eba8aef0d06673327x1280x1461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1efd6e6fdf7446749707ff0986981e4ax1280x1461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a62432d2a6a64ea69b99385be4431ae1x1280x1462.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b668e16807649d781f2c0a359e71723x1280x1462.JPEG"
    ]
  },
  {
    "text": "A pregnant woman complained of excessive vomiting and mild vaginal bleeding for 2 weeks at a period of gestation of 14 weeks. On examination, fundal height corresponds to 16 weeks and fetal heart sound is absent.  USG shows the presence of a snowstorm appearance. What is the management____",
    "choices": [
      {
        "id": 1,
        "text": "Chemotherapy"
      },
      {
        "id": 2,
        "text": "Hysterectomy"
      },
      {
        "id": 3,
        "text": "Suction and evacuation/curettage"
      },
      {
        "id": 4,
        "text": "Hysterotomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>molar pregnancy</strong> and regardless of uterine size, molar evacuation by <strong>suction and curettage</strong> is usually the preferred treatment.&nbsp;</p>\n<p>With large moles, adequate anesthesia, sufficient intravenous access, and blood-banking support are imperative.</p>\n<p><strong>Intraoperative sonography</strong> is recommended to help ensure that the <strong>uterine cavity has been emptied</strong>.</p>\n<p>Indication for hysterectomy in molar pregnancy:</p>\n<ul>\n<li>Preferred for women who have completed their family.</li>\n<li>In women &gt;40 years, who are at high risk for GTN.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the principle behind the wound healing procedure shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Negative pressure wound therapy"
      },
      {
        "id": 2,
        "text": "Positive pressure wound therapy"
      },
      {
        "id": 3,
        "text": "Foam therapy"
      },
      {
        "id": 4,
        "text": "Sponge therapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The principal behind the wound healing procedure, as shown above, is <strong>negative pressure wound therapy.</strong></p>\n<p>Applying intermittent negative pressure of approximately -125 mmHg appears to hasten debridement and the formation of granulation tissue in chronic wounds and ulcers.</p>\n<p>The negative pressure may act by decreasing oedema, by removing interstitial fluid and by increasing blood flow.&nbsp;As a result, bacterial counts decrease and cell proliferation increases, thereby creating a suitable bed for graft or flap cover.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5755f4d7052f40ee8599ab7d715a8fdc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Immunization is ____.",
    "choices": [
      {
        "id": 1,
        "text": "Primordial prevention"
      },
      {
        "id": 2,
        "text": "Primary prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Immunization</strong> is a form of<strong> primary prevention,</strong> through <strong>specific protection</strong>.</p>\n<ul>\n<li>Primary prevention is <strong>action taken prior</strong> to the onset of disease, which removes the possibility that disease will ever occur.</li>\n<li><strong>Population strategy and high risk strategy </strong>are used as part of primary prevention.</li>\n<li><strong>Examples:</strong>&nbsp;Immunization, sanitation, and protection of food.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Dutcher bodies are seen in_____.",
    "choices": [
      {
        "id": 1,
        "text": "CML"
      },
      {
        "id": 2,
        "text": "AML"
      },
      {
        "id": 3,
        "text": "Multiple Myeloma"
      },
      {
        "id": 4,
        "text": "Hodgkin lymphoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Dutcher bodies are pale-staining intranuclear inclusions within plasma cells containing Ig, which are more common in IgA myeloma.</p>\n<ul>\n<li><strong>Russell bodies</strong>: Hyaline intracytoplasmic inclusions containing Ig.</li>\n<li><strong>Mott cells/morula cells</strong>: Plasma cells containing multiple grape-like cytoplasmic inclusions comprised of Ig</li>\n<li><strong>Flame cells</strong>: Vermillion-staining, glycogen-rich IgA in cytoplasmic projections</li>\n<li><strong>Thesaurocytes</strong>: Dilated endoplasmic reticulum cisternae</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/6649bdfd86a64c3f9b04adec3b196063x387x272.PNG"
    ]
  },
  {
    "text": "Cough on scratching the external acoustic canal is due to?",
    "choices": [
      {
        "id": 1,
        "text": "Auriculotemporal nerve"
      },
      {
        "id": 2,
        "text": "Auricular branch of vagus"
      },
      {
        "id": 3,
        "text": "Great auricular nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Cough on scratching the external acoustic canal is due to the&nbsp;<strong>auricular branch of the vagus nerve</strong> (also called <strong>Arnold's</strong>&nbsp;<strong>nerve</strong>).</p>\n<p>Ear-cough reflex (Otorespiratory reflex):<strong>&nbsp;</strong>The Arnold's nerve innervates the skin over a small part of the ear and external auditory canal. In patients with chronic cough, scratching or mechanical stimulation of ear leads to activation of Arnold's nerve, which evokes reflex cough.</p>\n<table style=\"height: 472px;\" width=\"703\">\n<tbody>\n<tr style=\"height: 24px;\">\n<td style=\"width: 232.023px; height: 24px;\"><strong>Causes</strong> <strong>of</strong> <strong>referred otalgia</strong></td>\n<td style=\"width: 233.656px; height: 24px;\"><strong>Nerve</strong> <strong>responsible</strong></td>\n<td style=\"width: 215.32px; height: 24px;\"><strong>Site</strong></td>\n</tr>\n<tr style=\"height: 95px;\">\n<td style=\"width: 232.023px; height: 95px;\">Temporomandibular joint and dental conditions, parotid infections/tumor, and anterior 2/3rd of tongue</td>\n<td style=\"width: 233.656px; height: 95px;\">Auriculotemporal nerve</td>\n<td style=\"width: 215.32px; height: 95px;\">Tragal area, crus of the helix, and&nbsp;anterior wall and roof of the external auditory canal.&nbsp;</td>\n</tr>\n<tr style=\"height: 95px;\">\n<td style=\"width: 232.023px; height: 95px;\">Acute tonsillitis, peritonsillar abscess, carcinoma base of the tongue or tonsils (oropharynx)</td>\n<td style=\"width: 233.656px; height: 95px;\">The glossopharyngeal nerve (Jacobson's)</td>\n<td style=\"width: 215.32px; height: 95px;\">Medial surface of the tympanic membrane, and middle ear</td>\n</tr>\n<tr style=\"height: 71px;\">\n<td style=\"width: 232.023px; height: 71px;\">Carcinoma of the larynx (cough), hypopharynx, epiglottis, vallecula, esophagus, and thyroid</td>\n<td style=\"width: 233.656px; height: 71px;\">Auricular branch of the vagus nerve (Arnold's/Alderman's nerve)</td>\n<td style=\"width: 215.32px; height: 71px;\">Concha,&nbsp;posterior wall, and floor of the external auditory canal</td>\n</tr>\n<tr style=\"height: 48px;\">\n<td style=\"width: 232.023px; height: 48px;\">Cervical spondylitis</td>\n<td style=\"width: 233.656px; height: 48px;\">Great auricular nerve (C2,3)</td>\n<td style=\"width: 215.32px; height: 48px;\">Lateral and medial surfaces of the pinna</td>\n</tr>\n<tr style=\"height: 71px;\">\n<td style=\"width: 232.023px; height: 71px;\">Acoustic neuroma</td>\n<td style=\"width: 233.656px; height: 71px;\">Facial nerve (nervus intermedius/nerve of Wrisberg)</td>\n<td style=\"width: 215.32px; height: 71px;\">\n<p>Concha, retro auricular groove, and posterosuperior part of the external auditory meatus.&nbsp;Numbness in the posterosuperior meatal wall known as&nbsp;Hitzelberger's sign, is seen in acoustic neuroma.</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following image shows a deformity as a result of a fracture. It is associated with________",
    "choices": [
      {
        "id": 1,
        "text": "Loss of thumb opposition"
      },
      {
        "id": 2,
        "text": "Anesthesia over tip of little finger"
      },
      {
        "id": 3,
        "text": "Anesthesia over the thumb"
      },
      {
        "id": 4,
        "text": "Wrist drop"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The deformity shown in the image above is <strong>cubitus valgus </strong>on the left side. It can&nbsp;affect the <strong>ulnar nerve</strong> leading to <strong>anaesthesia</strong> at the tip of the<strong> little finger.&nbsp;</strong></p>\n<p><strong>Cubitus valgus&nbsp;</strong>is a late complication of <strong>non-union</strong> of <strong>fracture of</strong>&nbsp;<strong>lateral condyle of the humerus.</strong>&nbsp; It can lead to late-onset ulnar palsy also called&nbsp;<strong>tardy ulnar nerve palsy</strong>. This can cause anesthesia at the tip of the little finger, which is the zone of autonomous supply of ulnar nerve.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/99f6085bd317408e94f702c9365c8373.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Investigation of choice for acute pancreatitis is_______",
    "choices": [
      {
        "id": 1,
        "text": "Plain X-ray abdomen"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "USG"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Contrast-enhanced CT scan</strong> is the <strong>investigation of choice</strong>.</li>\n<li>The <strong>optimal time</strong> for performing CECT is <strong>more\u00a0than 72 h after the onset of symptoms\u00a0</strong>(In the first 72 hours, CT may underestimate the extent of necrosis).</li>\n</ul>\n<p>Acute pancreatitis is a condition characterized by inflammatory damage to the pancreas. Various causes of acute pancreatitis are:</p>\n<ul>\n<li aria-level=\"1\"><strong>Gall stone induced</strong>\u00a0(most common cause)</li>\n<li aria-level=\"1\"><strong>Alcohol</strong>\u00a0(2nd most common cause)</li>\n<li aria-level=\"1\"><strong>Trauma</strong>\u00a0(most common cause in children)</li>\n<li aria-level=\"1\">Iatrogenic- Post endoscopic retrograde cholangiopancreatography\u00a0(ERCP)</li>\n<li aria-level=\"1\">Drug-induced pancreatitis (Thiazides, Azathioprine, Anti-cancer drugs, etc)</li>\n<li aria-level=\"1\">Hypertriglyceridemia</li>\n<li aria-level=\"1\">Hypercalcemia</li>\n<li aria-level=\"1\">Scorpion bite</li>\n<li aria-level=\"1\">Idiopathic</li>\n</ul>\n<p>Clinical presentation of acute pancreatitis is characterized by\u00a0<strong>epigastric pain radiating</strong>\u00a0to the\u00a0<strong>back</strong>\u00a0which is<strong>\u00a0relieved by bending forward</strong>, nausea, and vomiting. Acute hemorrhagic pancreatitis can present with certain named signs like:</p>\n<ul>\n<li aria-level=\"1\"><strong>Cullen\u2019s sign</strong>: Discoloration around the umbilicus</li>\n<li aria-level=\"1\"><strong>Grey Turner\u2019s sign</strong>: Discoloration in the flanks</li>\n<li aria-level=\"1\"><strong>Fox sign</strong>: Discoloration in the inguinal region</li>\n<li aria-level=\"1\"><strong>Bryant\u2019s sign</strong>: Discoloration on the scrotum</li>\n</ul>\n<p>Blood investigations show\u00a0<strong>increased serum amylase\u00a0</strong>and<strong>\u00a0lipase levels</strong>. Serum lipase is more sensitive and specific than serum amylase but it rises late. Contrast-enhanced computed tomography (<strong>CECT</strong>) is the investigation of choice. Various scoring systems are used to grade the severity of acute pancreatitis based on blood investigations and radiographic findings.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with vomiting to medicine OPD. He has a history of eating fried rice. What is the most likely organism causing this?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium perfringens"
      },
      {
        "id": 2,
        "text": "Bacillus cereus"
      },
      {
        "id": 3,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 4,
        "text": "Bacillus anthracis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Food poisoning&nbsp;after eating fried rice is due to<strong>&nbsp;Bacillus cereus.</strong></p>\n<p>Food poisoning caused by&nbsp;<em>B. cereus</em>&nbsp;is of&nbsp;<strong>two types</strong>:</p>\n<table width=\"305\">\n<tbody>\n<tr>\n<td><em>Bacillus cereus</em></td>\n<td><strong>Diarrheal type</strong></td>\n<td>Emetic type</td>\n</tr>\n<tr>\n<td>Incubation period</td>\n<td><strong>8-16 hours</strong></td>\n<td>1-5 hours</td>\n</tr>\n<tr>\n<td>Toxin</td>\n<td>Secreted in intestine</td>\n<td>Preformed</td>\n</tr>\n<tr>\n<td>Heat</td>\n<td>Heat labile</td>\n<td>Heat stable</td>\n</tr>\n<tr>\n<td>Food items</td>\n<td>Meat</td>\n<td>Rice</td>\n</tr>\n<tr>\n<td>Clinical feature</td>\n<td>Diarrhea, abdominal cramps</td>\n<td>Vomiting, abdominal cramps</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cranial nerves is a pure sensory nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Olfactory"
      },
      {
        "id": 2,
        "text": "Trochlear"
      },
      {
        "id": 3,
        "text": "Trigeminal"
      },
      {
        "id": 4,
        "text": "Abducent"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>olfactory</strong> nerve is a <strong>pure sensory nerve</strong>. It carries no motor fibers.</p>\n<ul>\n<li>Olfactory: Sensory</li>\n<li>Optic: Sensory</li>\n<li>Oculomotor: Motor</li>\n<li>Trochlear: Motor</li>\n<li>Trigeminal: Both&nbsp;</li>\n<li>Abducent: Motor</li>\n<li>Facial: Both</li>\n<li>Vestibulocochlear: Sensory</li>\n<li>Glossopharyngeal: Both</li>\n<li>Vagus: Both</li>\n<li>Accessory: Motor</li>\n<li>Hypoglossal: Motor</li>\n</ul>\n<p>\"Both\" stands for a mixed nerve (both motor and sensory).</p>\n<p>Mnemonic: <strong>S</strong>ome <strong>S</strong>ay <strong>M</strong>arry <strong>M</strong>oney <strong>B</strong>ut <strong>M</strong>y <strong>B</strong>rother <strong>S</strong>ays <strong>B</strong>ig <strong>B</strong>rain <strong>M</strong>atters <strong>M</strong>ore.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presented to the OPD with a history of fever for the past 5 days. On examination, tender lesions were found in his extremities as marked below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Snake bite"
      },
      {
        "id": 2,
        "text": "Infective endocarditis"
      },
      {
        "id": 3,
        "text": "Cat scratch disease"
      },
      {
        "id": 4,
        "text": "Rocky Mountain Spotted Fever"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most probable diagnosis for this patient would be <strong>infective endocarditis</strong>.</p>\n<p><strong>Tender</strong> <strong>violaceous subcutaneous nodules</strong> in the fingers shown in the image are <strong>Osler nodes</strong>. They usually occur in the pads of fingers and toes but can also occur on the thenar and hypothenar eminences.</p>\n<p>Other lesions that are highly suggestive of infective endocarditis include:</p>\n<ul>\n<li><strong>Roth spots</strong>: These are&nbsp;are exudative, edematous <strong>hemorrhagic lesions of the retina</strong> with pale centres.</li>\n<li><strong>Janeway lesions:</strong>&nbsp;They are <strong>nontender, slightly raised haemorrhages</strong> on the palms and soles.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c8b97e1828f467d84249ab1b8ef3c83.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1cad717c18d34dc19aa657b5a2c344a3x720x526.JPEG"
    ]
  },
  {
    "text": "Which of the following compounds are used in PET scan?",
    "choices": [
      {
        "id": 1,
        "text": "Fluorodeoxyglucose"
      },
      {
        "id": 2,
        "text": "Technetium"
      },
      {
        "id": 3,
        "text": "Chromium"
      },
      {
        "id": 4,
        "text": "Cobalt"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>PET involves the use of a radiolabelled bio compound - 2-fluoro-2-deoxy-D-glucose (FDG) which is injected intravenously. It is based on the principle that tumour cells have a <strong>high metabolic rate.</strong>&nbsp;FDG is metabolised to FDG-6-phosphate which cannot be further metabolised by tumour cells, and hence it <strong>accumulates and concentrates in tumour cells.&nbsp;</strong>This <strong>accumulation is detected and quantified.</strong></p>\n<p><strong>Applications of PET :-</strong></p>\n<p>Oncologic:</p>\n<ul>\n<li>Detection, staging, drug response</li>\n<li>Differentiation between radiation necrosis and recurrence</li>\n</ul>\n<p>&nbsp;Neurologic:</p>\n<ul>\n<li>Early diagnosis of Alzheimer's disease</li>\n<li>Localisation of seizure focus in interictal phase</li>\n<li>Localising eloquent areas (e.g. speech, motor function)</li>\n</ul>\n<p>Cardiac: Identification of hibernating myocardium</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old infertile male underwent semen analysis. \nResults show: sperm concentration - 16 million/ml: pH- 7.5: volume - 2 mL: no agglutination is seen. \nMorphology shows 60% normal and 60% motile sperms. The most likely diagnosis is ______",
    "choices": [
      {
        "id": 1,
        "text": "Oligospermia"
      },
      {
        "id": 2,
        "text": "Normospermia"
      },
      {
        "id": 3,
        "text": "Azoospermia"
      },
      {
        "id": 4,
        "text": "Aspermia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This male with sperm concentration&nbsp;<strong>16 million/mL is considered to be normospermia</strong>.</p>\n<p><strong>According to the WHO 2010 criteria for semen analysis, the lower reference limit for normal sperm concentration is 15 million/mL</strong>.</p>\n<p>Oligospermia is defined as a sperm concentration &lt;15 million/mL, and counts &lt;5 million/mL are considered severe.</p>\n<p>Latest WHO standard for semen analysis - 2021:</p>\n<table>\n<tbody>\n<tr>\n<td>Semen analysis</td>\n<td>Normal reference value</td>\n</tr>\n<tr>\n<td>Semen volume&nbsp;</td>\n<td>&gt;1.5 mL</td>\n</tr>\n<tr>\n<td>Sperm concentration</td>\n<td>15 million/mL</td>\n</tr>\n<tr>\n<td>pH</td>\n<td>&gt;7.2</td>\n</tr>\n<tr>\n<td>Total sperm number&nbsp;</td>\n<td>&gt;39 million/ejaculate</td>\n</tr>\n<tr>\n<td>Total motility&nbsp;</td>\n<td>&gt;40%</td>\n</tr>\n<tr>\n<td>Progressive motility&nbsp;</td>\n<td>&gt;32%</td>\n</tr>\n<tr>\n<td>Vitality&nbsp;</td>\n<td>&gt;58% live sperm</td>\n</tr>\n<tr>\n<td>Normal forms&nbsp;</td>\n<td>&nbsp;&gt;4%</td>\n</tr>\n<tr>\n<td>Agglutination</td>\n<td>Particles &lt;2</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the incorrect statement regarding the condition shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "The most common site is axilla"
      },
      {
        "id": 2,
        "text": "TNF alpha inhibitors like adalimumab can be used in treatment"
      },
      {
        "id": 3,
        "text": "Obesity and smoking are the 2 main factors associated with it"
      },
      {
        "id": 4,
        "text": "Surgery cannot be done for this condition."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows <strong>hidradenitis supurativa or inverse acne</strong>. Surgical excision is the <strong>best treatment</strong> that offers a cure for the patient.</p>\n<ul>\n<li>Hidradenitis suppurativa is a chronic, inflammatory, recurrent, debilitating, follicular disease that usually presents after puberty.</li>\n<li>There are <strong>painful, deep\u2010seated inflamed</strong> lesions in the <strong>apocrine gland\u2010bearing areas</strong> of the body, <strong>most commonly the axillary</strong>, inguinal and ano\u2010genital regions.</li>\n<li>The following three criteria must be met for the diagnosis to be made:\n<ol>\n<li><strong>Typical lesions</strong>, that is deep\u2010seated, painful nodules: &lsquo;blind boils&rsquo; in early lesions; abscesses, <strong>draining sinuses</strong>, <strong>bridged scars</strong> and paired or multiheaded open pseudocomedones in secondary lesions.</li>\n<li><strong>Typical topography:</strong> axillae, groin, perineal and perianal region, buttocks and infra\u2010 and intermammary folds.</li>\n<li><strong>Chronicity and recurrence</strong> of lesions.</li>\n</ol>\n</li>\n<li><strong>Obesity and smoking</strong> are the two main factors associated with hidradenitis suppurativa.</li>\n</ul>\n<p><strong>Treatment</strong> includes&nbsp;</p>\n<ul>\n<li>Antibiotics like Tetracycline, clindamycin</li>\n<li>Intralesional corticosteroids</li>\n<li>Immunosuppresants</li>\n<li>Acitretin</li>\n<li>Anti TNF alpha therapy</li>\n<li>Surgery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43d3fa7e9f924eb5bb3a6fb59835b0db.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male patient presented to the casualty department with bradykinesia, rigidity, and tremors. His attender reported that he had been diagnosed with schizophrenia and had recently started treatment. What is the drug of choice to treat the patient's presenting symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Levodopa"
      },
      {
        "id": 2,
        "text": "Benzhexol"
      },
      {
        "id": 3,
        "text": "Amantidine"
      },
      {
        "id": 4,
        "text": "Selegilline"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of<strong>&nbsp;</strong><strong>drug-induced parkinsonism,</strong>&nbsp;for which the drug of choice<strong>&nbsp;</strong>is<strong>&nbsp;benzhexol,&nbsp;</strong>also known as&nbsp;<strong>trihexiphenidyl</strong>.&nbsp;</p>\n<p>Benzhexol is an <strong>antimuscarinic agent</strong>. Drug-induced parkinsonism is a condition that is caused by certain drugs that have <strong>D<sub>2</sub> antagonistic action</strong> like <strong>typical antipsychotics</strong>. Due to the decrease in dopaminergic activity, they result in an unbalanced cholinergic activity. Benzhexol acts by restoring the balance of the cholinergics in the striatal interneurons.</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll answer-html ng-star-inserted\">\n<p>The following drugs are implicated in drug-induced parkinsonism:</p>\n<table width=\"308\">\n<tbody>\n<tr>\n<td><strong>Drug class</strong></td>\n<td>\n<p><strong>Examples&nbsp;</strong></p>\n</td>\n</tr>\n<tr>\n<td><strong>Typical antipsychotics</strong></td>\n<td>\n<p>Phenothiazines, haloperidol</p>\n</td>\n</tr>\n<tr>\n<td><strong>Atypical antipsychotics</strong></td>\n<td>Risperidone, olanzapine</td>\n</tr>\n<tr>\n<td><strong>Dopamine depleters</strong></td>\n<td>Reserpine, tetrabenazine</td>\n</tr>\n<tr>\n<td><strong>Antiemetics</strong></td>\n<td>Metoclopramide, levosulpiride</td>\n</tr>\n<tr>\n<td><strong>Calcium channel blockers</strong></td>\n<td>Flunarizine, cinnarizine</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old primigravida had pre-pregnancy BMI of 30 kg/msq. What is the recommended weight gain during her pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "5-7 Kg"
      },
      {
        "id": 2,
        "text": "8-11 Kg"
      },
      {
        "id": 3,
        "text": "10-13 Kg"
      },
      {
        "id": 4,
        "text": "14-16 Kg"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The recommended weight gain the above case <strong>is not more than</strong> <strong>7 Kg.</strong></p>\n<p>Ideally weight gain should depend on the pre-pregnancy body mass index (BMI) level.</p>\n<table>\n<tbody>\n<tr>\n<td>\n<p>Category</p>\n</td>\n<td>\n<p>BMI</p>\n</td>\n<td>\n<p>Recommended weight gain</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Underweight</p>\n</td>\n<td>\n<p>&lt;18.5</p>\n</td>\n<td>\n<p>12.5&ndash;18 kg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Normal</p>\n</td>\n<td>\n<p>18.5&ndash;24.9</p>\n</td>\n<td>\n<p>11.5&ndash;14 kg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Overweight</p>\n</td>\n<td>\n<p>25&ndash;29.9</p>\n</td>\n<td>\n<p>7&ndash;11.5 kg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Obese</p>\n</td>\n<td>\n<p>&gt;30</p>\n</td>\n<td>\n<p>7 kg</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following renal stones is not formed in acidic urine?",
    "choices": [
      {
        "id": 1,
        "text": "Uric acid stone"
      },
      {
        "id": 2,
        "text": "Struvite stone"
      },
      {
        "id": 3,
        "text": "Cystine stone"
      },
      {
        "id": 4,
        "text": "Oxalate stone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Struvite stone is produced in <strong>alkaline urine</strong>, especially when urea-splitting <strong>proteus </strong>organisms are present.</p>\n<ul>\n<li>Struvite is a <strong>triple</strong>-<strong>phosphate calculus </strong>(<strong>calcium</strong> phosphate often with <strong>ammonium magnesium</strong> phosphate), grossly smooth in texture, and dirty-white in color.</li>\n<li>The calculus may enlarge to fill most of the collecting system, forming a <strong>stag-horn calculus.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The image shown below is the technique of insertion of?",
    "choices": [
      {
        "id": 1,
        "text": "Oropharyngeal airway"
      },
      {
        "id": 2,
        "text": "Nasopharyngeal airway"
      },
      {
        "id": 3,
        "text": "Laryngeal mask airway"
      },
      {
        "id": 4,
        "text": "Endotracheal tube"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shown above is the technique of insertion of laryngeal mask airway.</p>\n<p><strong>Laryngeal mask airway</strong> (LMA) is a supraglottic airway device that is positioned in the <strong>hypopharynx</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/453606ce6a0046edb09710bfe6868a5f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f1a5205e27954a4bb7131cda0f1499fex1280x1146.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f35153982f349149033f4199470e9efx1280x2807.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most universally accepted health status indicator?",
    "choices": [
      {
        "id": 1,
        "text": "IMR"
      },
      {
        "id": 2,
        "text": "MMR"
      },
      {
        "id": 3,
        "text": "Life Expectancy"
      },
      {
        "id": 4,
        "text": "Under-5 mortality rate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Infant mortality rate</strong> (IMR) is&nbsp;the most <strong>universally accepted </strong>health status indicator of the whole population and of the socio-economic status in which they live.</p>\n<p>Infant mortality rate (IMR)= Number of deaths in the first year of life/Number of live births x 1000</p>\n<p>It is a <strong>sensitive</strong> <strong>indicator</strong> of the&nbsp;availability, utilization, and effectiveness of health care.&nbsp;It is also among the <strong>best indicators </strong>of<strong> state failure</strong>.</p>\n<p>The best indicator of <strong>socio-economic development</strong> is the<strong> under-5 mortality rate</strong>. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old man presents to the clinic with a non-specific history of malaise. Mild sensorineural hearing loss had been diagnosed during his early education, although hearing aids were not required. He gives a history of recurrent hematuria and current investigations reveal the same. What is the most likely diagnosis among the following?",
    "choices": [
      {
        "id": 1,
        "text": "Fanconi\u2019s anemia"
      },
      {
        "id": 2,
        "text": "Alport syndrome"
      },
      {
        "id": 3,
        "text": "Autosomal dominant polycystic kidney disease"
      },
      {
        "id": 4,
        "text": "IgA nephropathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Alport syndrome</strong> is the most likely diagnosis. Alport syndrome is a cause of <strong>recurrent hematuria</strong>, which is associated with <strong>sensorineural hearing loss.</strong></p>\n<p>A&nbsp;<strong>defect in type IV collagen</strong>, a major component of the basement membrane, is responsible for&nbsp;<strong>Alport syndrome.</strong></p>\n<p>Alport syndrome&nbsp;is a genetically heterogeneous disease,&nbsp;<strong>85% is X-linked</strong>&nbsp;and the rest may be autosomal recessive or autosomal dominant.</p>\n<p><strong>&nbsp;Other causes of recurrent hematuria</strong></p>\n<ul>\n<li>Alport syndrome</li>\n<li>IgA nephropathy</li>\n<li>Autosomal dominant polycystic kidney disease (ADPKD)</li>\n<li>Papillary necrosis</li>\n<li>Renal cell carcinoma&nbsp; &nbsp; &nbsp;&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following people would you not classify as a high risk contact of SARS-CoV2?",
    "choices": [
      {
        "id": 1,
        "text": "A family member who lives in the same household as the patient"
      },
      {
        "id": 2,
        "text": "A doctor who examined the patient with a surgical mask and gloves"
      },
      {
        "id": 3,
        "text": "A passenger in the same bus as a symptomatic patient for 6 hours and the patient later tested positive"
      },
      {
        "id": 4,
        "text": "A sanitary worker who cleaned the linens of the patient"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A person traveling in the same environment and not having significant exposure to the confirmed case is not classified as a high-risk contact.</p>\n<p>A contact of COVID-19 is a person living in the same household or having direct physical contact with the patient/infectious secretions without appropriate PPE or a person who was in a closed environment or at a distance of within 1 meter of a COVID-19 case.</p>\n<p><strong>High-risk contacts:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\">Touched body fluids of the patient</li>\n<li style=\"font-weight: 400;\">Had direct contact with the body of the patient during the physical examination <strong>without proper PPE</strong></li>\n<li style=\"font-weight: 400;\">Touched or <strong>cleaned the linens</strong>, clothes, or dishes of the patient</li>\n<li style=\"font-weight: 400;\">Lives in the <strong>same household </strong>as the patient</li>\n<li style=\"font-weight: 400;\">Comes in close contact (within 1 meter) with the patient without necessary precautions</li>\n<li style=\"font-weight: 400;\">A<strong> passenger&nbsp;</strong>in <strong>close proximity </strong>with&nbsp;the<strong>&nbsp;</strong>symptomatic patient for<strong> 6 hours </strong>and the patient later tested positive</li>\n</ul>\n<p><strong>Low-risk contacts:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\">Shared the same space but does not have a high-risk exposure to the confirmed case.</li>\n<li style=\"font-weight: 400;\">Travelled in the same environment but does <strong>not have a high-risk exposure</strong> to the confirmed case.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman presents to the clinic with a history of greenish discharge from the nipple for the past 1 month. Personal history is significant for cigarette smoking. On compression of her breast, greenish discharge from multiple ducts was observed. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Duct ectasia"
      },
      {
        "id": 2,
        "text": "Intraductal papilloma"
      },
      {
        "id": 3,
        "text": "Intraductal carcinoma"
      },
      {
        "id": 4,
        "text": "Paget's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis of a patient with greenish discharge from multiple ducts is<strong> duct ectasia.&nbsp;</strong></p>\n<p>Duct ectasia is the dilatation of breast ducts. It is the most common cause of nipple discharge in nonlactating women. This condition is associated with <strong>smoking</strong> and diabetes.</p>\n<p>The initial stage of this disease consists of dilatation of one or more lactiferous ducts. These ducts get filled with stagnant brown or <strong>green colored</strong> secretions. In the later stages, the accumulation of fluid in the lactiferous ducts leads to infection and inflammation, causing <strong>periductal mastitis</strong>. The infections are most often mixed infections of aerobic and anaerobic flora of the skin.</p>\n<p>Patients may present with nipple discharge, abscess, fistula or nipple retraction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the structure 'e'.",
    "choices": [
      {
        "id": 1,
        "text": "Right hepatic duct"
      },
      {
        "id": 2,
        "text": "Cystic duct"
      },
      {
        "id": 3,
        "text": "Common bile duct"
      },
      {
        "id": 4,
        "text": "Pancreatic duct"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image depicts MRCP (Magnetic resonance cholangiopancreatography)</p>\n<ul>\n<li>Non invasive test</li>\n<li>Endoscope is not used</li>\n<li>No contrast medium used (<strong>Bile</strong> serves as a contrast medium)</li>\n<li>Heavy T2 weighted image</li>\n</ul>\n<p>a - Gall bladder with gall stones</p>\n<p>b - Ampulla of Vater</p>\n<p>c - Pancreatic duct</p>\n<p>d -&nbsp;Duodenum</p>\n<p>e - Common bile duct</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf6ff4c18d3e48c99ab14eb2f2e8e2cb.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Vasopressin has maximum effect on which part of the renal tubule?",
    "choices": [
      {
        "id": 1,
        "text": "Proximal tubule"
      },
      {
        "id": 2,
        "text": "Distal tubule"
      },
      {
        "id": 3,
        "text": "Loop of henle"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Vasopressin has the&nbsp;maximum effect on the collecting ducts.</p>\n<p>Vasopressin acts by inserting<strong> aquaporin 2</strong> present in cytoplasmic vesicles of <strong>principal cells on to the apical membrane</strong>.&nbsp;The effect is mediated via the vasopressin V2 receptor, cyclic adenosine 5-monophosphate (cAMP), and protein kinase A.&nbsp;When <strong>vasopressin is absent</strong>, the <strong>collecting duct</strong> epithelium is relatively <strong>impermeable to water.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f84bdcfc1c34778bfbd6642c2d8e9d3x1280x2173.JPEG"
    ]
  },
  {
    "text": "While conducting a screening camp for coronary heart disease, you encounter the following people. Who among them is at the highest risk for developing this disease?",
    "choices": [
      {
        "id": 1,
        "text": "A person who is competitive and ambitious"
      },
      {
        "id": 2,
        "text": "A person who is calm and relaxed"
      },
      {
        "id": 3,
        "text": "A person who tends to suppress their emotions"
      },
      {
        "id": 4,
        "text": "An introverted person with negative affectivity"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A person who is <strong>competitive</strong> and <strong>ambitious</strong>&nbsp;is said to have a<strong> type A</strong> <strong>personality</strong>. Such people are more prone to <strong>develop</strong> <strong>coronary heart disease</strong>&nbsp;(CHD).&nbsp;Personality type is a <strong>non-modifiable risk factor</strong> for CHD.</p>\n<p><strong>Risk factors</strong>&nbsp;for coronary heart disease are:</p>\n<ul>\n<li><strong>Modifiable</strong>:\n<ul>\n<li>Cigarette smoking</li>\n<li>High blood pressure</li>\n<li>Elevated serum cholesterol</li>\n<li>Diabetes</li>\n<li>Obesity</li>\n<li>Sedentary habits</li>\n<li>Stress</li>\n</ul>\n</li>\n<li><strong>Non-modifiable</strong>:\n<ul>\n<li>Age</li>\n<li>Sex</li>\n<li>Family history</li>\n<li>Genetic factors</li>\n<li>Personality&nbsp;</li>\n</ul>\n</li>\n</ul>\n<p>Option B:&nbsp;A calm and relaxed person is said to have a type B personality.</p>\n<p>Option C: A person who tends to suppress their emotions, especially negative emotions, is said to have a type C personality.</p>\n<p>Option D: A person with&nbsp;negative affectivity and social inhibition is said to have a type D personality.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A healthy child is brought to the pediatrician for a routine check-up. The child comes in with a toy in her hand and readily shares it with the doctor. She is able to say her name. Her mother says she does most of her activities with her right hand now. If she is given a paper and pen, which of the following will she be able to do?",
    "choices": [
      {
        "id": 1,
        "text": "Copy a circle"
      },
      {
        "id": 2,
        "text": "Writes numbers"
      },
      {
        "id": 3,
        "text": "Copy a square"
      },
      {
        "id": 4,
        "text": "Copy a triangle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This child who is able to say her name, shares toys, and has developed handedness is around three years of age and she will be able to copy a circle.</p>\n<p>Developmental milestones at the age of three:</p>\n<p><strong>Social and Emotional:</strong></p>\n<p>These children usually copy adults and friends, engage in cooperative play, show affection for friends and concern for crying friends without prompts, understand the concept of ownership but are able to share toys, show a wide range of emotions, and may get upset with changes in routine easily.</p>\n<p><strong>Language and Communication:</strong></p>\n<p>Follow instructions with two/three steps, can name most things around them, understand prepositions, use pronouns, name friends and make a simple conversation with two sentences.</p>\n<p><strong>Cognitive:</strong></p>\n<p>Copy a circle with a crayon, turn book pages one at a time, build towers with six or more blocks, screw and unscrew jars/lids and can do puzzles with four or fewer pieces</p>\n<p><strong>Motor:</strong></p>\n<p>Climb well, run easily, pedal a tricycle and walk up and down stairs with one foot on each step</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An adolescent boy presents with yellowish discoloration of sclera. His liver function tests reveal conjugated hyperbilirubinemia and normal liver enzyme levels. Liver biopsy revealed an accumulation of dark melanin like pigment in the hepatocytes. What is the probable diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Gilbert syndrome"
      },
      {
        "id": 2,
        "text": "Crigler- najjar syndrome"
      },
      {
        "id": 3,
        "text": "Dubin johnson syndrome"
      },
      {
        "id": 4,
        "text": "Rotor syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario describes <strong>conjugated hyperbilirubinemia</strong> with <strong>dark pigment deposition</strong>&nbsp;(image below) in the liver. These features are suggestive of <strong>Dubin Johnson syndrome</strong>.</p>\n<p>In<strong> Dubin Johnson syndrome</strong> (DJS) there is&nbsp;<strong>defective excretion </strong>of conjugated <strong>bilirubin </strong>and&nbsp;various compounds like <strong>epinephrine metabolites&nbsp;</strong>causing the liver to appear<strong> black</strong>.</p>\n<p><strong>Rotor syndrome</strong> also has conjugated hyperbilirubinemia but there is <strong>no&nbsp;pigmentation</strong> of the liver. Serum bilirubin levels are not helpful in differentiating between&nbsp;<strong>Dubin Johnson</strong>&nbsp;syndrome (DJS) and&nbsp;<strong>Rotor's</strong>&nbsp;syndrome as both these conditions present with&nbsp;<strong>mild elevation</strong>&nbsp;of&nbsp;<strong>serum bilirubin</strong>.</p>\n<p>These two conditions can be differentiated as follows:</p>\n<table width=\"904\">\n<tbody>\n<tr>\n<td><strong>Test</strong></td>\n<td><strong>Rotor Syndrome</strong></td>\n<td><strong>Dubin Johnson syndrome</strong></td>\n</tr>\n<tr>\n<td>Oral cholecystography</td>\n<td>Gall bladder is visualized</td>\n<td>\n<p>Gall bladder not visualised&nbsp;</p>\n<p>Impaired ability to concentrate the contrast material into bile</p>\n</td>\n</tr>\n<tr>\n<td>Total urinary coproporphyrin</td>\n<td>Elevated</td>\n<td>\n<p>Normal&nbsp;</p>\n<p>Increased excretion of coproporphyrin 1 and decreased excretion of coproporphyrin 3</p>\n</td>\n</tr>\n<tr>\n<td>Bromsulphalein (BSP) clearance test</td>\n<td>\n<p>Delayed clearance of BSP</p>\n<p>No reflux</p>\n</td>\n<td>\n<p>Rise in plasma levels of BSP after 90 minutes of injection</p>\n<p>Reflux of BSP from hepatocytes&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Gilbert and Crigler-Najjar syndromes are characterized by unconjugated hyperbilirubinemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef4edf340f114f7aaac451fa89ec025bx432x287.JPEG"
    ]
  },
  {
    "text": "What should the minimum duration of symptoms be to diagnose post-traumatic stress disorder?",
    "choices": [
      {
        "id": 1,
        "text": "7 days"
      },
      {
        "id": 2,
        "text": "10 days"
      },
      {
        "id": 3,
        "text": "15 days"
      },
      {
        "id": 4,
        "text": "30 days"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>duration</strong> of these symptoms should be<strong> &gt; 1 month</strong> to label it as PTSD.</p>\n<p>The given clinical scenario with re-experiences (flashbacks and nightmares), avoidance of the stimuli associated with the attacks, and hyperarousal (impaired sleep and anxiety) for <strong>more than one month</strong> are suggestive of <strong>post-traumatic stress disorder(PTSD).</strong></p>\n<p>PTSD is a psychiatric disorder characterized by increased stress and anxiety occurring after a stressful or traumatic event, (e.g., witnessing or being involved in violent accidents, crime, war, assault, kidnapping, natural disaster, life-threatening illness, physical or sexual abuse).&nbsp;</p>\n<div class=\"page\" title=\"Page 3312\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The <strong>predisposing factors</strong> for this condition include:</p>\n<ul>\n<li>Presence of childhood trauma</li>\n<li>Borderline, paranoid, dependent, or antisocial personality disorder traits</li>\n<li>Inadequate family or peer support system</li>\n<li>Female gender</li>\n<li>Genetic susceptibility to psychiatric illness</li>\n<li>Recent stressful life changes</li>\n<li>Recent excessive intake of alcohol</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>Symptoms of PTSD can be divided into four types:</p>\n<ul>\n<li><strong>Intrusion symptoms</strong>\n<ul>\n<li>Flashbacks- The individual may act and feel as if the traumatic event is reoccurring&nbsp;</li>\n<li>Nightmares of the event</li>\n</ul>\n</li>\n<li><strong>Hyperarousal</strong>&nbsp;\n<ul>\n<li>Increased startle response</li>\n<li>Insomnia</li>\n<li>Hypervigilance</li>\n<li>Difficulty concentrating</li>\n<li>Reckless and self-destructive behavior</li>\n<li>Irritability and anxiety</li>\n</ul>\n</li>\n<li><strong>Avoidance symptoms: </strong>&nbsp;\n<ul>\n<li>avoiding memories, thoughts, and feelings of the event</li>\n<li>avoiding external reminders of the traumatic event</li>\n</ul>\n</li>\n<li><strong>Negative&nbsp;cognitions</strong> and mood associated with the traumatic event\n<ul>\n<li>Inability to remember an important aspect of the traumatic event</li>\n<li>Feelings of depersonalization and derealization</li>\n<li>Anhedonia</li>\n<li>Negative emotional state- fear, horror, anger, guilt, or shame</li>\n</ul>\n</li>\n</ul>\n<p>Psychotherapies found to be effective for PTSD include exposure therapy, trauma-focused cognitive-behavioral therapy, eye movement desensitization, and abreaction. SSRIs may be prescribed as first-line treatment.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 002';
        const quizFilename = 'fmge-mini-test-002-5e0b50e6.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>