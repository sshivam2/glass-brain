<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 15- Instruments Only - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Following the delivery of a healthy baby boy, his COVID positive mother slipped into ARDS and passed away. The relatives have arranged a breast milk donor and wish to feed the baby using the device shown in the image.  In newborns of which gestational age, would you recommend this as a method of primary feeding?",
    "choices": [
      {
        "id": 1,
        "text": "28-31 weeks"
      },
      {
        "id": 2,
        "text": "32-34 weeks"
      },
      {
        "id": 3,
        "text": ">34 weeks"
      },
      {
        "id": 4,
        "text": "Any gestational age"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows <strong>paladai</strong>. It can be used as <strong>a primary</strong> feeding method during <strong>routine</strong> feeding in neonates born at gestational age <strong>32-34 weeks</strong> only. Sick mothers or mothers with contraindications to breastfeeding can feed their child using paladai. The milk can either be expressed breastmilk or they can resort to using undiluted cow milk or formula feeds.&nbsp;</p>\n<p>Choice of initial feeding methods in low-birth-weight (LBW) infants:</p>\n<table style=\"width: 434px; height: 564px;\">\n<tbody>\n<tr>\n<td style=\"width: 95px;\"><strong>Gestational Age</strong></td>\n<td style=\"width: 187px;\"><strong>Feeding Skill Matured</strong></td>\n<td style=\"width: 130px;\"><strong>Method of Feeding</strong></td>\n</tr>\n<tr>\n<td style=\"width: 95px;\">&lt;28 weeks</td>\n<td style=\"width: 187px;\">No proper sucking effort. No propulsive motility of the gut</td>\n<td style=\"width: 130px;\">IV Fluids</td>\n</tr>\n<tr>\n<td style=\"width: 95px;\">28-32 weeks</td>\n<td style=\"width: 187px;\">\n<p>Sucking Bursts develop</p>\n<p>No coordination between suck/swallow and breathing</p>\n</td>\n<td style=\"width: 130px;\">Oro-gastric/ Nasogastric tube feeding with occasional spoon/&nbsp;paladai feeding</td>\n</tr>\n<tr>\n<td style=\"width: 95px;\"><strong>32-34 weeks</strong></td>\n<td style=\"width: 187px;\">Slightly mature sucking pattern. <strong>Coordination between breathing and swallowing begins</strong></td>\n<td style=\"width: 130px;\">Feeding by spoon/paladai/cup</td>\n</tr>\n<tr>\n<td style=\"width: 95px;\">&gt;34 weeks</td>\n<td style=\"width: 187px;\">Mature sucking pattern. More coordination between breathing and swallowing</td>\n<td style=\"width: 130px;\">Breastfeeding</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bddc9f682b8647d481fda37b9131aeb4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What size laryngeal mask airway would you choose for a woman weighing 60 kg?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "5"
      },
      {
        "id": 3,
        "text": "4.5"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The appropriate size of laryngeal mask airway for a woman weighing 60 kg is<strong>\u00a04</strong>.</p>\n<p>The laryngeal mask airway is a supraglottic airway device, which is placed in the hypopharynx and protects the larynx from pharyngeal secretions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Umbilical cord scissors"
      },
      {
        "id": 2,
        "text": "Metzenbaum scissors"
      },
      {
        "id": 3,
        "text": "Episiotomy scissors"
      },
      {
        "id": 4,
        "text": "Embryo scissors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>Metzenbaum</strong> scissors. It is used to cut dissect and cut tissues such as the peritoneum and adhesions. It is similar to Mayo scissors\u00a0in that the ends are the same on both scissor halves, but its handles are longer and its middle section is slightly narrower.</p>\n<p>The given image shows the <strong>Metzenbaum scissors:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a2b4abcf2b6c41a2818d6188b53c2140.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/566b092a21cd4bbf83e12899be097bc7x720x480.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b29111ce913743f289fb02b2a6061e02x1280x1291.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/864b0f265b3b4ca587efbaa2019ac9e9x1200x916.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3727cf66e4e475cb43e23854736fa80x1159x933.JPEG"
    ]
  },
  {
    "text": "The equipment shown below is used for the sterilization of all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Culture media"
      },
      {
        "id": 2,
        "text": "Endoscopes"
      },
      {
        "id": 3,
        "text": "Glassware"
      },
      {
        "id": 4,
        "text": "Surgical instruments"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows an <strong>autoclave</strong>.\u00a0 It is not used to sterilize endoscopes because most of them are heat-sensitive.\u00a0</p>\n<p>Autoclaving is a method of heat sterilization using <strong>steam under pressure</strong>. The temperature is kept between 108<sup>o</sup>C to 147<sup>o</sup>C. It is used to sterilize linen, instruments, laboratory ware, media, pharmaceutical products, aqueous solutions, surgical instruments, cardiac catheters, and implants.</p>\n<p>Endoscopes are cleaned using liquid chemical sterilizing agents such as <strong>orthophthaldehyde </strong>as it has bactericidal properties and is quick, safe and effective.`<br /><br />Other equipments used in sterilization include:<br /><br /><strong>Hot air oven</strong>- The objects undergo a holding period of 160<sup>o</sup>C for two hours to sterilize glassware, forceps, scissors, scalpels, swabs, and some pharmaceutical products such as liquid paraffin, dusting powder.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7b7fc1a5dfa6436b83daf267ff11aa9e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/770a1c62dc344e2aae93fe84c8cae528x1280x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a07ff6c7b2a947f490cff7d6d392dbe2x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65e456443ed447459281be4ea44c2b53x500x701.JPEG"
    ]
  },
  {
    "text": "Identify the instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Luedde\u2019s exophthalmometer"
      },
      {
        "id": 2,
        "text": "Naugle exophthalmometer"
      },
      {
        "id": 3,
        "text": "Hertel's exophthalmometer"
      },
      {
        "id": 4,
        "text": "Maddox wing test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div>\n<p>The image shows\u00a0<strong>Luedde's exophthalmometer\u00a0</strong>used to measure proptosis.</p>\n<p><strong>Exophthalmometry</strong>\u00a0measures protrusion of the apex of the cornea from the outer orbital margin (with the eyes looking straight ahead).</p>\n<p>An <strong>absolute protrusion </strong>of<strong> &gt;20 mm</strong> or a <strong>difference </strong>of &gt;<strong>2 mm </strong>between the <strong>two eyes </strong>is labeled as <strong>proptosis</strong>.</p>\n<p>Instruments used to measure proptosis:</p>\n<ul>\n<li>Luedde exophthalmometer</li>\n<li>Hertel\u2019s exophthalmometer</li>\n<li>Naugle Exophthalmometer\u00a0</li>\n</ul>\n</div>\n<p><strong>Hertel's</strong> exophthalmometer (image below): The most commonly used instrument. It measures <strong>both\u00a0eyes simultaneously</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/201eb05233d843ce9802bc88ff12bd8c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e878dd23a0f74846b1da2c910d5fac07x1280x728.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8c58d480087b4a28bf04fcc066067a09x720x535.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b8365db6f694f2d8380a84552f5948bx1280x728.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8b18451cc904522baed46481d685ea7x720x380.PNG"
    ]
  },
  {
    "text": "Where would you attach the oxygen inlet in the instrument given below?",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows a <strong>self-inflating bag</strong> and <strong>mask.&nbsp;</strong>It is used in <strong>neonatal resuscitation;</strong> it inflates automatically, without a compressed gas source.</p>\n<ul>\n<li>Marking 1 is the pressure release valve.&nbsp;</li>\n<li>Marking 2 is the 360-degree swivel.&nbsp;</li>\n<li><strong>Marking 3</strong>&nbsp;is the oxygen inlet.</li>\n<li>Marking 4 is the air inlet.</li>\n</ul>\n<p>The parts of the self-inflating bag and mask are labeled in the image below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bd9cb6000638445bb45956d59355a80e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/88921eb6bfde4eaca4eeb30960223250x1200x1117.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man undergoes pancreatic necrosectomy. The surgeon decides to place abdominal drains following the procedure. Which of the given suture materials is preferred for securing the drain externally?",
    "choices": [
      {
        "id": 1,
        "text": "Polydioxanone"
      },
      {
        "id": 2,
        "text": "Monocryl"
      },
      {
        "id": 3,
        "text": "Silk"
      },
      {
        "id": 4,
        "text": "Polypropylene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Silk sutures</strong> are commonly used to <strong>secure external drains.</strong></p>\n<p>Silk is a blue/black-colored, multifilament, natural, braided, and non-absorbable suture material derived from the cocoon of the silkworm larva.\u00a0Fibrous\u00a0<strong>encapsulation</strong>\u00a0of the suture occurs in 2 to 3 weeks, and it is\u00a0<strong>absorbed</strong>\u00a0slowly over\u00a0<strong>1 to 2 years</strong>.</p>\n<p>It can be used for ligation and suturing when\u00a0<strong>long-term tissue support</strong>\u00a0is necessary. It can also be used for skin closure; however, there is an\u00a0<strong>increased risk of infection</strong>\u00a0and\u00a0<strong>tissue reaction</strong>. It can be used for\u00a0<strong>securing drains</strong>\u00a0externally.\u00a0Silk is\u00a0<strong>not</strong>\u00a0suitable for use with a vascular prosthesis or in tissues requiring prolonged approximation under stress.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cc517a4a90ed425e93d5cb5ed3baf87ex800x556.JPEG"
    ]
  },
  {
    "text": "In your community medicine practicals, you are given an apparatus as shown in the image given below. Which of the following statements regarding the apparatus is true?",
    "choices": [
      {
        "id": 1,
        "text": "The indicator used is bromocresol purple"
      },
      {
        "id": 2,
        "text": "The indicator used is starch-iodide"
      },
      {
        "id": 3,
        "text": "It is used to estimate free chlorine levels"
      },
      {
        "id": 4,
        "text": "It is used to estimate combined chlorine levels"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image given is that of a <strong>Horrock's apparatus</strong>. The indicator used in Horrock's apparatus is <strong>starch iodide</strong>.</p>\n<p>Horrock's apparatus contains<strong> 6 white</strong> <strong>cups</strong> (200 ml each),&nbsp;<strong>1 black cup</strong> with a circular mark, <strong>2 metal spoons</strong> with 2 grams of <strong>bleaching powder</strong> in each, <strong>7 glass stirring rods</strong>, <strong>1 special</strong> <strong>pipette </strong>and&nbsp;<strong>2 droppers.&nbsp;</strong>It is not usful in measuring free and combined chlorine. It estimates the <strong>chlorine demand</strong> of water and is used to calculate the <strong>amount of bleaching powder</strong> used to <strong>disinfect</strong> the well.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e10da27b426e489c926305c57cc56613.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old man presented with progressive blurred vision, photophobia, and pain in the right eye. On examination, there was conjunctival redness, a mid-dilated pupil, and a shallow anterior chamber in the right eye. A procedure incorporates the following device to aid drainage and treat this condition. Identify the device.",
    "choices": [
      {
        "id": 1,
        "text": "Ex-Press mini shunt"
      },
      {
        "id": 2,
        "text": "Ahmed glaucoma valve"
      },
      {
        "id": 3,
        "text": "Molteno implant"
      },
      {
        "id": 4,
        "text": "Baerveldt implant"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The clinical vignette points to a diagnosis of glaucoma and the device used is an\u00a0<strong>Ex-Press glaucoma implant (mini shunt)</strong>.</p>\n<p class=\"p1\">It is a\u00a0<strong>minimally invasive glaucoma surgery (MIGS)</strong> to increase aqueous drainage.</p>\n<div class=\"page\" title=\"Page 359\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ex-Press glaucoma implant (mini shunt), is a small\u00a0stainless steel device.\u00a0It is inserted under a scleral flap during a modified trabeculectomy. Mitomycin c might be used to prevent scarring. Complications such as hypotony are lower as compared to standard trabeculectomy.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68cf1a78eb994453a05be111194bd8ec.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f282462c5564aa6bf73bcf045600c07x1280x1518.3074753173485.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/241b4743c3b84c05ab5540b316620202x850x680.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c53478ed45f248d38e67e411a0f8a7eax1280x1215.JPEG"
    ]
  },
  {
    "text": "Identify the instrument given below, and choose the false statement regarding the procedure done using it.",
    "choices": [
      {
        "id": 1,
        "text": "Thrombocytopenia is an absolute contraindication"
      },
      {
        "id": 2,
        "text": "Hemophilia is a contraindication"
      },
      {
        "id": 3,
        "text": "It is performed for the diagnosis and staging of lymphoma."
      },
      {
        "id": 4,
        "text": "Postoperative bleeding is a common complication."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a <strong>bone marrow biopsy</strong> needle. Thrombocytopenia is not an absolute contraindication for bone marrow biopsy. If the platelet count falls below 20,000 cells/&mu;L, or if clinically warranted, platelet transfusion is performed before the procedure.</p>\n<p>Indications:</p>\n<ul>\n<li>Evaluation of unexplained anemia, leukopenia, thrombocytopenia, and pancytopenia</li>\n<li>Evaluation of multiple myeloma, lymphoma, and myelodysplastic syndrome</li>\n<li>Diagnosis and staging of <strong>lymphoma</strong> or solid tumors</li>\n<li>Diagnosis and evaluation of plasma cell disorders and leukemias</li>\n<li>Evaluation of infections such as histoplasmosis, leishmaniasis, cryptococcosis, and Q fever</li>\n<li>Evaluation of fever of unknown origin</li>\n</ul>\n<p>Contraindications:&nbsp;</p>\n<ul>\n<li>Severe <strong>hemophilia</strong></li>\n<li>Severe disseminated intravascular coagulopathy</li>\n<li>Severe bleeding disorders</li>\n</ul>\n<p><strong>Post</strong><strong>operative</strong> <strong>bleeding</strong> is a common complication. It is due to the high vascularity of the sampled tissue. Manual pressure and pressure bandaging can be done until the bleeding subsides.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/46805055a7ab4540ac1f2c0d4362c8e3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old female patient is undergoing a vaginal hysterectomy. The instrument given below is used to retract the posterior vaginal wall. Identify the given instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Auvard's speculum"
      },
      {
        "id": 2,
        "text": "Cusco's speculum"
      },
      {
        "id": 3,
        "text": "Sim's speculum"
      },
      {
        "id": 4,
        "text": "Doyen's retractor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The instrument shown in the image is the\u00a0<strong>Auvard speculum.</strong></p>\n<p>It is a\u00a0<strong>self-retaining</strong> heavy retractor provided with a heavy <strong>metal ball</strong>. It is used in <strong>vaginal hysterectomy</strong> to retract the posterior vaginal wall. A channel is provided in the handle to collect the blood and drain it. An image of the Auvard speculum is given below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/160949f745c04d33a857cd2ed4be3eed.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b38a0ea9a2a41f4843e25f4d654a3f0x360x271.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1667cfb8089e42148ea1f463da3b7fa9x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e67a50f84a643c39a623b8b3d9b4f47x360x270.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c05d44bb16d54e50b2bca9105df4478cx1279x1116.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding the procedure done with the needle shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Lateral recumbent position is preferred"
      },
      {
        "id": 2,
        "text": "Used in the therapeutic management of psuedotumor cerebri"
      },
      {
        "id": 3,
        "text": "Needle is inserted towards umbilicus."
      },
      {
        "id": 4,
        "text": "Coagulopathy is not a contraindication"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image shows a<strong>\u00a0lumbar puncture needle</strong>.\u00a0<strong>Coagulopathy</strong> is a<strong>\u00a0contraindication </strong>for this procedure.</p>\n<p>Lumbar puncture is preferably performed in the <strong>lateral recumbent position.</strong> (Option A)\u00a0The lateral recumbent position allows more accurate measurement of the opening pressure, thus they are preferred over the upright position. Using sterile techniques, after administering a local anesthetic, the interspace between <strong>L3-L4/L4-L5</strong> is pierced and the needle is inserted in a cephalad direction, <strong>towards</strong> the <strong>umbilicus</strong>. (Option C)</p>\n<p>Indications of lumbar puncture include suspicion of <strong>meningitis</strong>, suspicion of subarachnoid hemorrhage, and\u00a0<strong>therapeutic relief </strong>of<strong> pseudotumor</strong> <strong>cerebri</strong>. (Option B)</p>\n<p>Contraindications for lumbar puncture include:</p>\n<ul>\n<li>Thrombocytopenia or other <strong>bleeding diatheses</strong> (including ongoing anticoagulant therapy).</li>\n<li>Possible raised intracranial pressure.</li>\n<li>Suspected spinal epidural abscess.</li>\n<li><strong>Skin</strong> <strong>infection</strong> over the needle entry site.</li>\n</ul>\n<p>The complications of lumbar puncture include <strong>post-spinal puncture headache</strong>, bloody tap, infection, hemorrhage, post-dural puncture cerebral herniation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/56e67f68a03548ed9eca5f60e61ceb8a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the oxygen delivery rate of the device shown below?",
    "choices": [
      {
        "id": 1,
        "text": "40-60 L/min"
      },
      {
        "id": 2,
        "text": "2-15 L/min"
      },
      {
        "id": 3,
        "text": "10-15 L/min"
      },
      {
        "id": 4,
        "text": "1-6 L/min"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The equipment shown in the image is a nasal cannula. It delivers oxygen at <strong>1-6 L/min.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/af8c7326959b4b3f9c0e8703ce6c82e6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/399d47d214fc47bfb5feda0bc039f514x1280x1280.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f1ae8ce289a41b794a6e7e5ed930821x512x525.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d9a526f186649dabbf96fed3f12c658x720x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9e6523971b7493b9ef0d7937aec36c9x1279x1173.JPEG"
    ]
  },
  {
    "text": "A 12-year-old boy had fever and cough for 1 week, following which he developed a severe earache, decreased hearing, and a feeling of stuffiness in his left ear. Otoscopy revealed a bulging, erythematous tympanic membrane. He was managed with antibiotics. On follow-up after 12 weeks, persistent effusion was noted, and it was managed with the procedure shown below. Identify the instrument used in the procedure.",
    "choices": [
      {
        "id": 1,
        "text": "Lempert\u2019s curette"
      },
      {
        "id": 2,
        "text": "Tilley Lichtwitz trocar and cannula"
      },
      {
        "id": 3,
        "text": "Myringotome"
      },
      {
        "id": 4,
        "text": "MacEwen\u2019s curette"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The case described with fever, earache, erythematous, and bulging tympanic membrane points to a diagnosis of <strong>acute suppurative otitis media</strong> (ASOM), which is treated by antibiotics and incision of the tympanic membrane using a<strong> myringotome (myringotomy).</strong></p>\n<p>Treatment is with <strong>antibiotics</strong>, and <strong>supportive therapy</strong> like nasal decongestants, antipyretics, ear toilet, and dry heat. Myringotomy is the incision of the tympanic membrane using a sharp myringotome, to evacuate pus. It is indicated in ASOM when:</p>\n<ul>\n<li>The tympanic membrane is <strong>bulging</strong> with <strong>severe pain</strong></li>\n<li><strong>Persistent conductive hearing loss</strong> despite antibiotics</li>\n<li><strong>Persistent effusion</strong> beyond 12 weeks.</li>\n<li><strong>Complications</strong> like facial paralysis, labyrinthitis, or meningitis with bulging tympanic membrane arise.</li>\n<li><strong>Recurrent</strong> acute otitis media</li>\n</ul>\n<p>ASOM is an acute inflammation of the middle ear by pyogenic organisms. The disease usually follows a viral upper respiratory tract infection and occurs in the following stages:</p>\n<p>1. Stage of <strong>tubal occlusion</strong>: Eustachian tube gets blocked with retraction of the tympanic membrane and effusion in the middle ear. However, fluid may not be clinically visible. Patients present with mild deafness and earache, but no fever. Tuning fork tests show conductive deafness.</p>\n<p>2. Stage of <strong>presuppuration</strong>: Prolonged tubal occlusion leads to pyogenic infection of the tympanic cavity. The tympanic membrane becomes congested with a leash of blood vessels along the handle of the malleus and at the periphery of the tympanic membrane (<strong>cart-wheel appearance</strong>). Tuning fork tests show conductive hearing loss. Patients present with throbbing earache, deafness, tinnitus, and fever.</p>\n<p>3. Stage of<strong> suppuration:</strong>&nbsp;Formation of pus in the middle ear, with <strong>bulging tympanic membrane </strong>and<strong> loss of landmarks</strong>. A yellow spot may be seen where a rupture might occur.&nbsp;Tenderness may be elicited over the mastoid antrum. Patients present with severe earache, increasing deafness and fever of 102&ndash;103 &deg;F, vomiting, and even convulsions.<br /><br />4. Stage of <strong>resolution:</strong>&nbsp;The tympanic <strong>membrane ruptures</strong> with the release of pus and <strong>symptoms subside</strong>. A&nbsp;small perforation is seen in the anteroinferior quadrant of pars tensa.&nbsp;</p>\n<p>5. Stage of <strong>complications</strong>: Acute mastoiditis, subperiosteal abscess, facial paralysis, labyrinthitis, petrositis, extradural abscess, meningitis, brain abscess, or lateral sinus thrombophlebitis may develop.</p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Lempert&rsquo;s curette</strong>&nbsp;(scoop) is used&nbsp;in mastoid surgery for the removal of bony septa and granulations.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c3c2c06815bb4990be57cfdb8354db0f.jpeg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f7246edd6e434e8e8f7b8ca33beb6e5bx1280x839.4922425952045.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cba36c0c59ed4a0abcafa8c5288b926ax1280x745.3621825023519.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1d3636caea974401ad8a6ea1ef08eed3x1280x744.7108603667136.JPEG"
    ]
  },
  {
    "text": "Identify the instrument shown in the image below:",
    "choices": [
      {
        "id": 1,
        "text": "Ryle's tube"
      },
      {
        "id": 2,
        "text": "Ewald\u2019s tube"
      },
      {
        "id": 3,
        "text": "Sengstaken-Blakemore tube"
      },
      {
        "id": 4,
        "text": "Kehr's T tube"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>Ewald\u2019s tube</strong> used in the <strong>gastric lavage.</strong></p>\n<p><strong>Gastric lavage\u00a0</strong>has been used to manage toxic ingestions for a long time. It is indicated in unprotected airway, seizures, and the need for urgent removal of toxic substances.\u00a0</p>\n<p>Contraindications for this procedure include insignificant ingestions, prolonged time since ingestion, and caustic poisoning. Activated charcoal is usually given after lavage.</p>\n<p>Complications include nasal trauma, esophageal perforation, tracheal intubation, aspiration, and hypothermia.\u00a0</p>\n<p>The following image shows <strong>Ewald's tube</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b2ab814095994f35ada07ddbda3ff815.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5e2d36bfc014ffea924e9a4adceb8d8x450x461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83f8eaf2c7714fc88aff8de74833e051x720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04754bab7fe74cd990a28a811d4fbcf4x380x193.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21226c5bf28043ba896a9d0d694523e2x720x586.JPEG"
    ]
  },
  {
    "text": "The brace shown below is used for",
    "choices": [
      {
        "id": 1,
        "text": "Scoliosis"
      },
      {
        "id": 2,
        "text": "Kyphosis"
      },
      {
        "id": 3,
        "text": "Cervical spine injury"
      },
      {
        "id": 4,
        "text": "Dorso lumbar injury"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows\u00a0the anterior spinal hyperextension brace. A<strong> dorso-lumbar injury</strong>\u00a0should be managed with an\u00a0<strong>ASH brace\u00a0(anterior spinal hyperextension brace)\u00a0</strong>following surgery.\u00a0\u00a0A hyperextension brace will take the pressure off the weak vertebrae and limit forward bending.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/db54307a253146d9be7459e5ed8d3b6d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fcb707c7b60543b4a882f5427d554f24x330x339.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/06e2b0e96f0b4004a5daeb681e162418x720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/331b2ba7ef584f4597241baaf18d1507x1280x3139.JPEG"
    ]
  },
  {
    "text": "The instrument shown below will be least useful for examining patients with which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Acute anal fissure"
      },
      {
        "id": 2,
        "text": "Carcinoma rectum"
      },
      {
        "id": 3,
        "text": "Hemorrhoids"
      },
      {
        "id": 4,
        "text": "Rectal polyp"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a proctoscope. It is not used for examining patients with anal fissures.&nbsp;</p>\n<p>Due to pain, <strong>digital rectal examination</strong> and <strong>anoscopy</strong> are not performed immediately in an <strong>acute anal fissure</strong>. It is reserved for later when the <strong>symptoms resolve</strong> or the patient is in the <strong>operating room</strong>.</p>\n<p>Proctoscopy is indicated in patients with the following:</p>\n<ul>\n<li>Rectal bleeding</li>\n<li>Change in bowel habit, especially recurring attacks of diarrhea</li>\n<li>Pain or difficulty in defecation</li>\n<li>Lesions around the anal opening - abscesses, fistulae, discharge, ulcers, external hemorrhoids</li>\n<li>Rectal prolapse.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5d678046cc2c4c4a8b796f07e0fcca49.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old woman presents with a fracture of the femur. The surgeon used the instrument shown below for internal fixation of her fracture. Identify the instrument?",
    "choices": [
      {
        "id": 1,
        "text": "Kuntscher's nail"
      },
      {
        "id": 2,
        "text": "Square pin"
      },
      {
        "id": 3,
        "text": "Interlocking nail"
      },
      {
        "id": 4,
        "text": "Steinmann's pin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>Kuntscher's cloverleaf intra-medullary nail,</strong> also known as the K-nail can be used for internal fixation of femoral fractures and it is represented by the&nbsp;<strong>image.</strong></p>\n<p><strong>Kuntscher's cloverleaf intra-medullary nail </strong>(K nail)&nbsp;-&nbsp;</p>\n<ul>\n<li>It is used for the treatment of&nbsp;<strong>femoral fractures.</strong></li>\n<li>It is based on the concept of&nbsp;<strong>three-point fixation</strong>&nbsp;i.e., at either end and at the isthmus.</li>\n<li>The&nbsp;<strong>eye at the end</strong>&nbsp;of the nail is useful while removing it.</li>\n<li><strong>Cloverleaf shape</strong>&nbsp;on the cross-section&nbsp;<strong>provides good rotational stability.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/39ba3fdf7f1240849f420a8d5d34be88.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d1a1e797907496b8b2f5352f5b9fe0dx1280x1955.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c54962018cc41baaef55154631954a3x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47654efee7b249db912880c6d41cbda6x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c5b0276dbc14aeeac43b326b3b96145x720x540.JPEG"
    ]
  },
  {
    "text": "An intern in the surgery department uses the following instrument to catheterize a patient. What is the size of the catheter used by him?",
    "choices": [
      {
        "id": 1,
        "text": "14 F"
      },
      {
        "id": 2,
        "text": "16 F"
      },
      {
        "id": 3,
        "text": "12F"
      },
      {
        "id": 4,
        "text": "18F"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The instrument shown in the above image is&nbsp;<strong>Foley's catheter.</strong>&nbsp;The presence of a <strong>white-colored</strong>&nbsp;ring in the balloon port indicates its size as <strong>12&nbsp;F.</strong></p>\n<p><strong>Indications&nbsp;</strong>of catheterization include:</p>\n<ul>\n<li>Providing relief in acute and chronic urinary retention</li>\n<li>Obtaining urine for analysis</li>\n<li>Dilatation of urethral strictures</li>\n<li>Performing continuous bladder infusion</li>\n<li>Maintaining the bladder hygiene of an immobile patient</li>\n<li>Decompression of a neurogenic bladder</li>\n</ul>\n<p><strong>Other options:</strong></p>\n<p>Option A: <strong>14 F </strong>Foley's catheter has a <strong>green</strong> ring in the balloon port.</p>\n<p>Option B: <strong>16 F </strong>Foley's catheter has an <strong>orange</strong>&nbsp;ring in the balloon port.&nbsp;</p>\n<p>Option D: <strong>18&nbsp;F </strong>Foley's catheter has a<strong>&nbsp;red</strong>&nbsp;ring in the balloon port.</p>\n<p>The image below shows Foley's catheters with different colored rings in the balloon ports.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a0d1b4f5c9344428be3de7166ccd772c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ac43fa3044184833b6c6e1df08b2fe4ax800x600.JPEG"
    ]
  },
  {
    "text": "As an ENT resident, you are assisting in the reduction of a nasal bone fracture. Which of the following instruments would you use?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Walsham forceps</strong>&nbsp;(Image 2) is used to reduce a&nbsp;<strong>nasal bone fracture</strong>.</p>\n<p><strong>Asch forceps</strong> is mainly used to reduce <strong>nasal septum fracture.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/338c415a8e2a4c2181660ee503427b87.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f76cd7470c634094979e04d75e61c380x600x312.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd7945010cf14a8e9fb0c3c5cfa8d5e8x600x312.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c1bb8efdb554f7fa522a0961dc8855ex1280x1274.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a05a27ef5d20400fbf8543bc97137344x599x472.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a93d5a10b62941b0818de544ed0c35b3x600x495.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 15- Instruments Only';
        const quizFilename = 'mini-test-15-instruments-only-779f28a4.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>