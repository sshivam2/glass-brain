<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03  Cpr - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        DAMS / DQB / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "id": 50000,
    "choices": [
      {
        "id": 200000,
        "text": "RL"
      },
      {
        "id": 200001,
        "text": "colloids"
      },
      {
        "id": 200002,
        "text": "5% dextrose"
      },
      {
        "id": 200003,
        "text": "WBC transfusi\u00f3n"
      }
    ],
    "text": "The outcome following resuscitation is worsened if following is given",
    "unique_key": "Q1612616",
    "question_audio": null,
    "question_video": null,
    "map_id": 34273341,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) 5% dextrose 5% dextrose is not suitable for resuscitation because it provides free water once metabolized and does not contribute significantly to intravascular volume expansion. In resuscitation scenarios, such as hypovolemic or septic shock, the goal is to restore intravascular volume and maintain tissue perfusion. Using 5% dextrose can result in hyperglycemia, which is associated with worse outcomes in critically ill patients, and does not address the critical need for restoring effective circulating volume. Additionally, the administration of hypotonic solutions like 5% dextrose may lead to cellular swelling, which can exacerbate complications, particularly in patients with traumatic brain injury. Incorrect Options: A: RL (Ringer's Lactate): Ringer's Lactate (RL) is an isotonic crystalloid and is commonly used for resuscitation. It closely mimics the composition of extracellular fluid and is effective in expanding intravascular volume. It is preferred in many resuscitation scenarios because it helps maintain electrolyte balance and avoids complications associated with hyperchloremic acidosis, which can occur with normal saline. B: Colloids: Colloids, such as albumin or synthetic starches, are effective in volume expansion because they remain in the intravascular space longer than crystalloids. However, while colloids can be more effective than crystalloids in restoring volume, they are associated with higher costs and potential side effects like renal impairment (especially with starches). They are not the first-line choice but are not contraindicated for resuscitation. D: WBC transfusion: While WBC transfusions are not commonly used in resuscitation settings, they do not inherently worsen outcomes in the context of hypovolemia or shock. However, they are associated with risks like transfusion reactions, alloimmunization, and infection transmission. These risks are unrelated to typical resuscitation scenarios.",
    "correct_choice_id": 200002,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/21085231698584164/21085231698584164.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/21085231698584164/21085231698584164.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50001,
    "choices": [
      {
        "id": 200004,
        "text": "1-1.5 inches"
      },
      {
        "id": 200005,
        "text": "about 2 inches"
      },
      {
        "id": 200006,
        "text": "2-2.4 inches"
      },
      {
        "id": 200007,
        "text": "2.5-3 inches"
      }
    ],
    "text": "In external cardiac massage, the sternum is depressed by-",
    "unique_key": "Q6420484",
    "question_audio": null,
    "question_video": null,
    "map_id": 34649250,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) 2\u20132.4 inches During external cardiac massage (chest compressions) in cardiopulmonary resuscitation (CPR), the sternum is depressed 2 to 2.4 inches (5\u20136 cm) in adults to ensure effective compression of the heart between the sternum and the spine. This depth allows for optimal circulation of blood, ensuring that oxygenated blood is delivered to vital organs, particularly the brain and heart. Studies have shown that compressions of less than 2 inches are insufficient for generating adequate cardiac output, while compressions exceeding 2.4 inches may increase the risk of rib fractures or other injuries without additional benefit. Incorrect Options: A: 1\u20131.5 inches: A depth of 1\u20131.5 inches is inadequate for effective chest compressions in adults. Such shallow compressions fail to generate the necessary intrathoracic pressure to circulate blood, making them ineffective in providing life-sustaining perfusion. B: About 2 inches: While 2 inches is within the recommended range, it is at the lower limit. The latest guidelines suggest a depth of 2\u20132.4 inches for optimal effectiveness. Compressions closer to 2 inches might not maximize circulation, particularly in larger adults. D: 2.5\u20133 inches: A depth of 2.5\u20133 inches exceeds the recommended compression range and may increase the risk of traumatic injuries, such as rib fractures, sternal fractures, or damage to internal organs like the liver or lungs, without providing additional benefits in terms of perfusion.",
    "correct_choice_id": 200006,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/47323411698584178/47323411698584178.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/47323411698584178/47323411698584178.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50002,
    "choices": [
      {
        "id": 200008,
        "text": "16%"
      },
      {
        "id": 200009,
        "text": "10%"
      },
      {
        "id": 200010,
        "text": "22%"
      },
      {
        "id": 200011,
        "text": "14%"
      }
    ],
    "text": "In mouth to mouth resuscitation, the minimum concentration of oxygen in expired air to ensure oxygenation of patient\u2019s blood should be-",
    "unique_key": "Q4055321",
    "question_audio": null,
    "question_video": null,
    "map_id": 34304570,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) 16% In mouth-to-mouth resuscitation, the rescuer exhales into the patient\u2019s lungs, delivering oxygen to maintain oxygenation. The air exhaled by the rescuer contains approximately 16% oxygen. This level is sufficient to oxygenate the patient's blood, as normal venous blood oxygen levels require far less oxygen than is available in atmospheric air (21% oxygen). Furthermore, the body utilizes only about 4\u20135% of inhaled oxygen during a normal breath, leaving an adequate amount in exhaled air for effective resuscitation. Incorrect Answers: B: 10% An oxygen concentration of 10% in the expired air would be inadequate to ensure oxygenation of the patient\u2019s blood. This level is too low to maintain arterial oxygen saturation, which is critical during resuscitation efforts. C: 22% While a higher oxygen concentration would theoretically improve oxygenation, the rescuer's exhaled air does not reach 22% oxygen. Atmospheric air is 21% oxygen, and some of this oxygen is consumed during the rescuer\u2019s own respiration, reducing the concentration to approximately 16%. D: 14% Although 14% oxygen could potentially aid in oxygenation, it is below the average oxygen concentration found in exhaled air during mouth-to-mouth resuscitation. Therefore, this is not the correct answer.",
    "correct_choice_id": 200008,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/45107121698584193/45107121698584193.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/45107121698584193/45107121698584193.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50003,
    "choices": [
      {
        "id": 200012,
        "text": "NaHCO3"
      },
      {
        "id": 200013,
        "text": "Isoprenaline"
      },
      {
        "id": 200014,
        "text": "Propranolol"
      },
      {
        "id": 200015,
        "text": "Adrenaline"
      }
    ],
    "text": "In CPR drug of choice is-",
    "unique_key": "Q1791802",
    "question_audio": null,
    "question_video": null,
    "map_id": 34478384,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Adrenaline Adrenaline (epinephrine) is the drug of choice in cardiopulmonary resuscitation (CPR) because of its potent effects on the cardiovascular system. It works primarily by stimulating alpha and beta-adrenergic receptors: Alpha-adrenergic effects: These cause vasoconstriction, which increases coronary and cerebral perfusion pressures during CPR. This is critical for maintaining blood flow to vital organs. Beta-adrenergic effects: These enhance myocardial contractility and increase the likelihood of successful defibrillation in cases of ventricular fibrillation or pulseless ventricular tachycardia. Adrenaline improves the chances of return of spontaneous circulation (ROSC) and is a cornerstone drug in advanced cardiac life support (ACLS) protocols. Incorrect Options: A: NaHCO? (Sodium Bicarbonate) Sodium bicarbonate is not the first-line drug in CPR. It is used selectively to correct severe metabolic acidosis or hyperkalemia but only after basic interventions like ventilation, chest compressions, and defibrillation have been optimized. B: Isoprenaline Isoprenaline (isoproterenol) is a beta-adrenergic agonist that primarily increases heart rate and myocardial contractility. However, it does not improve coronary perfusion pressure and may exacerbate arrhythmias, making it unsuitable for CPR. C: Propranolol Propranolol is a beta-blocker that decreases heart rate and myocardial oxygen demand. It is contraindicated in CPR as it can further suppress cardiac function and complicate resuscitation efforts.",
    "correct_choice_id": 200015,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/35143641698584208/35143641698584208.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/35143641698584208/35143641698584208.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50004,
    "choices": [
      {
        "id": 200016,
        "text": "250 ml"
      },
      {
        "id": 200017,
        "text": "500 ml"
      },
      {
        "id": 200018,
        "text": "750 ml"
      },
      {
        "id": 200019,
        "text": "1000 ml"
      }
    ],
    "text": "What is the volume of AMBU bag, used in neonatal resuscitation ?",
    "unique_key": "Q4058203",
    "question_audio": null,
    "question_video": null,
    "map_id": 34439485,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) 250 ml The Ambu bag (manual resuscitator) used in neonatal resuscitation typically has a volume of 250 ml. This size is specifically designed for neonates and ensures that the delivered tidal volume is appropriate for their small lung capacity, which is usually between 3-6 ml/kg. Overinflation can lead to complications like barotrauma or pneumothorax, making the smaller 250 ml bag the ideal choice for neonatal resuscitation. Incorrect Options: B: 500 ml A 500 ml Ambu bag is commonly used for pediatric patients, but it delivers a higher volume than needed for neonates. Using this bag increases the risk of overventilation and barotrauma in neonates, making it unsuitable for neonatal resuscitation. C: 750 ml This size is used in adults and larger pediatric patients. It delivers a much larger tidal volume, which is far too high for neonates and can cause significant lung injury if used in neonatal resuscitation. D: 1000 ml An Ambu bag with a 1000 ml capacity is designed for adults and delivers a tidal volume suitable for larger lung capacities. This size is entirely inappropriate for neonates due to the risk of severe overinflation and respiratory complications.",
    "correct_choice_id": 200016,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/78545401698584220/78545401698584220.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/78545401698584220/78545401698584220.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50005,
    "choices": [
      {
        "id": 200020,
        "text": "Upper third of sternum"
      },
      {
        "id": 200021,
        "text": "Mid third of sternum"
      },
      {
        "id": 200022,
        "text": "Lower one third of sternum"
      },
      {
        "id": 200023,
        "text": "Precordium overall"
      }
    ],
    "text": "During cardiopulmonary resuscitation, external cardiac compression is given over-",
    "unique_key": "Q9910571",
    "question_audio": null,
    "question_video": null,
    "map_id": 34737010,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Lower one third of sternum During cardiopulmonary resuscitation (CPR), external cardiac compressions are performed over the lower one-third of the sternum. This location is optimal as it allows effective compression of the heart between the sternum and the vertebral column, facilitating adequate blood flow to vital organs like the brain and heart during cardiac arrest. Performing compressions at this site reduces the risk of causing injury to surrounding structures such as the ribs or abdominal organs while maximizing the efficacy of compressions. Incorrect Options: A: Upper third of the sternum The upper third of the sternum is closer to the manubrium and the clavicles. Compressions in this area do not effectively compress the heart, as the heart lies inferiorly in the thoracic cavity. This would make the resuscitation effort less effective and increase the likelihood of injury to the trachea and great vessels. B: Mid third of the sternum The mid-sternum is slightly higher than the recommended compression site. While it might compress the heart to some extent, it is less effective than targeting the lower third. Additionally, there is a higher risk of injuring the ribs and sternum without adequate cardiac output. D: Precordium overall The \"precordium\" refers to the chest area overlying the heart. This is a broad and nonspecific region. Effective compressions require a precise location, not a generalized area, as improper placement reduces efficiency and increases the risk of injury to other thoracic and abdominal organs.",
    "correct_choice_id": 200022,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/41240461698584233/41240461698584233.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/41240461698584233/41240461698584233.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50006,
    "choices": [
      {
        "id": 200024,
        "text": "Pulseless VT"
      },
      {
        "id": 200025,
        "text": "Asystole"
      },
      {
        "id": 200026,
        "text": "Pulseless electrical activity"
      },
      {
        "id": 200027,
        "text": "All of the above"
      }
    ],
    "text": "An example of shockable rhythm that is one for which defibrillation is effective is",
    "unique_key": "Q7607245",
    "question_audio": null,
    "question_video": null,
    "map_id": 34283465,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Pulseless VT Pulseless Ventricular Tachycardia (VT) is a shockable rhythm, meaning it responds to defibrillation. Pulseless VT is a life-threatening arrhythmia characterized by a rapid heart rhythm originating from the ventricles, with the absence of effective cardiac output and palpable pulse. Defibrillation is the primary treatment, as it aims to disrupt the disorganized electrical activity and restore normal sinus rhythm. Immediate defibrillation, combined with high-quality cardiopulmonary resuscitation (CPR), is critical for patient survival in pulseless VT. Incorrect Options: B: Asystole Asystole, also known as \"flatline,\" represents the complete absence of electrical activity in the heart. It is a non-shockable rhythm because there is no electrical activity to reset with defibrillation. Management of asystole includes high-quality CPR and administration of epinephrine, not defibrillation. C: Pulseless Electrical Activity (PEA) PEA occurs when there is electrical activity in the heart without mechanical contraction, resulting in no pulse or cardiac output. Like asystole, it is a non-shockable rhythm because defibrillation is ineffective. Treatment for PEA focuses on identifying and addressing reversible causes (the \"H's and T's\") along with CPR and epinephrine administration. D: All of the above This is incorrect because not all rhythms listed are shockable. Only pulseless VT is a shockable rhythm, while asystole and PEA are managed differently without defibrillation.",
    "correct_choice_id": 200024,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/21097941698584246/21097941698584246.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/21097941698584246/21097941698584246.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50007,
    "choices": [
      {
        "id": 200028,
        "text": "less than 5 seconds"
      },
      {
        "id": 200029,
        "text": "less than 10 seconds"
      },
      {
        "id": 200030,
        "text": "less than 20 seconds"
      },
      {
        "id": 200031,
        "text": "less than 30 seconds"
      }
    ],
    "text": "When CPR done how long should you check breathing of patient?",
    "unique_key": "Q5484470",
    "question_audio": null,
    "question_video": null,
    "map_id": 34301667,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Less than 10 seconds When performing Cardiopulmonary Resuscitation (CPR), the guidelines recommend checking for breathing for less than 10 seconds to minimize interruptions to chest compressions. Prolonged pauses in compressions significantly reduce the chances of effective circulation and survival. During this time, the rescuer should quickly assess for normal breathing or any signs of life, such as purposeful movement or gasping (agonal respirations are not normal breathing). If breathing is absent or abnormal, CPR should be resumed immediately to maintain blood flow to vital organs. Incorrect Options: A: Less than 5 seconds While a shorter time would minimize interruptions, it may not allow adequate assessment to confidently determine whether breathing is present or absent. This may lead to incorrect decisions during resuscitation. C: Less than 20 seconds A 20-second interval is too long to assess breathing and would result in a significant interruption in chest compressions. Continuous compressions are essential to maintain circulation and improve the likelihood of survival. D: Less than 30 seconds Taking up to 30 seconds for a breathing check would cause a critical delay in resuming CPR, reducing the effectiveness of resuscitation efforts and potentially worsening outcomes for the patient.",
    "correct_choice_id": 200029,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/29349411698584265/29349411698584265.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/29349411698584265/29349411698584265.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50008,
    "choices": [
      {
        "id": 200032,
        "text": "15 seconds"
      },
      {
        "id": 200033,
        "text": "24 seconds"
      },
      {
        "id": 200034,
        "text": "30 seconds"
      },
      {
        "id": 200035,
        "text": "45 seconds"
      }
    ],
    "text": "How many seconds should it take for one cycle of CPR",
    "unique_key": "Q5124999",
    "question_audio": null,
    "question_video": null,
    "map_id": 34979892,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) 24 seconds In CPR, one cycle consists of 30 chest compressions followed by 2 rescue breaths. The American Heart Association (AHA) guidelines recommend a compression rate of 100\u2013120 compressions per minute. At this rate, performing 30 compressions should take approximately 15\u201318 seconds, and delivering 2 rescue breaths takes an additional 4\u20136 seconds. Therefore, the total time for one cycle of CPR is approximately 24 seconds. This timing ensures that compressions are provided effectively while minimizing interruptions for rescue breaths. Incorrect Answers: A: 15 seconds It is not feasible to complete a full cycle of 30 compressions and 2 breaths in just 15 seconds without compromising the quality of compressions or breaths. This duration is too short for adequate CPR. C: 30 seconds While 30 seconds is close to the average time needed, it slightly exceeds the recommended timeframe, which may reduce the overall effectiveness of resuscitation efforts. Prolonged pauses between cycles may also impair perfusion. D: 45 seconds Taking 45 seconds for one cycle would significantly slow down CPR, reducing the number of compressions delivered per minute and lowering the chances of maintaining adequate blood flow to the brain and heart. This timing is far too long and does not align with CPR guidelines.",
    "correct_choice_id": 200033,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/40514931698584276/40514931698584276.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/40514931698584276/40514931698584276.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50009,
    "choices": [
      {
        "id": 200036,
        "text": "Monitoring the effectiveness of ongoing CPR"
      },
      {
        "id": 200037,
        "text": "Prognostication of CPR"
      },
      {
        "id": 200038,
        "text": "Monitoring the metabolic acidosis due to cardiac arrest"
      },
      {
        "id": 200039,
        "text": "Confirming the success of CPR"
      }
    ],
    "text": "A 72 old patient is in intensive care following his coronary artery bypass grafting surgery 3 days back. He is intubated and on mechanical ventilation as his vitals are down and his ejection fraction has been keeping low. He is on an infusion of noradrenaline and dobutamine to keep his blood pressure normal and there is significant deterioration of his condition in the past 12 hours. Suddenly in the middle of the noon, this patient experienced a sudden cardiac arrest and the code blue team was paged and CPR was immediately started. The patient had an arterial line in place and a continuous capnography was also used to monitor the patient. Which of the following uses of capnography in this situation is justified except?",
    "unique_key": "Q7171843",
    "question_audio": null,
    "question_video": null,
    "map_id": 34404730,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Capnography has several roles at cardiac arrest: (i) Confirmation that the airway is patent and present within the trachea ( ongoing CPR) (ii) Monitoring ventilation rate during CPR and avoiding hyperventilation (iii) Assessing adequacy of chest compressions during CPR- an ETCO2 of more than 10mm hg is a sign of adequate CPR (iv) Identifying return of spontaneous circulation (ROSC) during CPR- sudden and abrupt rise of ETCO2 to normal value (around 40 mmhg) indicated ROSC (v) Prognostication during CPR- a consistently low ETCO2 (around 10 mmhg) even after prolonged resuscitation is a sign of poor prognosis in a patient with cardiac arrest.",
    "correct_choice_id": 200038,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50010,
    "choices": [
      {
        "id": 200040,
        "text": "Left groin exploration and control of hemorrhage"
      },
      {
        "id": 200041,
        "text": "CT angiogram with intervention"
      },
      {
        "id": 200042,
        "text": "Endotracheal intubation"
      },
      {
        "id": 200043,
        "text": "Large volume (>2 L) crystalloid resuscitation"
      }
    ],
    "text": "A 17-year-old male is brought to the trauma bay following a gunshot wound to the left groin. The patient is noted to be obtunded, and his Glasgow coma scale (GCS) is 7/15. EMS reports that the patient was found in a large pool of blood in an alleyway. The incident was not witnessed, and it is unclear how long the patient was down. The pressure is currently being held on the groin. Vitals include heart rate 127/min, blood pressure 82/40 mmHg, and respiratory rate 27/min. The patient is unable to provide any information. What is the immediate next best step in the management of this patient?",
    "unique_key": "Q4736562",
    "question_audio": null,
    "question_video": null,
    "map_id": 34976540,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) \u2022 As with any trauma, ATLS principles teach airway, breathing, circulation. \u2022 Given the patient's poor GCS, he is at risk for respiratory decline as he is unable to protect his airway. \u2022 The first step in trauma management should be endotracheal intubation. \u2022 Endotracheal tube insertion is achieved by the principle of RSI(Rapid Sequence Intubation). \u2022 Groin exploration is likely warranted in an emergent setting once primary and secondary trauma surveys are complete. \u2022 Interventional radiology (IR) intervention is not recommended for proximal extremity vascular injuries, and the patient is too unstable to take to IR. \u2022 Large volume(>1.5L) crystalloid resuscitation is associated with increased risk of mortality. \u2022 Volume resuscitation should proceed with blood products is preferred over large volume fluid resuscitation.",
    "correct_choice_id": 200042,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50011,
    "choices": [
      {
        "id": 200044,
        "text": "Continue the original pattern of CPR"
      },
      {
        "id": 200045,
        "text": "Increase the duration of compression"
      },
      {
        "id": 200046,
        "text": "Increase the rate of compression"
      },
      {
        "id": 200047,
        "text": "Increase the depth of sternal depression"
      }
    ],
    "text": "A 68-year-old man collapses in the middle of a mall. A good Samaritan immediately rushes to help the victim. He assesses the responsiveness and pulse and immediately starts cardiopulmonary resuscitation and calls for help by dialling 911. During cardiopulmonary resuscitation (CPR) he performs external chest compression at the rate of 90/min with 2 inches of sternal depression. The most appropriate action is to:",
    "unique_key": "Q4523879",
    "question_audio": null,
    "question_video": null,
    "map_id": 34794363,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Increase the rate of compression The rate of chest compressions during cardiopulmonary resuscitation (CPR) should be between 100 and 120 compressions per minute according to the American Heart Association (AHA) guidelines. In this scenario, the rescuer is performing chest compressions at 90/min, which is below the recommended rate. Increasing the rate to within the recommended range (100\u2013120/min) improves the chances of maintaining adequate blood flow to vital organs during CPR. Incorrect Options: A. Continue the original pattern of CPR This is incorrect because the current compression rate of 90/min is too slow. Adequate circulation during CPR depends on maintaining the recommended compression rate. Sticking to 90/min may result in inadequate perfusion to the brain and heart. B. Increase the duration of compression This is incorrect because the duration of chest compressions is not a focus in CPR. Instead, the emphasis is on achieving the correct rate (100\u2013120/min) and depth (at least 2 inches) of compressions. Increasing the duration of each compression may interfere with maintaining the appropriate compression rate. D. Increase the depth of sternal depression This is incorrect because the rescuer is already achieving the appropriate depth of 2 inches for chest compressions. Increasing the depth beyond the recommended range could cause injury to the patient, such as rib fractures or damage to internal organs.",
    "correct_choice_id": 200046,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50012,
    "choices": [
      {
        "id": 200048,
        "text": "Always analyse rhythm before starting CPR"
      },
      {
        "id": 200049,
        "text": "CPR should always be carried out for 2 minutes prior to defibrillation"
      },
      {
        "id": 200050,
        "text": "Two minutes of chest compressions alone (no ventilation) should be carried out prior to first shock"
      },
      {
        "id": 200051,
        "text": "If AED is available immediately then deliver one biphasic shock then five cycles of CPR"
      }
    ],
    "text": "Select the TRUE statement regarding cardiopulmonary resuscitation (CPR) and defibrillation by a health care provider in patients experiencing sudden cardiac arrest.",
    "unique_key": "Q3586704",
    "question_audio": null,
    "question_video": null,
    "map_id": 34683359,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) \u2022 Delays in either starting CPR or defibrillation reduce survival from SCA. \u2022 Thus the 2015 AHA Guidelines for CPR and ECC recommend that for adult witnessed cardiac arrests when an AED is immediately available, the defibrillator should be used as soon as possible. \u2022 For adults with unmonitored cardiac arrest or for whom an AED is not immediately available, it is reasonable that chest compressions be initiated while the defibrillator equipment is being retrieved and applied, and that defibrillation, if indicated, be attempted as soon as the device is ready for use. \u2022 Recall one cycle of CPR is 30 compressions and two breaths. \u2022 After the shock, continue CPR for five cycles, then check for a pulse",
    "correct_choice_id": 200051,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50013,
    "choices": [
      {
        "id": 200052,
        "text": "Perform a blind finger sweep to remove the food particle."
      },
      {
        "id": 200053,
        "text": "Heimlich manoeuvre"
      },
      {
        "id": 200054,
        "text": "CPR"
      },
      {
        "id": 200055,
        "text": "Chest compressions and back blows"
      }
    ],
    "text": "Man was eating food at a restaurant and suddenly started choking, what will be the next step in the management?",
    "unique_key": "Q7253059",
    "question_audio": null,
    "question_video": null,
    "map_id": 34965215,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Option A-Perform a blind finger sweep to remove the food particle is not done as it may stimulate gag reflex and patient may vomit and aspirate. Option B-Heimlich maneuver, or abdominal thrusts, lift your diaphragm and expel air from your lungs. This causes the foreign object to be expelled from your airway. Option C-CPR is done which patient suffers cardiac arrest. Option D-Chest compressions and back blows are given in pediatric patients.",
    "correct_choice_id": 200053,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/59524341698572292/59524341698572292.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/59524341698572292/59524341698572292.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50014,
    "choices": [
      {
        "id": 200056,
        "text": "Head tilt chin lift"
      },
      {
        "id": 200057,
        "text": "Jaw thrust"
      },
      {
        "id": 200058,
        "text": "MILS"
      },
      {
        "id": 200059,
        "text": "Neck extension"
      }
    ],
    "text": "What manoeuvre is shown in the image:<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/1(908).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q1598311",
    "question_audio": null,
    "question_video": null,
    "map_id": 34932534,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) The given image shows Head tilt chin lift.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/5(687).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200056,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/33014401698572386/33014401698572386.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/33014401698572386/33014401698572386.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50015,
    "choices": [
      {
        "id": 200060,
        "text": "All Option are correct"
      },
      {
        "id": 200061,
        "text": "only a & c"
      },
      {
        "id": 200062,
        "text": "Only B option is correct"
      },
      {
        "id": 200063,
        "text": "A,C, D are correct"
      }
    ],
    "text": "What are the components of high quality CPR ? A: Chest compressions at 100-120 per min B: ventilation 22-25 per min C: allow adequate recoil D: Upto 5-6 cms depth in adult",
    "unique_key": "Q4549130",
    "question_audio": null,
    "question_video": null,
    "map_id": 34629709,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer(D)",
    "correct_choice_id": 200063,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/38336261704707173/38336261704707173.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/38336261704707173/38336261704707173.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50016,
    "choices": [
      {
        "id": 200064,
        "text": "A,B,C,D,E"
      },
      {
        "id": 200065,
        "text": "C,D,A,E,B"
      },
      {
        "id": 200066,
        "text": "C,A,B,D,E"
      },
      {
        "id": 200067,
        "text": "C,B,A,D,E"
      }
    ],
    "text": "Arrange the correct sequence of steps in Basic Life Support (CPR) as per latest guidelines: a) check pulse & respiration b) call for help c) assess responsiveness d) start chest compressions e) start bag and mask",
    "unique_key": "Q3616483",
    "question_audio": null,
    "question_video": null,
    "map_id": 34353852,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Sequence: c) Assess responsiveness \u2022 The first step is always to check if the person is responsive. Shout at them and shake them gently to assess if they are conscious. If they don\u2019t respond, move to the next step. b) Call for help \u2022 Immediately call emergency services (or ask someone to do so). This step should be done right after checking for responsiveness to ensure help is on the way. a) Check pulse & respiration \u2022 Check for signs of life (pulse and breathing). This should be done as quickly as possible after calling for help. If there is no pulse and no breathing (or abnormal breathing like gasping), proceed to the next step. d) Start chest compressions \u2022 Start chest compressions immediately: 30 compressions at a depth of 2 inches (5 cm) at a rate of 100-120 per minute. Compressions are the priority to circulate oxygenated blood to vital organs. e) Start bag and mask (or rescue breaths) \u2022 After 30 compressions, if you're trained, provide 2 rescue breaths using a bag-mask or mouth-to-mouth. If you\u2019re untrained, continue compressions only until professional help arrives or an AED is available.",
    "correct_choice_id": 200067,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/3551251704707188/3551251704707188.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/3551251704707188/3551251704707188.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50017,
    "choices": [
      {
        "id": 200068,
        "text": "Rate of compression is 100-120/min"
      },
      {
        "id": 200069,
        "text": "Respiratory rate 20-25/min"
      },
      {
        "id": 200070,
        "text": "Depth of chest compressions is 5 to 6cm"
      },
      {
        "id": 200071,
        "text": "Allow adequate chest recoil"
      }
    ],
    "text": "Which of these is incorrect about CPR?",
    "unique_key": "Q5086661",
    "question_audio": null,
    "question_video": null,
    "map_id": 34013238,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) CPR is started when there is no pulse and no breathing. High Quality chest compressions include:- Option A-Push fast (100-120/min) Option B-Adequate ventilation (RR-10/min). Option C-Push hard (5-6cm depth) Option D-Allow complete chest recoil and Minimum interruptions in chest compression",
    "correct_choice_id": 200069,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50018,
    "choices": [
      {
        "id": 200072,
        "text": "Trachea suctioning, mouth suctioning"
      },
      {
        "id": 200073,
        "text": "Gentle suction of mouth and nose in vigorous baby"
      },
      {
        "id": 200074,
        "text": "Intrapartum suctioning"
      },
      {
        "id": 200075,
        "text": "Suctioning of mouth and nose after shoulder delivery in non-vigorous baby"
      }
    ],
    "text": "True for meconium stained liquor management is-",
    "unique_key": "Q5712238",
    "question_audio": null,
    "question_video": null,
    "map_id": 34199347,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Gentle suction of mouth and nose in vigorous baby is done. Endotracheal suctioning is not recommended anymore for non-vigorous, meconium stained baby. Meconium stained babies are managed the same as non-vigorous, clear amniotic fluid babies.",
    "correct_choice_id": 200073,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50019,
    "choices": [
      {
        "id": 200076,
        "text": "Head tilt, chin lift"
      },
      {
        "id": 200077,
        "text": "Jaw thrust"
      },
      {
        "id": 200078,
        "text": "Head extension"
      },
      {
        "id": 200079,
        "text": "In line manual stabilisation"
      }
    ],
    "text": "Identify the maneuver being performed in the given image<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/1(84).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q7539460",
    "question_audio": null,
    "question_video": null,
    "map_id": 34247126,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) The given maneuver performed in the given image is that of a head tilt chin lift. It is an important technique in emergency airway management to open up the airway. The airway is usually obstructed by posterior displacement of the tongue or epiglottis.",
    "correct_choice_id": 200076,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50020,
    "choices": [
      {
        "id": 200080,
        "text": "Unconsciousness with pulse and breathing absent"
      },
      {
        "id": 200081,
        "text": "Unconsciousness with pulse present and breathing absent"
      },
      {
        "id": 200082,
        "text": "Unconscious with pulse and breathing present"
      },
      {
        "id": 200083,
        "text": "Unconscious with pulse absent and breathing present."
      }
    ],
    "text": "During resuscitation, when is the given position indicated?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/3(45).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q7728044",
    "question_audio": null,
    "question_video": null,
    "map_id": 34759671,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A-CPR is done in Unconsciousness with pulse and breathing absent. Option B-Breaths are given in cases of unconsciousness with pulse present and breathing absent. Option C-The position illustrated in the picture is known as the recovery position, and it is used in the management of patients who are unconscious but with pulse present and breathing present. Option D-Unconscious with pulse absent and breathing present,such scenarios do not happen.",
    "correct_choice_id": 200082,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50021,
    "choices": [
      {
        "id": 200084,
        "text": "only a"
      },
      {
        "id": 200085,
        "text": "only a & b"
      },
      {
        "id": 200086,
        "text": "a,b & c"
      },
      {
        "id": 200087,
        "text": "a,c & d"
      }
    ],
    "text": "What are the components of quality CPR in adults? A. Compression rate 100-120/min B. Depth in adults 3-4 cm C. ventilation of 2 breaths for every 30 compressions D. Allow recoil",
    "unique_key": "Q8736224",
    "question_audio": null,
    "question_video": null,
    "map_id": 34912891,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) The 5 Components of High Quality CPR :- \u2022 Depth: 2\u20132.4 inches (5\u20136 centimeters) \u2022 Compression rate: 100\u2013120/minute. \u2022 Recoil: Allow for full recoil after each compression. \u2022 Minimize pauses in compressions. \u2022 Ventilation: 2 breaths after 30 compressions without an advanced airway; 1 breath every 6 seconds with an advanced airway.",
    "correct_choice_id": 200087,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/31592841721393590/31592841721393590.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/31592841721393590/31592841721393590.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50022,
    "choices": [
      {
        "id": 200088,
        "text": "CHEST COMPRESSION SHOULD BE ONE THIRD THE AP DIAMETER OF CHEST"
      },
      {
        "id": 200089,
        "text": "COMPRESSION TO VENTILATION RATIO IS 30:2 WITH 2 RESCUER"
      },
      {
        "id": 200090,
        "text": "ADENOSINE IS PREFFERED DRUG BY INTRAOSSEOUS ROUTE"
      },
      {
        "id": 200091,
        "text": "ADRENALINE IS USED AS 0.01 MG\\KG IN A 1:1000 DILUTION"
      }
    ],
    "text": "Regarding Pediatrics resuscitation, which is true ?",
    "unique_key": "Q8439580",
    "question_audio": null,
    "question_video": null,
    "map_id": 34533706,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) In pediatric resuscitation, the depth of chest compressions is crucial for effective cardiopulmonary resuscitation (CPR). Current guidelines, such as those from the American Heart Association (AHA) and European Resuscitation Council (ERC), recommend that chest compressions should be at least one-third the anterior-posterior (AP) diameter of the chest for both infants and children. This depth ensures adequate compression of the heart to generate blood flow without causing excessive injury. Therefore, option (A) is the correct statement. Let's look at why the other options are incorrect: B. COMPRESSION TO VENTILATION RATIO IS 30:2 WITH 2 RESCUER: This statement is incorrect for pediatric resuscitation with two rescuers. For single-rescuer pediatric CPR, the ratio is indeed 30 compressions to 2 ventilations. However, when two or more rescuers are present for pediatric CPR, the recommended compression-to-ventilation ratio is 15 compressions to 2 ventilations. This higher compression rate aims to minimize interruptions in chest compressions. C. ADENOSINE IS PREFERRED DRUG BY INTRAOSSEOUS ROUTE: While adenosine can be administered via the intraosseous (IO) route, it is typically used for the treatment of supraventricular tachycardia (SVT), not as a general preferred drug for resuscitation in cardiac arrest. The primary drugs for pediatric cardiac arrest are adrenaline (epinephrine), and other medications are given based on the specific rhythm. The choice of route (IV or IO) depends on vascular access availability, but adenosine itself is not the \"preferred drug\" in the broad context of pediatric resuscitation. D. ADRENALINE IS USED AS 0.01 MG/KG IN A 1:1000 DILUTION: This statement is partially incorrect. The recommended dose of adrenaline (epinephrine) for pediatric cardiac arrest is indeed 0.01 mg/kg. However, this dose is given as a 1:10,000 dilution, not 1:1,000. Using a 1:1,000 dilution at 0.01 mg/kg would result in a dose ten times higher than recommended, which can be dangerous. The 1:1,000 dilution is typically used for intramuscular administration in anaphylaxis, not for intravenous/intraosseous administration in cardiac arrest.",
    "correct_choice_id": 200088,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/6796781731673432/6796781731673432.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/6796781731673432/6796781731673432.m3u8",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '03  Cpr';
        const quizFilename = '03-cpr-c8916327.html';
        let hierarchy = ["DAMS", "DQB", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on navigation
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>