<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biostatistics Mini Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "If the systolic BP in a population has a mean of 130 mmHg and a median of 140 mmHg, the distribution is said to be:",
    "choices": [
      {
        "id": 1,
        "text": "Negatively skewed"
      },
      {
        "id": 2,
        "text": "Positively skewed"
      },
      {
        "id": 3,
        "text": "Symmetrical"
      },
      {
        "id": 4,
        "text": "Either negatively or positively skewed depending upon the standard deviation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This is a negatively skewed distribution.</p>\n<p>In any skewed distribution (i.e., positive or negative), the median will always fall in between the mean and the mode.</p>\n<p>For a<strong> positively skewed distribution</strong>, the <strong>mean</strong> will always be the <strong>highest</strong> estimate of central tendency, and the <strong>mode</strong> will always be the<strong> lowest</strong> estimate of central tendency (assuming that the distribution has only one mode).</p>\n<p>For <strong>negatively skewed distributions</strong>, the <strong>mean</strong> will always be the <strong>lowest</strong> estimate of central tendency, and the<strong> mode</strong> will be the <strong>highest</strong> estimate of central tendency.</p>\n<p>In this scenario, the median is greater than the mean. As the median lies at a point in between the mean and the mode, this indicates a negatively skewed distribution.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tests of significance and data group for which it is used, is incorrectly paired?",
    "choices": [
      {
        "id": 1,
        "text": "ANOVA - test difference between 3 different groups"
      },
      {
        "id": 2,
        "text": "Student's t test - test difference between 2 independent groups"
      },
      {
        "id": 3,
        "text": "Chi square test - test difference between two quantitative variables"
      },
      {
        "id": 4,
        "text": "Paired t test - test before and after data"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Chi-square test is a nonparametric test that assesses the significance of association between two<strong> qualitative </strong>variables.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As an intern in the community medicine department , you are asked to study about the various graphical representation of data. What is the following graph best used for ?",
    "choices": [
      {
        "id": 1,
        "text": "Calculate line of best fit"
      },
      {
        "id": 2,
        "text": "Survival time analysis"
      },
      {
        "id": 3,
        "text": "Correlating risk factors of a disease"
      },
      {
        "id": 4,
        "text": "Studying the periodic trends of disease over time"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The graph depicted is a <strong>Kaplan-Meier plot,</strong> and the graph is used for <strong>survival time analysis</strong>.</p>\n<p>Survival time analysis includes the study of:</p>\n<ul>\n<li>What is the <strong>survival time </strong>of patients with a <strong>given disease</strong></li>\n<li>How does this survival time <strong>compare</strong> between <strong>two groups of patients</strong> given <strong>different treatments</strong> for the same disease</li>\n<li>Among those who survive up to a certain time, at what <strong>time </strong>or<strong> rate</strong> can they be <strong>expected to die</strong></li>\n<li>What factors, such as <strong>risk factors </strong>or<strong> treatments</strong>, affect the survival time</li>\n</ul>\n<p>Despite its name, survival analysis can be used to help answer questions of this kind about <strong>any</strong> <strong>kind of event</strong>,<strong> </strong>not just death\u2014such as how long it takes before a hip replacement fails, how long it takes before a patient has a second heart attack, or how long it takes for coronary stents to become re-stenosed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d02246edf1784b01a26c032aa7edb25b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/abe0cb8530534f39821033e560e89347x1280x1438.JPEG",
      "https://cdn1.dailyrounds.org/uploads/d6aa028cd30946338ffa23d13698eb3a.PNG"
    ]
  },
  {
    "text": "Identify the plots with the maximum interquartile range and the least median respectively.",
    "choices": [
      {
        "id": 1,
        "text": "2, 3"
      },
      {
        "id": 2,
        "text": "1, 2"
      },
      {
        "id": 3,
        "text": "3, 4"
      },
      {
        "id": 4,
        "text": "4, 1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The graph shown is a boxplot where Plot 1 has the maximum interquartile range and Plot 2 has the least median.</p>\n<p>A\u00a0<strong>b</strong><strong>oxplot</strong> is a method for graphically depicting groups of numerical data through their\u00a0quartiles. Box plots may also have lines extending vertically from the boxes (whiskers), indicating variability outside the upper and lower quartiles, hence the terms\u00a0<strong>box-and-whisker plot.\u00a0</strong></p>\n<p>It shows the five-number summary of a set of data as shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6ac3bd5123aa44c4a9491f928faaf64e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae47617f3ad445079ab98f54a215a138x1279x1345.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e3b7494c46a54f7985be235269bf7681x1280x1233.JPEG"
    ]
  },
  {
    "text": "The results of a meta-analysis of studies comparing a novel drug for diabetes to a reference drug are given below. Which of the following conclusions can be drawn from it?",
    "choices": [
      {
        "id": 1,
        "text": "Study E has the lowest sample size."
      },
      {
        "id": 2,
        "text": "Studies A and C are statistically significant."
      },
      {
        "id": 3,
        "text": "The novel drug is better than the reference drug."
      },
      {
        "id": 4,
        "text": "Studies D and E cross the line of no effect."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shown is that of a <strong>forest plot</strong>. It is\u00a0used for plotting the results of a <strong>meta-analysis. </strong>Since the <strong>diamond </strong>at the bottom, which represents the<strong> overall pooled results</strong> of all the studies, corresponds to<strong> </strong>a <strong>risk\u00a0ratio of 2.2</strong>, it indicates that the <strong>novel drug </strong>is<strong> better </strong>than the reference drug.</p>\n<p>In the plot for each study, the<strong> size </strong>of the<strong> rectangle</strong> represents<strong> </strong>the <strong>sample size</strong>. In this case, study 'E' has the largest sample size (option A). The<strong> horizontal line on either side </strong>of the rectangle <strong>represents </strong>the <strong>95% confidence interval </strong>for that study.</p>\n<p>The solid <strong>vertical line</strong> that corresponds to the <strong>odds ratio</strong> of <strong>1</strong> is called the<strong> line of no effect</strong>. It <strong>indicates</strong> that there is <strong>no significant difference</strong> between the reference and the novel drug. Any<strong> </strong>study line that <strong>crosses</strong> the line of no effect becomes an<strong> insignificant study</strong>. So studies A, B, and C are statistically insignificant (option B).</p>\n<p>The dotted vertical line in the center represents the <strong>aggregate risk ratio</strong> and is not the line of no effect. Studies D and E do not cross the line of no effect (option D).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80aef7ea46774a89a4d2677f218bb4da.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A chi-square test contingency table has 5 rows and 4 columns. What would be the degree of freedom in this case?",
    "choices": [
      {
        "id": 1,
        "text": "9"
      },
      {
        "id": 2,
        "text": "12"
      },
      {
        "id": 3,
        "text": "16"
      },
      {
        "id": 4,
        "text": "20"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The degrees of freedom in this case would be <strong>12.</strong></p>\n<p>A chi-square\u00a0<strong>contingency table</strong>\u00a0has one variable in rows and another in columns. In such cases,\u00a0the <strong>degrees of freedom (df) = (r-1) (c-1)</strong>, where <strong>r </strong>is the<strong> number of rows</strong> and <strong>c </strong>is the<strong> number of columns</strong>.</p>\n<p>As the above contingency table has <strong>5 rows</strong> and <strong>4 columns</strong>, the degree of freedom in this case is given as:</p>\n<p>df = (5 \u2013 1) (4 \u2013 1) = 12</p>\n<p>The degree of freedom is an expression of sample size for t tables. df is given as<strong> n-1</strong>, where n refers to the sample size.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A standard normal distribution is a normal distribution with:",
    "choices": [
      {
        "id": 1,
        "text": "Mean of 1 and a standard deviation of 0"
      },
      {
        "id": 2,
        "text": "Mean of 0 and a standard deviation of 1"
      },
      {
        "id": 3,
        "text": "Area under the curve = 100"
      },
      {
        "id": 4,
        "text": "Area under the curve = 0"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A standard normal distribution is a normal distribution with a <strong>mean of 0 </strong>and a<strong> standard deviation of 1.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A narrow confidence interval corresponds to all of the following, except _________.",
    "choices": [
      {
        "id": 1,
        "text": "Larger standard error"
      },
      {
        "id": 2,
        "text": "Large sample size"
      },
      {
        "id": 3,
        "text": "Decreased variability in the sample"
      },
      {
        "id": 4,
        "text": "More precision"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>narrow confidence interval</strong> corresponds to a\u00a0<strong>smaller standard error</strong>\u00a0and not a larger standard error.\u00a0</p>\n<p>Confidence interval = Mean\u00a0<strong>\u00b1\u00a0</strong>2 standard error. Therefore, a smaller standard error results in a narrower confidence interval.</p>\n<p>Research is usually done with samples drawn from a population rather than by using the entire population. In order to get a fair idea of the population parameters, sample statistics and estimates of error in the sample are used to get a range of values. This range is the <strong>confidence interval (CI)</strong>. It is estimated based on a desirable confidence level.</p>\n<p>The<strong> confidence interval</strong> is calculated as the <strong>difference </strong>between<strong> upper </strong>and <strong>lower confidence limits.\u00a0</strong></p>\n<p>The width of the CI is an indication of the utility of our population parameter estimation. Factors affecting the width of the confidence interval include:</p>\n<ul>\n<li>Desired confidence level: the width of the CI is directly proportional to the confidence level</li>\n<li><strong>Variability</strong> in the sample: the width of the CI is <strong>directly proportional</strong> to the variability in the data\u00a0</li>\n<li><strong>Sample size:</strong>\u00a0the width of the CI is <strong>inversely</strong> related to the sample size</li>\n</ul>\n<p>Therefore, <strong>increases</strong> in <strong>variability</strong> and <strong>confidence levels\u00a0</strong>and<strong>\u00a0decreases in sample size</strong> lead to <strong>wider confidence intervals.</strong>\u00a0</p>\n<p><strong>Standard error</strong> = SD/\u221a n, where SD is the standard deviation and n is the sample size. The standard error will reduce when the sample size is increased. Thus, the confidence interval will decrease in proportion to the square root of the sample size.\u00a0</p>\n<p class=\"p1\"><strong>Precision</strong> is the degree to which a particular value (such as an estimate of a population mean) is immune from random variation. A <strong>narrow confidence interval</strong> indicates <strong>more precision,</strong> while a wider confidence interval indicates less precision.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a statistical analysis, the following scatter plot is obtained. What is the inference about the correlation coefficient according to the plot?",
    "choices": [
      {
        "id": 1,
        "text": "There is a linear negative correlation with correlation coefficient equal to -1"
      },
      {
        "id": 2,
        "text": "There is a linear positive correlation with correlation coefficient equal to +1"
      },
      {
        "id": 3,
        "text": "There is a linear positive correlation with correlation coefficient equal to zero"
      },
      {
        "id": 4,
        "text": "There is a linear negative correlation with correlation coefficient equal to zero"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above scatter plot shows a linear <strong>positive correlation</strong>, with the<strong> correlation coefficient</strong> +1 [rise in the value of (X) proportionately raises the value of (Y)]</p>\n<p>The correlation coefficient can be determined using the appearance of the scatter plot. In the given scatter plot, <strong>all the plotted points</strong> can fit a <strong>straight line</strong> perfectly. Hence the <strong>correlation coefficient is +1</strong>. Conversely, if it is <strong>not possible</strong> to draw a <strong>straight line</strong> that would fit the plotted points, the <strong>correlation coefficient</strong> would be <strong>zero</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/623c895c038d4aa4be82e7bf5e847b9f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following sampling technique is depicted in the image below:",
    "choices": [
      {
        "id": 1,
        "text": "Simple random sampling"
      },
      {
        "id": 2,
        "text": "Stratified random sampling"
      },
      {
        "id": 3,
        "text": "Snowball sampling"
      },
      {
        "id": 4,
        "text": "Cluster sampling"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image depicts the technique of stratified random sampling. A <strong>stratified random sample</strong> is obtained by:</p>\n<ol>\n<li><strong>Separating the population</strong> into non-overlapping groups called strata</li>\n<li>Then obtaining a<strong> proportional simple random sample</strong> from each group</li>\n<li>The individuals within each group should be similar in some way</li>\n</ol>\n<p>This method of sampling avoids bias for being discriminatory for a particular group.</p>\n<p>Option A) <strong>Simple random sampling:</strong> Sample drawn in such a way that every element in the population has an equal probability of being included.</p>\n<p>Option C) <strong>Snowball sampling:</strong> This method is used when the population cannot be located in a specific place, and therefore, it is difficult to access this population.</p>\n<p>Option D) <strong>Cluster sampling:</strong> This method is used when creating a sampling frame is nearly impossible due to the large size of the population. In this approach, the population is divided into clusters based on geographic location. A list of all clusters is created, and investigators randomly select a number of clusters to be included. Next, they list all individuals within these selected clusters and conduct another round of random selection to obtain a final random sample, similar to simple random sampling. This method is called multistage sampling because the selection process occurs in two stages: first, the selection of eligible clusters, and second, the selection of individuals from within those clusters.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fcb62416c35f4362b1694ff4137708bd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statistical tests will you use to compare the C-reactive protein (CRP) levels in 3 patient groups treated with different drugs: remdesivir (Group 1), hydroxychloroquine (Group 2), and systemic steroids (Group 3)?",
    "choices": [
      {
        "id": 1,
        "text": "Unpaired t-test"
      },
      {
        "id": 2,
        "text": "Paired t-test"
      },
      {
        "id": 3,
        "text": "Chi-square test"
      },
      {
        "id": 4,
        "text": "ANOVA"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>An analysis of variance test (<strong>ANOVA)</strong>\u00a0is used to compare the means among <strong>three or more groups</strong>.\u00a0</p>\n<p>The <em>t</em>-test and analysis of variance (ANOVA) are statistical methods used in the testing of hypotheses for the comparison between the means of groups.</p>\n<p>The independent <em>t</em> test, also called the <strong>unpaired\u00a0<em>t-</em>test</strong>, is a statistical test that determines whether there is a statistically significant difference between the means in two unrelated (independent) groups. A comparison between BMI in males and in females of a population is an example of a case where an unpaired <em>t</em>-test is used.</p>\n<p>The <strong>paired <em>t</em>-test</strong> compares paired data, or pre-intervention and post-intervention data, of the same group. If a study were to compare BP in a group of patients before and after treatment, then a paired t-test would be used.</p>\n<p><strong>Chi-Square test (\u03c7<sup>2</sup>)</strong>\u00a0is a\u00a0<strong>non-parametric (non-numeric) test,\u00a0</strong>and it is used to test hypotheses in relation to\u00a0<strong>nominal scale data or categorical data. </strong>In the given study,<strong>\u00a0</strong>if CRP levels in each group were categorized as high and low and the three groups were then compared, then the chi-square test would be used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hemoglobin (Hb) levels were measured in 200 pregnant women and a mean value of 10.5 g/dL was obtained with a standard deviation of 0.5 g/dL. Assuming a normal distribution, what is the percentage of the study population with Hb <10g/dL?",
    "choices": [
      {
        "id": 1,
        "text": "32%"
      },
      {
        "id": 2,
        "text": "16%"
      },
      {
        "id": 3,
        "text": "68%"
      },
      {
        "id": 4,
        "text": "95%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>16% </strong>of the study population would have a <strong>Hb &lt;10 g/dL.</strong></p>\n<p>Assuming a normal distribution, if the mean is 10.5 g/dL, <strong>68%</strong> of the study population would have an <strong>Hb between 10-11 g/dL</strong>, being within <strong>1 standard deviation.\u00a0</strong></p>\n<p>This means that, of the remaining population of <strong>32% (100-68=32) </strong>falling outside 1 standard deviation, half of them, i.e., \u00bd of 32% = <strong>16%, </strong>would have a <strong>Hb &lt;10 g/dL</strong> and <strong>16% </strong>would have a <strong>Hb &gt;11 g/dL.</strong></p>\n<p>In a normal distribution, the distribution of values around the mean is as follows:</p>\n<ul>\n<li>68% of the distribution falls within <strong>\u00b11 SD</strong> of the mean</li>\n<li>95% of the distribution falls within <strong>\u00b12 SD</strong> of the mean</li>\n<li>99.7% of the distribution falls within <strong>\u00b13 SD</strong> of the mean</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3fa0722f02234f549d26688e42a86a5bx1280x1219.JPEG"
    ]
  },
  {
    "text": "Which of the following leads to an increase in the power of a statistical test?",
    "choices": [
      {
        "id": 1,
        "text": "Increasing sampling error"
      },
      {
        "id": 2,
        "text": "Increasing beta"
      },
      {
        "id": 3,
        "text": "Decreasing alpha"
      },
      {
        "id": 4,
        "text": "Increasing sample size"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Increasing</strong> the <strong>sample size</strong> will<strong> increase</strong> the <strong>power</strong> of a study. In fact, increasing the sample size is the most practical and most <strong>important</strong> way of increasing the power of a study.</p>\n<p>Other factors that increase the power of a study are:</p>\n<ul>\n<li>Increasing <strong>alpha</strong></li>\n<li>Decreasing <strong>beta</strong></li>\n<li>Decreasing <strong>sampling error</strong></li>\n<li>Increasing<strong> effect size </strong>(increase in difference between sample mean and hypothesized population mean)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following concepts in the hypothesis testing is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Alpha is the maximum tolerable probability of a type 1 error being made"
      },
      {
        "id": 2,
        "text": "Beta is the probability of a type II error"
      },
      {
        "id": 3,
        "text": "When the null hypothesis is true but rejected, it is a type II error"
      },
      {
        "id": 4,
        "text": "P value can be more or less than alpha"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>When the null hypothesis is true but is yet rejected, it is a <strong>type I error</strong>.</p>\n<p><strong>Type II errors</strong> are when an <strong>alternative hypothesis </strong>is<strong> rejected </strong>even though it is<strong> true</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A study on mood stabilizers shows that a new drug X works faster to stabilize mood than the standard drug Y. The results are statistically significant. The study is carried out 100 different times and shows such significant differences 95 times. Which of the following accurately characterizes the probability of not detecting a correlation between X and Y in this study?",
    "choices": [
      {
        "id": 1,
        "text": "5%"
      },
      {
        "id": 2,
        "text": "95%"
      },
      {
        "id": 3,
        "text": "80%"
      },
      {
        "id": 4,
        "text": "10%"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The likelihood of not detecting a correlation between X and Y is nothing but a <strong>type II error</strong> or a <strong>beta</strong> <strong>error</strong> which is 5%.</p>\n<p>A<strong> type II error</strong> is the probability of <strong>rejecting</strong> the <strong>alternate</strong> hypothesis when it is <strong>true</strong>. It is also known as a <strong>beta</strong> <strong>error</strong>.</p>\n<p>In this case, it is the chance of saying the experimental <strong>drug does not work</strong> better than the standard drug, <strong>while it does</strong>. This happened in 5/100 studies, hence the likelihood of a type II error (beta) is 5%.</p>\n<p>Note: <strong>Power = 1- beta. </strong>Here, the power of the study is 95%.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A study is conducted to assess the blood pressures of people in different cities. Sample sizes of different cities 1, 2, and 3 are 1000, 800, and 600 respectively.  Three normal distribution curves of different sample sizes of the three cities are given below in the image. The X-axis shows the standard deviation from the mean blood pressure. The order of margin of error will be ____________.",
    "choices": [
      {
        "id": 1,
        "text": "3 >2>1"
      },
      {
        "id": 2,
        "text": "3>1>2"
      },
      {
        "id": 3,
        "text": "1>2>3"
      },
      {
        "id": 4,
        "text": "1=2=3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Curve 1 has the least margin of error, followed by curve 2 and then curve 3. So the order is<strong> 3&gt;2&gt;1.</strong></p>\n<p>The image shows three normal distribution curves of different sample sizes, having the same mean but different standard deviation.</p>\n<p>As the sample size is decreasing, the peak decreases and the curve becomes flatter, implying a <strong>wider confidence interval</strong> for the given mean.</p>\n<p>The\u00a0<strong>margin of error</strong>\u00a0is a statistic expressing the amount of random sampling error in the results of a survey. The larger the\u00a0margin of error, the less confidence.</p>\n<p>The<strong> width of the base</strong> of the curve is <strong>directly proportional </strong>to the<strong> margin of error.</strong>\u00a0</p>\n<ul>\n<li>Many data such as blood pressure, heights, IQ scores, etc., form a normal distribution</li>\n<li>A standard<strong> normal distribution</strong>\u00a0is a normal distribution with a\u00a0<strong>mean of 0</strong>\u00a0and a\u00a0<strong>standard deviation of 1</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fc3fa7fb17dd48dd9fe32c76f181ab57.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is depicted in a tree diagram?",
    "choices": [
      {
        "id": 1,
        "text": "Possible outcomes of an event"
      },
      {
        "id": 2,
        "text": "Relationship between two quantitative variables"
      },
      {
        "id": 3,
        "text": "Trend of events"
      },
      {
        "id": 4,
        "text": "Overlapping events"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>tree diagram</strong> is used mainly to chart the <strong>possible outcomes</strong> of a <strong>sample event</strong>.</p>\n<p>The following image shows the outline of a tree diagram.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8b7be39116a74ccf9e4523fb63e42d8cx600x518.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02d7cf24c12a4f94b05a2167e02a2fc5x630x629.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4241cc91948a405c882b51a0e59fbabfx1024x1024.PNG"
    ]
  },
  {
    "text": "An epidemiologist is calculating the incubation period for measles in children aged 2 to 14 years. He was assigned a rural area with a sizeable portion of unvaccinated children and adolescents. He takes the sample size as 100. The median incubation period is 10 days, and the standard deviation he obtains is 4. What will be the standard error in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "0.4"
      },
      {
        "id": 2,
        "text": "1.0"
      },
      {
        "id": 3,
        "text": "2.0"
      },
      {
        "id": 4,
        "text": "0.5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The formula for standard error is <strong>SE = standard deviation/ square root of sample size.</strong></p>\n<p>In this scenario, the standard error = 4/10 = <strong>0.4</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An association between ordinal position on one ranking and ordinal position on another ranking can be determined by which of the following techniques?",
    "choices": [
      {
        "id": 1,
        "text": "Chi-square test"
      },
      {
        "id": 2,
        "text": "Paired t-test"
      },
      {
        "id": 3,
        "text": "ANOVA"
      },
      {
        "id": 4,
        "text": "Spearman's rank-order correlation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\"><strong>Spearman's rank-order correlation\u00a0</strong>is used to determine the <strong>association between</strong> <strong>ordinal</strong> <strong>position</strong> on one ranking and ordinal position on another ranking.</p>\n<p class=\"p1\">It is one of the two most commonly used correlation coefficients. It is\u00a0used for <strong>ordinal scale data</strong>. The other one is <strong>Pearson product-moment correlation</strong>, which is used for <strong>interval or ratio scale data.</strong></p>\n<p>The\u00a0<strong>Chi-Square test (\u03c7<sup>2</sup>)</strong>\u00a0is a\u00a0non-parametric (non-numeric) test,<strong> </strong>and\u00a0it is used to test hypotheses in relation to\u00a0<strong>nominal scale data or categorical data.</strong></p>\n<ul>\n<li>It is a\u00a0test of proportions and associations.</li>\n<li>A Chi-square distribution is usually<strong> positively skewed, </strong>but it approaches a normal distribution as its degrees of freedom increase.</li>\n<li>If the\u00a0frequency of any of the cells of the categorical table is&lt;5, then\u00a0<strong>Fisher\u2019s exact test</strong>\u00a0is used.</li>\n</ul>\n<p>A<strong> paired t-test</strong> compares paired data, or pre-intervention and post-intervention data, of the same group.</p>\n<p>The analysis of variance test (<strong>ANOVA)</strong>\u00a0is used to test the difference between two or usually<strong>\u00a0more than two groups (means),\u00a0</strong>and here, the inferences are made by analyzing the variances.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following variables is measured on the nominal scale?",
    "choices": [
      {
        "id": 1,
        "text": "A, B, O blood groups"
      },
      {
        "id": 2,
        "text": "Glasgow coma scale"
      },
      {
        "id": 3,
        "text": "Intelligence quotient"
      },
      {
        "id": 4,
        "text": "Respiratory rate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Among the given options, the <strong>A, B, O blood groups</strong> can be measured on a<strong> nominal</strong> scale.</p>\n<p>Data will always fall into one of the following four scales:</p>\n<ul>\n<li>Nominal</li>\n<li>Ordinal</li>\n<li>Interval</li>\n<li>Ratio</li>\n</ul>\n<p><strong>Nominal scale data</strong> can be divided into <strong>qualitative</strong> categories or groups. Examples include <strong>male/female</strong>, black/white, or red/green. No order or ratio from the data is implied. Nominal data that falls exclusively into two groups is known as <strong>dichotomous data</strong>. A, B, O blood groups can be clearly divided into qualitative groups and hence can be measured on a nominal scale.</p>\n<p><strong>Ordinal scale data</strong> holds meaning when it is placed in a <strong>particular order</strong>. An example is the ranking of students in a class. But, there is no information about the interval size. This means that the difference between the marks of the first and second students may or may not be the same as the difference between the second and third. An example is the <strong>Glasgow coma scale\u00a0</strong>and <strong>Child-Pugh score</strong>.</p>\n<p><strong>Interval scale data</strong> is similar to ordinal data because it can be placed in a meaningful order. Additionally, they have meaningful <strong>intervals</strong> between the items, usually <strong>measurable quantities</strong>. For example, the difference between 100\u00b0 and 90\u00b0 is the same as that between 50\u00b0 and 40\u00b0 on the temperature scale. But these scales do not have absolute zeroes, which makes ratios between the items meaningless.\u00a0</p>\n<p><strong>Ratio scale data</strong> have similar properties to interval scale data. In addition, they have an <strong>absolute zero</strong>. Most biomedical variables can be measured on a ratio scale. Examples are weight in pounds or grams, pulse rate in beats/minute, and blood pressure in millimeters of mercury. A pulse rate of 0 indicates a lack of pulse, and a rate of 120/minute is twice as fast as a rate of 60/minute.\u00a0This means it is possible to calculate <strong>meaningful ratios</strong>.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: Glasgow coma scale can be measured on the <strong>ordinal</strong> scale.</p>\n<p>Option C: Intelligence quotient\u00a0can be measured on the <strong>interval</strong>\u00a0scale.</p>\n<p>Option D: Respiratory rate<strong>\u00a0</strong>can be measured with the <strong>ratio</strong> scale.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Biostatistics Mini Test';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>