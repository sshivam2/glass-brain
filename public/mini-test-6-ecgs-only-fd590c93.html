<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 6- Ecgs Only - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient's ECG strip is given below. His cardiac output was found to be 4.8 L/min. What is the stroke volume?",
    "choices": [
      {
        "id": 1,
        "text": "100 ml"
      },
      {
        "id": 2,
        "text": "60 ml"
      },
      {
        "id": 3,
        "text": "120 ml"
      },
      {
        "id": 4,
        "text": "80 ml"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Cardiac output is calculated by the following formula -</p>\n<p>Cardiac output = Heart rate x Stroke volume</p>\n<p>The patient's <strong>cardiac output is 4.8L/min</strong>.</p>\n<p>His heart rate can be calculated from the rhythm strip given i.e., HR = 300/number of large squares between consecutive beats. There are approximately 5 large boxes between beats in this ECG.</p>\n<p><strong>HR = 300/5 = 60 beats/min.</strong></p>\n<p>Therefore, the patient's stroke volume = CO/HR = 4.8L/min/60 beats/min = 0.08 L = <strong>80ml</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/55e0754e85aa4cd3aa9a9395929311b3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man presents with complaints of sudden onset pleuritic chest pain and dyspnea. On examination, his heart rate is 122 beats/minute and jugular venous pressure is elevated. Split S2 is heard on ascultation. He underwent inguinal hernia repair 3 weeks ago and was treated for deep vein thrombosis 6 months ago. His ECG findings are given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary embolism"
      },
      {
        "id": 2,
        "text": "Pleural effusion"
      },
      {
        "id": 3,
        "text": "Acute pericarditis"
      },
      {
        "id": 4,
        "text": "Tricuspid stenosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario along with signs of acute <strong>cor pulmonale</strong> (right heart dysfunction) and ECG showing <strong>S1Q3T3</strong> changes is most likely suggestive of acute\u00a0<strong>pulmonary embolism </strong>(PE).\u00a0</p>\n<p>Pulmonary embolism is very likely in this patient as his <strong>modified Well's score is 4.5</strong>\u00a0(&gt;4 = PE likely):</p>\n<ul>\n<li>Heart rate &gt;100 beats/min- score 1.5</li>\n<li>Recent history of immobilization due to abdominal surgery- score 1.5</li>\n<li>Past history of deep vein thrombosis- score 1.5</li>\n</ul>\n<p>ECG changes in acute PE (shown below) are characterized by the classic <strong>S1Q3T3 changes</strong>, due to right ventricular strain and ischemia:</p>\n<ul>\n<li>A prominent S wave in lead I (blue arrow)</li>\n<li>Q wave in lead III (red arrow)</li>\n<li>An inverted T wave in lead III (green arrow)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f7083ed4efab47839b5d89c15708140a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5fbde789390b41b783e3cf0731d70596x1280x879.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1c10c94c96848bcb3eb7a4820dce995x1200x1743.JPEG"
    ]
  },
  {
    "text": "A 64-year-old man presents with complaints of palpitations and syncope. He has a history of inferior-wall myocardial infarction a year ago. The ECG strip obtained during his admission is given below. What is the long-term treatment for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Amiodarone"
      },
      {
        "id": 2,
        "text": "Atropine only"
      },
      {
        "id": 3,
        "text": "Permanent pacemaker"
      },
      {
        "id": 4,
        "text": "Atropine and isoproterenol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Based on his ECG findings, this patient is suffering from\u00a0<strong>symptomatic </strong>(palpitations, syncope)\u00a0<strong>Mobitz Type II AV block</strong>. The definitive long-term treatment is, therefore, a\u00a0<strong>permanent pacemaker.\u00a0</strong></p>\n<p>Mobitz Type II AV block is characterized by:</p>\n<ul>\n<li>a <strong>constant PR interval</strong></li>\n<li>some P waves not be followed by QRS complexes</li>\n</ul>\n<p>According to the rhythm strip (Lead II) of the ECG shown, the patient is experiencing a <strong>3:2 AV block</strong> which is then progressing to a 2:1 AV block.</p>\n<p>This patient is also suffering from a <strong>right bundle branch block</strong>\u00a0(RBBB)<strong>\u00a0</strong>as indicated by the wide QRS complexes in leads V1, V2, and <strong>V3 ('M'-shaped)</strong>.\u00a0</p>\n<p>This patient with a history of ischemic heart disease (previous history of inferior-wall MI) and objective signs of Mobitz Type II AV block and RBBB will benefit most from a permanent pacemaker.\u00a0</p>\n<p>In the ECG below, the <strong>blue arrows</strong> show\u00a0some <strong>P waves</strong> that were not followed by QRS complexes. The <strong>missed QRS complex</strong> is pointed by the <strong>red arrow</strong>. The <strong>red box</strong> indicates the <strong>wide QRS complexes</strong>\u00a0in leads V1, V2, and V3:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4aad04e5c1c4043bdb02d3835b5d743.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9b0310f1672747cb9a200242d8371321x765x510.PNG"
    ]
  },
  {
    "text": "The ECG of a patient with systemic hypothermia is given below. The findings marked in the image are described as:",
    "choices": [
      {
        "id": 1,
        "text": "Delta waves"
      },
      {
        "id": 2,
        "text": "Osborn waves"
      },
      {
        "id": 3,
        "text": "Epsilon waves"
      },
      {
        "id": 4,
        "text": "Saw-tooth waves"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> Osborn wave </strong>(J wave) is a <strong>positive deflection</strong> seen at the <strong>J point </strong>in precordial and true limb leads as seen in the given electrocardiogram. It is most commonly associated with <strong>hypothermia.</strong></p>\n<p>Osborn waves may be seen in the ECG of patients with <strong>systemic hypothermia</strong>. They are observed as a <strong>hump-like elevation</strong> at the <strong>junction</strong> of the <strong>QRS complex</strong> and <strong>ST segment</strong>. An alteration in the ventricular transmural action potential is attributed to their appearance on an ECG.</p>\n<p>The J wave can be accentuated in hypothermia and<strong> hypercalcemia</strong>. Spontaneous accentuation of the J wave may predispose to ventricular arrhythmias (polymorphic VT and VF).</p>\n<p>Other options:</p>\n<p>Option A:<strong>\u00a0Delta wave</strong> is the slurred <strong>upstroke</strong> of the <strong>QRS complex</strong> as seen during ventricular pre-excitation, a feature of <strong>Wolff-Parkinson-White syndrome</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d8bd1dfec5994af496037acb94da06d3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/981b619bcd7a4bb38367d2151a37af1cx800x224.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7aa54a13fec04b709d578e320443e598x800x534.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/94cbd96b56b047b8a065d7477c90014cx798x264.JPEG"
    ]
  },
  {
    "text": "A patient presenting with lightheadedness and syncope was admitted to the emergency department. The ECG obtained is shown below. His symptoms did not resolve with carotid sinus massage or adenosine. Which of the following mechanisms is responsible for the changes marked by the blue arrows?",
    "choices": [
      {
        "id": 1,
        "text": "P wave causing normal sinus beat"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Fusion of 2 independent impulses"
      },
      {
        "id": 4,
        "text": "Ventricular preexcitation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given ECG shows&nbsp;<strong>ventricular tachycardia,</strong>&nbsp;and the blue arrows indicate&nbsp;<strong>fusion beats,&nbsp;</strong>which are caused by the fusion of 2 independent electrical impulses.&nbsp;</p>\n<p><strong>Ventricular tachycardia</strong> (VT) is a type of ventricular arrhythmia characterized by a ventricular rate <strong>exceeding 100 beats per minute</strong>, for <strong>three or more</strong> consecutive beats. It may be caused either due to the automatic origin of impulses from the Purkinje cells, myocardial cells, or reentry of the impulses to the ventricles through the scarred tissues.&nbsp;</p>\n<p>Patients will present with&nbsp;palpitations because of increased heart rate. Ineffective contractions of ventricles lead to dizziness, exercise intolerance, episodes of lightheadedness, and syncope.</p>\n<p>ECG findings are characterized by the presence of atrioventricular dissociation, that is, atria and ventricles have different rates of contraction. This is because the <strong>ectopic impulses </strong>originating in the<strong> ventricles</strong> cause them to contract independent of the impulses transmitted from the atria. Ventricular impulses give rise to the <strong>broad QRS</strong> complexes (&gt;120 msec) as seen in the ECG given.</p>\n<p>In some instances, when a P wave is conducted down the AV node to the ventricles, it fuses with the impulse originating from the ventricle. This gives rise to the classic&nbsp;<strong>fusion beat,</strong>&nbsp;as seen in the image below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6efb396c47ca452997b5c175461738b2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dc3de9d0af494f70978dcc1de68ed0e7x720x308.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44983dbe535f4d2ea46dc2d4900bf591x657x234.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2e09d0f77c9b4296ab1f2b724b7c84d8x720x184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8716ba9a652449c9b4931c916d91471ax507x343.JPEG"
    ]
  },
  {
    "text": "Given below is the ECG of a patient with breathlessness who is admitted to the emergency department. His BP is 90/56 mmHg. Which clinical finding is not seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Muffled heart sounds"
      },
      {
        "id": 2,
        "text": "Pulsus paradoxus"
      },
      {
        "id": 3,
        "text": "Pericardial knock"
      },
      {
        "id": 4,
        "text": "Elevated jugular venous pressure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ECG shows <strong>decreased voltage</strong> and <strong>electrical alternans</strong> (alternating amplitude of QRS complexes), which are indicative of a diagnosis of\u00a0<strong>cardiac tamponade</strong>. Among\u00a0the given options, pericardial knock is not a clinical feature of cardiac tamponade. It<strong>\u00a0</strong>is a sign of constrictive pericarditis.\u00a0</p>\n<p>Cardiac tamponade is characterized by the accumulation of fluid in the pericardial space, leading to the impairment of diastolic relaxation of the cardiac chambers. This leads to a decline in cardiac output. The characteristic signs of cardiac tamponade include the following:</p>\n<ul>\n<li><strong>Pulsus paradoxus - </strong>This is a paradoxical reduction in the systemic blood pressure (&gt;10 mmHg) on inspiration. In tamponade, the increase in venous return to the right side (during inspiration) of the heart causes the interventricular septum to bow towards the left ventricle (fixed total heart volume), thereby reducing the left heart volume. This leads to a reduction in stroke volume and systemic blood pressure.\u00a0</li>\n<li><strong>Beck's triad - </strong>This is a triad of findings in tamponade that consists of <strong>hypotension </strong>(90/56 mmHg),\u00a0<strong>muffled heart sounds,\u00a0</strong>and\u00a0<strong>elevated jugular venous pressure.\u00a0</strong>Features of JVP in tamponade include\u00a0prominent x descent and absent y descent.<strong>\u00a0</strong></li>\n<li><strong>ECG - </strong>ECG shows<strong>\u00a0</strong>reduced voltage and electrical alternans. Electrical alternans is a specific finding caused by the anteroposterior swinging of the heart with each contraction. When the heart is nearer to the chest wall, the amplitude deflection on the ECG is increased; in contrast, when the heart moves away from the chest wall, the amplitude deflection is lower.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da7e72ef7ad84dc1bf64c845f46c5ff6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c6c060940e3403eb77355813df0c89ax1280x1090.JPEG"
    ]
  },
  {
    "text": "What is the most likely mechanism of origin of the heart rhythm shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Degenerative changes of SA node"
      },
      {
        "id": 2,
        "text": "Re-entry circuit around tricuspid annulus"
      },
      {
        "id": 3,
        "text": "Ectopic beats from pulmonary veins"
      },
      {
        "id": 4,
        "text": "Re-entry circuit involving AV node"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given ECG strip shows&nbsp;<strong>saw-tooth waves</strong>&nbsp;(shown below)<strong>&nbsp;</strong>that are characteristic of&nbsp;<strong>atrial flutter.&nbsp;</strong>These ECG changes are generated due to the presence of a <strong>large re-entry circuit around the tricuspid annulus</strong> that causes impulses to circle the tricuspid annulus in the right atrium.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6222baedb16349419c89b053b3181bcf.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83ccc936da244a8ca580c56a88af1c6ax182x137.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d1641dad572f424f858eb134a7260516x1280x780.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1712f16030484d4bba0a4164e3c41814x1280x595.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9e084767045456a9bbc9df0c33548a9x1280x644.JPEG"
    ]
  },
  {
    "text": "Which of the following pairs are correctly matched with respect to the ECG leads in which changes are seen during an event of focal ST-elevation MI?",
    "choices": [
      {
        "id": 1,
        "text": "Anteroseptal MI - V1-V4"
      },
      {
        "id": 2,
        "text": "Lateral wall MI -II, III, aVF"
      },
      {
        "id": 3,
        "text": "Inferior wall MI - II, aVL, V1-V6"
      },
      {
        "id": 4,
        "text": "Extensive anterior wall MI - I, aVL"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correctly matched pair is\u00a0<strong>Anteroseptal MI - V1-V4</strong>.</p>\n<p>ECG changes are best shown by the leads that correspond to or directly face the area of ischemia or infarction.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old diabetic man was undergoing a routine check-up. ECG revealed ST changes as given below. Repeated cardiac biomarkers were found to be within the normal range. Which among the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Brugada syndrome"
      },
      {
        "id": 2,
        "text": "Anterior wall ST-elevation MI"
      },
      {
        "id": 3,
        "text": "Acute pericarditis"
      },
      {
        "id": 4,
        "text": "Non ST-elevation MI"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ECG shows <strong>coved ST-segment elevation of V1-V3,\u00a0</strong>followed by a negative T wave (Brugada sign), which points to a diagnosis of <strong>Brugada syndrome.\u00a0</strong>A coved ST segment has a <strong>downward concavity.</strong></p>\n<p>Brugada syndrome is an inherited sodium channelopathy (<strong>SCN5A mutation</strong>) most commonly seen in Southeast Asian males. The age of presentation is usually 40 years. This syndrome is characterised by an increased risk of sudden cardiac death due to polymorphic ventricular tachyarrhythmias. <strong>Implantable cardioverter-defibrillator</strong> is the treatment of choice.</p>\n<p>Other options:</p>\n<p>To establish a diagnosis of <strong>ST-elevation MI</strong> (Option B) and <strong>NSTEMI </strong>(Option D), a positive and significant rise in cardiac biomarkers (troponins) is necessary along with one of the following features:</p>\n<ul>\n<li>Symptoms of ischemia</li>\n<li>New ST-T elevation or LBBB (not for NSTEMI)</li>\n<li>Pathologic Q waves (STEMI, old infarcts)</li>\n<li>Imaging evidence of loss of myocardium viability</li>\n<li>Intracoronary thrombus identified on angioplasty or autopsy</li>\n</ul>\n<p>Since we do not have a typical rise and fall pattern of cardiac biomarkers, in this case, a diagnosis of acute ST-elevation MI and NSTEMI is less likely.</p>\n<p>Causes of ST-T changes apart from acute MI:</p>\n<ul>\n<li><strong>Acute pericarditis </strong>(Option C) -<strong> </strong>Diffuse ST elevation with <strong>upward concavity</strong> and PR depression)</li>\n<li>Brugada patterns (right bundle branch block-like pattern with ST elevations in right precordial leads) seen secondary to electrolyte disturbances like hyperkalemia</li>\n<li>Hyperkalemia (peaked T waves)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4557c83f596749dc8b02e10696034244.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the false statement regarding the condition with the following ECG changes.",
    "choices": [
      {
        "id": 1,
        "text": "Procainamide is contraindicated"
      },
      {
        "id": 2,
        "text": "It is a congenital condition"
      },
      {
        "id": 3,
        "text": "Presence of an accessory electrical pathway"
      },
      {
        "id": 4,
        "text": "Radio frequency catheter ablation is the treatment of choice"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given ECG clearly depicts the <strong>d</strong><strong>elta wave</strong> at the start of the QRS complex. It is characteristic of Wolff-Parkinson-White (<strong>WPW</strong>)<strong>&nbsp;</strong>syndrome. <strong>Procainamide</strong> is the <strong>drug of choice</strong>&nbsp;in treating a hemodynamically stable WPW patient presenting with atrial fibrillation.</p>\n<p>It is <strong>a congenital condition</strong> involving presence of an abnormal<strong> accessory </strong>electrical conduction<strong> pathway </strong>called&nbsp;<strong>bundle of kent&nbsp;</strong>between the atria and ventricles. Its&nbsp;prevalence decreases with age.</p>\n<p>Electrical conduction through the accessory pathway circumvents the usual conduction delay between the atria and ventricles, which normally occurs at the AV node, and predisposes the patient to develop <strong>tachydysrhythmias.</strong></p>\n<p>Arrhythmias occurring in WPWS are termed&nbsp;<strong>reentrant arrhythmias</strong>. A premature impulse, temporarily blocked by the AV node,&nbsp;passes via this accessory pathway and re excites the tissues in an advanced&nbsp;state of recovery, thus, setting up recurrent activation of the adjacent myocardium.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4f57d656b424a4dbe19191f71abcc44.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/277668ea739844d1bebedda165142e39x248x188.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/be1272a470b44b47a31f023638196957x799x389.JPEG"
    ]
  },
  {
    "text": "Identify the ECG interval that has a normal duration of 0.12-0.2 seconds.",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The\u00a0ECG interval with a normal duration of 0.12-0.2 seconds is the\u00a0<strong>PR interval</strong><strong>\u00a0</strong>(3 to 5 small boxes).</p>\n<p><strong>PR interval</strong>\u00a0is measured from the beginning of the P wave to the beginning of the QRS complex. It represents the time from the beginning of atrial depolarization to the beginning of ventricular depolarization.\u00a0The physiologic delay imposed by stimulation of cells in the AV junction area is also measured in the PR interval. It\u00a0is said to be <strong>prolonged if it is &gt; 0.2 seconds</strong>.\u00a0</p>\n<p>Other options:</p>\n<p>Option B - <strong>Interval 4</strong> as given in the image is the <strong>QT interval</strong>.\u00a0It covers primarily the ventricular repolarization time but also\u00a0ventricular depolarization. The QT interval is inversely proportional to the heart rate. Hence, a rate-related (\u201ccorrected\u201d) QT interval, QTc, is calculated as QT/\u221aR. This is called <strong>Bazett's formula.</strong>\u00a0The <strong>normal duration of QTc</strong> is<strong> \u22640.44 s</strong> and\u00a0upper normal limits as 0.45 s in men and 0.46 s in women according to some references.</p>\n<p>Option C -<strong> Interval 1</strong> as given in the image is the <strong>RR interval</strong>. It is used to calculate the heart rate. As the normal range of heart rate is 60 to 120 beats per minute, the duration of the RR interval is 0.6 to 1.2 seconds.\u00a0</p>\n<p>Option D - <strong>Interval 3</strong> is the <strong>QRS interval</strong> and is\u00a0normally 100\u2013110 ms or less. It signifies the duration of ventricular depolarization.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95a68a403849460d959da464bb0f6fdf.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man was brought to the emergency in an unconscious state. He had a fever for the past two days and is a known case of severe COPD. His ECG is given below. What is the mechanism behind this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Increased atrial automaticity"
      },
      {
        "id": 2,
        "text": "Automaticity of multiple foci in the atrium"
      },
      {
        "id": 3,
        "text": "Macro re-entry circuit in the right atrium"
      },
      {
        "id": 4,
        "text": "Abnormal band of conductive tissue"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of <strong>chronic pulmonary disease</strong> and the ECG showing <strong>different P wave morphologies</strong> are suggestive of <strong>multifocal atrial tachycardia (MAT)</strong>. The mechanism triggering multifocal atrial tachycardia is the <strong>automaticity of multiple atrial foci</strong>.</p>\n<p>The given ECG shows narrow QRS complexes with irregular RR intervals; hence, it can be atrial fibrillation or multifocal atrial tachycardia. The next step is to look at the p waves. Multifocal atrial tachycardia (MAT) is characterized by at least<strong> 3 distinct P-wave morphologies</strong> (shown by arrows in the image).&nbsp;However, in atrial fibrillation, there would be no distinct p waves seen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/46649a6b5c134301b9d8c03872c931ba.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ca1f22af8114d94ba32e0c4cd65fa6bx1280x697.JPEG"
    ]
  },
  {
    "text": "Which of the following ECG findings are seen in a patient with hypokalemia?",
    "choices": [
      {
        "id": 1,
        "text": "Prolonged PR interval with ST elevation"
      },
      {
        "id": 2,
        "text": "Decreased PR interval with ST depression"
      },
      {
        "id": 3,
        "text": "Decreased QT interval with tall T waves"
      },
      {
        "id": 4,
        "text": "Prolonged QT interval with flat T waves"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Prolonged QT interval</strong> with flat T waves is seen in<strong> hypokalemia.</strong></p>\n<p>Hypokalemia prolongs&nbsp;ventricular repolarization. The ECG changes seen are as follows:</p>\n<ul>\n<li>Flattening of T wave</li>\n<li>ST-segment depression</li>\n<li>Prolongation of QT interval</li>\n<li>The appearance of U wave</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec4e4533439146ed9de7afe36504c108x1280x2207.JPEG"
    ]
  },
  {
    "text": "The marked segment of the ECG corresponds to which phase of cardiac action potential:",
    "choices": [
      {
        "id": 1,
        "text": "Phase 0"
      },
      {
        "id": 2,
        "text": "Phase 1"
      },
      {
        "id": 3,
        "text": "Phase 2"
      },
      {
        "id": 4,
        "text": "Phase 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The marked part is the <strong>ST segment</strong> which corresponds to <strong>phase 2 </strong>of the cardiac action potential.</p>\n<p><strong>Cardiac Action Potential and The ECG</strong></p>\n<ul>\n<li>The rapid upstroke (phase 0) of the action potential is representative of the onset of QRS.\u00a0</li>\n<li>The plateau (phase 2) corresponds to the isoelectric ST segment.</li>\n<li>Active repolarization (phase 3) corresponds to the T wave.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b3851a1c9e0748ac8086e50eb683729d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb3a558f149a48a6ae1eaa9cff2daaeax1280x1244.JPEG"
    ]
  },
  {
    "text": "Identify the arrhythmia depicted by the given ECG strip:",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 2,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 3,
        "text": "Atrial fibrillation"
      },
      {
        "id": 4,
        "text": "Atrial flutter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ECG depicts<strong> ventricular fibrillation.\u00a0</strong>It has the following characteristics:</p>\n<ul>\n<li>Chaotic irregular deflections of varying amplitude</li>\n<li>No identifiable QRS complexes, ST segments, or T waves are visible</li>\n</ul>\n<p>Other options:</p>\n<p>Option 1- Ventricular tachycardia:\u00a0The ECG features include:</p>\n<ul style=\"list-style-type: disc;\">\n<li>Wide QRS complex with abnormal morphology</li>\n<li>Absence\u00a0of the P waves</li>\n<li>Rate &gt;100/min</li>\n</ul>\n<p>Option 3- Atrial fibrillation: The ECG features include:</p>\n<ul>\n<li>Narrow QRS complexes</li>\n<li>RR intervals are irregular</li>\n<li>No distinct p waves seen</li>\n</ul>\n<p>Option 4- Atrial flutter: The ECG features include:</p>\n<ul>\n<li>Narrow QRS complexes</li>\n<li>RR intervals are regular\u00a0</li>\n<li>Normal P waves are replaced by <strong>sawtooth-shaped</strong> <strong>waves</strong>\u00a0known as flutter waves.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/04c31ccbac544890acc7a85e7f1b6447.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old man has come to the emergency complaining of a burning type of chest pain. Comment on his ECG recording shown below.",
    "choices": [
      {
        "id": 1,
        "text": "Sinus bradycardia"
      },
      {
        "id": 2,
        "text": "Sinus tachycardia"
      },
      {
        "id": 3,
        "text": "Normal sinus rhythm"
      },
      {
        "id": 4,
        "text": "Irregular rhythm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above ECG strip shows&nbsp;<strong>normal sinus rhythm</strong>.</p>\n<p>The features in this ECG that suggest this diagnosis are as follows:</p>\n<ul>\n<li>The <strong>QRS complexes are narrow</strong> (&lt;120 ms or 3 small squares) which implies that the impulse is supraventricular and is conducted via the normal conduction pathway.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ac12bf3ea55644d4b5c63a854c41e773.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/251a17748fb242b0b115bb0876e4de25x537x130.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3db622654d7465093f09972c262c87dx800x224.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc5516f5be574d34a4d83ca6643b63cax800x224.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4baaf24d405f481b9956ca56d1ac06a7x800x224.JPEG"
    ]
  },
  {
    "text": "A student was asked to record ECG by using bipolar limb leads. The below image shows the arrangement of the bipolar electrodes and the potential recorded. What is the potential recorded across the third electrical meter?",
    "choices": [
      {
        "id": 1,
        "text": "-0.5 mV"
      },
      {
        "id": 2,
        "text": "+1.9 mV"
      },
      {
        "id": 3,
        "text": "+0.5 mV"
      },
      {
        "id": 4,
        "text": "-1.9 mV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><span class=\"s1\">The potential recorded in the electrical meter that represents <strong>lead III</strong> is <strong>+0.5 mV,&nbsp;</strong>according to&nbsp;<strong>Einthoven&rsquo;s Law</strong>.</span></p>\n<p class=\"p1\"><span class=\"s1\"><strong>Einthoven&rsquo;s Law </strong>describes the principle behind Einthoven's triangle which is formed by the arrangement of <strong>three bipolar limb leads</strong>.&nbsp;</span>Einthoven&rsquo;s law states that if the ECGs are recorded simultaneously with the three limb leads, the <strong>sum of the potentials</strong> recorded in <strong>leads I and III</strong> will <strong>equal the potential in lead II.</strong></p>\n<p class=\"p1\">In the given image, Lead I is represented by the electrodes connected to the left arm and right arm, and the potential recorded is +0.7 mV. Lead II is represented by the electrodes connected to the left leg and right arm and the potential recorded is +1.2 mV. According to Einthoven's law:</p>\n<p class=\"p2\"><strong>Lead I potential + Lead III potential = Lead II potential</strong></p>\n<p class=\"p2\">Therefore, Lead III potential = Lead II potential &ndash; Lead I potential = (1.2 - 0.7) = <strong>+0.5 mV.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7b565d99a9724e3fac9164d7112a00b6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient who was being treated for an arrhythmia presented with palpitations and chest discomfort. His ECG has been given below. Which of the following drugs would be least likely to cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Quinidine"
      },
      {
        "id": 2,
        "text": "Sotalol"
      },
      {
        "id": 3,
        "text": "Procainamide"
      },
      {
        "id": 4,
        "text": "Lidocaine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ECG of this patient shows\u00a0<strong>wide QRS complexes </strong>and an<strong>\u00a0undulating baseline </strong>suggesting the diagnosis of\u00a0<strong>torsades de pointes</strong>. It is associated with\u00a0<strong>prolonged QT interval.\u00a0Lidocaine</strong> does not prolong the QT interval, hence, it is<strong> unlikely</strong> to cause torsades de pointes.\u00a0</p>\n<p><strong>Lidocaine</strong> belongs\u00a0to the <strong>class IB</strong> antiarrhythmic agent. It is considered to have the least arrhythmogenic potential among antiarrhythmic. QT interval is usually unaltered or slightly reduced with lidocaine use.</p>\n<p>Among the antiarrhythmics, class Ia and class III drugs prolong action potential duration and thus prolong QT interval and are also prone to cause Torsades de pointes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/73e78df307ab449686e7e18b7b145007.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2b1e13fe6134e12b1862511d5f653abx1280x1424.JPEG"
    ]
  },
  {
    "text": "A 64-year-old patient with a history of myocardial infarction is being monitored in the intensive care unit. He develops chest pain suddenly and the following ECG is observed. His blood pressure was 90/40 mm Hg and he had a feeble pulse of 154 bpm. You decide to perform cardioversion. What is the initial recommended dose for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "50 J"
      },
      {
        "id": 2,
        "text": "120 J"
      },
      {
        "id": 3,
        "text": "100 J"
      },
      {
        "id": 4,
        "text": "200 J"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 1681\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The clinical scenario shows a male patient having unstable tachycardia (154 bpm) with ECG suggestive of<strong>\u00a0a regular wide QRS complex tachycardia. In this condition,</strong>\u00a0synchronized cardioversion is administered with an<strong> initial dose of 100 J.</strong></p>\n<p>According to the ACLS algorithm, a patient with a pulse greater than 150 beats per minute is first given airway and oxygen support after which the patient is connected to a cardiac monitor, and IV access is established. A 12-ECG is connected and recorded if available.</p>\n<p>The patient is then monitored to check if stable or unstable. The patient is considered unstable if the following is observed:</p>\n<ul>\n<li>Hypotension</li>\n<li>Signs of shock</li>\n<li>Altered mental status</li>\n<li>Chest discomfort</li>\n<li>Heart failure</li>\n</ul>\n<p>If the patient is unstable, synchronized cardioversion is given.</p>\n<p>Morphologic characteristics to be looked for in the ECG:</p>\n<ul>\n<li>Wide-complex unstable tachycardia is considered ventricular tachycardia (VT) unless proven otherwise</li>\n<li>Narrow regular tachycardia is seen in atrial flutter or supraventricular tachycardia (SVT)</li>\n<li>Narrow irregular tachycardia is seen in atrial fibrillation</li>\n</ul>\n<p>Dose of cardioversion:</p>\n<ul>\n<li>Unstable atrial fibrillation/Narrow irregular tachycardia: 200 J (Monophasic) or 120-200 J (biphasic)</li>\n<li>Unstable atrial flutter or SVT/Narrow regular tachycardia: 50 to 100 J (Monophasic), synchronized</li>\n<li>Unstable monomorphic ventricular tachycardia/Wide-complex regular tachycardia: 100 J (Monophasic)</li>\n<li>Unstable polymorphic VT or VF/Wide-complex irregular tachycardia: Defibrillation dose</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/74bcd402f19040e69e367365e6cd95a9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old known diabetic and chronic smoker is brought to the hospital due to sudden onset chest pain radiating to the left arm. His cardiac troponins are elevated. His ECG shows complete heart block. Which of the following JVP waves is likely to be abnormal in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient has clinical features suggestive of acute myocardial infarction and has a <strong>complete heart block</strong>. In this patient, an abnormality may be seen in '<strong>a' wave</strong> of the JVP, labeled as '<strong>A' </strong>in the given image.\u00a0\u00a0</p>\n<p>The 'a' wave is representative of the presystolic contraction of the right atrium. Patients with complete AV block have\u00a0<strong>cannon 'a' waves</strong>\u00a0in the JVP due to the contraction of atria against the closed tricuspid valve.</p>\n<p>Causes of <strong>canon \u2018a\u2019 waves</strong> include:</p>\n<ul>\n<li>Complete AV block</li>\n<li>Ventricular tachycardia</li>\n<li>Premature atrial/ junctional/ ventricular beats</li>\n</ul>\n<p><strong>Complete heart block </strong>(Third-degree AV block):\u00a0The ECG shows\u00a0<strong>severe bradycardia, junctional escape rhythm, </strong>and<strong> independent P</strong>\u00a0(red arrows)<strong>\u00a0</strong>and<strong> QRS complexes</strong>\u00a0(green arrow):</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e3aeb0fe34994910b928100aa9a360d8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b094c035ebf448939cf63e463c7b2cc3x765x499.PNG"
    ]
  }
];
        let quizName = 'Mini Test 6- Ecgs Only';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>