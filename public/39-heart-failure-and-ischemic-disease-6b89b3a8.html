<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>39 Heart Failure And Ischemic Disease - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">28</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following layers is not present in the cardiac valve?",
    "choices": [
      {
        "id": 1,
        "text": "Atrialis"
      },
      {
        "id": 2,
        "text": "Ventricularis"
      },
      {
        "id": 3,
        "text": "Spongiosa"
      },
      {
        "id": 4,
        "text": "Adventitia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Adventitia</strong> is not a layer of the cardiac valves. It&nbsp;is the <strong>outermost</strong> layer of a <strong>blood vessel.</strong>&nbsp;It contains connective tissue, a few cells, macrophages, mast cells, fibroblasts, and the nerves and vessels that supply the vascular wall.</p>\n<p>Cardiac <strong>valves</strong> are lined by <strong>endothelium</strong> and share a <strong>tri-layered</strong> architecture:</p>\n<ul>\n<li><strong>&nbsp;Fibrosa </strong>is a<strong> dense collagenous</strong> core&nbsp;at the <strong>outflow</strong> surface. It is connected to the valvular supporting structures.</li>\n<li>&nbsp;<strong>S</strong><strong>pongiosa </strong>is a&nbsp;<strong>central </strong>core of <strong>loose connective</strong> tissue</li>\n<li>&nbsp;<strong>V</strong><strong>entricularis </strong>or<strong> atrialis </strong>is a&nbsp;layer rich in <strong>elastin</strong>&nbsp;on the<strong> inflow</strong> surface.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are conducting an autopsy of an elderly patient who was found dead in his home. Which of the following changes in the heart will not be suggestive of normal aging?",
    "choices": [
      {
        "id": 1,
        "text": "Increased subepicardial fat"
      },
      {
        "id": 2,
        "text": "Basophilic degeneration of myocardium"
      },
      {
        "id": 3,
        "text": "Increased left ventricular cavity size"
      },
      {
        "id": 4,
        "text": "Elastic fragmentation of aorta"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given scenario, an increase in the size of the left ventricle is not normally seen in the heart of an elderly person. The <strong>size</strong> of the <strong>left ventricular</strong> cavity is <strong>decreased</strong> in the aged heart, particularly in the <strong>base-to-apex</strong> dimension. This change is exacerbated by systemic hypertension.</p>\n<p>Changes in the aging heart:</p>\n<ol>\n<li><strong>Chambers</strong>:&nbsp;\n<ul>\n<li>Increased left atrial cavity size</li>\n<li><strong>Decreased left ventricular cavity</strong> size</li>\n</ul>\n</li>\n<li><strong>Valves</strong>:&nbsp;\n<ul>\n<li>Fibrous thickening of valve leaflets</li>\n<li>Aortic and mitral valve calcific deposits</li>\n</ul>\n</li>\n<li><strong>Epicardial coronary arteries</strong>:&nbsp;\n<ul>\n<li>Diminished compliance</li>\n<li>Calcific deposits</li>\n<li>Atherosclerotic plaques</li>\n</ul>\n</li>\n<li><strong>Myocardium</strong>:&nbsp;\n<ul>\n<li><strong>Increased subepicardial fat</strong></li>\n<li>Brown atrophy&nbsp;</li>\n<li>Lipofuscin deposition</li>\n<li><strong>Basophilic degeneration</strong></li>\n<li>Amyloid deposits</li>\n</ul>\n</li>\n<li><strong>Aorta</strong>:\n<ul>\n<li>Dilated with a rightward shift</li>\n<li><strong>Elastic fragmentation</strong> and collagen accumulation</li>\n<li>Atherosclerotic plaque</li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What type of cells are heart failure cells?",
    "choices": [
      {
        "id": 1,
        "text": "Stem cells"
      },
      {
        "id": 2,
        "text": "Macrophages"
      },
      {
        "id": 3,
        "text": "Type II pneumocytes"
      },
      {
        "id": 4,
        "text": "Type I pneumocytes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Heart failure cells are <strong>hemosiderin-laden</strong> <strong>macrophages</strong>.&nbsp;They&nbsp;are telltale signs of previous episodes of pulmonary edema.</p>\n<p>In cardiac failure, <strong>red cells</strong> and <strong>plasma proteins</strong> extravasate into the<strong>&nbsp;edema</strong> fluid within the alveolar spaces. These are then <strong>phagocytosed</strong> and digested by <strong>macrophages.</strong>&nbsp;The <strong>iron</strong> recovered from haemoglobin is stored in the form of <strong>hemosiderin</strong>.&nbsp;</p>\n<p>The image given below shows heart failure cells within alveolar spaces.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2703803837de482a9afd3499959cb9d7x1280x1572.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea9baa7e094141bf92aeccfc12855953x1280x1571.JPEG"
    ]
  },
  {
    "text": "What is the most common cause of left-sided diastolic heart failure?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral stenosis"
      },
      {
        "id": 2,
        "text": "Hypertension"
      },
      {
        "id": 3,
        "text": "Atherosclerosis"
      },
      {
        "id": 4,
        "text": "Aortic stenosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hypertension</strong> is the most common cause of <strong>left-sided diastolic heart failure.</strong></p>\n<p>Left-sided heart failure\u00a0can be divided into systolic and diastolic failure.\u00a0<strong>Diastolic</strong> failure predominantly occurs in patients <strong>older</strong> than age <strong>65 years.\u00a0</strong>Here, the <strong>left ventricle</strong> is abnormally <strong>stiff</strong> and <strong>cannot relax</strong> during diastole.</p>\n<p>Causes of diastolic heart failure:</p>\n<ul>\n<li><strong>Hypertension:\u00a0</strong>most common<strong>\u00a0</strong></li>\n<li><strong>Diabetes mellitus</strong></li>\n<li><strong>Obesity</strong></li>\n<li><strong>Bilateral renal artery stenosis\u00a0</strong></li>\n</ul>\n<p><strong>Systolic </strong>failure is due to insufficient ejection fraction, i.e., <strong>pump failure</strong>. It occurs when the <strong>contractile function</strong> of the left ventricle is <strong>deranged.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following does not cause isolated right-sided heart failure?",
    "choices": [
      {
        "id": 1,
        "text": "Parenchymal lung disease"
      },
      {
        "id": 2,
        "text": "Primary pulmonary hypertension"
      },
      {
        "id": 3,
        "text": "Pulmonary thrmboembolism"
      },
      {
        "id": 4,
        "text": "Left-sided heart failure"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Isolated right</strong>-sided heart <strong>failure</strong> is<strong>&nbsp;</strong>not caused by left-sided heart failure.</p>\n<p>Isolated right<strong>-</strong>sided heart failure is not common and usually&nbsp;occurs in patients with <strong>disorders</strong> affecting the <strong>lungs</strong>. Therefore, it is often referred to as <strong>cor pulmonale</strong>. It is caused by <strong>disorders</strong> of the lung <strong>parenchyma</strong> and pulmonary <strong>vasculature</strong>. It is also caused by conditions causing <strong>pulmonary vasoconstriction</strong> like obstructive sleep apnea and altitude sickness.</p>\n<p><strong>Pulmonary hypertension </strong>is the common feature of these disorders, which leads to&nbsp;<strong>hypertrophy</strong> and <strong>dilation</strong> of the <strong>right side</strong> of the heart.</p>\n<p><strong>Right-</strong>sided heart<strong> failure </strong>is most commonly caused by<strong> left</strong>-sided heart<strong> failure.</strong>&nbsp;This is because an increase in pressure in the pulmonary circulation from left-sided failure burdens the right side of the heart.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A massive pulmonary embolism occurs in a patient with acute cor-pulmonale. What pathological changes do you expect in the heart of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Right ventricular hypertrophy with dilation"
      },
      {
        "id": 2,
        "text": "Right ventricular dilation without hypertrophy"
      },
      {
        "id": 3,
        "text": "Right ventricular hypertrophy without dilation"
      },
      {
        "id": 4,
        "text": "Right ventricular dilation with hypertrophy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, the patient has&nbsp;<strong>acute</strong> cor pulmonale. This causes&nbsp;<strong>right ventricular dilation without hypertrophy</strong>.&nbsp;On cross-section, the normal crescent shape of the right ventricle is transformed to a dilated ovoid.</p>\n<p>In <strong>chronic </strong>cor pulmonale<strong>,</strong> the<strong> right ventricular wall thickens</strong>.&nbsp;The hypertrophied right ventricle may compress the left ventricular chamber. It can also cause regurgitation and fibrous thickening of the tricuspid valve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The liver specimen obtained after the autopsy of a patient is given below. What could be the likely cause of this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Liver cirrhosis"
      },
      {
        "id": 2,
        "text": "Haemochromatosis"
      },
      {
        "id": 3,
        "text": "Heart failure"
      },
      {
        "id": 4,
        "text": "Non-cirrhotic portal fibrosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the image, the liver specimen shows<strong>&nbsp;</strong>a<strong> nutmeg liver</strong> appearance, which occurs in <strong>congestive hepatomegaly.&nbsp;</strong> This is&nbsp;<strong>secondary</strong> to passive congestion due to <strong>right heart failure.</strong></p>\n<p>In right heart failure, there is<strong>&nbsp;congestion</strong> of <strong>hepatic</strong> and <strong>portal </strong>vessels,&nbsp;<strong>greatest</strong> around the <strong>central veins. </strong>This leads to increased liver size and weight. The&nbsp;<strong>p</strong><strong>ericentral</strong> zones become&nbsp;<strong>congested</strong> and <strong>red-brown.</strong>&nbsp;The<strong>&nbsp;periportal</strong> regions are&nbsp;<strong>normal coloured</strong> and tan. This leads to a&nbsp;<strong>nutmeg </strong>liver <strong>appearance.&nbsp;</strong>With <strong>longstanding</strong>&nbsp;<strong>failure</strong>, the <strong>central areas</strong> can become <strong>fibrotic</strong>, eventually culminating in <strong>cardiac cirrhosis.</strong></p>\n<p>Pathological changes are also seen in the spleen and the gastrointestinal tract. Portal venous hypertension also causes the enlargement of the spleen, with platelet sequestration. This is known as&nbsp;<strong>congestive&nbsp;splenomegaly. </strong>This can also contribute to chronic congestion and oedema of the bowel.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/55a9a6e7c27d464e94b1bad0a9f74d03.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which hormone reduces the risk of myocardial infarction in women of reproductive age?",
    "choices": [
      {
        "id": 1,
        "text": "Progesterone"
      },
      {
        "id": 2,
        "text": "Estrogen"
      },
      {
        "id": 3,
        "text": "Human chorionic gonadotropin"
      },
      {
        "id": 4,
        "text": "Human placental lactogen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Estrogen</strong> reduces the risk of myocardial infarction in <strong>women</strong> in the <strong>reproductive age</strong> group.</p>\n<p>Accelerated <strong>coronary artery disease</strong> is associated with the <strong>postmenopausal decline</strong> in <strong>estrogen</strong> production. However, postmenopausal hormonal replacement therapy (<strong>HRT</strong>) has <strong>not</strong> been shown to be <strong>beneficial.</strong></p>\n<p>The <strong>most common</strong> cause of death in <strong>older</strong> women is <strong>ischemic heart disease</strong>.</p>\n<p>Through <strong>middle age</strong>, <strong>males</strong> have a relatively <strong>increased</strong> risk of <strong>myocardial infarction.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man presented to the casualty with severe, sudden-onset chest pain radiating to the left arm. ECG showed ST-segment elevation in precordial leads. The person succumbed after 3 hours. On autopsy, the patient's heart was immersed in triphenyl tetrazolium chloride solution. What colour would be imparted to the heart?",
    "choices": [
      {
        "id": 1,
        "text": "Entire myocardium appears pale"
      },
      {
        "id": 2,
        "text": "Viable myocardium appears brick red and infarct appears pale"
      },
      {
        "id": 3,
        "text": "Viable myocardium appears red and infarct appears dark blue"
      },
      {
        "id": 4,
        "text": "Viable myocardium appears unstained and the infarct appears dark red"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Triphenyl tetrazolium chloride solution imparts a <strong>brick red</strong> colour to the <strong>viable</strong> non-infarcted <strong>myocardium. </strong>The<strong> infarct </strong>appears<strong> unstained </strong>and<strong> pale.</strong></p>\n<p>Myocardial infarcts <strong>&lt;&nbsp;12 hours</strong> old are usually <strong>not apparent</strong> on <strong>gross</strong> examination. However, if the <strong>infarct</strong> <strong>preceded</strong> death by <strong>2</strong> to <strong>3</strong> <strong>hours</strong>, it is possible to identify the area of&nbsp;necrosis. This is done by immersing the tissue slices in triphenyl tetrazolium chloride solution.</p>\n<p>The histochemical stain imparts a <strong>brick-red </strong>colour to<strong> intact</strong>, noninfarcted<strong> myocardium.</strong> Here,&nbsp;lactate dehydrogenase,<strong> LDH,</strong> activity is <strong>preserved.&nbsp;</strong>LDH leaks out through the damaged membranes of dead cells, so an&nbsp;<strong>infarct </strong>appears as an<strong> unstained pale</strong> zone.</p>\n<p>The image given below shows an ischemic brain after immersion in&nbsp;triphenyl tetrazolium&nbsp;chloride solution. The pale unstained region is the infarcted zone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/255a9f8f1c7b44d3ae452878d1fdf556x512x756.PNG"
    ]
  },
  {
    "text": "What is the approximate time of onset of microvascular injury in ischemic cardiac myocytes?",
    "choices": [
      {
        "id": 1,
        "text": "10 minutes"
      },
      {
        "id": 2,
        "text": "Few seconds"
      },
      {
        "id": 3,
        "text": "40 minutes"
      },
      {
        "id": 4,
        "text": "More than one hour"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Microvascular injury begins &gt;1 hour after the onset of ischemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the earliest detectable ultrastructural feature of myocardial infarction?",
    "choices": [
      {
        "id": 1,
        "text": "Myocyte hypereosinophilia"
      },
      {
        "id": 2,
        "text": "Relaxation of myofibrils"
      },
      {
        "id": 3,
        "text": "Neutrophilic infiltrate"
      },
      {
        "id": 4,
        "text": "Sarcolemmal disruption"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Relaxation</strong> of <strong>myofibrils</strong> is the <strong>earliest</strong> detectable <strong>ultrastructural</strong> feature of myocardial infarction.</p>\n<p>Myofibril relaxation, <strong>mitochondrial swelling</strong> and <strong>glycogen loss</strong> can be detected by <strong>electron microscopy</strong> within half an hour of myocardial infarction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are conducting the autopsy of a patient who passed away following myocardial infarction. What would be the earliest light microscopic change that can be observed in the heart of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Waviness of the fiber"
      },
      {
        "id": 2,
        "text": "Neutrophilic infiltration"
      },
      {
        "id": 3,
        "text": "Contraction band necrosis"
      },
      {
        "id": 4,
        "text": "Pyknosis of nuclei"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The earliest light microscopic change that can be observed in the heart of this patient is the&nbsp;<strong>waviness </strong>of<strong> myocardial fibres. </strong>This is<strong>&nbsp;</strong>seen within<strong> &frac12;</strong><strong>-4 hours </strong>at the<strong> border </strong>of the infarct.</p>\n<p>These changes are a result of the forceful contractions of viable fibres. The contractions cause stretching and buckling of immediately adjacent, noncontractile dead fibres.</p>\n<p><strong>Myocyte vacuolization </strong>or<strong> myocytolysis </strong>may also be seen in the infarct <strong>margins. </strong>It is due to the <strong>accumulation </strong>of <strong>salt</strong> and <strong>water</strong> in the <strong>sarcoplasmic reticulum. </strong>Such myocytes are viable but poorly contractile.</p>\n<p>The image below shows microscopic features of myocardial infarction showing wavy myocardial fibres. There are wavy fibres that are elongated and narrow, as compared with normal fibres. The widened spaces between the dead fibres contain edema fluid and scattered neutrophils.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f3091af946c046b690288cba184335aax751x565.JPEG"
    ]
  },
  {
    "text": "Following myocardial infarction, coagulative necrosis begins at?",
    "choices": [
      {
        "id": 1,
        "text": "1/2 - 4 hours"
      },
      {
        "id": 2,
        "text": "4 - 12 hours"
      },
      {
        "id": 3,
        "text": "12 - 24 hours"
      },
      {
        "id": 4,
        "text": "1 - 3 days"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Early <strong>coagulative necrosis begins</strong> in myocardial infarction by <strong>4&ndash;12 hours.</strong></p>\n<p>However, it is <strong>prominent</strong> between <strong>1 to 3 days</strong> after myocardial infarction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The heart of a patient who had suffered a myocardial infarction is subjected to a histopathological examination. The microscopic image is given below. What time following infarction would you observe this?",
    "choices": [
      {
        "id": 1,
        "text": "30 minutes to 4 hours"
      },
      {
        "id": 2,
        "text": "4-12 hours"
      },
      {
        "id": 3,
        "text": "12-24 hours"
      },
      {
        "id": 4,
        "text": "3-7 days"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows neutrophilic infiltration into the myocardium. Early neutrophil infiltration starts by<strong> 12&ndash;24 hours </strong>following the infarction. It can be visualised by examination with a<strong> light microscope.</strong></p>\n<p>The necrotic myocardium elicits <strong>acute inflammation</strong> most<strong> prominent </strong>between<strong> 1 </strong>and <strong>3 days.</strong>&nbsp;During this time, there is a <strong>brisk</strong> interstitial<strong> infiltrate</strong> of <strong>neutrophils.</strong></p>\n<p>The image given below shows neutrophilic infiltration into the myocardium following MI.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c892121c8e8a4c6f82d8941d2258a498.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d379cff3df924af699c436bc4298406ex1200x977.JPEG"
    ]
  },
  {
    "text": "A patient was admitted four days back following acute myocardial infarction. What type of cells would you expect to see in the infarcted area in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophils"
      },
      {
        "id": 2,
        "text": "Lymphocytes"
      },
      {
        "id": 3,
        "text": "Macrophage"
      },
      {
        "id": 4,
        "text": "Basophils"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given scenario,&nbsp;<strong>4 days</strong> after MI, <strong>macrophages</strong> are seen in the infarcted area.</p>\n<p>They <strong>phagocytose</strong> dead myocytes at the border of the infarct <strong>earliest</strong> by <strong>72 hours</strong>. Removal of the <strong>necrotic myocytes</strong>&nbsp;is most noticeable by <strong>3 to 7 days.</strong></p>\n<p>The image below shows a macrophagic infiltrate in the infarcted area.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/49179e8b65ac46eaaa7decd2a7ccc344x752x565.JPEG"
    ]
  },
  {
    "text": "Match the following:",
    "choices": [
      {
        "id": 1,
        "text": "1-d, 2-e, 3-b, 4-d, 5-c"
      },
      {
        "id": 2,
        "text": "1-c, 2- d, 3-a, 4-e, 5-a"
      },
      {
        "id": 3,
        "text": "1-e, 2-d, 3-b, 4-e, 5-b"
      },
      {
        "id": 4,
        "text": "1-c, 2-e, 3-a, 4-d,  5-b"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The correct match is:</p>\n<ul>\n<li>Well established granulation - 10 - 14 days</li>\n<li>Complete scarring - &gt; 2 months</li>\n<li>Myocyte hypereosinophilia - 12 - 24 hours</li>\n<li>Grey white scar - 2-8 weeks</li>\n<li>Loss of nuclei and striations - 1 - 3 days</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 67-year-old woman is found dead in her home. On autopsy, hemopericardium secondary to ventricular wall rupture is seen. How long before her death did she probably have a myocardial infarction?",
    "choices": [
      {
        "id": 1,
        "text": "1 day"
      },
      {
        "id": 2,
        "text": "3 -7 days"
      },
      {
        "id": 3,
        "text": "12 - 14 days"
      },
      {
        "id": 4,
        "text": ">2 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given autopsy finding of&nbsp;hemopericardium secondary to ventricular wall rupture&nbsp;occurs most frequently <strong>3-7 days </strong>after<strong> myocardial infarction </strong>(MI). During this time, the <strong>lysis</strong> of the <strong>necrotic myocardium</strong> is <strong>maximum.&nbsp;</strong>&nbsp;Thus most of the infarct has been converted to friable granulation tissue.</p>\n<p>The risk factors&nbsp;for <strong>free-wall rupture</strong> are:</p>\n<ul>\n<li>Age <strong>&gt; 60 years</strong>&nbsp;</li>\n<li><strong>Female</strong> gender&nbsp;</li>\n<li>First MI&nbsp;</li>\n<li>Large, transmural and anterior MI&nbsp;</li>\n<li>Absence of left ventricular hypertrophy&nbsp;</li>\n<li>Preexisting <strong>hypertension</strong></li>\n</ul>\n<p>It is<strong> less frequent</strong> in patients with <strong>prior MI</strong> because associated fibrotic scarring inhibits myocardial tearing.&nbsp;</p>\n<p>Complications of MI:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Heart failure -&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">This is due to ventricular dysfunction caused by the infarct and ventricular remodeling</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Usually occurs within a day</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cardiogenic shock -&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">This is usually seen in severe multivessel coronary artery disease due to extensive involvement of myocardium</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Usually occurs within a day</li>\n</ul>\n<li>Arrhythmias -&nbsp;<strong>most common complication</strong>, occurring usually 2 days after infarction\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Most common arrhythmia <strong>within one hour</strong> of MI - <strong>ventricular fibrillation</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Most common arrhythmia <strong>after one hour</strong> of MI - <strong>supraventricular tachycardia&nbsp;</strong></li>\n</ul>\n</li>\n<li><strong>Myocardial rupture</strong> - occurs when there is <strong>transmural necrosis</strong> of a ventricle. It includes the following -&nbsp;\n<ul style=\"list-style-type: disc;\">\n<li>Left ventricular <strong>free wall rupture</strong>&nbsp;(<strong>most common</strong>) - leads to cardiac tamponade</li>\n<li>Interventricular septal rupture - leads acute&nbsp;ventricular septal defect (<strong>VSD</strong>)</li>\n<li>Papillary muscle rupture - leads to severe&nbsp;<strong>mitral regurgitation</strong></li>\n</ul>\n</li>\n<li><strong><strong>Mitral regurgitation (MR) </strong></strong>- this can occur due to -\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Transient papillary muscle dysfunction - mid-systolic or late-systolic murmur</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Rupture of papillary muscle - pansystolic murmur&nbsp;</li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Dressler syndrome</strong> (post-MI syndrome) -&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">This is an <strong>immune-mediated</strong> reaction and presents as pericarditis, pleurisy, and fever&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">It can occur even <strong>48 hrs</strong> after MI but <strong>usually</strong> occurs<strong> 1&ndash;6 weeks</strong> after MI and often subside after a few days</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ventricular aneurysm</li>\n<li>Infarct expansion<strong>&nbsp;</strong>associated with mural thrombus</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What causes tigered myocardium?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatic fever"
      },
      {
        "id": 2,
        "text": "Fatty change"
      },
      {
        "id": 3,
        "text": "Myocarditis"
      },
      {
        "id": 4,
        "text": "Hyaline change"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tigered myocardium&nbsp;</strong>appearance occurs as a result of&nbsp;<strong>prolonged moderate hypoxia</strong> due to&nbsp;<strong>fatty change</strong>.&nbsp;It is the&nbsp;gross appearance of the heart with&nbsp;bands of <strong>yellow</strong> myocardium <strong>alternating</strong> with <strong>normal</strong> myocardium.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following causes the maximum damage in reperfusion injury?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophil aggregation"
      },
      {
        "id": 2,
        "text": "Monocytes activation"
      },
      {
        "id": 3,
        "text": "Calcium overload"
      },
      {
        "id": 4,
        "text": "Free radicals"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In&nbsp;<strong>reperfusion injury</strong>, the maximum damage is caused by <strong>free radicals.</strong></p>\n<p>Reperfusion is the <strong>restoration</strong> of <strong>blood flow</strong> to the <strong>ischemic myocardium</strong> threatened by infarction. Reperfused infarcts are usually <strong>hemorrhagic</strong> because the vasculature is injured during ischemia. Once&nbsp;the flow is restored, there is bleeding.</p>\n<p>On microscopic examination,&nbsp;the irreversibly injured myocytes exhibit <strong>contraction bands</strong>&nbsp;that are intensely <strong>eosinophilic intracellular stripes</strong>. These contraction bands are composed of closely <strong>packed sarcomeres</strong>.</p>\n<p>Reperfusion injury may be mediated by:&nbsp;</p>\n<ul>\n<li>Oxidative stress</li>\n<li>Calcium overload&nbsp;</li>\n<li>Inflammatory cells recruited after tissue reperfusion</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What creatine kinase isoenzymes do the heart muscle contain?",
    "choices": [
      {
        "id": 1,
        "text": "MM"
      },
      {
        "id": 2,
        "text": "MB"
      },
      {
        "id": 3,
        "text": "MM and MB"
      },
      {
        "id": 4,
        "text": "MM, MB and BB"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Heart muscle </strong>contains<strong> MM </strong>and<strong> MB </strong>isoenzymes of creatine kinase.</p>\n<p>Creatine kinase (CK) has three isoenzymes:</p>\n<ul>\n<li>CK-1 (BB) - <strong>brain</strong>,<strong> nerve&nbsp;tissue</strong>, prostate (small amounts), intestine, lung, bladder, kidney, uterus, thyroid</li>\n<li>CK-2 (MB) - <strong>heart</strong>&nbsp;and <strong>skeletal muscle</strong></li>\n<li>CK-3 (MM) -&nbsp;<strong>sk</strong><strong>eletal</strong> and <strong>heart muscle</strong></li>\n</ul>\n<p>Elevation of the CK-MB isoforms is seen in MI. CK-MB is <strong>less sensitive&nbsp;</strong>and&nbsp;<strong>less&nbsp;</strong><strong>specific</strong>,&nbsp;therefore, <strong>troponins</strong> are <strong>preferred</strong> for the diagnosis of MI. CK-MB begins to rise within <strong>3-12 hours</strong> of the onset of MI. It&nbsp;<strong>peaks</strong> at about <strong>24 hours</strong> and returns to <strong>normal</strong> within approximately <strong>48-</strong><strong>72 hours</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes to the hospital after 3 hours of the onset of chest pain. ECG reveals ST-segment elevation in the precordial leads. Which of the following enzymes would be elevated in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CK-MB"
      },
      {
        "id": 2,
        "text": "LDH"
      },
      {
        "id": 3,
        "text": "SGOT"
      },
      {
        "id": 4,
        "text": "SGPT"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is suggestive of acute<strong> myocardial infarction </strong>(MI). Enzymes elevated after <strong>4 to 8 hours</strong> of MI are\u00a0<strong>CK-MB\u00a0</strong>(creatine kinase MB)\u00a0and <strong>troponins.</strong>\u00a0</p>\n<p>When cardiac troponin is available, CK-MB should not be used for the initial diagnosis of acute MI. If it is the only assay available, it can be used, but it is far<strong>\u00a0less sensitive\u00a0</strong>and <strong>less specific</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 56-year-old man presented to the emergency department with progressive dyspnoea. His wife reports that he had chest pain 7 days back which had lasted for 2 days. You suspect that the patient's chest pain was due to myocardial infarction. If so, blood levels of which of the following enzymes would be elevated now?",
    "choices": [
      {
        "id": 1,
        "text": "CPK"
      },
      {
        "id": 2,
        "text": "SGOT"
      },
      {
        "id": 3,
        "text": "Troponin"
      },
      {
        "id": 4,
        "text": "Myoglobin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given scenario, on post-MI<strong> day 7</strong>, <strong>t</strong><strong>roponin </strong>and<strong> LDH</strong> will be raised. Troponins are highly specific for MI and remain elevated for <strong>7</strong>&nbsp;<strong>to 10</strong> days.</p>\n<p><strong>Troponins&nbsp;</strong>are proteins that regulate calcium-mediated contraction of the cardiac and skeletal muscles. It is the single biomarker preferred for diagnosing MI, late diagnosis of MI, and diagnosis of reinfarction.<strong>&nbsp;</strong>Troponin<strong>&nbsp;I&nbsp;</strong>is <strong>more&nbsp;important&nbsp;</strong>than troponin<strong>&nbsp;T.</strong></p>\n<p>Cardiac troponin<strong> increases </strong>rapidly&nbsp;in patients with <strong>reinfarction</strong>. Sometimes, the cardiac troponin concentration is elevated, but stable or decreasing at the time of suspected reinfarction. Then the&nbsp;<strong>diagnosis </strong>of<strong> reinfarction </strong>requires a<strong> 20% </strong>or greater<strong> increase </strong>in the<strong> cTn </strong>measurement.&nbsp;</p>\n<p>Myoglobin is the&nbsp;<strong>e</strong><strong>arliest&nbsp;</strong>enzyme to<strong>&nbsp;increase&nbsp;</strong>after&nbsp;<strong>MI. </strong>It is a<strong>&nbsp;</strong>protein that is found in the skeletal and cardiac muscles, which binds oxygen. It is a very sensitive indicator of muscle injury. But it is not specific to cardiac muscle and can be&nbsp;<strong>elevated</strong>&nbsp;to any form of<strong>&nbsp;injury</strong>&nbsp;to&nbsp;<strong>skeletal muscle. </strong>Myoglobin and SGOT levels come to baseline before day 1.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The blood levels of various cardiac biomarkers are measured in a patient following myocardial infarction. This is represented in the given graph. Which biomarker does the yellow curve depict?",
    "choices": [
      {
        "id": 1,
        "text": "Myoglobin"
      },
      {
        "id": 2,
        "text": "Troponin I"
      },
      {
        "id": 3,
        "text": "CK-MB"
      },
      {
        "id": 4,
        "text": "LDH"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>yellow</strong> curve here shows the levels of <strong>CK-MB</strong> which starts <strong>rising</strong> around <strong>4</strong> <strong>to 8 hrs</strong> post-MI, <strong>peaks </strong>at<strong> 24 hours</strong> and becomes normal at 48 to 72 hrs.</p>\n<p>The post-myocardial infarction blood levels of the different cardiac biomarkers are shown in the image given below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8a6a3c256d954cce8bba55ccb4499414.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28cf45503c2e4f91bc2556b919b74ac7x1280x1429.JPEG"
    ]
  },
  {
    "text": "Loss-of-function mutation in potassium channel gene KCNQ1 results in which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Long QT syndrome"
      },
      {
        "id": 2,
        "text": "Short QT syndrome"
      },
      {
        "id": 3,
        "text": "Brugada syndrome"
      },
      {
        "id": 4,
        "text": "Familial atrial fibrillation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Loss of function</strong> mutation in<strong> K</strong><sup><strong>+</strong>&nbsp;</sup>channel genes <em>KCNQ1</em> and<em> KCNH2</em> produces the <strong>long QT</strong> syndrome. The&nbsp;<strong>gain-of-function</strong> mutation produces the<strong> short QT</strong> syndrome.</p>\n<p><strong>Long QT</strong> syndrome manifests as <strong>arrhythmias</strong> associated with excessive <strong>prolongation</strong> of cardiac <strong>repolarization</strong>. Stress-induced syncope or sudden cardiac death (SCD), are common presentations.</p>\n<p><strong>Short QT</strong> syndrome presents with <strong>arrhythmias</strong>&nbsp;associated with <strong>abbreviated repolarization</strong> intervals. They also present with palpitations, syncope, and SCD.</p>\n<p><strong>Brugada syndrome</strong> manifests as ECG abnormalities like <strong>ST</strong>-segment <strong>elevations</strong> and <strong>right bundle-branch block</strong>. This occurs in the <strong>absence</strong> of <strong>structural heart disease.</strong>&nbsp;Here, patients classically present with syncope or SCD during rest or sleep or after large meals.</p>\n<p><strong>Familial atrial fibrillation</strong> is caused by a <strong>gain</strong> of <strong>function</strong> mutation in genes coding <strong>potassium channels.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common mechanism behind sudden cardiac death?",
    "choices": [
      {
        "id": 1,
        "text": "Infarction"
      },
      {
        "id": 2,
        "text": "Arrythmia"
      },
      {
        "id": 3,
        "text": "Thrombosis"
      },
      {
        "id": 4,
        "text": "Myocardial rupture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The mechanism behind <strong>sudden&nbsp;cardiac death</strong> (SCD) is most often a <strong>lethal arrhythmia</strong>, e.g., asystole or ventricular fibrillation.</p>\n<p><strong>Coronary artery disease</strong> is the leading <strong>cause</strong> of <strong>SCD</strong>, responsible for 80% to 90% of cases. But, the <strong>mechanism </strong>of SCD is<strong> most often </strong>a<strong> lethal arrhythmia</strong>.&nbsp;Infarction need not occur. Most of the patients who have SCD but are successfully resuscitated do <strong>not</strong> show any enzymatic or ECG <strong>evidence</strong> of <strong>myocardial necrosis.</strong></p>\n<p>Ischemic injury can directly affect the major components of the conduction system. But, <strong>most</strong> cases of <strong>fatal arrhythmia</strong> are triggered by <strong>electrical irritability</strong> of the myocardium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with which of the following conditions have an increased susceptibility to coronary artery disease?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin D deficiency"
      },
      {
        "id": 2,
        "text": "von Willebrand\u2019s disease"
      },
      {
        "id": 3,
        "text": "Hyperlipidemia"
      },
      {
        "id": 4,
        "text": "Amyloidosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Patients with<strong> hyperlipidemia</strong>&nbsp;have an increased susceptibility to <strong>coronary artery disease (CAD)</strong>.</p>\n<div class=\"page\" title=\"Page 3221\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Hyperlipidemia is considered the second most common risk factor for CAD worldwide after hypertension. Hypercholesterolemia was implicated in 55% of cases with combined hyperlipidemia in 41% cases.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is lipoprotein a [Lp (a)] composed of?",
    "choices": [
      {
        "id": 1,
        "text": "apo B100 + apo A"
      },
      {
        "id": 2,
        "text": "apo B48 + apo A"
      },
      {
        "id": 3,
        "text": "apo B48 + apo B100"
      },
      {
        "id": 4,
        "text": "apo E + apo A"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Lipoprotein a</strong> <strong>[Lp(a)]</strong> contains the <strong>apolipoprotein B-100 </strong>portion of LDL linked to<strong> apolipoprotein A </strong>(apo A). It&nbsp;is an altered form of low-density lipoprotein (LDL).</p>\n<p>Increased Lp(a) levels are associated with <strong>coronary</strong> and <strong>cerebrovascular disease</strong> risk. It is independent of total cholesterol or LDL levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Histology of reperfused myocardium:",
    "choices": [
      {
        "id": 1,
        "text": "Wavy fibres"
      },
      {
        "id": 2,
        "text": "Neutrophils in cardiac muscle"
      },
      {
        "id": 3,
        "text": "Swelling of cells"
      },
      {
        "id": 4,
        "text": "Eosinophilc contraction band"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 554\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Reperfused myocardium</strong> shows <strong>eosinophilic contraction bands</strong> on light microscopy. They occur in&nbsp;irreversibly injured myocytes with damaged membranes, when&nbsp;<strong>blood supply</strong> is <strong>restored 12-24 hours</strong> after MI.</p>\n<div class=\"page\" title=\"Page 554\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>During ischemia, the intracellular levels of calcium are increased due to impaired calcium cycling and sarcolemmal damage. This leads to augmented and uncontrolled contraction of myofibrils after reperfusion.&nbsp;</p>\n<p>On microscopic examination,&nbsp;the irreversibly injured myocytes exhibit <strong>contraction bands</strong>&nbsp;that are intensely <strong>eosinophilic intracellular stripes</strong>. These contraction bands are composed of closely <strong>packed sarcomeres</strong>.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"column\">\n<p><strong>Reperfused infarcts</strong> are usually <strong>hemorrhagic</strong> because the vasculature is injured during ischemia. This leads to&nbsp;<strong>bleeding</strong> after the flow is restored.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '39 Heart Failure And Ischemic Disease';
        const quizFilename = '39-heart-failure-and-ischemic-disease-6b89b3a8.html';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>