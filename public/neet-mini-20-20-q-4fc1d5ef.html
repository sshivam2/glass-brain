<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet Mini - 20 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 45-year-old man presents with oliguria, haematuria, and pedal edema over the past 3 days. He complains that his symptoms worsened rapidly. On examination, he has a BP of 190/140 mmHg. Blood workup shows elevated serum creatinine and blood urea. Histological studies show crescents in the glomeruli as seen in the image below. Which of the following type of nephritis does the clinical scenario suggest?",
    "choices": [
      {
        "id": 1,
        "text": "Rapidly progressive glomerulonephritis"
      },
      {
        "id": 2,
        "text": "Minimal change disease"
      },
      {
        "id": 3,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 4,
        "text": "Membranoproliferative glomerulonephritis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The rapidly worsening symptoms and the histologic picture are suggestive of <strong>rapidly progressive glomerulonephritis</strong>&nbsp;(RPGN) also known as <strong>crescentic glomerulonephritis</strong>.&nbsp;</p>\n<p>It is a syndrome associated with severe glomerular injury with necrosis and the formation of crescents. The&nbsp;disease progresses rapidly and leads to renal failure in weeks to months when not treated. In&nbsp;the majority of the cases, RPGN is&nbsp;immune-mediated.&nbsp;In pauci-immune type of RPGN, circulating&nbsp;<strong>anti-neutrophil cytoplasmic antibodies</strong> (ANCAs) are detected in most cases.&nbsp;Serum analyses for anti-GBM antibodies, antinuclear antibodies, and ANCAs are helpful in the diagnosis of specific subtypes.</p>\n<p>Other options:</p>\n<p>Option B:<strong>&nbsp;Minimal change disease</strong> - presence of difuse <strong>effacement </strong>of<strong> podocytes</strong> (epithelial cell foot process) which is characteristic. It is one of the common causes of <strong>nephrotic syndrome</strong>. However, this glomerular abnormality can only be detected using electron microscopy and appear normal by light microscopy.&nbsp;</p>\n<p>Option C:&nbsp;<strong>Focal segmental glomerulosclerosis</strong> - presence of <strong>focal </strong>and<strong> segmental scarring</strong> of the <strong>glomeruli</strong> most prominently seen at the corticomedullary junction.</p>\n<p>Option D:&nbsp;<strong>Membranoproliferative glomerulonephritis</strong> - presence of thickenend glomerular basement membrane with <strong>mesangioproliferation</strong> and are of three types where type 1 is associated with hepatitis C infection while type 2 and 3 are idiopathic or complement mediated.</p>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/6/69/Crescentic_glomerulonephritis_-_very_high_mag.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "A 19-year-old female patient comes to the OPD with complaints of weakness, amenorrhea, and fatigue.  Upon eliciting a history, she reveals that she is always worried about gaining weight. Her mother complains that she does not eat well. Her BMI is 15.8 kg/m\u00b2. Laboratory findings in this patient will show which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Low serum cholesterol level"
      },
      {
        "id": 2,
        "text": "Hyperthyroidism"
      },
      {
        "id": 3,
        "text": "Hypersecretion of corticotrophin-releasing hormone"
      },
      {
        "id": 4,
        "text": "High fasting serum glucose"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette is suggestive of\u00a0<strong>anorexia nervosa</strong>.\u00a0<strong>Hypersecretion of corticotrophin-releasing hormone</strong>\u00a0is seen in a patient with anorexia nervosa.</p>\n<p>Anorexia nervosa is a type of eating disorder in which the patient has <strong>intense fear</strong> of becoming fat. This fear leads to <strong>restriction of calorie intake</strong> resulting in significantly <strong>reduced body weight</strong>. The patient does not understand the seriousness of the reduced body weight and continues to restrict food intake. Some patients might also have history of self-induced <strong>vomiting</strong>, misuse of laxatives, diuretics, or enemas. Laboratory investigations of these patients might show leukopenia with relative lymphocytosis, hypokalemic alkalosis, hypoglycemia, elevated serum salivary amylase levels, hypercholesterolemia, amenorrhea, mild hypothyroidism, and hypersecretion of corticotrophin-releasing hormone.</p>\n<p>Anorexia nervosa is a type of eating disorder that is characterized by self-induced starvation to a significant degree, drive for thinness or a morbid fear of fatness, and the presence of medical signs and symptoms resulting from starvation.</p>\n<p>Investigations in anorexia nervosa:</p>\n<ul>\n<li>Complete blood count: Leukopenia with a relative lymphocytosis</li>\n<li>Serum electrolyte: Hypokalemic alkalosis (Purging)</li>\n<li><strong>Fasting serum glucose: Often low (emaciated phase) (Option D)</strong></li>\n<li>Serum salivary amylase: Often elevated (if the patient is vomiting)</li>\n<li>ECG: ST segment and T-wave changes (secondary to electrolyte disturbances)</li>\n<li>Hypotension and bradycardia</li>\n<li><strong>High serum cholesterol level (Option A)</strong></li>\n<li>Endocrine changes (caused by the underweight):<br />\n<ul>\n<li>Amenorrhea</li>\n<li><strong>Hypothyroidism (Option B)</strong></li>\n<li><strong>Hypersecretion of corticotrophin-releasing hormone</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old female patient comes to the clinic with complaints of weight loss, low-grade fever, and chronic cough. On examination, the skin over the right shin has red nodules. An X-ray of the chest shows the following. The sputum sample sent for AFB testing comes back negative. What is the stage of this patient's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Stage III"
      },
      {
        "id": 2,
        "text": "Stage I"
      },
      {
        "id": 3,
        "text": "Stage IV"
      },
      {
        "id": 4,
        "text": "Stage II"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette showing weight loss, lowgrade fever, chronic cough, erythema nodosum, and a chest radiograph showing bilateral hilar lymphadenopathy and parenchymal infiltrates is suggestive of <strong>Stage II</strong> Pulmonary Sarcoidosis.</p>\n<p>Pulmonary sarcoidosis can be classified on a chest radiograph into 5 stages:</p>\n<ul>\n<li>Stage<strong> 0:</strong>\u00a0Normal chest radiograph.</li>\n<li>Stage<strong> I:</strong>\u00a0Hilar or mediastinal nodal enlargement only.</li>\n<li>Stage<strong> II:</strong>\u00a0<strong>Nodal enlargement and parenchymal disease</strong></li>\n<li>Stage<strong> III:</strong>\u00a0Parenchymal disease only</li>\n<li>Stage<strong> IV:</strong>\u00a0End-stage lung (<strong>pulmonary fibrosis</strong>)</li>\n</ul>\n<p>Radiographic features are variable depending on the stage of the disease.</p>\n<p>Stage<strong> 0:</strong>\u00a0Normal chest radiograph.<br />Stage<strong> I:</strong>\u00a0<strong>Hilar or mediastinal nodal enlargement only.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b52b7667c0cf4a8caddeeafa5a6eadd2.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e98d4fc40aa4ba0ab9f1869191fb9c6x1114x1152.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fbb1a2bd7d2749848e0b5d6c65de14adx1124x1164.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c88f1e2a4524e66a6dfb9c2b2a71396x1280x967.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44b2bade4a614bb59f8aefeaad5854aax1280x858.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad62b78a0c1943a48afb795aa50884c8x320x554.PNG"
    ]
  },
  {
    "text": "A 35-year-old male was brought to the casualty after a road traffic accident. He presented with pallor, cold sweats, weakness, lightheadedness, thirst, and rapid breathing. On examination he was found to be mildly anxious and confused, and several bruises and lacerations in his limbs with vitals as follows :\nHeart rate - 132 bpm\nBlood Pressure - 90/60 mmHg.\nBased on the clinical signs, what is the estimated percentage of blood loss in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "> 40%"
      },
      {
        "id": 2,
        "text": "30 - 40 %"
      },
      {
        "id": 3,
        "text": "15 - 30 %"
      },
      {
        "id": 4,
        "text": "< 15%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features showing mild tachycardia, tachypnea, and hypotensive with anxiety and confusion is suggestive of&nbsp;<strong>Class III of hypovolemic (hemorrhagic) shock&nbsp;</strong>where the percentage of blood loss is estimated to be <strong>30 - 40 % ( ~ 1.5L).</strong></p>\n<p>A detailed classification of hemorrhagic shock along with various clinical signs is as given below.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the test shown in the image below",
    "choices": [
      {
        "id": 1,
        "text": "Dugas test"
      },
      {
        "id": 2,
        "text": "Bryant test"
      },
      {
        "id": 3,
        "text": "Callaway test"
      },
      {
        "id": 4,
        "text": "Hamilton ruler test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image portrayed above shows the <strong>Dugas' test</strong> which is used in the diagnosis of <strong>anterior dislocation</strong> of the <strong>shoulder.\u00a0</strong></p>\n<p>The patient is seated and places the hand of the affected shoulder on the opposite shoulder. The patient is instructed to touch the chest with the elbow. Inability to do so indicates shoulder subluxation or dislocation.</p>\n<p>Four tests are used to diagnose anterior dislocation of the shoulder. These include\u00a0<strong>Bryant's test</strong>,\u00a0<strong>Dugas test</strong>,\u00a0<strong>Hamilton ruler test,</strong>\u00a0and\u00a0<strong>Callaway test</strong>.\u00a0\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b946b823ee9c4c99abdb6d55c270a12e.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A young man visits the fever clinic with a history of high-grade fever, fatigue, and loss of appetite for the past 5 days. RT-PCR is done and he has been diagnosed with moderate COVID-19 disease. Awake proning has been advised. What is the sequence to be followed?",
    "choices": [
      {
        "id": 1,
        "text": "3, 1, 4, 2"
      },
      {
        "id": 2,
        "text": "2, 4, 1, 3"
      },
      {
        "id": 3,
        "text": "3, 4, 1, 2"
      },
      {
        "id": 4,
        "text": "2, 1, 4, 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient has<strong> moderate</strong> COVID-19 disease and <strong>awake proning</strong> is recommended in such patients.\u00a0Typical protocol includes:</p>\n<ul>\n<li>30\u2013120 minutes in the prone position, followed by\u00a0</li>\n<li>30\u2013120 minutes in the left lateral decubitus</li>\n<li>30\u2013120 minutes in right lateral decubitus</li>\n<li>30\u2013120 minutes in upright sitting position</li>\n</ul>\n<p>Awake proning should be encouraged in all patients who require supplemental oxygen therapy.\u00a0</p>\n<p>Criteria to be fulfilled :</p>\n<ul>\n<li>Normal mental status</li>\n<li>Able to self-prone or change position with minimal assistance</li>\n</ul>\n<p>Avoid proning in :</p>\n<ul>\n<li>Hemodynamic instability</li>\n<li>Close monitoring is not possible</li>\n</ul>\n<p>Important considerations while proning:</p>\n<ul>\n<li>Early self-proning in awake, non-intubated patients</li>\n<li>Any COVID-19 patient with respiratory embarrassment severe enough to be admitted to the hospital may be considered for rotation and early self-proning</li>\n<li>Care must be taken to not disrupt the flow of oxygen during patient rotation</li>\n</ul>\n<p>Management of Moderate cases of COVID-19 :</p>\n<ul>\n<li><strong>Symptomatic</strong> treatment such as antipyretic (paracetamol) for fever and pain, and anti-tussive for cough. Continue medications for co-morbid conditions.</li>\n<li><strong>Adequate hydration</strong> to be ensured</li>\n<li><strong>Oxygen Suppor</strong>t: Target SpO2: 92-96% (88-92% in patients with COPD).</li>\n<li><strong>Anticoagulation-</strong>prophylactic dose of un-fractionated heparin (UFH) or low molecular weight heparin (LMWH) (e.g enoxaparin 0.5 mg /Kg body wt per day SC)</li>\n<li><strong>Anti-inflammatory or immunomodulatory therapy</strong>- IV <strong>methylprednisolone 0.5 to 1 mg/kg</strong> or IV dexamethasone 0.1 to 0.2 mg/kg usually for a duration of 5 to 10 days.</li>\n<li>Antibiotics should not be prescribed routinely unless there is clinical suspicion of a bacterial infection.</li>\n<li><strong>Awake proning:</strong>\u00a0should be encouraged in all patients who require supplemental oxygen therapy.\u00a0</li>\n<li><strong>Monitoring</strong> for hemodynamic instability, and change in oxygen requirement. HRCT chest is to be done only if there is a worsening.</li>\n<li>Lab monitoring: Monitor <strong>CRP and D-dimer</strong> 48 to 72 hourly, and complete blood count, and renal and liver function tests 24 to 48 hourly. IL-6 levels should be done if the patient is deteriorating.</li>\n<li><strong>Remdesivir</strong> may be considered in patients who have\n<ul>\n<li>symptoms for less than 10 days</li>\n<li>moderate to a severe disease requiring supplemental oxygen</li>\n<li>Not pregnant and not lactating</li>\n<li>No renal or hepatic impairment (eGFR &lt;30 ml/min/m2; AST/ALT &gt;5 times upper limit of normal</li>\n<li>Dose: 200 mg IV on day 1 followed by 100 mg IV daily for 4 days (total 5 days)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9eeca83eac61429fbe6a1c07c70aa585x1280x3808.4062059238363.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles has a higher preponderance of slow-twitch muscle fibres so that there is prolonged muscle activity in lower leg?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrocnemius"
      },
      {
        "id": 2,
        "text": "Popliteus"
      },
      {
        "id": 3,
        "text": "Sartorius"
      },
      {
        "id": 4,
        "text": "Soleus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 1038\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1038\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Soleus</strong> muscle has a higher preponderance of slow-twitch muscle fibers and therefore is used to a greater extent for <strong>prolonged lower leg muscle activity.</strong></p>\n<div class=\"page\" title=\"Page 1038\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Fast-twitch and slow-twitch muscle fibers -</strong></p>\n<ul>\n<li>Fast-twitch fibers can deliver extreme amounts of power from a few seconds to a minute.\n<ul>\n<li>The enzymes that promote rapid release of energy from the <strong>phosphagen</strong> and <strong>glycogen&ndash;lactic acid energy</strong> systems are more active in fast-twitch fibers.</li>\n<li>They are about <strong>twice</strong> as large in diameter compared with slow-twitch fibers.</li>\n<li><strong>Gastrocnemius muscle</strong> has a higher bulk of fast-twitch fibers, which gives it the capability of forceful and rapid contraction, commonly used in <strong>jumping.</strong></li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li>Slow-twitch fibers are mainly organized for endurance, especially for the generation of aerobic energy.\n<ul>\n<li>They have&nbsp;<strong>more mitochondria</strong> than the fast-twitch fibers.</li>\n<li>They also contain considerably more<strong> myoglobin. </strong>The extra myoglobin increases the rate of diffusion of oxygen throughout the fiber.</li>\n<li>The enzymes of the <strong>aerobic metabolic system</strong> are considerably more active in slow-twitch fibers.</li>\n<li>The number of <strong>capillaries</strong> is <strong>greater</strong>&nbsp;around the slow-twitch fibers.</li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old male patient presented with polymorphous, erythematous patches with itching over his lower limbs, buttocks, and chest for the past 3 years. He has cervical lymphadenopathy. The peripheral blood smear shows lymphocytes with a cerebriform appearance. What will be the histopathological examination findings in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophil predominant micro abscess"
      },
      {
        "id": 2,
        "text": "Lymphocyte predominant micro abscess"
      },
      {
        "id": 3,
        "text": "Band like Lymphocytic infiltrate in dermo epidermal junction"
      },
      {
        "id": 4,
        "text": "Tubercles with peripheral lymphocytes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an elderly male with&nbsp;polymorphous, erythematous patches with pruritus and peripheral smear of lymphocytes with <strong>cerebriform appearance</strong> is suggestive of <strong>Mycosis fungoides.&nbsp;Lymphocyte-predominant </strong>micro abscesses known as<strong> Pautriers&rsquo;s microabscesses </strong>are seen in this condition.</p>\n<p><strong>Mycosis fungoides</strong>&nbsp;is cutaneous T cell lymphoma (CD4+ Helper T cells) which usually stays confined to the skin.&nbsp;It usually involves limb/ girdle, breast, and especially the&nbsp;<strong>buttock area</strong>. It can disseminate into the blood which&nbsp;is known as&nbsp;<strong>Sezary syndrome.</strong>&nbsp;It presents as diffuse erythema of the skin (erythroderma).</p>\n<p>Mycoses fungoides passes through 3 phases:</p>\n<ul>\n<li><strong>Inflammatory pre-mycotic phase-</strong>&nbsp;eczema-like lesions</li>\n<li><strong>Plaque phase-</strong>&nbsp;raised plaques are seen</li>\n<li><strong>Tumor phase-</strong>&nbsp;multiple tumor nodules indicating systemic spread</li>\n</ul>\n<p>The image given below shows phases seen in mycosis fungoides.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad6066f822ea4f27ba04e65651b8d2f0x1280x3713.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7196b110490e43a9b71481b3b39cf1b5x1280x4003.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cefe36aedbea4ea3b8fe2fbcc2caa7b1x1280x1418.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44b895ba9c4e4b6282e463e5f5c239bdx393x445.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8df14bef2cb64eba8c3e2018f35388d3x512x382.PNG"
    ]
  },
  {
    "text": "In the gynaecology operation theater, preparation for a female sterilization procedure is being made. You notice the instrument in the image below placed on the table. Which procedure is going to be performed?",
    "choices": [
      {
        "id": 1,
        "text": "Laparoscopic tubal ligation"
      },
      {
        "id": 2,
        "text": "Madlener operation"
      },
      {
        "id": 3,
        "text": "Uchida sterilization"
      },
      {
        "id": 4,
        "text": "Pomeroy technique"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given instrument is<strong>\u00a0a falope ring applicator</strong>. It is used in laparoscopic\u00a0<strong>tubal ligation</strong>.\u00a0</p>\n<p>Falope ring sterilization is accomplished by applying <strong>elastic bands</strong> or a falope ring to the fallopian tubes.</p>\n<div class=\"page\" title=\"Page 1034\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The falope ring applicator\u2019s tongs are opened and positioned around the tube approximately <strong>3cm</strong> away from the cornu, where the<strong> silastic falope ring</strong> is applied.\u00a0It draws up a portion of the tube and then pushes the ring onto the loop of the fallopian tube.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The major advantage is the elimination of thermocoagulation, as the Silastic ring controls most of the bleeding associated with the procedure. The occlusion is complete in a short segment and offers theoretical possibilities of tubal reconstruction. Other methods of laparoscopic tube sterilization include<strong> filshie clip</strong> sterilization and<strong> hulka clip</strong> sterilization.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/09c3478e21604eac87001de6f9857bf4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96e3fa21f7e147f39f677b223ba37276x1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4357d41ef08946e391717104bec0d5cbx1200x2309.JPEG"
    ]
  },
  {
    "text": "A patient presented with foreign body sensation, redness, and excessive watering from the right eye for 15 days after a twig brushed against his eye. On examination, an irregularly shaped ulcer with a whitish feathery appearance, and satellite lesions were seen in his right eye. Which among the following is the appropriate treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Acyclovir ointment"
      },
      {
        "id": 2,
        "text": "Propamidine isethionate"
      },
      {
        "id": 3,
        "text": "Hydrocortisone ointment"
      },
      {
        "id": 4,
        "text": "Amphotericin B drops"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario&nbsp;describes a <strong>fungal ulcer&nbsp;</strong>and the most appropriate treatment is <strong>amphotericin B drops</strong>.</p>\n<p>Fungal or <strong>mycotic keratitis</strong> is commonly caused by <strong>Aspergillus</strong>, <strong>Fusarium</strong>, or <strong>Candida albicans</strong>.&nbsp;They are characteristically seen after injury with <strong>vegetative matter</strong> like thorns or wooden sticks.</p>\n<p>Patients may present with pain, watering, and photophobia, but are usually milder in comparison to a bacterial ulcer. The clinical signs of a fungal ulcer include:</p>\n<ul>\n<li><strong>Irregular margins</strong> of the ulcer</li>\n<li>Presence of <strong>satellite lesions</strong> surrounding the ulcer</li>\n<li>An immune ring (Wesseley) may be seen around the ulcer due to the deposition of the immune complexes</li>\n<li>Dry slough with <strong>feathery borders</strong> surrounded by a yellow line of demarcation</li>\n<li><strong>Hypopyon</strong> may be present or absent. If present, it is thick, immobile due to the direct invasion of the fungal hyphae into the anterior chamber.</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li>Topical drugs\n<ul>\n<li><strong>Natamycin, voriconazole</strong>, and <strong>amphotericin B drops</strong> are effective against Aspergillus and Fusarium.</li>\n<li><strong>Nystatin</strong> is effective against Candida.</li>\n</ul>\n</li>\n<li>Systemic antifungal agents such as oral ketoconazole or voriconazole are considered if the ulcers are severe with hypopyon, perforated or in suspected endophthalmitis</li>\n<li>Surgical treatment:\n<ul>\n<li>Removal of necrotic material by scraping with a spatula</li>\n<li>Cauterization with&nbsp;pure carbolic acid or trichloracetic acid</li>\n<li>Therapeutic keratoplasty&nbsp;</li>\n</ul>\n</li>\n</ul>\n<p>The image below shows a fungal corneal ulcer with a hypopyon.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/630ee1376cb343f9a0958c7f72dd7f6fx1114x916.JPEG"
    ]
  },
  {
    "text": "A 4-year-old child is brought to the pediatrician for a routine examination.  On examination, a grade 3/6 systolic ejection murmur is heard along the left sternal border. S2 is widely split and does not vary with respiration. Lungs are clear and the abdomen is soft and non-tender.  Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Eisenmenger syndrome"
      },
      {
        "id": 2,
        "text": "Ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Atrial septal defect"
      },
      {
        "id": 4,
        "text": "Pulmonary stenosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">This child presents typically with\u00a0</span><strong><span data-preserver-spaces=\"true\">fixed wide split S2</span></strong><span data-preserver-spaces=\"true\">, a classic finding of <strong>a</strong></span><strong><span data-preserver-spaces=\"true\">trial septal defect (ASD), </span></strong>a type of <strong>acyanotic</strong> congenital heart disease.</p>\n<p><span data-preserver-spaces=\"true\">Atrial septal defects\u00a0are <strong>abnormal</strong>, <strong>fixed</strong> <strong>openings</strong> in the <strong>atrial</strong> <strong>septum</strong> caused by <strong>incomplete</strong> <strong>tissue</strong> <strong>formation</strong> that allows <strong>communication</strong> of <strong>blood between</strong> the left and right <strong>atria</strong>. The ASD creates a\u00a0</span><strong><span data-preserver-spaces=\"true\">left to right shunt</span></strong><span data-preserver-spaces=\"true\">\u00a0that <strong>increases</strong> the <strong>blood</strong> <strong>flow</strong> to the <strong>right</strong> side of the <strong>heart</strong>. This causes the pulmonary valve to close later than the aortic valve independent of inspiration/expiration. <strong>Most</strong> ASDs are <strong>asymptomatic</strong> and are <strong>picked</strong> <strong>up</strong> during <strong>routine</strong> physical <strong>examinations</strong>. A soft ejection systolic murmur best heard over the left upper sternal border is also commonly found.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">A mild <strong>left</strong> <strong>precordial</strong> <strong>bulge</strong> and a <strong>right</strong> <strong>ventricular</strong> <strong>systolic</strong> <strong>lift</strong> may be palpable at the <strong>left</strong> <strong>sternal</strong> <strong>border</strong>. Sometimes, a <strong>pulmonic</strong> <strong>ejection</strong> <strong>click</strong> can be heard.\u00a0</span><strong><span data-preserver-spaces=\"true\">Echocardiography\u00a0</span></strong><span data-preserver-spaces=\"true\">will show\u00a0</span>characteristic<strong><span data-preserver-spaces=\"true\"> right ventricular volume overload</span></strong><span data-preserver-spaces=\"true\">, including an <strong>increased right ventricular end-diastolic dimension</strong> and flattening and <strong>abnormal</strong> <strong>motion</strong> of the <strong>ventricular septum</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\">ASDs are classified according to location of the defect listed as follows:</span></p>\n<ul>\n<li>Patent foramen ovale</li>\n<li>Ostium secundum</li>\n<li>Ostium primum</li>\n<li>Sinus venosus</li>\n<li>Coronary sinus</li>\n</ul>\n<p>Murmurs are described based on <strong>intensity</strong>, frequency or pitch, quality, duration, configuration, primary location, and site of radiation. The intensity of a murmur is <strong>graded from 1-6</strong> as follows:\u00a0</p>\n<ul>\n<li>Grade 1 - Faint, can only be heard with special effort</li>\n<li>Grade 2 - Faint but immediately audible</li>\n<li>Grade 3 - Moderately loud</li>\n<li>Grade 4 - Very loud</li>\n<li>Grade 5 - Extremely loud and is audible with one edge of the stethoscope touching the chest wall</li>\n<li>Grade 6 - Loud, audible with stethoscope removed from contact with the chest wall</li>\n</ul>\n<p>Murmurs of intensity grade 4 and higher are generally accompanied by a thrill.\u00a0</p>\n<p>Other options:</p>\n<p>Option A:<strong><span data-preserver-spaces=\"true\">\u00a0Eisenmeger syndrome</span></strong><span data-preserver-spaces=\"true\"> occurs when an existing left to right shunt results in <strong>severe pulmonary hypertension</strong> and increased vascular resistance which reverses the shunt to form a right to left shunt. Patients with known congenital heart disease would present with worsening exertional dyspnea, swelling, volume retention, syncope, cyanosis, palpitations, or hemoptysis.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Option B: In\u00a0</span><strong><span data-preserver-spaces=\"true\">Ventricular septal defect</span></strong><span data-preserver-spaces=\"true\">\u00a0are generally asymptomatic and have a loud, harsh, or blowing <strong>holosystolic murmur</strong> heard over the lower left sternal border.\u00a0</span></p>\n<p>Option D:<strong><span data-preserver-spaces=\"true\"> Pulmonary stenosis</span></strong><span data-preserver-spaces=\"true\">\u00a0\u2013 It has\u00a0</span>a<strong><span data-preserver-spaces=\"true\"> systolic ejection murmur</span></strong><span data-preserver-spaces=\"true\">\u00a0best heard along the left upper sternal border minimally radiating to the lung fields. Other features seen in this condition include a sharp pulmonic ejection click after S1, heard during expiration, a split S2, elevated venous pressure, prominent a wave in jugulovenous pulse, right ventricular lift, and mild to moderate cyanosis.\u00a0</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e63d495075643e7b3e4a319242bbe69x1280x2643.046544428773.JPEG"
    ]
  },
  {
    "text": "Which fibre is marked by the arrow in the image given below?",
    "choices": [
      {
        "id": 1,
        "text": "Short association"
      },
      {
        "id": 2,
        "text": "Long association"
      },
      {
        "id": 3,
        "text": "Projection"
      },
      {
        "id": 4,
        "text": "Commissural"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The marked structure is the<strong> internal capsule</strong>, which is a form of <strong>projection fiber.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/35f5d3cfb2e344bc8233c754df37dfce.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c97f54709cd546ee970ca0051e1e3dbbx600x592.JPEG"
    ]
  },
  {
    "text": "A 3-year-old child presents with a history of repeated sinopulmonary infections caused by encapsulated organisms. Which of the following is most likely to be deficient in this case?",
    "choices": [
      {
        "id": 1,
        "text": "IgG1"
      },
      {
        "id": 2,
        "text": "IgG2"
      },
      {
        "id": 3,
        "text": "IgG3"
      },
      {
        "id": 4,
        "text": "IgG4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Deficiency</strong> of<strong> IgG2</strong> results in <strong>recurrent sinopulmonary</strong> infections with encapsulated organisms.</p>\n<p>IgG is the only maternal immunoglobulin that is normally transported across the placenta and provides natural passive immunity to the newborn. <strong>IgG1</strong> is the antibody maximally transported across the placenta<strong>,</strong> whereas <strong>IgG2</strong> has the <strong>least transplacental</strong> movement.\u00a0</p>\n<p>Deficiencies of other IgG:\u00a0</p>\n<ul>\n<li>IgG1- bacterial infections (diphtheria, tetanus)(Option A)</li>\n<li>IgG3- viral infections (Option C)</li>\n<li>IgG4- parasitic infections (Option D)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to you with a history of having ingested one of the seeds shown in the image below. Which of the following is not true?",
    "choices": [
      {
        "id": 1,
        "text": "It acts by blocking the action of GABA in the spinal cord"
      },
      {
        "id": 2,
        "text": "Ingestion of one crushed seed causes fatality"
      },
      {
        "id": 3,
        "text": "Death is associated with postmortem caloricity"
      },
      {
        "id": 4,
        "text": "Person remains conscious till death"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows seeds of <em><strong>Strychnos-nux vomica </strong></em>which contains\u00a0<strong>strychnine</strong>. It is a competitive <strong>antagonist</strong> of <strong>glycine</strong> at the <strong>postsynaptic receptors</strong> in the <strong>motor neurons</strong> of the <strong>anterior horn</strong> of the spinal cord. This leads to increased activity in the motor neurons.\u00a0</p>\n<p>The fatal dose is 15-30 mg of strychnine or <strong>one crushed seed.\u00a0</strong>If death is preceded by a severe convulsion, as in strychnine poisoning, it causes an increase in the body temperature called\u00a0<strong>postmortem caloricity.\u00a0</strong></p>\n<p>The toxin<strong> strychnine\u00a0</strong>does not affect any receptors in the brain and the person remains <strong>conscious</strong> till death. Strychnine poisoning is characterized by\u00a0<strong>conscious seizures.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28da31995d734b79823977bed702dd3a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The ECG of a patient undergoing treatment with a quinolone is given below and you notice that QTc = 477 ms. Which of the following drugs has the highest risk of causing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Moxifloxacin"
      },
      {
        "id": 2,
        "text": "Ciprofloxacin"
      },
      {
        "id": 3,
        "text": "Gemifloxacin"
      },
      {
        "id": 4,
        "text": "Ofloxacin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario describes&nbsp;<strong>QT interval prolongation</strong> (Normal QTc = 440 ms). Among the given options, <strong>moxifloxacin</strong> has the <strong>highest risk</strong> for causing this condition.</p>\n<p>Gemifloxacin, ofloxacin, and ciprofloxacin have a relatively lower risk than moxifloxacin.&nbsp;<strong>Ciprofloxacin</strong> has the<strong> least risk </strong>for QT interval prolongation and torsades de pointes.&nbsp;<strong>Sparfloxacin</strong> has the <strong>highest</strong> <strong>overall risk</strong> of QT prolongation and has been withdrawn from many countries due to its propensity to cause torsades de pointes or polymorphic ventricular tachycardia.</p>\n<table style=\"width: 498px;\">\n<tbody>\n<tr>\n<td style=\"width: 240px; text-align: center;\"><span style=\"font-size: 10pt;\"><strong>Withdrawn Fluoroquinolones</strong></span></td>\n<td style=\"width: 262px; text-align: center;\"><span style=\"font-size: 10pt;\"><strong>Associated Adverse Events</strong></span></td>\n</tr>\n<tr>\n<td style=\"width: 240px;\"><span style=\"font-size: 10pt;\">Sparfloxacin and&nbsp;Gatifloxacin</span></td>\n<td style=\"width: 262px;\"><span style=\"font-size: 10pt;\">Phototoxicity, QTc prolongation</span></td>\n</tr>\n<tr>\n<td style=\"width: 240px;\"><span style=\"font-size: 10pt;\">Trovafloxacin</span></td>\n<td style=\"width: 262px;\"><span style=\"font-size: 10pt;\">Hepatotoxicity</span></td>\n</tr>\n<tr>\n<td style=\"width: 240px;\"><span style=\"font-size: 10pt;\">Gatifloxacin</span></td>\n<td style=\"width: 262px;\"><span style=\"font-size: 10pt;\">Hypoglycemia</span></td>\n</tr>\n<tr>\n<td style=\"width: 240px;\"><span style=\"font-size: 10pt;\">Grepafloxacin</span></td>\n<td style=\"width: 262px;\"><span style=\"font-size: 10pt;\">Cardiotoxicity</span></td>\n</tr>\n<tr>\n<td style=\"width: 240px;\"><span style=\"font-size: 10pt;\">Temafloxacin</span></td>\n<td style=\"width: 262px;\"><span style=\"font-size: 10pt;\">Immune hemolytic anemia</span></td>\n</tr>\n<tr>\n<td style=\"width: 240px;\"><span style=\"font-size: 10pt;\">Clinafloxacin</span></td>\n<td style=\"width: 262px;\"><span style=\"font-size: 10pt;\">Phototoxicity</span></td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28e1d2a7a2a54dd4a9e5da3fb00c5446.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An individual positive for HIV-1 infection was started on a combination ART regimen of tenofovir\u2013emtricitabine\u2013efavirenz. After 6 months, failure of treatment was established and attributed to efavirenz resistance. Which drug of the same class can be used instead?",
    "choices": [
      {
        "id": 1,
        "text": "Delavirdine"
      },
      {
        "id": 2,
        "text": "Nevirapine"
      },
      {
        "id": 3,
        "text": "Nelfinavir"
      },
      {
        "id": 4,
        "text": "Etravirine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Etravirine</strong> can be used instead of efavirenz.</p>\n<p><strong>Etravirine</strong> is a non-nucleoside reverse transcriptase inhibitor <strong>(NNRTI)</strong> currently approved for the treatment of HIV infection in combination with other agents in <strong>treatment-experienced patients.</strong></p>\n<p>Options A, B: Etravirine is active against strains of HIV that are resistant to other NNRTIs such as&nbsp;<strong>delavirdine</strong>, <strong>nevirapine,</strong> and&nbsp;<strong>efavirenz</strong> which all exhibit <strong>cross-resistance</strong>. Rilpivirine, an NNRTI, is also effective across a broad range of NNRTI-resistant viruses but shares cross-resistance with etravirine.</p>\n<p>Option C: <strong>Nelfinavir</strong> is a protease inhibitor and hence, does not belong to the same class.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with Wilm's tumor undergoes renal transplantation. He is currently on corticosteroid therapy to prevent organ rejection. All of the following vaccinations could be given to this patient except?",
    "choices": [
      {
        "id": 1,
        "text": "Diphtheria-pertussis-tetanus (DPT)"
      },
      {
        "id": 2,
        "text": "Hepatitis B vaccine"
      },
      {
        "id": 3,
        "text": "Intra-nasal Influenza vaccine"
      },
      {
        "id": 4,
        "text": "Inactivated polio vaccine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Intra-nasal/ nasal spray influenza</strong> vaccine is a<strong> live attenuated vaccine,</strong> therefore it is<strong>&nbsp;contraindicated</strong> in this patient as he is<strong> immunosuppressed.</strong></p>\n<p>Live vaccines are prepared from live or wild <strong>attenuated</strong> organisms. They are repeatedly passed through tissue cultures or chick embryos in the laboratory. With this, they lose their ability to induce full-blown infection in an individual but <strong>retain</strong> their <strong>immunogenicity</strong>. It should not be administered to patients with <strong>immunodeficiency</strong> diseases, lymphoma, leukemia, or other malignancies. It is also not recommended in individuals on treatment with <strong>corticosteroids</strong>, antimetabolites, and alkylating agents. Unless the risk of infection exceeds the risk of harm, it is contraindicated in <strong>pregnancy</strong>.</p>\n<p><strong>Intramuscular influenza</strong> vaccine is an<strong> inactivated</strong> vaccine, which can be given in the immunocompromised.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Diptheria-pertussis-tetanus</strong> (DPT) vaccine is a combination&nbsp;<strong>toxoid </strong>vaccine. The toxins produced by diphtheria and tetanus bacilli are detoxicated and used to prepare the vaccine. They are highly <strong>efficacious</strong> and <strong>safe</strong>. The<strong> killed</strong> whole organism is used for the pertussis component.&nbsp;</p>\n<p>Option B: <strong>Hepatitis B vaccine</strong> is a <strong>recombinant</strong> vaccine. It is produced by inserting a viral gene segment into a yeast cell. It does not contain viral DNA and will <strong>not</strong> produce an <strong>infection</strong>.</p>\n<p>Option D: <strong>Inactivated polio vaccine</strong> is a <strong>killed</strong> vaccine. As the organism cannot grow in a vaccinated individual, it can be given to an immunodeficient individual.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The patient presents with pigmentation of the face as shown in the image below and gradually increasing backache and stiffness. The X-ray image of the spine is shown. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylketonuria"
      },
      {
        "id": 2,
        "text": "Alkaptonuria"
      },
      {
        "id": 3,
        "text": "Maple syrup urine disease"
      },
      {
        "id": 4,
        "text": "Tyrosinemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical images show the accumulation of<strong> blackish discoloration </strong>on the face and the X-Ray shows <strong>calcification</strong> of the <strong>intervertebral discs</strong>. These findings are associated with<strong> alkaptonuria. </strong></p>\n<p><strong>Alkaptonuria</strong> is a condition caused due to the deficiency of <strong>homogentisic acid oxidase.</strong> This results in the accumulation of homogentisic acid.</p>\n<p>This condition is associated with the following symptoms:</p>\n<ul>\n<li><strong>Black ochronotic pigmentation </strong>(Alkapton bodies) of cartilage and collagenous tissue</li>\n<li>Homogentisic aciduria (patient\u2019s urine contains elevated levels of homogentisic acid, which is oxidized to a dark pigment on standing)</li>\n<li>Large joint arthritis</li>\n<li>Calcification of intervertebral discs known as as <strong>ochronotic spondyloarthropathy</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/afa097f6b2844848852fa6c7815e2562.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Following is the otoscopic image of a surfer complaining of deafness. Pure tone audiometry is suggestive of conductive hearing loss. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ceruminoma"
      },
      {
        "id": 2,
        "text": "Osteoma"
      },
      {
        "id": 3,
        "text": "Exostoses"
      },
      {
        "id": 4,
        "text": "Sebaceous adenoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The otoscopic finding is suggestive of <strong>exostoses.</strong></p>\n<p>A<strong> surfer</strong> with a clinical diagnosis of a <strong>conductive type of hearing loss</strong> with the otoscopic image showing <strong>multiple, sessile bumpy swellings</strong> in the external auditory canal draws us to a diagnosis of <strong>exostoses.</strong></p>\n<p>Exostoses are&nbsp;<strong>bilateral multiple smooth sessile bony swellings</strong> in the <strong>deeper canal</strong> seen in surfers. It is also called as&nbsp;<strong>surfer&rsquo;s ear.&nbsp;</strong>They can be removed with a high-speed drill to restore the normal external auditory canal.</p>\n<p>The following CT image shows the difference between a normal ear canal and an ear canal with exostoses.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c3711b8a6a024895a791ccfeb29be31d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/30f0766d45a94828a60be98d088c2520x1024x512.JPEG"
    ]
  },
  {
    "text": "A 60-year-old male comes to the emergency with a cardiac arrest and cardiopulmonary resuscitation is initiated. Which of the following capnographs would be obtained in this case?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">Image\u00a0</span><strong><span data-preserver-spaces=\"true\">B</span></strong><span data-preserver-spaces=\"true\">\u00a0represents the capnographic waveform seen while performing</span><strong><span data-preserver-spaces=\"true\">\u00a0</span></strong>cardiopulmonary resuscitation<span data-preserver-spaces=\"true\">.\u00a0</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Waveform capnography</span></strong><span data-preserver-spaces=\"true\">\u00a0is a\u00a0</span><strong><span data-preserver-spaces=\"true\">continuous non-invasive measurement</span></strong><span data-preserver-spaces=\"true\">\u00a0and\u00a0</span><strong><span data-preserver-spaces=\"true\">graphical display</span></strong><span data-preserver-spaces=\"true\">\u00a0of the\u00a0</span><strong><span data-preserver-spaces=\"true\">EtCO2</span></strong><span data-preserver-spaces=\"true\">.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Uses of waveform capnography in CPR:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Evaluation of the</span><strong><span data-preserver-spaces=\"true\">\u00a0effectiveness</span></strong><span data-preserver-spaces=\"true\">\u00a0of\u00a0</span><strong><span data-preserver-spaces=\"true\">chest compressions</span></strong><span data-preserver-spaces=\"true\">\u00a0(</span><strong><span data-preserver-spaces=\"true\">&lt;10 mmHg</span></strong><span data-preserver-spaces=\"true\">\u00a0low EtCO<sub>2</sub> suggests poor chest compressions)</span></li>\n<li><span data-preserver-spaces=\"true\">Identification of\u00a0</span><strong><span data-preserver-spaces=\"true\">return of spontaneous circulation</span></strong><span data-preserver-spaces=\"true\">\u00a0(significant increase to 35\u201345 mmHg, due to drastic improvement of blood flow to the lungs)</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">It is a\u00a0</span><strong><span data-preserver-spaces=\"true\">direct</span></strong><span data-preserver-spaces=\"true\">\u00a0measure of\u00a0</span><strong><span data-preserver-spaces=\"true\">lung ventilation</span></strong><span data-preserver-spaces=\"true\">\u00a0and an\u00a0</span><strong><span data-preserver-spaces=\"true\">indirect</span></strong><span data-preserver-spaces=\"true\">\u00a0measure of\u00a0</span><strong><span data-preserver-spaces=\"true\">circulation</span></strong><span data-preserver-spaces=\"true\">\u00a0and\u00a0</span><strong><span data-preserver-spaces=\"true\">metabolism</span></strong><span data-preserver-spaces=\"true\">. It is now the\u00a0</span><strong><span data-preserver-spaces=\"true\">desired investigation</span></strong><span data-preserver-spaces=\"true\">\u00a0for assessing the\u00a0</span><strong><span data-preserver-spaces=\"true\">effectiveness of chest compressions</span></strong><span data-preserver-spaces=\"true\">.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Image </span><strong><span data-preserver-spaces=\"true\">A</span></strong><span data-preserver-spaces=\"true\">\u00a0shows\u00a0</span><strong><span data-preserver-spaces=\"true\">rebreathing of CO<sub>2</sub></span></strong><span data-preserver-spaces=\"true\">, which may occur due to a faulty expiratory valve or an exhausted absorber system.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Image</span><strong><span data-preserver-spaces=\"true\">\u00a0C</span></strong><span data-preserver-spaces=\"true\">\u00a0shows\u00a0</span><strong><span data-preserver-spaces=\"true\">cardiac oscillations</span></strong><span data-preserver-spaces=\"true\">\u00a0at the\u00a0</span><strong><span data-preserver-spaces=\"true\">end of expiration</span></strong><span data-preserver-spaces=\"true\">\u00a0as flow decreases and the</span><strong><span data-preserver-spaces=\"true\">\u00a0beating heart</span></strong><span data-preserver-spaces=\"true\">\u00a0causes</span><strong><span data-preserver-spaces=\"true\">\u00a0emptying and filling</span></strong><span data-preserver-spaces=\"true\">\u00a0of various parts of the lung with exhaled and fresh air.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Image</span><strong><span data-preserver-spaces=\"true\">\u00a0D</span></strong><span data-preserver-spaces=\"true\">\u00a0shows\u00a0</span><strong><span data-preserver-spaces=\"true\">malignant hyperthermia.</span></strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/baf8859a7610421dbd6d581afe68a9db.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ff48cfc4b6c64e929f5d6f6856bd1477x1280x1075.JPEG"
    ]
  }
];
        let quizName = 'Neet Mini - 20 (20 Q)';
        const quizFilename = 'neet-mini-20-20-q-4fc1d5ef.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>