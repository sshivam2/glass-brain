<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bleeding And Clotting Disorders Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A boy presented with a painful right knee swelling as seen in the image. He has a history of easy bruising and hematoma formation at injection sites. His lab investigation report is given below. Which of the following is the preferred treatment option for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Factor VIII concentrate"
      },
      {
        "id": 2,
        "text": "Cryoprecipitate"
      },
      {
        "id": 3,
        "text": "Fresh frozen plasma"
      },
      {
        "id": 4,
        "text": "Whole blood transfusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image showing knee joint swelling in a patient with bleeding tendency and prolonged aPTT indicates bleeding into the joint space, i.e. <strong>hemarthrosis</strong> due to <strong>hemophilia</strong>. The preferred treatment option among the ones given here is the administration of<strong> factor VIII concentrate.</strong></p>\n<p><strong>Hemophilia</strong> is a coagulation disorder occurring due to a deficiency of <strong>clotting factor VIII</strong>, leading to <strong>hemophilia A,</strong>\u00a0or <strong>clotting factor IX</strong>, leading to<strong> hemophilia B</strong>. Hemophilia<strong> </strong>A and B are <strong>clinically indistinguishable </strong>and can be differentiated based on<strong> clotting factor assay.</strong>\u00a0The disorder is X-linked recessive, meaning males are affected, and females are asymptomatic carriers.</p>\n<p>Patients present with bleeding tendencies such as ecchymoses, epistaxis, haematuria, menorrhagia, hemarthrosis, prolonged bleeding after dental or minor surgical procedures, etc. <strong>Repeated hemarthrosis</strong> causes chronic <strong>synovitis</strong> and articular <strong>cartilage erosion</strong>, leading to <strong>hemophilic arthritis.</strong></p>\n<div class=\"page\" title=\"Page 1\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Laboratory findings</strong> in hemophilia:</p>\n<ul>\n<li><strong>Activated partial thromboplastin time</strong> (aPTT) -<strong> prolonged</strong></li>\n<li>Platelet count- normal</li>\n<li>Bleeding time- normal</li>\n<li>Prothrombin time- normal</li>\n<li>The mixing of normal plasma with patient plasma results in the correction of the aPTT value.</li>\n</ul>\n<p>Based on the percent activity of specific clotting factors, hemophilia is classified into:</p>\n<table style=\"height: 137px; width: 327px;\">\n<tbody>\n<tr>\n<td style=\"width: 112px;\"><strong>Severity</strong></td>\n<td style=\"width: 199px;\"><strong>The activity of a specific clotting factor</strong></td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Severe</td>\n<td style=\"width: 199px;\">&lt;1%</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Moderate</td>\n<td style=\"width: 199px;\">1-5%</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Mild</td>\n<td style=\"width: 199px;\">&gt;5%</td>\n</tr>\n</tbody>\n</table>\n<p><strong><br />Mild</strong> cases of hemophilia are <strong>treated</strong> by administration of <strong>desmopressin acetate. Moderate</strong> to <strong>severe</strong> cases need the <strong>replacement</strong> of deficient <strong>clotting factors. </strong>The monoclonal antibody <strong>emicizumab</strong> can bridge activated factor IX and factor X, thus restoring functional activated factor VIII activity in patients with hemophilia.</p>\n<p>Please note that this patient could have either hemophilia A or B. The preferred treatment options for hemophilia are the administration of factor VIII and factor IX for hemophilia A and B, respectively. As factor IX is not given in the options, factor VIII is the best possible answer.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2e1d4838ba5448fcbfebeaa4b2a3ea0b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 1-year-old child was brought to you with complaints of mucosal and joint bleeds. Laboratory investigation revealed the complete absence of  Von Willebrand factor (VWF) protein. What could be the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Type 1 Von Willebrand disease"
      },
      {
        "id": 2,
        "text": "Type 3 Von Willebrand disease"
      },
      {
        "id": 3,
        "text": "Type 2A Von Willebrand disease"
      },
      {
        "id": 4,
        "text": "Type 2B Von Willebrand disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\"><strong>Complete quantitative deficiency</strong> of vWF protein is seen in\u00a0<strong>Type 3\u00a0Von Willebrand disease.</strong></p>\n<p class=\"p1\">von Willebrand disease (VWD) is the most common inherited bleeding disorder.\u00a0Patients with VWD typically present with mucosal bleeding. VWD may be caused by quantitative or qualitative defects in VWF</p>\n<ul>\n<li>Type 1 VWD: Partial quantitative deficiency of vWF\u00a0</li>\n<li>Type 2 VWD: Qualitative deficiency of vWF</li>\n<li>Type 3 VWD: Complete quantitative deficiency of vWF</li>\n</ul>\n<p>Note:\u00a0</p>\n<ul>\n<li>Type 1 VWD is the most common type, accounting for 60-80% of all VWD patients.</li>\n<li>Most severe type is Type\u00a03</li>\n<li>Most common inheritance: Autosomal dominant</li>\n</ul>\n<p>Characteristics of the subtypes of VWD are summarized below:</p>\n<table style=\"height: 169px; width: 451px;\">\n<tbody>\n<tr>\n<td style=\"width: 100px; text-align: center;\"><strong>Type</strong></td>\n<td style=\"width: 10px; text-align: center;\"><strong>Inheritance</strong></td>\n<td style=\"width: 273px; text-align: center;\"><strong>Mechanism</strong></td>\n<td style=\"width: 253px; text-align: center;\"><strong>Important characteristics</strong></td>\n</tr>\n<tr>\n<td style=\"width: 100px; text-align: center;\">1</td>\n<td style=\"width: 10px; text-align: center;\">AD</td>\n<td style=\"width: 273px; text-align: center;\">Partial, quantitative deficiency of VWF</td>\n<td style=\"width: 253px; text-align: center;\"><strong>Most common type</strong></td>\n</tr>\n<tr>\n<td style=\"width: 100px; text-align: center;\">3</td>\n<td style=\"width: 10px; text-align: center;\">AR</td>\n<td style=\"width: 273px; text-align: center;\">Complete quantitative deficiency</td>\n<td style=\"width: 253px; text-align: center;\">Most severe\u00a0VWD</td>\n</tr>\n<tr>\n<td style=\"width: 100px; text-align: center;\">2A</td>\n<td style=\"width: 10px; text-align: center;\">AD</td>\n<td style=\"width: 273px; text-align: center;\">Loss of VWF multimers (increased cleavage by ADAMS13)</td>\n<td style=\"width: 253px; text-align: center;\">Platelet adhesion defect</td>\n</tr>\n<tr>\n<td style=\"width: 100px; text-align: center;\">2B</td>\n<td style=\"width: 10px; text-align: center;\">AD</td>\n<td style=\"width: 273px; text-align: center;\">Increased binding of VWF to platelets causing VWF-platelet complex destruction</td>\n<td style=\"width: 253px; text-align: center;\"><strong>Thrombocytopenia</strong></td>\n</tr>\n<tr>\n<td style=\"width: 100px; text-align: center;\">2M</td>\n<td style=\"width: 10px; text-align: center;\">AD</td>\n<td style=\"width: 273px; text-align: center;\">Decreased affinity of VWF to platelets</td>\n<td style=\"width: 253px; text-align: center;\">Platelet adhesion defect, very rare</td>\n</tr>\n<tr>\n<td style=\"width: 100px; text-align: center;\">2N</td>\n<td style=\"width: 10px; text-align: center;\"><strong>AR</strong></td>\n<td style=\"width: 273px; text-align: center;\">Decreased affinity of VWF to Factor VIII</td>\n<td style=\"width: 253px; text-align: center;\"><strong>Autosomal hemophilia</strong></td>\n</tr>\n</tbody>\n</table>\n<p>AD: autosomal dominant</p>\n<p>AR: autosomal recessive</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Romiplostim is a",
    "choices": [
      {
        "id": 1,
        "text": "Recombinant human erythropoietin"
      },
      {
        "id": 2,
        "text": "Recombinant human granulocyte colony-stimulating factor"
      },
      {
        "id": 3,
        "text": "Recombinant human IL-11"
      },
      {
        "id": 4,
        "text": "Thrombopoietin receptor agonist"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Romiplostim </strong>is a<strong>&nbsp;thrombopoietin receptor agonist</strong>. It is used in the management of immune thrombocytopenia (ITP).&nbsp;<strong>Eltrombopag</strong> is also a&nbsp;thrombopoietin receptor agonist. It is used in the treatment of ITP and severe aplastic anemia.</p>\n<p>Other options:</p>\n<p class=\"p1\">Option A- <strong>Epoetin alfa</strong> and <strong>darbepoetin alfa</strong> are&nbsp;<strong>recombinant human erythropoietin</strong>. They can be used in the treatment of <strong>anemias</strong> associated with surgery, AIDS, cancer chemotherapy, prematurity, and certain chronic inflammatory conditions.&nbsp;</p>\n<p class=\"p1\">Option B- <strong>Filgrastim</strong> is a <strong>recombinant&nbsp;granulocyte colony-stimulating factor.&nbsp;</strong>It increases neutrophil production. It is used in the treatment of <strong>neutropenia</strong>. Important adverse reactions include bone pain, local skin reaction, and cutaneous necrotizing vasculitis.</p>\n<p class=\"p1\">Option C- <strong>Oprelvekin</strong> is a recombinant <strong>human IL-11</strong>. It increases thrombopoiesis. It is used in the treatment of <strong>thrombocytopenia</strong> due to non-myeloid malignancies. Important adverse effects are&nbsp;fluid retention, tachycardia, palpitation, edema, and shortness of breath.</p>\n<p class=\"p1\"><strong>Sargramostim</strong> is a recombinant granulocyte-macrophage colony-stimulating factor. It stimulates <strong>myelopoiesis</strong>. Important adverse effects are&nbsp;bone pain, malaise, flu-like symptoms, diarrhea, dyspnea, and rash.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A peripheral smear showed small sized platelets. This is characteristic of ____________",
    "choices": [
      {
        "id": 1,
        "text": "Wiskott Aldrich syndrome"
      },
      {
        "id": 2,
        "text": "Bernard soulier syndrome"
      },
      {
        "id": 3,
        "text": "ITP"
      },
      {
        "id": 4,
        "text": "Heparin induced thrombocytopenia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Small sized platelets on peripheral smear is a characteristic of Wiskott Aldrich syndrome.</p>\n<p><strong>Wiskott Aldrich syndrome: </strong>There is a<strong> mutation</strong>&nbsp;in the&nbsp;<strong>gene</strong>&nbsp;encoding Wiskott-Aldrich syndrome protein&nbsp;<strong>(WASP),</strong>&nbsp;which is located on&nbsp;<strong>Xp11.23</strong><strong>. The X-linked disease </strong>is&nbsp;characterized by <strong>thrombocytopenia, eczema</strong>, and a marked vulnerability to<strong>&nbsp;recurrent infection</strong>, resulting in early death.</p>\n<ul>\n<li><strong>Platelets</strong>&nbsp;are<strong>&nbsp;small</strong>&nbsp;in size.</li>\n<li>There is a progressive&nbsp;<strong>loss of T lymphocytes&nbsp;</strong>in the<strong>&nbsp;peripheral blood</strong>&nbsp;and in the<strong>&nbsp;T-cell zones (paracortical areas) of the lymph nodes,</strong>&nbsp;with variable defects in cellular immunity.</li>\n<li>Patients do not make antibodies to polysaccharide antigens, and the response to protein antigens is poor. They are prone&nbsp;to develop<strong>&nbsp;B-cell lymphomas.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old female patient presents with petechiae and one episode of epistaxis. She gives a history of an upper respiratory tract infection 3 weeks ago. Her lab reports are given below. Which of the following is the most appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Prednisolone"
      },
      {
        "id": 2,
        "text": "Platelet transfusion"
      },
      {
        "id": 3,
        "text": "Splenectomy"
      },
      {
        "id": 4,
        "text": "Amoxicillin-clavulanic acid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a patient developing <strong>petechiae</strong> and one episode of <strong>epistaxis</strong> <strong>following upper respiratory tract infection</strong>, and lab reports showing a <strong>platelet count of 12,000/&mu;L</strong> are suggestive of <strong>immune thrombocytopenic purpura (ITP)</strong>. Since this patient has had only one episode of epistaxis and her hemoglobin is normal,<strong> </strong>the<strong> most appropriate management </strong>for this patient would be <strong>prednisolone.</strong></p>\n<p>In patients <strong>without significant bleeding</strong> and <strong>without severe thrombocytopenia</strong> (platelet count <strong>&lt; 5000 cells/&mu;L</strong>), the initial treatment is with <strong>glucocorticoids</strong> such as prednisolone or dexamethasone.</p>\n<p>If the patient has <strong>severe bleeding</strong> or <strong>severe thrombocytopenia</strong>, <strong>IVIg and glucocorticoids</strong> are used <strong>in</strong> <strong>conjunction</strong>. Anti-D is used as an alternative to IVIg, but is not preferred because of the risk of severe hemolytic reactions. <strong>Platelet transfusions</strong> (option B) are reserved <strong>for patients</strong> in whom there is a need to <strong>immediately raise the platelet counts</strong>.&nbsp;</p>\n<p>The decision to start treatment in a patient who is incidentally diagnosed and doesn't have any bleeding manifestations is based on the platelet count. Treatment is usually started for these patients if the platelet count is &lt; 30,000 cells/&mu;L.</p>\n<p><strong>Splenectomy</strong> (option C) has been used previously for patients who relapse after glucocorticoid therapy, but is now a <strong>reserved treatment option.</strong> In most adult patients, ITP resolves spontaneously, and so it is reasonable to observe the patient with intermittent treatment with IVIg before surgery is considered.</p>\n<p>Other drugs which are used in the treatment of ITP include <strong>anti-CD20 antibody rituximab</strong>, and <strong>thrombopoietin</strong> <strong>(TPO) receptor agonists</strong> such as <strong>romiplostim</strong> and <strong>eltrombopag</strong>.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A girl presented to the casualty with anuria for 2 days and a recent history of fever and bloody diarrhea 5 days back. An examination reveals petechiae on the trunk and jaundice of the skin, but no neurological deficit. Schistocytes are seen on a peripheral smear and other lab findings are shown below. Besides supportive care, what is the best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet transfusion"
      },
      {
        "id": 2,
        "text": "PRBC transfusion"
      },
      {
        "id": 3,
        "text": "Hemodialysis"
      },
      {
        "id": 4,
        "text": "IV Antibiotics"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of this child, along with\u00a0lab investigations suggests a diagnosis of <strong>hemolytic uremic syndrome</strong> (HUS) causing <strong>AKI</strong> resulting in<strong> acidosis</strong> and <strong>hyperkalemia</strong>. Thus the patient should be managed with <strong>hemodialysis.</strong></p>\n<p>Up to half of the patients with HUS may require <strong>dialysis</strong> support during the <strong>acute phase </strong>of the disease. The patient\u2019s symptoms <strong>(anuria)</strong> and lab findings <strong>(acidosis, hyperkalemia)</strong> align with the indications for dialysis in AKI. Indications include:</p>\n<ol>\n<li>Anuria/oliguria</li>\n<li>Severe metabolic acidosis</li>\n<li>Hyperkalemia</li>\n<li>Uremic symptoms, such as pericarditis or encephalopathy</li>\n<li>Fluid overload unresponsive to diuretics</li>\n</ol>\n<p><strong>HUS </strong>is a condition characterized by <strong>microangiopathic hemolytic anemia</strong>, <strong>thrombocytopenia</strong>, and <strong>acute kidney injury</strong>. It commonly affects children up to <strong>5 years</strong> of age. The disease is often linked to a preceding gastrointestinal infection caused by <strong>Shiga toxin-producing</strong> strains like <strong>E. coli O157:H7</strong> or <strong>Shigella dysenteriae</strong>.</p>\n<p>There is widespread injury to small vessel <strong>endothelium</strong>, leading to <strong>thrombotic microangiopathy</strong>. The formation of these <strong>microthrombi </strong>causes a decrease in platelet count. There is associated destruction of RBCs causing <strong>hemolytic anemia</strong>. Renal vascular occlusion by microthrombi results in <strong>acute kidney injury</strong>.</p>\n<p>Investigations will show a hemolytic blood picture with reticulocytosis and <strong>schistocytes</strong> on a peripheral smear. There will be<strong> reduced platelets </strong>and <strong>deranged renal function tests</strong>. Liver function tests will reveal an <strong>elevated indirect bilirubin</strong>.</p>\n<p>Other options</p>\n<p>Option A:<strong> Platelet transfusions</strong> are generally<strong> not recommended </strong>in HUS unless there is active bleeding because ongoing microangiopathic processes rapidly consume platelets and transfusions may exacerbate the condition.</p>\n<p>Option B The patient's hemoglobin is 8.6 g/dL, which is mildly low. However, <strong>RBC transfusion</strong> is generally reserved for more severe anemia with <strong>Hb&lt;7g/dL</strong>.</p>\n<p>Option D. <strong>Antibiotics</strong> are <strong>ineffective</strong> in treating HUS and may worsen the hemolysis and stimulate the release of <strong>Shiga toxin</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with protein C deficiency are at an increased risk of developing all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Deep vein thrombosis"
      },
      {
        "id": 2,
        "text": "Purpura fulminans"
      },
      {
        "id": 3,
        "text": "Warfarin-induced skin necrosis"
      },
      {
        "id": 4,
        "text": "Spontaneous bleeding"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Spontaneous bleeding is not seen in protein C deficiency. It is characterised by an&nbsp;<strong>increased </strong>tendency for <strong>thrombus formation</strong>.</p>\n<p><strong>Protein C deficiency</strong> is a rare genetic disorder.&nbsp;It predisposes to the following thrombotic complications:</p>\n<ul>\n<li><strong>Deep vein thrombosis </strong>(DVT):\n<ul>\n<li>Adults with a mild form of the disease at higher risk of developing venous thromboembolism.</li>\n</ul>\n</li>\n<li><strong>Purpura fulminans</strong>:\n<ul>\n<li>Severe form of <strong>DIC</strong></li>\n<li>Thrombosis of extensive areas of the skin</li>\n<li>Affects predominantly young children following viral or bacterial infection.&nbsp;</li>\n</ul>\n</li>\n<li><strong>Warfarin-induced skin necrosis:</strong>\n<ul>\n<li>Rare complication seen in patients with congenital or acquired deficiencies of protein C or S.</li>\n<li>Thrombosis of the skin leads to well-demarcated erythematous lesions with central necrosis on the thighs, buttocks, breasts, or toes(shown below).</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ad8b3fbe45c4161a1887693df8a08aex416x501.PNG"
    ]
  },
  {
    "text": "A 4-year-old girl presented with a history of easy bruising and frequent nosebleeds. There was no history of fever. The platelet count was low and the peripheral smear showed platelets, as marked by the arrows. Platelet function studies show an absence of aggregation to ristocetin but a normal response to adenosine diphosphate (ADP), epinephrine, and collagen. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Glanzmann thrombasthenia"
      },
      {
        "id": 2,
        "text": "Thrombotic thrombocytopenic purpura"
      },
      {
        "id": 3,
        "text": "von Willebrand disease"
      },
      {
        "id": 4,
        "text": "Bernard-Soulier syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is suggestive of&nbsp;<strong>Bernard-Soulier syndrome.</strong></p>\n<p>Points that favor the diagnosis:</p>\n<ul>\n<li>History of<strong> easy bruising</strong> and <strong>frequent nosebleeds</strong></li>\n<li><strong>Low&nbsp;platelet count&nbsp;</strong>and <strong>giant</strong> platelets</li>\n<li><strong>Prolonged bleeding time</strong></li>\n<li><strong>Absent aggregation </strong>to<strong> ristocetin</strong> in platelet function studies&nbsp;</li>\n</ul>\n<p>It is an <strong>autosomal recessive </strong>disorder due to an inherited deficiency of platelet membrane <strong>glycoprotein</strong> complex <strong>Ib-IX</strong>. This glycoprotein is a receptor of the von Willebrand factor, which is needed for normal platelet adhesion to the subendothelial extracellular matrix.&nbsp;</p>\n<p>They mostly present with easy bruising, nose bleeds, mucosal bleeding, menorrhagia, and occasionally gastrointestinal bleeding.</p>\n<p><strong>Laboratory features</strong>:</p>\n<ul>\n<li>Low platelet count</li>\n<li>Large platelets on smear</li>\n<li>Platelet&nbsp;aggregation will not occur in response to ristocetin but have normal aggregation with&nbsp; ADP, collagen, or epinephrine</li>\n<li>Platelet membrane glycoprotein abnormality is seen on flow cytometry.</li>\n</ul>\n<p>Supportive treatment is only needed. Antiplatelet medications like aspirin should be avoided. Anti-fibrinolytic can be used in mucosal bleeding.</p>\n<p>The below image shows giant platelets in peripheral blood smear in&nbsp;Bernard-Soulier syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0766850a9c0d40918b5e00be402c1875.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9b03eb479d840ff8c169ee91bd4f1aex816x612.PNG"
    ]
  },
  {
    "text": "Match the Tests used to assess the Coagulation pathway with their use.",
    "choices": [
      {
        "id": 1,
        "text": "1-b, 2-c, 3-d, 4-a"
      },
      {
        "id": 2,
        "text": "1-c, 2-d, 3-a, 4-b"
      },
      {
        "id": 3,
        "text": "1-a, 2-c, 3-b, 4-d"
      },
      {
        "id": 4,
        "text": "1-d, 2-b, 3-c, 4-a"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correctly matched order of the <strong>tests</strong> used to assess the <strong>Coagulation pathway</strong> with their use is\u00a0 <strong>1-b, 2-c, 3-d, 4-a </strong>(Option A)</p>\n<table style=\"border-collapse: collapse; width: 32.2166%; height: 497px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 50%;\">Test</td>\n<td style=\"width: 50%;\">Use</td>\n</tr>\n<tr>\n<td style=\"width: 50%;\">1. <strong>Prothrombin Time</strong> (PT)</td>\n<td style=\"width: 50%;\">b. Evaluates the <strong>extrinsic</strong> and the <strong>common</strong> coagulation pathways.</td>\n</tr>\n<tr>\n<td style=\"width: 50%;\">2.<strong> Activated partial thromboplastin</strong> time (aPTT)</td>\n<td style=\"width: 50%;\">c. Evaluates the <strong>intrinsic</strong> and the <strong>common</strong> coagulation pathways.</td>\n</tr>\n<tr>\n<td style=\"width: 50%;\">3.<strong> Thrombin</strong> time (TT)</td>\n<td style=\"width: 50%;\"><br />d. Evaluate the conversion of <strong>fibrinogen </strong>into <strong>fibrin</strong>.</td>\n</tr>\n<tr>\n<td style=\"width: 50%;\">4. <strong>Bleeding </strong>time (BT)</td>\n<td style=\"width: 50%;\"><br />a. Evaluate the ability of <strong>platelets</strong> to form a <strong>hemostatic plug.\u00a0</strong></td>\n</tr>\n</tbody>\n</table>\n<p>1) <strong>Prothrombin </strong>time<strong> </strong>is the time taken for citrated plasma to clot after the addition of tissue thromboplastin and calcium. It evaluates the <strong>extrinsic</strong> pathway and <strong>common</strong> pathways, i.e., factors <strong>VII, X, V, II </strong>(prothrombin), and <strong>fibrinogen</strong>. Normal PT is<strong> </strong>11 to 16 seconds. Causes of prolonged PT include<strong> </strong>Liver diseases,<strong> Vitamin K deficiency</strong>, Disseminated intravascular coagulation (<strong>DIC</strong>), Factor VII, X, V, or prothrombin deficiency.</p>\n<p>2) <strong>Activated partial thromboplastin </strong>time (APTT) is the time taken for citrated plasma to clot in the presence of a surface activator (kaolin), phospholipid, and<strong> </strong>calcium. It evaluates <strong>intrinsic</strong> and <strong>common</strong> pathways, i.e., factors<strong> VIII, IX,</strong> X, XI, XII, V, II, and fibrinogen. Normal APTT is 30 to 40 seconds. APTT is<strong> </strong>prolonged in <strong>Hemophilias</strong> that involve deficiencies of factor VIII, IX or XI, DIC, Liver diseases, etc.</p>\n<p>3) <strong>Bleeding Time</strong> (BT) is used as a screening test for disorders of platelet-vessel wall interactions. It measures the time required for bleeding to stop after a standardized superficial cut<strong> </strong>of the skin capillary bed. It assesses<strong> platelet number</strong> and<strong> function</strong>.\u00a0The normal BT is 2-8 minutes. Prolonged bleeding time is found in <strong>thrombocytopenia</strong> and <strong>Von Willebrand disease</strong>.</p>\n<p>4) <strong>Thrombin Time </strong>(TT) assesses the effectiveness of the <strong>final step</strong> of coagulation in which<strong> fibrinogen</strong> is converted to <strong>fibrin</strong>. Thrombin is added to the plasma along with calcium, and clotting time is determined. The normal value of TT is 15 to 19 seconds. Prolonged TT is seen in conditions with <strong>decreased fibrinogen</strong> concentration, like <strong>DIC</strong> and <strong>afibrinogenemia</strong>.</p>\n<p>5) <strong>Clotting</strong> <strong>time</strong> measures the time taken for the <strong>fresh blood</strong> to <strong>clot</strong>. Normal: 3\u20136 minutes. It is one of the oldest tests and is <strong>not sensitive </strong>as it fails to detect mild/ moderate coagulant defects. Hence, it is not preferred as a screening test. It is prolonged in severe deficiency of <strong>factor VIII, IX</strong>, or fibrinogen (afibrinogenemia) and in heparin therapy</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old female patient presents with jaundice, confusion, and aphasia. Peripheral smear shows the presence of schistocytes. Coagulation studies were found to be normal but platelet count is decreased. Serum haptoglobin levels are low. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Immune thrombocytopenic purpura"
      },
      {
        "id": 2,
        "text": "Disseminated intravascular coagulation"
      },
      {
        "id": 3,
        "text": "Hemolytic uremic syndrome"
      },
      {
        "id": 4,
        "text": "Thrombotic thrombocytopenic purpura"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most likely diagnosis in this case is<strong>&nbsp;thrombotic thrombocytopenic purpura (TTP)</strong>.</p>\n<p><strong>Thrombotic thrombocytopenic purpura (TTP) </strong>is&nbsp;<strong>thrombotic microangiopathy</strong> that can be inherited or spontaneously acquired. It results from a <strong>deficiency of</strong>&nbsp;the metalloprotease <strong>ADAMTS13,&nbsp;</strong>which&nbsp;normally <strong>cleaves multimers</strong> of<strong>&nbsp;vWF</strong>. <strong>Failure to cleave</strong> these multimers results in <strong>excessive platelet adhesion </strong>and<strong> aggregation</strong>. This causes&nbsp;platelet thrombi and fibrin deposits to form at various sites in the circulation. These thrombi result in the <strong>classic pentad</strong> of clinical features:&nbsp;</p>\n<ul>\n<li>Microangiopathic hemolytic anemia (MAHA)</li>\n<li>Thrombocytopenia</li>\n<li>Renal failure</li>\n<li>Neurologic findings</li>\n<li>Fever</li>\n</ul>\n<p>The <strong>platelet thrombi narrow</strong> the vessel <strong>lumen,</strong>&nbsp;causing&nbsp;<strong>shearing stress</strong> on the red blood cells that are passing through. This results in microangiopathic hemolytic anemia. The same <strong>platelet thrombi&nbsp;</strong>cause <strong>microvascular occlusion</strong> and result in features like<strong> renal failure</strong> and <strong>neurological manifestations</strong>. On <strong>peripheral smear</strong>, these fragmented red cells appear as <strong>schistocytes</strong> or <strong>helmet cells,</strong> as shown in the image below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7698db7a0b9c479d9e61b2dc0d1b4fd4x754x594.PNG"
    ]
  },
  {
    "text": "A patient undergoing a pre-op evaluation has an isolated prolonged aPTT. Further investigations show deficient levels of factor XII but he has no history of spontaneous bleeding. Which of the following is the best way to manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Give Factor XII concentrate before surgery"
      },
      {
        "id": 2,
        "text": "Transfuse cryoprecipitate before surgery"
      },
      {
        "id": 3,
        "text": "Proceed with surgery without any treatment"
      },
      {
        "id": 4,
        "text": "Transfuse fresh frozen plasma before surgery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most appropriate management for this patient is to<strong> proceed with surgery without additional treatment.</strong></p>\n<p><strong>Factor XII deficiency</strong> leads to a <strong>prolonged</strong> <strong>activated partial thromboplastin time </strong>(APTT) in <strong>vitro</strong>, but it does not increase the risk of<strong> bleeding</strong> in <strong>vivo</strong>. This discrepancy is due to the role of<strong> factor XII</strong> in the <strong>intrinsic pathway of coagulation</strong>, which does not significantly impact hemostasis in vivo. Patients with Factor XII deficiency typically do not exhibit hemorrhagic symptoms and thus will have<strong> normal hemostasis</strong> during surgical procedures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman in the casualty with right leg pain, swelling, and erythema is diagnosed with a DVT. She had a pulmonary embolism six months ago and was treated with warfarin, which was recently stopped. Coagulation assays show insensitivity to activated protein C. What is the likely finding upon further evaluation?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated homocysteine"
      },
      {
        "id": 2,
        "text": "Factor V mutation"
      },
      {
        "id": 3,
        "text": "Prothrombin mutation"
      },
      {
        "id": 4,
        "text": "Antithrombin III deficiency"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient\u2019s presentation of <strong>DVT </strong>and history of<strong> pulmonary embolism</strong>, along with <strong>insensitivity to activated protein C</strong>, strongly suggests a <strong>Factor V Leiden</strong> mutation.</p>\n<p>The mutation occurs in the <strong>Factor V gene</strong> and leads to the production of a Factor V protein that is resistant to inactivation by <strong>activated protein C</strong> (APC). Normally, APC degrades Factor V to prevent excessive clotting, but in individuals with Factor V Leiden, this process is impaired, leading to a higher risk of forming abnormal blood clots.</p>\n<p>Factor V Leiden mutation is the most common<strong> inherited thrombophilia</strong>, which follows an <strong>autosomal dominant</strong> inheritance pattern. <strong>Heterozygous </strong>carriers have a 3 to 8 times increased risk of venous thromboembolism (VTE), while <strong>homozygous</strong> individuals have a significantly higher risk, approximately 50 to 100 times greater.</p>\n<p>Patients with Factor V Leiden are at increased risk for conditions like<strong> deep vein thrombosis</strong> (DVT) and <strong>pulmonary embolism</strong> (PE). The risk is further elevated in situations such as<strong> pregnancy</strong>, <strong>oral contraceptive use</strong>,\u00a0and<strong> prolonged immobilization</strong>.</p>\n<p>The diagnosis is typically confirmed through <strong>genetic testing</strong> for the Factor V Leiden mutation. <strong>Coagulation assays</strong> showing <strong>APC resistance </strong>are also indicative of this condition.</p>\n<p>Management of patients with Factor V Leiden involves <strong>anticoagulation</strong> therapy during episodes of thrombosis. <strong>Long-term anticoagulation</strong> may be considered in patients with<strong> recurrent thrombotic</strong> events or significant <strong>risk factors</strong>. Preventive measures are crucial for high-risk situations to reduce the likelihood of thromboembolic events.</p>\n<p>Other options:</p>\n<p>Option A: While elevated <strong>homocysteine </strong>can increase the risk of thrombosis, it does not cause APC resistance.</p>\n<p>Option C: The <strong>prothrombin gene mutation (G20210A)</strong> increases <strong>prothrombin levels</strong>, leading to a higher risk of clotting, but it does not involve APC resistance.</p>\n<p>Option D: This condition leads to reduced inhibition of <strong>thrombin</strong> and other clotting factors, increasing clotting risk, but it is not associated with APC resistance.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman presents with episodic nose and gum bleeding over the past two weeks. She is not on any medications. Examination reveals a hemoglobin level of 13.1 g/dL, a leukocyte count of 6600/mm\u00b3, a platelet count of 28,000/mm\u00b3, and a normal coagulation profile. A peripheral smear shows normal-sized platelets with no abnormal cells. Which diagnostic test is indicated for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "ADAMTS 13 testing"
      },
      {
        "id": 2,
        "text": "Hepatitis C Serology"
      },
      {
        "id": 3,
        "text": "Bone marrow biopsy"
      },
      {
        "id": 4,
        "text": "Anti PF-4 antibodies"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario with isolated thrombocytopenia suggests<strong> immune thrombocytopenic purpura</strong> (ITP). <strong>Hepatitis C serology</strong> is essential to rule out <strong>secondary causes </strong>in suspected ITP patients thus <strong>HCV serology</strong> is indicated.</p>\n<p>In patients suspected of having <strong>\u00a0Immune Thrombocytopenic Purpura (ITP)</strong>, secondary causes such as <strong>infections</strong> should be ruled out.<strong> Hepatitis C</strong> and <strong>HIV serology</strong> should be obtained in adults with suspected primary immune thrombocytopenia, as treating these infections is likely to improve <strong>thrombocytopenia</strong>.</p>\n<p><strong>Immune Thrombocytopenic Purpura</strong> (ITP) is an acquired disorder characterized by immune-mediated destruction of platelets and inhibition of platelet release from megakaryocytes. It can be<strong> primary (idiopathic)</strong> or<strong> secondary</strong> to underlying conditions such as <strong>systemic lupus erythematosus</strong> (SLE),<strong> HIV</strong>, and <strong>Hepatitis C</strong>.</p>\n<p>Patients usually present with <strong>mucocutaneous bleeding</strong>, including <strong>petechiae</strong>, and <strong>purpura</strong>, often following minor trauma. Severe bleeding, such as gastrointestinal or intracranial hemorrhage, is rare.</p>\n<p>The <strong>diagnosis</strong> of ITP is primarily <strong>clinica</strong>l, supported by laboratory findings of<strong> isolated thrombocytopenia</strong> with a <strong>normal coagulation</strong> profile and <strong>peripheral smear</strong>.\u00a0</p>\n<p>Initial Treatment is with glucocorticoids to reduce immune-mediated platelet destruction. For <strong>severe</strong> thrombocytopenia or bleeding, <strong>intravenous immunoglobulin </strong>(IVIg) and<strong> anti-D immunoglobulin</strong> can be used. For patients who relapse or do not respond to glucocorticoids, <strong>splenectomy</strong> is considered. <strong>Thrombopoietin receptor agonists </strong>like<strong> Eltrombpag</strong>\u00a0and immunosuppressive agents like <strong>rituximab</strong> are other options.</p>\n<p>Other options</p>\n<p>Option A: <strong>ADAMTS 13 </strong>testing is indicated in patients with <strong>suspected thrombotic thrombocytopenic purpura (TTP)</strong>, which typically presents with <strong>microangiopathic hemolytic anemia\u00a0</strong>characterized by <strong>low hemoglobin</strong> and <strong>schistocytes</strong> on a peripheral smear.</p>\n<p>Option C: <strong>Bone marrow biopsy</strong> is not routinely required for diagnosing ITP unless there are <strong>atypical findings </strong>on peripheral smear\u00a0or a lack of response to treatment. It is generally reserved for cases where <strong>myelodysplastic syndrome</strong> or <strong>leukemia </strong>is suspected.</p>\n<p>Option D: \u00a0Antibodies against <strong>platelet factor 4 </strong>(PF-4) are seen in <strong>Heparin-induced thrombocytopenia </strong>(HIT) which may occur 5-10 days after initiation of Heparin. This patient is not taking Heparin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are included in the International Society on Thrombosis and Haemostasis (ISTH) diagnostic criteria for DIC?",
    "choices": [
      {
        "id": 1,
        "text": "2, 4, 5, 6"
      },
      {
        "id": 2,
        "text": "1, 2, 4, 5, 6"
      },
      {
        "id": 3,
        "text": "1, 2, 3, 5"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4, 6"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ISTH criteria include <strong>platelet count, D-dimer, fibrinogen, </strong>and <strong>prothrombin time,</strong> therefore option C is correct.</p>\n<p>The <strong>ISTH</strong> has created a scoring system to help diagnose overt DIC. This system evaluates <strong>platelet count</strong>,<strong> D-dimer</strong> levels, <strong>prothrombin time</strong> (PT), and <strong>fibrinogen levels</strong>, assigning points based on the severity of each parameter. The total score derived from these points assists in the diagnosis of DIC:</p>\n<table style=\"border-collapse: collapse; width: 34.7284%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 26.1518%; text-align: left;\"><strong>PARAMETER</strong></td>\n<td style=\"width: 48.2984%; text-align: left;\"><strong>VALUE</strong></td>\n<td style=\"width: 25.445%; text-align: left;\"><strong>POINTS</strong></td>\n</tr>\n<tr>\n<td style=\"width: 26.1518%;\"><strong><span style=\"font-size: 10pt;\">Platelets</span></strong></td>\n<td style=\"width: 48.2984%;\"><span style=\"font-size: 10pt;\">&gt;100,000</span><br /><span style=\"font-size: 10pt;\">&gt;50,000 but &lt;100,000</span><br /><span style=\"font-size: 10pt;\">&lt;50,000</span></td>\n<td style=\"width: 25.445%; text-align: left;\"><span style=\"font-size: 10pt;\">0</span><br /><span style=\"font-size: 10pt;\">1</span><br /><span style=\"font-size: 10pt;\">2</span></td>\n</tr>\n<tr>\n<td style=\"width: 26.1518%;\"><strong><span style=\"font-size: 10pt;\">D-dimer</span></strong></td>\n<td style=\"width: 48.2984%;\"><span style=\"font-size: 10pt;\">Normal\u00a0</span><br /><span style=\"font-size: 10pt;\">Moderate increase</span><br /><span style=\"font-size: 10pt;\">Severe increase</span></td>\n<td style=\"width: 25.445%;\"><span style=\"font-size: 10pt;\">0</span><br /><span style=\"font-size: 10pt;\">2</span><br /><span style=\"font-size: 10pt;\">3</span></td>\n</tr>\n<tr>\n<td style=\"width: 26.1518%;\"><strong><span style=\"font-size: 10pt;\">Prothrombin time (PT) prolongation</span></strong></td>\n<td style=\"width: 48.2984%;\"><span style=\"font-size: 10pt;\">&lt;3 s</span><br /><span style=\"font-size: 10pt;\">3-&lt;6 s</span><br /><span style=\"font-size: 10pt;\">&gt;6s</span></td>\n<td style=\"width: 25.445%;\"><span style=\"font-size: 10pt;\">0</span><br /><span style=\"font-size: 10pt;\">1</span><br /><span style=\"font-size: 10pt;\">2</span></td>\n</tr>\n<tr>\n<td style=\"width: 26.1518%;\"><strong><span style=\"font-size: 10pt;\">Fibrinogen</span></strong></td>\n<td style=\"width: 48.2984%;\"><span style=\"font-size: 10pt;\">&gt;1 g/L</span><br /><span style=\"font-size: 10pt;\">&lt;1 g/L</span></td>\n<td style=\"width: 25.445%;\"><span style=\"font-size: 10pt;\">0</span><br /><span style=\"font-size: 10pt;\">1</span></td>\n</tr>\n<tr>\n<td style=\"width: 26.1518%;\"><strong><span style=\"font-size: 10pt;\">Total score</span></strong></td>\n<td style=\"width: 48.2984%;\">\u00a0</td>\n<td style=\"width: 25.445%;\"><strong><span style=\"font-size: 10pt;\">&lt;5 Low-grade DIC</span></strong><br /><strong><span style=\"font-size: 10pt;\">&gt;5 Overt DIC</span></strong></td>\n</tr>\n</tbody>\n</table>\n<p><strong>Disseminated intravascular coagulation </strong>(DIC) is an acquired syndrome characterized by the widespread activation of <strong>blood clotting factors</strong> within blood vessels,\u00a0 throughout the body. This can result in <strong>multiple organ dysfunction</strong> and severe bleeding due to the consumption of platelets and coagulation factors. The primary mechanism of DIC involves the uncontrolled generation of thrombin through pathways leading to sustained <strong>coagulation activation</strong>, the <strong>formation of fibrin</strong>, and the <strong>consumption of clotting factors</strong> and <strong>platelets</strong>.</p>\n<p><strong>Infections </strong>are the most frequent cause of DIC.</p>\n<p>The following<strong> lab findings</strong> are seen in DIC:\u00a0</p>\n<ol>\n<li>Decreased platelet count</li>\n<li>Prolonged PT/TT</li>\n<li>Prolonged activated partial thromboplastin time (aPTT)</li>\n<li>Decreased fibrinogen</li>\n<li>Elevated fibrin degradation products (D-dimers)</li>\n<li>Peripheral smear: microangiopathic hemolytic anemia in DIC with schistocytes (fragmented red blood cells)</li>\n</ol>\n<p>The <strong>treatment</strong> involves<strong> platelet transfusion</strong> when platelet counts are below 10,000-20,000/\u03bcL. Replacement of <strong>fibrinogen</strong> and <strong>coagulation factors</strong> is with <strong>fresh frozen plasma</strong> (FFP) along with <strong>cryoprecipitate </strong>or <strong>fibrinogen concentrate</strong>.</p>\n<p>In cases of <strong>low-grade DIC</strong> associated with<strong> solid tumors</strong> or <strong>acute promyelocytic leukemia</strong> low doses of continuous-infusion<strong> heparin</strong> have been effective.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Two patients, A and B, present with frequent nosebleeds. On further investigations, it is revealed that they have a deficiency of glycoprotein Ib/IX and glycoprotein IIb\u2013IIIa respectively. Which of the following lab tests will you order to confirm their diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ristocetin cofactor assay"
      },
      {
        "id": 2,
        "text": "Platelet count"
      },
      {
        "id": 3,
        "text": "Bleeding time"
      },
      {
        "id": 4,
        "text": "PT/PTT"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ristocetin cofactor assay</strong> can be used to differentiate patient A who has <strong>Bernard\u2013Soulier syndrome(deficiency of Gp Ib-IX receptor) </strong>from patient B who has<strong> Glanzmann's thrombasthenia(deficiency Gp IIb/IIIa receptor)</strong><strong>.</strong></p>\n<p>This is because the ristocetin cofactor assay tests the integrity of the <strong>Gp Ib binding</strong> to the <strong>Von Willebrand factor</strong>. This will be normal in patients with Glanzmann's. So, this test can be used to differentiate <strong>Bernard\u2013Soulier syndrome </strong>(<strong>abnormal</strong> ristocetin aggregation)\u00a0from <strong>Glanzmann's thrombasthenia</strong> (<strong>normal</strong> ristocetin aggregation) .</p>\n<p><strong>B</strong><strong>ernard\u2013Soulier syndrome</strong>\u00a0and\u00a0<strong>Glanzmann\u2019s thrombasthenia\u00a0</strong>are caused due to\u00a0<strong>deficiency of\u00a0Gp Ib-IX receptor </strong>and<strong>\u00a0deficiency Gp IIb/IIIa receptor</strong>\u00a0respectively.\u00a0In both these conditions, <strong>platelet count</strong> and <strong>PT/PTT</strong> is <strong>normal,</strong> with only an <strong>increase in bleeding time.\u00a0</strong></p>\n<p>Specific <strong>platelet aggregation tests</strong> with collagen, ADP, etc. <strong>will fail</strong> to bring about platelet aggregation in\u00a0<strong>Glanzmann\u2019s thrombasthenia.\u00a0</strong>Whereas, in\u00a0<strong>B</strong><strong>ernard\u2013Soulier syndrome,</strong>\u00a0platelet aggregation tests are<strong> normal.</strong></p>\n<p>Other options:</p>\n<p>Option B: Platelet count is not specific enough to diagnose deficiencies of the mentioned glycoproteins.</p>\n<p>Options C: Bleeding time assesses overall platelet function but does not directly diagnose the specific glycoprotein deficiencies.</p>\n<p>Options D: PT/PTT are coagulation tests and can help identify clotting disorders but are not specific for glycoprotein deficiencies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/782ae3af1df243909f30610685a47c0ex1279x1689.JPEG"
    ]
  },
  {
    "text": "A grandmother has noticed that her granddaughter's umbilical stump hasn't fallen off even after 4 weeks. On examination, the pediatrician notices mild bruising. Which of the following clotting factor deficiencies should he suspect?",
    "choices": [
      {
        "id": 1,
        "text": "Factor VII deficiency"
      },
      {
        "id": 2,
        "text": "Factor IX deficiency"
      },
      {
        "id": 3,
        "text": "Factor XI deficiency"
      },
      {
        "id": 4,
        "text": "Factor XIII deficiency"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Delayed separation</strong> of the umbilical stump&nbsp;beyond 4 weeks is a characteristic finding seen in&nbsp;<strong>factor XIII deficiency.</strong> However, these findings can also be seen in septicemia or local infections.</p>\n<p><strong>Factor XIII</strong> is responsible for the <strong>crosslinking of fibrin to stabilize</strong> the fibrin clot, symptoms&nbsp;of delayed hemorrhage are secondary to the instability of the clot. Typically, patients have trauma one day and then have a bruise or hematoma the next day.</p>\n<p>Results of the<strong>&nbsp;usual screening tests for hemostasis</strong> are <strong>normal</strong> in patients with factor XIII deficiency. Screening tests for factor XIII deficiency are based on the observation that there is increased solubility of the clot because of the failure of cross-linking.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding the classical hemorrhagic disease of the newborn?",
    "choices": [
      {
        "id": 1,
        "text": "Age of onset is 1-6 months"
      },
      {
        "id": 2,
        "text": "Age of onset is 2-7 days"
      },
      {
        "id": 3,
        "text": "Age of onset is 0-24 hours"
      },
      {
        "id": 4,
        "text": "Age of onset is >6 months"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The age of onset of classical hemorrhagic disease of the newborn is<strong> 2-7 days</strong>.&nbsp;</p>\n<p><strong>Hemorrhagic disease of the newborn</strong> is caused by a&nbsp;transient deficiency of <strong>vitamin K</strong>&ndash;dependent factors,<strong>&nbsp;factors II, VII, IX, and X.</strong></p>\n<p>Causes include:</p>\n<ul>\n<li>Lack of free vitamin K from the mother</li>\n<li>Absence of the bacterial intestinal flora normally responsible for the synthesis of vitamin K.</li>\n</ul>\n<div class=\"page\" title=\"Page 1531\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Classical</strong> hemorrhagic disease of the newborn&nbsp;occurs early in the newborn period, typically <strong>between day 2 and 7 of life</strong>, and most often in exclusively breastfeeding infants who did not receive vitamin K prophylaxis at birth.</p>\n<div class=\"page\" title=\"Page 1531\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Early-onset</strong> vitamin K deficiency bleeding (<strong>after birth but in first 24 hr</strong>) occurs if the mother has been treated chronically with certain drugs that interfere with vitamin K absorption or function. (Option C)</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1531\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Late-onset</strong> vitamin K deficiency bleeding (<strong>1-6 months of life</strong>) is usually associated with conditions that feature malabsorption of the fat-soluble vitamin K, such as cystic fibrosis, neonatal hepatitis, or biliary atresia.&nbsp;</p>\n</div>\n</div>\n</div>\n<p>Hemorrhagic disease of the newborn<strong>&nbsp;</strong>is responsive to and prevented by <strong>vitamin K therapy</strong> (0.5-1 mg of phytonadione).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is brought with hemarthrosis following a trivial trauma. On testing, you find an isolated prolongation of prothrombin time. Which of the following clotting factors is likely to be deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Factor VII"
      },
      {
        "id": 2,
        "text": "Factor VIII"
      },
      {
        "id": 3,
        "text": "Factor IX"
      },
      {
        "id": 4,
        "text": "Factor II"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hemarthrosis</strong>&nbsp;following a trivial trauma is suggestive of a bleeding disorder and that associated with an <strong>isolated prolonged</strong> <strong>prothrombin</strong> <strong>time</strong>&nbsp;shows that<strong>&nbsp;clotting factor VII </strong>is likely to be <strong>deficient</strong> in this patient.&nbsp;&nbsp;</p>\n<p><strong>Prothrombin time </strong>(PT) assesses the <strong>extrinsic pathway</strong> and common coagulation pathways. It measures the time (in seconds) needed for plasma to clot after the addition of an exogenous source of tissue thromboplastin and calcium ions. A prolonged PT can occur due to deficiencies/dysfunction of factors <strong>V</strong>, <strong>VII</strong>, <strong>X</strong>, <strong>II</strong> (prothrombin), and fibrinogen.</p>\n<p><strong>Activated partial thromboplastin time </strong>(aPTT) assesses the <strong>intrinsic pathway</strong> and common coagulation pathways. It measures the time needed for plasma to clot after the addition of kaolin (to activate XII), cephalin (substitutes platelet phospholipids), and calcium ions. aPTT is prolonged due to dysfunction of V, VIII, IX, X, XI, XII, prothrombin, and fibrinogen.&nbsp;&nbsp;</p>\n<p>Thus this shows that factor VII deficiency is associated with isolated prolongation of PT.</p>\n<p>Clotting factor VII deficiency, otherwise known as <strong>Alexander's disease</strong>, is usually inherited as an autosomal recessive disease. It can present with<strong> recurrent</strong> episodes of <strong>bleeding</strong> into joints, muscles, and closed spaces that start spontaneously or following an injury. Diagnosis can be made by lab results of PT and aPTT and confirmed with factor VII assay. Patients are treated with recombinant factor VIIa.&nbsp;&nbsp;</p>\n<p>Other options:</p>\n<p>Option B &amp; C: <strong>Factor VIII </strong>and&nbsp;<strong>IX&nbsp;deficiency</strong>, otherwise known as&nbsp;<strong>hemophilia A &amp; B </strong>respectively,&nbsp;are associated with <strong>isolated</strong>&nbsp;<strong>prolonged aPTT</strong>.</p>\n<p>Option D:<strong> Factor II deficiency</strong> is associated with<strong>&nbsp;prolongation </strong>of both <strong>PT</strong> and<strong> aPTT.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old lady presents with generalised weakness and recurrent epistaxis. On examination, the spleen is not palpable. Blood investigations reveal Hb of 5 g/dL, platelet count of 15,000/\u03bcL, and WBC count of 3000/\u03bcL. What findings are expected to be seen in a bone marrow biopsy of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Macrophages with characteristic crumbled tissue paper appearance."
      },
      {
        "id": 2,
        "text": "Numerous needle-like azurophilic granules in the cytoplasm of the promyelocytes."
      },
      {
        "id": 3,
        "text": "Hypocellularity with\u00a0fatty infiltration"
      },
      {
        "id": 4,
        "text": "Erythroid hyperplasia with pathognomonic ring sideroblasts"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario, the presence of <strong>generalised weakness, recurrent epistaxis, </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>impalpable spleen</strong>&nbsp;</span>and blood investigations showing <strong>pancytopenia,</strong> are suggestive of <strong>Aplastic anemia. </strong>Bone marrow biopsy reveals <strong>hypocellularity</strong> with&nbsp;<strong>fatty infiltration.</strong></p>\n<p><strong>Aplastic anemia</strong>&nbsp;is a syndrome of chronic primary&nbsp;<strong>hematopoietic failure</strong>. This results in&nbsp;<strong>pancytopenia</strong> (anemia, neutropenia, and thrombocytopenia).&nbsp;The patient will have</p>\n<ul>\n<li>Decreased red blood cells leading to&nbsp;<strong>anemia</strong></li>\n<li>Decreased white blood cells leading to recurrent&nbsp;<strong>infections</strong></li>\n<li>Decreased platelets leading to&nbsp;<strong>petechiae</strong>&nbsp;and ecchymoses.</li>\n</ul>\n<p>Many other leukemias and lymphomas may have a similar presentation. However,&nbsp;<strong>splenomegaly</strong>&nbsp;is&nbsp;<strong>characteristically absent</strong>&nbsp;in these patients.&nbsp;</p>\n<p>The bone marrow is markedly <strong>hypocellular.</strong> It is largely devoid of hematopoietic cells. Marrow aspirates yield a&nbsp;<strong>dry tap</strong>&nbsp;having&nbsp;<strong>only fat cells</strong>, fibrous stroma, lymphocytes, and plasma cells. Aplasia is best appreciated in&nbsp;<strong>marrow biopsies.&nbsp;</strong></p>\n<p>The images given below show the normal and hypocellular bone marrow.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f327985138be43de83d043bd95a6e896x1280x1502.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8cc18d7855e5451bbaab4ca25821d8ddx1280x1151.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d5a413779f1468dac68342811b4bb48x352x512.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ff00d7fd5ef142f4b7787d10ce2aaf17x501x353.JPEG"
    ]
  },
  {
    "text": "A 58-year-old male patient comes to the medical outpatient department with increased frequency and burning micturition. He has a mechanical heart valve and is undergoing warfarin therapy for his transient ischaemic attacks. Urine is sent for culture and sensitivity and he is started on antibiotics. The next day he comes with complaints of excessive bleeding after a trivial injury. Which of the following antibiotics was most probably prescribed?",
    "choices": [
      {
        "id": 1,
        "text": "Tetracycline"
      },
      {
        "id": 2,
        "text": "Cotrimoxazole"
      },
      {
        "id": 3,
        "text": "Clindamycin"
      },
      {
        "id": 4,
        "text": "Cephalexin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The clinical vignette showing a man with a mechanical valve who is undergoing\u00a0</span><strong><span data-preserver-spaces=\"true\">warfarin therapy</span></strong><span data-preserver-spaces=\"true\">\u00a0presenting with\u00a0</span><strong><span data-preserver-spaces=\"true\">excessive bleeding</span></strong><span data-preserver-spaces=\"true\">\u00a0is most likely due to the administration of the antibiotic\u00a0</span><strong><span data-preserver-spaces=\"true\">cotrimoxazole.</span></strong></p>\n<p><strong><span data-preserver-spaces=\"true\">Warfarin</span></strong><span data-preserver-spaces=\"true\">\u00a0is mainly\u00a0</span><strong><span data-preserver-spaces=\"true\">metabolized\u00a0</span></strong><span data-preserver-spaces=\"true\">by the</span><strong><span data-preserver-spaces=\"true\">\u00a0CYP2C9</span></strong><span data-preserver-spaces=\"true\">\u00a0enzyme. Drugs that inhibit the CYP2C9 enzyme, like cotrimoxazole, reduce the metabolism of warfarin and thus, enhance the anticoagulant effect of warfarin and increase the risk of bleeding.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Warfarin interactions</span></strong><span data-preserver-spaces=\"true\">:</span></p>\n<p><span data-preserver-spaces=\"true\">Interactions with warfarin can be caused due to alteration in the absorption and metabolism of the drug, the circulating levels of clotting factors, and the state of epithelial surface.</span></p>\n<p><span data-preserver-spaces=\"true\">Reduced efficacy:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Decreased absorption - COnjugation with cholestyramine</span></li>\n<li><span data-preserver-spaces=\"true\">Increased clearance - CYP2C9 activation by drugs (barbiturates, carbamazepine, rifampin)</span></li>\n<li><span data-preserver-spaces=\"true\">Reduced circulating volume - Nephrotic syndrome</span></li>\n<li><span data-preserver-spaces=\"true\">Resistance - High Vitamin K consumption, High circulating clotting factor levels in pregnancy</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">Increased efficacy:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Drugs causing CYP2C9 inhibition:</span></li>\n<ul>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Amiodarone</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Azole antifungals</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Cimetidine</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Clopidogrel</span></li>\n<li class=\"ql-indent-1\"><strong><span data-preserver-spaces=\"true\">Cotrimoxazole</span></strong></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Disulfiram</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Isoniazid</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Metronidazole</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Fluoxetine</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Sulfinpyrazone</span></li>\n<li class=\"ql-indent-1\"><span data-preserver-spaces=\"true\">Zafirlukast</span></li>\n</ul>\n</ul>\n<p><span data-preserver-spaces=\"true\">Other options:</span></p>\n<p><span data-preserver-spaces=\"true\">Options A and D - <strong>Tetracycline</strong> and <strong>Cephalexin</strong> (belonging to cephalosporins) are almost completely metabolized and excreted by the kidneys and hence do not interact with Warfarin.</span></p>\n<p><span data-preserver-spaces=\"true\">Option C - <strong>Clindamycin</strong> is metabolized to N-demethylclindamycin and clindamycin sulfoxide, which are then excreted in the urine and bile. It does not cause CYP2C9 inhibition.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Bleeding And Clotting Disorders Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>