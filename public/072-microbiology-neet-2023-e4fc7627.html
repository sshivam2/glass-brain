<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>072 Microbiology Neet 2023 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">13</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient hailing from Delhi presents with fever, arthralgia, and extensive petechial rash for 3 days. Lab investigations revealed a hemoglobin of 9 g/dL, a white blood cell count of 9000 cells/mm3, a platelet count of 20000 cells/mm3, and a prolonged bleeding time. The clotting time was normal. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dengue"
      },
      {
        "id": 2,
        "text": "Malaria"
      },
      {
        "id": 3,
        "text": "Scrub typhus"
      },
      {
        "id": 4,
        "text": "Typhoid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette is suggestive of&nbsp;<strong>dengue fever</strong>.</p>\n<p>Dengue is an acute febrile disease caused by the mosquito-borne dengue viruses (DENVs), consisting of four serotypes (DENV 1 to 4), that are members of the <strong>Flaviviridae</strong>&nbsp;family, genus <em>Flavivirus</em>.&nbsp;</p>\n<p>Dengue virus is transmitted from person to person by <em>Aedes aegypti</em> mosquitoes.&nbsp;&nbsp;</p>\n<p>After an incubation period of 3&ndash;15 days, <strong>classical dengue</strong> fever begins with an abrupt onset of high fever. The condition is self-limiting though debilitating with headache, <strong>retro-orbital pain</strong>, <strong>myalgia</strong>, arthralgia, <strong>petechiae rash</strong>, and <strong>leucopenia</strong>. A macular-papular recovery rash appears 3&ndash;4 days after the onset of fever, and it usually starts on the trunk before spreading peripherally. The rash in dengue appears as 'white islands in a red sea' due to&nbsp;erythema with petechiae.</p>\n<p>Shown below is an image of the rash in dengue:</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87393961ada7455c9dfb916aecbaad44x720x531.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ea02da746da4198b69b3e01e8775eccx720x961.PNG"
    ]
  },
  {
    "text": "Which of the following statements is true about Trichomonas vaginalis?",
    "choices": [
      {
        "id": 1,
        "text": "It cannot be cultured"
      },
      {
        "id": 2,
        "text": "Twitching motility is seen on wet saline mount"
      },
      {
        "id": 3,
        "text": "Cysts are seen on wet saline mount of vaginal secretions"
      },
      {
        "id": 4,
        "text": "It is not a sexually transmitted infection"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><em>Trichomonas vaginalis</em> has a&nbsp;<strong>jerky or twitching type of mobility </strong>on the wet saline mount. <strong>Option B</strong> is the correct answer.</p>\n<p><em>T. vaginalis</em> is the only protozoan with <strong>one stage</strong> in its life cycle, i.e., trophozoite form (<strong>no cyst stage is seen</strong>). It is an <strong>obligate parasite</strong> and cannot live without close association with vaginal, urethral, or prostatic tissues.&nbsp;<strong>Sexual transmission</strong> is the <strong>main route of infection</strong>. Other modes are fomites, and babies during passage through the infected birth canal.</p>\n<p>The incubation period ranges from 4 days to 4 weeks.&nbsp;</p>\n<p>The common presentation of trichomoniasis is foul-smelling frothy vaginal discharge, itching, dysuria, and dyspareunia. Petechial hemorrhage and mucosal capillary dilation give the appearance of a <strong>strawberry cervix</strong>. <strong>Chicken-like epithelium</strong> occurs due to intracellular edema which is also a <strong>characteristic</strong> feature.</p>\n<p>The <strong>gold standard</strong> for diagnosis is <strong>culture on </strong>cysteine-peptone-liver-maltose (<strong>CPLM</strong>) medium or plastic envelope medium (<strong>PEM</strong>). The treatment of choice is <strong>metronidazole 2 g orally </strong>as a<strong> single dose.</strong></p>\n<p><em>T. vaginalis</em> infection in women may lead to infertility, preterm birth, and low-birth-weight infants. In <strong>men</strong>, trichomoniasis has been also associated with <strong>infertility</strong> through inflammatory damage to the genitourinary tract or interference with sperm function.</p>\n<p>The below image shows the trophozoite form of <em>Trichomonas vaginalis</em>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/805c5ed3067d4b7fa3398596331db1d7x720x576.JPEG"
    ]
  },
  {
    "text": "A lady from West Rajasthan presented with an ulcer surrounded by erythema on the right leg. Microscopy of the biopsy from the edge of the ulcer showed organisms with dark staining nuclei and kinetoplast. What is the most likely causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Leishmania tropica"
      },
      {
        "id": 2,
        "text": "Babesia"
      },
      {
        "id": 3,
        "text": "Trypanosoma"
      },
      {
        "id": 4,
        "text": "Histoplasma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Tests to detect leishmaniasis include:</p>\n<ul>\n<li><strong>Rapid diagnostic test</strong>: <strong>rK39</strong> Rapid diagnostic test and Kala-azar dipstick test strip. This is recommended by National Vector Borne Disease Control Programme (NVBDCP) in India.</li>\n<li>Parasitological diagnosis: Demonstration of <strong>LD bodies</strong> in <strong>buffy coat</strong> smear -<strong>&nbsp;confirmatory.</strong></li>\n<li><strong>Aldehyde test of Napier</strong>: Widely used for surveillance.</li>\n<li>Serological tests for diagnosis: Rapid dipstick test, Direct agglutination test, ELISA, indirect fluorescent antibody test</li>\n<li><strong>Leishmanin (Montenegro) test</strong>: Induration of 5mm or more is considered positive, usually positive 4-6 weeks (delayed-hypersensitivity) after onset in cutaneous leishmaniasis, valuable for distinguishing immune from nonimmune subjects and endemicity.</li>\n</ul>\n<p>Drugs used in the treatment of visceral leishmaniasis are</p>\n<ul>\n<li>Sodium stibogluconate</li>\n<li>Miltefosine</li>\n<li>Amphotericin B</li>\n</ul>\n<p>In Bihar, there is resistance to antimony so amphotericin-B-deoxycholate or miltefosine is preferred.</p>\n<p>Other options:</p>\n<p>Option B: Babesia is a protozoan parasite that causes babesiosis, a tick-borne disease. Babesiosis manifests as a malaria-like illness with fever, chills, and hemolytic anemia.&nbsp;</p>\n<p>Option C: Trypanosoma is a genus of protozoan parasites responsible for diseases like African trypanosomiasis (sleeping sickness) and American trypanosomiasis (Chagas disease). These diseases present with different clinical features, such as fever, swollen lymph nodes, and neurological symptoms in African trypanosomiasis, and fever, swelling at the infection site, and cardiomyopathy in Chagas disease.&nbsp;</p>\n<p>Option D: Histoplasma is a dimorphic fungus that causes histoplasmosis, a systemic mycosis. It primarily affects the lungs and can disseminate to other organs in immunocompromised individuals. The clinical presentation of histoplasmosis is variable, but it does not typically present as a skin ulcer with erythema as described in the clinical scenario.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/30ea1e1ffcee41568b3ff3cb13803332x1280x864.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13d5ef6298ac44f4a7431fd496dfedffx1280x2012.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e3b2ab248ce4f41a8db8785d85445c3x650x650.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/97485e47f8b642ba9ff5a6dadbd2b024x600x611.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da583dd3e1f14d4dae215f44a00ceb1fx619x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f02dc7d88bc466baafa6360654af533x720x539.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d39a47d2d8ac47a293c26cb97318d865x720x531.PNG"
    ]
  },
  {
    "text": "A child presents with a fever and a rash. Urine examination showed cells with owl's eye appearance. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cytomegalovirus"
      },
      {
        "id": 2,
        "text": "Epstein-Barr virus"
      },
      {
        "id": 3,
        "text": "Herpes simplex virus"
      },
      {
        "id": 4,
        "text": "Toxoplasma gondii"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The most likely causative agent is <strong>cytomegalovirus</strong> (CMV)&nbsp;based on the clinical symptoms and the presence of the owl's eye appearance on urinary examination.</p>\n<p>CMV is the <strong>largest virus</strong> in the herpes family of viruses. It causes the following conditions:</p>\n<ul>\n<li><strong>Immunocompetent</strong>&nbsp;individuals - asymptomatic or&nbsp;<strong>mononucleosis</strong>-like infection such as fever and rash&nbsp;</li>\n<li>Neonates -&nbsp;devastating systemic infections</li>\n<li><strong>Immunosuppressed</strong>&nbsp;individuals - serious, life-threatening,&nbsp;<strong>disseminated</strong>&nbsp;CMV infections of the&nbsp;<strong>lungs</strong>&nbsp;(pneumonitis) and&nbsp;<strong>gastrointestinal tract</strong>&nbsp;(colitis)</li>\n</ul>\n<p>CMV spreads through contact with salivary secretions and sexual contact, blood transfusion, and organ transplantation.</p>\n<p class=\"p1\">Laboratory diagnosis is by recovery of the virus from <strong>urine</strong>, <strong>saliva</strong>, or other bodily fluids into <strong>human fibroblast cells</strong>. Antibody demonstration using<strong> ELISA</strong> is used for diagnosis of <strong>primary infection</strong>.</p>\n<p class=\"p1\">A cytomegalic pneumocyte containing characteristic <strong>intranuclear basophilic</strong> inclusion surrounded by a clear <strong>halo</strong>&nbsp;known as an <strong>owl&rsquo;s eye&nbsp;appearance</strong>.</p>\n<p class=\"p1\">Other options:</p>\n<p class=\"p1\">Option B: Epstein Barr virus:<strong> Conditions</strong>&nbsp;associated with EBV infection are</p>\n<ul>\n<li>Glandular fever (infectious mononucleosis): fever, pharyngitis, and posterior cervical lymphadenopathy</li>\n<li>Hodgkin lymphoma</li>\n<li>Non-Hodgkin lymphoma</li>\n<li>Burkitt's lymphoma</li>\n<li>Nasopharyngeal carcinoma</li>\n<li>EBV\u2010associated lymphoproliferative disease</li>\n</ul>\n<p class=\"p1\">Option C: Herpes simplex virus causes cutaneous infections like herpes labialis caused by viral reactivation in febrile patients. It presents as blisters around the mouth, cheeks, and forehead. <strong>Gingivostomatitis</strong> and <strong>pharyngitis</strong> are the most frequent manifestations of <strong>primary herpes</strong> infections. HSV esophagitis presents as dysphagia, sub-sternal pain, and weight loss.&nbsp;</p>\n<p class=\"p1\">Option D: Acute congenital toxoplasmosis may manifest as&nbsp;<strong>fever, jaundice, petechial rashes</strong>, microphthalmia, cataract, glaucoma, lymphadenopathy,&nbsp;<strong>hepatosplenomegaly</strong>, myocarditis, cerebral calcifications, and chorioretinitis.</p>\n<p>Most infections in adults who are immunocompetent are usually asymptomatic. Active progression of infection is more likely in immunocompromised individuals.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f7916f1cd1ff405199da8edb1ca60808x720x478.JPEG"
    ]
  },
  {
    "text": "Infection with Clonorchis sinensis is associated with an increased risk of ___________.",
    "choices": [
      {
        "id": 1,
        "text": "Cervical cancer"
      },
      {
        "id": 2,
        "text": "Cholangiocarcinoma"
      },
      {
        "id": 3,
        "text": "Gastric carcinoma"
      },
      {
        "id": 4,
        "text": "Bladder carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;Other options:</p>\n<p>Option A: <strong>Cervical cancer</strong> - Human papilloma virus (<strong>HPV</strong>) infection, particularly with high-risk strains like HPV-16 and 18, is the main risk factor for cervical cancer. <em>Clonorchis sinensis</em> is not associated with cervical cancer.</p>\n<p>Option C: <strong>Gastric</strong> carcinoma - <em><strong>Helicobacter pylori</strong></em> infection is a major risk factor for the development of gastric carcinoma. <em>Clonorchis sinensis</em> is not linked to gastric carcinoma.</p>\n<p>Option D: <strong>Bladder</strong> carcinoma - The vesical blood fluke <em><strong>Schistosoma haematobium</strong></em> primarily infects the urinary bladder and increases the risk of squamous cell carcinoma of the bladder. <em>Clonorchis sinensis</em> is not associated with bladder carcinoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fdf3302d2e4f4d39aaf85edc361e20a3x1280x976.JPEG"
    ]
  },
  {
    "text": "A patient presented with complaints of persistent cough and weight loss. He had a history of contact with multiple sexual partners. He was diagnosed as HIV positive 6 months back and is poorly adherent to his medications. The fungal culture of sputum was negative. On Gomori methamine silver staining, the cells showed darkly stained crescent-shaped cysts. What is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Paracoccidiodes brasiliensis"
      },
      {
        "id": 2,
        "text": "Histoplasma capsulatum"
      },
      {
        "id": 3,
        "text": "Coccidiodes immitis"
      },
      {
        "id": 4,
        "text": "Pneumocystis jerovecii"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Trimethoprim-sulfamethoxazole</strong> combination (commonly known as co-trimoxazole) is the treatment of choice for PCP, and it is administered for 21 days, followed by a course for secondary prophylaxis. Concomitantly, <strong>glucocorticoids</strong> should also be administered to reduce pulmonary inflammation.</p>\n<p>Patients who are susceptible to PCP are also given <strong>co-trimoxazole</strong> as prophylaxis. For patients who are unable to tolerate co-trimoxazole,&nbsp;<strong>IV pentamidine</strong>&nbsp;is the drug of choice.</p>\n<p>Prophylaxis is indicated for other opportunistic infections like<strong>&nbsp;<em>M</em></strong><em>ycobacterium avium</em> complex (<strong>MAC</strong>) infection if CD4 counts fall below <strong>50 cells/&micro;L;</strong>&nbsp;<em>Coccidioides</em>, if CD count is &lt;<strong>250/&micro;L;</strong>&nbsp;and <em>Cryptococcus</em>, when the CD count is <strong>&lt;100/&micro;L</strong>.</p>\n<p>&nbsp;</p>\n<p>Other options:</p>\n<p>Option A: <em>Paracoccidioides brasiliensis</em> causes paracoccidioidomycosis, which usually presents with ulcerations in the oral and nasal mucosa, lymphadenopathy, and pulmonary lesions, but it does not form crescent-shaped cysts.</p>\n<p>Option B: <em>Histoplasma capsulatum</em> causes histoplasmosis and may be associated with similar symptoms as <em>Pneumocystis jirovecii</em>, but it does not show crescent-shaped cysts on Gomori methenamine silver staining.</p>\n<p>Option C: <em>Coccidioides immitis</em> causes coccidioidomycosis, which is characterized by respiratory symptoms, skin lesions, and joint pain. It also does not show crescent-shaped cysts on Gomori methenamine silver staining.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c803eea37d6b43bb867d19ba3f0e73b1x1280x1057.JPEG"
    ]
  },
  {
    "text": "A sewage worker presented with abdominal pain, jaundice, conjunctival suffusion, and blood in the urine for the past 5 days. Which of the following is the investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Widal test"
      },
      {
        "id": 2,
        "text": "Microscopic agglutination test"
      },
      {
        "id": 3,
        "text": "Weil-Felix reaction"
      },
      {
        "id": 4,
        "text": "Paul-Bunnell test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>leptospirosis (Weil's disease).</strong> A<strong> microscopic agglutination test</strong>\u00a0is the <strong>investigation of choice</strong> for the diagnosis of <strong>leptospirosis</strong>.</p>\n<p>Leptospirosis is a <strong>zoonotic</strong> disease caused by <em><strong>Leptospira interrogans</strong></em>. Humans are <strong>infected</strong> when the leptospirae in<strong> water contaminated</strong>\u00a0with the urine of carrier animals enter the body through cuts or abrasions on the skin or through the intact mucosa of the mouth, nose, or conjunctiva. Hence, a sewage worker is at an increased risk of it.</p>\n<p>Clinical features include fever, jaundice, vomiting, headache, and intense injection of the eyes. Some may present as aseptic meningitis or with hepatorenal damage (Weil's disease). There are two clinical types of leptospirosis: icteric and non-icteric. It can also manifest as aseptic meningitis.</p>\n<p>The life cycle of <em>Leptospira</em> is depicted below:\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d524bfbea1248309d185e8e6f88bbedx720x748.PNG"
    ]
  },
  {
    "text": "Which of the following laboratory test is used to diagnose rotavirus diarrhea?",
    "choices": [
      {
        "id": 1,
        "text": "Antigen detection in the stool sample"
      },
      {
        "id": 2,
        "text": "Antigen detection in blood"
      },
      {
        "id": 3,
        "text": "Antibody detection in serum"
      },
      {
        "id": 4,
        "text": "Light microscopy of stool specimen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Antigen detection</strong> in the<strong> stool</strong> sample is the laboratory test used to detect rotavirus diarrhea.&nbsp;</p>\n<p><strong>Rotavirus&nbsp;</strong>is the<strong>&nbsp;most common</strong>&nbsp;identifiable&nbsp;viral cause&nbsp;of&nbsp;<strong>diarrhea</strong>&nbsp;in children&nbsp;<strong>below</strong>&nbsp;the age of<strong>&nbsp;5 years</strong>&nbsp;and is most frequent between&nbsp;<strong>6-24 months</strong>&nbsp;of age.<strong>&nbsp;</strong>The incubation period is 1-3 days. Most cases are asymptomatic or with&nbsp;<strong>mild symptoms</strong>&nbsp;like&nbsp;watery diarrhea, vomiting, low-grade fever,&nbsp;and temporary lactose intolerance.&nbsp;</p>\n<p>Diagnosis can be made by<strong> rapid antigen detection </strong>of rotavirus in <strong>stool</strong> specimens<strong>. Laboratory diagnosis&nbsp;</strong>depends on the demonstration of the <strong>virus</strong> in stool samples which is collected at an earlier course of illness. <strong>Antigen enzyme immunoassays</strong> (EIAs) and polymerase chain reaction (PCR) are used to detect the virus in the stool. The <strong>polymerase chain reaction</strong> is the most sensitive detection method for genotyping of rotavirus nucleic acids from stool specimens.</p>\n<p>Treatment is supportive including the correction of fluid and electrolyte imbalance. The main goals of treatment are avoiding and treating dehydration. Maintaining nutrition is a secondary goal.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A boy presented with a fever and chills. Rapid test was positive for specific antigen HRP-2. Which of the following species of Plasmodium is the most likely causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Plasmodium falciparum"
      },
      {
        "id": 2,
        "text": "Plasmodium malariae"
      },
      {
        "id": 3,
        "text": "Plasmodium vivax"
      },
      {
        "id": 4,
        "text": "Plasmodium ovale"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the <strong>HRP-2 positivity</strong> are suggestive of<strong><em>&nbsp;P. falciparum&nbsp;</em>malaria</strong>.&nbsp;</p>\n<p><strong>Malaria</strong>&nbsp;is a parasitic infection caused by the&nbsp;<strong>Plasmodium</strong>&nbsp;species transmitted by the&nbsp;<strong>Anopheles</strong>&nbsp;mosquito. It is characterized by many nonspecific symptoms, including but not limited to tachycardia, tachypnea, chills, malaise, fatigue, diaphoresis (sweating), and headache. The fever of malaria is characterized by&nbsp;<strong>periodicity</strong>&nbsp;depending on the infective Plasmodium species. The fever returns every other day for <em><strong>P. vivax</strong></em>, <strong><em>P. ovale</em></strong>, and <em><strong>P. falciparum</strong></em>, and every three days for <em><strong>P. malariae.&nbsp;</strong></em></p>\n<p>The newer tests include <strong>rapid antigen</strong> detection tests that employ immunochromatographic methods. The parasite-F test is one of them. This test is based on the detection of <strong>histidine-rich protein-2</strong> (HRP-2) which is produced only by the<strong> asexual forms</strong> of <em><strong>Plasmodium falciparum</strong></em> that are present on the surface of RBCs. The test strip has monoclonal antibodies against the HRP-2 antigen. This test has very high sensitivity and specificity. The disadvantages of the test include that it can detect <strong>only <em>Plasmodium falciparum</em></strong> HRP-2 antigen but not the other three species of Plasmodium. Also, the test remains positive until 2 weeks after the cure.</p>\n<p>Another diagnostic test of significance is the<strong> dual antigen test</strong>. This test detects both the parasite <strong>lactate dehydrogenase</strong> of trophozoites and gametocytes of all the Plasmodium species and <strong>HRP-2</strong> produced by <em>P. falciparum</em> simultaneously.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child was brought with complaints of high fever, multiple seizures, headache, and neck rigidity.  CSF analysis showed low glucose, high protein, and many polymorphs. The CSF culture showed pleomorphic gram-negative bacilli. What is true about the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "It is bacitracin sensitive."
      },
      {
        "id": 2,
        "text": "Produces non-lactose fermenting colonies on MacConkey agar"
      },
      {
        "id": 3,
        "text": "Exhibits satellitism around Staphylococcus aureus colonies"
      },
      {
        "id": 4,
        "text": "It exhibits alpha hemolysis on sheep blood agar"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><em>H. influenzae<strong>\u00a0</strong></em>has a<strong> capsular polysaccharide,</strong>\u00a0which is a major antigenic determinant. Capsular typing is done to identify strains. Importantly, the type b capsular polysaccharide has a <strong>polyribosyl ribitol phosphate </strong>(PRP)\u00a0<strong>antigen</strong>. PRP is targeted during immunization.\u00a0</p>\n<p><em>H</em>.\u00a0<em>influenzae</em> can also cause meningitis, laryngo-epiglottitis, <strong>pneumonia,</strong> bronchitis, and suppurative lesions like arthritis, endocarditis, and pericarditis.\u00a0</p>\n<p><strong>Cefotaxime</strong> or <strong>ceftazidime</strong> is the drug of choice for the treatment of <em>Haemophilus</em> meningitis. <em>H. influenzae</em> produces <strong>beta-lactamase,</strong> hence <strong>resistant</strong> to beta-lactam antibiotics like ampicillin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/679ecf5c85e1411db194e479ed6f3df6x348x324.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/058873d713c04ae7a0ab4e4bc4392986x510x453.GIF"
    ]
  },
  {
    "text": "A patient presented with a high fever, altered sensorium, headache, neck rigidity, and seizures. He was diagnosed with HSV encephalitis. Which of the following tests can be used to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "IgM in CSF"
      },
      {
        "id": 2,
        "text": "Tzanck smear of CSF"
      },
      {
        "id": 3,
        "text": "CSF PCR for viral DNA"
      },
      {
        "id": 4,
        "text": "CSF culture on chick embryo lines"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Management includes supportive therapy (monitoring of intracranial pressure, fluid restriction, avoidance of hypotonic IV fluids), anticonvulsants for seizures, and <strong>intravenous acyclovir </strong>is beneficial in the treatment of HSV encephalitis.</p>\n<p>&nbsp;Other options:</p>\n<p>Option A: <strong>IgM</strong> antibodies in CSF - Serological tests to detect antibodies are used for <strong>primary herpes</strong> infections.</p>\n<p>Option B: <strong>Tzanck smear</strong> of CSF - A positive smear shows<strong> multinucleated giant cells</strong> with faceted nuclei and ground glass appearance. It is a rapid, inexpensive, and fairly sensitive diagnostic test.&nbsp;The Tzanck smear is typically used to diagnose cutaneous herpes infections, such as herpes simplex or varicella-zoster virus. It is not an appropriate diagnostic test for HSV encephalitis, as it does not provide definitive confirmation of the presence of HSV in the CSF.</p>\n<p>Option D: CSF culture in chick embryos - It is not a sensitive test used for the diagnosis of HSV encephalitis. Negative CSF viral cultures have no value in ruling out HSV encephalitis. Although this method can be used to isolate HSV, it is not as sensitive or specific as PCR for viral DNA and it can take a longer time to obtain results.&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e8c33e7dde164fd8adfa7d0badbcc4ddx480x512.JPEG"
    ]
  },
  {
    "text": "In a patient presented with a fever and a positive filarial antigen test, what is the next appropriate method of management?",
    "choices": [
      {
        "id": 1,
        "text": "Bone marrow biopsy"
      },
      {
        "id": 2,
        "text": "DEC provocation test"
      },
      {
        "id": 3,
        "text": "Detection of microfilariae in the blood smear"
      },
      {
        "id": 4,
        "text": "Ultrasound of the scrotum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A patient with fever and filarial antigen test positive is suggestive of&nbsp;<strong>filariasis</strong>. The next most appropriate step for this patient is the&nbsp;<strong>detection</strong> of <strong>microfilariae</strong> in the <strong>blood smear</strong>.</p>\n<p><strong>Classical filariasis</strong>&nbsp;occurs due to the obstruction of lymphatics by the adult worms, which results in <strong>lymph stasis</strong>. The disease&nbsp;<strong>initially</strong>&nbsp;causes&nbsp;<strong>acute attacks</strong>&nbsp;of&nbsp;<strong>lymphangitis</strong>&nbsp;and&nbsp;<strong>lymphadenitis</strong>. As time goes by the&nbsp;<strong>lymphedema worsens</strong>&nbsp;and is associated with the thickening of the skin and fibrosis of lymph vessels or blockage by adult worms.&nbsp;The lymphatic vessels of the male genitalia are most commonly affected in bancroftian filariasis, producing&nbsp;<strong>episodic funiculitis</strong>, <strong>epididymitis</strong>, and <strong>orchitis</strong>.&nbsp;<strong>Hydrocele</strong>&nbsp;or&nbsp;<strong>elephantiasis&nbsp;</strong>is a very common sign of <strong>chronic bancroftian filariasis</strong>.</p>\n<p>The <strong>standard method</strong> for diagnosing<strong> active infection</strong> is the<strong> identification of</strong> <strong>microfilariae</strong> in a <strong>blood smear</strong> by <strong>microscopic examination</strong>. The microfilariae that cause lymphatic filariasis <strong>circulate</strong> in the blood <strong>at night</strong> showing a&nbsp;<strong>nocturnal periodicity</strong>. Microfilariae can be detected in blood smears of <strong>samples obtained</strong> <strong>at night</strong> between <strong>10 PM to 2 AM</strong>. A thick smear should be made and stained with Giemsa or hematoxylin and eosin. For increased sensitivity, <strong>concentration techniques</strong>&nbsp;like&nbsp;<strong>membrane filter concentration&nbsp;</strong>can be used.</p>\n<p><strong>DEC provocation test </strong>(Option B) refers to the administration of<strong>&nbsp;Diethylcarbamazine</strong> (DEC) at a dose of<strong>&nbsp;100 mg or 2 mg/kg body weight</strong>&nbsp;orally and subsequently collecting blood samples. This causes the <strong>mobilization of microfilariae</strong> into the peripheral blood and thus <strong>microfilariae </strong>can be<strong> detected</strong>&nbsp;<strong>20-50 minutes</strong>&nbsp;after the DEC administration in the sample of peripheral blood.</p>\n<p>Although the&nbsp;<strong>DEC provocation test</strong> has the<strong>&nbsp;advantage</strong>&nbsp;of blood sample collection even<strong> during day time</strong>, the guidelines from CDC, NVBDCP, and IAPSM suggest blood <strong>sample collection at night</strong>, followed by identification of <strong>microfilariae</strong> in a <strong>blood smear</strong> by microscopic examination&nbsp;as the <strong>standard method</strong> for diagnosis (Option C).</p>\n<p>Methods to detect&nbsp;<strong>adult worms</strong>&nbsp;include:</p>\n<p>&bull; <strong>Lymph node biopsy</strong> to detect adult worms.&nbsp;Bone marrow biopsy is not a standard diagnostic procedure for filariasis, as adult worms typically reside in the lymphatic system rather than the bone marrow&nbsp;(Option A).<br />&bull; <strong>X-ray</strong> (if worms are calcified)<br />&bull; High-frequency <strong>ultrasound</strong> and <strong>doppler of the scrotum&nbsp;</strong>(Option D).</p>\n<p>Serologic techniques provide an alternative to the microscopic detection of microfilariae for the diagnosis of lymphatic filariasis. Patients with active filarial infection typically have elevated levels of <strong>anti-filarial&nbsp;IgG4</strong> in the blood and these can be detected using routine assays.</p>\n<ul>\n<li><strong>Antigen detection</strong> by enzyme-linked immunosorbent assay (<strong>ELISA</strong>) and immunochromatographic test (<strong>ICT</strong>)</li>\n<li><strong>Antibody detection</strong>&nbsp;tests have low sensitivity and specificity</li>\n<li><strong>Molecular diagnosis </strong>is done by <strong>PCR (polymerase chain reaction). </strong>This test is <strong>positive</strong> only when<strong> microfilaria </strong>are <strong>present</strong> in peripheral blood. It is<strong> negative</strong> in<strong> chronic filariasis.</strong></li>\n</ul>\n<p><strong>Diethylcarbamazine</strong> is the <strong>drug of choice.&nbsp;</strong>WHO has recently recommended a&nbsp;<strong>triple-drug</strong>&nbsp;combination of&nbsp;<strong>ivermectin, DEC, and albendazole</strong>&nbsp;as a faster and more effective alternative to expedite the elimination of filariasis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f7253091b8064667aa7a6a122b40b285x439x319.PNG"
    ]
  },
  {
    "text": "A man presents with a history of dysuria and urethral discharge after having unprotected sexual intercourse. Gram-staining of the purulent discharge is seen in the following image. What is the treatment of choice for this infection?",
    "choices": [
      {
        "id": 1,
        "text": "Erythromycin"
      },
      {
        "id": 2,
        "text": "Azithromycin"
      },
      {
        "id": 3,
        "text": "Ceftriaxone"
      },
      {
        "id": 4,
        "text": "Penicillin G"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Other options:</p>\n<p>Option A: Erythromycin: This is not the preferred treatment for gonorrhea, as it is less effective and has a higher rate of resistance compared to ceftriaxone.</p>\n<p>Option B: Azithromycin: Although it can be used in combination with ceftriaxone for the treatment of gonorrhea, it is not the treatment of choice as a single agent.</p>\n<p>Option D: Penicillin G: This was once a treatment option for gonorrhea, but it is no longer recommended due to widespread resistance.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe6f28966e69421eb996857f87b18e44.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '072 Microbiology Neet 2023';
        let hierarchy = ["Marrow", "PYQs", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>